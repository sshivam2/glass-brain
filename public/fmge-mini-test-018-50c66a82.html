<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 018 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following statements is true regarding bladder injury?",
    "choices": [
      {
        "id": 1,
        "text": "Intraperitoneal rupture is more common."
      },
      {
        "id": 2,
        "text": "Intraperitoneal bladder injuries can be managed with catheter drainage for 7-10 days."
      },
      {
        "id": 3,
        "text": "Pelvic urinoma is seen in intraperitoneal rupture."
      },
      {
        "id": 4,
        "text": "A CT cystogram enables the clinical diagnosis for bladder injury and urinary extravasation."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In bladder injury and urinary extravasation, a computed tomography (<strong>CT) cystogram</strong> is the diagnostic procedure of choice.</p>\n<p><strong>Bladder rupture</strong></p>\n<table style=\"width: 531px; height: 72px;\">\n<tbody>\n<tr>\n<td style=\"width: 40px;\">&nbsp;</td>\n<td style=\"width: 105px;\"><strong>Intraperitoneal rupture</strong></td>\n<td style=\"width: 237px;\"><strong>Extraperitoneal rupture</strong></td>\n</tr>\n<tr>\n<td style=\"width: 40px;\">&nbsp;</td>\n<td style=\"width: 105px;\">Less common (20%)</td>\n<td style=\"width: 237px;\"><strong>More common&nbsp;</strong>(80%)</td>\n</tr>\n<tr>\n<td style=\"width: 40px;\">Cause</td>\n<td style=\"width: 105px;\">\n<ul>\n<li>Blow or fall on a&nbsp;distended bladder</li>\n<li>Surgical damage (rare)</li>\n</ul>\n</td>\n<td style=\"width: 237px;\">\n<ul>\n<li>Blunt trauma</li>\n<li>Surgical damage</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 40px;\">Clinical features</td>\n<td style=\"width: 105px;\">\n<ul>\n<li>Sudden severe pain in the hypogastrium</li>\n<li>Syncope</li>\n<li>Peritonitis</li>\n</ul>\n</td>\n<td style=\"width: 237px;\">\n<ul>\n<li>Pelvic urinoma (encapsulated collection of extravasated urine) is seen</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 40px;\">Treatment</td>\n<td style=\"width: 105px;\">\n<ul>\n<li>Laparotomy</li>\n<li>Repair of bladder</li>\n<li>Bladder drainage</li>\n</ul>\n</td>\n<td style=\"width: 237px;\">&nbsp; &nbsp; <span style=\"font-size: 14pt;\">&bull;</span> Catheter drainage for 7&ndash;10 days</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a first-generation cephalosporin?",
    "choices": [
      {
        "id": 1,
        "text": "Cefadroxil"
      },
      {
        "id": 2,
        "text": "Cefazolin"
      },
      {
        "id": 3,
        "text": "Cephalexin"
      },
      {
        "id": 4,
        "text": "Cefaclor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Cefaclor</strong> is not a first-generation cephalosporin. It is a <strong>second-generation</strong> oral cephalosporin.</p>\n<p>First-generation cephalosporins are :</p>\n<ul>\n<li>Oral formulation\n<ul>\n<li>Cefadroxil</li>\n<li>Cephalexin</li>\n<li>Cephradine</li>\n</ul>\n</li>\n<li>Parenteral formulation - cefazolin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the minimum external pressure that leads to the formation of pressure sores?",
    "choices": [
      {
        "id": 1,
        "text": "30"
      },
      {
        "id": 2,
        "text": "40"
      },
      {
        "id": 3,
        "text": "50"
      },
      {
        "id": 4,
        "text": "60"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The minimum external pressure that leads to the formation of pressure sores is&nbsp;<strong>30 mm of Hg.</strong></p>\n<p><strong>Pressure sores </strong>also known as<strong> bedsores, pressure ulcers, </strong>or<strong> decubitus ulcers&nbsp;</strong>are defined as tissue necrosis with ulceration due to prolonged pressure. When the external pressure exceeds the <strong>capillary</strong> <strong>occlusive pressure</strong>, blood flow ceases leading to tissue <strong>anoxia, necrosis, and ulceration</strong>. Thus an external pressure of &gt;30mmHg leads to the formation of pressure sores.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<div class=\"page\" title=\"Page 46\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 46\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The common sites of pressure sores in decreasing frequency are:</p>\n<ul>\n<li><strong>Ischium</strong></li>\n<li>Greater Trochanter</li>\n<li>Sacrum</li>\n<li>Heel</li>\n<li>Malleolus (lateral followed by medial)</li>\n<li>Occiput</li>\n</ul>\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>A staging system for the description of pressure sores devised by the American National Pressure Ulcer Advisory Panel.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"p1\"><span class=\"s1\">Stage 1 - </span><strong>Non-blanchable erythema</strong> without a breach in the epidermis<br />Stage 2 - <strong>Partial-thickness skin loss</strong> involving the epidermis and dermis<br />Stage 3 - <strong>Full-thickness skin loss</strong> extending into the subcutaneous tissue but <strong>not</strong> through underlying <strong>fascia<br /></strong>Stage 4 - <strong>Full-thickness skin loss</strong>&nbsp;through fascia with extensive tissue destruction, maybe involving <strong>muscle, bone, tendon,&nbsp;</strong>or<strong> joint</strong></p>\n<p><strong>Prevention</strong> is the best treatment for pressure sores. It can be done through <strong>good skincare</strong>, the use of <strong>air-fluidized beds,</strong> special <strong>pressure dispersion cushions</strong>, or foams. The <strong>position</strong> of the bedridden patients should be changed once every <strong>2 hours</strong> and <strong>wheel-chair bound patients</strong> should be taught to get off their chairs for <strong>10 seconds</strong> <strong>every</strong> <strong>10 minutes</strong>.</p>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p style=\"text-align: justify;\">Surgical treatment of pressure sores mainly involves&nbsp;<strong>wound management</strong>. The pressure sores should be adequately <strong>debrided</strong> and <strong>vacuum-assisted closure</strong> (VAC).<strong>VAC</strong>&nbsp;is done by applying intermittent negative pressure of approximately<strong> -125mmHg</strong> to hasten debridement and <strong>promote granulation tissue</strong> formation in chronic wounds and ulcers. Negative pressure <strong>decreases edema</strong>, <strong>removes interstitial fluid</strong>, and <strong>increases blood flow</strong>. This decreases bacterial growth and increases cell proliferation.</p>\n<p style=\"text-align: justify;\">Large <strong>skin flaps</strong> that have muscle with sensory innervation are best for reconstruction(example-extensor fascia lata flap with the lateral cutaneous nerve of the thigh).&nbsp;<strong>Faecal</strong> or <strong>urinary diversion</strong> can be considered in special cases&nbsp;depending on the site of the ulcer, being prone to urine or faecal <strong>contamination</strong>.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The SA Node acts as the pacemaker of the heart because, it ____.",
    "choices": [
      {
        "id": 1,
        "text": "Generates impulse spontaneously"
      },
      {
        "id": 2,
        "text": "Has rich sympathetic innervation"
      },
      {
        "id": 3,
        "text": "Generates impulses at highest rate"
      },
      {
        "id": 4,
        "text": "Has poor cholinergic innervation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The SA node acts as the pacemaker of the heart as it generates impulses at the <strong>highest rate (70-80/min)</strong>, compared to AV node (40-60/min) and Purkinje fibres (15-40). The impulses generated by SA node are conducted through AV node and purkinje fibres repetedly that it will prevent AV node or Purkinje fibres reach their own thresholds for self-excitation.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The accepted minimum period of sexual cohabitation resulting in no offspring for a couple to be declared infertile is ______",
    "choices": [
      {
        "id": 1,
        "text": "One Year"
      },
      {
        "id": 2,
        "text": "Two Year"
      },
      {
        "id": 3,
        "text": "One and Half years"
      },
      {
        "id": 4,
        "text": "Three years"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The accepted minimum period of sexual cohabitation resulting in no offspring for a couple to be declared infertile is <strong>One Year.</strong></p>\n<ul>\n<li>Infertility implies apparent failure of a couple to conceive, while <strong>sterility indicates absolute inability to conceive</strong>, for one or more reasons.</li>\n<li>If a <strong>couple fails to achieve pregnancy after 1 year of &lsquo;unprotected&rsquo; and regular intercourse</strong>, it is an indication to investigate the couple.</li>\n</ul>\n<p>Infertility is of two types:</p>\n<ul>\n<li>Primary infertility: When <strong>no previous pregnancies</strong> have occurred.</li>\n<li>Secondary infertility: When a <strong>prior pregnancy</strong> (although not necessarily a live birth) has occurred.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are doing an emergency laparotomy for a case of intestinal obstruction. Which organ will you first visualize to know if this is a case of small bowel or large bowel obstruction?",
    "choices": [
      {
        "id": 1,
        "text": "Ileum"
      },
      {
        "id": 2,
        "text": "Caecum"
      },
      {
        "id": 3,
        "text": "Jejunum"
      },
      {
        "id": 4,
        "text": "Sigmoid colon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>The cecum</strong> is the <strong>first organ to be visualized to differentiate</strong> between the small and large bowel in cases of intestinal obstruction.</p>\n<p><strong>Distension of the cecum </strong>will confirm<strong> large bowel involvement. </strong>The identification&nbsp;of a collapsed distal segment of the large bowel and its sequential proximal assessment will lead to the identification of the cause.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following types of renal cell carcinoma (RCC) has the worst prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "Clear cell"
      },
      {
        "id": 2,
        "text": "Papilllary"
      },
      {
        "id": 3,
        "text": "Chromophobe"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Collecting duct renal cell carcinoma </strong>has the <strong>worst </strong>prognosis of all renal cell carcinoma subtypes.</p>\n<p>The renal cell carcinoma subtypes with poor prognosis in descending order are:</p>\n<ul>\n<li>Collecting duct renal cell carcinoma</li>\n<li>Medullary renal cell carcinoma</li>\n<li><strong>Clear cell renal cell carcinoma</strong></li>\n</ul>\n<p><strong>Chromophobe</strong> renal cell carcinoma has the <strong>best</strong> prognosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common functioning tumor of the pituitary is _______",
    "choices": [
      {
        "id": 1,
        "text": "GH-secreting adenoma"
      },
      {
        "id": 2,
        "text": "ACTH-secreting adenoma"
      },
      {
        "id": 3,
        "text": "TSH-secreting adenoma"
      },
      {
        "id": 4,
        "text": "PRL-secreting adenoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>PRL-secreting adenoma or <strong>prolactinoma</strong> is the <strong>most common functioning tumor</strong> of the pituitary.</p>\n<p><strong>Increased prolactin</strong> levels cause&nbsp;<strong>irregular menstrual periods</strong>&nbsp;or no menstrual periods, <strong>milky&nbsp;discharge</strong>&nbsp;from the breasts when not pregnant or breast-feeding, <strong>painful intercourse</strong>&nbsp;due to&nbsp;<strong>vaginal dryness,&nbsp;</strong>acne, and excessive body and facial hair growth.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pathognomonic sign of dermatomyositis is",
    "choices": [
      {
        "id": 1,
        "text": "Gottron's papules"
      },
      {
        "id": 2,
        "text": "Poikiloderma"
      },
      {
        "id": 3,
        "text": "Mechanic's hand"
      },
      {
        "id": 4,
        "text": "Shawl sign"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Pathognomonic sign of <strong>dermatomyositis </strong>is&nbsp;<strong>Gottron's papules.</strong>&nbsp;They are erythematous to violaceous papules that occur symmetrically over extensor aspects of metacarpophalangeal and interphalangeal joints.</p>\n<p><strong>Gottron's sign</strong>, on the other hand, is erythematous rash over the extensor surfaces of joints such as the knuckles, elbows, knees, and ankles.&nbsp;</p>\n<p>Note-</p>\n<p><strong>Gottron's papules and heliotrope rash</strong> are both pathognomonic signs of dermatomyositis.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The wound in the given image is most likely to have been produced by?",
    "choices": [
      {
        "id": 1,
        "text": "Road traffic accident"
      },
      {
        "id": 2,
        "text": "Broom handle"
      },
      {
        "id": 3,
        "text": "Serrated knife"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>'tram-line' bruising</strong>, most likely to have been produced by a <strong>stick or a broom handle</strong>.&nbsp;</p>\n<p>Tram-line bruising:</p>\n<ul>\n<li>When the skin surface is struck by a rod or rectangular sectioned object such as a cane or lath, the consequent bruising may be of the <strong>&lsquo;tram-line&rsquo; or &lsquo;railway line&rsquo;</strong> type.</li>\n<li>The mechanism of this double line is that the weapon sinks into the skin on impact so that the edges drag the skin downwards and the traction tears the marginal blood vessels. The centre compresses the skin, which, in the absence of underlying bone, causes little or no damage to the vessels.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dde4f33312ea4709929cc8d600a4638a.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0994e7aaec1444cdb7f8125ec8427bdex600x439.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most common disease after a disaster?",
    "choices": [
      {
        "id": 1,
        "text": "Acute respiratory infections"
      },
      {
        "id": 2,
        "text": "Malaria"
      },
      {
        "id": 3,
        "text": "Dengue"
      },
      {
        "id": 4,
        "text": "Gastroenteritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Gastroenteritis </strong>is the most commonly reported disease after a disaster.&nbsp;</p>\n<p>It occurs due to <strong>contamination</strong> of water supply, damage to the sewerage system, overcrowding and poor sanitation. Therefore, supply of safe drinking water and proper disposal of excreta&nbsp;are the most practical and effective strategies of disease prevention in the post&ndash;disaster period.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The usage of iodized salt advocated by iodine deficiency control programmes in endemic areas is _______",
    "choices": [
      {
        "id": 1,
        "text": "Primordial prevention"
      },
      {
        "id": 2,
        "text": "Primary prevention"
      },
      {
        "id": 3,
        "text": "Secondary prevention"
      },
      {
        "id": 4,
        "text": "Tertiary prevention"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The usage of iodized salt in iodine deficiency advocated by iodine deficiency control programmes in endemic areas is part of <strong>primary prevention as it provides specific protection.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Tc HMPAO SPECT is used for:",
    "choices": [
      {
        "id": 1,
        "text": "Cerebral perfusion imaging"
      },
      {
        "id": 2,
        "text": "Renal imaging"
      },
      {
        "id": 3,
        "text": "Parathyroid imaging"
      },
      {
        "id": 4,
        "text": "Thyroid imaging"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Tc HMPAO SPECT is used for <strong>cerebral perfusion assessment</strong>. For example, in Alzheimer's it shows reduced perfusion of the temporoparietal region.</li>\n<li><strong>D-SPECT&nbsp;</strong>represents the next step in the evolution of SPECT technology and is based on a unique acquisition geometry. It has nine arrays of <strong>cadmium zinc telluride (CZT)</strong> detectors, each of which rotates around its central axis with programmable angular rotation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a barrier penetrated by the sperm in the ovum?",
    "choices": [
      {
        "id": 1,
        "text": "Corona radiata"
      },
      {
        "id": 2,
        "text": "Zona pellucida"
      },
      {
        "id": 3,
        "text": "Oocyte cell membrane"
      },
      {
        "id": 4,
        "text": "Nuclear membrane"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The sperm does not penetrate the nuclear membrane of the ooctye.</p>\n<p>The <strong>three barriers</strong>&nbsp;form <strong>sperm penetration</strong> in the ovum include:</p>\n<ul>\n<li><strong>Corona radiata</strong></li>\n<li><strong>Zona pellucida</strong></li>\n<li><strong>Oocyte cell membrane&nbsp;</strong></li>\n</ul>\n<p>After the fusion of the sperm and oocyte cell membranes, the nucleus of the ovum is converted to the female pronucleus, and the nucleus of the sperm becomes the male pronucleus.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has developed confusion and keeps bumping into objects. He can speak fluently. But on examination, he cannot differentiate between fingers and cannot write. He also gets confused with the examiner's right and left sides. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gerstmann syndrome"
      },
      {
        "id": 2,
        "text": "Anton syndrome"
      },
      {
        "id": 3,
        "text": "Millard Gubler syndrome"
      },
      {
        "id": 4,
        "text": "Dejerine Roussy syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis for this patient is<strong> Gerstmann syndrome</strong>.&nbsp;It is commonly associated with damage to the <strong>left (dominant) inferior parietal lobule</strong>.</p>\n<p>Gerstmann syndrome consists of:</p>\n<ul>\n<li><strong>Acalculia -&nbsp;</strong>impairment of simple arithmetic</li>\n<li><strong>Dysgraphia -&nbsp;</strong>impaired writing</li>\n<li><strong>Finger anomia -&nbsp;</strong>an inability to name individual fingers&nbsp;</li>\n<li><strong>Right-left confusion -&nbsp;</strong>an inability to tell whether a hand, foot, or arm of the patient or examiner is on the right or left side of the body</li>\n</ul>\n<p>Option B: Anton syndrome also known as <strong>visual anosognosia</strong> occurs due to bilateral infarction in the distal PCAs. It produces cortical blindness and the patients are unaware of the blindness or may even deny it.</p>\n<p>Option C: Millard-Gubler syndrome occurs due to ventral pontine injury. It&nbsp;causes functional loss of the <strong>6<sup>th</sup> and 7<sup>th</sup></strong> cranial nerves and <strong>corticospinal</strong> tract. This presents as diplopia, ipsilateral facial palsy, ipsilateral loss of corneal reflex, contralateral hemiparesis.</p>\n<p>Option D: Dejerine-Roussy syndrome<strong>&nbsp;</strong>is associated with<strong>&nbsp;</strong>hemisensory loss and severe burning pain in the affected region. It is also known as <strong>thalamic pain syndrome.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The parvocellular pathway from the lateral geniculate body (LGB) to the visual cortex carries signals for the detection of ______.",
    "choices": [
      {
        "id": 1,
        "text": "Movement, depth, and flicker"
      },
      {
        "id": 2,
        "text": "Colour vision, shape, and fine details"
      },
      {
        "id": 3,
        "text": "Temporal frequency"
      },
      {
        "id": 4,
        "text": "Luminance contrast"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Parvocellular pathway</strong></p>\n<ul>\n<li>From layers&nbsp;<strong>3, 4, 5, and 6</strong> of the&nbsp;lateral geniculate body (LGB)</li>\n<li>Gives signals for <strong>color</strong> vision<strong>, texture, shape,&nbsp;and fine </strong>details</li>\n<li>To layer 4 of the&nbsp;visual cortex</li>\n</ul>\n<p><strong>Magnocellular pathway</strong></p>\n<ul>\n<li>From layers <strong>1 and 2</strong> of LGB</li>\n<li>Gives signals for <strong>movement, depth, flicker,</strong>&nbsp;and&nbsp;<strong>spatial</strong> organization</li>\n<li>To layer 4 of the visual cortex</li>\n</ul>\n<p><strong>Interlaminar pathway </strong></p>\n<ul>\n<li>Gives signals for <strong>color</strong> vision to layers <strong>2 and 3</strong> of the visual cortex having <strong>clusters of cells</strong> called <strong>blobs</strong>.</li>\n</ul>\n<p><strong>Image</strong>: Visual representation of the parvocellular and magnocellular pathways&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44f408a7def44f8fb56fd4bfe0927121x666x386.PNG"
    ]
  },
  {
    "text": "The following x-ray was done on a patient with pulmonary tuberculosis. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Right upper lobe collapse"
      },
      {
        "id": 2,
        "text": "Left upper lobe collapse"
      },
      {
        "id": 3,
        "text": "Right lower lobe collapse"
      },
      {
        "id": 4,
        "text": "Left middle lobe collapse"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Golden&rsquo;s S-sign</strong> is seen on the given x-ray pointing to a diagnosis of <strong>right upper lobe collapse</strong>.&nbsp;</p>\n<p>X-ray showing Golden&rsquo;s S-sign and&nbsp;calcified breast implants.:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a0db090629804c78b007237f5e31150b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1430e2fc6ec94ec088c0534260a14729x657x598.PNG"
    ]
  },
  {
    "text": "All of the following enzymes are present in the mitochondrial matrix, except for ___________.",
    "choices": [
      {
        "id": 1,
        "text": "Citric acid cycle enzymes"
      },
      {
        "id": 2,
        "text": "\u03b2-oxidation enzymes"
      },
      {
        "id": 3,
        "text": "Pyruvate dehydrogenase"
      },
      {
        "id": 4,
        "text": "ATP synthase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>ATP synthase</strong> is located on the<strong> inner mitochondrial membrane.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca3ddc4f7f8446aaba7932a56fbc017dx1280x1590.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman is admitted to the hospital with a fever and cough. She has a history of repeated chest infections for several years and coughs up yellow-green purulent sputum with some streaky hemoptysis. What could be the underlying condition based on the CT given below?",
    "choices": [
      {
        "id": 1,
        "text": "Cystic fibrosis"
      },
      {
        "id": 2,
        "text": "Tuberculosis"
      },
      {
        "id": 3,
        "text": "Amyloidosis"
      },
      {
        "id": 4,
        "text": "Lung abscess"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the CT showing <strong>signet ring sign</strong> is suggestive of <strong>bronchiectasis</strong>&nbsp;which can be due to <strong>cystic fibrosis</strong>.</p>\n<p>A history of <strong>repeated chest infections</strong> is an indication of cystic fibrosis and a major risk factor for the development of bronchiectasis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ebde6c2ecb724a06aedd5c9c1dd40fca.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child in your unit is admitted with acute bronchiolitis. Which of the following is the most common etiological agent responsible for this condition during infancy?",
    "choices": [
      {
        "id": 1,
        "text": "Influenza virus"
      },
      {
        "id": 2,
        "text": "Para Influenza virus"
      },
      {
        "id": 3,
        "text": "Rhinovirus"
      },
      {
        "id": 4,
        "text": "Respiratory syncytial virus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Acute bronchiolitis is predominantly a <strong>viral</strong> disease in children <strong>younger than 2 years</strong>. <strong>Respiratory syncytial virus (RSV)</strong> is responsible for more than 50% of cases.</p>\n<p>Acute bronchiolitis refers to airway inflammation and obstruction of the lower respiratory tract. Commonly, symptoms of bronchiolitis begin with rhinitis or congestion and cough and may progress to signs of increasing respiratory distress (tachypnea, wheezing, and accessory muscle use). Management is mainly conservative.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs should not be continued on the day of surgery?",
    "choices": [
      {
        "id": 1,
        "text": "Asthma medications"
      },
      {
        "id": 2,
        "text": "Oral hypoglycemics"
      },
      {
        "id": 3,
        "text": "Anticonvulsants"
      },
      {
        "id": 4,
        "text": "Beta blockers"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Oral hypoglycemic agents</strong> are generally withheld on the day of surgery&nbsp;except for minor, short procedures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A doctor tells a 31-year-old woman, who is 20 weeks pregnant, that her baby has a developmental defect. She has come to you for a second opinion. The following USG finding is seen. Identify the defect.",
    "choices": [
      {
        "id": 1,
        "text": "Anencephaly"
      },
      {
        "id": 2,
        "text": "Omphalocele"
      },
      {
        "id": 3,
        "text": "Cystic hygroma"
      },
      {
        "id": 4,
        "text": "Encephalocele"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given ultrasound image shows an open defect in the calvaria and skin<strong>\u00a0</strong>leading to the <strong>exposure</strong> of the\u00a0<strong>cranial neural tube</strong>. This is consistent with the diagnosis of\u00a0<strong>anencephaly.\u00a0</strong></p>\n<p>Anencephaly\u00a0results from\u00a0<strong>incomplete closure</strong> of the<strong> neural tube.\u00a0</strong>It is one of the earliest detectable congenital defects that can be <strong>detected</strong> as early as <strong>10 to 11 weeks</strong> of gestation.\u00a0 Screening can also be done by serum estimation of\u00a0maternal serum alpha-fetoprotein<strong> (MSAFP).\u00a0</strong>The following are the radiological signs seen in anencephaly.\u00a0</p>\n<ul>\n<li><strong>Frog eye sign</strong>\u00a0- Absence of cranial calvaria, prominent orbits thereby resembling the face of a frog.\u00a0</li>\n<li><strong>Shower cap sign - </strong>The absence\u00a0of the cranium could lead to the protrusion of a disorganized mass of brain tissue. This resembles a\u00a0shower cap giving rise to\u00a0a characteristic triangular facial appearance.</li>\n</ul>\n<p>Neural-tube defects can be prevented with <strong>pre-conceptional</strong> supplementation of\u00a0<strong>folic acid.\u00a0</strong>A dose of 4 mg daily is recommended in subsequent pregnancies.\u00a0\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e11ac44ce47744fcb0143f960062c208.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a6093fd75bb44d8af17bbafadb4ec6ax510x739.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b977a6a87feb493d917eab3a06a51189x512x392.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0205246a80d84182a7f6f3d9a62cd4f0x512x167.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e3e6a1d4fe2e441aa76b127e5cbf6b70x720x509.JPEG"
    ]
  },
  {
    "text": "What does this barium swallow picture shows?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic aneurysm"
      },
      {
        "id": 2,
        "text": "Pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "Carotid body tumor"
      },
      {
        "id": 4,
        "text": "Esophageal carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This is a barium swallow showing a <strong>pharyngeal pouch.</strong></p>\n<p>Pharyngeal pouch or <strong>Zenker's diverticulum</strong> is a protrusion of the mucosa through <strong>Killian's dehiscence-</strong>&nbsp;a weak area of the <strong>posterior</strong> pharyngeal wall between the oblique fibers of the thyropharyngeus and the cricopharyngeus. It presents at around 60 years of age and is more common in men than women. The patients usually experience <strong>regurgitation</strong> of undigested food and recurrent cough. The diagnosis is usually made by a <strong>lateral barium swallow</strong> or by endoscopy.</p>\n<p>The treatment is either endoscopic or open surgery. The endoscopic treatment of Zenker's diverticulum is also called as the&nbsp;<strong>Dohlman technique.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7a68670fa8024b2b956acfc5d5ce1037.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old lady underwent copper-T IUCD insertion 2 months after the delivery of her baby.  A few weeks after the procedure, she presented with pain abdomen. The tail of the IUCD is not visible. Her radiograph is shown in the image below. The most appropriate step in the management of this patient is?",
    "choices": [
      {
        "id": 1,
        "text": "Removal using Shirodkar's hook"
      },
      {
        "id": 2,
        "text": "Removal by hysteroscopy"
      },
      {
        "id": 3,
        "text": "Removal by laparotomy"
      },
      {
        "id": 4,
        "text": "Wait for spontaneous expulsion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The given radiograph shows the IUCD outside the <strong>uterine cavity</strong>, most likely due to <strong>perforation.\u00a0</strong>The most appropriate step in the management of this patient is the<strong> removal of the IUCD </strong>by<strong> laparotomy.\u00a0</strong></p>\n<p class=\"p1\">The\u00a0tail of the IUCD is not visible when the<strong>\u00a0IUCD is misplaced. </strong>The reasons for misplaced IUCD include:</p>\n<ul>\n<li class=\"p1\">Enlargement of the uterus due to pregnancy</li>\n<li class=\"p1\">Curling of the threads inside the uterus</li>\n<li class=\"p1\">Perforation of the uterus</li>\n<li class=\"p1\">IUCD buried in the myometrium</li>\n<li class=\"p1\">Spontaneous expulsion</li>\n</ul>\n<p class=\"p1\">A <strong>plain X-ray</strong>\u00a0or\u00a0<strong>pelvic ultrasound</strong>\u00a0is used in the localization of the IUCD when the IUCD threads cannot be visualized.\u00a0In this patient, the misplaced IUCD is seen laterally displaced in the pelvic cavity. An <strong>abnormal location</strong> or abnormal shape of IUCD indicates likely <strong>perforation</strong> of the uterus.\u00a0</p>\n<p class=\"p1\"><strong>Perforation</strong> can occur either\u00a0at the time of insertion (immediate traumatic perforation) or\u00a0due to gradual erosion of the myometrium (secondary perforation). The <strong>risk factors</strong> for uterine perforation include:</p>\n<ul>\n<li class=\"p1\">Insertion by less experienced clinicians</li>\n<li class=\"p1\"><strong>Post-partum insertion</strong> (&lt;6 months since delivery)</li>\n<li class=\"p1\">A higher number of previous abortions</li>\n<li class=\"p1\">Lower parity</li>\n<li class=\"p1\">Lactation</li>\n</ul>\n<p>Management:</p>\n<p>If the location of the <strong>IUCD</strong> is <strong>inside</strong> the <strong>uterine cavity</strong>, it can be removed using <strong>Shirodkar's hook</strong> (Option A), a curette, or a <strong>hysteroscope</strong> (option B) and ultrasound guidance.</p>\n<p>In perforation of the uterus, a <strong>laparotomy</strong> is done as copper-T gets adhered to the omentum or gut and will be difficult to be removed using a laparoscope.</p>\n<p class=\"p1\">Other options:</p>\n<p class=\"p1\">Option A- <strong>Spontaneous expulsion</strong> is one of the reasons for misplaced IUCD. It is not a management approach. The factors that are associated with an increased risk of spontaneous expulsion of the IUCD are age<strong> &lt;20 years</strong> and <strong>nulliparity.</strong> Expulsion tends to occur at the time of menstruation and is associated with cramping, bleeding, and vaginal discharge.</p>\n<p class=\"p1\">Here the IUCD has caused perforation of the uterus and is lodged outside the uterus, hence,\u00a0<strong>spontaneous expulsion</strong> will <strong>not </strong>be <strong>possible.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/33a56736ee00412abc69285d9e167172.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which is the most common type of dislocation of the hip?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior dislocation"
      },
      {
        "id": 2,
        "text": "Anterior dislocation"
      },
      {
        "id": 3,
        "text": "Central dislocation"
      },
      {
        "id": 4,
        "text": "Medial dislocation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>posterior dislocation</strong> is the most common type of dislocation of hip.</p>\n<p><strong>&nbsp;</strong>There are three main types of dislocations of the hip:</p>\n<ul>\n<li>Posterior- It&nbsp;is seen in <strong>motor vehicle accidents</strong> where the flexed knee of the passenger hits the dashboard.&nbsp;</li>\n<li>Anterior-&nbsp;It is seen in high energy injuries. Eg. when the patient falls from the height.</li>\n<li>Central- It is&nbsp;seen when there is a blow over the greater trochanter or fall on the side.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a 7-year-old child with hearing loss and intellectual disability, you notice the following external ear anomaly. What could the anomaly in this case be?",
    "choices": [
      {
        "id": 1,
        "text": "Preauricular sinus"
      },
      {
        "id": 2,
        "text": "Preauricular tag"
      },
      {
        "id": 3,
        "text": "Ganglion"
      },
      {
        "id": 4,
        "text": "Neurodermatitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The external ear anomaly seen here is <strong>pre-auricular tag/appendage.&nbsp;</strong></p>\n<p>Pre-auricular tags/appendages are congenital external ear anomalies. They are seen as skin-covered pieces of <strong>cartilage</strong> anywhere between the&nbsp;<strong>tragus </strong>and the<strong> angle</strong> of the<strong> mouth</strong>.&nbsp;</p>\n<p>The clinical features of facial asymmetry,&nbsp;intellectual disability, limbal dermoid, and pre-auricular tags and&nbsp;mixed or conductive hearing loss point to a diagnosis of <strong>Goldenhar syndrome&nbsp;</strong>(oculoauriculovertebral spectrum). Clinical features include:</p>\n<div class=\"page\" title=\"Page 145\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<ol>\n<li>Hypoplasia of the malar, maxillary, and mandibular regions</li>\n<li>Macrostomia and microtia</li>\n<li>Preauricular and facial skin tags</li>\n<li>Hemivertebrae (usually cervical)</li>\n<li>Intellectual disability</li>\n<li>Cardiac, renal, and central nervous system (CNS) anomalies</li>\n<li>Ocular features- Limbal dermoids, upper lid notching or coloboma, microphthalmos, disc coloboma</li>\n</ol>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cccc7e3dc60b4062bc0dad7bcace0d25.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which drug should be withheld before a session of Electro convulsive Therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Succinylcholine"
      },
      {
        "id": 2,
        "text": "Desipramine"
      },
      {
        "id": 3,
        "text": "Lithium"
      },
      {
        "id": 4,
        "text": "Moclobemide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Lithium should be withheld before a session of ECT.&nbsp;<strong>Lithium</strong> combined with ECT has been shown to&nbsp;cause <strong>prolonged</strong>&nbsp;<strong>seizures</strong>(lasting more than 180 secs) and increased <strong>post ictal delirium</strong>. Doses are withheld for 24 hours prior to treatment, allowing for washout.</p>\n<p>Other medications to be withdrawn before ECT:</p>\n<ul>\n<li>Benzodiazepines&nbsp;</li>\n<li>Clozapine&nbsp;</li>\n<li>Buproprion&nbsp;</li>\n<li>Theophylline&nbsp;</li>\n<li>Reserpine &nbsp;</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the morphology of the lesion shown in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Macule"
      },
      {
        "id": 2,
        "text": "Lichenification"
      },
      {
        "id": 3,
        "text": "Scale"
      },
      {
        "id": 4,
        "text": "Crust"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows <strong>lichenification</strong>. Lichenification is a <strong>secondary skin lesion</strong> characterized by <strong>hyperpigmentation, thickening of the skin, and exaggerated skin markings.</strong> It is a feature of chronic eczema.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a35d8249c8de4eb48ca1d98a696cdb86.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In a boys hostel, there has been an outbreak of typhoid. The hostel cook is identified as the carrier of the disease. Which is true among the following statements regarding her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gallbladder is usually not involved in carrier state"
      },
      {
        "id": 2,
        "text": "Chronic carriers are those who excrete the bacilli for more than a year"
      },
      {
        "id": 3,
        "text": "Tetracycline is the drug of choice for carriers"
      },
      {
        "id": 4,
        "text": "To treat the carrier state, treatment should be given for 4 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Chronic</strong> carriers of typhoid are those who excrete the bacilli for <strong>more</strong> than a <strong>year.</strong></p>\n<p><strong>Convalescent</strong> carriers excrete bacilli for <strong>6-8 weeks</strong> and chronic carriers excrete for more than a year. The carrier rate in <strong>females</strong> is <strong>higher.</strong> Gallbladder and biliary tract are affected.&nbsp;</p>\n<p>To treat the carrier state, an intensive course of <strong>ampicillin or amoxicillin</strong> (4-6 g a day) together <strong>with Probenecid</strong> (2 g/day) for <strong>6 weeks</strong> is given. <strong>Cholecystectomy</strong> with concomitant ampicillin therapy is the most <strong>successful</strong> treatment for the carrier state.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "PCR is used to _____",
    "choices": [
      {
        "id": 1,
        "text": "Detect target plasmids"
      },
      {
        "id": 2,
        "text": "Amplify small amount of DNA"
      },
      {
        "id": 3,
        "text": "Seal the cut ends of DNA"
      },
      {
        "id": 4,
        "text": "Cleave the bacterial plasmid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>polymerase chain reaction (PCR)</strong> is a biochemical technology in molecular biology which is used for&nbsp;<strong>amplification</strong> of a single or a few copies of a piece of DNA, which leads to generation of&nbsp; thousands to millions of copies of a particular DNA sequence.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 018';
        const quizFilename = 'fmge-mini-test-018-50c66a82.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>