<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ophthalmology Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Test Series Subject / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A middle-aged woman presents to the clinic with significant astigmatism. The following finding is noted on closer examination. What is the ideal course of management?",
    "choices": [
      {
        "id": 1,
        "text": "Keratoplasty"
      },
      {
        "id": 2,
        "text": "Excision with conjunctival autograft"
      },
      {
        "id": 3,
        "text": "Observation"
      },
      {
        "id": 4,
        "text": "Topical corticosteroids"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a patient with a progressive pterygium causing astigmatism,<strong> excision </strong>of the<strong> pterygium </strong>along with<strong> conjunctival autograft</strong> is the preferred management.</p>\n<p>Pterygium is a <strong>wing-shaped</strong> fold of the conjunctiva extending into the cornea. It is commonly seen in people who live in hot climates and in those who work outdoors.</p>\n<p>Clinically the patient may present with symptoms such as:&nbsp;</p>\n<ul>\n<li>Cosmetic complaints</li>\n<li>Foreign body sensation and irritation</li>\n<li>Defective vision/<strong>astigmatism</strong> when the pterygium extends into the pupillary area</li>\n<li>Diplopia</li>\n</ul>\n<p>Medical management includes tear substitutes, topical corticosteroids, and sunglasses. <strong>Surgical</strong> management is preferred in patients with significant cosmetic defects, <strong>visual impairment</strong>, and other such complications.</p>\n<p><strong>Surgical excision </strong>with<strong> free conjunctival limbal autograft</strong> is the preferred technique for most pterygiums. In case of recurrent or large pterygium, surgical excision with amniotic membrane graft and mitomycin C is preferred.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b7de3cdeb6d487d8095423c9479964c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An 8-year old child presented with right-sided proptosis. Biopsy of the orbital mass was done and histopathological examination revealed this picture. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Retinoblastoma"
      },
      {
        "id": 2,
        "text": "Metastases from neuroblastoma"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Capillary hemangioma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis is <strong>Rhabdomyosarcoma</strong>.</p>\n<p>The older age of the child presenting with proptosis suggests<strong> Rhabdomyosarcoma (average age 7 to 8 years)</strong> than Retinoblastoma (average age at presentation is <strong>18 months</strong>).</p>\n<p>The histopathology shows <strong>elongated to round spindle cells</strong> with features of skeletal muscle in different stages of embryogenesis with a highly eosinophilic cytoplasm and hyperchromatic nuclei &ndash; the embryonal type of RMS</p>\n<p>Rhabdomyosarcoma is classified into <strong>4 major subtypes</strong></p>\n<ol>\n<ol>\n<li style=\"font-weight: 400;\"><strong>Embryonal</strong>: Makes up 80% of orbital rhabdomyosarcomas and presents most commonly in young children (mean age 7-8)</li>\n<li style=\"font-weight: 400;\"><strong>Alveolar</strong> subtype exhibits small, round, densely appearing cells that are loosely arranged, with septae that are similar to the alveoli of the lung; carries the worst prognosis</li>\n<li style=\"font-weight: 400;\"><strong>Botryoid</strong> - variant of embryonal rhabdomyosarcoma; subepithelial grape-like aggregates of tumor cells; seen most commonly in infants.</li>\n<li style=\"font-weight: 400;\"><strong>Pleomorphic</strong></li>\n</ol>\n</ol>\n<p><strong>Immunohistochemistry</strong> is useful in identifying skeletal muscle proteins, such as alpha-actin, myosin, desmin and myoglobin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/471139d293eb4aa28e8d1302ed85eec1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old female patient came with complaints of floaters and blurring of vision in both eyes for a few weeks.  Fundoscopic examination shows inferior snow banking.  What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior uveitis"
      },
      {
        "id": 2,
        "text": "Intermediate uveitis"
      },
      {
        "id": 3,
        "text": "Posterior uveitis"
      },
      {
        "id": 4,
        "text": "Fuchs' uveitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of a <strong>young female</strong> presenting with<strong> floaters</strong>,<strong> blurring of vision,</strong> and fundoscopy showing\u00a0<strong>snow banking</strong> is suggestive of\u00a0<strong>intermediate uveitis\u00a0</strong>or\u00a0<strong>pars planitis</strong></p>\n<p>Intermediate uveitis is the inflammation involving pars plana ciliaris, peripheral retina, choroid, and vitreous base. It is predominantly seen in young females and most often presents with floaters and bilateral blurring of vision.</p>\n<p><strong>Snow banking</strong>\u00a0is the <strong>hallmark</strong> of <strong>intermediate uveitis</strong>.\u00a0It refers to <strong>greyish white fibrovascular plaques</strong> over the <strong>pars plana,</strong> with or without peripheral retinal <strong>periphlebitis</strong>. This occurs due to the coalescence of snowball opacities.</p>\n<p>Other Signs of intermediate uveitis:</p>\n<ul>\n<li><strong>Snow-ball opacities</strong> (Ant\u2019s egg opacities)-\u00a0typical <strong>exudates present</strong> near the ora Serrata in the\u00a0<strong>inferior</strong> quadrant</li>\n<li>Few keratic precipitates (KP) due to spillover anterior uveitis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ddc8ec276b234756b500381d3f1fb7b0x600x1258.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2fa799d1514d42eb8cc4d0cf182e8df7x1280x1113.JPEG"
    ]
  },
  {
    "text": "A 20-year-old man with a history of repeated pain over the medial canthus and chronic use of nasal decongestants presents to the outpatient department with high-grade fever and chills, headache, and bilateral proptosis. On eliciting further history, it is brought to light that the proptosis began in the right eye, and a few days later, the left eye was also affected. Which of the following is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Orbital cellulitis"
      },
      {
        "id": 2,
        "text": "Cavernous sinus thrombosis"
      },
      {
        "id": 3,
        "text": "Panophthalmitis"
      },
      {
        "id": 4,
        "text": "Caroticocavernous fistula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>Pain over the medial canthus and use of nasal decongestants indicate that the patient was suffering from <strong>sinusitis</strong>,&nbsp;which can spread to cause any of the options, i.e., orbital cellulitis, cavernous sinus thrombosis, or panopthalmitis.</li>\n<li>The differentiating feature here is the presentation&nbsp;<strong>pattern</strong> and <strong>bilaterality of the proptosis.</strong></li>\n<li><strong>In cavernous sinus thrombosis</strong>, proptosis is <strong>initially unilateral but soon becomes bilateral</strong> due to the spread of infection to the contralateral sinus through the intercavernous communication. Also, cavernous sinus thrombosis presents with <strong>high-grade fever with chills, rigor,&nbsp;and headache</strong>.</li>\n<li>On the other hand,&nbsp;<strong>orbital cellulitis and panophthalmitis</strong> are <strong>unilateral</strong> conditions.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is defined as loss of eyelashes?",
    "choices": [
      {
        "id": 1,
        "text": "Tylosis"
      },
      {
        "id": 2,
        "text": "Madarosis"
      },
      {
        "id": 3,
        "text": "Trichiasis"
      },
      {
        "id": 4,
        "text": "Distichiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Madarosis</strong> is the&nbsp;<strong>loss</strong> of <strong>eyelashes or eyebrows</strong>.</p>\n<ul>\n<li>Loss of <strong>eyebrows</strong> is seen in <strong>leprosy</strong> and <strong>myxedema</strong>.</li>\n<li>Loss of <strong>eyelashes</strong> is seen in <strong>chronic</strong> <strong>blepharitis.</strong></li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3c939b4b4e34b1aadee507efae30595x462x350.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c45b5e6ff8b94be8ab2ffb19a05a6315x483x572.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e98883c42c44cdd92dabb3ce9d76c28x462x386.PNG"
    ]
  },
  {
    "text": "Keratometer is used to assess:",
    "choices": [
      {
        "id": 1,
        "text": "Corneal curvature"
      },
      {
        "id": 2,
        "text": "Corneal thickness"
      },
      {
        "id": 3,
        "text": "Angle of the\u00a0anterior chamber"
      },
      {
        "id": 4,
        "text": "Corneal endothelium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Keratometer</strong> is used to assess <strong>corneal curvature</strong>.</p>\n<p>A&nbsp;keratometer (ophthalmometer)&nbsp;measures the <strong>curvature</strong> of the <strong>anterior surface of the cornea</strong> at two points about 1.25 mm on either side of its center.&nbsp;The image given below shows keratometer:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bf11c6025e7447cea716ff1a343ed8c3x1024x802.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dc58e789a4a74f7d8eca76da9fe17691x720x364.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8144ad1142754417a3de4ba9e3b36bdbx720x504.JPEG"
    ]
  },
  {
    "text": "The following type of vision loss is commonly seen in ______.",
    "choices": [
      {
        "id": 1,
        "text": "Methanol amblyopia"
      },
      {
        "id": 2,
        "text": "Anterior ischemic optic neuropathy (AION)"
      },
      {
        "id": 3,
        "text": "Suprasellar tumor"
      },
      {
        "id": 4,
        "text": "Lesions to occipital cortex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image depicts <strong>altitudinal hemianopia,&nbsp;</strong>which is <strong>most commonly seen</strong> in anterior ischemic optic neuropathy (<strong>AION</strong>).</p>\n<p><strong>Anterior ischemic optic neuropathy (AION)</strong></p>\n<p>The two types are as follows:</p>\n<ul>\n<li><strong>Arteritic AION</strong>:&nbsp;caused by <strong>Giant-cell arteritis</strong></li>\n<li>Non-arteritic AION (NAAION):<strong>&nbsp;most common</strong></li>\n</ul>\n<p>Clinical features:</p>\n<table>\n<tbody>\n<tr>\n<td>\n<p><strong>Features</strong></p>\n</td>\n<td>\n<p><strong>AAION</strong></p>\n</td>\n<td>\n<p><strong>NAAION</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>Age</strong></p>\n</td>\n<td>\n<p>&gt;70 years</p>\n</td>\n<td>\n<p>&lt;70 years</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>Sex</strong></p>\n</td>\n<td>\n<p>F &gt; M</p>\n</td>\n<td>\n<p>F = M</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>Headache</strong></p>\n<p><strong>Jaw claudication</strong></p>\n</td>\n<td>\n<p>Present</p>\n</td>\n<td>\n<p>Absent</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>Visual loss</strong></p>\n</td>\n<td>\n<p>Marked</p>\n</td>\n<td>\n<p>Less marked</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>Optic disc</strong></p>\n</td>\n<td>\n<p>Pale disc edema</p>\n</td>\n<td>\n<p>Hyperemic disc edema</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>C reactive proteins</strong></p>\n</td>\n<td>\n<p>Raised</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>ESR</strong></p>\n</td>\n<td>\n<p>Highly raised</p>\n</td>\n<td>\n<p>Raised</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>FFA</strong></p>\n</td>\n<td>\n<p>Disc Delay and</p>\n<p>Choroidal delay</p>\n</td>\n<td>\n<p>Only disc delay</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>Treatment</strong></p>\n</td>\n<td>\n<p>Corticosteroids</p>\n</td>\n<td>\n<p>Levodopa&ndash;carbidopa combination for 3 weeks and then double dose for 1 month</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/09a4f7212d614de1a04de714090ef810.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9f53f3f8209b4186a93e1059ebac32e3x616x421.PNG"
    ]
  },
  {
    "text": "A 5-year-old female patient presented for her first complete eye examination after a school vision screening found unequal visual acuity. Her parents have not noted any eye problems. Visual acuity in the right eye was 20/20 and the left eye is 20/80. The rest of the examination including Fundus exam was unremarkable, What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Brain lesion"
      },
      {
        "id": 2,
        "text": "Retinoblastoma"
      },
      {
        "id": 3,
        "text": "Congenital cataract"
      },
      {
        "id": 4,
        "text": "Amblyopia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most probable diagnosis from the given scenario is<strong> Amblyopia.</strong></p>\n<p><strong>Amblyopia</strong> is an uncorrectable decrease in vision in one or both eyes with no apparent structural abnormality seen to explain it. It is a diagnosis of exclusion. Generally, a difference of two lines or more on an eye chart test of visual acuity between the two eyes or a best-corrected vision of 20/30 or worse would be defined as amblyopia. For example, our patient has 20/20 vision with the right eye and only 20/80 with the left and the left eye even after best-corrected vision couldn't achieve &lt;20/30 vision, the left eye is said to be amblyopic.</p>\n<p><strong>Clinical features:</strong></p>\n<ul>\n<li>Decreased contrast sensitivity</li>\n<li>Diminution of vision</li>\n<li>Sunglass effect- brightness is less compared to the normal eye</li>\n<li>Crowding phenomenon- slipping of images</li>\n</ul>\n<p><strong>Treatment of choice:</strong></p>\n<ul>\n<li><strong>Occlusion</strong> of the<strong> normal eye</strong> (4 to 6 hours/day) using patches.</li>\n<li><strong>Penalization:&nbsp;</strong>Blurring of vision using<strong> atropine.</strong></li>\n</ul>\n<p>Prism correction is not the right treatment as the child doesn't have strabismus.</p>\n<p>&nbsp;</p>\n<p>Other options:</p>\n<p>Option A: Brain lesion does not cause difference in visual acuity in both eyes.</p>\n<p>Option B: Retinoblastoma can be identified by fundoscopy.</p>\n<p>Option C: Congenital cataract presents with loss of red reflex immediately after birth.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old woman came with complaints of a gritty sensation in her eyes. On examination, Rose Bengal staining is positive. She is diagnosed with keratoconjunctivitis sicca. Which of the following layer of the tear film is deficient in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Aqueous layer"
      },
      {
        "id": 2,
        "text": "Lipid layer"
      },
      {
        "id": 3,
        "text": "Mucin layer"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Keratoconjunctivitis sicca</strong> is due to the deficiency of the&nbsp;<strong>aqueous layer</strong> of the tear film.</p>\n<p>Causes of keratoconjunctivitis sicca:</p>\n<ul>\n<li><strong>Sjogren's syndrome</strong> (primary keratoconjunctivitis sicca)</li>\n<li>Non-Sjogren's&nbsp;keratoconjunctivitis sicca\n<ul>\n<li><strong>Primary age-related hyposecretion</strong> (most common)</li>\n<li>Lacrimal gland deficiencies- congenital, infiltration by tumors or sarcoidosis, surgical removal</li>\n<li>Lacrimal gland duct obstruction- old trachoma, burns,&nbsp; SJS</li>\n<li>Reflex hyposecretion (neurogenic causes)- Parkinson disease, 7th nerve palsy, reflex sensory block</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "'A' scan is used for all of the following except ______.",
    "choices": [
      {
        "id": 1,
        "text": "IOL power calculation"
      },
      {
        "id": 2,
        "text": "Anterior chamber depth"
      },
      {
        "id": 3,
        "text": "Thickness of intra ocular mass"
      },
      {
        "id": 4,
        "text": "Assessment of posterior segment in vitreous hemorrhage"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li>Assessment of the posterior segment in vitreous hemorrhage is done by \"B\" scan.</li>\n<li>Both 'A' and 'B' scans are types of ultrasound (USG) scans.</li>\n<li><strong>Uses of \"A\" scan</strong>\n<ul>\n<li>Axial length</li>\n<li>Intraocular lens (IOL) power calculation: Biometry</li>\n<li>Anterior chamber depth</li>\n<li>Thickness of intraocular mass</li>\n</ul>\n</li>\n<li><strong>Uses of B scan</strong>\n<ul>\n<li>Assessment of the posterior segment in opaque media</li>\n<li>Study of intraocular tumors</li>\n<li>Localization of intraocular and intra-orbital foreign bodies</li>\n</ul>\n</li>\n</ul>\n<p>Images: (Top): \"A\" scan ultrasound amplitude spikes</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (Bottom): Normal \"B\" scan of the eye</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de48c6e43be04fe293d17dad28c5ca1bx250x186.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73814f4365974652a1e4918aa98245b0x240x178.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man presents to the casualty with a sudden loss of vision and painful ocular movements. On examination of the affected eye, a relative afferent pupillary defect with a normal optic disc is seen. Visual field testing was done which revealed central scotoma in the same eye. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Optic nerve glioma"
      },
      {
        "id": 2,
        "text": "Optic neuritis"
      },
      {
        "id": 3,
        "text": "Eale\u2019s disease"
      },
      {
        "id": 4,
        "text": "Neuroretinitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a sudden painful loss of vision in the absence of fundoscopic changes, RAPD and central scotoma is suggestive of<strong>&nbsp;optic neuritis,&nbsp;</strong>specifically retrobulbar neuritis.&nbsp;</p>\n<p>There are 3 types of optic neuritis: papillitis, neuroretinitis, and retrobulbar neuritis. The common causes of retrobulbar neuritis include demyelinating disorders such as <strong>multiple sclerosis</strong>&nbsp;(MS) and <strong>neuromyelitis optica</strong> (NMO or Devic's disease).</p>\n<p>Clinically, optic neuritis is characterized by sudden, progressive visual loss.&nbsp; Ocular movements are <strong>painful</strong> in <strong>retrobulbar neuritis</strong> and painless in papillitis and neuroretinitis. Glowing sensations known as <strong>phosphenes</strong> may be induced with sound or movement. Color vision may also be impaired.&nbsp;</p>\n<p>On examination, Marcus Gunn pupil or relative afferent pupillary defect <strong>(</strong><strong>RAPD) </strong>is usually noted due to asymmetric involvement. The most common visual field defect is a <strong>central </strong>or<strong> centrocecal scotoma</strong>.&nbsp;</p>\n<table style=\"height: 180px;\" width=\"570\">\n<tbody>\n<tr>\n<td style=\"width: 182.667px;\">Type</td>\n<td style=\"width: 182.667px;\"><strong>Retrobulbar neuritis</strong></td>\n<td style=\"width: 182.667px;\"><strong>Papillitis</strong></td>\n<td style=\"width: 182.667px;\"><strong>Neuroretinitis</strong></td>\n</tr>\n<tr>\n<td style=\"width: 182.667px;\">Pathology</td>\n<td style=\"width: 182.667px;\">Inflammation of the optic nerve behind the disc</td>\n<td style=\"width: 182.667px;\">Inflammation of the optic nerve head&nbsp;</td>\n<td style=\"width: 182.667px;\">Inflammation of the optic nerve head and the macula</td>\n</tr>\n<tr>\n<td style=\"width: 182.667px;\">Fundus appearance</td>\n<td style=\"width: 182.667px;\">Optic disc appears normal</td>\n<td style=\"width: 182.667px;\">\n<p>Hyperemia and oedema of the optic disc with or without&nbsp;peri-papillary flame-shaped hemorrhages</p>\n</td>\n<td style=\"width: 182.667px;\">Macular star (due to exudates that form around macula)</td>\n</tr>\n<tr>\n<td style=\"width: 182.667px;\">Prevalence</td>\n<td style=\"width: 182.667px;\">Most common in adults</td>\n<td style=\"width: 182.667px;\">\n<p>Most common in children</p>\n</td>\n<td style=\"width: 182.667px;\">Least common type</td>\n</tr>\n<tr>\n<td style=\"width: 182.667px;\">Associated conditions</td>\n<td style=\"width: 182.667px;\">Strong association with demyelinating disorders like MS, NMO</td>\n<td style=\"width: 182.667px;\">\n<p>Weak association with demyelinating disorders</p>\n</td>\n<td style=\"width: 182.667px;\">Cat-scratch disease, Lyme disease, Syphilis etc.</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>The image below shows <strong>papillitis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29391d1eb10348b0a7fd4b78579fe69cx512x389.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bbee13f5cbb4361921cf13758fe28b9x606x603.PNG"
    ]
  },
  {
    "text": "A 56-year-old diabetic is  having double vision with downward gaze .  She has no other complaints. What could be the reason for the symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Trigeminal nerve palsy"
      },
      {
        "id": 2,
        "text": "Oculomotor nerve palsy"
      },
      {
        "id": 3,
        "text": "Trochlear nerve palsy"
      },
      {
        "id": 4,
        "text": "Abducent nerve palsy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario suggests&nbsp;<strong>trochlear nerve palsy</strong>.</p>\n<p>In <strong>4<sup>th</sup> nerve palsy</strong>, the <strong>superior oblique</strong> is affected, causing:</p>\n<ul>\n<li>The weakness of <strong>depression in eye:</strong> Mainly seen when the eye is adducted (depression during abducted position is a function of Inferior rectus)</li>\n<li>Weakness of <strong>abduction in eye</strong></li>\n<li>Failure of<strong> intorsion:</strong> Cause of diplopia</li>\n</ul>\n<p>The main actions of the superior oblique are intorsion (incyclotorsion), and depression in adduction.</p>\n<p>Hence, the patient will have difficulty in looking <strong>downwards</strong> when the eyes are in an <strong>adducted</strong> position. Diabetes, hypertension, and atherosclerosis affect the vasa nervosum of the cranial nerves leading to ischemia of the nerves. It results in paralysis.</p>\n<p><strong>Other options:</strong></p>\n<p>Option B:<strong> In 3<sup>rd</sup> nerve palsy </strong>(<strong>oculomotor nerve</strong>) - Due to the involvement of the superior rectus and medial rectus, elevation and adduction will also be impaired, which is not the case here.</p>\n<p>Option D: <strong>In 6<sup>th</sup> nerve palsy </strong>(<strong>abducens nerve) -&nbsp;</strong>Due to the involvement of only the lateral rectus, abduction will be impaired and not depression.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An industrial worker was admitted to the hospital after an eye injury sustained while cutting stone with a hammer and iron chisel. A foreign body was suspected to be impacted in his eye. Which of the following is the best investigation for foreign body localization?",
    "choices": [
      {
        "id": 1,
        "text": "MRI"
      },
      {
        "id": 2,
        "text": "CT"
      },
      {
        "id": 3,
        "text": "X-ray"
      },
      {
        "id": 4,
        "text": "B mode scan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>CT scan</strong> is the best method for&nbsp;<strong>intraocular foreign body (IOFB)</strong>&nbsp;localization.</p>\n<p>The foreign bodies most likely to penetrate and be retained in the eye are minute chips of iron or steel. While chipping stone with an iron chisel, the chip of the iron chisel is more likely to enter the eye than the stone. A foreign body entering the eye may cause damage by:</p>\n<ul>\n<li>mechanical effects</li>\n<li>introduction of infection</li>\n<li>reacting with the intraocular tissues</li>\n</ul>\n<p><strong>Anteroposterior</strong> and <strong>lateral</strong> view <strong>X-rays</strong> are recommended for locating an IOFB as most foreign bodies are <strong>radio-opaque</strong>. <strong>Ultrasonographic</strong> localization can tell the position of even <strong>non-radiopaque</strong> foreign bodies. <strong>CT scan</strong> is the <strong>best</strong> method of IOFB localization.</p>\n<p>MRI is contraindicated for metallic IOFB.<strong>MRI</strong> can be <strong>detrimental</strong>&nbsp;for a patient with a history of an <strong>intraocular foreign body (IOFB)</strong> after cutting stone with a hammer and chisel. It can cause further damage by producing movements of the foreign body if it is magnetic. The use of&nbsp;<strong>MRI</strong>&nbsp;is <strong>contraindicated</strong> for metallic (iron) foreign bodies and is not recommended as a screening procedure.</p>\n<p>Management: A foreign body should always be removed <strong>unless</strong>:</p>\n<ul>\n<li>it is inert and probably sterile</li>\n<li>little damage has been done to vision&nbsp;</li>\n<li>the process of removal will destroy sight</li>\n</ul>\n<p>&nbsp;</p>\n<p><strong>Siderosis bulbi</strong> refers to the ocular <strong>degenerative</strong> changes produced by an iron foreign body. It usually occurs <strong>2 months to 2 years</strong> after the injury.&nbsp;This condition is due to the <strong>electrolytic dissociation</strong> of the metal by an intrinsic resting current in the eye which disseminates the metal, combining it with cellular proteins and cause atrophy.</p>\n<p>Clinical features:</p>\n<ul>\n<li>Iris: first stained greenish and later turns reddish-brown, causing <strong>heterochromia iridis.</strong></li>\n<li>Pupil: iron deposition in sphincter leads to <strong>mydriasis</strong>.</li>\n<li>Lens: iron deposition in a radial fashion on the anterior capsule of the lens, leading to <strong>anterior capsular cataract.</strong></li>\n<li>Retina: <strong>pigmentary retinopathy</strong>; followed by atrophy of the retina and retinal pigmentary epithelium.</li>\n<li><strong>Secondary open-angle Glaucoma</strong>: due to damage to the trabecular meshwork.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old man presented with the following lesion in his eye. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bitot's spots"
      },
      {
        "id": 2,
        "text": "Pterygium"
      },
      {
        "id": 3,
        "text": "Phlyctenular conjunctivitis"
      },
      {
        "id": 4,
        "text": "Membranous conjunctivitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts <strong>Bitot's spot</strong>,<strong>&nbsp;</strong>a pathognomonic feature of <strong>xerophthalmia</strong>. Hence, the likely diagnosis in this patient presenting with the above lesion is<strong> xerophthalmia.</strong></p>\n<p>Bitot's spot is a t<strong>riangular, silvery-white, foamy patch</strong> on the bulbar conjunctiva which is usually bilateral. The most common site is&nbsp;<strong>t</strong><strong>emporal.</strong></p>\n<p>Ocular manifestations&nbsp;of <strong>vitamin A deficiency</strong> include loss of sensitivity to green light (earliest to appear), nyctalopia (night blindness), and <strong>xerophthalmia</strong>.</p>\n<p><strong>Xerophthalmia</strong>&nbsp;includes conjunctival xerosis (dryness) with<strong> Bitot&rsquo;s spots</strong> (white patches of keratinized epithelium appearing on the sclera), corneal ulcers, and<strong>&nbsp;keratomalacia</strong>&nbsp;(softening of the cornea) that leads to corneal scarring and ultimately,&nbsp;<strong>blindness.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d41209b4ea284a9286fd85ce1b43ad1f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which is the most common epithelial lacrimal gland tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Adenoid cystic carcinoma"
      },
      {
        "id": 2,
        "text": "Pleomorphic adenoma"
      },
      {
        "id": 3,
        "text": "Mucoepidermoid carcinoma"
      },
      {
        "id": 4,
        "text": "Malignant mixed tumor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Pleomorphic adenoma is the most common epithelial lacrimal gland tumor.</p>\n<p>The most common <strong>epithelial tumors</strong>, in order of frequency, are as follows:</p>\n<ul>\n<li>Benign mixed tumor (BMT), also known as&nbsp;<strong>pleomorphic adenoma</strong> (PA)</li>\n<li>Adenoid cystic carcinoma (ACC)</li>\n<li>Pleomorphic adenocarcinoma (ACA)</li>\n<li>Mucoepidermoid carcinoma</li>\n</ul>\n<p>&nbsp;Most Commons:</p>\n<p>Most common tumor of lacrimal gland: Pleomorphic adenoma</p>\n<p>Most common epithelial tumor of lacrimal gland: Pleomorphic adenoma</p>\n<p>Most common malignant epithelial tumor of lacrimal gland: Adenoid cystic carcinoma</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the angle at which the letters in Snellen\u2019s chart subtend on the nodal point of eye?",
    "choices": [
      {
        "id": 1,
        "text": "5 degree"
      },
      {
        "id": 2,
        "text": "5 min"
      },
      {
        "id": 3,
        "text": "15 degree"
      },
      {
        "id": 4,
        "text": "15 min"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>At the given distance, <strong>each letter subtends an angle of 5 min at the nodal point of the eye</strong></p>\n<p>Snellen&rsquo;s chart is used for <strong>distant vision</strong>.</p>\n<p>Patient should read the chart at a <strong>distance of 6 m</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5626d6025abb4d8da6f8e21901e25ec3x1200x2303.JPEG"
    ]
  },
  {
    "text": "All of the following are true about the instrument shown in the image given below except-",
    "choices": [
      {
        "id": 1,
        "text": "It is used for the localization of a foreign body."
      },
      {
        "id": 2,
        "text": "It is used for the measurement of the angle of the posterior chamber."
      },
      {
        "id": 3,
        "text": "It is used for the demonstration of the extent of peripheral anterior synechiae."
      },
      {
        "id": 4,
        "text": "It provides a mirror image of the opposite angle."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given instrument is an indirect&nbsp;<strong>gonioscope,</strong> which is used to&nbsp;<strong>visualize the angle of the&nbsp;anterior chamber, i.e., for gonioscopy, </strong>and<strong> not</strong>&nbsp;the<strong>&nbsp;angle of the posterior chamber.</strong></p>\n<p><strong>Types:</strong></p>\n<ul>\n<li><strong>Indirect</strong> <strong>gonioprism-</strong>&nbsp;provides<strong> mirror</strong> image of the&nbsp;<strong>opposite angle.</strong></li>\n<li><strong>Direct</strong> <strong>goniolens-</strong>&nbsp;provides<strong>&nbsp;a&nbsp;direct view </strong>of the<strong> angle</strong></li>\n</ul>\n<p><strong>Application:</strong></p>\n<ul>\n<li>To view the angle of the&nbsp;anterior chamber</li>\n<li>Localization of the foreign body, abnormal blood vessels, or tumors in the angle</li>\n<li>Demonstration of the&nbsp;extent of peripheral anterior synechiae</li>\n<li>Direct goniolens can be used during goniotomy</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7af42b94959b457c898423abf60d824b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The  visual field defect usually found in craniopharyngioma is?",
    "choices": [
      {
        "id": 1,
        "text": "Bitemporal hemianopia"
      },
      {
        "id": 2,
        "text": "Binasal hemianopia"
      },
      {
        "id": 3,
        "text": "Superior quadrantopia"
      },
      {
        "id": 4,
        "text": "Inferior quadrantopia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The visual field defect usually found in craniopharyngioma is <strong>bitemporal</strong> <strong>hemianopia</strong>.</p>\n<p>Craniopharyngiomas are&nbsp;benign masses&nbsp;usually presenting in the&nbsp;suprasellar region&nbsp;arising near the pituitary stalk and can produce&nbsp;<strong>functional impairment</strong>&nbsp;of the hypophysis due to&nbsp;<strong>mass effect</strong>. The clinical features of craniopharyngiomas include headaches,visual field defects,growth failure and delayed sexual maturation due to pituitary hypofunction. CT scan may show calcifications in the supra-sellar region. Treatment includes trans-sphenoidal resection of the tumour followed by adjuvant chemotherapy.</p>\n<p>Lesions of the optic <strong>chiasma</strong> can cause <strong>bitemporal</strong> <strong>hemianopia</strong>.i.e, loss of vision in the temporal halves of both visual fields. Nasal fibers of each retina cross through the chiasma at this level and hence, these fibers are compromised.</p>\n<p>Other causes of chiasmal lesions are</p>\n<ul>\n<li aria-level=\"1\">Pituitary adenoma (most common)</li>\n<li aria-level=\"1\">Aneurysm of the anterior communicating artery</li>\n<li aria-level=\"1\">Meningioma</li>\n<li aria-level=\"1\">Glioma</li>\n</ul>\n<p>Other options:</p>\n<p>Option B) <strong>Binasal</strong> <strong>hemianopia</strong> is a rare visual field defect also caused due to lesions at the optic chiasma. &nbsp;</p>\n<p>Option C) <strong>Superior</strong> <strong>quadrantopia</strong> is also known as pie in the sky defect and is caused when lesions affect the inferior fibres of the optic radiations in the temporal lobe. &nbsp;</p>\n<p>Option D)<strong>Inferior quadrantopia</strong>&nbsp;is also known as pie on the floor defect and is caused due to lesions affecting the superior fibres of the optic radiations in the parietal lobe. &nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient's eye was hit by a tennis ball and developed Hyphema. What is the likely source of bleeding ?",
    "choices": [
      {
        "id": 1,
        "text": "Circulus arteriosus major"
      },
      {
        "id": 2,
        "text": "Anterior ciliary artery"
      },
      {
        "id": 3,
        "text": "Posterior Ciliary artery"
      },
      {
        "id": 4,
        "text": "Circulus arteriosus minor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Circulus arteriosus major</strong> is responsible for Hyphaema (blood in the anterior chamber).</p>\n<p><strong>Hyphaema:</strong></p>\n<p><strong>Causes of Hyphaema:</strong></p>\n<ul>\n<li>Ocular injuries</li>\n<li>Postoperative</li>\n<li>Herpes zoster iritis</li>\n<li>Gonococcal iritis</li>\n<li>Intraocular tumor</li>\n<li>Spontaneous (from rubeosis iridis)</li>\n</ul>\n<p><strong>Two-way irrigation and aspiration cannula can be used for aspirating hyphaema</strong>.</p>\n<p><strong>Blood Supply of Eye:</strong></p>\n<p><strong>Cornea:&nbsp;</strong>Avascular</p>\n<p><strong>Uvea:&nbsp;</strong>3 arteries are important.</p>\n<ul>\n<li>Short post ciliary artery- Choroid</li>\n<li>Long post ciliary artery-2 in number join each other near ciliary muscle with anterior ciliary arteries to form circulus arteriolar major (C A major).</li>\n<li>Short anterior ciliary arteries join long posterior ciliary arteries to form C A major.</li>\n<li>Branches from circulus arteriolar major go to the pupillary border to form <strong>circulus arteriosus minor(C A minor)</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/681fb24ad00746be8f78fcb045e13118x1280x1304.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca343606128743a59eae6cf534986c53x1280x1493.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a disease included under Global Vision 2020 Program, but included recently in Vision 2020 program for India?",
    "choices": [
      {
        "id": 1,
        "text": "Cataract"
      },
      {
        "id": 2,
        "text": "Refractive error"
      },
      {
        "id": 3,
        "text": "Childhood blindness"
      },
      {
        "id": 4,
        "text": "Glaucoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Glaucoma</strong>&nbsp;is not included in the Global Vision 2020 Program but is included <strong>under&nbsp;Vision 2020 program for India</strong>.</p>\n<p><strong>Diseases</strong> targeted under <strong>Vision 2020</strong></p>\n<table style=\"height: 229px; width: 365px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 39px; text-align: center; height: 36px;\"><strong>S. No</strong></td>\n<td style=\"width: 144.646px; text-align: center; height: 36px;\"><strong>Globally</strong></td>\n<td style=\"width: 158.354px; text-align: center; height: 36px;\"><strong>India&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>1.&nbsp;</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p><strong>Cataract</strong></p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\"><strong>Cataract</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>2.</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p><strong>Refractive errors</strong></p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\">\n<p><strong>Refractive errors</strong></p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>3.</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p><strong>Childhood blindness</strong></p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\">\n<p><strong>Childhood blindness</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 39px; text-align: center; height: 64px;\">\n<p>4.</p>\n</td>\n<td style=\"width: 144.646px; height: 64px;\">\n<p>Onchocerciasis</p>\n</td>\n<td style=\"width: 158.354px; height: 64px;\">\n<p><strong>Glaucoma</strong></p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 39px; text-align: center; height: 46px;\">\n<p>5.</p>\n</td>\n<td style=\"width: 144.646px; height: 46px;\">\n<p>Trachoma</p>\n</td>\n<td style=\"width: 158.354px; height: 46px;\">\n<p>Diabetic retinopathy</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 39px; text-align: center;\">\n<p>6.&nbsp;</p>\n</td>\n<td style=\"width: 144.646px;\">\n<p>Low vision</p>\n</td>\n<td style=\"width: 158.354px;\">\n<p>Corneal blindness</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "One of the late visual field defects in open-angle glaucoma is _______.",
    "choices": [
      {
        "id": 1,
        "text": "Siedel scotoma"
      },
      {
        "id": 2,
        "text": "Bjerrum scotoma"
      },
      {
        "id": 3,
        "text": "Small wing-shaped paracentral scotoma"
      },
      {
        "id": 4,
        "text": "Baring of blind spot"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bjerrum scotoma (arcuate)</strong> is a <strong>late</strong> and clinically significant visual field defect. &nbsp;</p>\n<p><strong>Image</strong>:&nbsp;Bjerrum scotoma</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5cd7eb8548c4c868715dd46069af0f0x1280x864.JPEG"
    ]
  },
  {
    "text": "A patient presents with a sudden painless loss of vision in his right eye. On fundus examination, the following finding was seen. Which among the following conditions is likely?",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal artery occlusion"
      },
      {
        "id": 2,
        "text": "Central retinal vein occlusion"
      },
      {
        "id": 3,
        "text": "Retinal detachment"
      },
      {
        "id": 4,
        "text": "Retinitis pigmentosa"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows a <strong>splashed tomato appearance</strong> which is characteristic of <strong>central retinal vein occlusion</strong> (CRVO).&nbsp;</p>\n<div class=\"page\" title=\"Page 285\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>CRVO refers to sudden or acute occlusion of the central retinal vein. It presents with a <strong>sudden loss of vision</strong>. On examination, <strong>RAPD</strong> (relative afferent pupillary defect) is present.</p>\n<p>Funduscopy shows engorged and tortuous retinal veins, massive <strong>retinal hemorrhages</strong> with <strong>splashed tomato appearance</strong>, and cotton wool spots. The disc is edematous and hyperemic. Changes that occur later include neovascularization at the disc or periphery with pigmentary changes at the macula.</p>\n</div>\n</div>\n</div>\n<p>Complications:</p>\n<ul>\n<li>Rubeosis iridis or neovascularization of the iris</li>\n<li>Neovascular glaucoma (NVG) or 100 day glaucoma</li>\n<li>Vitreous hemorrhage</li>\n</ul>\n<p>100-day glaucoma is a type of <strong>neovascular glaucoma</strong> (NVG) and is so-called because it typically develops <strong>3 months after</strong> the episode of CRVO.</p>\n<p>Other options:</p>\n<p>Option A- The funduscopy findings in <strong>central retinal artery occlusion</strong>&nbsp;include pale retina, thread-like arteries, a <strong>cherry-red spot</strong> in the macula, and cattle trucking (segmentation of blood in the retinal veins). It is shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe674ec7eff14a8b8b276b2e18ed3226.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/079b44d9f7f443a998cfafde6927d046x600x448.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/51f0183ebbfe494b835969d693c027f9x648x484.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9cd3ed48cf74c6db3a249024d611322x720x621.PNG"
    ]
  },
  {
    "text": "A 61-year-old university professor presents with a loss of vision in his left eye. He describes the sensation as a curtain being drawn over his affected eye. In addition, 7 days ago the patient noticed what he described as flashing lights and floaters. He gives a history of having cataract surgery in the same eye 3 weeks ago. A B-scan image of his left eye is shown below. What could be his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Glaucoma"
      },
      {
        "id": 2,
        "text": "Retinal tumour"
      },
      {
        "id": 3,
        "text": "Retinal detachment"
      },
      {
        "id": 4,
        "text": "Corneal ulcer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and the B-scan suggest a diagnosis of<strong> rhegmatogenous retinal detachment. </strong>It\u00a0is due to the <strong>accumulation of fluid</strong> between <strong>neurosensory retina(</strong><strong>NSR) and retinal pigment epithelium (RPE)</strong>\u00a0due to a <strong>retinal tear</strong>.</p>\n<p>Definition of retinal detachment:<strong> The separation of the neurosensory retina from the RPE.</strong></p>\n<p>Types of Retinal detachment:</p>\n<p><strong>A. Rhegmatogenous retinal detachment-</strong> fluid accumulates after a <strong>break (tear)</strong> occurs in the retina.</p>\n<ul>\n<li>Causes:\n<ul>\n<li>High <strong>myopes</strong></li>\n<li><strong>Retinoschisis-</strong>splitting of neurosensory retina plus vitreous degeneration\n<ul>\n<li><strong>Typical</strong>\u00a0retinoschisis-split at the\u00a0level of the\u00a0<strong>outer plexiform layer</strong></li>\n<li><strong>Atypical</strong>\u00a0retinoschisis-split at the\u00a0level of the\u00a0<strong>nerve fiber layer</strong></li>\n</ul>\n</li>\n<li>Trauma</li>\n<li>Pseudophakia</li>\n<li>Aphakia</li>\n</ul>\n</li>\n<li><strong>The most dangerous type</strong> of retinal break is <strong>horseshoe tear.</strong></li>\n<li><strong>The most dangerous location</strong> of retinal break is the\u00a0<strong>supero-temporal retina.</strong>\u00a0</li>\n<li>Clinical features\n<ul>\n<li><strong>Photopsia</strong>-flashes of light due to vitreoretinal traction at the\u00a0site of the break</li>\n<li><strong>Floaters</strong></li>\n<li>Visual field defect- a\u00a0<strong>black curtain/veil</strong> in front of the eye</li>\n</ul>\n</li>\n<li>Signs\n<ul>\n<li><strong>Hypotony-</strong>\u00a0as the liquefied vitreous in the subretinal space is absorbed through the RPE.</li>\n<li><strong>Shafers sign-</strong>pigments in the anterior vitreous (<strong>tobacco dusting)</strong> are a <strong>feature</strong> of <strong>fresh retinal detachment.</strong></li>\n<li>The detached retina is <strong>convex</strong> in <strong>configuration.</strong>\u00a0The surface is <strong>corrugated</strong> with <strong>undulations.</strong></li>\n</ul>\n</li>\n<li>Treatment\n<ul>\n<li>Prophylactic laser barrage</li>\n<li><strong>Scleral buckling</strong></li>\n<li><strong>Pneumatic retinopexy</strong></li>\n<li>Pars plana vitrectomy\u00a0</li>\n</ul>\n</li>\n</ul>\n<p><strong>B. Tractional retinal detachment:\u00a0</strong><strong>Fibro-vascular membranes</strong> in the <strong>vitreous</strong> due to long-standing <strong>retinal neovascularization</strong>\u00a0exert traction on the retina.\u00a0</p>\n<ul>\n<li>Causes\n<ul>\n<li style=\"text-align: left;\">Proliferative diabetic retinopathy</li>\n<li style=\"text-align: left;\">Central retinal venous occlusion</li>\n<li style=\"text-align: left;\">Eales disease</li>\n<li style=\"text-align: left;\">Retinopathy of Prematurity(ROP)</li>\n</ul>\n</li>\n<li>Signs\n<ul>\n<li>The detached retina is concave in configuration. No breaks are seen</li>\n</ul>\n</li>\n<li>Treatment\n<ul>\n<li><strong>Pars plana vitrectomy</strong> with <strong>endo photocoagulation</strong>.\u00a0</li>\n</ul>\n</li>\n</ul>\n<p><strong>C. Exudative retinal detachment</strong>:<strong> Exudative fluid</strong> from the <strong>choroid,</strong> collects in the <strong>subretinal space</strong> leading to retinal detachment.</p>\n<ul>\n<li>Causes\n<ul>\n<li>Inflammatory conditions like <strong>choroiditis, posterior scleritis</strong></li>\n<li>Choroidal tumours like <strong>melanoma</strong></li>\n<li><strong>Toxaemia</strong> of pregnancy</li>\n<li><strong>Malignant hypertension</strong></li>\n<li><strong>Coats</strong> disease</li>\n</ul>\n</li>\n<li>Clinical features\n<ul>\n<li><strong>Floaters</strong> due to vitritis but <strong>no photopsia</strong></li>\n<li>Visual field defect</li>\n</ul>\n</li>\n<li>Signs\n<ul>\n<li>The detached retina is <strong>convex</strong> in <strong>configuration</strong>.<strong>\u00a0The surface</strong>\u00a0is <strong>smooth</strong>.<strong> No break</strong> is seen.</li>\n<li><strong>Shifting fluid</strong> is seen.</li>\n</ul>\n</li>\n<li>Treatment\n<ul>\n<li><strong>Systemic steroids</strong></li>\n<li>Treatment of the cause</li>\n</ul>\n</li>\n</ul>\n<p><span style=\"font-size: 12pt;\">\u00a0The image below shows a fundus which reveals retinal detachment inferiorly from 3-9 o'clock with a tear at 3:30</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/497be5fd47a74c02b5239a958f9149c6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/673a6eec0fb24f41b4d34d4c6d24a44cx1280x1327.JPEG"
    ]
  },
  {
    "text": "Identify the below finding:",
    "choices": [
      {
        "id": 1,
        "text": "Entropion of right eye"
      },
      {
        "id": 2,
        "text": "Lagophthalmos of right eye"
      },
      {
        "id": 3,
        "text": "Ptosis of right eye"
      },
      {
        "id": 4,
        "text": "Ectropion of left eye"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ptosis:</strong></p>\n<p>It is abnormal drooping of upper eyelid.Ptosis is drooping of the upper lid to a level that that covers more than 2mm of the superior cornea.Ptosis is generally unilateral,in over 70% of individuals.</p>\n<p><strong>Types:</strong></p>\n<ol>\n<li>Congenital ptosis</li>\n<li>Acquired ptosis</li>\n<ul>\n<li><strong>Neurogenic ptosis:</strong>&nbsp;It is caused by innervational defects such as <em>third nerve palsy, Horner&rsquo;s syndrome.</em></li>\n<li><strong>Myogenic ptosis:</strong>&nbsp;It occurs due to acquired disorders of the LPS muscle or of the myoneural Junction. - <em>Myasthenia gravis</em></li>\n<li><strong>Aponeurotic ptosis:</strong>&nbsp;It develops due to defects of the levator aponeurosis.</li>\n<li><strong>Mechanical ptosis:</strong>&nbsp;It may result due to excessive weight on the upper lid as seen in patients with <em>lid tumors, multiple chalazia and lid edema.</em></li>\n</ul>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49862c40a69d46c2b101b97906cc04c8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old boy presented with a white pupillary reflex for which enucleation was done. The histopathological examination of the specimen revealed Flexner-Wintersteiner rosettes. What could be the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Retinoblastoma"
      },
      {
        "id": 2,
        "text": "Medulloblastoma"
      },
      {
        "id": 3,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 4,
        "text": "Astrocytoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This child with a <strong>whitish pupillary reflex</strong> and\u00a0<strong>Flexner-Winterstein</strong> <strong>rosettes</strong> on histopathological examination has\u00a0<strong>retinoblastoma</strong>. Flexner Winterstein rosettes refer to an arrangement of <strong>columnar cells around a central lumen</strong>, which is highly characteristic of retinoblastoma.</p>\n<p>Retinoblastoma is a malignant proliferation of immature retinal neural cells and is the <strong>most common</strong> <strong>intraocular malignancy</strong> in <strong>children</strong>. It is associated with mutations in the <strong>RB1 gene</strong> at chromosome <strong>13q14. </strong>It belongs to <strong>small round blue cell</strong> tumours because the immature retinal neural cells are seen as small round cells with large nuclei.</p>\n<p><strong>White pupillary reflex</strong>\u00a0or <strong>leukocoria</strong> is the most common presenting feature, followed by a <strong>squint</strong> which is usually convergent. Rarely, the child may present with nystagmus and defective vision.\u00a0Image below showing leukocoria of left eye</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df14a240df724365a0ab9d8046e809e7x720x331.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/520953bab5e9459eb251a6b384c78e27x510x525.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f031c485471e488490243af5549475d8x510x525.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/385d8bc815944ef2a0312af97c564f8cx800x533.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91be38fdc37249a082e19d0b97c072e0x512x438.PNG"
    ]
  },
  {
    "text": "A patient presented to OPD with complaints of fever left eye lid swelling for the past two days as shown below . He had a mild flu-like illness a week ago but no history of trauma. There is no chemosis or any protrusion of the eyeball. Visual acuity, IOP, ocular motility, and pupils all were normal. Slit-lamp examination was unremarkable. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Panophthalmitis"
      },
      {
        "id": 2,
        "text": "Orbital cellulitis"
      },
      {
        "id": 3,
        "text": "Preseptal cellulitis"
      },
      {
        "id": 4,
        "text": "Endophthalmitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette with eyelid swelling and fever following an infection without proptosis, loss of visual acuity, and ophthalmoplegia are suggestive of <strong>preseptal cellulitis/ Periorbital cellulitis.</strong></p>\n<div><strong>Preseptal cellulitis</strong> is an infection of the subcutaneous tissues anterior\u00a0to the orbital septum.</div>\n<div>\u00a0</div>\n<div><strong>Etiological agents:</strong> <em>Staph. aureus, Strep. pyogens</em></div>\n<div>\u00a0</div>\n<div><strong>Mode of spread:</strong> Skin trauma, insect bites, acute hordeolum, dacryocystitis, conjunctivitis, sinusitis, Upper respiratory tract infection, and middle ear infection.</div>\n<div>\u00a0</div>\n<div><strong>Presentation:</strong></div>\n<ol>\n<li>Tender, firm, erythematous eye lid swelling</li>\n<li>Conjunctiva - usually <strong>no chemosis</strong></li>\n<li><strong>Proptosis - absent</strong></li>\n<li>Ocular movements - <strong>normal</strong></li>\n<li>Visual acuity - <strong>normal</strong></li>\n<li>Systemic symptoms: fever, leucocytosis</li>\n</ol>\n<p><strong>Treatment:\u00a0</strong>Antibiotics with systemic analgesics and warm compresses.</p>\n<p><strong>Complications:</strong>\u00a0May spread and develop into orbital cellulitis, abscess formation, meningitis, and cavernous sinus thrombosis.</p>\n<p>Option A: \u00a0<strong>Panophthalmitis</strong> would have an intense purulent inflammation of the whole eyeball that could be seen on a slit-lamp.</p>\n<p>Option B:\u00a0<strong>Orbital cellulitis</strong> refers to the acute infection of the contents of the orbit <strong>behind</strong> the orbital septum.It \u00a0presents with pain, lid edema, erythema, chemosis, and <strong>axial proptosis.</strong>Increased pain with movement of eyes and <strong>ophthalmoplegia</strong> (decreased ocular motility) is a classic symptoms. There is a <strong>rapid loss of vision</strong> is due to the involvement of the optic nerve.</p>\n<p>Option D: <strong>Endophthalmitis </strong>is defined as the inflammation of the inner structures of the eyeball, i.e., uveal tissue and retina, associated with the pouring of exudates into the vitreous cavity, anterior chamber, and posterior chamber.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95eec4f9197d42609de4fce54f7bd7ba.JPG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following nerve injury causes neurotrophic keratopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Facial nerve"
      },
      {
        "id": 2,
        "text": "Abducens nerve"
      },
      {
        "id": 3,
        "text": "Trigeminal nerve"
      },
      {
        "id": 4,
        "text": "Occulomotor nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Neurotrophic keratopathy </strong>is due to <strong>loss of trigeminal nerve innervation</strong> resulting in<strong> partial or complete loss of sensation.</strong></p>\n<p><strong>Causes:</strong></p>\n<ul>\n<li>Trigeminal ganglion surgical ablation for neuralgia</li>\n<li>Stroke</li>\n<li>Tumour</li>\n<li>Peripheral neuropathy</li>\n<li>Herpes simplex and herpes zoster keratitis (sectoral sensation loss)</li>\n</ul>\n<p><strong>Stages:</strong></p>\n<p><strong>Stage 1:</strong> intrapalpebral epithelial irregularity, oedema and tiny focal deficits</p>\n<p><strong>Stage 2:</strong> Large persistent epithelial defects with rolled and thickened edges, assuming a punched out configuration</p>\n<p><strong>Stage 3:</strong> Stromal melting</p>\n<p><strong>Treatment:</strong> Topical lubricants, protection of the ocular surface with tarsorrhaphy, therapeutic silicone contact lenses, amniotic membrane patching.</p>\n<p>&nbsp;</p>\n<p><strong>Exposure keratopathy</strong> is caused by paralysis of the&nbsp;<strong>facial nerve</strong>.&nbsp;&nbsp;</p>\n<p><strong>Exposure keratopathy</strong></p>\n<ul>\n<li>It is the result of incomplete lid closure (lagophthalmos), with the drying of the cornea despite normal tear&nbsp;production.</li>\n<li>Causes&nbsp;\n<ul>\n<li>Neuroparalytic, e.g.,&nbsp;<strong>facial nerve palsy</strong></li>\n<li>Reduced muscle tone as&nbsp;in <strong>parkinsonism</strong></li>\n<li>Mechanical such as lid scarring</li>\n<li>Proptosis</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A small child with a high risk of amblyopia is planned to undergo surgical correction for his unilateral simple congenital ptosis. He has poor levator function. What is the treatment of choice in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Levator resection"
      },
      {
        "id": 2,
        "text": "Frontalis sling"
      },
      {
        "id": 3,
        "text": "Fasanella-Servat operation"
      },
      {
        "id": 4,
        "text": "Mullerectomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Frontalis sling</strong>&nbsp;procedure is the treatment of choice for&nbsp;<strong>congenital ptosis</strong> with poor levator function.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false regarding accommodative esotropia?",
    "choices": [
      {
        "id": 1,
        "text": "It is the most common type of squint."
      },
      {
        "id": 2,
        "text": "Miotics are used as the treatment strategy in the high AC/A ratio"
      },
      {
        "id": 3,
        "text": "It is associated with high myopia."
      },
      {
        "id": 4,
        "text": "Refractive type can be fully corrected by use of spectacles."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Accommodative esotropia</strong> is associated with a high degree of <strong>hypermetropia</strong> (+4 to +7 D).</p>\n<p><strong>Accommodative esotropia </strong>is the<strong> m</strong><strong>ost common</strong> type of squint. Typically presents around <strong>2 to 3</strong> years of age.</p>\n<p>Types:</p>\n<ol>\n<li><strong>Refractive</strong>\n<ul>\n<li>Associated with <strong>high hypermetropia</strong></li>\n<li><strong>Fully correctable</strong> by <strong>spectacles</strong></li>\n</ul>\n</li>\n<li><strong>Non-refractive type </strong>\n<ul>\n<li><strong>Abnormal accommodative convergence/accommodation (AC/A)</strong> ratio</li>\n<li>Fully corrected by bifocal glasses</li>\n<li><strong>Miotics </strong>useful in cases where glasses are unsuitable\n<ul>\n<li><strong>Echothiophate </strong>causes<strong>&nbsp;iris cyst</strong></li>\n<li><strong>Prevention </strong>of iris cysts-<strong>&nbsp;Phenylephrine </strong>drops</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Mixed type</strong></li>\n</ol>\n<p>The accommodative convergence/accommodation <strong>(AC/A) ratio</strong> is defined as the amount of convergence measured in prism diopters per unit (diopter) change in accommodation.</p>\n<p>The image below shows accommodative esotropia with and without correction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd54b64d92e248f7b6dd196a15c638c6x653x266.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/133525488fab43dd89dbecdc925d96e4x491x170.PNG"
    ]
  },
  {
    "text": "Match the following ocular examination findings with their pathology.",
    "choices": [
      {
        "id": 1,
        "text": "A-2, B-3, C-4, D-1"
      },
      {
        "id": 2,
        "text": "A-1, B-3, C-4, D-2"
      },
      {
        "id": 3,
        "text": "A-4, B-2, C-3, D-1"
      },
      {
        "id": 4,
        "text": "A-3, B-1, C-2, D-4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct match is as follows:</p>\n<p>Image A:&nbsp;Vossius ring<br />Image B:&nbsp;Arcus lipoides<br />Image C:&nbsp;Kayser-Fleischer&nbsp;ring<br />Image D:&nbsp;Wessely's immune ring</p>\n<p>Vossius ring is&nbsp;a circular ring of faint or stippled opacity, seen on the<strong>&nbsp;anterior surface</strong>&nbsp;of the lens due to brown&nbsp;<strong>amorphous granules of pigment</strong>&nbsp;lying&nbsp;<strong>on the capsule of the lens</strong>. It is usually seen after&nbsp;<strong>blunt trauma</strong>&nbsp;to the eye and orbit.</p>\n<p>It usually has about the same diameter as the contracted pupil. The force of the blow drives the cornea and iris backward and thus producing an impression of the iris on the lens as shown below. The resorption of the pigment results in discrete subcapsular opacities.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/162b51a9c1ef4d33b59f45bf7d205a37.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9af034e2460549859ac6971d682ecf55x720x703.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2bc0dbf7d78b41bb86bafbb6fe381efdx720x478.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/63233cf8d58149e4a2ee7c0c349043fex288x191.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02572dc69a73401a95a0610e9c72243bx688x514.PNG"
    ]
  }
];
        let quizName = 'Ophthalmology Test';
        const quizFilename = 'ophthalmology-test-d3594fe5.html';
        let hierarchy = ["Marrow", "FMGE Test Series Subject", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>