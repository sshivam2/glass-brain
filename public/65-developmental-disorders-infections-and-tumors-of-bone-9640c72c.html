<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>65 Developmental Disorders,Infections And Tumors Of Bone - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What are the specialized multinucleated macrophages in bone called?",
    "choices": [
      {
        "id": 1,
        "text": "Osteocytes"
      },
      {
        "id": 2,
        "text": "Chondroblasts"
      },
      {
        "id": 3,
        "text": "Osteoclasts"
      },
      {
        "id": 4,
        "text": "Histiocytes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Osteoclasts </strong>are specialized <strong>multinucleated macrophages</strong> derived from circulating monocytes that are responsible for<strong> bone resorption.</strong></p>\n<p><strong>Osteocytes </strong>are formed when osteoblasts are embedded in the matrix within lacunae and canaliculi. They control calcium and phosphate levels in the microenvironment.&nbsp;</p>\n<p><strong>Osteoblasts&nbsp;</strong>are mesenchymal cells that<strong>&nbsp;</strong>rim the bony spicule, responsible for<strong> bone synthesis</strong> and mineralization.&nbsp;</p>\n<p><strong>Chondrocytes</strong> are specialized cells that produce and maintain the extracellular matrix of<strong> cartilage.</strong></p>\n<p>The image given below shows different cells present in a bone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ca3514e83be14335aa5536b796361b51x800x562.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a marker of bone resorption?",
    "choices": [
      {
        "id": 1,
        "text": "Osteocalcin"
      },
      {
        "id": 2,
        "text": "Urine free deoxypyridinoline"
      },
      {
        "id": 3,
        "text": "Crosslinked-N-telopeptides"
      },
      {
        "id": 4,
        "text": "Tartrate resistant acid phosphatase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Osteocalcin </strong>is not a&nbsp;bone resorption marker.</p>\n<p>It is a protein secreted only by <strong>osteoblasts.</strong>&nbsp;Thus, it is a <strong>bone formation marker&nbsp;</strong>(osteoblastic marker).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common benign bone tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoblastoma"
      },
      {
        "id": 2,
        "text": "Chondroblastoma"
      },
      {
        "id": 3,
        "text": "Osteochondroma"
      },
      {
        "id": 4,
        "text": "Osteiod osteoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Osteochondroma</strong>, also known as exostosis, is the <strong>most common benign bone tumor.&nbsp;</strong></p>\n<p>It is a benign cartilage-capped tumor. 85% of osteochondromas are <strong>solitary</strong>. The remainder is seen as part of the multiple hereditary exostosis syndromes,&nbsp;an autosomal-dominant hereditary disease.</p>\n<p>Lesions arise from the <strong>metaphysis </strong>near the growth plate of long tubular bones, especially near the knee. They are either sessile or pedunculated and range in size from 1 to 20 cm. Histologically, the <strong>cap</strong> is composed of <strong>benign hyaline cartilage</strong> varying in thickness and is covered peripherally by perichondrium.</p>\n<p>Osteochondromas can progress to<strong> chondrosarcoma</strong>.&nbsp;</p>\n<p>The image below shows the histopathological specimen of osteochondroma, displaying a <strong>cartilage cap</strong> lined by perichondrium contiguous with mature bone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/70019285771d4cd3ab97995e9a96e84ex1280x1238.PNG"
    ]
  },
  {
    "text": "A woman delivered a child who died a few minutes after birth. The infant was found to have blue sclera and fractures of the right humerus, ulna, and femur at birth. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteogenesis Imperfecta Type I"
      },
      {
        "id": 2,
        "text": "Osteogenesis Imperfecta Type II"
      },
      {
        "id": 3,
        "text": "Osteogenesis Imperfecta Type III"
      },
      {
        "id": 4,
        "text": "Osteogenesis Imperfecta Type IV"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>osteogenesis imperfecta type II</strong>.</p>\n<p>The<strong> type II&nbsp;</strong>variant of <strong>osteogenesis imperfecta</strong> (OI) is uniformly <strong>fatal</strong> in utero or during the perinatal period.&nbsp;<strong>Type</strong> <strong>II OI</strong> is characterized by extraordinary bone fragility with<strong> multiple intrauterine fractures.</strong></p>\n<p>Osteogenesis imperfecta (brittle bone disease) is caused by deficiencies in the synthesis of <strong>type I collagen.</strong> It can be separated into four major clinical subtypes that vary widely in severity. The severity of the disease is based on the location of the mutation within the protein.</p>\n<p>Individuals with type&nbsp;I&nbsp;OI have a normal life span, but experience childhood fractures that decrease in frequency following puberty.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old woman gives birth to an infant with less than 5th percentile length. The head and torso are of normal size but extremities are short. The head circumference is at the 95th percentile, and frontal bossing is seen. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hypophosphatemic rickets"
      },
      {
        "id": 2,
        "text": "Achondroplasia"
      },
      {
        "id": 3,
        "text": "Ehlers-Danlos syndrome"
      },
      {
        "id": 4,
        "text": "Osteogenesis imperfecta"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This given clinical scenario is suggestive of&nbsp;<strong>achondroplasia</strong>.</p>\n<p>Achondroplasia is the <strong>most common skeletal dysplasia</strong> and a major cause of <strong>dwarfism.&nbsp;</strong>It has <strong>autosomal dominant</strong> inheritance.</p>\n<div class=\"page\" title=\"Page 1186\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>It occurs due to the <strong>gain of mutation</strong> in fibroblast growth factor receptor<strong> (FGFR3).&nbsp;</strong>This leads to <strong>abnormal cartilage proliferation </strong>at growth plates and affects endochondral bone growth. Infants present with:</p>\n<ul>\n<li>Short stature</li>\n<li>Rhizomelic shortening of limbs</li>\n<li>Frontal bossing</li>\n<li>Midface deficiency</li>\n</ul>\n<p>The condition is not associated with changes in longevity, intelligence, or reproductive status.</p>\n<p>The image below shows a baby affected with achondroplasia. Note the prominent forehead, triangular face, and body asymmetry in the image (a); a low nasal bridge in the image (b); trident hands in the image (c); and scoliosis in the image (d).</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f89d3caf7d6c43afbb622cce68a5a0fax472x568.PNG"
    ]
  },
  {
    "text": "Which of the following is also called marble bone disease?",
    "choices": [
      {
        "id": 1,
        "text": "Osteogenesis imperfecta"
      },
      {
        "id": 2,
        "text": "Vrolik\u2019s syndrome"
      },
      {
        "id": 3,
        "text": "Albers-Sch\u00f6nberg disease"
      },
      {
        "id": 4,
        "text": "Paget disease of bone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><span class=\"s1\"><strong>Albers-Sch&ouml;nberg disease </strong>or<strong> osteopetrosis</strong> is also known as <strong>marble bone disease.</strong></span></p>\n<p class=\"p1\"><span class=\"s1\">The term osteopetrosis reflects the <strong>stone-like</strong> quality of the bones. T</span>he bones are abnormally brittle and fracture easily, like a piece of chalk. It occurs due to <strong>reduced bone resorption</strong> and diffuse symmetric skeletal sclerosis because of impaired formation or function of osteoclasts.</p>\n<p><span class=\"s1\">Note: Osteogenesis imperfecta is also called <strong>brittle bone</strong> disease.&nbsp;</span><span class=\"s1\">Paget's disease is also called <strong>osteitis deformans;</strong>&nbsp;it presents with <strong>mosaic</strong>&nbsp;pattern of lamellar bone.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant is being evaluated for multiple fractures over the last 3 months. On examination, hydrocephaly, cranial nerve defects, and hepatosplenomegaly are noted. Imaging reveals generalized sclerosis and a bone-in-bone appearance. Which of the following is the most likely enzyme to be deficient in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Carbonic anhydrase\u00a0II"
      },
      {
        "id": 2,
        "text": "Acid phosphatase"
      },
      {
        "id": 3,
        "text": "Creatine kinase"
      },
      {
        "id": 4,
        "text": "Phosphorylase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>osteopetrosis.</strong> It occurs due to <strong>autosomal recessive</strong> defects in the gene for the enzyme<strong> carbonic anhydrase II.</strong></p>\n<p>Carbonic anhydrase II is required by osteoclasts and renal tubular cells to generate protons from carbon dioxide and water (acidification). The absence of carbonic anhydrase II prevents osteoclasts from acidifying the resorption pit and dissolution of calcium hydroxyapatite within the bone matrix. It also blocks the acidification of urine by the renal tubular cells. This leads to <strong>reduced bone resorption</strong> and<strong> diffuse symmetric skeletal sclerosis.</strong></p>\n<p>Due to deficient osteoclast activity, bones involved by osteopetrosis lack a medullary canal giving it a <strong>bone-in-bone</strong> appearance. The ends of long bones are bulbous <strong>(Erlenmeyer flask deformity)</strong> and misshapen. The neural foramina are small and compress&nbsp;the exiting nerves, leading to <strong>cranial nerve palsies.&nbsp;</strong></p>\n<p>Extensive extramedullary hematopoiesis leads to leukopenia and prominent <strong>hepatosplenomegaly.&nbsp;</strong>As carbonic anhydrase II is widely expressed, mutations of this&nbsp;gene result in a condition called&nbsp;<strong>marble brain disease</strong>&nbsp;or&nbsp;Guibaud-Vainsel syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old postmenopausal woman presents with sudden severe back pain. There is no history of trauma. X-ray findings are given below. MRI shows thinning of trabecular plates of the vertebrae and vertebral collapse. Levels of which of the following will be increased in her condition?",
    "choices": [
      {
        "id": 1,
        "text": "RANKL"
      },
      {
        "id": 2,
        "text": "OPG"
      },
      {
        "id": 3,
        "text": "IFNg"
      },
      {
        "id": 4,
        "text": "IL-8"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>osteoporosis. Cytokines stimulate osteoclast</strong> recruitment and activity in osteoporosis by <strong>increasing </strong>the levels of <strong>RANKL. </strong></p>\n<p>RANKL helps in&nbsp;diminishing the expression of osteoprotegerin (OPG), increasing osteoclast proliferation, and preventing osteoclast apoptosis.</p>\n<p>Decreased estrogen levels after menopause actually increase both bone resorption and formation. However, the latter does not keep up with the former, leading to a&nbsp;<strong>high turnover.&nbsp;</strong>Decreased estrogen appears to increase the secretion of inflammatory cytokines such as IL-6, TNF-&alpha;, and IL-1.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9d2d91cce6ea445ba12ea1f6c6b077ce.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "In patients with which of the following conditions will you see a histologically normal bone?",
    "choices": [
      {
        "id": 1,
        "text": "Osteomalacia"
      },
      {
        "id": 2,
        "text": "Osteoporosis"
      },
      {
        "id": 3,
        "text": "Paget's disease"
      },
      {
        "id": 4,
        "text": "Hyperparathyroidism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span class=\"s1\">Option A: Inadequate mineralization in osteomalacia leads to a thickened osteoid matrix.</span>&nbsp;</p>\n<p><span class=\"s1\">Option C:&nbsp;Paget's disease presents with a mosaic&nbsp;pattern of lamellar bone.</span></p>\n<p><span class=\"s1\">Option D: Dissecting osteitis cystica is seen in severe hyperparathyroidism.&nbsp;</span></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1d10f758736c48cda7fc8b2cec374d0cx300x168.PNG"
    ]
  },
  {
    "text": "A patient presents with back pain, recurrent headaches, and increasing head size. On evaluation, raised alkaline phosphatase and a mosaic pattern of lamellar bone is seen. Which of the following statements is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Onset is in late adulthood"
      },
      {
        "id": 2,
        "text": "It occurs due to mutations in the SQSTM1 gene"
      },
      {
        "id": 3,
        "text": "It is polyostotic in about 15% of cases"
      },
      {
        "id": 4,
        "text": "Sarcoma occurs in less than 1% of all individuals"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Laboratory findings show<strong>&nbsp;elevated serum alkaline phosphatase</strong> and <strong>urinary hydroxyproline</strong> (normal serum calcium and phosphorus).</p>\n<p>Following tumors can develop in the affected bones in Paget's disease:</p>\n<ul>\n<li>Benign tumors -&nbsp;\n<ul>\n<li>Giant cell tumors</li>\n<li>Giant cell reparative granuloma</li>\n<li>Extra-osseous masses of hematopoietic tissue</li>\n</ul>\n</li>\n<li><strong>Sarcoma</strong> (<strong>osteosarcoma</strong> or<strong> fibrosarcoma</strong>) - most dreaded complication. Occurs in <strong>&lt; 1 %</strong> of all&nbsp;individuals with Paget disease, and in 5% to 10% of those with the severe polyostotic disease.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/32e7d8d7d55d4f1fb1de9b10980ca6ebx1280x1111.JPEG"
    ]
  },
  {
    "text": "In patients with hyperparathyroidism, which of the following is least expected?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoporosis"
      },
      {
        "id": 2,
        "text": "Brown tumors"
      },
      {
        "id": 3,
        "text": "Dissecting osteitis"
      },
      {
        "id": 4,
        "text": "Osteopetrosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Osteopetrosis does not belong to the clinical spectrum of hyperparathyroidism.</p>\n<div class=\"c-message_kit__gutter\">\n<div class=\"c-message_kit__gutter__right\" role=\"presentation\" data-qa=\"message_content\">\n<div class=\"c-message_kit__blocks c-message_kit__blocks--rich_text\">\n<div class=\"c-message__message_blocks c-message__message_blocks--rich_text\">\n<div class=\"p-block_kit_renderer\" data-qa=\"block-kit-renderer\">\n<div class=\"p-block_kit_renderer__block_wrapper p-block_kit_renderer__block_wrapper--first\">\n<div class=\"p-rich_text_block\" dir=\"auto\">\n<div class=\"p-rich_text_section\">The features of&nbsp;hyperparathyroidism are as follows:</div>\n<ul class=\"p-rich_text_list p-rich_text_list__bullet\" data-stringify-type=\"unordered-list\" data-indent=\"0\" data-border=\"0\">\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><strong>Osteitis fibrosa cystica</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><strong>Osteopenia/osteoporosis</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Hyperuricemia&nbsp;and&nbsp;gout&nbsp;</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Pseudogout</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Increased production of calcitriol&nbsp;</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><strong>Dissecting osteitis</strong> and <strong>brown tumors</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Nephrolithiasis</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Hypophosphatemia</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\">Anemia</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"c-message_actions__container c-message__actions\" role=\"group\">Hyperparathyroidism leads to significant skeletal changes related to <strong>unabated osteoclast activity</strong><em>.&nbsp;</em>Increased osteoclast activity is most prominent in cortical bone, but the medullary bone is not spared. Osteoclasts may tunnel into and dissect centrally along the length of the trabeculae, creating the appearance of railroad tracks, diagnostic of&nbsp;<strong>dissecting osteitis.&nbsp;</strong>Generalised <strong>osteoporosis</strong> may be seen in the phalanges, vertebrae, and proximal femur.</div>\n<div class=\"c-message_actions__container c-message__actions\" role=\"group\">&nbsp;</div>\n<div class=\"c-message_actions__container c-message__actions\" role=\"group\"><strong>Brown tumor</strong> presents with bone loss leading to microfractures and secondary hemorrhages which causes influx of macrophages and ingrowth of reparative fibrous tissue.&nbsp;<strong>Generalized osteitis </strong>presents with increased bone cell activity, peri-trabecular fibrosis, and cystic brown tumors.</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old child presented with fever,  pain, and swelling around the knee joint for 3 days. Lab investigations showed a WBC count of 23,500/mm3. An MRI was done, which demonstrated an intramedullary abscess of the proximal tibia. Which of the following is the most common causative organism of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 2,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 3,
        "text": "Salmonella"
      },
      {
        "id": 4,
        "text": "Klebsiella"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical picture is suggestive of <strong>acute pyogenic osteomyelitis. <em>S</em></strong><em><strong>taphylococcus aureus</strong></em> is the most common cause of culture-positive pyogenic osteomyelitis.</p>\n<div class=\"page\" title=\"Page 1197\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Osteomyelitis denotes inflammation of bone and marrow, almost always secondary to infection. Organisms may reach the bone by</p>\n<ol>\n<li>Hematogenous spread</li>\n<li>Extension from a contiguous site</li>\n<li>Direct implantation</li>\n</ol>\n<div class=\"c-message_kit__gutter\">\n<div class=\"c-message_kit__gutter__right\" role=\"presentation\" data-qa=\"message_content\">\n<div class=\"c-message_kit__blocks c-message_kit__blocks--rich_text\">\n<div class=\"c-message__message_blocks c-message__message_blocks--rich_text\">\n<div class=\"p-block_kit_renderer\" data-qa=\"block-kit-renderer\">\n<div class=\"p-block_kit_renderer__block_wrapper p-block_kit_renderer__block_wrapper--first\">\n<div class=\"p-rich_text_block\" dir=\"auto\">\n<div class=\"p-rich_text_section\">The common causative organisms include:</div>\n<ul class=\"p-rich_text_list p-rich_text_list__bullet\" data-stringify-type=\"unordered-list\" data-indent=\"0\" data-border=\"0\">\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\"><strong>S</strong><strong>taphylococcus aureus</strong>&nbsp;-</em>&nbsp;the most common cause overall</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Pseudomonas aeruginosa</em>&nbsp;- most common cause in&nbsp;<strong data-stringify-type=\"bold\">IV drug abusers</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><strong data-stringify-type=\"bold\"><em data-stringify-type=\"italic\">Salmonella</em></strong><strong data-stringify-type=\"bold\">&nbsp;</strong>- common in patients of&nbsp;<strong data-stringify-type=\"bold\">sickle cell anemia</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Haemophilus influenzae</em>&nbsp;- was a common causative organism in children, less common now due to vaccination</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Streptococcus pyogenes -&nbsp;</em>most common in neonates</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Escherichia coli, Klebsiella-&nbsp;</em>most common cause in patients with&nbsp;<strong>genitourinary tract infections</strong></li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with sickle cell disease are particularly susceptible to osteomyelitis caused by which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Haemophilus influenzae"
      },
      {
        "id": 3,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 4,
        "text": "Salmonella enteritidis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Salmonella enteritidis&nbsp;</strong>is commonly implicated in osteomyelitis in patients with <strong>sickle cell anemia</strong>.</p>\n<div class=\"p-rich_text_section\">The common causative organisms include:</div>\n<ul class=\"p-rich_text_list p-rich_text_list__bullet\" data-stringify-type=\"unordered-list\" data-indent=\"0\" data-border=\"0\">\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\"><strong>S</strong><strong>taphylococcus aureus</strong>&nbsp;-</em>&nbsp;the most common cause overall</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Pseudomonas aeruginosa</em>&nbsp;- most common cause in&nbsp;<strong data-stringify-type=\"bold\">IV drug abusers</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><strong data-stringify-type=\"bold\"><em data-stringify-type=\"italic\">Salmonella</em></strong><strong data-stringify-type=\"bold\">&nbsp;</strong>- most common in patients of&nbsp;<strong data-stringify-type=\"bold\">sickle cell anemia</strong></li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Haemophilus influenzae</em>&nbsp;- was a common causative organism in children, less common now due to vaccination</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Streptococcus&nbsp;pyogenes - </em>neonates</li>\n<li data-stringify-indent=\"0\" data-stringify-border=\"0\"><em data-stringify-type=\"italic\">Escherichia coli, Klebsiella-&nbsp;</em>most common cause in patients with&nbsp;<strong>genitourinary tract infections</strong></li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who is a known case of TB presents to the orthopedic OPD with a 4-month history of progressively worsening back pain. He also complains of fatigue and irregular fever for 2 weeks. X-ray reveals lytic destruction of the anterior portion of the vertebral body and increased anterior wedging. All of the following are the complications of his condition except",
    "choices": [
      {
        "id": 1,
        "text": "Scoliosis"
      },
      {
        "id": 2,
        "text": "Paraplegia"
      },
      {
        "id": 3,
        "text": "AA amyloidosis"
      },
      {
        "id": 4,
        "text": "Brodie's abscess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient is most likely suffering from TB osteomyelitis. Brodie's abscess&nbsp;is not a complication of this condition.&nbsp;</p>\n<p>In tuberculous osteomyelitis, weight-bearing joints - <strong>spine (Pott's disease)</strong>, hips, and knees, are most commonly affected.</p>\n<p>Complications of tuberculous osteomyelitis include:</p>\n<ul>\n<li><strong>Scoliosis</strong> or kyphosis&nbsp;(gibbus)</li>\n<li>Neurologic deficits secondary to spinal cord and nerve compression leading to <strong>paraplegia -&nbsp;</strong></li>\n<li>Tuberculous arthritis</li>\n<li>Sinus tract formation</li>\n<li><strong>Psoas abscess - </strong>may be due to<strong>&nbsp;</strong>paravertebral &ldquo;cold&rdquo; abscess</li>\n<li><strong>AA amyloidosis&nbsp;</strong></li>\n</ul>\n<div class=\"page\" title=\"Page 1530\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presents with back pain that is unresponsive to aspirin. Radiographs show a well-demarcated lesion in the posterior spine. A biopsy is done and the histopathological finding is given below. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Osteoid osteoma"
      },
      {
        "id": 3,
        "text": "Osteoblastoma"
      },
      {
        "id": 4,
        "text": "Chondroblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Osteoid osteoma and osteoblastoma are benign bone-producing tumors that have identical histologic features. The differentiating features between them are given below:</p>\n<table style=\"height: 123px;\" width=\"290\">\n<tbody>\n<tr style=\"height: 34.1979px;\">\n<td style=\"width: 137px; height: 34.1979px;\"><strong>Osteoid osteoma</strong></td>\n<td style=\"width: 137px; height: 34.1979px;\"><strong>Osteoblastoma</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 137px; height: 36px;\">Less than 2 cm in diameter</td>\n<td style=\"width: 137px; height: 36px;\">Larger than 2 cm in diameter</td>\n</tr>\n<tr style=\"height: 82px;\">\n<td style=\"width: 137px; height: 82px;\">\n<p>Predilection for the appendicular skeleton</p>\n</td>\n<td style=\"width: 137px; height: 82px;\">involves the posterior spine (laminae and pedicles)</td>\n</tr>\n<tr style=\"height: 118px;\">\n<td style=\"width: 137px; height: 118px;\">\n<p>Thick rind of reactive cortical bone is seen on radiography</p>\n</td>\n<td style=\"width: 137px; height: 118px;\">\n<p>Usually, no marked bony reaction is seen on radiography</p>\n&nbsp;</td>\n</tr>\n<tr style=\"height: 137px;\">\n<td style=\"width: 137px; height: 137px;\">\n<p>Pain that is relieved by aspirin and other non-steroidal anti-inflammatory agents</p>\n</td>\n<td style=\"width: 137px; height: 137px;\">Pain which is unresponsive to aspirin</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/5/58/Osteoblastoma_-_high_mag.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6164edb71bed4728a7bd0b2d97285228x1280x2018.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c59a1839deb469587252689465e3e29x1280x2018.JPEG"
    ]
  },
  {
    "text": "A 17-year-old man presents with progressive swelling of the upper end of the humerus. He also complains of arm pain and weight loss for 3 months. X-ray findings are given below. Which of the following is associated with a higher risk of developing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Germline mutation of p53"
      },
      {
        "id": 2,
        "text": "Translocation (X;18)"
      },
      {
        "id": 3,
        "text": "Translocation (12;16)"
      },
      {
        "id": 4,
        "text": "1p rearrangements"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option A: Translocation (X;18) is characteristic of synovial sarcoma.</p>\n<p>Option B: Translocation (12;16) is characteristic of myxoid liposarcoma.</p>\n<p>Option D: 1p rearrangements are characteristic of conventional chondrosarcoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c09eabde3e5849e8a0ac707564c5a802.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b1120dafd02440dcab1481d0e7c4b735x1280x1547.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false about osteosarcoma?",
    "choices": [
      {
        "id": 1,
        "text": "It usually arises in the diaphyseal region of long bones"
      },
      {
        "id": 2,
        "text": "It has a bimodal age distribution"
      },
      {
        "id": 3,
        "text": "Codman triangle is characteristic of the tumor"
      },
      {
        "id": 4,
        "text": "Most common subtype is osteoblastic and high grade"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Radiography</strong> shows a large destructive, mixed lytic and blastic mass with infiltrative margins, which breaks through the cortex and lifts the periosteum, resulting in reactive periosteal bone formation. The triangular shadow between the cortex and raised ends of the periosteum, known radiographically as&nbsp;the<strong> Codman triangle, </strong>is characteristic of osteosarcoma. This is shown in the radiograph below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3602220997a421ba0428ced47b8ae91x1280x1055.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c700788a5b34f5c83c36ae0f6ba6339x1280x1407.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62c554c4c4584b4c8e4445ae24ed7c6cx1280x2155.JPEG"
    ]
  },
  {
    "text": "Which of the following bone tumors is characteristically seen in patients with Ollier disease and Maffucci syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Enchondromas"
      },
      {
        "id": 2,
        "text": "Osteochondromas"
      },
      {
        "id": 3,
        "text": "Osteiod osteomas"
      },
      {
        "id": 4,
        "text": "Chondrosarcomas"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Ollier disease</strong> and <strong>Maffucci syndrome</strong> are nonhereditary disorders characterized by <strong>multiple enchondromas</strong>. Maffucci syndrome is, in addition, distinguished by the presence of spindle-cell hemangiomas.</p>\n<p><strong>Enchondromas </strong>are benign tumors of hyaline cartilage that usually occur in bones of enchondral origin. They are usually diagnosed in individuals 20 to 50 years of age. They present as <strong>solitary metaphyseal lesions</strong> of tubular bones of the <strong>hands</strong> and <strong>feet.</strong></p>\n<p>The radiographic features consist of circumscribed lucencies with central irregular calcifications, a sclerotic rim, and an intact cortex. They are usually smaller than 3 cm. They are gray-blue and translucent, composed of well-circumscribed nodules of<strong> hyaline cartilage </strong>containing cytomorphologically<strong> benign chondrocytes.</strong></p>\n<p>The enchondromas in Ollier disease and Maffucci syndrome are sometimes more cellular than sporadic enchondromas and exhibit cytologic atypia<strong>,</strong> making them more difficult to distinguish from chondrosarcomas.</p>\n<p>The image below displays the histopathological picture of an enchondroma showing lobules of hyaline cartilage encased by bone and covered by perichondrium (fibrous tissue).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a50c069535534215a6c90f1cc0cc3cd3x1280x2028.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b06f14b379a546d1979aa638ff4d2f51x1280x2028.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is not true about chondrosarcoma?",
    "choices": [
      {
        "id": 1,
        "text": "Conventional central tumors constitute about 90% of chondrosarcomas."
      },
      {
        "id": 2,
        "text": "Clear cell and the mesenchymal variants occur in older patients."
      },
      {
        "id": 3,
        "text": "Chondrosarcomas commonly arise in the axial skeleton."
      },
      {
        "id": 4,
        "text": "In multiple hereditary exostosis, osteochondromas progress to chondrosarcoma."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>clear cell</strong> and the <strong>mesenchymal variants</strong> of <strong>chondrosarcoma</strong> occur in <strong>younger patients </strong>(teens or 20s).</p>\n<p>Chondrosarcomas are malignant tumors that produce cartilage. They commonly <strong>arise</strong> in the<strong> axial skeleton</strong>, especially the pelvis, shoulder, and ribs.</p>\n<p>They are subclassified histologically as following variants:</p>\n<ul>\n<li><strong>Conventional</strong> (hyaline cartilage producing) - 90% cases</li>\n<li><strong>Clear cell</strong></li>\n<li><strong>Dedifferentiated</strong></li>\n<li><strong>Mesenchymal</strong></li>\n</ul>\n<p>In<strong> multiple hereditary exostosis</strong>, osteochondromas can progress to chondrosarcoma.&nbsp;<strong>Increased thickness</strong> of the<strong> cartilage cap</strong> has been reported as an indicator of potential malignancy. The average age of secondary chondrosarcoma is younger than patients with primary tumors.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can progress to become chondrosarcoma?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 5"
      },
      {
        "id": 2,
        "text": "1, 3 and 5"
      },
      {
        "id": 3,
        "text": "2, 3 and 4"
      },
      {
        "id": 4,
        "text": "1, 2 and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Osteochondromas, multiple enchondromas, and synovial chondromatosis can progress to become chondrosarcoma.</p>\n<p>The average age of patients with <strong>secondary chondrosarcoma</strong> is 35 years (less than that of those with primary tumors). These tumors most commonly affect the pelvic bones. The <strong>increased thickness</strong> of the <strong>cartilage cap</strong> (normally 1&ndash;3 mm) is considered an indicator of potential malignancy.</p>\n<p><strong>Multiple enchondromas</strong>&nbsp;in the setting of Ollier&rsquo;s disease or Maffucci's syndrome carry a significantly higher risk of transformation to secondary chondrosarcoma than solitary enchondromas. Histological findings of abundant myxoid change, cyst formation, and permeation of existing trabeculae suggest malignancy.</p>\n<p>Secondary malignancy in <strong>synovial chondromatosis</strong> has been reported, but it is rare.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A plain radiograph of a patient shows a destructive lytic tumor that extends into the surrounding soft tissues with a characteristic onion-skin appearance. A biopsy image is shown below. Which of the following is not true about the tumor?",
    "choices": [
      {
        "id": 1,
        "text": "It is the second most common group of bone sarcomas in children"
      },
      {
        "id": 2,
        "text": "It arises in the epiphysis of long tubular bones"
      },
      {
        "id": 3,
        "text": "Most of these tumours contain a (11;22) (q24;q12) translocation"
      },
      {
        "id": 4,
        "text": "The amount of chemotherapy-induced necrosis is an important prognostic finding"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Most Ewing sarcoma family tumors&nbsp;contain an <strong>(11;22)</strong> (q24;q12) translocation. Variant translocations fuse the&nbsp;EWS&nbsp;to other members of the ETS transcription factor family.<strong> CD99(MIC2)</strong>, <strong>FLI1</strong>, and<strong> NSE</strong> would be positive in ES/PNET.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/abed0838a2e8484eb134c268e564c51e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/06aaa86af1cf4c0c8bcfe630e7e5513ax1280x1050.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/32241ab4ecf64ee7bae4404a2e4e74fcx1280x1407.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman presents with a 1-month history of pain in the left knee, which is tender on palpation. X-ray shows a 5 cm mass in the distal femoral epiphysis, with a soap bubble appearance. Microscopy is as seen below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chondroblastoma"
      },
      {
        "id": 2,
        "text": "Osteoclastoma"
      },
      {
        "id": 3,
        "text": "Osteosarcoma"
      },
      {
        "id": 4,
        "text": "Osteochondroma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Typically, they are treated with curettage, but <strong>40% to 60% recur locally. </strong></p>\n<p>Up to 4% of tumors metastasize to the lungs, but these sometimes spontaneously regress and they are rarely fatal.&nbsp;The RANKL inhibitor, <strong>denosumab, </strong>has shown promise as adjuvant therapy in GCT.</p>\n<p>&nbsp;Note: The<strong>&nbsp;</strong>E mnemonic for GCT:</p>\n<ul>\n<li>Epiphyseal</li>\n<li>Eccentric</li>\n<li>Egg-shell crackling</li>\n<li>Expansile</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4b1261f476b94fb694e92937c5080dcb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59134cc2f2294368a2e21b7f7d284e71x1280x1057.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7a2a861e88c54d748588fd2d89d54fe2x1280x1312.JPEG"
    ]
  },
  {
    "text": "A 19-year old man presents with back pain for 2 months. MRI of the spine reveals a bony cystic mass at the L1 vertebra. Biopsy shows multiple, blood-filled cystic spaces separated by septae, composed of multinucleated osteoclast-like giant cells and reactive woven bone. There is no cartilage or necrosis. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteoclastoma"
      },
      {
        "id": 2,
        "text": "Aneurysmal bone cyst"
      },
      {
        "id": 3,
        "text": "Chondroblastoma"
      },
      {
        "id": 4,
        "text": "Fibrous cortical defect"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of an&nbsp;<strong>aneurysmal bone cyst. </strong></p>\n<p>It affects all age groups, but generally occurs during the <strong>first 2 decades of life</strong> and has no sex predilection. It usually occurs in the<strong> metaphysis </strong>of<strong> long bones </strong>and the posterior elements of<strong> vertebral bodies.</strong></p>\n<p>This&nbsp;is a tumor characterized by <strong>multiloculated blood-filled cystic spaces&nbsp;</strong>separated by septae, composed of multinucleated osteoclast-like giant cells and reactive woven bone. Radiographically, an aneurysmal bone cyst is seen as an <strong>eccentric, expansile, lesion</strong> with<strong> well-defined margins.&nbsp;</strong>Most lesions are completely lytic and often contain a thin shell of reactive bone at the periphery.</p>\n<p>The spindle cells of aneurysmal bone cyst frequently demonstrate rearrangements of chromosome 17p13, leading to USP6 overexpression.</p>\n<p>The majority of secondary aneurysmal bone cysts arise in association with:</p>\n<ul>\n<li>Benign neoplasms\n<ul>\n<li>Giant-cell tumor of the&nbsp;bone (most common)</li>\n<li>Chondroblastoma</li>\n<li>Osteoblastoma</li>\n<li>Fibrous dysplasia</li>\n</ul>\n</li>\n<li>Osteosarcoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old patient complains of severe back pain for 2 months, which worsens at night. An MRI shows multiple osteoblastic secondaries on the vertebrae. Which of the following tumors could be the primary source of these lesions?",
    "choices": [
      {
        "id": 1,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 2,
        "text": "Prostatic adenocarcinoma"
      },
      {
        "id": 3,
        "text": "Adenocarcinoma lung"
      },
      {
        "id": 4,
        "text": "Multiple myeloma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Prostatic adenocarcinoma</strong> is associated with predominantly <strong>osteoblastic secondaries</strong> to the bones <strong>(vertebral column).</strong></p>\n<p>The radiographic appearance of <strong>bone metastases</strong> may be purely <strong>lytic</strong> (bone destroying), purely <strong>blastic</strong> (bone-forming), or <strong>mixed</strong> lytic and blastic. Most cancers are associated with predominantly one pattern or the other.</p>\n<p>Parathyroid hormone-related protein <strong>(PTHrP)</strong> and transforming growth factor-&beta; <strong>(TGF-&beta;)</strong> are implicated in <strong>osteolytic</strong> secondaries, while proteins such as <strong>endothelin-1</strong> and <strong>morphogenetic proteins</strong>&nbsp;are implicated in <strong>osteoblastic</strong> lesions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '65 Developmental Disorders,Infections And Tumors Of Bone';
        const quizFilename = '65-developmental-disorders-infections-and-tumors-of-bone-9640c72c.html';
        let hierarchy = ["Marrow", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>