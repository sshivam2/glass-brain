<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>35 Antiretroviral Drugs - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pharmacology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which class of antiretroviral drugs does nevirapine belong to?",
    "choices": [
      {
        "id": 1,
        "text": "Nucleoside reverse transcriptase inhibitors"
      },
      {
        "id": 2,
        "text": "Non-nucleoside reverse transcriptase inhibitors"
      },
      {
        "id": 3,
        "text": "Nucleotide reverse transcriptase inhibitors"
      },
      {
        "id": 4,
        "text": "Protease inhibitors"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Nevirapine</strong> is a <strong>non-nucleoside reverse transcriptase inhibitor</strong> (NNRTI)</p>\n<p>US FDA has approved doravirine, a new non-nucleoside reverse transcriptase inhibitor(NNRTI) for the treatment of adults with HIV-1 infection given in combination with other ARTs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Resistance to zidovudine develops due to:",
    "choices": [
      {
        "id": 1,
        "text": "Increased efflux of the drug from nucleus"
      },
      {
        "id": 2,
        "text": "Mutations of reverse transcriptase"
      },
      {
        "id": 3,
        "text": "Increased efflux of the drug from inside the cell"
      },
      {
        "id": 4,
        "text": "Decreased zidovudine triphosphate formation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Resistance</strong> to <strong>zidovudine</strong> occurs due to <strong>mutations</strong> in the<strong> reverse transcriptase enzyme.</strong></p>\n<p>The mutations are referred to as <strong>thymidine analog mutations</strong> (TAM) because of their ability to confer <strong>cross-resistance</strong> to other thymidine analogs such as stavudine.</p>\n<p><strong>M184V mutation,</strong> which is associated with the use of lamivudine or emtricitabine, <strong>restores zidovudine susceptibility</strong> in zidovudine-resistant HIV.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient diagnosed with AIDS is planned to be started on a lamivudine-based-antiretroviral therapy. Which of the following drugs will you not add to her regimen?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine"
      },
      {
        "id": 2,
        "text": "Stavudine"
      },
      {
        "id": 3,
        "text": "Emtricitabine"
      },
      {
        "id": 4,
        "text": "Abacavir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Lamivudine</strong> and <strong>emtricitabine</strong> are <strong>not combined</strong> because of similar actions and <strong>no added benefits.</strong> Emtricitabine is a cytidine analog. It is chemically related to lamivudine and shares most of its pharmacodynamic characteristics.</p>\n<p>The same holds good for the <strong>zidovudine and stavudine</strong> combination. Zidovudine and stavudine are thymidine analogues. In fact, efficacy may even decrease because of competition for a similar activation process.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about lamivudine is false?",
    "choices": [
      {
        "id": 1,
        "text": "It is an effective agent for  patients with chronic hepatitis B"
      },
      {
        "id": 2,
        "text": "Dose is lower for blocking HIV replication than HBV replication"
      },
      {
        "id": 3,
        "text": "Should not be used as monotherapy in HBV/HIV infected patients"
      },
      {
        "id": 4,
        "text": "Anti-HBe seroconversion occurs in a minority of the patients"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>daily dose</strong>&nbsp;of lamivudine indicated for <strong>HIV (300 mg) </strong>is<strong> higher than </strong>that of the dose indicated for<strong> HBV (100 mg).</strong></p>\n<p>Lamivudine has <strong>both anti-HIV</strong> and <strong>anti-HBV</strong> activity and is an <strong>effective</strong> agent for patients with <strong>chronic hepatitis</strong> <strong>B</strong>. It should not be used alone because resistance can rapidly emerge in HIV viruses.</p>\n<p>Anti-HBe seroconversion occurs in only a minority of the patients taking lamivudine.</p>\n<p>Drugs that cause anti-HBe seroconversion:</p>\n<ul>\n<li>Lamivudine</li>\n<li>Entecavir</li>\n<li>Adefovir</li>\n<li>Tenofovir</li>\n<li>Telbivudine</li>\n<li>Pegylated interferon</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient on antiretroviral therapy presents with severe tingling and numbness in the legs. On examination, you find that his tendon reflexes are reduced. Which of the following drugs has the highest propensity to cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine"
      },
      {
        "id": 2,
        "text": "Lamivudine"
      },
      {
        "id": 3,
        "text": "Stavudine"
      },
      {
        "id": 4,
        "text": "Didanosine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The scenario is suggestive of peripheral neuropathy. The drug causing<strong> maximum peripheral neuropathy </strong>is<strong> stavudine.</strong></p>\n<p>The incidence of peripheral neuropathy is very rare with both zidovudine and lamivudine. <strong>Lamivudine</strong>&nbsp;is considered one of the<strong>&nbsp;least toxic</strong> antiretroviral agents.</p>\n<p>Didanosine is frequently associated with peripheral neuropathy, but stavudine is associated with the highest risk of peripheral neuropathy.</p>\n<p>Note:<strong> Zalcitabine&nbsp;</strong>was&nbsp;associated with a&nbsp;<strong>higher incidence&nbsp;</strong>of peripheral neuropathy. It&nbsp;is no longer marketed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs are not protease inhibitors?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "2 and 4"
      },
      {
        "id": 3,
        "text": "3 and 5"
      },
      {
        "id": 4,
        "text": "1 and 5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Abacavir </strong>is a guanosine analogue and is a <strong>nucleoside reverse transcriptase inhibitor.</strong></p>\n<p><strong>Raltegravir </strong>is an<strong> integrase inhibitor.</strong></p>\n<p>Nelfinavir, saquinavir and ritonavir are protease inhibitors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During a clinical trial, it was noted that the bioavailability of some drugs was substantially improved on ritonavir administration. Which of the following drugs does not exhibit this property?",
    "choices": [
      {
        "id": 1,
        "text": "Saquinavir"
      },
      {
        "id": 2,
        "text": "Lopinavir"
      },
      {
        "id": 3,
        "text": "Nelfinavir"
      },
      {
        "id": 4,
        "text": "Darunavir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The bioavailability of <strong>nelfinavir</strong> is <strong>not</strong> substantially <strong>improved with ritonavir</strong> administration because it undergoes metabolism primarily by<strong> CYP2C19 </strong>and <strong>ritonavir</strong> is a <strong>weak inhibitor</strong> of CYP2C19.</p>\n<p>All other protease inhibitors undergo hepatic oxidative&nbsp;metabolism predominantly by the<strong> CYP3A4 </strong>enzyme.&nbsp;<strong>Ritonavir</strong>, being a potent inhibitor of CYP3A4 acts as a <strong>pharmacological booster</strong>&nbsp;in combination&nbsp;with other protease inhibitors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a pharmacological booster with no antiretroviral activity?",
    "choices": [
      {
        "id": 1,
        "text": "Ritonavir"
      },
      {
        "id": 2,
        "text": "Vorinostat"
      },
      {
        "id": 3,
        "text": "Belinostat"
      },
      {
        "id": 4,
        "text": "Cobicistat"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Cobicistat</strong> is a pharmacological booster with <strong>no antiretroviral activity</strong>.</p>\n<p>Cobicistat is a <strong>ritonavir analog</strong> developed as an exclusive <strong>pharmacological booster</strong> that <strong>inhibits</strong> the<strong> CYP3A4 enzyme</strong> and has no antiviral activity. It is&nbsp;available only in combination with atazanavir or darunavir or elvitegravir for HIV infections.</p>\n<p>Ritonavir is also used as a pharmacological booster but it has antiretroviral activity.</p>\n<table style=\"height: 174px;\" width=\"543\">\n<tbody>\n<tr>\n<td style=\"width: 263.5px; text-align: center;\"><strong>Cobicistat</strong></td>\n<td style=\"width: 263.5px; text-align: center;\"><strong>Ritonavir</strong></td>\n</tr>\n<tr>\n<td style=\"width: 263.5px;\">Specific CYP3A4 inhibition</td>\n<td style=\"width: 263.5px;\">\n<p>Potent inhibitor of CYP3A4 and weak inhibitor of CYP2D6</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 263.5px;\">Better tolerated</td>\n<td style=\"width: 263.5px;\">Less tolerated&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 263.5px;\">Reduced impact on plasma lipds</td>\n<td style=\"width: 263.5px;\">Causes dose-dependent elevation in serum total cholesterol and <br />triglycerides</td>\n</tr>\n<tr>\n<td style=\"width: 263.5px;\">Lacks P450 enzyme induction</td>\n<td style=\"width: 263.5px;\">Moderate inducer of P450 enzymes</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;Vorinostat and belinostat are <strong>histone deacetylase inhibitors</strong>.&nbsp;Vorinostat is approved for the treatment of patients with cutaneous T-cell lymphoma with persistent or recurrent disease after two systemic therapies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The antiviral drug having dual antiviral activity against HIV and HBV is:",
    "choices": [
      {
        "id": 1,
        "text": "Enfuviritide"
      },
      {
        "id": 2,
        "text": "Abacavir"
      },
      {
        "id": 3,
        "text": "Emtricitabine"
      },
      {
        "id": 4,
        "text": "Ritonavir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Antiviral</strong> drug having <strong>dual antiviral activity</strong> against <strong>HIV</strong> and <strong>HBV</strong> is <strong>emtricitabine</strong>.</p>\n<p>It is a <strong>nucleoside reverse transcriptase inhibitor</strong> similar to lamivudine. It has activity against HIV-1, HIV-2, and HBV.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a subcutaneously administered drug, that will be helpful in a patient showing high viral load despite good compliance with ART?",
    "choices": [
      {
        "id": 1,
        "text": "Maraviroc"
      },
      {
        "id": 2,
        "text": "Enfuvirtide"
      },
      {
        "id": 3,
        "text": "Raltegravir"
      },
      {
        "id": 4,
        "text": "Emtricitabine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The drug described in this case is <strong>enfuvirtide</strong>, which<strong>&nbsp;</strong>is an anti-HIV drug that is <strong>administered subcutaneously.</strong></p>\n<p class=\"p1\">It is used only in the treatment of those who have evidence of HIV replication (high viral load) despite ongoing antiretroviral therapy.</p>\n<p class=\"p1\">It <strong>binds to&nbsp;the gp41 subunit</strong> of the viral envelope and <strong>prevents the fusion </strong>of the virus to the cellular membranes thereby preventing entry of the virus.</p>\n<p class=\"p1\">Enfuvirtide is active against<strong> HIV-1 only</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient showing treatment failure with multiple antiretroviral drugs is now started on maraviroc. This drug acts against:",
    "choices": [
      {
        "id": 1,
        "text": "CCR5"
      },
      {
        "id": 2,
        "text": "CXCR4"
      },
      {
        "id": 3,
        "text": "CD4"
      },
      {
        "id": 4,
        "text": "CCR5 and CD4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Maraviroc</strong> is a<strong> chemokine receptor antagonist </strong>acting against the <strong>CCR5 receptor</strong>.</p>\n<p>It&nbsp;binds to the host cell CCR-5 receptor and prevents the binding of viral GP-120 to host cells. It is indicated in patients with evidence of infection with predominantly CCR-5 tropic virus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The husband of an AIDS patient noticed that his wife had become forgetful and confused lately. She complained of dizziness and lack of sleep. Eventually, she started behaving bizarrely, paranoid that everybody is trying to kill her. Yesterday she was found in her room talking to somebody who did not exist in reality. Which of the following drugs is most commonly associated with this side effect?",
    "choices": [
      {
        "id": 1,
        "text": "Nevirapine"
      },
      {
        "id": 2,
        "text": "Efavirenz"
      },
      {
        "id": 3,
        "text": "Etravirine"
      },
      {
        "id": 4,
        "text": "Delavirdine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario describes <strong>psychiatric</strong> or<strong> CNS adverse effects</strong>, which are commonly seen with <strong>efavirenz</strong>.</p>\n<p>The CNS/ <strong>psychiatric adverse effects</strong> seen with the use of <strong>efavirenz</strong> are:</p>\n<ul>\n<li>Frank psychosis (depression, hallucinations, and/or mania)&nbsp;</li>\n<li>Impaired concentration</li>\n<li>Dysphoria&nbsp;</li>\n<li>Dizziness</li>\n<li>Vivid dreams</li>\n<li>Insomnia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presenting with low-grade fever and weight loss of 3 months is diagnosed to have HIV-2 infection. Which of the following drugs is not indicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Ritonavir"
      },
      {
        "id": 2,
        "text": "Tenofovir"
      },
      {
        "id": 3,
        "text": "Efavirenz"
      },
      {
        "id": 4,
        "text": "Zalcitabine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Efavirenz</strong> is not indicated for HIV-2 infection. It is a non-nucleoside reverse transcriptase inhibitor (NNRTI).</p>\n<p>NNRTIs are HIV-1 specific and have no activity against HIV-2. The binding site for <strong>NNRTI</strong> is virus <strong>strain-specific</strong> which only <strong>inhibits</strong> the <strong>HIV-1 reverse transcriptase.</strong> It is <strong>approved only</strong> for<strong> HIV-1 infections</strong> and should not be used for HIV-2 infections.</p>\n<p>Ritonavir, tenofovir, and zalcitabine are indicated for HIV-2 infections.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old man who has been on ART for the past two months presents with abdominal pain. On evaluation, he was found to have acute pancreatitis. Which of the following drugs is associated with the highest risk for causing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Didanosine"
      },
      {
        "id": 2,
        "text": "Lamivudine"
      },
      {
        "id": 3,
        "text": "Zidovudine"
      },
      {
        "id": 4,
        "text": "Abacavir"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> maximum risk </strong>of<strong> pancreatitis </strong>is seen with <strong>didanosine. </strong></p>\n<p>It&nbsp;should, therefore not be combined with hydroxyurea, alcohol, or pentamidine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient diagnosed with AIDS is initiated on antiretroviral therapy with zidovudine. Which of the following side effects is he most likely to develop?",
    "choices": [
      {
        "id": 1,
        "text": "Anemia"
      },
      {
        "id": 2,
        "text": "Peripheral neuropathy"
      },
      {
        "id": 3,
        "text": "Lactic acidosis"
      },
      {
        "id": 4,
        "text": "Hepatotoxicity"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient is most likely to develop <strong>anemia</strong> since it is the most common side effect of<strong> zidovudine</strong>.</p>\n<p><strong>Higher dosages </strong>of zidovudine lead to <strong>bone marrow suppression</strong> resulting in anemia and granulocytopenia.</p>\n<p>Peripheral neuropathy, hepatotoxicity, and lactic acidosis are rare side effects of zidovudine.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Of all the nucleoside reverse transcriptase inhibitors, the use of which of the following is most\u00a0strongly\u00a0associated with fat wasting?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine"
      },
      {
        "id": 2,
        "text": "Lamivudine"
      },
      {
        "id": 3,
        "text": "Stavudine"
      },
      {
        "id": 4,
        "text": "Abacavir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Of all the nucleoside reverse transcriptase inhibitors, the<strong>&nbsp;</strong>use of<strong> stavudine</strong>&nbsp;is most&nbsp;strongly&nbsp;associated with <strong>fat wasting</strong> (lipoatrophy).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient on antiretroviral therapy comes to you for follow-up. His lipid profile reveals high cholesterol levels. Which of the following drugs is not associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Atazanavir"
      },
      {
        "id": 2,
        "text": "Saquinavir"
      },
      {
        "id": 3,
        "text": "Amprenavir"
      },
      {
        "id": 4,
        "text": "Nelfinavir"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Atazanavir</strong> is not associated with dyslipidemia, fat redistribution, or metabolic syndrome. This is in contrast to all the other protease inhibitors, which causes side effects like\u00a0<strong>hypertriglyceridemia</strong>,\u00a0<strong>hypercholesterolemia</strong> and other signs of <strong>lipodystrophy</strong>.\u00a0</p>\n<p>\u00a0Patients treated with <strong>atazanavir</strong> have significantly <strong>lower fasting triglyceride</strong> and <strong>cholesterol</strong> concentrations than patients treated with nelfinavir and lopinavir.\u00a0Clinically, when <strong>abacavir</strong> (Nucleoside Reverse Transcriptase Inhibitors)\u00a0is substituted for protease inhibitors in patients having dyslipidemia, it leads to an i<strong>mprovement in lipid profile</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old known hemophiliac on antiretroviral therapy suddenly developed headache, vomiting and altered consciousness and was rushed to a hospital. Which of the following protease inhibitors is implicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Saquinavir"
      },
      {
        "id": 2,
        "text": "Ritonavir"
      },
      {
        "id": 3,
        "text": "Tipranavir"
      },
      {
        "id": 4,
        "text": "Indinavir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of <strong>intracranial hemorrhage</strong> and the protease inhibitor that is associated with this condition is<strong> tipranavir</strong>. It is a non-peptidic protease inhibitor</p>\n<p class=\"p1\">Tipranavir use has been associated rarely with intracranial hemorrhage (including fatalities) and <strong>bleeding episodes</strong> in patients with<strong> hemophilia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient on antiretroviral therapy comes for regular follow-up. You note nail changes as shown below. Which of the following drugs causes this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Abacavir"
      },
      {
        "id": 2,
        "text": "Ritonavir"
      },
      {
        "id": 3,
        "text": "Zidovudine"
      },
      {
        "id": 4,
        "text": "Didanosine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows <strong>nail hyperpigmentation</strong> and it is commonly encountered with the use of zidovudine. This is seen with <strong>c</strong><strong>hronic zidovudine administration.&nbsp;</strong></p>\n<p>The <strong>adverse effects</strong> of <strong>zidovudine</strong> are:</p>\n<ul>\n<li>Fatigue, malaise, myalgia, and anorexia</li>\n<li>Headache and insomnia</li>\n<li>Erythrocytic macrocytosis</li>\n<li>Nail hyperpigmentation</li>\n<li>Myopathy</li>\n<li>Bone marrow suppression - anemia and granulocytopenia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/76b1fcce32a14af98378f43320c5ca9e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which is the only antiretroviral drug that may have teratogenic properties?",
    "choices": [
      {
        "id": 1,
        "text": "Didanosine"
      },
      {
        "id": 2,
        "text": "Emtricitabine"
      },
      {
        "id": 3,
        "text": "Efavirenz"
      },
      {
        "id": 4,
        "text": "Nevirapine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The only antiretroviral drug that may have <strong>teratogenic</strong> properties is <strong>efavirenz.&nbsp;</strong></p>\n<p>It has shown teratogenicity in primates.&nbsp;However, clinical trials have suggested that there is no significantly increased risk of teratogenicity in humans as compared to other antiretroviral drugs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient undergoing treatment for HIV complains of dizziness. On examination, you note his supine BP to be 140/80 mmHg and standing BP to be 110/70 mmHg. Which of the following drugs would have caused this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Maraviroc"
      },
      {
        "id": 2,
        "text": "Raltegravir"
      },
      {
        "id": 3,
        "text": "Enfuvirtide"
      },
      {
        "id": 4,
        "text": "Nelfinavir"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario depicts a case of <strong>orthostatic hypotension</strong> and <strong>maraviroc</strong> is associated with <strong>dose-dependent</strong> and <strong>concentration-dependent</strong> orthostatic hypotension.</p>\n<p>Maraviroc is a chemokine receptor antagonist acting against the <strong>CCR5 receptor</strong>. It binds to the host cell CCR-5 receptor and prevents the binding of viral GP-120 to host cells. It is indicated in patients with evidence of infection with predominantly CCR-5 tropic virus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The ECG of a patient on antiretroviral therapy is shown below. You observe that the QTc = 477 ms. This can be attributed to:",
    "choices": [
      {
        "id": 1,
        "text": "Raltegravir"
      },
      {
        "id": 2,
        "text": "Rilpivirine"
      },
      {
        "id": 3,
        "text": "Etravirine"
      },
      {
        "id": 4,
        "text": "Efavirenz"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given ECG indicates <strong>QT interval prolongation</strong> (normal QTc = 440ms) and this is observed with the use of <strong>rilpivirine. </strong>It is a non-nucleoside reverse transcriptase inhibitor (<strong>NNRTI</strong>).<strong>&nbsp;</strong></p>\n<p>Qtc interval prolongation is observed with higher concentrations of the drug. Caution has to be exercised when rilpivirine is administered along with <strong>CYP3A4 inhibitors</strong> that can<strong> increase</strong> the<strong> concentration </strong>of rilpivirine.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ef1e9f9f002544b5a2a453e8aa910ce3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old HIV-positive man was started on HAART. On follow-up testing, his CD4 cell count had decreased below 200/mm\u00b3. Subsequently, he developed diarrhea and redistribution of body fat. What is false about the causative drug class?",
    "choices": [
      {
        "id": 1,
        "text": "Atazanavir has the lowest propensity to increase total cholesterol levels."
      },
      {
        "id": 2,
        "text": "Tipranavir is used in sub-therapeutic doses as a pharmacodynamic booster in cART."
      },
      {
        "id": 3,
        "text": "Indinavir can cause nephrolithiasis when adequate hydration is not maintained."
      },
      {
        "id": 4,
        "text": "Ritonavir is a potent inhibitor of the CYP3A4 isoform of P450 & may alter levels of drugs."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of <strong>adverse effects</strong> of&nbsp;gastrointestinal tolerance and fat redistribution due to&nbsp;<strong>protease inhibitors</strong>. HAART therapy includes this class of drugs along with 2 nucleoside reverse transcriptase inhibitors +/- NNRTIs.&nbsp;<strong>Ritonavir,&nbsp;</strong>not tipranavir, is used in <strong>sub-therapeutic</strong> <strong>doses</strong> as a pharmacodynamic booster of other protease inhibitors in cART.</p>\n<p>This is because ritonavir is a <strong>potent inhibitor </strong>of the<strong> CYP3A4</strong> isoform of P450. It inhibits their CYP3A-mediated metabolism and permits the use of lower doses of other protease inhibitors. Nelfinavir&nbsp;is the only protease inhibitor&nbsp;not boosted&nbsp;by ritonavir.</p>\n<p><strong>Indinavir</strong> is notable for its tendency to precipitate in the urinary tract, causing <strong>nephrolithiasis</strong>, unless the patient maintains a high state of hydration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An AIDS patient on treatment with  AZT, lamivudine, indinavir, ketoconazole, and cotrimoxazole, develops breast hypertrophy, central adiposity, hyperlipidemia, insulin resistance, and nephrolithiasis. Which of the following drugs could have caused these?",
    "choices": [
      {
        "id": 1,
        "text": "Azidothymidine"
      },
      {
        "id": 2,
        "text": "Indinavir"
      },
      {
        "id": 3,
        "text": "Ketoconazole"
      },
      {
        "id": 4,
        "text": "Lamivudine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Indinavir</strong>, a protease inhibitor, is the most likely cause for these adverse effects.</p>\n<p>Patients being treated with <strong>protease</strong> inhibitors (e.g., indinavir) develop a syndrome involving the <strong>derangement</strong> of <strong>lipid metabolism.</strong> This causes changes in body fat distribution. Type 2 diabetes mellitus has also been reported. This is called&nbsp;<strong>HIV/HAART-associated lipodystrophy.</strong></p>\n<p>Indinavir can also <strong>precipitate</strong> in the urinary tract, causing <strong>nephrolithiasis,</strong> unless the patient is maintained in a high state of hydration.</p>\n<p>Indinavir binds to the site of HIV-1 protease activity and inhibits cleavage of viral gag-pol polyprotein precursors into individual functional proteins required for infectious HIV. This results in the formation of immature, non-infectious viral particles.</p>\n<p><strong>Option A:</strong> Azidothymidine or&nbsp;zidovudine, is a nucleoside reverse transcriptase inhibitor.&nbsp;Chronic zidovudine administration has been associated with nail hyperpigmentation.&nbsp;</p>\n<p><strong>Option C</strong>: Ketoconazole is an antifungal agent that inhibits fungal ergosterol synthesis. Its adverse effects include liver dysfunction and testosterone synthesis inhibition leading to gynecomastia.&nbsp;</p>\n<p><strong>Option D</strong>: Lamivudine is a nucleoside reverse transcriptase inhibitor.&nbsp;It is one of the least toxic antiretroviral drugs. Neutropenia, headache, and nausea have been reported at higher-than-recommended doses.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a monoclonal antibody approved for use in the treatment of HIV?",
    "choices": [
      {
        "id": 1,
        "text": "Bevacizumab"
      },
      {
        "id": 2,
        "text": "Ibalizumab"
      },
      {
        "id": 3,
        "text": "Panitumumab"
      },
      {
        "id": 4,
        "text": "Pembrolizumab"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\"><strong>Ibalizumab</strong> is an <strong>anti-CD4 monoclonal antibody</strong> approved for use in the treatment of&nbsp;<strong>multidrug-resistant HIV-1.&nbsp;</strong>It is administered <strong>intravenously.</strong></p>\n<p style=\"text-align: justify;\">It acts as an entry inhibitor. It blocks HIV-1 from infecting CD4+ T cells by binding to domain 2 of CD4 cells. It also interferes with post-attachment steps required for the entry of HIV-1 virus particles into host cells and thus prevents the viral transmission that occurs via cell-cell fusion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an integrase inhibitor indicated in the treatment of patients with HIV?",
    "choices": [
      {
        "id": 1,
        "text": "Lopinavir"
      },
      {
        "id": 2,
        "text": "Abacavir"
      },
      {
        "id": 3,
        "text": "Raltegravir"
      },
      {
        "id": 4,
        "text": "Ritonavir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"p-rich_text_section\">\n<p>The<strong><span data-preserver-spaces=\"true\"> integrase inhibitor</span></strong><span data-preserver-spaces=\"true\">&nbsp;indicated in the treatment of HIV is&nbsp;</span><strong><span data-preserver-spaces=\"true\">raltegravir</span></strong><span data-preserver-spaces=\"true\">. </span></p>\n<p><span data-preserver-spaces=\"true\">It inhibits the catalytic activity of the HIV-encoded integrase and&nbsp;</span><strong>prevents</strong> the <strong>integration</strong> of <strong>virus DNA</strong> in<strong>to</strong> the <strong>host chromosome</strong><span data-preserver-spaces=\"true\"><strong>.</strong> It is eliminated primarily by glucuronidation by UGT1A1.</span></p>\n<p><span data-preserver-spaces=\"true\">The other two FDA-approved integrase inhibitors are&nbsp;</span><strong><span data-preserver-spaces=\"true\">elvitegravir</span></strong><span data-preserver-spaces=\"true\">&nbsp;(EVG) and&nbsp;</span><strong><span data-preserver-spaces=\"true\">dolutegravir</span></strong><span data-preserver-spaces=\"true\">&nbsp;(DTG).</span></p>\n<p><span data-preserver-spaces=\"true\">Options A and D: Lopinavir and ritonavir are protease inhibitors.</span></p>\n<p><span data-preserver-spaces=\"true\">Option B: Abacavir is a nucleoside reverse transcriptase inhibitor.</span></p>\n<p><span data-preserver-spaces=\"true\">Note:&nbsp;&nbsp;</span><strong><span data-preserver-spaces=\"true\">Dolutegravir&nbsp;</span></strong><span data-preserver-spaces=\"true\">(DTG) is recommended as the preferred third drug for HIV post-exposure prophylaxis as per the recent MOHFW Jan 2020 guideline, in line with WHO.</span></p>\n<p><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;The FDA approved Dolutegravir tablets and suspension to treat HIV-1 infection in pediatric patients at least four weeks old and weighing at least 3 kg who have never been treated for HIV or who have been treated, but not with an integrase inhibitor class of drug.&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:895,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:16777215},&quot;5&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;6&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;7&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;8&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;9&quot;:0,&quot;11&quot;:4,&quot;12&quot;:0}\">The FDA approved dolutegravir tablets and suspension for the treatment of HIV-1 infection in pediatric patients at least four weeks old and weighing at least 3 kg who have never been treated for HIV or who have been treated, but not with an integrase inhibitor class of drug.</span></p>\n<p><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;The FDA approved Dolutegravir tablets and suspension to treat HIV-1 infection in pediatric patients at least four weeks old and weighing at least 3 kg who have never been treated for HIV or who have been treated, but not with an integrase inhibitor class of drug.&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:895,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:16777215},&quot;5&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;6&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;7&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;8&quot;:{&quot;1&quot;:[{&quot;1&quot;:2,&quot;2&quot;:0,&quot;5&quot;:{&quot;1&quot;:2,&quot;2&quot;:0}},{&quot;1&quot;:0,&quot;2&quot;:0,&quot;3&quot;:3},{&quot;1&quot;:1,&quot;2&quot;:0,&quot;4&quot;:1}]},&quot;9&quot;:0,&quot;11&quot;:4,&quot;12&quot;:0}\">WHO recently recommended<strong> long-acting Cabotegravir</strong>, an HIV integrase strand transfer inhibitor may be offered as a <strong>HIV prevention</strong> option for people at substantial risk of HIV infection. It is an <strong>IM injectable</strong> form of <strong>pre-exposure prophylaxis</strong> that has been shown to be highly effective at reducing the risk of HIV acquisition. The first<strong> 2 injections</strong> were administered <strong>4 weeks apart</strong>, followed thereafter by an <strong>injection every 8 weeks</strong>.</span>&nbsp;</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '35 Antiretroviral Drugs';
        const quizFilename = '35-antiretroviral-drugs-636ea069.html';
        let hierarchy = ["Marrow", "qBank", "Pharmacology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>