<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 14 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following cartilages form a complete ring?",
    "choices": [
      {
        "id": 1,
        "text": "Thyroid cartilage"
      },
      {
        "id": 2,
        "text": "Cricoid cartilage"
      },
      {
        "id": 3,
        "text": "Cuneiform cartilage"
      },
      {
        "id": 4,
        "text": "Epiglottis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Cricoid cartilage forms a <strong>complete ring</strong> around the airway and this is the only laryngeal cartilage to do so.</p>\n<p>Clinical significance:</p>\n<ul>\n<li><strong>Sellick's maneuver -&nbsp;</strong>Cricoid pressure is applied to occlude the esophagus without occluding the airway. It prevents&nbsp;regurgitation of gastric contents during intubation and rapid induction of anesthesia.</li>\n<li>The cricoid cartilage is the <strong>narrowest part</strong> of the pediatric airway.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An inhaled foreign body is likely to lodge in the right lung due to all of the following features except _______",
    "choices": [
      {
        "id": 1,
        "text": "Right lung is shorter and wider than the left"
      },
      {
        "id": 2,
        "text": "Right principal bronchus is more vertical than the left bronchus"
      },
      {
        "id": 3,
        "text": "Tracheal bifurcation directs the foreign body to the right lung"
      },
      {
        "id": 4,
        "text": "Right inferior lobar bronchus is in continuation with the principal bronchus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>right principal bronchus</strong> (not the right lung)&nbsp;is<strong> wider, shorter </strong>(2.5 cm)<strong> and more vertical than the left.</strong> The <strong>right inferior lobar bronchus</strong> is the continuation of the bronchus intermedius which is the <strong>continuation of the right principal bronchus</strong>. These differences explain why inhaled foreign bodies enter the right principal bronchus more often than the left.</p>\n<p>The left principal bronchus is narrower, longer (5 cm) and less vertical than the right principal bronchus.</p>\n<p>Option A says right lung and not right bronchus and hence is a wrong answer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following types of collagens is involved in wound healing?",
    "choices": [
      {
        "id": 1,
        "text": "Type II"
      },
      {
        "id": 2,
        "text": "Type III"
      },
      {
        "id": 3,
        "text": "Type IV"
      },
      {
        "id": 4,
        "text": "Type V"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Type III collagen</strong> is involved in <strong>wound healing.</strong></p>\n<p>The tensile strength of the wound is directly proportional to the amount of collagen present, and<strong>\u00a0types I and III</strong> predominate in the skin and aponeurotic layers.</p>\n<p>Approximately <strong>80 percent</strong> of the original strength of the tissue is obtained by <strong>six weeks</strong> after surgery. Wounds slowly continue to get stronger but may never achieve 100 percent of their previous strength.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old man complains of shortness of breath and coughing at night that awakens him from sleep. He is a known case of COPD. On examination, distended neck veins and S3 sounds were noted. The bronchoalveolar lavage of this patient is given below. Identify the marked cells.",
    "choices": [
      {
        "id": 1,
        "text": "Inflammatory cells"
      },
      {
        "id": 2,
        "text": "Siderophages"
      },
      {
        "id": 3,
        "text": "Type I pneumocytes"
      },
      {
        "id": 4,
        "text": "Cardiac smooth muscle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario is suggestive of<strong>&nbsp;</strong>heart failure. The image shows <strong>heart failure cells</strong>, which are&nbsp;<strong>siderophages </strong>or&nbsp;<strong>hemosiderin-containing macrophages</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4b3da306d8d44bc98c914efd936ea1d.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bfd1d3ae980d467785cc750da38e7df4x1280x1570.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ee5a6dd878904ea890a09b3fac62bd3fx640x604.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baa777aa8f4744798d52a9427908e328x1280x1856.JPEG"
    ]
  },
  {
    "text": "A 70-year- old woman was diagnosed with right leg cellulitis and was admitted in hospital for 3 days. She was prescribed clindamycin. Two days after her discharge, she developed diarrhoea and abdominal pain. Her temperature was 38.8 degrees. Her blood reports revealed a Hb level of 12g/dl; WBC count of 18,000/mm3; CRP of 160mg/l. What is the most probable etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "Clostridium difficile"
      },
      {
        "id": 2,
        "text": "Escherichia coli"
      },
      {
        "id": 3,
        "text": "Norovirus"
      },
      {
        "id": 4,
        "text": "Rotavirus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette of a patient with diarrhoea following antibiotic administration is suggestive of <strong>pseudomembranous colitis</strong> due to&nbsp;<strong><em>Clostridium difficile</em>.&nbsp;</strong></p>\n<p>Clostridium difficile is the <strong>most common cause of infectious diarrhoea</strong> in nosocomial infections.&nbsp;<span data-preserver-spaces=\"true\">It is the <strong>most common antibiotic-associated diarrhoea</strong>. It is commonly seen in individuals who receive a prolonged antibiotic course, which causes a change in the composition of gastrointestinal microbial flora, leading to the colonization of C. difficile.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Clinical features:</span></strong></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Lower abdominal pain with loose watery diarrhea.</span></li>\n<li>Fever, leukocytosis</li>\n<li><span data-preserver-spaces=\"true\">In some patients, the disease may progress to life-threatening pseudomembranous colitis.</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Investigations</span></strong><span data-preserver-spaces=\"true\">:</span></p>\n<ul>\n<li>Nucleic acid amplification tests, including PCR assays, for C. difficile toxin A or B gene in stool&nbsp;</li>\n<li>Stool culture in selective media</li>\n<li>Demonstrating toxin by Hep-2 cell cultures</li>\n<li>Toxin gene identification by enzyme immunoassay</li>\n<li>Colonoscopy or sigmoidoscopy&nbsp;<span data-preserver-spaces=\"true\">reveals a characteristic appearance, with&nbsp;</span><strong><span data-preserver-spaces=\"true\">erythema, white plaques</span></strong><span data-preserver-spaces=\"true\">, or an&nbsp;</span><strong><span data-preserver-spaces=\"true\">adherent pseudomembrane.</span></strong></li>\n</ul>\n<p><strong>Nucleic acid amplification tests</strong>, including PCR assays, for C. difficile toxin A or B gene in the stool are used as they are both rapid and sensitive while retaining high specificity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A female patient on lithium tested positive for a urine pregnancy test. Lithium usage in pregnancy can lead to which of the following teratogenic effects?",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac defects"
      },
      {
        "id": 2,
        "text": "Facial defects"
      },
      {
        "id": 3,
        "text": "CNS defects"
      },
      {
        "id": 4,
        "text": "Urogenital defects"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Lithium</strong> use in pregnancy can lead to&nbsp;<strong>cardiac defects</strong>.&nbsp;</p>\n<p><strong>Ebstein's anomaly </strong>is the&nbsp;specific cardiac defect with lithium use in pregnancy.</p>\n<p>In Ebstein&rsquo;s anomaly, the&nbsp;radiological sign seen is a <strong>box-shaped heart</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6fd2b87734be4c3aa034b9c207f08d0ex625x549.PNG"
    ]
  },
  {
    "text": "Identify this complication of burns.",
    "choices": [
      {
        "id": 1,
        "text": "Curling ulcer"
      },
      {
        "id": 2,
        "text": "Marjolin\u2019s ulcer"
      },
      {
        "id": 3,
        "text": "Basal cell carcinoma"
      },
      {
        "id": 4,
        "text": "Malignant melanoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The image shows a 'Marjolin ulcer'.</p>\n<p id=\"H575100\" class=\"headingAnchor\">Marjolin&rsquo;s ulcer is a term used to describe a rare type of SCC (squamous cell carcinoma) which arises in sites of chronic wounds or scars.</p>\n<p class=\"headingAnchor\">The malignant transformation is slow, with an average latency time of approx 30 years.</p>\n<p>The tumor may initially present as an ulceration that fails to heal; nodules may develop as the lesion progresses. Other clinical signs include rolled or everted wound margins, excessive granulation tissue, a rapid increase in size, and bleeding on touch.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5a2eade63af946c1bd8b45835e72e0d9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3rd-year MBBS student is examining a case of deviated nasal septum. Which of the following findings is unlikely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertrophy of turbinates"
      },
      {
        "id": 2,
        "text": "Nasal polyp"
      },
      {
        "id": 3,
        "text": "Epistaxis"
      },
      {
        "id": 4,
        "text": "Maxillary sinus tenderness"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>N</strong><strong>asal polyp&nbsp;</strong>will <strong>not</strong> be seen in a patient with <strong>deviated nasal septum.&nbsp;</strong></p>\n<p><strong>Clinical features of DNS:</strong></p>\n<ul>\n<li><strong>Nasal obstruction -</strong>&nbsp;unilateral in C-shaped deviation and bilateral in S-shaped deviation</li>\n<li><strong>Headache -</strong>&nbsp;may be due to associated sinusitis or due to spur pressing on the lateral wall of the nose</li>\n<li><strong>Sinusitis -</strong> due to obstruction of ostia and poor ventilation of sinuses</li>\n<li><strong>Epistaxis</strong>&nbsp;- from vessels over spur or due to crusting of the nasal mucosa</li>\n<li><strong>Anosmia</strong>&nbsp;- especially in bilateral nasal obstruction</li>\n<li>Compensatory <strong>hypertrophy</strong> of <strong>turbinates</strong> on roomier side</li>\n<li>Frequent <strong>middle ear infections</strong></li>\n<li>Association with&nbsp;<strong>external deformities</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A worried mother brought her son for vision examination when she noticed him reading a book too closely. She says he also narrows his eyes while watching television. Examination revealed myopia. Which of the following lens should be prescribed to correct this child's vision?",
    "choices": [
      {
        "id": 1,
        "text": "Convex"
      },
      {
        "id": 2,
        "text": "Concave"
      },
      {
        "id": 3,
        "text": "Cylindrical"
      },
      {
        "id": 4,
        "text": "Concave + convex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Concave</strong> lenses are used for correcting myopic errors.</p>\n<p>Myopia, also known as 'short sight', is that dioptric condition of the eye in which, with the&nbsp;<strong>accommodation at rest</strong>, incident parallel rays come to a focus anterior to the light-sensitive layer of the retina.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f91fb8bcf7145de8d154b883877458ax1280x1006.JPEG"
    ]
  },
  {
    "text": "Vaccination against which of the following organisms should be administered post-splenectomy?",
    "choices": [
      {
        "id": 1,
        "text": "Streptococcus, Meningococcus, Influenza"
      },
      {
        "id": 2,
        "text": "Meningococcus, Haemophilus influenzae B,  Pneumococcus"
      },
      {
        "id": 3,
        "text": "Haemophilus influenzae B, Staphylococcus aureus, Influenza"
      },
      {
        "id": 4,
        "text": "Streptococcus, Meningococcus, Haemophilus influenzae B"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>All post-splenectomy patients need to be vaccinated against <strong>pneumococcus, meningococcus</strong> <strong>C</strong> (both repeated every 5 years), and\u00a0<em>H. <strong>influenza</strong></em> type B (Hib) (repeated every 10 years).</p>\n<p>If an elective splenectomy is planned, prophylactic vaccinations must be given at least 2 weeks before the elective surgery. In case of an emergency splenectomy, patients should be vaccinated as soon as possible after recovery from surgery but before discharge from the hospital.</p>\n<p>The following vaccines are given :</p>\n<ul>\n<li><strong>Pneumococcal vaccine:</strong> A dose of <strong>PCV13</strong> followed by <strong>PPSV23</strong> \u22658 weeks later is advised. Revaccinate <strong>every five to seven years</strong> thereafter.</li>\n<li><strong>H. influenzae type b vaccine: </strong>A<strong> single dose </strong>of Hib vaccine is recommended. Revaccination is not needed for Hib.</li>\n<li><strong>Meningococcal vaccination: </strong>Two doses of the <strong>MenACWY</strong> vaccine are given \u22658 weeks apart. Revaccination is needed <strong>every five years.</strong></li>\n<li><strong>Influenza vaccination:</strong> Vaccination against seasonal influenza should be given <strong>annually.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A researcher wants to study the changes in the incidence of dengue fever in a particular area over the last 10 years . Which of the following is best suited for plotting this data ?",
    "choices": [
      {
        "id": 1,
        "text": "Line graph"
      },
      {
        "id": 2,
        "text": "Ogive"
      },
      {
        "id": 3,
        "text": "Frequency polygons"
      },
      {
        "id": 4,
        "text": "Histogram"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Line graphs or line diagrams</strong> are the best way to plot the changes in the incidence of a disease&nbsp; with passage of time&nbsp;in a given area.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the objective of each phase of a clinical trial with the phase.",
    "choices": [
      {
        "id": 1,
        "text": "1- C, 2-D, 3-B, 4-A"
      },
      {
        "id": 2,
        "text": "1-D, 2-A, 3-C, 4-B"
      },
      {
        "id": 3,
        "text": "1-B, 2-C, 3-A, 4-D"
      },
      {
        "id": 4,
        "text": "1-A, 2-B, 3-D, 4-C"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct answer is <strong>1- C</strong>, <strong>2-D</strong>, <strong>3-B</strong>, and <strong>4-A</strong>.</p>\n<p>The <strong>phases</strong> of a <strong>clinical trial</strong> and their <strong>objectives</strong> are as given below.</p>\n<p><strong>Phase</strong> <strong>1 </strong>(first in humans) is carried out in 10-100 participants. It aims to test the <strong>safety and tolerability</strong> of the drug. Usually,&nbsp;<strong>healthy volunteers</strong> are chosen. Sometimes patients with an advanced or rare disease are also considered. It generally lasts for <strong>1-2</strong> years.</p>\n<p><strong>Phase</strong> <strong>2 </strong>(first in patients)&nbsp;checks the <strong>efficacy</strong> and <strong>dose-ranging</strong> of the drug. 50-500 patient subjects receive the experimental drug. It lasts for <strong>2-3</strong> years.</p>\n<p><strong>Phase 3 </strong>(multisite trial)&nbsp;is carried out for&nbsp;<strong>confirmation</strong> of the <strong>efficacy</strong> tested in phase 2. The <strong>indications</strong>&nbsp;are finalized and <strong>guidelines</strong> for therapeutic use are formulated. A few hundred to a few thousand patient subjects receive the drug. It lasts for around <strong>3-5</strong> years.</p>\n<p><strong>Phase 4</strong>&nbsp;(postmarketing surveillance) tests for <strong>adverse effects</strong>, or those that occur only after <strong>long-term use</strong> and <strong>drug interactions</strong>. It is done in patients already on treatment with the approved drug. There is <strong>no fixed duration</strong> for this stage.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young patient presents to the clinic with erythematous lesions over the exposed areas of the skin like hands, arms, chest, etc. She also complains of arthralgia and breathlessness. Which among the following antibodies will be useful in diagnosing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Antihistone antibodies"
      },
      {
        "id": 2,
        "text": "Anti dsDNA antibodies"
      },
      {
        "id": 3,
        "text": "Anticentromere antibodies"
      },
      {
        "id": 4,
        "text": "Antinuclear antibodies"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of a patient with a photosensitive rash, arthralgias, and shortness of breath is suggestive of&nbsp;<strong>systemic lupus erythematosus</strong>&nbsp;(SLE). Anti-dsDNA antibodies are specific for the diagnosis of SLE.</p>\n<p>SLE is an&nbsp;<strong>autoimmune disorder</strong>&nbsp;that results in damage to multiple organs and organ systems in the body most commonly seen in&nbsp;<strong>women</strong>&nbsp;of&nbsp;<strong>reproductive age</strong>.&nbsp;&nbsp;</p>\n<p><strong>Clinical</strong>&nbsp;and&nbsp;<strong>immunological manifestations&nbsp;</strong>of<strong>&nbsp;SLE</strong>:</p>\n<ol>\n<li>Skin\n<ul>\n<li>acute, subacute cutaneous manifestations (photosensitivity,&nbsp;<strong>malar</strong>&nbsp;or maculopapular rash)</li>\n<li>chronic cutaneous manifestations (discoid lupus, panniculitis, lichen planus-like)&nbsp;</li>\n</ul>\n</li>\n<li><strong>Oral</strong>&nbsp;or&nbsp;<strong>nasal ulcers</strong></li>\n<li>Non-scarring alopecia</li>\n<li><strong>Synovitis&nbsp;</strong>involving&nbsp;<strong>&ge;2</strong>&nbsp;<strong>joints</strong></li>\n<li>Serositis (pleurisy, pericarditis)</li>\n<li>Renal:&nbsp;\n<ul>\n<li>Protein/Creatinine ratio &gt;0.5</li>\n<li>RBC casts</li>\n</ul>\n</li>\n<li>Neurologic: seizures, psychosis, myelitis, neuropathy, confusional state</li>\n<li>Hemolytic anemia</li>\n<li>Leukopenia</li>\n<li>Thrombocytopenia</li>\n<li><strong>Immunological manifestations</strong>\n<ul>\n<li>Antinuclear antibodies &gt;reference value (positive in &gt;98% patients)</li>\n<li><strong>Anti-dsDNA &gt;reference value (specific)</strong></li>\n<li>Anti-Smith antibody (specific)</li>\n<li>Antiphospholipid antibody (lupus anticoagulant, false-positive rapid plasma reagin)</li>\n<li>Low serum complement</li>\n</ul>\n</li>\n</ol>\n<p>To&nbsp;<strong>diagnose</strong>&nbsp;SLE, at least<strong>&nbsp;4&nbsp;</strong>out of&nbsp;<strong>11&nbsp;</strong>of the above criteria must be positive. However, if a&nbsp;<strong>renal biopsy</strong>&nbsp;is suggestive of&nbsp;<strong>lupus nephritis</strong>&nbsp;and&nbsp;<strong>lupus autoantibodies</strong>&nbsp;are positive then four criteria are not required.&nbsp;</p>\n<p>Antinuclear antibody detection is sensitive for the screening of SLE but not specific to diagnose it.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1503aad5d0284a70b99ff5469c3ba2f3.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "ECG of a patient who presented with palpitations to the ER is shown below. Which of the following is a likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial flutter"
      },
      {
        "id": 2,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 3,
        "text": "Multifocal atrial tachycardia"
      },
      {
        "id": 4,
        "text": "Atrial fibrillation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above ECG shows increased heart rate with <strong>wide QRS complexes</strong> (&gt; 0.12s). This is suggestive of<strong> ventricular tachycardia </strong>(VT).<strong>&nbsp;</strong></p>\n<p>Types of ventricular tachycardia based on QRS morphology:</p>\n<ul>\n<li>Monomorphic<span class=\"term-highlight\">-</span>&nbsp;a stable QRS morphology from beat to beat</li>\n<li>Polymorphic<span class=\"term-highlight\">-</span>&nbsp;changing or multiform QRS variance from beat to beat. Torsades de pointes is an example of polymorphic&nbsp;<span class=\"term-highlight\">ventricular</span>&nbsp;<span class=\"term-highlight\">tachycardia.</span></li>\n<li>Bidirectional-&nbsp;has a beat-to-beat alternation in the QRS frontal plane axis.&nbsp;It is associated with digitalis toxicity or catecholaminergic polymorphic VT.</li>\n</ul>\n<p>The most common cause of VT is ischemic heart disease.</p>\n<p><strong>Ventricular tachyarrhythmias&nbsp;</strong>occur due to impulses that originate within the ventricles. These impulses&nbsp;are conducted through the normal ventricular myocardial cells instead of the fast conducting Purkinje system. Hence, they present with wide QRS complexes ( &gt;0.12 sec) on the ECG.</p>\n<p><strong>Supraventricular tachyarrhythmias</strong>&nbsp;occur due to impulses originating above the ventricles. These impulses reach the ventricles through the proper fast conduction pathway resulting in a narrow QRS complex. SVTs are associated with wide QRS in few exceptional conditions like:</p>\n<ul>\n<li style=\"font-weight: 400;\">Conduction block in the left or right bundle branch</li>\n<li style=\"font-weight: 400;\">Activation of ventricles from an accessory pathway- antidromic AVRT</li>\n</ul>\n<p>The given ECG shows wide stable QRS complexes in monomorphic ventricular tachycardia:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/93840fb290294bfd95cb991894d13e7b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1666033aa7a642a3affcca26e2a304a1x536x141.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ceb2466b8dc4f27816de7b23394db97x1280x2006.JPEG"
    ]
  },
  {
    "text": "MIDAS Questionnaire is used for__________",
    "choices": [
      {
        "id": 1,
        "text": "To asses severity of migraine"
      },
      {
        "id": 2,
        "text": "To asses disability of  migraine"
      },
      {
        "id": 3,
        "text": "To asses treatment of migraine"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Migraine Disability Assessment Score (<strong>MIDAS</strong>)\u00a0questionnaire\u00a0was put together to help <strong>measure</strong> the <strong>impact migraine is having on patients' lives</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly woman is brought to the OPD with complaints of behavioral change, a history of multiple falls, urinary incontinence, and dementia. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Normal pressure hydrocephalus"
      },
      {
        "id": 2,
        "text": "Frontotemporal dementia"
      },
      {
        "id": 3,
        "text": "Parkinson disease"
      },
      {
        "id": 4,
        "text": "Creutzfeldt-Jakob disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>triad of dementia, ataxic or apractic gait</strong>&nbsp;and<strong> urinary incontinence</strong> is seen in <strong>normal pressure hydrocephalus</strong>.</p>\n<p>Normal-pressure hydrocephalus is a&nbsp;<strong>communicating hydrocephalus</strong> caused by delayed resorption of cerebrospinal fluid into the venous system. <strong>Dilated lateral ventricles</strong> are seen on neuroimaging and the <strong>lumbar puncture opening pressure is in the high-normal range</strong>. A history of meningeal scarring conditions such as meningitis, subarachnoid hemorrhage or head trauma can be obtained from some patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Four patients were brought to the casualty after sustaining trauma. Which of the following is the correct match of injuries and signs among the following?",
    "choices": [
      {
        "id": 1,
        "text": "Extra dural hemorrhage (EDH)- Pin point pupil"
      },
      {
        "id": 2,
        "text": "Penetrating injury to eustachian tube- CSF otorrhea"
      },
      {
        "id": 3,
        "text": "Penetrating injury to eye- Battle sign"
      },
      {
        "id": 4,
        "text": "Gaze paresis- Mid brain lesion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Gaze paresis- Mid-brain lesion</strong>, is the correctly matched pair among the given options.</p>\n<div class=\"page\" title=\"Page 354\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Traumatic injury to the brain affecting the<strong> mid-brain</strong> or <strong>brainstem dysfunction</strong> produces:</p>\n<ul>\n<li><strong>Gaze paresis</strong> - Inability of the eye to look across beyond the midline.</li>\n<li>Dysconjugate gaze - Inability of the eyes to work together.</li>\n<li>Roving eye movements.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b81ad47a5644c2d8103e356262e5878x720x631.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c82ff9344d3c4ddb9a29eb5d38231fc1x720x743.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e6b724be8ef48d39be84db0782ceb04x507x478.PNG"
    ]
  },
  {
    "text": "CT brain is indicated for head injury in all conditions except _____.",
    "choices": [
      {
        "id": 1,
        "text": "GCS <13 at any point"
      },
      {
        "id": 2,
        "text": "1 episode of vomiting"
      },
      {
        "id": 3,
        "text": "Focal neurological deficit"
      },
      {
        "id": 4,
        "text": "Age more than 65 years"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A single episode of vomiting after head injury is not an indication for immediate CT brain. However, multiple episodes mandate a scan.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient presented with swelling in his lower limb. The clinical image is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "DVT"
      },
      {
        "id": 2,
        "text": "Lymphatic filariasis"
      },
      {
        "id": 3,
        "text": "Edema"
      },
      {
        "id": 4,
        "text": "Mansonelliasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image is suggestive of <strong>lymphatic f</strong><strong>ilariasis.</strong></p>\n<p>Lymphatic filariasis occurs due to the transmission of <strong>W.bancrofti</strong> by the bite of <strong>Culex</strong> mosquitoes. The third stage larval forms from the mosquito enter the lymphatics and lymph nodes where they develop into adult worms. The adult worms become sexually mature and mate to release microfilariae which enter the peripheral circulation.</p>\n<p>The disease\u00a0<strong>initially</strong>\u00a0causes\u00a0<strong>acute attacks</strong>\u00a0of\u00a0<strong>lymphangitis</strong>\u00a0and\u00a0<strong>lymphadenitis</strong>. Early treatment may even cure the disease.\u00a0The\u00a0<strong>lymphedema</strong>\u00a0may gradually worsen\u00a0and get associated with the thickening of the skin and fibrosis of lymph vessels or blockage by adult worms.\u00a0<strong>Hydrocele</strong>\u00a0is another common manifestation that occurs due to lymphatic obstruction.</p>\n<p>Microfilaria can be <strong>demonstrated</strong> in <strong>blood</strong>, <strong>chylous urine</strong>,\u00a0exudate of lymph varix, and <strong>hydrocele fluid</strong>, however,\u00a0<strong>peripheral blood</strong> is the <strong>preferred choice</strong>. The examination of a <strong>thick </strong>and<strong> thin blood smear </strong>stained with<strong> Giemsa stain</strong> shows the microfilaria. Other methods are by examining the unstained blood under a microscope for the actively motile microfilariae and by acridine orange-microhematocrit tube technique.</p>\n<p>The<strong> best time</strong> to <strong>collect the blood samples</strong> is at<strong> night</strong>, between 10 pm and 4 am as they are <strong>nocturnally periodic</strong>.</p>\n<p><strong>DEC provocation test:\u00a0</strong>In this test, a small dose of DEC is given 20-50 minutes before sample collection so that the microfilaria appears in the blood even during the\u00a0<strong>daytime</strong>.\u00a0</p>\n<p>The image below shows the life cycle of\u00a0<em>Wuchereria bancrofti.</em></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/91bac1ab07a24ad49d6a56fb47b6f12e.png"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60e6d14e93db4330a9efb5ff94ae0b2dx513x435.GIF"
    ]
  },
  {
    "text": "A 38-year-old male patient presented to surgery OPD with a history of intermittent purulent discharge with a slight blood tinge from an external opening located in the perianal region. The location of the external opening was at 8\u2019O clock position. Which of the following statements is false regarding the management of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "MRI is the gold standard modality of investigation"
      },
      {
        "id": 2,
        "text": "Seton's technique induces fibrosis and  has very good evidence of healing"
      },
      {
        "id": 3,
        "text": "Sphincter division can lead on to sphincter dysfunction and incontinence"
      },
      {
        "id": 4,
        "text": "Laying open fistulotomy shows improvement but does not eradicate the disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette is suggestive of&nbsp;<strong>fistula-in-ano.&nbsp;Laying open fistulotomy</strong> is the <strong>surest management</strong> method to <strong>eradicate the disease.&nbsp;</strong></p>\n<p><strong>Fistula-in -ano:</strong></p>\n<p>A fistula-in-ano is an abnormal&nbsp;hollow tract or cavity that is lined with granulation tissue and that connects a primary opening inside the anal canal to a secondary opening in the perianal skin.</p>\n<p>The most common cause is <strong>perianal abscess.&nbsp;</strong>Other causes include&nbsp;<strong>tuberculosis&nbsp;</strong>or&nbsp;<strong>Crohn's disease.</strong></p>\n<p><strong>Symptoms:</strong></p>\n<ul>\n<li>Perianal pain</li>\n<li>Discharge -&nbsp;intermittent purulent discharge (which may be bloody)&nbsp;</li>\n</ul>\n<p><strong>Goodsall's rule:</strong></p>\n<p><strong>Goodsall&rsquo;s rule </strong>can be used as a<strong> guide in determining the location </strong>of the<strong> internal opening </strong>of the fistula.</p>\n<ul>\n<li>Fistulas with an external opening anteriorly connect to the internal opening by a short, radial tract.</li>\n<li>Fistulas with an external opening posteriorly track in a curvilinear fashion to the posterior midline.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2959bbb5b08d404fb11d89d338439808x1280x1730.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/636cf5f6f36946f881278fd1763de2dbx720x720.GIF"
    ]
  },
  {
    "text": "A 23 yr old gravida 1, para 0 at 25 weeks gestation, presents with right upper quadrant pain, nausea, and vomiting for the past 2 days. BP-104/72mm Hg, PR-72bpm.There is generalized edema. Peripheral smear shows hemolysis. Lab values are as follows:\nLeukocyte count: 10,500/mm3\nPlatelet count: 62000/mm3\nHematocrit: 26%\nAST: 90 IU/L\nWhich of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "HELLP Syndrome"
      },
      {
        "id": 2,
        "text": "Hepatitis B"
      },
      {
        "id": 3,
        "text": "Acute fatty liver of pregnancy"
      },
      {
        "id": 4,
        "text": "Obstetric cholestasis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis in this patient is&nbsp;<strong>HELLP syndrome.</strong></p>\n<p>The typical presentation of right upper quadrant pain, nausea, vomiting, lab findings of thrombocytopenia, low hematocrit, and peripheral smear finding of hemolysis, point towards a diagnosis of <strong>&nbsp;HELLP</strong> ( <strong>H</strong>emolysis, <strong>E</strong>levated <strong>L</strong>iver enzymes, <strong>L</strong>ow <strong>P</strong>latelets) syndrome.</p>\n<p>Although related to preeclampsia, <strong>hypertension and proteinuria may be absent or minimal in HELLP syndrome.</strong></p>\n<p><strong>Tennessee criteria</strong> used in the diagnosis of HELLP syndrome :</p>\n<ul>\n<li>Platelet count &lt;1 lakh,</li>\n<li><strong>AST &gt;70 IU/L,</strong></li>\n<li><strong>LDH &gt;600 IU/L</strong></li>\n</ul>\n<p>Risk factors for HELLP syndrome include</p>\n<ul>\n<li>Preeclampsia</li>\n<li>abnormal placentation</li>\n<li>family history of&nbsp;<strong>HELLP syndrome</strong></li>\n<li>elevated levels of fetal <strong>mRNA for FLT l</strong> (vascular endothelial growth factor rfi&shy; receptor 1) and</li>\n<li>Multiparity</li>\n<li>Maternal age &gt;34 years</li>\n<li>European descent</li>\n<li>History of previous poor pregnancy outcomes</li>\n</ul>\n<p>Laboratory evaluation in HELLP:</p>\n<ul>\n<li>Complete blood cell (CBC) count: <strong>Thrombocytopenia, anemia</strong> with possible <strong>reticulocytosis</strong></li>\n<li>Coagulation studies: <strong>Normal prothrombin time</strong>, 50% may have prolonged activated partial thromboplastin time</li>\n<li>Peripheral smear: <strong>Schistocytes, helmet cells, and burr cells</strong> secondary to microangiopathic hemolytic anemia</li>\n<li>Serum<strong> aspartate aminotransferase/alanine aminotransferase (AST/ALT) levels: Elevated </strong>secondary to liver dysfunction</li>\n<li><strong>Lactate dehydrogenase (LDH) level: Elevated</strong> secondary to liver dysfunction or hemolysis</li>\n<li><strong>Elevated blood urea nitrogen (BUN)/creatinine</strong> with acute renal failure</li>\n<li><strong>Bilirubin level: Increased</strong> secondary to hemolysis</li>\n<li><strong>Haptoglobin level: Decreased</strong> secondary to hemolysis</li>\n<li><strong>Fibrinogen levels: Low</strong> secondary to increased coagulation</li>\n<li><strong>D-dimer: Increased</strong> due to fibrinolysis/DIC</li>\n</ul>\n<p>HELLP syndrome may lead to the development of DIC which manifests as <strong>increased </strong>fibrin split products and <strong>decreased</strong> fibrinogen levels.</p>\n<p>Other options:</p>\n<table width=\"455\">\n<tbody>\n<tr>\n<td>\n<p><strong>Disorder</strong></p>\n</td>\n<td><strong>AST (SGOT) U/L</strong></td>\n<td><strong>Bilirubin (mg/dL)</strong></td>\n</tr>\n<tr>\n<td>Cholestasis of pregnancy</td>\n<td><strong>Up to 200</strong></td>\n<td>1&ndash;5</td>\n</tr>\n<tr>\n<td>Acute fatty liver of pregnancy</td>\n<td>200&ndash;800</td>\n<td>4&ndash;10</td>\n</tr>\n<tr>\n<td>Hepatitis</td>\n<td>2000+</td>\n<td>5&ndash;20</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An incidental ovarian mass is found when evaluating a 19-year-old girl for kidney stones. The mass is removed and its contents are shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Immature teratoma"
      },
      {
        "id": 2,
        "text": "Mature teratoma"
      },
      {
        "id": 3,
        "text": "Struma ovarii"
      },
      {
        "id": 4,
        "text": "Granulosa cell tumor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The likely diagnosis in this patient with an<strong> asymptomatic ovarian mass</strong> consisting <strong>hair</strong>,<strong> bone</strong>, and <strong>sebaceous material</strong> is a&nbsp;<strong>mature teratoma</strong>.&nbsp;</p>\n<p>Teratomas are <strong>germ cell tumors</strong>. They contain <strong>embryonic tissues</strong> leading to the differentiation of cells along these pathways. There are three classes of teratomas:</p>\n<ul>\n<li><strong>Mature</strong> (benign) teratomas (eg: Dermoid cyst)</li>\n<li><strong>Immature</strong> (essentially malignant) teratomas (eg: solid teratoma)</li>\n<li><strong>Monodermal</strong> (highly specialized) tumors (eg:&nbsp;Struma ovarii)</li>\n</ul>\n<p><strong>Mature cystic teratoma</strong>,&nbsp;also known as <strong>dermoid cysts</strong>&nbsp;are <strong>unilocular</strong> in structure and have a <strong>smooth</strong> <strong>surface</strong>. They usually are lined by<strong> squamous epithelium</strong> with hair follicles leading to the formation of <strong>sebaceous material</strong> and <strong>hair</strong>. Other structures like<strong> teeth, bone,</strong> cartilage, thyroid tissue, and mucous membranes can also be found.&nbsp;</p>\n<p>Most patients are <strong>asymptomatic</strong>. Some patients may have symptoms because of the mass size of the teratoma. In other patients, ovarian teratomas can result in <strong>torsion</strong> of the <strong>ovary</strong>. Other rare complications include rupture of the cyst and spillage of contents into the abdominal cavity.&nbsp;</p>\n<p>Treatment of mature teratomas involves <strong>excision</strong> in order to prevent complications.&nbsp;Otherwise, mature teratomas are generally innocent.&nbsp;</p>\n<p>Other options:&nbsp;</p>\n<p>Option A - <strong>Immature teratomas</strong> such as <strong>solid teratomas</strong> of the ovary are <strong>solid </strong>and<strong> trabeculated</strong>. They also contain cartilage, bone, hair, and sebaceous material. There is no structural order. They are generally <strong>malignant</strong>. Grossly, they have a smooth external surface and are solid on sectioning. There may be areas of necrosis or hemorrhage.&nbsp;</p>\n<p>The following image shows both mature (left) and immature teratomas (right).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4e9b433750f459dad8e2914ee776bfc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/26aa65c5747f49dc9d64a8a88596b415x720x540.JPEG"
    ]
  },
  {
    "text": "Which of the following peaks marked in the image below is responsible for ovulation ?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The label marked 2 represents the <strong>LH surge</strong>&nbsp;,which is responsible for <strong>ovulation.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d999ae07f9a04233a7ffabe750d752b6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f47c76d509ec45949fa10c209e94afdfx1280x1742.JPEG"
    ]
  },
  {
    "text": "In the pediatric wards, you notice a baby completely preoccupied with play and a mother trying hard to spoonfeed him. He is busy stacking toy cubes on top of each other and starts gleefully clapping once he makes a tower of 6 cubes. What is the likely age that this milestone corresponds to?",
    "choices": [
      {
        "id": 1,
        "text": "15 months"
      },
      {
        "id": 2,
        "text": "24 months"
      },
      {
        "id": 3,
        "text": "18 months"
      },
      {
        "id": 4,
        "text": "36 months"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A child can usually make a<strong> tower of 6</strong> blocks by <strong>24 months.</strong></p>\n<p>A child makes a tower of</p>\n<ul>\n<li>2 blocks by 15 months</li>\n<li>3 blocks by 18 months</li>\n<li><strong>6 blocks by 2 years</strong></li>\n<li>9 blocks by 3 years.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most radiosensitive tumour?",
    "choices": [
      {
        "id": 1,
        "text": "Ewing's sarcoma"
      },
      {
        "id": 2,
        "text": "Melanoma"
      },
      {
        "id": 3,
        "text": "Osteosarcoma"
      },
      {
        "id": 4,
        "text": "Renal cell carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The radiosensitive tumor among the following is <strong>Ewing's sarcoma</strong>. All others are radioresistant tumors.</p>\n<p><strong>Ewing sarcoma i</strong>s a malignant bone tumor characterized by primitive round cells without obvious differentiation. It accounts for&nbsp;<strong>6% to 10% </strong>of primary malignant bone tumors<strong>.</strong></p>\n<p>Ewing sarcoma follows osteosarcoma as the second most common group of bone sarcomas in children. Approximately&nbsp;<strong>80%</strong>&nbsp;of affected patients are&nbsp;<strong>younger than 20 years</strong>. Boys are affected slightly more frequently than girls. Usually, the tumor&nbsp;arises in the <strong>diaphysis of long tubular bones, </strong>especially the<strong> femur </strong>and<strong> the flat bones of the pelvis.&nbsp;</strong>Fever, elevated sedimentation rate, anemia, and leukocytosis may be seen.</p>\n<p>Plain radiographs show a destructive lytic tumor with permeative margins that extend into the surrounding soft tissues.&nbsp;The characteristic periosteal reaction produces layers of reactive bone deposited in an onion-skin fashion.</p>\n<p>Ewing's sarcoma is managed with a combination of <strong>radiotherapy</strong>, <strong>chemotherapy</strong>, and <strong>surgery</strong>. This sarcoma is highly sensitive to radiotherapy and in certain cases, tumors affecting important bones can be treated with radiotherapy or a combination of radiotherapy and chemotherapy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following dementia presents with capgras syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Alzheimer's disease"
      },
      {
        "id": 2,
        "text": "Frontotemporal dementia"
      },
      {
        "id": 3,
        "text": "Lewy body dementia"
      },
      {
        "id": 4,
        "text": "Vascular dementia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Capgras</strong> syndrome is a rare delusion of misidentification where the patient believes that someone close to him has been replaced by an imposter who looks exactly the same. Capgras syndrome along with other visual hallucinations are seen in <strong>Lewy</strong> <strong>body</strong> <strong>dementia</strong> or DLW ( Dementia with lew body). Other symptoms include depression, sleep disorders and delusions</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young male patient was brought to the emergency department in an unconscious state after having suddenly collapsed at a railway station. As there was no pulse felt, cardiopulmonary resuscitation was started and the monitor showed ventricular fibrillation. Immediate defibrillation was performed. What is the next step?",
    "choices": [
      {
        "id": 1,
        "text": "Check for a pulse"
      },
      {
        "id": 2,
        "text": "Resume chest compressions"
      },
      {
        "id": 3,
        "text": "Epinephrine 1 mg IV"
      },
      {
        "id": 4,
        "text": "Amiodarone 300 mg IV bolus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Chest compressions</strong> should be resumed immediately following shock delivery.</p>\n<p><strong>Pulse check </strong>and <strong>reanalysis</strong> of the<strong> cardiac rhythm</strong> is performed only after 2 minutes of chest compression and rescue breaths.</p>\n<p>This is because the heart is temporarily stunned by a defibrillator shock and so chest compressions would benefit by providing coronary blood flow during this period.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A baby presents to the OPD and the findings are shown in the image below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Portwine stain"
      },
      {
        "id": 2,
        "text": "Cavernous hemangioma"
      },
      {
        "id": 3,
        "text": "Naevus simplex"
      },
      {
        "id": 4,
        "text": "Capillary hemangioma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows a <strong>capillary hemangioma</strong> involving the left upper lid and periocular area.<strong>\u00a0</strong>A capillary haemangioma is the <strong>most common tumor</strong> of the<strong> orbit and periorbital area</strong> in childhood.</p>\n<p>Hemangioma is a benign tumor caused by the abnormal growth of blood vessels. Types of hemangioma are:</p>\n<ol>\n<li><strong>Capillary hemangioma</strong>\u00a0(most common)</li>\n<li>Juvenile/ strawberry hemangioma</li>\n<li>Cavernous hemangioma</li>\n<li>Pyogenic hemangioma</li>\n</ol>\n<p><strong>Capillary hemangioma</strong>\u00a0may present as small isolated lesions or large masses that can cause visual impairment (due to mechanical ptosis and the resulting sensory deprivation amblyopia), systemic effects (severe thrombocytopenia), or exist as part of PHACE syndrome (Posterior fossa anomalies, Hemangioma, Arterial lesions, Cardiac abnormalities, Eye or Endocrine abnormalities)</p>\n<p>30% of lesions resolve by the age of 3 years and about 75% by the age of 7. On histology, they show thin-walled capillaries with scant stroma as shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ffe8f48a3840456da3443d83cd7d25e7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0ed5d3a88e54e9c80ed60be29c1c170x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f8dc79df1495406daa68492d0dd7f1b2x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d2344b0830b492b963eb37f00ddc3d5x800x494.JPEG"
    ]
  },
  {
    "text": "A newborn presents with jaundice for 15 days. He has clay-colored stools and hepatomegaly. Ultrasound is performed and shown below. What is the name of the ultrasound finding?",
    "choices": [
      {
        "id": 1,
        "text": "Falciform ligament sign"
      },
      {
        "id": 2,
        "text": "Triangular cord sign"
      },
      {
        "id": 3,
        "text": "Double bubble sign"
      },
      {
        "id": 4,
        "text": "Target sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The newborn with persistent jaundice for more than 14 days, clay-coloured stool, and hepatomegaly is likely to have <strong>biliary atresia</strong>. The ultrasound confirms the diagnosis by demonstrating the <strong>triangular cord sign</strong>.\u00a0</p>\n<p>The <strong>triangular cord sign</strong> represents the <strong>cone-shaped fibrotic mass</strong> cranial to the bifurcation of the portal vein. This density is echogenic and represents the fibrous remains of the porta hepatis. A <strong>\u2265 4 mm thickness</strong> of the echogenic anterior wall of the right portal vein (EARPV) measured on a longitudinal ultrasound scan, strongly suggests biliary atresia.</p>\n<p><strong>Biliary atresia</strong> is a rare, life-threatening condition in <strong>newborns</strong> where the<strong> bile ducts</strong> inside or outside the liver are<strong> blocked or absent</strong>, preventing bile flow from the liver to the intestine. This leads to bile buildup, liver damage, and eventually <strong>cirrhosis </strong>if untreated. The exact cause is unknown, but it may involve genetic and environmental factors. Symptoms include<strong> jaundice</strong>, pale stools, dark urine, and an enlarged liver. Diagnosis involves blood tests, imaging, and sometimes a <strong>liver biopsy</strong>. The primary treatment is the <strong>Kasai procedure,</strong> which can restore bile flow, but many children eventually require a liver transplant.</p>\n<p>Other options:\u00a0</p>\n<p>Option A: The <strong>falciform\u00a0ligament sign</strong> is seen in the case of <strong>pneumoperitoneum.</strong> Here, the air outlines the appearance of the falciform ligament as seen in the X-ray below.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bd4ea37352024d81bd2541b874705b7d.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f66f916ed17450e9dc4793bc998559dx765x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae19bbf2d3f74cb08f4262835e491740x796x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/24c6adc2768443568f550c799518f342x630x535.JPEG"
    ]
  },
  {
    "text": "The Bone scan in multiple myeloma shows _____",
    "choices": [
      {
        "id": 1,
        "text": "Hot spot"
      },
      {
        "id": 2,
        "text": "Cold spot"
      },
      {
        "id": 3,
        "text": "Diffusely increased uptake"
      },
      {
        "id": 4,
        "text": "Diffusely decreased uptake"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Bone scan in <strong>multiple myeloma</strong> shows\u00a0<strong>cold spot,\u00a0</strong>as there is <strong>no compensatory osteoblastic activity.</strong></p>\n<p>Multiple myelomas are the most common primary malignant bone neoplasm in adults arising from red marrow due to the monoclonal proliferation of the <strong>plasma cells.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 14';
        const quizFilename = 'fmge-mini-test-14-b6df0570.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>