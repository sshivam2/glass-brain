<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrhythmias Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An elderly man was brought to the hospital with complaints of rapid heartbeat, increased sweating, and dizziness. His ECG is shown below and his BP is 126/82 mm of Hg. The doctor asked him to lie down and turn his head to the left side. He then applied pressure on the right carotid artery just below the angle on the mandible, which lowered the patient's heart rate. Which among the following is the afferent nerve for the manoeuvre performed by the doctor?",
    "choices": [
      {
        "id": 1,
        "text": "Vagus nerve"
      },
      {
        "id": 2,
        "text": "Cranial accessory nerve"
      },
      {
        "id": 3,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 4,
        "text": "Trigeminal nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ECG is suggestive of\u00a0paroxysmal supraventricular tachycardia (PSVT). As the patient is stable, the doctor has performed a carotid sinus massage to slow the heart rate and to convert to sinus rhythm. This stimulates the <strong>baroreceptor reflex</strong>, whose <strong>afferent</strong> nerve is the <strong>glossopharyngeal nerve.\u00a0</strong></p>\n<p>Features suggestive of PSVT are:</p>\n<ul>\n<li>Narrow complex tachycardia at 150 bpm</li>\n<li>No visible P waves</li>\n<li>Pseudo R\u2019 waves in lead aVR due to retrograde atrial activation</li>\n</ul>\n<p><strong>Carotid sinus massage:</strong></p>\n<p><strong>Procedure</strong>- It is performed with the patient supine and the head turned slightly away from the side being stimulated. Before performing massage the doctor should always auscultate to check for the presence of <strong>carotid bruit</strong>. If bruit is present, it should not be performed. The area of the carotid sinus, at the artery\u2019s bifurcation, is palpated with two fingers at the angle of the jaw until a good pulse is felt. A minimal amount of pressure is applied over the carotid sinus. If there is no effect, a side-to-side or rotating motion of the fingers over the site is performed for up to 5 seconds. ECG should be performed to assess the response.</p>\n<p><strong>Mechanism</strong>- Pressure over the carotid sinus stimulates the baroreceptors. These\u00a0signals are transmitted through small <strong>Hering\u2019s nerves</strong> to the <strong>glossopharyngeal nerves</strong> and then to the <strong>nucleus tractus solitarius (NTS)</strong> in the medulla. These signals<strong> inhibit</strong> the <strong>vasoconstrictor</strong> center of the medulla and <strong>excite</strong> the <strong>vagal</strong> parasympathetic centre. The <strong>stimulation of the vagus</strong> results in a <strong>slowing </strong>of<strong> impulse generation </strong>in the <strong>SA node </strong>and a\u00a0<strong>slowing </strong>of <strong>conduction </strong>velocity in the\u00a0<strong>AV node.\u00a0\u00a0</strong></p>\n<p>Other vagal maneuvers which are used to treat cardiac arrhythmias and conduction abnormalities are,</p>\n<ul>\n<li><strong>Valsalva manoeuvre- </strong>the patient is placed in a supine or semirecumbent position and instructed to exhale forcefully against a closed glottis. The patient should maintain this strain for 10-15 seconds and then start breathing normally. It decreases the heart rate and can be used in paroxysmal supraventricular tachycardia.</li>\n<li><strong>Diving reflex</strong>- A patient holds his breath and then immerses his face in the water at a temperature of 10-20 degrees Celsius. It results in bradycardia and can be used to terminate paroxysmal supraventricular tachycardia.\u00a0</li>\n</ul>\n<p>Note- <strong>Vagus nerve</strong> is an afferent for the impulses from the\u00a0<strong>aortic baroreceptors</strong> in the arch of the aorta.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fb84773b563b4299bc37f215b6f46326.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The electrocardiogram of a patient is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Right bundle branch block"
      },
      {
        "id": 2,
        "text": "Left bundle branch block"
      },
      {
        "id": 3,
        "text": "Wolff-Parkinson-White (WPW) syndrome"
      },
      {
        "id": 4,
        "text": "Ventricular bigeminy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given ECG shows <strong>broad QRS complexes</strong>,<strong> rSR' pattern in lead V1</strong>, and a <strong>curved S wave </strong>which is <strong>wider than the R wave</strong> <strong>in</strong> <strong>lead V6</strong>. This points to a diagnosis of <strong>right bundle branch block (RBBB)</strong>.</p>\n<p>To make a diagnosis of <strong>RBBB</strong>, the following <strong>three criteria</strong> should be met:</p>\n<ol>\n<li><strong>QRS duration</strong> <strong>&gt;120 ms</strong>.</li>\n<li><strong>rSR' pattern</strong> present in <strong>leads V1 or V2</strong>. The R' is usually wider than the initial R wave.</li>\n<li><strong>S wave</strong>&nbsp;of <strong>greater duration than</strong> the <strong>R wave</strong> <strong>in</strong> leads <strong>V6</strong>.</li>\n</ol>\n<p>Bundle branch blocks occur due to a block in the conduction in the right or the left bundle system below the AV node. <strong>RBBB</strong> is often seen <strong>in patients with no underlying heart disease</strong>, while<strong> left bundle branch block (LBBB)</strong> is seen <strong>associated</strong> <strong>with</strong> <strong>ischemic heart disease</strong>, cardiomyopathy and valvular heart disease.</p>\n<p>Other options:</p>\n<p>Option B: The ECG findings suggestive of LBBB include:</p>\n<ul>\n<li><strong>QRS duration &gt;120 ms</strong></li>\n<li><strong>Broad</strong>, <strong>notched</strong>, or slurred <strong>R wave in leads V5 or V6</strong></li>\n<li><strong>Absent</strong> <strong>q waves</strong> in leads <strong>V5</strong> or <strong>V6</strong></li>\n<li>QS (no preceding R wave) or <strong>rS (small R wave but deep S wave) complexes in lead V<sub><span class=\"s1\">1</span></sub></strong></li>\n</ul>\n<p>The image below shows QRS patterns in the right and left bundle branch blocks:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e91e27e1966344beb7cd8a2a37f6486e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c25fda932444e058fad28ffd192b1d4x464x198.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b6b60c43d635464cb01fa09742412987x800x224.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b4739d9b61746c8ae7a653e186b93d7x800x408.JPEG"
    ]
  },
  {
    "text": "A patient presented to the emergency room and was diagnosed with an arrhythmia. The duty doctor tried to manage it by performing a carotid sinus massage. A normal pacemaker potential curve is shown in the image below. Identify the change expected to be seen in this curve after carotid sinus massage.",
    "choices": [
      {
        "id": 1,
        "text": "Increased slope of phase 4"
      },
      {
        "id": 2,
        "text": "Decreased slope of phase 4"
      },
      {
        "id": 3,
        "text": "Decreased slope of phase 0"
      },
      {
        "id": 4,
        "text": "Increased slope of phase 0"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The change expected to be seen in this patient after carotid sinus massage is a\u00a0<strong>decrease in the slope of phase 4 </strong>of the\u00a0pacemaker potential curve.</p>\n<p>Carotid sinus massage is a <strong>vagal</strong> <strong>maneuver</strong> that is used to treat arrhythmias by activating the baroreceptor mechanism. The carotid sinus contains baroreceptors that get activated on physical manipulation. This mechanism, via the nucleus tractus solitarius, sends <strong>parasympathetic</strong> <strong>vagal efferents</strong> to the <strong>heart</strong>.</p>\n<p>Phases of pacemaker potential:</p>\n<ul>\n<li aria-level=\"1\"><strong>Phase 0</strong>- <strong>Upstroke.\u00a0</strong>It is due to the <strong>influx of Ca<sup>2+</sup></strong> ions by the opening of <strong>voltage-gated L-type channels.</strong></li>\n</ul>\n<ul>\n<li aria-level=\"1\"><strong>Phase 3</strong>- <strong>Downstroke. </strong>It is due to the <strong>efflux of K<sup>+</sup></strong> leading to <strong>repolarization</strong>.</li>\n</ul>\n<ul>\n<li aria-level=\"1\"><strong>Phase 4</strong>- <strong>Prepotential</strong>. Because of ongoing <strong>K<sup>+</sup> efflux</strong>, hyperpolarization sets in. This makes the channel more permeable to Na<sup>+</sup> ions and since these Na<sup>+</sup> channels are activated during hyperpolarization they are referred to as <strong>funny currents (Ih/If)</strong>. They form the first half of the pre-potential. The <strong>second</strong> <strong>half</strong> of prepotential is <strong>completed</strong> by the <strong>opening</strong> of the <strong>voltage-gated T-type Ca<sup>2+</sup> channel</strong>.</li>\n</ul>\n<p>In the clinical scenario, due to vagal stimulation, the parasympathetic cholinergic fibers to the SAN are stimulated. This leads to a <strong>decreased</strong>\u00a0<strong>slope</strong> of\u00a0<strong>phase 4</strong>. This occurs by two mechanisms-</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Vagal stimuli\u2192 acetylcholine released\u2192 <strong>M2</strong> receptor stimulated\u2192 slowed depolarising effect of <strong>funny Na<sup>+</sup></strong> (<strong>If) channel\u2192 decreased</strong> <strong>slope</strong>.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Vagal stimuli\u2192 acetylcholine released\u2192 <strong>M2</strong>\u00a0receptor stimulated \u2192 decreased cyclic adenosine monophosphate (cAMP)\u2192 <strong>decreased\u00a0firing of T-type Ca<sup>2+</sup> channel</strong> \u2192 <strong>decreased</strong> <strong>slope</strong>.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3d7b7fbf46940a1982050b0cc81261e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0147803620814958a8a76512b7a66965x796x1199.JPEG"
    ]
  },
  {
    "text": "A middle-aged male patient came for a routine check-up. An electrocardiogram was done, which is given below. What is the most probable finding in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "First-degree heart block"
      },
      {
        "id": 2,
        "text": "Type I Mobitz block"
      },
      {
        "id": 3,
        "text": "Type II Mobitz block"
      },
      {
        "id": 4,
        "text": "Complete heart block"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>First-degree heart block</strong> is the most probable finding in the given electrocardiogram (ECG).</p>\n<p>The ECG image shows a prolongation of the&nbsp;<strong>PR interval</strong> by <strong>&gt;0.20 seconds,</strong> which is indicative of first-degree heart block.</p>\n<p>First-degree heart block is the <strong>abnormal slowing</strong> of the <strong>conduction</strong> through the <strong>atrioventricular node</strong>. It is characterized by a prolonged PR interval &gt;0.20 seconds without disrupting the atrial and ventricular conduction. The normal PR interval is from 0.12 seconds to 0.20 seconds.&nbsp;</p>\n<p>Some of the common causes of first-degree heart blocks are coronary artery disease, myocardial infarction, infections, electrolyte abnormalities, drugs, and collagen vascular diseases. Most of the patients are usually asymptomatic and are diagnosed incidentally. In high-grade first-degree heart block (PR interval &gt;0.30 seconds), patients develop symptoms like dyspnea, chest pain, or syncope.</p>\n<p>For the majority of patients with first-degree AV block, there is no need for treatment. In patients with a PR interval greater than 0.30 seconds, who are experiencing symptoms believed to be due to the AV block, pacemaker placement may be required.&nbsp;In patients with AV block related to myocardial infarction (MI), pacemaker placement may be indicated.</p>\n<p>Other options:</p>\n<p>Option B- <strong>Type I Mobitz</strong> (<strong>Wenckebach</strong>) <strong>block</strong> is a subtype of second-degree heart block. It is characterized by <strong>progressive prolongation</strong> of the <strong>PR interval,</strong> shortening of the RR interval, and a pause (dropped beat) that is less than 2 times the immediately preceding RR interval. The shortest PR interval occurs after the pause and the longest PR interval occurs before the pause.</p>\n<p>The below image shows the type I Mobitz heart block.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/39ddfa0bf6b04d288581a115ddc3f44c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c9e401f480ad4aa78fed9208da6b3c62x436x135.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04e5020267ec4114adb90d5777f1c17fx1238x369.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f28649a04cd42918f13e700369016cbx434x125.PNG"
    ]
  },
  {
    "text": "A 70-year-old man with a history of hypertension, diabetes mellitus, and COPD presents to the emergency department with complaints of palpitations and shortness of breath. His ECG is given below. Given his medical history, what is the most likely underlying pathophysiological mechanism contributing to his ECG findings?",
    "choices": [
      {
        "id": 1,
        "text": "Increased automaticity in the sinoatrial node"
      },
      {
        "id": 2,
        "text": "Reentry circuits within the atrioventricular node"
      },
      {
        "id": 3,
        "text": "Ectopic foci originating from the pulmonary veins"
      },
      {
        "id": 4,
        "text": "Conduction delay due to bundle branch block"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely underlying pathophysiological mechanism contributing to <strong>atrial fibrillation</strong> in this patient, given his history of hypertension, diabetes mellitus, and COPD, is the presence of <strong>ectopic foci originating from the pulmonary veins</strong>.</p>\n<p>Atrial fibrillation is a cardiac arrhythmia characterised by <strong>rapid</strong>, and <strong>irregular atrial electrical activation</strong>, resulting in loss of organized atrial mechanical contraction. These rapid and irregular electrical signals input into the atrioventricular (AV) node, which determines ventricular activation and rate.\u00a0</p>\n<p>Option A: Increased <strong>automaticity</strong> in the <strong>sinoatrial node</strong> can cause sinus <strong>tachycardia</strong>, in contrast to atrial fibrillation, which primarily occurs due to ectopic foci.\u00a0</p>\n<p>Option B: <strong>Reentry circuits</strong> within the atrioventricular node is characteristic of <strong>AV nodal reentrant tachycardia (AVNRT)</strong>, not atrial fibrillation.</p>\n<p>Option D: Conduction delay due to <strong>bundle branch block</strong>: This refers to<strong> ventricular conduction abnormalities</strong> and is not a primary mechanism for atrial fibrillation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/60decf93e15348ad93423c84e203e564.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Automatic implantable cardioverter-defibrillator (AICD) implantation is done for all of the following conditions except:",
    "choices": [
      {
        "id": 1,
        "text": "Brugada syndrome"
      },
      {
        "id": 2,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 3,
        "text": "Hypertrophic cardiomyopathy"
      },
      {
        "id": 4,
        "text": "Acute myocardial infarction"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>An <strong>automated\u00a0implantable cardioverter-defibrillator</strong> (AICD) is a device placed in the chest or abdomen to detect arrhythmias and perform cardioversion,\u00a0defibrillation, and pace the heart.</p>\n<p>It is contraindicated in patients experiencing tachyarrhythmias with reversible or transient causes such as acute MI.</p>\n<p>It is used in:\u00a0</p>\n<ul>\n<li><strong>Brugada syndrome</strong>- refers to a sodium channelopathy with a high risk of arrhythmias that can lead to sudden cardiac death.</li>\n<li><strong>Ventricular fibrillation</strong> and ventricular tachycardia.</li>\n<li>Cardiac resynchronization therapy for prevention of sudden cardiac death in heart failure.</li>\n<li>High-risk situations of sudden cardiac death in <strong>hypertrophic cardiomyopathy</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the arrhythmia depicted by the given ECG strip:",
    "choices": [
      {
        "id": 1,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 2,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 3,
        "text": "Atrial fibrillation"
      },
      {
        "id": 4,
        "text": "Atrial flutter"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ECG depicts<strong> ventricular fibrillation.\u00a0</strong>It has the following characteristics:</p>\n<ul>\n<li>Chaotic irregular deflections of varying amplitude</li>\n<li>No identifiable QRS complexes, ST segments, or T waves are visible</li>\n</ul>\n<p>Other options:</p>\n<p>Option 1- Ventricular tachycardia:\u00a0The ECG features include:</p>\n<ul style=\"list-style-type: disc;\">\n<li>Wide QRS complex with abnormal morphology</li>\n<li>Absence\u00a0of the P waves</li>\n<li>Rate &gt;100/min</li>\n</ul>\n<p>Option 3- Atrial fibrillation: The ECG features include:</p>\n<ul>\n<li>Narrow QRS complexes</li>\n<li>RR intervals are irregular</li>\n<li>No distinct p waves seen</li>\n</ul>\n<p>Option 4- Atrial flutter: The ECG features include:</p>\n<ul>\n<li>Narrow QRS complexes</li>\n<li>RR intervals are regular\u00a0</li>\n<li>Normal P waves are replaced by <strong>sawtooth-shaped</strong> <strong>waves</strong>\u00a0known as flutter waves.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/04c31ccbac544890acc7a85e7f1b6447.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true regarding sick sinus syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Most patients are symptomatic in the early stages"
      },
      {
        "id": 2,
        "text": "Most commonly in young patients"
      },
      {
        "id": 3,
        "text": "Frequently seen in patients with atrial fibrillation"
      },
      {
        "id": 4,
        "text": "Treated using beta-blockers"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sick sinus syndrome</strong> is frequently seen in <strong>patients with concomitant atrial fibrillation.\u00a0</strong></p>\n<p>Sick sinus syndrome (or <strong>sinus node dysfunction</strong>) is a group of abnormal heart rhythms. It is a <strong>disorder of the sinoatrial node</strong> caused by<strong> impaired pacemaker function </strong>and<strong> impulse transmission</strong>. This leads to a combination of abnormal rhythms, including atrial bradyarrhythmias, atrial tachyarrhythmias, and sometimes a pattern of alternating bradycardia and tachycardia, known as tachy-brady syndrome. These irregular rhythms can cause symptoms such as palpitations, decreased tissue perfusion, subsequent fatigue, lightheadedness, pre-syncope, and syncope.\u00a0</p>\n<p>The <strong>management</strong> of sick sinus syndrome includes identifying and <strong>correcting reversible factors</strong>, as an initial step.\u00a0</p>\n<p>Some examples of <strong>reversible causes</strong> of Sinus Node Dysfunction include,\u00a0</p>\n<ul>\n<li>Hypothyroidism</li>\n<li>Sleep apnea</li>\n<li>Anti-hypertensive medications eg. Beta-blockers</li>\n<li>Anti-arrhythmic medications eg. Amiodarone, Procainamide</li>\n</ul>\n<p><strong>Ambulatory ECG</strong> monitoring is required to diagnose as the symptoms are nonspecific.</p>\n<p><strong>Treatment</strong> involves <strong>permanent pacing.\u00a0</strong></p>\n<p>Other options:</p>\n<p>Option A: The course of sinus node dysfunction is usually a slow progression over decades. In the <strong>early stages</strong>, most patients are <strong>asymptomatic</strong>.</p>\n<p>Option B: It occurs most commonly in <strong>elderly</strong> patients due to the gradual loss of SA node function.\u00a0</p>\n<p>Option D: Beta-blockers are <strong>contraindicated</strong> in this condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old female patient presents with palpitations, chest pain, and dizziness. Her heart rate is 135 beats/ minute. Her ECG strip is shown below. Which of the following treatment modalities is recommended for definitive treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Implantable cardioverter-defibrillator"
      },
      {
        "id": 2,
        "text": "Percutaneous coronary intervention"
      },
      {
        "id": 3,
        "text": "Radiofrequency catheter ablation"
      },
      {
        "id": 4,
        "text": "Coronary artery bypass grafting"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario and the ECG finding with delta waves suggest a diagnosis of&nbsp;<strong>Wolff-Parkinson-White syndrome (WPW)</strong>. The recommended treatment modality is <strong>radiofrequency catheter ablation </strong>of the accessory pathway.&nbsp;</p>\n<p>Wolf Parkinson White (WPW) is a type of <strong>preexcitation syndrome, i.e., </strong>abnormally early ventricular excitation, which in WPW, occurs via a <strong>bypass tract (Bundle of Kent)</strong>. Normally, there is a normal AV nodal delay to allow adequate ventricular filling. The bypass tract allows impulses to skip the nodal delay leading to preexcitation of the ventricles.&nbsp;In this syndrome, there is both <strong>preexcitation</strong> and <strong>delayed conduction</strong> leading to a <strong>shortened PR interval</strong> (&lt; 0.12 secs) and <strong>wide QRS</strong>. There is a characteristic <strong>delta</strong> <strong>wave</strong> notch in the QRS wave as seen in the picture.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a42f9de1ea649928de320a352274f13.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a54538a84204194805b28a6c94187a1x507x343.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/453384cea104422f97521f565676fd62x529x368.JPEG"
    ]
  },
  {
    "text": "A cardiologist would make a diagnosis of paroxysmal atrial fibrillation for which of the following patients?",
    "choices": [
      {
        "id": 1,
        "text": "A 40 year old hyperthyroid female with atrial fibrillation persisting for about 14 months"
      },
      {
        "id": 2,
        "text": "A 30 year old male with no cardiovascular ailment having atrial fibrillation since last month"
      },
      {
        "id": 3,
        "text": "A 45 year old hypertensive male with atrial fibrillation that resolved in 15 days"
      },
      {
        "id": 4,
        "text": "A 52 year old female with spontaneous atrial fibrillation that resolved in 5 days"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Atrial fibrillation that starts spontaneously and terminates\u00a0<strong>within 7 days</strong> is termed <strong>paroxysmal AF.\u00a0</strong>As per this definition, the 52-year-old female with spontaneous atrial fibrillation that resolved in 5 days fits into this diagnosis.</p>\n<p>Other classifications of atrial fibrillation are</p>\n<ul>\n<li>Persistent atrial fibrillation - AF that persists for <strong>more than 7 days.</strong></li>\n<li>Longstanding persistant atrial fibrillation\u00a0 - AF that persists for <strong>more than a year.</strong></li>\n<li>Permanent atrial fibrillation - Longstanding AF that is <strong>refractory to cardioversion.</strong></li>\n<li>Lone atrial fibrillation - AF that occurs in patients younger than 60 years who <strong>do not have hypertension</strong> or any evidence of structural heart disease.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old otherwise healthy male presents with paroxysmal episodes of palpitations, shortness of breath, and lightheadedness. The episodes typically last for a few minutes and resolve spontaneously. An EKG is shown below. Which of the following is the most likely origin of this EKG finding?",
    "choices": [
      {
        "id": 1,
        "text": "Atrioventricular nodal re-entry circuit"
      },
      {
        "id": 2,
        "text": "Accessory path between atrium & ventricle"
      },
      {
        "id": 3,
        "text": "Automaticity from multiple atrial foci"
      },
      {
        "id": 4,
        "text": "Foci of automaticity in the Purkinje system"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Narrow complex tachycardia without visible P waves and sudden onset palpitations as shown in the ECG suggests <strong>AV node reentrant tachycardia</strong> (AVNRT) which is most commonly due to an <strong>AV nodal re-entry circuit.</strong></p>\n<p>This is the most common type of PSVT, accounting for about 60% of all cases. It occurs when an electrical signal gets trapped in a circuit within the AV node, causing it to fire rapidly and repeatedly, causing a re-entry circuit. This results in a<strong> </strong>regular narrow QRS complex tachycardia.</p>\n<p>The given ECG strip shows changes suggestive of AV node reentry tachycardia based on the following findings:</p>\n<p><strong>Narrow QRS complex tachycardia</strong> at 150 bpm, indicative of a regular atrial rate (<strong>1:1 AV response</strong>). Heart rate is calculated by dividing 300 by the number of large boxes between 2 consecutive R waves. The ECG strip shows the presence of roughly 2 large boxes between 2 consecutive R waves, thereby making the HR ~150 bpm.<br /><strong>No visible P waves</strong> - indicative of <strong>dual conduction pathways</strong> (<strong>slow and fast</strong>) that cause <strong>simultaneous atrial and ventricular activation</strong>.<br />The <strong>P wave </strong>may sometimes be seen at the <strong>end of the QRS complex</strong> as a<strong> pseudo-r' wave (V1)</strong> and <strong>pseudo-S wave. (II, III, aVF) </strong></p>\n<p>Other options:</p>\n<p>Option B: <strong>Accessory pathway between atrium and ventricle</strong>: This can allow electrical signals to <strong>bypass the AV node</strong>. Wolf Parkinson White is a type of <strong>preexcitation syndrome</strong>, i.e., abnormally early ventricular excitation, which in WPW, occurs via a bypass tract (Bundle of Kent). Normally, there is a normal AV nodal delay to allow adequate ventricular filling. The bypass tract allows impulses to skip the nodal delay leading to preexcitation of the ventricles. In this syndrome, there is both <strong>preexcitation and delayed conduction</strong> leading to a <strong>shortened PR interval </strong>(&lt; 0.12 secs) and <strong>wide QRS.</strong> There is a characteristic <strong>delta wave</strong> notch in the QRS wave.</p>\n<p>Option C: <strong>Automaticity from multiple atrial foci</strong>:\u00a0<strong>Multifocal atrial tachycardia</strong> is a type of PSVT caused by multiple atrial foci discharging independently at a rapid rate, this can occur due to lung pathology such as<strong> COPD</strong>. This results in <strong>an irregular narrow QRS complex</strong> tachycardia.</p>\n<p>Option D: <strong>Foci of automaticity in the Purkinje system</strong>: Leads to ventricular arrhythmias, which would be charcterized by a wide QRS.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6ef76589ff144e63a174a1df086cbf36.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly woman presents with palpitations for which an ECG is done as shown. She has had multiple such episodes in the past which did not resolve with amiodarone, dofetilide and sotalol. Catheter ablation of which region will terminate this patient\u2019s arrhythmia?",
    "choices": [
      {
        "id": 1,
        "text": "Cavotricuspid isthmus"
      },
      {
        "id": 2,
        "text": "Sinus node"
      },
      {
        "id": 3,
        "text": "Left atrial region around pulmonary vein"
      },
      {
        "id": 4,
        "text": "Atrioventricular junction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given ECG indicates <strong>Atril Flutter. Ablation of the cavotricuspid isthmus</strong> can help terminate this patient\u2019s recurrence of atrial flutter that did not resolve with antiarrhythmics.</p>\n<p>In patients with recurrences of atrial flutter despite preventive pharmacotherapy such as <strong>amiodarone</strong>, catheter ablation of cavotricuspid isthmus terminates the arrhythmia. The cavotricuspid isthmus is the atrial myocardium between the tricuspid valve and the inferior vena cava.</p>\n<p>The initial management of atrial flutter depends on the patient\u2019s condition and symptoms. If the patient has <strong>severe</strong> <strong>hypotension</strong>, angina, or is <strong>hemodynamically</strong> <strong>unstable</strong>, then the <strong>first</strong> <strong>step</strong> is to perform <strong>electrical cardioversion</strong>. If the patient\u2019s condition is <strong>stable</strong>, the initial step is to achieve <strong>rate control </strong>by administering AV nodal\u2013blocking agents, such as <strong>IV beta-blockers.</strong></p>\n<p>If the duration of the episode is <strong>&gt; 48 hrs</strong>, or if the patient has an increased risk of thromboembolic stroke based on the CHADS -VASc scoring system then <strong>anticoagulation must be provided before the cardioversion.</strong></p>\n<p>For recurrent episodes, antiarrhythmic drugs such as <strong>sotalol, dofetilide, disopyramide, and amiodarone</strong> may be prescribed. In patients who experience recurrences despite pharmacotherapy, catheter ablation of the cavotricuspid isthmus terminates the arrhythmia.</p>\n<p>Other Options:</p>\n<p>Option B: Catheter ablation of the <strong>sinus</strong> <strong>node</strong> is <strong>not done for atrial flutter</strong>. It is used to treat <strong>inappropriate sinus tachycardia.</strong></p>\n<p>Option C: Catheter ablation of the region around the <strong>pulmonary</strong> <strong>vein</strong> is used to terminate the focus of <strong>atrial fibrillation.</strong></p>\n<p>Option D: Catheter ablation of the <strong>atrioventricular</strong> <strong>junction</strong> is done in cases of <strong>chronic atrial fibrillation with inadequate rate control</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/38c9788307fc459b8967249bec18f27d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 75-year-old woman presents with dizziness, palpitations, and syncope. An ECG reveals the absence of P waves and irregular RR intervals, consistent with atrial fibrillation. Treatment with a class III antiarrhythmic drug is initiated. Which of the following ion channels is most likely targeted by this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Voltage-gated nonselective cation channels"
      },
      {
        "id": 2,
        "text": "Voltage-gated sodium channels"
      },
      {
        "id": 3,
        "text": "Voltage-gated potassium channels"
      },
      {
        "id": 4,
        "text": "Voltage-gated calcium channels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Class III antiarrhythmic drugs</strong>, such as <strong>sotalol, amiodarone, dofetilide, and ibutilide</strong>, are known for targeting <strong>voltage-gated potassium channels</strong>. These drugs work by <strong>prolonging repolarization</strong> and the <strong>effective refractory period </strong>of cardiac cells, which is beneficial in managing tachyarrhythmias like <strong>atrial fibrillation</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Voltage-gated nonselective cation channels</strong>: These channels are targeted by drugs like <strong>ivabradine</strong> and affect the pacemaker potential of the sinoatrial node, not the repolarization phase of the action potential.</p>\n<p>Option B: <strong>Voltage-gated sodium channels</strong>: <strong>Class I antiarrhythmic drugs</strong> target sodium channels, affecting phase 0 depolarization of the action potential, not the repolarization phase.</p>\n<p>Option D: <strong>Voltage-gated calcium channels</strong>: Class IV antiarrhythmic drugs like <strong>verapamil</strong> and <strong>diltiazem</strong> target calcium channels, affecting conduction velocity but not directly prolonging repolarization.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male asthmatic patient came to the emergency department with complaints of chest pain and palpitation. The patient's vitals were stable and the ECG was performed, which is shown in the image below. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Adenosine"
      },
      {
        "id": 2,
        "text": "Labetalol"
      },
      {
        "id": 3,
        "text": "Cardioversion"
      },
      {
        "id": 4,
        "text": "Verapamil"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ECG is suggestive of&nbsp;<strong>paroxysmal supraventricular tachycardia </strong>(PSVT) and the drug that can be used&nbsp;for the termination of PSVT in this patient with <strong>bronchial asthma</strong> is<strong> verapamil.&nbsp;</strong></p>\n<p>The mechanism of action of verapamil is by<strong> slowing SA</strong> node automaticity and AV nodal conduction velocity and it&nbsp;is&nbsp;used in both,&nbsp;acute treatment and prophylaxis of <strong>PSVT</strong>.&nbsp;Verapamil is a calcium channel blocker, which is used in exertional, variant angina, acute coronary syndrome, and heart failure.</p>\n<p>Adverse effects include <strong>constipation</strong>, hypotension, and <strong>bradycardia with AV block</strong> with concurrent use of beta-blockers.&nbsp;</p>\n<p>Other options:</p>\n<p>Option A: Termination of PSVT is done using&nbsp;<strong>adenosine,&nbsp;</strong>but is avoided in bronchial asthma<strong>&nbsp;</strong>since adenosine can cause<strong> bronchoconstriction.</strong></p>\n<div class=\"O0\">Option B: <strong>Labetalol</strong> is a beta-blocker with both alpha and beta-blocking properties used in <strong>severe hypertensive crises</strong>&nbsp;and generally not used in PSVT.</div>\n<div class=\"O0\">&nbsp;</div>\n<div class=\"O0\">Option C: QRS synchronous direct <strong>cardioversion</strong> is warranted in cases of PSVT if there is the presence of <strong>hypotension</strong> with unconsciousness or respiratory distress.</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/16405ac51ad343c39f807ec6001d4d6e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7fbcd4f4525e4e71b7456286d72c120ex510x812.PNG"
    ]
  },
  {
    "text": "A 50-year-old man comes to the clinic with complaints of palpitations. He is diagnosed with tachyarrhythmia. He is started on a drug that resolves his arrhythmia. ECG taken 3 days after starting medication appears as below, with QTc = 477 ms. Which of the following drugs is the most likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Lignocaine"
      },
      {
        "id": 2,
        "text": "Procainamide"
      },
      {
        "id": 3,
        "text": "Magnesium sulfate"
      },
      {
        "id": 4,
        "text": "Propranolol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient has a QTc\u00a0of 477 ms which<strong>\u00a0</strong>indicates <strong>QT prolongation</strong> on taking the drug (normal QT- &lt; 440 ms in males). Among the given options, QT prolongation is seen with <strong>procainamide</strong>, a Class 1A anti-arrhythmic drug.</p>\n<p>A QT interval is slowed by a decreased heart rate. A QTc (corrected QT interval) is calculated as\u00a0<strong>QT/\u221aRR</strong>, to remove the effect of HR. Normal QTc is about 440 ms. Values of<strong>\u00a0more than</strong>\u00a0<strong>440 ms in males</strong>\u00a0and\u00a0<strong>450 ms in females</strong>\u00a0are considered to be prolonged.</p>\n<p>A QT prolongation can\u00a0<strong>present as syncope</strong>\u00a0or cardiac arrest. Prompt\u00a0<strong>intravenous</strong>\u00a0administration of\u00a0<strong>1-2mg magnesium sulfate</strong>\u00a0is needed. It gives time to correct electrolyte imbalances and<strong> remove the offending agent</strong>.</p>\n<p>Other anti-arrhythmic drugs associated with QT prolongation i.e (Class 1A and Class 3):</p>\n<ul>\n<li>Sotalol</li>\n<li>Amiodarone</li>\n<li>Quinidine</li>\n<li><strong>Procainamide</strong></li>\n<li>Dofetilide</li>\n<li>Ibutilide</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fd3009b84cec4f38ae75739412fd9c32.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which electrolyte abnormality has to be considered in a patient with the following ECG?",
    "choices": [
      {
        "id": 1,
        "text": "Hypermagnesemia"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Hypocalcemia"
      },
      {
        "id": 4,
        "text": "Hyponatremia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given ECG classically depicts <strong>polymorphic ventricular tachycardia</strong>&mdash;<strong>torsades de pointes.</strong> Torsade rhythm is&nbsp;most commonly seen in association with <strong>hypomagnesemia and hypokalemia.</strong></p>\n<p><strong>Torsades de pointes</strong> is a polymorphic ventricular tachycardia meaning &ldquo;twisting of the points,&rdquo; characterized by twisting of the QRS axis around the baseline and a polymorphic appearance.</p>\n<p>There is QT interval prolongation in the ECG due to a non-uniform delay in repolarization.</p>\n<p>The other cause&nbsp;of torsades de pointes include:</p>\n<ul>\n<li>Drugs like <strong>quinidine, procainamide, disopyramide </strong>and <strong>phenothiazine </strong>(amiodarone is rarely associated with torsades de pointes because the delay in repolarization induced by it is uniform).</li>\n<li>Bradycardia</li>\n<li>Acute ischemia or infarction</li>\n</ul>\n<p><strong>Management: </strong></p>\n<ul>\n<li>Discontinue the offending drug</li>\n<li>Correct electrolyte abnormalities, pH and hypoxia</li>\n<li><strong>Magnesium sulphate</strong> infusion&nbsp;</li>\n<li>Increase the heart rate - electrical pacing, isoproterenol infusion or intravenous atropine&nbsp;</li>\n</ul>\n<p>Note: Although hypocalcemia is associated with prolongation of QT interval, there are only rare reports of torsades de pointes associated with hypocalcemia. So, among the above options, the best answer would be hypokalemia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9fcedd76590341d392257fa41dbcbe94.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old woman with a history of hypertension and diabetes presents to the emergency department with complaints of syncope and generalized weakness. Her ECG shows a constant PR interval with intermittent non-conducted P waves. Which additional feature on the ECG would indicate a need for immediate pacing?",
    "choices": [
      {
        "id": 1,
        "text": "Low voltage QRS complexes"
      },
      {
        "id": 2,
        "text": "Deep T-wave inversions"
      },
      {
        "id": 3,
        "text": "Prolonged QT interval"
      },
      {
        "id": 4,
        "text": "Wide QRS complexes with occasional dropped beats"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ECG findings are indicative of <strong>Mobitz Type II AV block</strong>, where there is a constant PR interval and intermittent non-conducted P waves. This type of AV block occurs below the level of the AV node, typically within the <strong>His-Purkinje system</strong>. The presence of <strong>wide QRS complexes with occasional dropped beats</strong> is significant because it suggests an <strong>infranodal block</strong>. <br /><br />This type of block is more serious as it can rapidly progress to a <strong>complete heart block</strong>, which can result in <strong>severe bradycardia or asystole</strong>, leading to hemodynamic instability and potentially life-threatening situations. <strong>Immediate pacing</strong> is warranted to prevent these complications and ensure the heart maintains an adequate rate to support perfusion.<br /><br />The primary treatment for Mobitz Type II AV block is the <strong>implantation of a permanent pacemaker</strong>. This is especially important in symptomatic patients or those with evidence of hemodynamic instability. <strong>Temporary pacing</strong> may be used as an interim measure until permanent pacing can be arranged</p>\n<p>Other options:</p>\n<p>Option A: <strong>Low voltage QRS complexes</strong> are <strong>not specific</strong> to the severity of Mobitz Type II AV block and do not necessarily indicate a need for urgent intervention.</p>\n<p>Option B: <strong>Deep T-wave inversions</strong> may <strong>indicate myocardial ischemia</strong> or other conditions, but they do not specifically correlate with the urgency of Mobitz Type II AV block management.</p>\n<p>Option C: <strong>Prolonged QT interval</strong> is associated with an <strong>increased risk of torsades de pointes</strong> and other ventricular arrhythmias, but it does not directly address the severity or immediate risk associated with Mobitz Type II AV block.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 66-year-old man presents to the emergency department with complaints of palpitations and breathlessness. He has a history of chronic obstructive pulmonary disease. His ECG is given below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Paroxysmal supraventricular tachycardia"
      },
      {
        "id": 2,
        "text": "Atrial fibrillation"
      },
      {
        "id": 3,
        "text": "Atrial flutter"
      },
      {
        "id": 4,
        "text": "Multifocal atrial tachycardia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical feature and the ECG are pointing towards the diagnosis of <strong>multifocal atrial tachycardia </strong>(MAT).</p>\n<p>Identifying features in ECG:</p>\n<ul>\n<li><strong>Heart rate &gt;100 bpm</strong></li>\n<li><strong>Irregular</strong> rhythm</li>\n<li><strong>Discrete P</strong> waves with<strong> &gt;3 different morphologies </strong>(black arrows)</li>\n<li>Variable PR interval</li>\n<li>Narrow QRS complex</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0afb68727c024ff38a47dcd2496e4040.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/97a93cce9c7143ef9827b285aef64e5ex800x406.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b5361afe5e44e269aa5fa35fe2f487dx800x372.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb221c8a95ec44e0bfc15cead3b35f1bx800x549.JPEG"
    ]
  },
  {
    "text": "A 32-year-old diabetic man was undergoing a routine check-up. ECG revealed ST changes as given below. Repeated cardiac biomarkers were found to be within the normal range. Which among the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Brugada syndrome"
      },
      {
        "id": 2,
        "text": "Anterior wall ST-elevation MI"
      },
      {
        "id": 3,
        "text": "Acute pericarditis"
      },
      {
        "id": 4,
        "text": "Non ST-elevation MI"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ECG shows <strong>coved ST-segment elevation of V1-V3,\u00a0</strong>followed by a negative T wave (Brugada sign), which points to a diagnosis of <strong>Brugada syndrome.\u00a0</strong>A coved ST segment has a <strong>downward concavity.</strong></p>\n<p>Brugada syndrome is an inherited sodium channelopathy (<strong>SCN5A mutation</strong>) most commonly seen in Southeast Asian males. The age of presentation is usually 40 years. This syndrome is characterised by an increased risk of sudden cardiac death due to polymorphic ventricular tachyarrhythmias. <strong>Implantable cardioverter-defibrillator</strong> is the treatment of choice.</p>\n<p>Other options:</p>\n<p>To establish a diagnosis of <strong>ST-elevation MI</strong> (Option B) and <strong>NSTEMI </strong>(Option D), a positive and significant rise in cardiac biomarkers (troponins) is necessary along with one of the following features:</p>\n<ul>\n<li>Symptoms of ischemia</li>\n<li>New ST-T elevation or LBBB (not for NSTEMI)</li>\n<li>Pathologic Q waves (STEMI, old infarcts)</li>\n<li>Imaging evidence of loss of myocardium viability</li>\n<li>Intracoronary thrombus identified on angioplasty or autopsy</li>\n</ul>\n<p>Since we do not have a typical rise and fall pattern of cardiac biomarkers, in this case, a diagnosis of acute ST-elevation MI and NSTEMI is less likely.</p>\n<p>Causes of ST-T changes apart from acute MI:</p>\n<ul>\n<li><strong>Acute pericarditis </strong>(Option C) -<strong> </strong>Diffuse ST elevation with <strong>upward concavity</strong> and PR depression)</li>\n<li>Brugada patterns (right bundle branch block-like pattern with ST elevations in right precordial leads) seen secondary to electrolyte disturbances like hyperkalemia</li>\n<li>Hyperkalemia (peaked T waves)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4557c83f596749dc8b02e10696034244.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old female with a history of long QT syndrome presents with recurrent syncope and palpitations. What is the most appropriate long-term management strategy for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Beta-blocker therapy with propranolol"
      },
      {
        "id": 2,
        "text": "Magnesium sulfate administration"
      },
      {
        "id": 3,
        "text": "Implantable cardioverter-defibrillator (ICD) insertion"
      },
      {
        "id": 4,
        "text": "Long-term amiodarone therapy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An implantable cardioverter-defibrillator (ICD) insertion is the most appropriate <strong>long-term management strategy</strong> for this patient. Patients with <strong>long QT syndrome</strong> (LQTS) who continue to experience <strong>recurrent episodes of ventricular tachycardia (VT)</strong> despite optimal medical therapy are at high risk for sudden cardiac death. An ICD continuously monitors the heart's rhythm and can deliver life-saving shocks to terminate life-threatening arrhythmias such as VT.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Beta-blockers</strong> are effective in reducing the risk of arrhythmic events in long QT syndrome, particularly in LQT1 and LQT2. However, in high-risk patients who continue to experience arrhythmias despite optimal medical therapy, beta-blockers alone are not sufficient.</p>\n<p>Option B: <strong>Magnesium sulfate</strong> is an effective <strong>acute treatment for torsades de pointes</strong>, a type of polymorphic VT associated with long QT syndrome. However, it is not suitable for long-term management due to the need for continuous intravenous access and potential side effects. Long-term use is impractical and does not address the underlying risk of sudden cardiac death.</p>\n<p>Option D: <strong>Amiodarone</strong> is an antiarrhythmic drug used for various types of arrhythmias. However, it is not the first-line therapy for patients with long QT syndrome due to its potential to further prolong the QT interval and cause proarrhythmic effects. Additionally, ICDs have a proven track record of reducing mortality in high-risk patients, making them the preferred choice over long-term pharmacological therapy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Arrhythmias Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>