<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05 Pharyngeal Arches, Skeletal & Muscular Systems - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The core of the branchial arch is derived from which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Ectoderm and mesoderm"
      },
      {
        "id": 2,
        "text": "Endoderm and neural crest cells"
      },
      {
        "id": 3,
        "text": "Mesoderm and neural crest cells"
      },
      {
        "id": 4,
        "text": "Ectoderm and endoderm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>core of</strong> each <strong>pharyngeal arch </strong>(branchial arch)&nbsp;is derived from&nbsp;<strong>mesoderm</strong>&nbsp;and <strong>neural crest cells</strong>.&nbsp;</p>\n<p><strong>Pharyngeal arches</strong>&nbsp;initially have identical structures:</p>\n<ul>\n<li><strong>Surface ectoderm</strong> on the outside&nbsp;</li>\n<li>A mesenchymal <strong>core</strong> derived from <strong>mesoderm</strong>&nbsp;</li>\n<li><strong>Endoderm</strong> derived epithelium on the inside&nbsp;</li>\n</ul>\n<p class=\"p1\">The <strong>mesoderm</strong>&nbsp;in the arches is derived from paraxial mesoderm and lateral plate mesoderm. This is invaded by the&nbsp;<strong>neural crest cells</strong> that contribute to the formation of skeletal elements and connective tissue of the head and neck region.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1d1f1e0bb374bdeb8dd4d3f52269d91x1280x1121.JPEG"
    ]
  },
  {
    "text": "Which of the following pharyngeal arches disappear soon after formation?",
    "choices": [
      {
        "id": 1,
        "text": "3rd Arch"
      },
      {
        "id": 2,
        "text": "4th Arch"
      },
      {
        "id": 3,
        "text": "5th Arch"
      },
      {
        "id": 4,
        "text": "6th Arch"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>5th pharyngeal arch</strong>&nbsp;<strong>disappears</strong> soon after its <strong>formation,</strong> so only <strong>5 arches remain.</strong></p>\n<p class=\"p1\">Pharyngeal arches appear in the 4th or 5th week of development and contribute to the formation of the head and neck region. They are formed as a series of <strong>6 thickenings</strong> in the cranial most part of the foregut (the future pharynx). They are craniocaudally numbered from&nbsp;<strong>I to VI</strong>. The 5th pharyngeal arch disappears, so only 5 arches remain.&nbsp;</p>\n<ul>\n<li class=\"p1\">The <strong>f</strong><strong>irst pharyngeal arch</strong> is also known as the <strong>mandibular arch</strong></li>\n<li class=\"p1\">The <strong>s</strong><strong>econd pharyngeal arch</strong> is also known as the&nbsp;<strong>hyoid arch</strong></li>\n<li class=\"p1\">The&nbsp;3rd,&nbsp;4th, and 6th&nbsp;pharyngeal arches&nbsp;have no special names</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c822148c33d446f94ff6f4d4b533d11x1280x1121.JPEG"
    ]
  },
  {
    "text": "The site in the pharyngeal arch where the ectodermal cleft meets the endodermal pouch is known as:",
    "choices": [
      {
        "id": 1,
        "text": "Pharyngeal cleft"
      },
      {
        "id": 2,
        "text": "Pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "Pharyngeal membrane"
      },
      {
        "id": 4,
        "text": "Cervical sinus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>pharyngeal membrane</strong> is the location where the <strong>ectoderm</strong> of the <strong>pharyngeal cleft</strong>\u00a0meets the <strong>endoderm</strong> of the <strong>pharyngeal pouch</strong>.\u00a0</p>\n<p>In the interval between any two adjoining pharyngeal arches, the endoderm extends outward in the form of a pouch (<strong>pharyngeal pouch)\u00a0</strong>to meet the ectoderm, which dips into this interval as a <strong>pharyngeal cleft</strong>. The membrane formed where the pharyngeal cleft comes in contact with the pouch is called the\u00a0<strong>pharyngeal membrane</strong>.\u00a0</p>\n<p>Initially, there are four pharyngeal membranes between the five arches. Only the <strong>first\u00a0pharyngeal</strong> <strong>membrane</strong> develops and\u00a0contributes to the formation of the\u00a0<strong>tympanic membrane</strong>. The 2nd, 3th, and 4th pharyngeal membranes do not develop further into any structure. They get obliterated when the mesoderm from the 2nd arch overgrows and fills the succeeding clefts.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1bf40b037f644b29b88be4dc394a592cx1280x1121.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ef8b5c2ffdb478a911fa939a6837e3dx1280x1004.JPEG"
    ]
  },
  {
    "text": "A 4-day-old infant who was delivered at home is brought to the pediatrician for a routine checkup. The infant has a noticeable small mandible and cleft palate. A CT scan reveals hypoplasia of the mandible and a defect in the \u200bmiddle ear cavity and tympanic membrane. A developmental defect of which of the following pharyngeal arches is most likely?",
    "choices": [
      {
        "id": 1,
        "text": "1st pharyngeal arch"
      },
      {
        "id": 2,
        "text": "2nd pharyngeal arch"
      },
      {
        "id": 3,
        "text": "3rd pharyngeal arch"
      },
      {
        "id": 4,
        "text": "6th pharyngeal arch"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features are suggestive of <strong>first arch syndrome</strong> due to the defect in the development of the&nbsp;<strong>first pharyngeal arch.</strong></p>\n<p>The derivatives of the first pharyngeal arch are:</p>\n<p><strong>Skeletal derivatives: </strong>It has&nbsp;<strong>2 prominences </strong>-&nbsp;</p>\n<ul>\n<li><strong>Mandibular prominence </strong>(ventral)\n<ul>\n<li><strong>Meckel's cartilage</strong>: Malleus,&nbsp;incus,&nbsp;anterior malleolar ligament, the&nbsp;spine of the sphenoid, and the&nbsp;sphenomandibular ligament.&nbsp;</li>\n<li><strong>Mesenchyme</strong>: In the jaw region, it surrounds the Meckel's cartilage and undergoes membranous ossification to form the mandible</li>\n</ul>\n</li>\n<li><strong>Maxillary prominence </strong>(dorsal)\n<ul>\n<li><strong>Mesenchyme</strong>:&nbsp; Maxilla, zygomatic bone, and part of the temporal bone&nbsp;are formed by membranous ossification</li>\n</ul>\n</li>\n</ul>\n<p><strong>Pharyngeal pouch derivatives:</strong></p>\n<ul>\n<li>Auditory tube</li>\n<li>Middle ear cavity</li>\n</ul>\n<p><strong>Muscular derivatives:</strong></p>\n<ul>\n<li>Tensor tympani</li>\n<li>Tensor veli palaitini</li>\n<li>Muscles of mastication</li>\n<li>Anterior belly of digastric</li>\n<li>Mylohyoid</li>\n</ul>\n<p><strong>Vascular derivatives:</strong></p>\n<ul>\n<li>Maxillary artery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  newborn had hypoplasia of the mandibles and zygomatic bones, malformed external ears, and slanted palpebral fissures. Abnormality in the development of which of the following pharyngeal arches will most likely\u200b lead to the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pharyngeal arch 1"
      },
      {
        "id": 2,
        "text": "Pharyngeal arch 2"
      },
      {
        "id": 3,
        "text": "Pharyngeal arch 3"
      },
      {
        "id": 4,
        "text": "Pharyngeal arch 6"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is suggestive of<strong> Treacher Collins syndrome</strong>&nbsp;that results from abnormal development of the <strong>1st pharyngeal arch </strong>(mandibular arch).&nbsp;</p>\n<p><strong>First arch syndromes </strong>are congenital defects caused due to the&nbsp;<strong>failure </strong>of the<strong> neural crest cells</strong> to<strong> migrate</strong> into the <strong>1st&nbsp;pharyngeal&nbsp;arch</strong>. They are:</p>\n<ul>\n<li class=\"p1\"><strong>Treacher-Collins syndrome</strong> (mandibulofacial dysostosis)&nbsp;- Autosomal dominant genetic disorder characterized by:\n<ul>\n<li class=\"p1\"><strong>Craniofacial bone defects</strong>&nbsp;- Involves mandible (causing micrognathia), maxilla, and zygomatic arches</li>\n<li class=\"p1\"><strong>Ear defects</strong>&nbsp;- Involves the external ear, atresia of auditory canals, and abnormalities of the&nbsp;middle ear ossicles leading to bilateral conductive hearing loss</li>\n<li class=\"p1\"><strong>Eye defects</strong>&nbsp;- Down-slanting palpebral fissures and lower eyelid colobomas</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li class=\"p1\"><strong>Pierre Robin sequence</strong> (or Robin sequence) - Caused due to genetic defects or due to environmental factors. It can also be seen in oligohydramnios when the chin gets compressed against the chest in utero.&nbsp;\n<ul>\n<li class=\"p1\">It is characterized by a <strong>triad</strong> of <strong>micrognathia</strong>, <strong>glossoptosis</strong> (posteriorly placed tongue), and <strong>cleft palate</strong></li>\n<li class=\"p1\">The <strong>primary defect</strong> is poor growth of the <strong>mandible</strong> (micrognathia)</li>\n<li class=\"p1\">As a consequence of this, the tongue is posteriorly placed (glossoptosis)</li>\n<li class=\"p1\">Additionally, the tongue remains in between the palatal shelves and they fail to fuse (cleft palate)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a868b952bad141ed822bc59900368fb2x1080x1918.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67924a47d630461c8aab434bbca6f32fx1080x1920.JPEG"
    ]
  },
  {
    "text": "Which of the following structures is not derived from Meckel's cartilage?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior ligament of malleus"
      },
      {
        "id": 2,
        "text": "Spine of sphenoid"
      },
      {
        "id": 3,
        "text": "Stapes"
      },
      {
        "id": 4,
        "text": "Sphenomandibular ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Note:</strong></p>\n<ul>\n<li>The mandible,&nbsp;maxilla, zygomatic bone, and part of the temporal bone are formed from the mesenchyme of the first arch and not from Meckel's cartilage.</li>\n<li>The portion of Meckel&rsquo;s cartilage that extends from the mandibular symphysis to mental foramen is probably incorporated into the intramembranous mandibular bone.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9d58acc5abf549bbad630dce4b25a9c8x1280x1423.JPEG"
    ]
  },
  {
    "text": "A 49-year-old woman came with complaints of dull aching pain in the throat and right side of the face. She also frequently gets pain while swallowing associated with earache and headaches. On CT scan, a calcified stylohyoid ligament was seen. This ligament is derived from:",
    "choices": [
      {
        "id": 1,
        "text": "First pharyngeal arch"
      },
      {
        "id": 2,
        "text": "Second pharyngeal arch"
      },
      {
        "id": 3,
        "text": "Third pharyngeal arch"
      },
      {
        "id": 4,
        "text": "Fourth pharyngeal arch"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>These structures can be remembered as<strong> 5S's</strong>:</p>\n<ul>\n<li><strong>S</strong>tapes</li>\n<li><strong>S</strong>tyloid process of the temporal bone</li>\n<li><strong>S</strong>tylohyoid ligament</li>\n<li><strong>S</strong>maller (lesser) cornu of the hyoid bone</li>\n<li><strong>S</strong>uperior part of the body of the hyoid bone</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d264a2ff99b4fb4b823fc420ccda3a4x600x641.JPEG"
    ]
  },
  {
    "text": "Which structure is derived from the 3rd pharyngeal arch?",
    "choices": [
      {
        "id": 1,
        "text": "Lesser cornu of hyoid bone"
      },
      {
        "id": 2,
        "text": "Greater cornu of hyoid bone"
      },
      {
        "id": 3,
        "text": "Upper part of the body of hyoid bone"
      },
      {
        "id": 4,
        "text": "Full body of the hyoid bone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Greater cornu (greater horn)</strong>&nbsp;is derived from&nbsp;the <strong>3rd pharyngeal arch</strong>.</p>\n<p>The<strong> lower part </strong>of the<strong> body </strong>of the<strong> hyoid bone</strong> is also formed from 3rd pharyngeal arch.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/49c0b01b785148f3a306980d39bdcbcex600x641.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles is affected in patients with mandibular nerve injury?",
    "choices": [
      {
        "id": 1,
        "text": "Stylopharyngeus"
      },
      {
        "id": 2,
        "text": "Tensor tympani"
      },
      {
        "id": 3,
        "text": "Posterior belly of digastric"
      },
      {
        "id": 4,
        "text": "Levator veli palitini"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>tensor tympani</strong> muscle is affected in the mandibular nerve injury. The mandibular nerve supplies the muscle since it is derived from the&nbsp;<strong>first pharyngeal arch</strong> (mandibular arch).</p>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Pharyngeal Arch</strong></td>\n<td style=\"text-align: center;\"><strong>Muscle derivatives</strong></td>\n</tr>\n<tr>\n<td>I</td>\n<td>Muscles of mastication, mylohyoid, anterior belly of digastric, tensor tympani, and tensor veli palatini</td>\n</tr>\n<tr>\n<td>II</td>\n<td>Muscles of facial expression, stapedius, stylohyoid, platysma, and posterior belly of digastric</td>\n</tr>\n<tr>\n<td>III</td>\n<td>Stylopharyngeus</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>Larynx - cricothyroid; soft palate - levator veli palatini; pharyngeal constrictors</td>\n</tr>\n<tr>\n<td>VI</td>\n<td>Larynx - All intrinsic muscles (except cricothyroid)</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During thyroidectomy, the surgeon accidentally damages a nerve. Post-op, the patient is not able to raise the pitch of his voice. Which arch is the affected structure derived from?",
    "choices": [
      {
        "id": 1,
        "text": "4th pharyngeal arch"
      },
      {
        "id": 2,
        "text": "2nd pharyngeal arch"
      },
      {
        "id": 3,
        "text": "3rd pharyngeal arch"
      },
      {
        "id": 4,
        "text": "1st pharyngeal arch"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the above scenario, the<strong> cricothyroid</strong> <strong>muscle</strong>&nbsp;is affected since it is responsible for <strong>high pitch phonation.</strong>&nbsp;It is derived from the <strong>4th pharyngeal arch</strong>.&nbsp;</p>\n<p>All the <strong>other</strong>&nbsp;<strong>intrinsic muscles </strong>of the<strong> larynx&nbsp;</strong>arise from the&nbsp;<strong>6th pharyngeal arch.&nbsp;</strong></p>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Pharyngeal Arch</strong></td>\n<td style=\"text-align: center;\"><strong>Muscle derivatives</strong></td>\n</tr>\n<tr>\n<td>I</td>\n<td>Muscles of mastication, mylohyoid, anterior belly of digastric, tensor tympani, and tensor veli palatini</td>\n</tr>\n<tr>\n<td>II</td>\n<td>Muscles of facial expression, stapedius, stylohyoid, platysma, and posterior belly of digastric</td>\n</tr>\n<tr>\n<td>III</td>\n<td>Stylopharyngeus</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>Larynx - cricothyroid; soft palate - levator veli palatini; pharyngeal constrictors</td>\n</tr>\n<tr>\n<td>VI</td>\n<td>Larynx - All intrinsic muscles (except cricothyroid)</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the nerve of 6th pharyngeal arch?",
    "choices": [
      {
        "id": 1,
        "text": "Mandibular nerve"
      },
      {
        "id": 2,
        "text": "Superior laryngeal nerve of vagus"
      },
      {
        "id": 3,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 4,
        "text": "Recurrent laryngeal nerve of vagus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> recurrent laryngeal nerve </strong>of the<strong> vagus</strong>&nbsp;is the nerve of the&nbsp;<strong>6th pharyngeal arch.</strong></p>\n<p>The vagus nerve is&nbsp;distributed to the 4th and 6th arches as follows:</p>\n<ul>\n<li>Superior laryngeal nerve for 4th arch</li>\n<li>Recurrent laryngeal nerve for 6th arch</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The nerve of the second branchial arch is:",
    "choices": [
      {
        "id": 1,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 2,
        "text": "Trigeminal nerve"
      },
      {
        "id": 3,
        "text": "Facial nerve"
      },
      {
        "id": 4,
        "text": "Vagal nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The <strong>facial nerve</strong> is the nerve of the <strong>2nd pharyngeal arch</strong>.&nbsp;</p>\n<p class=\"p1\">Each pharyngeal arch is characterized by its own muscular components. The muscular components of each arch have their own cranial nerve. Wherever the muscle cells migrate, they carry their nerve component<span class=\"Apple-converted-space\">&nbsp;</span>with them.</p>\n<p class=\"p1\">The neurons of the&nbsp;<strong>5th, 7th, 9th,</strong> and<strong> 10th cranial sensory ganglia</strong>&nbsp;that supply the pharyngeal arch structures are derived from&nbsp;<strong>ectodermal placodes</strong> (epipharyngeal placodes) and from the <strong>neural crest cells</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following arteries develops from the hyoid arch?",
    "choices": [
      {
        "id": 1,
        "text": "Maxillary artery"
      },
      {
        "id": 2,
        "text": "Stapedial artery"
      },
      {
        "id": 3,
        "text": "Subclavian artery"
      },
      {
        "id": 4,
        "text": "Common carotid artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>stapedial artery</strong> develops in the&nbsp;<strong>second pharyngeal arch (</strong><strong>hyoid arch).</strong></p>\n<table>\n<tbody>\n<tr>\n<td colspan=\"2\"><strong>Arteries of the pharyngeal arches</strong></td>\n</tr>\n<tr>\n<td><strong>Arch</strong></td>\n<td><strong>Artery</strong></td>\n</tr>\n<tr>\n<td>I</td>\n<td>Maxillary arteries</td>\n</tr>\n<tr>\n<td>II</td>\n<td>Hyoid and stapedial arteries</td>\n</tr>\n<tr>\n<td>III</td>\n<td>Common carotid and the first part of the internal carotid arteries</td>\n</tr>\n<tr>\n<td>IV</td>\n<td>Left side: Arch of the aorta<br />Right side:&nbsp;Right subclavian artery</td>\n</tr>\n<tr>\n<td>VI</td>\n<td>Left side:&nbsp;Left pulmonary artery and ductus arteriosus<br />Right side:&nbsp;Right pulmonary artery</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-month-old infant was brought to the pediatric OPD for a routine checkup. The child had congenital hypoparathyroidism. CT scan revealed thyroid hypoplasia and absent thymus. Abnormality in the development of which of the following pharyngeal pouches will most likely cause the given features?",
    "choices": [
      {
        "id": 1,
        "text": "Fourth and fifth pharyngeal pouch"
      },
      {
        "id": 2,
        "text": "First and second pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "Second and third pharyngeal pouch"
      },
      {
        "id": 4,
        "text": "Third and fourth pharyngeal pouch"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of <strong>congenital hypoparathyroidism</strong> and <strong>thyroid hypoplasia</strong>, <strong>absent thymus</strong> on CT scan is suggestive of <strong>DiGeorge syndrome</strong>.&nbsp;The defect is most likely to be present in the development of<strong> third </strong>and <strong>fourth </strong>pharyngeal pouches.&nbsp;</p>\n<p>Structures derived from various pharyngeal pouches (I-IV) are:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/150990af53b3480e8dd7484891950e92x600x660.JPEG"
    ]
  },
  {
    "text": "A 46-year-old woman presented with thyroid swelling. After evaluation, it was diagnosed as medullary thyroid cancer. Calcitonin produced from parafollicular C cells was used as a prognostic marker. These cells are derived from which structure?",
    "choices": [
      {
        "id": 1,
        "text": "3rd pharyngeal cleft"
      },
      {
        "id": 2,
        "text": "3rd pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "4th pharyngeal cleft"
      },
      {
        "id": 4,
        "text": "Ultimobranchial body"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Calcitonin</strong>&nbsp;produced by<strong> parafollicular C-cells&nbsp;</strong>of the <strong>thyroid</strong>&nbsp;which is derived from the <strong>ultimobranchial body</strong> (4th pharyngeal pouch derivative).&nbsp;</p>\n<p>The <strong>4th pharyngeal pouch</strong> develops a small <strong>diverticulum </strong>medial to the main pouch&nbsp;called&nbsp;the <strong>ultimobranchial body</strong>. The ultimobranchial body is later incorporated into the thyroid gland and its cells give rise to the <strong>parafollicular or C-cells</strong> of the thyroid gland.&nbsp;These cells secrete a hormone called <strong>calcitonin</strong> that is involved in the regulation of the calcium level in the blood.</p>\n<p><strong>Clinical consideration:&nbsp;</strong>Both <strong>chromaffin cells </strong>of the<strong> adrenal medulla</strong> and <strong>parafollicular cells (C-cells)</strong> of the thyroid originate from the <strong>neural crest cells</strong>. A common, germ-line mutation in neural crest cells can cause tumors in both the adrenal medulla and the thyroid, as seen in <strong>MEN types 2A</strong> and<strong> 2B.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8421f28bbe704e738600f136e41697f8x600x660.JPEG"
    ]
  },
  {
    "text": "A patient diagnosed with thymoma underwent thymectomy. The histological section of the the organ is given below. The structure marked is derived from which pharyngeal pouch?",
    "choices": [
      {
        "id": 1,
        "text": "Fourth pharyngeal pouch"
      },
      {
        "id": 2,
        "text": "Third pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "Second pharyngeal pouch"
      },
      {
        "id": 4,
        "text": "First pharyngeal pouch"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The image is showing <strong>Hassall&rsquo;s corpuscles</strong> (thymic corpuscles) which are derived from the <strong>3rd pharyngeal pouch</strong>.&nbsp;</p>\n<p class=\"p1\">The <strong>3rd pouch</strong> gives rise to the <strong>thymus</strong> in the&nbsp;ventral part and the <strong>inferior parathy</strong><span class=\"s1\"><strong>roid gland</strong> in the dorsal part. The <strong>thymus</strong> then <strong>moves away</strong> from the</span>&nbsp;pharyngeal wall in a <strong>caudal</strong> and <strong>medial direction</strong>, pulling the inferior parathyroid with it. It reaches&nbsp;the anterior part of the thorax, where it fuses with its counterpart from the opposite side.&nbsp;</p>\n<p class=\"p1\">The endodermal cells of the thymus get invaded by the vascular mesoderm, which contains numerous lymphoblasts.&nbsp;<strong>Hassall&rsquo;s corpuscles (thymic corpuscles)</strong> are derived from the <strong>endoderm</strong> of the <strong>3rd pouch</strong>.&nbsp;The <strong>thymocytes</strong> are derived from <strong>bone marrow </strong>and the<strong> cytoreticulum.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/96db7e479a7c4feb92b0bbfaa8779c95.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2eadbc22c2634057b7c07a34005410f8x600x660.JPEG"
    ]
  },
  {
    "text": "An 8-year-old girl was brought to the OPD with fever and throat pain for 3 days. On examination congestion and inflammation of the palatine tonsils were noticed. The affected structure is derived from which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "1st pharyngeal pouch"
      },
      {
        "id": 2,
        "text": "2nd pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "3rd pharyngeal pouch"
      },
      {
        "id": 4,
        "text": "Ultimobranchial body"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The diagnosis according to the given clinical vignette is <strong>acute tonsillitis</strong> affecting&nbsp;<strong>palatine tonsils.</strong>&nbsp;They are derived from the <strong>2nd pharyngeal pouch</strong>.&nbsp;</p>\n<p class=\"p1\">The <strong>epithelium</strong> of the 2nd pharyngeal pouch proliferates to form solid cords known as <strong>tonsillar buds.</strong> The tonsillar buds penetrate into the surrounding mesoderm. These buds are then invaded by the mesodermal tissue to form the palatine tonsil.&nbsp;The <strong>capsule</strong> of the <strong>tonsil</strong> is formed by the <strong>condensed mesoderm.</strong> During the 3rd and 5th months, the tonsil is infiltrated by lymphatic tissue.</p>\n<p class=\"p1\">The <strong>intratonsillar cleft</strong> (tonsillar fossa)<strong>&nbsp;</strong>is the&nbsp;<strong>remnant</strong> of the<strong> 2nd pharyngeal pouch</strong> found in the adult.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6d5fa0fa60f5412194cc333c6aa5d488x600x660.JPEG"
    ]
  },
  {
    "text": "A young patient presented with hypoparathyroidism, absent thymus and tetany. Which of the following marked areas in the picture is defective in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>DiGeorge syndrome</strong> is a complex embryopathy that is caused by the hemizygous interstitial deletion of <strong>chromosome 22</strong>. It is characterized by&nbsp;multiple developmental defects, including conotruncal defects, hypoparathyroidism, and dysmorphic syndrome. It is also known as <strong>velocardiofacial syndrome </strong>(palate, facial, and cardiac defects).</p>\n<p>It has variable presentations including<strong> C</strong>left palate, <strong>A</strong>bnormal facies, <strong>T</strong>hymic aplasia leading to T-cell deficiency, <strong>C</strong>ardiac defects, and <strong>H</strong>ypocalcemia secondary to parathyroid aplasia&nbsp;(<strong>CATCH-22</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3370bdf51c104570aa5589ddedc3fd25.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b24f18f032e41228225ae8a98781baax1280x1407.JPEG"
    ]
  },
  {
    "text": "The foramen cecum indicates the site of development of ________.",
    "choices": [
      {
        "id": 1,
        "text": "Thyroid"
      },
      {
        "id": 2,
        "text": "Parathyroid"
      },
      {
        "id": 3,
        "text": "Thymus"
      },
      {
        "id": 4,
        "text": "Pituitary"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>foramen cecum</strong> indicates the <strong>site </strong>of<strong> development of thyroid</strong>.</p>\n<p>The <strong>thyroid gland </strong>develops as a <strong>midline derivative</strong> of the pharynx <strong>between the 1st</strong>&nbsp;and <strong>2nd&nbsp;pharyngeal pouches</strong>.&nbsp;Around the 5th week, a <strong>midline diverticulum</strong> is formed just caudal to the median tongue bud, at the site where <strong>foramen cecum</strong> is found later. This midline diverticulum passes&nbsp;caudally&nbsp;as the <strong>thyroglossal duct</strong> in front of the hyoid bone. The tip of this thyroglossal duct divides into two and their tissue mass proliferates to&nbsp;form the thyroid.</p>\n<p>Tissues of the thyroid and their origin:</p>\n<ul>\n<li class=\"p1\">The <strong>epithelial tissue</strong> of the thyroid gland is derived from <strong>endoderm.</strong></li>\n<li class=\"p1\">The&nbsp;<strong>connective tissue </strong>of&nbsp;capsule and interlobular septa are derived from the&nbsp;<strong>neural crest mesenchyme.</strong></li>\n<li class=\"p1\">The <strong>parafollicular or C cells</strong>&nbsp;are derived from the <strong>ultimobranchial body</strong>, a small diverticulum of the 4th pharyngeal pouch.</li>\n</ul>\n<p>Remnants of the thyroglossal duct can result in the formation of the thyroglossal cyst or fistula.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ac54602f231402ba54b201d61c5ce36x1280x1455.JPEG"
    ]
  },
  {
    "text": "The tongue muscles are derived from ______________",
    "choices": [
      {
        "id": 1,
        "text": "Preoccipital myotomes"
      },
      {
        "id": 2,
        "text": "Occipital myotomes"
      },
      {
        "id": 3,
        "text": "Ectoderm derived"
      },
      {
        "id": 4,
        "text": "Splanchnic mesoderm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>tongue muscles</strong> are derived from the <strong>myotomes</strong> of the <strong>occipital somites</strong>.</p>\n<p>The tongue muscles get their motor supply from the&nbsp;<strong>hypoglossal nerve</strong> (12th cranial nerve), except the <strong>palatoglossus</strong> muscle, which is supplied by the <strong>vagus nerve.</strong>&nbsp;</p>\n<p><strong>Development of the tongue&nbsp;</strong></p>\n<ul>\n<li>The<strong> anterior part</strong> of the<strong> tongue</strong>&nbsp;(body)<strong>&nbsp;</strong>is derived from the <strong>1st pharyngeal arch</strong>. It is&nbsp;formed from <strong>2</strong>&nbsp;<strong>lateral</strong> lingual swellings and <strong>one medial</strong> swelling called the&nbsp;<strong>tuberculum impar.</strong></li>\n<li>The<strong> posterior part</strong> of the<strong> tongue</strong>&nbsp;(root)<strong>&nbsp;</strong>is derived from the&nbsp;<strong>mesoderm</strong> of the<strong> 2nd, 3rd, </strong>and<strong> part</strong> of the<strong> 4th arch</strong>. This part develops from&nbsp;a medial swelling called&nbsp;<strong>copula (hypobranchial eminence)</strong>.&nbsp;</li>\n<li>The <strong>posterior-most part</strong> of the<strong> tongue</strong> and the <strong>epiglottis</strong>&nbsp;are derived from a <strong>third swelling</strong> formed in the&nbsp;<strong>posterior part</strong> of the<strong> 4th arch</strong>.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae5eb809be544cdf857cf6bba8f8c02fx600x934.JPEG"
    ]
  },
  {
    "text": "A 19-year-old girl presented with a painless swelling on the right side of the neck. CT-scan revealed a well-defined cystic mass at the angle of the mandible just in front of the anterior border of the sternocleidomastoid muscle. Persistence of which of the following structures during the development will most likely cause the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "First branchial cleft"
      },
      {
        "id": 2,
        "text": "Ultimobranchial body"
      },
      {
        "id": 3,
        "text": "Cervical sinus"
      },
      {
        "id": 4,
        "text": "Fourth branchial pouch"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of a<strong> branchial cyst</strong>&nbsp;that develops due to the persistence of the&nbsp;<strong>cervical sinus</strong>.</p>\n<p>The cervical sinus is formed when the 2nd arch mesoderm overgrows the succeeding arches and overhangs them as shown in the image. The <strong>space</strong> between the overhanging <strong>2nd pharyngeal arch&nbsp;</strong>and the <strong>3rd, 4th, and 6th arches</strong> is called the <strong>cervical sinus</strong>. The cavity of the cervical sinus&nbsp;is <strong>lined by</strong>&nbsp;&nbsp;<strong>ectoderm</strong> and normally gets <strong>obliterated.</strong></p>\n<p>In some individuals, a part of the&nbsp;<strong>cervical sinus&nbsp;may persist</strong> and give rise to swellings&nbsp;known as <strong>branchial cysts. </strong>It is present&nbsp;in the neck along the <strong>anterior border </strong>of the <strong>sternocleidomastoid muscle</strong>.&nbsp;These cysts are most commonly located just <strong>below</strong> the <strong>angle </strong>of the <strong>mandible.</strong> If the branchial cyst opens onto the surface, it becomes a <strong>branchial sinus</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbfe56269aff4879acd49324704d5815x600x523.JPEG"
    ]
  },
  {
    "text": "The cardiac and smooth muscles are derived from:",
    "choices": [
      {
        "id": 1,
        "text": "Ectoderm"
      },
      {
        "id": 2,
        "text": "Somatic mesoderm"
      },
      {
        "id": 3,
        "text": "Branchial mesoderm"
      },
      {
        "id": 4,
        "text": "Splanchnic mesoderm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>cardiac and smooth muscles</strong> are derived from the&nbsp;<strong>splanchnic mesoderm.</strong></p>\n<p>The musculature of the body is derived from the mesoderm as described below:</p>\n<ul>\n<li><strong>Somatic mesoderm:</strong> Muscles of limbs and trunk</li>\n<li><strong>Branchial mesoderm:</strong> Muscles of head and neck</li>\n<li><strong>Splanchnic mesoderm:</strong> Cardiac and smooth muscles</li>\n</ul>\n<p>However, there are certain exceptions and some<strong> muscles</strong> are&nbsp;<strong>ectoderm-derived</strong>. These include</p>\n<ul>\n<li><strong>Musculature</strong> of the<strong> iris</strong> (spincter and dilator pupillae)</li>\n<li><strong>Erector pili</strong> muscles in the skin</li>\n<li><strong>Myoepithelial cells</strong> of <strong>ducts</strong> of<strong> sweat glands</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The structures marked as \u201c1\u201d and \u201c2\u201d in the image below are developmentally derived from _______ and _______, respectively.",
    "choices": [
      {
        "id": 1,
        "text": "Notochord and sclerotome"
      },
      {
        "id": 2,
        "text": "Sclerotome and dermatome"
      },
      {
        "id": 3,
        "text": "Dermatome and notochord"
      },
      {
        "id": 4,
        "text": "Sclerotome and notochord"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked&nbsp;<strong>&ldquo;1&rdquo;</strong> is the<strong> outer annulus fibrosus</strong>&nbsp;and&nbsp;<strong>\"2\"</strong> is the inner <strong>nucleus</strong> <strong>pulposus</strong> of the intervertebral disc. They&nbsp;develop from the <strong>sclerotome</strong> and <strong>notochord,</strong> respectively.&nbsp;</p>\n<p>The <strong>vertebral bodies</strong> and the&nbsp;<strong>annulus fibrosus</strong>&nbsp;(peripheral part of the intervertebral disc) are <strong>derived</strong> from&nbsp;the mesenchymal cells of the <strong>sclerotome</strong>.</p>\n<p>The <strong>nucleus pulposus</strong> is a&nbsp;<strong>remnant</strong> of the <strong>notochord</strong>. The notochord regresses entirely in the region of vertebral bodies, but it persists in the central part of the intervertebral discs as the&nbsp;nucleus pulposus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0533615fc0454c5aaffa16416e7bd71c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The long left recurrent laryngeal nerve is due to the persistence of which arch artery?",
    "choices": [
      {
        "id": 1,
        "text": "3rd arch"
      },
      {
        "id": 2,
        "text": "4th arch"
      },
      {
        "id": 3,
        "text": "5th arch"
      },
      {
        "id": 4,
        "text": "6th arch"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>long left recurrent laryngeal nerve</strong> is due to the persistence of the<strong> left 6th arch artery.</strong></p>\n<p>During the development, the <strong>laryngeal nerves</strong> initially <strong>arise below</strong> the<strong> 6th arch artery</strong> and cross here to innervate the intrinsic muscles of the larynx. As the larynx moves cranially relative to the aortic arch arteries, the recurrent laryngeal nerves on the right and left sides are caught under the 6th arch arteries.</p>\n<p>On the<strong> right side, </strong>the<strong>&nbsp;distal 6th arch artery disappears.</strong>&nbsp;Since there is no 5th arch artery, the <strong>right recurrent laryngeal nerve</strong> is caught<strong> under </strong>the <strong>4th arch artery</strong> which becomes the future <strong>right&nbsp;subclavian artery.</strong></p>\n<p>On the<strong> left side, </strong>the <strong>6th arch artery persists</strong>, which develops into <strong>ductus</strong>&nbsp;<strong>arteriosus,</strong> which later forms <strong>ligamentum</strong> <strong>arteriosum</strong>. Due to the persistence of the 6th arch artery, the left recurrent laryngeal nerve is caught under it and therefore, has a relatively long course.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '05 Pharyngeal Arches, Skeletal & Muscular Systems';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>