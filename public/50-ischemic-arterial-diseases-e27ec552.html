<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50 Ischemic Arterial Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The most common cause of peripheral vascular disease is?",
    "choices": [
      {
        "id": 1,
        "text": "Atherosclerosis"
      },
      {
        "id": 2,
        "text": "Emboli"
      },
      {
        "id": 3,
        "text": "Trauma"
      },
      {
        "id": 4,
        "text": "Hypertension"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Atherosclerosis</strong> is the <strong>most common</strong> cause of peripheral occlusive vascular disease (POVD). Other causes are trauma and emboli.</p>\n<p>Peripheral arterial insufficiency is predominantly a disease of the lower extremities with the superficial femoral and iliac arteries commonly affected.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common symptom of peripheral occlusive vascular disease?",
    "choices": [
      {
        "id": 1,
        "text": "Rest pain"
      },
      {
        "id": 2,
        "text": "Intermittent claudication"
      },
      {
        "id": 3,
        "text": "Ulceration"
      },
      {
        "id": 4,
        "text": "Swollen and erythematous limb"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most common symptom of peripheral obstructive vascular disease is<strong> intermittent claudication</strong>.&nbsp;</p>\n<p>Intermittent claudication is the debilitating <strong>cramp-like pain</strong> felt in the leg muscles due to&nbsp;<strong>reduced blood flow</strong>&nbsp;brought on by peripheral arterial disease. It&nbsp;usually signifies&nbsp;<strong>mild&nbsp;</strong>to<strong>&nbsp;moderate chronic vascular occlusive disease.</strong></p>\n<p><strong>Rest pain&nbsp;</strong>is when the disease progresses to a degree that perfusion is severely reduced and cramp-like pain in the calf is felt even at rest.&nbsp;</p>\n<p>A swollen and erythematous limb is seen in <strong>critical limb ischemia</strong>. When the limb is in the dependent position, there is pooling of blood which causes the limb to appear red and swollen(<strong>sunset foot sign</strong>).</p>\n<p><strong>Buerger's test</strong>&nbsp;is done to assess the severity of peripheral vascular disease. In normal individuals, the elevation of the lower limb to a 90-degree angle does not produce any pallor but in affected individuals, even at an elevation of 20-degrees, <strong>pallor and venous guttering</strong> of the limb can be seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presented to the OPD with complaints of pain in the lower limbs, on walking a certain distance. He noticed that the pain subsides on resting. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pain is usually felt in the calf muscles"
      },
      {
        "id": 2,
        "text": "Muscle group affected is below the level of arterial disease"
      },
      {
        "id": 3,
        "text": "Distance at which pain occurs  varies greatly from day to day"
      },
      {
        "id": 4,
        "text": "Worsened by anemia or heart failure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient is likely experiencing <strong>intermittent claudication</strong> due to peripheral occlusive vascular disease.</p>\n<p>Intermittent claudication is the debilitating <strong>cramp-like pain</strong> felt in the leg muscles due to reduced blood flow brought on by peripheral arterial disease. It&nbsp;usually signifies <strong>mild </strong>to<strong> moderate chronic vascular occlusive disease.</strong></p>\n<p>The pain classically occurs during activity and is relieved with rest. The distance that a patient can walk without stopping till the pain is experienced in the muscles is known as <strong>claudication distance</strong>. This <strong>distance varies only slightly</strong> from day-to-day. The muscle group affected is <strong>one anatomical level below</strong> the arterial disease.</p>\n<p><strong>Boyd&rsquo;s classification</strong></p>\n<p>Class l - Pain on walking but pain decreases on continuation of walking.</p>\n<p>Class ll - Pain on walking, but continues to walk despite the pain.</p>\n<p>Class lll - Pain forces the patient to stop walking.</p>\n<p>Class lV - Pain at rest.<br style=\"font-weight: 400;\" />It is <strong>worsened</strong> by health conditions such as <strong>anemia and heart failure.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male who is a chronic smoker presented to the hospital with intermittent claudication pain of both thigh and buttock region on walking about 500 m. Which of the following is a likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Arterial disease involving the superficial femoral artery"
      },
      {
        "id": 2,
        "text": "Arterial disease with aortoiliac involvement"
      },
      {
        "id": 3,
        "text": "Femoral venous insufficiency"
      },
      {
        "id": 4,
        "text": "Arterial disease involving the profunda femoris artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>arterial disease with aortoiliac involvement</strong>.&nbsp;Classically, the&nbsp;<strong>muscle group affected</strong> by claudication is <strong>one anatomical level below</strong> the level of arterial disease.</p>\n<p>Intermittent claudication is a feature of chronic arterial disease or occlusion of the artery.&nbsp; Aortoiliac disease affects the <strong>infrarenal aorta</strong> and<strong> iliac arteries</strong>.</p>\n<p><strong>Management</strong> involves smoking cessation, lifestyle modifications, and treatment of underlying diabetes or hyperlipidemia if present.</p>\n<p>For claudication, <strong>cilostazol</strong> or pentoxyfilline is used. <strong>Cilostazol</strong> is <strong>superior</strong> to pentoxyfilline.&nbsp;</p>\n<p>Surgical options include&nbsp;aortoiliac bypass, aortobifemoral bypass, percutaneous transluminal angioplasty (PTA), which can be with or without stent placement, and thromboendarterectomy.</p>\n<table style=\"width: 478px;\">\n<tbody>\n<tr>\n<td style=\"width: 213.577px; text-align: left;\" colspan=\"2\"><strong>Correlation of clinical findings to the Site of Disease</strong></td>\n</tr>\n<tr>\n<td style=\"width: 213.5771942138672px;\">Aortoiliac obstruction</td>\n<td style=\"width: 272.4228057861328px;\">\n<p>Claudication in <strong>buttocks, thighs, and calves</strong></p>\n<p>Bruit over the aortoiliac region</p>\n<p><strong>Impotence</strong> (Leriche's syndrome)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 213.5771942138672px;\">Iliac obstruction</td>\n<td style=\"width: 272.4228057861328px;\">\n<p>Claudication of <strong>thigh and calf,</strong> unilaterally</p>\n<p>Absence of femoral and distal pulses</p>\n<p>Bruit over iliac region</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 213.5771942138672px;\">Femoropopliteal obstruction</td>\n<td style=\"width: 272.4228057861328px;\">\n<p>Claudication in <strong>calf</strong></p>\n<p>Femoral pulse felt but distal pulses absent</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 213.5771942138672px;\">Distal obstruction</td>\n<td style=\"width: 272.4228057861328px;\">\n<p>Ankle pulses absent</p>\n<p>Claudication in <strong>calf and foot</strong></p>\n<p>Femoral and popliteal pulses palpable</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Critical limb ischemia is characterized by all except_____",
    "choices": [
      {
        "id": 1,
        "text": "Ulceration"
      },
      {
        "id": 2,
        "text": "Rest pain"
      },
      {
        "id": 3,
        "text": "Intermittent claudication"
      },
      {
        "id": 4,
        "text": "Gangrene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Critical limb ischemia is characterized by <strong>rest pain</strong> and/or <strong>ulceration</strong> and <strong>gangrene</strong>. Intermittent claudication progresses to rest pain in critical limb ischemia.</p>\n<p>Rest pain occurs with the limb at rest and is felt in the foot; it is <strong>exacerbated by lying down or elevation of the foot</strong>. Characteristically, the <strong>pain is worse at night</strong> and it may be lessened by hanging the foot out of bed or by sleeping in a chair. The pressure of clothes on the foot usually makes the pain worse.</p>\n<p class=\"p1\"><strong>Ulceration occurs with severe arterial insufficiency</strong> and may present as painful erosion between toes or as shallow, non-healing ulcers on the dorsum of the feet, on the shins, and especially around the malleoli. The blackened mummified tissues of frank gangrene are unmistakable&nbsp;and superadded infection often makes the gangrene wet.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with critical limb ischemia, what is the ankle-brachial pressure index (ABPI) likely to be?",
    "choices": [
      {
        "id": 1,
        "text": "< 0.1"
      },
      {
        "id": 2,
        "text": "< 0.4"
      },
      {
        "id": 3,
        "text": "< 0.5"
      },
      {
        "id": 4,
        "text": "< 0.9"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a patient with critical limb ischemia, the ABPI is&nbsp;<strong>&lt; 0.4.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old chronic smoker presents with bluish discoloration of the toe along with intermittent claudication. Which of the following will be the next appropriate investigation in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CT angiography"
      },
      {
        "id": 2,
        "text": "MR angiography"
      },
      {
        "id": 3,
        "text": "Digital subtraction angiography"
      },
      {
        "id": 4,
        "text": "Duplex scan"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Chronic smoker presenting with bluish discoloration of the toe along with intermittent claudication is suggestive of <strong>peripheral arterial disease</strong> and <strong>duplex</strong>&nbsp;<strong>scanning&nbsp;</strong>will be the next appropriate investigation.</p>\n<p><strong>Duplex Scanning</strong>&nbsp;is a major&nbsp;<strong>non-invasive&nbsp;technique</strong> that uses B-mode ultrasound to provide an image of the vessel. Most scanners now have color coding, which allows detailed visualization of blood flow in a vessel. Different colors indicate changes in the direction and velocity of flow, with areas of high flow usually indicating stenotic lesions.</p>\n<p>Other options:&nbsp;</p>\n<p>Option A: CT<strong>&nbsp;Angiography</strong>&nbsp;(CTA) is more useful in the evaluation of visceral arterial disease (eg. mesenteric ischemia). It can be beneficial in peripheral artery diseases where a duplex scan shows <strong>poor images</strong> (<strong>aortoiliac segment involvement</strong>). CTA is not routinely recommended in peripheral artery disease because of concomitant renal dysfunction in these patients which can lead to <strong>contrast-induced nephropathy</strong>.</p>\n<p>Option B: MR<strong> Angiography&nbsp;</strong>is time-consuming and expensive, hence not done as the next investigation. It is contraindicated in patients with claustrophobia and metallic implants.&nbsp;</p>\n<p>Option C: Digital<strong> subtraction angiography (DSA)</strong> is an invasive and expensive procedure&nbsp;compared to other investigations. The benefits of DSA are that it provides dynamic arterial flow information and can be combined with a definitive endovascular intervention when indicated. DSA is indicated only when there is a discrepancy in diagnosis or intervention is planned. Complications associated with DSA include bleeding, hematoma, false aneurysm formation, thrombosis, arterial dissection, distal embolisation, renal dysfunction, and allergic reaction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9eeaaa4201840cc8835d1ba1bddd443x512x480.PNG"
    ]
  },
  {
    "text": "Which of the following is false regarding the investigation of peripheral arterial disease?",
    "choices": [
      {
        "id": 1,
        "text": "Duplex scanning is a non invasive technique"
      },
      {
        "id": 2,
        "text": "On doppler ultrasound a normal artery has a biphasic signal"
      },
      {
        "id": 3,
        "text": "DSA is now the standard technique used"
      },
      {
        "id": 4,
        "text": "Computed tomographic angiography is not used routinely to diagnose PAD"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>normal artery</strong> has <strong>a triphasic signal.</strong>&nbsp;The waveform becomes <strong>biphasic</strong> in <strong>mild-moderate</strong> <strong>stenosis</strong> and <strong>monophasic</strong> in severe stenosis.</p>\n<p>Option A:<strong> Duplex scanning</strong>&nbsp;is a major <strong>non-invasive&nbsp;technique</strong> that uses B-mode ultrasound&nbsp;to&nbsp;provide&nbsp;an&nbsp;image of the vessel.</p>\n<p>Option C: <strong>Digital subtraction angiography (DSA)</strong> is now the <strong>standard technique</strong> whereby the images obtained are digitized by computer and the extraneous background (bone, soft tissues, etc.) is removed to provide clearer images.&nbsp;</p>\n<p>Option D:&nbsp;Computed tomographic angiography (CTA), and conventional catheter-based angiography <strong>should not be used for routine diagnostic testing</strong> but are <strong>performed before potential revascularization.&nbsp;</strong>These tests define the anatomy that assists in planning for revascularization procedures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2321e021744346d4958e176bbd7c84b6x512x559.PNG"
    ]
  },
  {
    "text": "A patient with right leg arterial stenosis is being taken up for angioplasty. Which one of the following is incorrect about this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "It is done for patients with rest pain or tissue necrosis"
      },
      {
        "id": 2,
        "text": "It gives best results for management of stenosis below the knee"
      },
      {
        "id": 3,
        "text": "Satisfactory dilatation is confirmed by performing angiogram"
      },
      {
        "id": 4,
        "text": "Usually approached through femoral artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Angioplasty&nbsp;gives the best results for <strong>medium-sized</strong> vessels hence it is preferred for treating the vessels <strong>above the knee</strong> in peripheral arterial disease.</p>\n<p>Angioplasty is indicated in patients with rest pain or tissue necrosis.</p>\n<p><strong>Steps of angioplasty</strong>:&nbsp;</p>\n<ul>\n<li>Patients posted for angioplasty are given aspirin (325 mg) and clopidogrel (loading dose of 300&ndash;600 mg).&nbsp;</li>\n<li>During the procedure, anticoagulation is achieved by administration of unfractionated heparin, enoxaparin, or bivalirudin (a direct thrombin inhibitor).</li>\n<li>The <strong>femoral artery is punctured</strong> under local anesthetic, followed by insertion of a guidewire.&nbsp;The guidewire is negotiated through the stenosis or occlusion under fluoroscopic control.</li>\n<li>A <strong>balloon catheter</strong> is then inserted over the guidewire and positioned within the lesion.&nbsp;The balloon is then <strong>inflated at high pressure</strong> for approximately 1 minute and deflated.</li>\n<li>Once the angioplasty is done, dilatation is <strong>confirmed by performing angiogram.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0018222fdea24aaaa96f0c4f7f8dea9dx390x592.JPEG"
    ]
  },
  {
    "text": "Which is the best graft for a femoropopliteal bypass?",
    "choices": [
      {
        "id": 1,
        "text": "Dacron"
      },
      {
        "id": 2,
        "text": "Great saphenous vein"
      },
      {
        "id": 3,
        "text": "Polytetrafluoroethylene"
      },
      {
        "id": 4,
        "text": "Short saphenous vein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>great saphenous vein&nbsp;</strong>(GSV) is <strong>the best</strong> as it <strong>lasts longer</strong> than polytetrafluoroethylene (PTFE), dacron, and human umbilical vein as a graft in a femoropopliteal bypass.</p>\n<p>The GSV is the conduit of choice for arterial bypass grafts<strong> below the inguinal ligament</strong>.</p>\n<p>For bypass<strong> above the inguinal ligament,</strong>&nbsp;while both GSV and PTFE grafts have <strong>similar patency</strong> rates in the<strong> first 2 years</strong>, the <strong>GSV is superior</strong> thereafter and hence preferred over PTFE or any other grafts.</p>\n<p>The ipsilateral GSV is the <strong>conduit of choice</strong> for<strong> femoropopliteal bypass.</strong> When it is not available, contralateral GSV should be used. Other veins are preferred when both ipsilateral and contralateral GSV is not available and they include a small saphenous vein, cephalic vein, and basilic vein.&nbsp;</p>\n<p>Non-autogenous grafts are used for patients who<strong> lack a suitable venous conduit</strong>. The most commonly used prosthetic conduit is <strong>PTFE</strong>. Recent studies have shown that heparin-bonded PTFE is superior to compared to PTFE without heparin.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old man presented with complaints of pain in the right leg right for a day. He has a history of recurrent episodes of atrial fibrillation. Which of the following statements are false regarding his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemia beyond 6 hrs is usually irreversible"
      },
      {
        "id": 2,
        "text": "Pain, pallor, pulselessness, and parasthesia/anesthesia are characteristic"
      },
      {
        "id": 3,
        "text": "Movement of the digits is not affected"
      },
      {
        "id": 4,
        "text": "Embolectomy and thrombolysis are treatment options"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient most likely has <strong>acute arterial occlusion</strong> and <strong>atrial fibrillation</strong> can predispose to <strong>emboli</strong> formation.&nbsp;In acute arterial occlusion, the <strong>movement </strong>of the digits will be<strong> affected</strong> and the&nbsp;<strong>limb </strong>will be <strong>cold.&nbsp;</strong>Whereas, in venous occlusion, muscle function is not affected.</p>\n<p>The leg is often affected with:</p>\n<ul>\n<li>Pain</li>\n<li>Pallor</li>\n<li>Paralysis</li>\n<li>Loss of pulsation</li>\n<li>Paraesthesia (or anesthesia).</li>\n</ul>\n<p>Embolic arterial occlusion is an<strong> emergency</strong> that requires immediate treatment. Ischaemia <strong>beyond 6 hours</strong> is usually <strong>irreversible</strong> and results in limb loss.</p>\n<p>The diagnosis can be made clinically in a patient who has no history of claudication and has a source of emboli, who suddenly develops severe pain or numbness of the limb, which becomes cold and mottled.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly man is brought to the emergency department with sudden onset severe pain and numbness of the left lower limb. He has no previous history of any limb claudication. The limb appears to be cold and peripheral pulses are not palpable. What is the most appropriate next step?",
    "choices": [
      {
        "id": 1,
        "text": "Embolectomy using Fogarty balloon catheter"
      },
      {
        "id": 2,
        "text": "Intravenous Heparin 5000U"
      },
      {
        "id": 3,
        "text": "CT Angiogram to check for embolus"
      },
      {
        "id": 4,
        "text": "Thrombolysis with intra-arterial tissue plasminogen activator (tPA) infusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>sudden arterial occlusion</strong>. The <strong>immediate next step</strong> is to <strong>administer</strong> <strong>5000 IU</strong> of <strong>heparin</strong> to prevent extension of clot.</p>\n<p>Management of sudden arterial occlusion:</p>\n<ul>\n<li><strong>Embolectomy with Fogarty&rsquo;s balloon catheter&nbsp;</strong>is the definitive treatment of choice.</li>\n<li><strong>Thrombolysis</strong> with tissue plasminogen activator (tPA) can be done in cases where there are no acute signs of limb ischemia as complete lysis of thrombus in tPA infusion is achieved within 24 hours, however, it is cautiously used in the elderly due to risk of bleeding diathesis.</li>\n<li>A<strong> CT angiogram</strong> is performed after the procedure to ensure that the flow to the distal leg has been restored.</li>\n</ul>\n<p>Ischaemia <strong>beyond 6 hours</strong> is usually <strong>irreversible</strong> and may result in <strong>limb loss.</strong></p>\n<p>Complications of arterial revascularization</p>\n<ul>\n<li><strong>Compartment syndrome</strong></li>\n<li>Reperfusion syndrome</li>\n<li>Ischaemic neuropathy</li>\n<li>Myoglobinuria</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Renal failure</li>\n</ul>\n<p>Usually, a<strong> prophylactic fasciotomy</strong> is done in patients undergoing revascularization surgery to <strong>prevent compartment syndrome</strong>.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 71-year-old man had an acute STEMI for which coronary stenting was performed. On the follow-up visit, he reported pain over his toes and discoloration of both feet as shown in the image. His creatinine was also elevated. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sharp syndrome"
      },
      {
        "id": 2,
        "text": "Antiphospholipid antibody syndrome"
      },
      {
        "id": 3,
        "text": "Aortic dissection"
      },
      {
        "id": 4,
        "text": "Atheroembolism"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>atheroembolism. </strong>It<strong>&nbsp;</strong>is&nbsp;also called cholesterol embolism or <strong>b</strong><strong>lue toe syndrome.</strong></p>\n<p>Atheroembolism is a condition in which multiple small deposits of fibrin, platelets, and cholesterol debris embolize from proximal atherosclerotic lesions or aneurysmal sites.&nbsp;</p>\n<p>The typical presentation is a patient with <strong>ST-elevation myocardial infarction</strong> presenting with <strong>features of limb ischemia</strong> (cyanotic discoloration of the toes with pain and tenderness) <strong>following</strong> an intraarterial <strong>procedure</strong> (angioplasty).</p>\n<p>Digital vascular occlusion may result in ischemia and the \"blue toe\" syndrome; digital necrosis and gangrene may develop.&nbsp;Localized areas of tenderness, pallor, and livedo reticularis occur at sites of emboli. Since the atheroemboli&nbsp;tend to <strong>lodge </strong>in the<strong> small vessels&nbsp;</strong>of the limbs and may not occlude the large vessels,&nbsp;distal pulses are usually palpable.</p>\n<p>Large protruding aortic atheromas are a source of emboli that may lead to limb ischemia, as well as stroke and <strong>renal insufficiency</strong>.&nbsp;Skin or muscle biopsy may demonstrate cholesterol crystals.</p>\n<p><strong>Sharp syndrome</strong>, also known as <strong>mixed connective tissue disease</strong>, is an autoimmune condition with features of SLE, systemic sclerosis, and polymyositis. Clinical features include&nbsp;Raynaud's syndrome,&nbsp;polyarthritis, myositis, swollen hands, and fingers.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7bbf4a77cbbb43a290cdf577066ba20b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with untreated severe peripheral arterial disease comes to the surgery OPD with a right leg as shown in the image. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Usually affects most distal part of a limb"
      },
      {
        "id": 2,
        "text": "It is a surgical emergency if crepitus is felt on palpation"
      },
      {
        "id": 3,
        "text": "Occurs when tissues are desiccated by gradual slowing of blood stream"
      },
      {
        "id": 4,
        "text": "Amputation is not done if severe sepsis is present"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient is suffering from gangrene of the foot. If there is <strong>severe sepsis</strong> and if re-establishing blood supply is difficult(revascularization) then <strong>amputation </strong>is the <strong>preferred </strong>choice of treatment.</p>\n<p>Gangrene refers to death of macroscopic portions of tissue which turn black because of the <strong>breakdown </strong>of <strong>haemoglobin </strong>and the formation of iron sulphide.</p>\n<p>It usually affects the most <strong>distal part</strong> of a limb because of arterial obstruction (from thrombosis, embolus or arteritis).</p>\n<p>Dry gangrene occurs when the tissues are desiccated by gradual slowing of the bloodstream<strong>.&nbsp;</strong>Wet Gangrene occurs when <strong>superadded infection </strong>and putrefaction are present. Crepitus may be palpated as a result of infection by gas-forming organisms commonly in diabetic foot problems.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5d373adae95942bcaca75a766e61306c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 51-year-old, diabetic patient presents with the following features during a village health camp. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Due to immunosuppression caused by elevated glucose levels"
      },
      {
        "id": 2,
        "text": "Repeated injury leads to Charcot's foot"
      },
      {
        "id": 3,
        "text": "Glycemic control and antibiotic therapy is first line managment"
      },
      {
        "id": 4,
        "text": "Sensory nerves are affected in the late stage of disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 974\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The image and clinical scenario are suggestive of <strong>diabetic gangrene of the foot.</strong>&nbsp;It is accompanied by<strong> sensory loss </strong>in the<strong> early stage</strong> of the disease and <strong>motor involvement </strong>in the<strong> late stage.</strong>&nbsp;</p>\n<p>Diabetic gangrene is caused by a combination of three factors:</p>\n<ul>\n<li><strong>Ischemia</strong> secondary to macrovascular disease and microvascular dysfunction,</li>\n<li>Peripheral sensorimotor <strong>neuropathy,</strong> which leads to trophic skin changes</li>\n<li><strong>Immunosuppression</strong> is caused by excess sugar in the tissues, which predisposes to infection</li>\n</ul>\n<p>Diabetic gangrene is<strong>&nbsp;</strong>accompanied by loss of sensation and reflexes which lead to repeated injury. There occurs an imbalance between the flexors and extensors of the foot which causes deformities known as <strong>Charcot's foot (neuropathic joints).</strong></p>\n<p>Initial treatment comprises strict <strong>glycemic control</strong> and <strong>antibiotic therapy</strong>. The gangrene is treated by drainage of pus, debridement of dead tissue with local amputation of necrotic digits.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d7c59b09b67e450f891c325b019a81e2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presents to the casualty with complaints of recurrent episodes of syncope and cramping of his left arm. Symptoms mostly occur during his evening badminton practice sessions.  Which of the following is incorrect about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Due to occlusion in the 3rd part of subclavian artery"
      },
      {
        "id": 2,
        "text": "Distal pulse of the affected side is feeble"
      },
      {
        "id": 3,
        "text": "CT angiography is used to visualize retrograde blood flow"
      },
      {
        "id": 4,
        "text": "Management includes angioplasty and stenting"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario points to a diagnosis of <strong>subclavian steal syndrome</strong>. In subclavian steal syndrome, the\u00a0<strong>first part of </strong>the<strong> subclavian artery</strong> is<strong> occluded.</strong></p>\n<p>Subclavian steal syndrome is characterized by the presence of stenosis in the first part of the subclavian artery either due to atherosclerotic changes or emboli. It leads to\u00a0<strong>reversed flow </strong>in the<strong> vertebral artery</strong>\u00a0causing cerebral ischemia.</p>\n<p>Symptoms include dizziness, syncope on arm exercise. Occasionally, distal pulses in the arm of the affected side are found to be feeble.</p>\n<p>Investigations include duplex ultrasonography, CT, and MR angiography.</p>\n<p>It can be treated by <strong>angioplasty, stenting\u00a0</strong>or by extra-thoracic subclavian<strong> bypass.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/80f4b89f026c4d9289fee9d0f590da3ex1280x1725.JPEG"
    ]
  },
  {
    "text": "In Paget-Schroetter syndrome which of the following structure is affected?",
    "choices": [
      {
        "id": 1,
        "text": "Subclavian artery"
      },
      {
        "id": 2,
        "text": "Subclavian vein"
      },
      {
        "id": 3,
        "text": "Axillary artery"
      },
      {
        "id": 4,
        "text": "Brachiocephalic vein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In Paget-Schroetter syndrome, the <strong>subclavian vein</strong> is affected.</p>\n<p>Compression of subclavian vein between anterior scalene, clavicle, and the first rib can produce <strong>axillary-subclavian vein thrombosis</strong>. It&nbsp;results in severe upper extremity pain and swelling, &nbsp;that is&nbsp;exaggerated by<strong> exercise.</strong></p>\n<p>Activities such as throwing, swimming, and weightlifting can cause microtrauma of the venous intima that initiates thrombus formation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old male patient who came to the OPD with complaints of pain and numbness of the arm is diagnosed with thoracic outlet syndrome. Which nerve is involved in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Median Nerve"
      },
      {
        "id": 2,
        "text": "Ulnar Nerve"
      },
      {
        "id": 3,
        "text": "Axillary Nerve"
      },
      {
        "id": 4,
        "text": "Radial Nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In&nbsp;<strong>thoracic outlet syndrome (TOS) </strong>the lower two nerve roots of the brachial plexus, <strong>C8 and T1</strong> are most commonly involved and produce pain and paresthesia along the&nbsp;<strong>ulnar nerve distribution</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A resident is trying to elicit symptoms of thoracic outlet syndrome in a patient. He asks the patient to keep both arms in the 90\u00b0 abduction-external rotation position and to open and close the hands slowly over a 3-minute period. What is this test called?",
    "choices": [
      {
        "id": 1,
        "text": "Adson test"
      },
      {
        "id": 2,
        "text": "Halsted test"
      },
      {
        "id": 3,
        "text": "Wright test"
      },
      {
        "id": 4,
        "text": "Roos test"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The test described in the question is a provocative test for thoracic outlet syndrome called <strong>Roos test </strong>(extended arm stress test).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman presents to the hospital with sudden discoloration of the hands. Which of the following would suggest a diagnosis of acrocyanosis over Raynaud\u2019s phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Episodic"
      },
      {
        "id": 2,
        "text": "Absent peripheral pulses"
      },
      {
        "id": 3,
        "text": "Absence of pain and numbness"
      },
      {
        "id": 4,
        "text": "Presence of trophic skin changes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In acrocyanosis, there is <strong>no pain or numbness.</strong> In Raynaud&rsquo;s phenomenon, there is pain and tingling sensation.</p>\n<p><strong>Acrocyanosis</strong> is a chronic, benign vasoconstrictive disorder. It is due to arterial vasoconstriction and secondary dilation of the capillaries and venules that results in&nbsp;<strong>persistent cyanosis</strong> of the hands and feet. It can be primary or secondary.</p>\n<div class=\"page\" title=\"Page 832\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Primary acrocyanosis is more common in females with an onset &lt;30 years. Trophic skin changes and ulcerations do not occur and examination reveals normal pulses.</p>\n</div>\n</div>\n</div>\n</div>\n<p>The disorder can be distinguished from Raynaud&rsquo;s phenomenon:</p>\n<ul>\n<li>Because it is <strong>persistent </strong>and<strong> not episodic</strong></li>\n<li>There is <strong>no pain </strong>in acrocyanosis whereas in Raynaud's phenomenon there is pain and numbness</li>\n<li>The discoloration extends proximally from the digits</li>\n<li>Blanching does not occur&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old female nurse was on her way to the hospital for her early morning shift. Suddenly she started to notice pain in her fingers which were turning pale and numb after which they turned blue. Which of the following statements are false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Triggered by cold as well as stress"
      },
      {
        "id": 2,
        "text": "Calcium channel blockers are used for treatment"
      },
      {
        "id": 3,
        "text": "Mainstay of treatment includes avoidance of triggers"
      },
      {
        "id": 4,
        "text": "Is not associated with autoimmune diseases"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<table style=\"width: 743.3014526367188px;\">\n<tbody>\n<tr style=\"height: 52.3333px;\">\n<td style=\"width: 419px; height: 52.3333px;\"><strong>Primary Raynaud's phenomenon (Raynaud's disease)</strong></td>\n<td style=\"width: 361.301px; height: 52.3333px;\">\n<p><strong>Secondary Raynaud's phenomenon</strong></p>\n</td>\n</tr>\n<tr style=\"height: 33px;\">\n<td style=\"width: 419px; height: 33px;\">Idiopathic and more common</td>\n<td style=\"width: 361.301px; height: 33px;\">\n<p>Secondary to other conditions (autoimmune diseases, vibration injury)</p>\n</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 419px; height: 17px;\">Women are more commonly affected&nbsp;</td>\n<td style=\"width: 361.30145263671875px; height: 17px;\">No gender predisposition</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 419px; height: 17px;\">Age of presentation is between 20 to 40 years</td>\n<td style=\"width: 361.30145263671875px; height: 17px;\">Present later in life&nbsp;</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 419px; height: 17px;\">Episodic&nbsp;</td>\n<td style=\"width: 361.30145263671875px; height: 17px;\">-</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 419px; height: 17px;\">Affects both hands and feet</td>\n<td style=\"width: 361.30145263671875px; height: 17px;\">Affects either both hands or both feet&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3fce620faabb45da82cfa41eb84ea196x475x303.JPEG"
    ]
  },
  {
    "text": "Which of the following is an incorrect statement about Buerger's disease?",
    "choices": [
      {
        "id": 1,
        "text": "2,3,4"
      },
      {
        "id": 2,
        "text": "1,5"
      },
      {
        "id": 3,
        "text": "1,3"
      },
      {
        "id": 4,
        "text": "2,4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Statements 1 and 3 are false. In thromboangitis obliterans,&nbsp;there is<strong> normal brachial </strong>and <strong>popliteal pulses </strong>but reduced or absent radial, ulnar, and/or tibial pulses<strong>.&nbsp;</strong>It is most common in <strong>male</strong> <strong>smokers</strong>, usually under the age of 30 years.</p>\n<p><strong>Thromboangiitis obliterans </strong>(Buerger&rsquo;s disease) is an&nbsp;inflammatory occlusive vascular disorder involving small and medium-sized arteries and veins in the distal upper and lower extremities.&nbsp;</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">&nbsp;The clinical features include a triad of:</p>\n<ul>\n<li>Claudication of the affected extremity</li>\n<li>Raynaud&rsquo;s phenomenon</li>\n<li>Migratory superficial vein thrombophlebitis</li>\n</ul>\n</div>\n</div>\n<p>Patients frequently have rest pain, ulceration, and digital gangrene.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old male construction worker presents with exertional pain and darkening of the skin in both forearms and hands as shown in the image. He smokes 1 pack of cigarettes per day and has no comorbidities  On examination, brachial pulses are palpable but radial and ulnar pulses are feeble. Angiography of his upper extremity shows smooth tapering segmental lesions in the distal arterial vessels. Which of the following treatments has the greatest chance of success?",
    "choices": [
      {
        "id": 1,
        "text": "Cilostazol"
      },
      {
        "id": 2,
        "text": "Heparin and surgical revascularization"
      },
      {
        "id": 3,
        "text": "High dose steroids"
      },
      {
        "id": 4,
        "text": "Smoking cessation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario points to a diagnosis of <strong>thromboangiitis obliterans</strong>. There is no specific treatment except <strong>abstinence from tobacco</strong>.\u00a0Key findings in this patient is age &lt; 40 years, smoker, and involvement of upper extremity.</p>\n<p>Although the cause of thromboangiitis obliterans is not known, there is a definite relationship to<strong> cigarette smoking</strong> in patients with this disorder. There is <strong>no specific treatment</strong> except abstention from tobacco.</p>\n<p>MRA, CTA, and conventional arteriography show smooth, tapering segmental lesions in the distal vessels with collateral vessels at sites of vascular occlusion.</p>\n<p>The <strong>prognosis </strong>is <strong>poor</strong> in individuals who<strong> continue to smoke.\u00a0</strong></p>\n<p><strong>Surgical revascularization</strong> is <strong>not</strong> <strong>possible</strong> due to extensive vascular inflammation and damage. Anticoagulants and glucocorticoids are not helpful.\u00a0If the condition worsens, <strong>amputation</strong> may be required.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a623f79b3520458ea0ecd5abe9481058.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old chronic smoker presented with cramping pain in the buttocks and erectile dysfunction for the past 6 months. He has no history of bladder dysfunction or fecal incontinence. Examination revealed absent femoral pulses and normal sensory and motor system. How will you surgically manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Aortobifemoral grafting"
      },
      {
        "id": 2,
        "text": "Aortofemoral grafting"
      },
      {
        "id": 3,
        "text": "Illiopopliteal grafting"
      },
      {
        "id": 4,
        "text": "Iliofemoral grafting"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of<strong> Leriche syndrome.</strong> The treatment of choice here is <strong>aortobifemoral</strong> <strong>grafting</strong>.</p>\n<p><strong>Leriche syndrome</strong> is due to <strong>occlusion at the aortic bifurcation</strong> and is characterized by</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&nbsp;<strong>Buttock claudication</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&nbsp;<strong>Impotence</strong> &nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Absence of femoral pulse</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">No sensory or motor deficit</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Normal reflexes</li>\n</ul>\n<p><strong>Atherosclerosis</strong> is the most common cause of Leriche syndrome.&nbsp;</p>\n<p>Differential diagnosis includes</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abdominal dissection&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Spinal canal stenosis&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Spinal disc herniation</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td>Intermittent claudication</td>\n<td>Neurogenic claudication</td>\n<td>osteoarthritis</td>\n</tr>\n<tr>\n<td>Pain after walking a certain distance</td>\n<td>Pain after walking or standing for some time</td>\n<td>Maximum pain on the first step.</td>\n</tr>\n<tr>\n<td>Pain quickly relieved on resting.</td>\n<td>Pain relieved on flexion</td>\n<td>Pain relieved on resting.</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Aortofemoral grafting</strong> is done in unilateral iliac vessel occlusion.</p>\n<p><strong>Iliofemoral grafting</strong> is done for unilateral occlusion of distal common iliac or external iliac artery.</p>\n<p><strong>Illiopopliteal grafting</strong> is done for femoral artery occlusion.<br style=\"font-weight: 400;\" /><br style=\"font-weight: 400;\" /></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an indication for a carotid endarterectomy?",
    "choices": [
      {
        "id": 1,
        "text": "Dysphonia"
      },
      {
        "id": 2,
        "text": "Amaurosis fugax"
      },
      {
        "id": 3,
        "text": "Facial palsy"
      },
      {
        "id": 4,
        "text": "Hemianopia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Dysphonia</strong> is <strong>not</strong> an indication for <strong>carotid endarterectomy</strong>. Carotid endarterectomy is done in carotid artery stenosis.</p>\n<p>Indications of carotid endarterectomy in symptomatic patients.</p>\n<p><strong>CT angiography</strong> showing <strong>70% or more stenosis</strong> and</p>\n<ul>\n<li>Ipsilateral <strong>amaurosis fugax</strong> or monocular blindness</li>\n<li>Contralateral <strong>facial paralysis</strong> or paresthesia</li>\n<li><strong>Arm/leg paralysis</strong> or paresthesia</li>\n<li><strong>Hemianopia</strong></li>\n<li><strong>Dysphasia</strong></li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '50 Ischemic Arterial Diseases';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>