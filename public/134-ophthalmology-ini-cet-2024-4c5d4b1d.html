<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>134 Ophthalmology Ini-Cet 2024 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 3 months old baby was brought with photophobia and lacrimation. Which of the following cannot be the cause?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital entropion"
      },
      {
        "id": 2,
        "text": "Congenital glaucoma"
      },
      {
        "id": 3,
        "text": "Congenital distichiasis"
      },
      {
        "id": 4,
        "text": "Congenital nasolacrimal duct obstruction"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Congenital nasolacrimal duct obstruction (NLDO)</strong> is least likely to cause <strong>watering </strong>and<strong> photophobia</strong>.</p>\n<p>Nasolacrimal duct obstruction is the most common disease of the lacrimal system. It usually presents in the first few weeks or months of life as <strong>excessive tearing and ocular discharge</strong>. It mostly occurs due to incomplete canalization of the duct.</p>\n<p>Congenital NLDO mainly results in persistent tearing and sometimes a discharge from the eyes but <strong>not photophobia</strong>, as the light sensitivity is not directly related to this condition.</p>\n<p>Typically, diagnosis is established through a combination of patient history and physical examination. In cases where symptoms are intermittent, the presence of an obstruction can be confirmed using the <strong>fluorescein dye disappearance</strong> test.\u00a0</p>\n<p>The initial treatment involves performing<strong> nasolacrimal massage</strong>, typically 2-3 times daily, along with cleansing the eyelids using warm water and applying <strong>topical antibiotics</strong>. If it does not resolve after massaging by the age of <strong>6 to 10 months</strong>,<strong> lacrimal duct probing </strong>is done.\u00a0</p>\n<p>If probing fails, other treatment options include intubation with silastic tubing with or without balloon dilatation of the nasolacrimal duct and <strong>dacryocystorhinostomy.</strong></p>\n<p>Other options:</p>\n<p>Option A: Congenital <strong>entropion</strong>: This is a condition where the eyelid is turned inward, causing the <strong>eyelashes to rub against the cornea</strong>. This can lead to <strong>irritation, photophobia, and excessive tearing</strong> (lacrimation).</p>\n<p>Option B: <strong>Primary congenital glaucoma (PCG)</strong> is caused by impaired aqueous outflow due to a maldeveloped anterior chamber angle. Clinically, the child presents with <strong>lacrimation, photophobia, and blepharospasm</strong>.</p>\n<p>Option C: <strong>Congenital distichiasis</strong>: This is a condition where an <strong>extra row of eyelashes</strong> grows from the meibomian glands on the eyelid margin. These extra lashes <strong>can irritate the cornea</strong>, leading to <strong>photophobia and tearing</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A construction site worker comes in with red eyes and lacrimation. He got chuna particles in his eyes an hour ago. What is the initial step in the treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Irrigation with normal saline"
      },
      {
        "id": 2,
        "text": "Topical antibiotics and cycloplegics"
      },
      {
        "id": 3,
        "text": "Patch the eye after topical lubricants"
      },
      {
        "id": 4,
        "text": "Temporary tarsoraphy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The initial step in the management of a patient presenting with chemical burns is immediate and <strong>thorough irrigation</strong> with the available clean water or normal <strong>saline</strong> delivered through an IV tubing. This is done to <strong>prevent further damage.\u00a0</strong></p>\n<p>Along with irrigation, <strong>contaminant elimination t</strong>hrough <strong>mechanical</strong> means shall be done. In the event of residue, especially with lime (chuna), it is essential to meticulously eliminate them using a swab stick.</p>\n<p>After the initial steps, maintenance of favorable conditions for rapid and uncomplicated healing by following measures:</p>\n<ul>\n<li>Topical <strong>antibiotic drops</strong>, for example, moxifloxacin 4-6 times a day to prevent infection.</li>\n<li><strong>Steroid eye drops</strong> to decrease inflammation, neutrophil infiltration, and treat anterior uveitis. Caution is advised after 2 weeks, as steroids could disrupt collagen synthesis.</li>\n<li><strong>Cycloplegics</strong>, such as atropine, might enhance comfort.</li>\n</ul>\n<p>Grading of severity (Roper\u2013Hall system) of chemical injuries is based on corneal clarity and severity of limbal ischemia:</p>\n<ul>\n<li><strong>Grade 1 \u00a0i</strong>s characterized by a <strong>clear cornea</strong> (epithelial damage only) and <strong>no limbal ischemia </strong>(excellent prognosis).</li>\n<li><strong>Grade 2</strong> shows a<strong> hazy cornea</strong> but with visible iris detail and <strong>less than one-third</strong> of the limbus being ischemic (good prognosis).</li>\n<li><strong>Grade 3 </strong>manifests as a <strong>total loss of the corneal epithelium</strong>, stromal haze obscuring iris detail, and <strong>between one-third and half </strong>of the limbus showing ischemia (guarded prognosis).</li>\n<li><strong>Grade 4</strong> manifests with an <strong>opaque cornea</strong> and<strong> more than 50% </strong>of the limbus showing ischemia (poor prognosis).<br />\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is anisometropia ?",
    "choices": [
      {
        "id": 1,
        "text": "Difference in visual acuity"
      },
      {
        "id": 2,
        "text": "Difference in refractive power"
      },
      {
        "id": 3,
        "text": "Difference in axial length"
      },
      {
        "id": 4,
        "text": "Difference in size of eye ball"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Anisometropia</strong> is the condition where there is difference in refractive powers of two eyes.\u00a0</p>\n<p>Anisometropia occurs when the<strong> total refraction of both eyes are unequal</strong>. A difference of 1D in the two eyes causes a 2% difference in the size of retinal images formed. A difference up to 2.5D is well-tolerated, but beyond<strong> 4D</strong> cannot be tolerated. Anisometropia can occur as a combination of emmetropia, myopia, hypermetropia, and astigmatism.</p>\n<p>It is diagnosed after <strong>retinoscopic examination </strong>and <strong>autorefractometry.\u00a0</strong></p>\n<p>Treatment includes the usage of spectacles (it can be tolerated up to a maximum difference of 4D), contact lenses, intraocular lenses (for uniocular aphakia), refractive corneal surgery, or refractive lens exchange methods (used in high degree anisometropia).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following are features of third cranial nerve palsy except",
    "choices": [
      {
        "id": 1,
        "text": "Elevation"
      },
      {
        "id": 2,
        "text": "Adduction"
      },
      {
        "id": 3,
        "text": "Limited abduction"
      },
      {
        "id": 4,
        "text": "Ptosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Limited abduction</strong> is not a feature of third cranial nerve palsy.</p>\n<p>Abduction is carried out by the <strong>lateral rectus, </strong>which is supplied by the <strong>abducens\u00a0(sixth) nerve</strong>.\u00a0</p>\n<p>Third cranial nerve (oculomotor nerve) palsy presents with:\u00a0</p>\n<ul>\n<li>Profound <strong>ptosis </strong>due to the weakness of the levator muscle</li>\n<li><strong>Limited adduction</strong> due to medial rectus weakness</li>\n<li><strong>Limited elevation</strong> due to the weakness of the superior rectus and inferior oblique</li>\n<li>Abduction and depression in the primary position (\"<strong>down and out</strong>\")</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d647a6530f34aba91fec5720a4a03bcx1280x3519.JPEG"
    ]
  },
  {
    "text": "What is the most common cause of proptosis in middle aged individuals?",
    "choices": [
      {
        "id": 1,
        "text": "Cavernous hemangioma"
      },
      {
        "id": 2,
        "text": "Orbital varix"
      },
      {
        "id": 3,
        "text": "Thyroid eye disease"
      },
      {
        "id": 4,
        "text": "Retinoblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most common cause of proptosis in middle age is <strong>thyroid eye disease.\u00a0</strong></p>\n<p><strong>Graves ophthalmopathy</strong>\u00a0is one of the most serious ocular manifestations of Graves disease. Between the ages of 25 and 50, it's the leading cause of <strong>unilateral and bilateral proptosis</strong> in adults. Proptosis, eyelid retraction, restricted myopathy, and perhaps compressive optic neuropathy are clinical manifestations that could potentially be used for diagnosis.</p>\n<p>The mechanism proposed for this is the acute precipitation of a hypothyroid state which leads to an increase in TSH secretion. This leads to stimulation of the r<strong>etro-orbital fibroblasts and adipocytes</strong> which have the receptor for TSH.\u00a0</p>\n<p>An <strong>abnormal protrusion of the globe</strong> is called proptosis. Exophthalmometry measures protrusion of the apex of the cornea from the outer orbital margin (with the eyes looking straight ahead). An <strong>absolute protrusion of &gt;20 mm </strong>or a difference of &gt;2 mm between the two eyes is labelled as proptosis.</p>\n<p>Option A: <strong>Cavernous hemangioma</strong> is the most <strong>common primary benign orbital tumor in adults</strong>. They are composed of large, dilated vascular channels; are more infiltrative; frequently involve deep structures; and do not spontaneously regress. On histologic examination, the mass is sharply delineated but unencapsulated with large, cavernous blood-filled vascular spaces, separated by connective tissue stroma.</p>\n<p>Option B: The type of proptosis seen in orbital varix is <strong>non-pulsatile, intermittent, and reducible proptosi</strong>s. On activities such as forward bending or lowering of the head, turning the head forcefully, hyperextension of the neck, and coughing, the varices fill up, causing proptosis, and then, they regress on shifting to a non-dependent position.</p>\n<p>Option D: <strong>Retinoblastoma </strong>is the <strong>most common intraocular malignancy in children</strong>. It is associated with mutations in the RB1 gene at chromosome 13q14. \u00a0White pupillary reflex or leukocoria is the most common presenting feature, followed by a squint which is usually convergent. Histopathology of the tumor shows small round cells with large nuclei. Microscopic features includes Flexner-Wintersteiner rosettes(highly specific of retinoblastoma), Homer-Wright rosettes, pseudorosettes, and fleurettes formation. Areas of necrosis and calcification can also be seen.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40 year old with high myopia wearing thick glasses from childhood  came with complaints of sudden onset of flashes of light in left eye. What could be the likely cause ?",
    "choices": [
      {
        "id": 1,
        "text": "Retinal detachment"
      },
      {
        "id": 2,
        "text": "CRAO"
      },
      {
        "id": 3,
        "text": "CRVO"
      },
      {
        "id": 4,
        "text": "Subarachnoid haemorrhage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario of patient with severe myopia presenting sudden onset of flashes of light is likely<strong> retinal detachment.</strong></p>\n<p>Retinal detachment is the separation of the neurosensory retina and the retinal pigment epithelium (RPE).</p>\n<p>Risk factors include <strong>myopia, previous intraocular surgery such as aphakia or pseudophaki</strong>a, a family history of retinal detachment, and trauma.</p>\n<p>Clinical features include <strong>sudden painless loss of vision</strong>, <strong>flashes of light</strong> or photopsia,<strong> floaters</strong> in the eye, and curtains in the field of vision.</p>\n<p>Examination findings will reveal:</p>\n<ul>\n<li>Normal or slightly low intraocular pressure</li>\n<li>Marcus Gunn pupil (relative afferent pupillary defect)</li>\n<li>Altered red reflex on the distant direct ophthalmoscope</li>\n<li>Indirect ophthalmoscopy may show grey reflex of the freshly detached retina or breaks in the retina\u00a0</li>\n<li>Vitreous pigments on the anterior vitreous (<strong>Shaffer sign</strong>)</li>\n<li><strong>Shifting fluid sign</strong>- Change in the position of the detached area with a change in gravity is the hallmark of <strong>exudative retinal detachment.\u00a0 \u00a0 </strong>\u00a0 \u00a0 \u00a0\u00a0 \u00a0 \u00a0 <br />\u00a0Management of rhegmatogenous retinal detachment includes sealing of retinal breaks, reducing the vitreous traction on the retina, and flattening of the retina by draining the subretinal fluid. <strong>Scleral buckling</strong>, pneumatic retinopexy, and pars plana vitrectomy can help in maintaining the chorioretinal apposition.\u00a0</li>\n</ul>\n<p>Treating the cause helps in exudative retinal detachment. Enucleation can be done if intranuclear tumors are present.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following disease results in weakness of the levator palpebrae superioris, corneal anaesthesia, lagophthalmos, and ultimately blindness?",
    "choices": [
      {
        "id": 1,
        "text": "Lyme's disease"
      },
      {
        "id": 2,
        "text": "Leprosy"
      },
      {
        "id": 3,
        "text": "Ophthamia neonatorum"
      },
      {
        "id": 4,
        "text": "Trachoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Leprosy could result in paresis of the levator palpebrae superioris, corneal anaesthesia, lagophthalmos, and ultimately blindness.</p>\n<p>Lagophthalmos is the <strong>inability to close the eyelids</strong>. This can be due to the involvement of the <strong>zygomatic branch of the facial nerve</strong> (as in leprosy). Other causes of lagophthalmos include extreme proptosis and symblepharon. The <strong>decreased corneal sensation</strong> seen is due to the involvement of the <strong>ophthalmic branch of the trigeminal nerve</strong> which innervates the cornea.\u00a0</p>\n<p>Leprosy or Hansen disease is a chronic granulomatous disease caused by infection with <strong>Mycobacterium leprae</strong>. Ocular features in leprosy occur due to<strong> bacterial invasion</strong> and include <strong>corneal anesthesia, lagophthalmos, corneal ulceration, episcleritis</strong>, and iris atrophy. Other features seen are:</p>\n<ul>\n<li><strong>Keratitis</strong> with thickened, beaded corneal nerves, punctate subepithelial lesions, pannus, and vascularization</li>\n<li>Chronic low-grade anterior uveitis</li>\n<li>Miosis</li>\n<li>Iris atrophy</li>\n<li><strong>Iris pearls\u00a0</strong></li>\n<li>Retinal pearls\u00a0</li>\n</ul>\n<p>Option B: The most common ocular manifestation in Lyme's disease is conjunctivitis. Other manifestations like keratitis, iridocyclitis, retinal vasculitis, choroiditis, optic neuropathy, and uveitis occurs very rarely.</p>\n<p>Option C: Ophthalmia neonatarum also called neonatal conjunctivitis is inflammation of the conjunctiva occurring in an infant &lt;30 days after birth. The clinical features include conjunctival redness, eyelid edema, and ocular discharge (purulent or mucopurulent).</p>\n<p>Option D: In trachoma, the symptoms include lacrimation, scanty mucoid discharge and foreign body sensation. Conjunctival congestion and follicles, papillary hyperplasia, Herbert follicles (seen in the limbal area), and progressive pannus are the characteristic features.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are actions of superior oblique except?",
    "choices": [
      {
        "id": 1,
        "text": "Depression"
      },
      {
        "id": 2,
        "text": "Adduction"
      },
      {
        "id": 3,
        "text": "Abduction"
      },
      {
        "id": 4,
        "text": "Intorsion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Adduction</strong> is <strong>not an action</strong> of the superior oblique muscle.</p>\n<p>The superior oblique muscle's primary, secondary and tertiary actions are <strong>intorsion, depression</strong> and <strong>abduction</strong> respectively.</p>\n<p>It originates from the <strong>apex of the orbit, </strong>turns around the trochlea, and inserts into the sclera behind the equator. The <strong>oblique direction</strong> of the tendon is responsible for its rotatory effect (intorsion), in addition to depression and abduction. It is supplied by the <strong>trochlear nerve.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da502ce1c9f246cda9874a89a8b4fda3x1280x1901.JPEG"
    ]
  },
  {
    "text": "A patient presents with diminished night vision and the following finding was seen on fundoscopy. Which of the following statements is not true regarding the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dystrophy of rods more common than that of cones"
      },
      {
        "id": 2,
        "text": "ERG shows decreased amplitude of A and B waves"
      },
      {
        "id": 3,
        "text": "Sometimes patients present in later stages with loss of peripheral vision."
      },
      {
        "id": 4,
        "text": "Night blindness is a late feature"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option B<strong>:</strong><strong>Electroretinography (ERG)</strong> is the record of changes in the resting potential of the eye induced by a flash of light.</p>\n<p>Waves of normal ERG</p>\n<ul>\n<li>a-wave: negative wave possibly arising from the <strong>rods and cones</strong></li>\n<li>b-wave: large positive wave which is generated by Muller cells, but represents the <strong>activity of the bipolar cells</strong></li>\n<li>c-wave: positive wave representing the <strong>metabolic activity of pigment epithelium</strong></li>\n</ul>\n<p>In retintis pigmentosa, it is <strong>abnormal</strong> and shows reduced scotopic, subnormal responses in early disease and becomes <strong>completely extinguished</strong> in advanced disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ad7085d78b2d46c29ee72741dbb3744a.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient of rheumatic heart disease presents with superior visual field defect in left eye since 1 week, what is the probable cause?",
    "choices": [
      {
        "id": 1,
        "text": "Central retinal artery occlusion"
      },
      {
        "id": 2,
        "text": "Central retinal vein occlusion"
      },
      {
        "id": 3,
        "text": "Branch retinal vein occlusion"
      },
      {
        "id": 4,
        "text": "Branch retinal artery occlusion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A patient with <strong>rheumatic heart disease (RHD)</strong> presenting with superior visual defects for the past one week is likely due to <strong>branch retinal artery occlusion (BRAO)</strong>.</p>\n<p>Retinal artery occlusion usually occurs due to an <strong>embolus</strong>. Emboli can originate between the vasculature from the heart to the ophthalmic artery. Risk factors\u00a0include <strong>Buerger\u2019s disease, hypertension, elevated lipid levels, cigarette smoking, RHD, and diabetes mellitus</strong>.</p>\n<p>Retinal emboli can be of 3 types: cholesterol (Hollenhorst plaque), platelet-fibrin, and calcific. The emboli associated with <strong>cardiac thrombosis</strong> as seen in <strong>RHD</strong> are <strong>platelet-fibrin</strong>.\u00a0</p>\n<p>Features of BRAO:</p>\n<ul>\n<li><strong>Sudden painless loss of vision</strong> in one eye corresponding to the territory of the <strong>obstructed artery</strong>. <strong>Amaurosis fugax</strong> can be seen in patients with preexisting carotid disease.</li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Retinal whitening</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> is the most notable finding seen due to </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">ischaemia</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of the inner layers of the retina. </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Cotton wool spots</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> can also appear.</span></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Fluorescein angiography (FA)</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> shows </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">diminution</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> in the dye distal to the site of obstruction. There may be some </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">leaks</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> visible at the site of the embolus.</span></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">OCT (optical coherence tomography)</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> initially shows </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">hyperreflective </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">and</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> thickened inner layers</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of the retina in the obstructed territory, which start thinning out with time.</span></li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Visual field testing</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> is used to assess the extent of loss of vision.</span></li>\n</ul>\n<p>No effective treatment has been found for BRAO. <strong>Ocular massage, lasers, or paracentesis</strong> can be used to disrupt the embolus. Vasodilation with <strong>inhaled amyl nitrite</strong> can be done.</p>\n<p>In hypercoagulative states, <strong>prophylactic anticoagulation </strong>can be started to prevent future episodes.</p>\n<p>Other options:</p>\n<p>Option A: Central retinal artery occlusion occurs due to obstruction at the level of <strong>lamina cribrosa</strong>. Patient complains of <strong>sudden painless loss of vision</strong> occurring over seconds.\u00a0\u00a0</p>\n<p>Option B: Patients with CRVO usually complain of the acute onset of<strong> painless blurred vision</strong> in one eye. CRVO is seldom asymptomatic.</p>\n<p>Option C: Patients with BRVO typically present with <strong>peripheral visual field defects</strong> in the defective eye. However, in settings of RHD, arterial occlusion is more likely.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 80 yrs old patient presents with a painful, red right eye. On examination, the IOP of his right eye is 50mmHg and left eye is 16mmHg. Slit lamp examination reveals deep anterior chamber, presence of flare cells in the anterior chamber and cataractous lens in the right eye. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phacolytic glaucoma"
      },
      {
        "id": 2,
        "text": "Malignant glaucoma"
      },
      {
        "id": 3,
        "text": "Fuch heterochromic iridocyclitis"
      },
      {
        "id": 4,
        "text": "Phacomorphoic glaucoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of an 80 year old presenting with painful red eyes, increased IOP and presence of a deep anterior chamber points towards the diagnosis of <strong>secondary open-angle glaucoma</strong> - <strong>phacolytic glaucoma</strong>.</p>\n<p>Phacolytic glaucoma is secondary open-angle glaucoma occurring in association with<strong> hyper mature morgagnian cataracts</strong>.</p>\n<p>Trabecular obstruction is caused by high molecular-weight <strong>lens proteins</strong> that <strong>leak</strong> through the<strong> intact capsule</strong> in cases of the hyper mature cataract into the aqueous humour; macrophages containing lens proteins may also contribute to this.</p>\n<p>Presentation:</p>\n<ul>\n<li><strong>Eye pain</strong></li>\n<li><strong>Diminished vision</strong></li>\n<li><strong>Photophobia</strong></li>\n<li><strong>Lacrimation\u00a0</strong></li>\n<li>Headache</li>\n<li><strong>Increased intraocular pressure</strong></li>\n<li><strong>Deep anterior chamber</strong> with fine white protein particles which may settle as <strong>pseudohypopyon</strong></li>\n<li>Open-angle seen on gonioscopy</li>\n<li>Lens: Milky white cortex with sunken brownish nucleus (Morgagnian cataract)\u00a0 \u00a0\u00a0</li>\n</ul>\n<p>Treatment: Medical therapy to lower the intraocular pressure, Surgery to extract the lens</p>\n<p>Other options:</p>\n<p>Option B: <strong>Malignant glaucoma</strong> is seen after intraocular surgery such as <strong>trabeculectomy</strong>. The forward flow of aqueous is blocked as the tips of ciliary processes rotate forward and press against the lens/IOL/anterior hyaloid of the vitreous. Hence, aqueous humor collects in the vitreous cavity. There is <strong>persistent shallow or flat anterior cha</strong>mber</p>\n<p>Option C: In Fuchs heterochromic iridocyclitis, the IOP is not usually so high.</p>\n<p>Option D: <strong>Phacomorphic glaucoma</strong> is an acute secondary angle-closure glaucoma caused by an intumescent cataractous lens due to rapid maturation of cataract or following traumatic capsular rupture. The swollen lens obliterates the angle by forcing the root of the iris against the cornea. The patient presents with features of acute glaucoma with a <strong>shallow anterior chamber</strong> and a swollen cataractous lens.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a complication of diabetic retinopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior staphyloma"
      },
      {
        "id": 2,
        "text": "Retinoschisis"
      },
      {
        "id": 3,
        "text": "Tractional retinal detachment"
      },
      {
        "id": 4,
        "text": "Progressive myopia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tractional retinal detachment</strong> is a complication of diabetic retinopathy.\u00a0</p>\n<p><strong>Diabetic retinopathy</strong> is a complication of diabetes that affects the retina due to prolonged high blood sugar levels. Over time, it can lead to several <strong>complications</strong>, including:</p>\n<ul>\n<li><strong>Diabetic Macular Edema</strong> (DME): Diabetic retinopathy weakens the walls of the blood vessels in your retina, causing the leak of fluid and blood into the macula.\u00a0</li>\n<li><strong>Vitreous Hemorrhage</strong>: New blood vessels can bleed into the vitreous. This bleeding prevents light from reaching the retina. If the bleeding is minor, may present with floaters. However, in more severe cases, the blood can fill the vitreous cavity, completely obstructing your vision.</li>\n<li><strong>Neovascular glaucoma</strong>: Abnormal blood vessels can grow out of the iris and can block fluid from draining properly, leading to a type of glaucoma.\u00a0</li>\n<li><strong>Tractional retinal detachment</strong> occurs due to the formation of fibrovascular tissue from proliferative diabetic retinopathy. The fibrous tissue exerts traction on the retina, pulling it away from the underlying layers and causing a retinal detachment. The most common cause of tractional retinal detachment is proliferative diabetic retinopathy.</li>\n</ul>\n<p>Other options</p>\n<p>Option A: <strong>Posterior staphyloma</strong> is associated with <strong>progressive myopia</strong>.</p>\n<p>Option B: <strong>Retinoschisis</strong> refers to the splitting of the retinal layers and is seen in <strong>degenerative retinal diseases</strong>.</p>\n<p>Option D: <strong>Progressive myopia</strong> is unrelated to diabetic retinopathy and occurs due to <strong>elongation of the eyeball</strong>, genetic factors, environmental factors and too much near work such as reading and using digital devices for long hours.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about macular opacity?",
    "choices": [
      {
        "id": 1,
        "text": "Iris and pupil are visible"
      },
      {
        "id": 2,
        "text": "Only the pupillary margin is visible"
      },
      {
        "id": 3,
        "text": "Iris details are visible"
      },
      {
        "id": 4,
        "text": "Iris and pupillary margins are not visible"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Among the given options, \u2018only the pupillary margin is visible\u2019 is the true statement regarding macular opacity. Macular opacity is a type of corneal opacity.</p>\n<p><strong>Corneal macular opacity</strong> refers to a moderate to dense opacity in the cornea. In such cases, light transmission through the cornea is partially obstructed. This limits the visibility of deeper structures like the<strong> iris</strong> and its fine details(options A &amp; C). However, because the pupillary margin<strong> </strong>contrasts with its surrounding structures and lies directly behind the corneal opacity and the obstruction selectively allows the <strong>pupillary margin</strong> to be <strong>visible</strong>(options B &amp; D).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about viscoelastic substances?",
    "choices": [
      {
        "id": 1,
        "text": "Causes mechanical injury to corneal endothelium"
      },
      {
        "id": 2,
        "text": "Prevents the Anterior Chamber from collapsing during crucial steps like capsulorhexis and IOL placement"
      },
      {
        "id": 3,
        "text": "It is inert and can be left behind after surgery"
      },
      {
        "id": 4,
        "text": "Silicone oil, perfluoropropane, and SF6 are the most commonly used substances"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Viscoelastic substances</strong> prevent the <strong>anterior chamber</strong> from collapsing during crucial steps like <strong>capsulorhexis</strong> and IOL (Intra-ocular lens) placement.</p>\n<p>Viscoelastic substances are commonly used in ocular surgery, particularly in cataract surgery, to maintain the anterior chamber (AC), protect the corneal endothelium, and facilitate surgical procedures. They prevent the collapse of the AC during crucial steps such as capsulorrhexis and IOL (intraocular lens) placement by providing a cushioning effect.</p>\n<p>Other options</p>\n<p>Option A: \u00a0Viscoelastic substances are typically used to <strong>protect</strong> the <strong>corneal endothelium</strong>, not to cause any mechanical injury.</p>\n<p>Option C: \u00a0While some viscoelastics are <strong>inert</strong>, not all can be safely left behind. Some types of viscoelastic substances (especially those that are not fully biodegradable) should be <strong>removed</strong> from the eye <strong>after surgery</strong> to prevent complications.</p>\n<p>Option D: <strong>Sodium hyaluronate</strong> and <strong>hydroxypropyl methylcellulose</strong> are the <strong>most commonly</strong> used viscoelastic substances, compared to <strong>silicone oil, perfluoropropane, and SF6</strong>.\u00a0 Silicone oil, perfluoropropane, and SF6 are the substances used for <strong>vitreoretinal</strong> <strong>surgery</strong> (such as tamponade agents for retinal detachment), not for routine cataract surgery. Viscoelastic used in <strong>cataract</strong> <strong>surgery</strong> are typically substances like sodium hyaluronate and hydroxypropyl methylcellulose.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In pterygium, there is",
    "choices": [
      {
        "id": 1,
        "text": "Eye pain"
      },
      {
        "id": 2,
        "text": "Macular edema"
      },
      {
        "id": 3,
        "text": "Purulent discharge"
      },
      {
        "id": 4,
        "text": "Astigmatism"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In pterygium, there is <strong>astigmatism</strong>. It causes astigmatism by flattening the cornea along the axis of the pterygium.</p>\n<p><strong>Pterygium</strong> is a <strong>subconjunctival fibrovascular tissue</strong> encroaching on the cornea. It is a <strong>degenerative</strong> condition of the sub-conjunctival tissue and is never inflammatory. It occurs due to exposure to UV-B radiation and the most common site is the nasal.</p>\n<p>It is made up of three parts - a \"cap\" (an avascular halo-like zone at the advancing edge), a head, and a body.</p>\n<p>Clinical features:</p>\n<ul>\n<li><strong>Astigmatism with the rule</strong> - most common finding</li>\n<li><strong>Stocker's line</strong> - deposition of iron on the advancing edge</li>\n<li><strong>Fuchs islets</strong> - small, discrete, whitish flecks consisting of clusters of pterygial epithelial cells, often present at the advancing edge</li>\n</ul>\n<p>The image below shows a pterygium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4497a1d7c0fb48448db4811f1106b79cx360x272.JPEG"
    ]
  },
  {
    "text": "A 6-month-old baby, born preterm at 33 weeks of gestation, is brought by parents with complaints of white pupillary reflex since 2 weeks. CT revealed calcification of the globe in both eyes. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "ROP"
      },
      {
        "id": 2,
        "text": "Retinoblastoma"
      },
      {
        "id": 3,
        "text": "Congenital Glaucoma"
      },
      {
        "id": 4,
        "text": "Congenital Cataract"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options</p>\n<p>Option A: <strong>ROP</strong> (Retinopathy of Prematurity) is a concern in preterm infants (especially those born before 32 weeks), and it can also present with <strong>white pupillary reflex</strong>, it does not show calcification of the globe on a CT scan. ROP can lead to retinal detachment or fibrosis, but calcification is not a typical feature.</p>\n<p>Option C: <strong>Congenital glaucoma</strong> may present with symptoms such as enlarged corneas, increased intraocular pressure, and a shallow anterior chamber. White pupillary reflex or calcification on CT are not typical presentations of congenital glaucoma.</p>\n<p>Option D: <strong>Congenital cataracts</strong> can present with <strong>leukocoria</strong> (white pupillary reflex) but would not show calcification on a CT scan. They are more likely to be detected by a clinical examination and would typically not result in calcifications.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7a0f6226099a42b1b7494bbd8c5483d4x276x229.JPEG"
    ]
  },
  {
    "text": "Which of the following is a cause of bilateral sudden painless loss of vision?",
    "choices": [
      {
        "id": 1,
        "text": "Acute congestive glaucoma"
      },
      {
        "id": 2,
        "text": "Diabetic retinopathy"
      },
      {
        "id": 3,
        "text": "Keratoconus"
      },
      {
        "id": 4,
        "text": "Iridocyclitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Diabetic retinopathy</strong> is a cause of <strong>bilateral sudden painless loss of vision</strong> due to vascular complications.</p>\n<p>Bilateral sudden painless loss of vision is a hallmark of advanced diabetic retinopathy, particularly when associated with complications such as:</p>\n<p>\u00a0\u2022 Vitreous haemorrhage: Leakage of blood into the vitreous cavity due to rupture of fragile neovascular vessels.</p>\n<p>\u00a0\u2022 Tractional retinal detachment: Occurs when fibrovascular tissue pulls the retina away from its underlying structures.</p>\n<p>\u00a0\u2022 Macular oedema: Severe swelling in the macula can lead to central vision loss.</p>\n<p>These conditions can cause sudden and significant visual impairment, often affecting both eyes in patients with long-standing, poorly controlled diabetes.</p>\n<p><br />Other options</p>\n<p>Option A: <strong>Acute congestive glaucoma</strong>: Typically causes <strong>sudden</strong> vision loss, but it is <strong>painful</strong> and <strong>unilateral</strong> in most cases.</p>\n<p>Option C: <strong>Keratoconus</strong>\u00a0is a progressive condition that leads to <strong>gradual</strong> vision loss due to corneal thinning and irregular astigmatism, not sudden or bilateral loss.</p>\n<p>Option D: <strong>Iridocyclitis</strong>\u00a0is associated with <strong>pain</strong>, redness, and photophobia, and it is usually <strong>unilateral</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In FFA, the microaneurysms appear as:",
    "choices": [
      {
        "id": 1,
        "text": "Hypofluorescent dots"
      },
      {
        "id": 2,
        "text": "Hyperfluorescent dots"
      },
      {
        "id": 3,
        "text": "Hypofluorescent lines"
      },
      {
        "id": 4,
        "text": "Hyperfluorescent branching-like structures in the vessel"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><br />Other options:</p>\n<p>Option A: <strong>Hypofluorescent dots</strong> indicate blocked fluorescence, often due to <strong>hemorrhage</strong> or <strong>ischemia</strong>.</p>\n<p>Option C: <strong>Hypofluorescent line </strong>might occur in cases of <strong>vascular occlusion</strong>.</p>\n<p>Option D: <strong>Hyperfluorescent branching-like structure</strong> in the vessel suggests <strong>leakage</strong> from <strong>neovascularization</strong> or vascular abnormalities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ef97384d69a04dc8a6f55240bd708035x1280x590.PNG"
    ]
  },
  {
    "text": "Normal diameter of artery to vein at the optic disc margin",
    "choices": [
      {
        "id": 1,
        "text": "1:3"
      },
      {
        "id": 2,
        "text": "2:3"
      },
      {
        "id": 3,
        "text": "2:5"
      },
      {
        "id": 4,
        "text": "1:5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>normal diameter</strong> ratio of the central retinal <strong>artery</strong> to the central retinal <strong>vein</strong> at the optic disc margin is <strong>2:3</strong>.</p>\n<p>The ratio <strong>2:3</strong> means that the artery\u2019s diameter is approximately two-thirds of the vein\u2019s diameter. This is considered the physiological normal. The ratio is assessed during the fundoscopic examination, and significant deviations can indicate pathological conditions:</p>\n<ul>\n<li><strong>Decreased ratio </strong>(arteriolar narrowing) may suggest hypertension or arteriosclerosis.</li>\n<li><strong>Increased ratio</strong> (relative venous narrowing) is less common but may occur in rare conditions.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the case of Best disease, which of the following is the diagnostic investigation?",
    "choices": [
      {
        "id": 1,
        "text": "EOG"
      },
      {
        "id": 2,
        "text": "ERG"
      },
      {
        "id": 3,
        "text": "Multifocal ERG"
      },
      {
        "id": 4,
        "text": "Visual evoked potential"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options</p>\n<p>Option B: <strong>ERG</strong> (electroretinogram) assesses retinal activity and is mainly used in diagnosing pigmentary retinal dystrophy, complete occlusion of the retinal artery, early glaucomatous damage, macular degeneration in cataract, complete old retinal detachment or advanced siderosis.</p>\n<p>Option C: <strong>Multifocal ERG</strong> assesses retinal activity and mainly provides a detailed evaluation of the central retina as in Stargardt disease or chloroquine toxicity.</p>\n<p>Option D: <strong>Visual evoked potential</strong> (VEP) is used to evaluate the visual pathway\u2019s function</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f39f7fe60574372862d4f6423a0fb18x399x327.PNG"
    ]
  },
  {
    "text": "A factory worker presented with a chemical injury in both his eyes a few hours back. What is the first immediate management?",
    "choices": [
      {
        "id": 1,
        "text": "Copious irrigation of eyes"
      },
      {
        "id": 2,
        "text": "Take history"
      },
      {
        "id": 3,
        "text": "Check vision in both eyes"
      },
      {
        "id": 4,
        "text": "Check IOP and plan for surgery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Copious irrigation of the eyes</strong> is the first <strong>immediate</strong> management in this case.</p>\n<p>The initial step in the management of a patient presenting with chemical burns is immediate and <strong>thorough irrigation</strong> with the available clean water or normal <strong>saline</strong> delivered through an IV tubing. This is done to <strong>prevent further damage.\u00a0</strong></p>\n<p>Along with irrigation, <strong>contaminant elimination t</strong>hrough <strong>mechanical</strong> means shall be done. In the event of residue, especially with lime (chuna), it is essential to meticulously eliminate them using a swab stick.</p>\n<p>After the initial steps, maintenance of favourable conditions for rapid and uncomplicated healing by following measures:</p>\n<ul>\n<li>Topical <strong>antibiotic drops</strong>, for example, moxifloxacin 4-6 times a day to prevent infection.</li>\n<li><strong>Steroid eye drops</strong> to decrease inflammation, and neutrophil infiltration, and treat anterior uveitis. Caution is advised after 2 weeks, as steroids could disrupt collagen synthesis.</li>\n<li><strong>Cycloplegics</strong>, such as atropine, might enhance comfort.</li>\n</ul>\n<p>Grading of severity (Roper\u2013Hall system) of chemical injuries is based on corneal clarity and severity of limbal ischemia:</p>\n<ul>\n<li><strong>Grade 1 \u00a0i</strong>s characterized by a <strong>clear cornea</strong> (epithelial damage only) and <strong>no limbal ischemia </strong>(excellent prognosis).</li>\n<li><strong>Grade 2</strong> shows a<strong> hazy cornea</strong> but with visible iris detail and <strong>less than one-third</strong> of the limbus being ischemic (good prognosis).</li>\n<li><strong>Grade 3 </strong>manifests as a <strong>total loss of the corneal epithelium</strong>, stromal haze obscuring iris detail, and <strong>between one-third and half </strong>of the limbus showing ischemia (guarded prognosis).</li>\n<li><strong>Grade 4</strong> manifests with an <strong>opaque cornea</strong> and<strong> more than 50% </strong>of the limbus showing ischemia (poor prognosis).<br />\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following layers of the retina are correctly labeled?",
    "choices": [
      {
        "id": 1,
        "text": "1- Retinal pigment epithelium; 2- Outer nuclear layer; 3- Inner plexiform layer; 4-Ganglion layer"
      },
      {
        "id": 2,
        "text": "1- Retinal pigment epithelium; 2-Inner nuclear layer; 3- Outer plexiform layer; 4- Ganglion layer"
      },
      {
        "id": 3,
        "text": "1- Ganglion layer; 2- Inner nuclear layer; 3- Outer plexiform layer; 4- Retinal pigment epithelium"
      },
      {
        "id": 4,
        "text": "1- Ganglion layer; 2- Outer plexiform layer; 3- Inner nuclear layer; 4- Retinal pigment epithelium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The layers of the retina marked above are:</p>\n<ul>\n<li>1- Retinal pigment epithelium</li>\n<li>2- Outer nuclear layer</li>\n<li>3- Inner plexiform layer</li>\n<li>4-Ganglion layer</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7565c7af844c4c55b4983ee02963a5fe.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '134 Ophthalmology Ini-Cet 2024';
        let hierarchy = ["Marrow", "PYQs", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>