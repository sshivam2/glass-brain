<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Pediatric Bacterial And Parasitic Infections - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not commonly caused by Staphylococcus aureus?",
    "choices": [
      {
        "id": 1,
        "text": "Bullous impetigo"
      },
      {
        "id": 2,
        "text": "Folliculitis"
      },
      {
        "id": 3,
        "text": "Acute pharyngitis"
      },
      {
        "id": 4,
        "text": "Pyomyositis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Acute pharyngitis</strong> or sore throat is most commonly caused by <strong>g</strong><strong>roup A <em>Streptococcus</em> (GAS)</strong> - not staphylococcus.</p>\n<p><em>Staphylococcus aureus</em> causes <strong>localized infections</strong> like furuncle, carbuncle, bullous impetigo, pyomyositis, and folliculitis (skin and soft tissue infections). It may cause bloodstream infections if there is a breach in the skin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a874609dec9c459aa862fc181cea9488.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Anu, a pre-school student presented with a fever and sore throat. She also had an acute onset generalized erythematous rash with pastia lines over the antecubital fossa. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ritter's disease"
      },
      {
        "id": 2,
        "text": "Scarlet fever"
      },
      {
        "id": 3,
        "text": "Kawasaki disease"
      },
      {
        "id": 4,
        "text": "Urticaria pigmentosa"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>scarlet fever.</strong></p>\n<p>Scarlet fever is a delayed type of skin reaction to streptococcal exotoxin and occurs as a <strong>complication of streptococcal tonsillopharyngitis</strong>. There is a diffuse erythematous maculopapular rash<strong>,&nbsp;</strong>which blanches on pressure.&nbsp;This gives a sandpaper quality to the skin.</p>\n<p>A characteristic physical finding in which red or pink petechial lines appear in skin creases is called&nbsp;Pastia's sign, Pastia lines, or Thompson's sign.</p>\n<p>The image below shows&nbsp;Pastia lines in the antecubital fossa.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe5a424c93844d5fb62123b3b7ca0541x416x872.JPEG"
    ]
  },
  {
    "text": "A young boy is brought to the OPD with a sore throat and a rash, which appears as shown in the image, for the past 2 days. The rash started around the neck and then spread to the trunk and extremities. On examination, rash blanches on pressure. Tongue examination shows swollen papillae. Which of the following toxins is responsible for this child's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pyrogenic exotoxin"
      },
      {
        "id": 2,
        "text": "Exfoliotoxin"
      },
      {
        "id": 3,
        "text": "Enterotoxin"
      },
      {
        "id": 4,
        "text": "Panton-Valentine leukocidin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>scarlet fever,</strong> which is caused by a&nbsp;<strong>pyrogenic exotoxin</strong> produced by Group A <em>streptococcus</em> (GAS).</p>\n<p>In scarlet fever, the rash appears within 24&ndash;48 hours of the onset of upper respiratory infections. It begins around the head and neck and spreads over the trunk and extremities. It usually spares palms, and soles. It is a diffuse, <strong>papular</strong>, and erythematous eruption, which <strong>blanches on pressure.&nbsp;</strong>The cheeks are erythematous, with pallor around the mouth. The tongue is usually coated, and the <strong>papillae are swollen,</strong> giving the tongue a <strong>strawberry appearance.</strong></p>\n<p>The image below shows a strawberry tongue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/483340bf95cb4cb8bfaadeb081085a3b.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/674c304abfdc49bcbb8ab5befb9ab76bx400x490.JPEG"
    ]
  },
  {
    "text": "A 7-year-old child abruptly developed symptoms suggestive of obsessive-compulsive disorder and Tourette syndrome. PANDAS, a pediatric neuropsychiatric disorder, is suspected. Which of the following organisms is associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Streptococcus pneumoniae"
      },
      {
        "id": 3,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 4,
        "text": "Staphylococcus epidermidis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>PANDAS is associated with <strong><em>Streptococcus pyogenes</em> </strong>infection.</p>\n<p><strong>PANDAS&nbsp;</strong>stands for<strong>&nbsp;</strong>Pediatric Autoimmune Neuropsychiatric Disorders Associated with Streptococcal infections.</p>\n<p>The symptoms usually&nbsp;occur&nbsp;<strong>abruptly</strong> and can include the following:</p>\n<ul>\n<li><strong>Obsessive-compulsive disorder (OCD)</strong></li>\n<li>Tic disorder</li>\n<li>Gilles de la Tourette syndrome (coprolalia and tics)</li>\n</ul>\n<p>Additionally, children may become moody or irritable, experience anxiety attacks, and/or show separation anxiety.&nbsp;These symptoms are the result of an <strong>autoimmune process</strong> that leads to inflammation of the basal ganglia and the resultant disruption of&nbsp;<strong>cortical-striatal-</strong><strong>thalamic axis</strong> functioning.</p>\n<p>Features:</p>\n<ul>\n<li><strong>P</strong>repubertal onset</li>\n<li><strong>A</strong>brupt and episodic course</li>\n<li><strong>N</strong>eurological symptoms</li>\n<li><strong>D</strong>isorders associated: Tics, OCD</li>\n<li><strong>A</strong>ssociated with a recent history of sore throat</li>\n</ul>\n<p><strong>Note:</strong>&nbsp;Non-infectious manifestations of streptococcal infection:</p>\n<ul>\n<li>Rheumatic heart disease</li>\n<li>Glomerulonephritis</li>\n<li>PANDAS</li>\n<li>Guttate psoriasis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a major criterion in the revised Jones criteria used for the diagnosis of acute rheumatic fever in high-risk populations?",
    "choices": [
      {
        "id": 1,
        "text": "Polyarthralgia"
      },
      {
        "id": 2,
        "text": "Fever (\u226538\u00b0C/100.4\u00b0F)"
      },
      {
        "id": 3,
        "text": "ESR \u226530 mm"
      },
      {
        "id": 4,
        "text": "CRP \u22653.0 mg/dl"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Polyarthralgia</strong> is a <strong>major&nbsp;criterion </strong>in the <strong>revised Jones criteria</strong> used for the diagnosis of acute rheumatic fever in <strong>high-risk populations </strong>(ARF incidence &gt;2 per 100&thinsp;000 school-aged children or all-age rheumatic heart disease prevalence of &gt;1 per 1000 population per year).</p>\n<p>Strict adherence to the Jones criteria in areas of higher prevalence may result in under-diagnosis. Therefore, the criteria are slightly modified for <strong>moderate to high-risk populations</strong> as follows:</p>\n<ul>\n<li class=\"bulletIndent1\">The major criterion of arthritis includes <strong>polyarthralgia</strong> or monoarthritis in addition to polyarthritis. Polyarthralgia should only be considered as a major manifestation after the exclusion of other causes.</li>\n<li class=\"bulletIndent1\">The minor criterion for joint involvement is monoarthralgia.</li>\n<li class=\"bulletIndent1\">A lower cutoff for fever is used (&ge;38&deg;C [100.4&deg;F] rather than &ge;38.5&deg;C [101.3&deg;F]).</li>\n<li class=\"bulletIndent1\">A lower cutoff for erythrocyte sedimentation rate (ESR) is used (&ge;30&nbsp;<span class=\"nowrap\">mm/hour</span>&nbsp;rather than &ge;60&nbsp;<span class=\"nowrap\">mm/hour),</span>&nbsp;although the C-reactive protein (CRP) cutoff is unchanged (&ge;3&nbsp;<span class=\"nowrap\">mg/dL)</span>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old girl presents with a 2-day history of fever and joint pain. Further questioning reveals that she had a sore throat 3 weeks back for which she did not seek medical help. Acute rheumatic fever is suspected. Which of the following is not a component of the criteria used for the diagnosis of this child's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Prolonged PR interval"
      },
      {
        "id": 2,
        "text": "Erythema nodosum"
      },
      {
        "id": 3,
        "text": "Subcutaneous nodules"
      },
      {
        "id": 4,
        "text": "CRP \u22653.0 mg/dL"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Erythema nodosum is not a component of <strong>Jones criteria&nbsp;</strong>which is&nbsp;used for acute rheumatic fever (ARF) diagnosis. <strong>E</strong><strong>rythema marginatum</strong> is a major manifestation of the Jones criteria. It&nbsp;is an&nbsp;<span data-dobid=\"hdw\">evanescent</span>, non-pruritic rash over the trunk and extremities seen in <strong>rheumatic fever.</strong></p>\n<p>The image below shows erythema marginatum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3e963c8df9d44f03b5104df39c968973x1280x960.0.JPEG"
    ]
  },
  {
    "text": "Which of the following constitutes Hutchinson's triad?",
    "choices": [
      {
        "id": 1,
        "text": "Interstitial keratitis, 8th nerve deafness, mulberry molars"
      },
      {
        "id": 2,
        "text": "Interstitial keratitis, 8th nerve deafness, Hutchinson molars"
      },
      {
        "id": 3,
        "text": "Interstitial keratitis, 8th nerve deafness, mulberry incisors"
      },
      {
        "id": 4,
        "text": "Interstitial keratitis, 8th nerve deafness, Hutchinson incisors"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Congenital syphilis</strong>&nbsp;is due to&nbsp;<em>Treponema pallidum</em>. Early features include <strong>hepato-splenomegaly</strong>, jaundice, <strong>diffuse lymphadenopathy,</strong> maculopapular or vesiculobullous<strong> rash involving hands and feet,</strong> persistent rhinitis (<strong>snuffles</strong>), and <strong>condylomatous</strong> lesions. Skeletal changes like<strong> saber shins</strong>, dental abnormalities like Hutchinson's teeth, and <strong>saddle nose</strong> (depression of the nasal root) are some <strong>late</strong> findings.</p>\n<p>Other clinical features of congenital syphilis:</p>\n<ul>\n<li><strong>Clutton joint -</strong>&nbsp;Due to synovitis, with sterile synovial fluid</li>\n<li>Juvenile tabes and paresis</li>\n<li><strong>Rhagades -</strong>&nbsp;Linear scars radiating from mucocutaneous fissures of the mouth, anus, and genitalia</li>\n<li><strong>Mulberry molars&nbsp;</strong>-<strong>&nbsp;</strong>Abnormal 1<sup>st</sup>&nbsp;lower molars with excessive cusps</li>\n<li><strong>Sabre shin -</strong>&nbsp;Anterior bowing of the mid-portion of the tibia</li>\n<li><strong>Olympian brow -</strong>&nbsp;Bony prominence of the forehead</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f058712804f41c489c8b56d387bb69dx640x488.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77e0869cb2b14e8b8193c697477a48c3x800x1200.JPEG"
    ]
  },
  {
    "text": "A 1-year-old baby is brought to the paediatrician by his mother because of jaundice.  On examination, the baby has hepatosplenomegaly and lymphadenopathy. He has a saddle nose and persistent rhinitis as seen in the picture. The baby had been 2300g at birth. The delivery was complicated by preterm labour and a single, painless ulcer with a clean base on the mother's labia. Which of the following feature will not be seen in this baby?",
    "choices": [
      {
        "id": 1,
        "text": "Coombs positive hemolytic anemia"
      },
      {
        "id": 2,
        "text": "Condylomata lata"
      },
      {
        "id": 3,
        "text": "Painless synovitis"
      },
      {
        "id": 4,
        "text": "Interstitial keratitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>congenital syphilis</strong>. <strong>Coombs-negative hemolytic anemia</strong> is a characteristic feature of congenital syphilis, not coombs-positive hemolytic anemia.</p>\n<p>Congenital syphilis results from transplacental transmission of <em>Treponema pallidum</em> or during birth by contact with infectious lesions of the mother.<br /> <br /><strong>Clinical features of congenital syphilis:</strong></p>\n<ul>\n<li><strong>Hutchinson's triad -</strong>&nbsp;Hutchinson teeth, interstitial keratitis, sensorineural deafness</li>\n<li><strong>Clutton joint -</strong>&nbsp;Due to synovitis, with sterile synovial fluid</li>\n<li>Juvenile tabes and paresis</li>\n<li><strong>Rhagades -</strong>&nbsp;Linear scars radiating from mucocutaneous fissures of the mouth, anus, and genitalia</li>\n<li><strong>Saddle nose -</strong>&nbsp;Depression of nasal bridge</li>\n<li><strong>Mulberry molars&nbsp;</strong>-<strong>&nbsp;</strong>Abnormal 1<sup>st</sup> lower molars with excessive cusps</li>\n<li><strong>Sabre shin -</strong>&nbsp;Anterior bowing of the mid-portion of the tibia</li>\n<li><strong>Olympian brow -</strong>&nbsp;Bony prominence of the forehead</li>\n<li><strong>Snuffles -</strong>&nbsp;Persistent rhinitis&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/386033ef80a9446eb18daaf305184100.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A neonate was delivered via normal vaginal delivery. His mother was diagnosed with active tuberculosis infection during pregnancy but she refused treatment in fear of side effects to the baby. If the baby had been infected prenatally, which of the following organs is most likely to be involved?",
    "choices": [
      {
        "id": 1,
        "text": "Lung"
      },
      {
        "id": 2,
        "text": "Liver"
      },
      {
        "id": 3,
        "text": "Abdomen"
      },
      {
        "id": 4,
        "text": "Kidney"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>liver</strong> is the most commonly involved organ in <strong>congenital tuberculosis</strong>.</p>\n<p>Primary infection in a female just before or during pregnancy is more likely to cause congenital tuberculosis.&nbsp;Congenital transmission usually occurs from a lesion in the placenta through the umbilical vein. The tuberculous bacilli may pass through the umbilical vein and develop a&nbsp;<strong>hepatic focus</strong>. Tuberculosis in neonates generally presents with respiratory distress<strong>, hepatosplenomegaly,&nbsp;</strong>and <strong>lymphadenopathy</strong>.</p>\n<p><strong>Note:</strong></p>\n<p>The most common route of infection for a <strong>neonate</strong> is the <strong>postnatal airborne transmission</strong> from an adult with infectious pulmonary tuberculosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old boy presented with a persistent cough. There was a contact history with an active tuberculosis case in his neighborhood. His X-ray revealed prominent hilar lymphadenopathy as shown in the image. Which of the following statements is false regarding this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Puhl's lesion at the apex of lung is seen in primary infection"
      },
      {
        "id": 2,
        "text": "Most cases of pediatric TB are asymptomatic"
      },
      {
        "id": 3,
        "text": "Sputum smear-negative TB does not rule out pediatric pulmonary TB"
      },
      {
        "id": 4,
        "text": "The most common site of extrapulmonary TB is the lymph node"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient had exposure to an active tuberculosis case and has hilar lymphadenopathy (image), suggestive of <strong>primary tuberculosis.</strong>&nbsp;<strong>Puhl&rsquo;s lesion</strong> is <strong>chronic tuberculosis</strong> (TB) of the apex of the lung, not seen in the primary infection.</p>\n<p>The majority of children develop no signs or symptoms at any level.</p>\n<p>In <strong>primary</strong> pulmonary disease, the combination of the parenchymal pulmonary lesion and the corresponding lymph node is called <strong>Ghon&rsquo;s complex </strong>or the primary complex.<strong>&nbsp;</strong>Asymptomatic pleural effusion is common and forms part of the primary complex. Erosion of a parenchymal focus of tuberculosis into the blood or lymphatic vessel can result in dissemination of the bacilli and a <strong>miliary pattern,</strong> with small nodules evenly distributed on the chest radiograph.&nbsp;Sputum smear-negative TB does not rule out pediatric pulmonary TB.</p>\n<p><strong>Chronic</strong> pulmonary tuberculosis&nbsp;is common in children above 7 years of age. The commonest site is the apex of the lung&mdash;<strong>Puhl&rsquo;s lesion</strong>. Regional lymph nodes are not involved.</p>\n<p>The most common site of extrapulmonary tuberculosis in children is the <strong>lymph node.</strong></p>\n<p><strong>NOTE:</strong></p>\n<ul>\n<li><strong>Ranke complex:</strong>&nbsp;Ghon's complex undergoes fibrosis and calcification.</li>\n<li><strong>Simon focus:</strong>&nbsp;Hematogenous spread to the apex of the upper lobe, resulting in a post-primary infective lesion, which heals with scarring.</li>\n<li><strong>Simmond's focus:</strong>&nbsp;Tuberculous focus in the liver.</li>\n<li><strong>Weigert focus:</strong>&nbsp;Caseating metastatic tuberculous focus in the wall of a pulmonary vein.</li>\n<li><strong>Rich focus:</strong>&nbsp;Tuberculous granuloma occurring in the cortex of the brain.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c2047869d24439b944df7fa123875f2.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman with smear-positive tuberculosis is on anti-tubercular therapy (ATT). She delivered a healthy male baby at term. How is the newborn managed in this case?",
    "choices": [
      {
        "id": 1,
        "text": "BCG + Rifampicin + INH + Breastfeeding"
      },
      {
        "id": 2,
        "text": "Breastfeeding + INH for 2 months then BCG vaccine"
      },
      {
        "id": 3,
        "text": "Breastfeeding + INH for 6 months then BCG vaccine"
      },
      {
        "id": 4,
        "text": "BCG + INH for 6 months + withhold Breastfeeding"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In a neonate born to a mother with smear-positive tuberculosis, <strong>breastfeeding</strong> along with <strong>INH prophylaxis for 3-6 months</strong> is recommended.&nbsp;<strong>BCG vaccine</strong> is recommended at birth or after completion of prophylaxis (3-6 months) in all neonates.</p>\n<p>When a child is born to a mother with active TB, the main aim is the&nbsp;<strong>TB-free survival of the newborn</strong>. It involves detecting active TB lesions (congenital TB) and treating them or prevention of transmission of tubercular infection to the neonate from the mother.</p>\n<p><strong>Prophylaxis</strong> with <strong>isoniazid (3-6 months)</strong> is recommended in neonates born to mothers with TB who are infectious (smear-positive). <strong>Breastfeeding</strong> should be continued in these neonates and isolation is recommended only till the mother is infectious, has multidrug-resistant tuberculosis, or nonadherent to treatment. <strong>BCG vaccine</strong> is recommended at birth or after completion of prophylaxis (3-6 months) in all neonates.&nbsp;However,<strong> if </strong>the <strong>Mantoux test </strong>is <strong>positive</strong> and evidence of disease is found, <strong>ATT</strong> is started.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old lady is detected to have active tuberculosis at 37 weeks of gestation. She delivers a baby girl 2 days later. As per NTEP guidelines, what advice is given immediately after delivery?",
    "choices": [
      {
        "id": 1,
        "text": "INH prophylaxis to be given to the neonate for 6 weeks"
      },
      {
        "id": 2,
        "text": "Mother is to be started on ATT"
      },
      {
        "id": 3,
        "text": "Withhold breast feeding"
      },
      {
        "id": 4,
        "text": "Withold BCG vaccination"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The mother with TB is advised to <strong>start ATT</strong>\u00a0immediately irrespective of time of delivery.</p>\n<p>The management guidelines followed in a case of active TB in a mother immediately following delivery include:</p>\n<ol>\n<li>Mother has to be started on ATT.</li>\n<li>Do not separate the baby from the mother.</li>\n<li>Do not withhold\u00a0breastfeeding.</li>\n<li>Screening of household contacts.</li>\n<li>Screen the neonate for congenital/active TB.</li>\n</ol>\n<p>In accordance with the\u00a0<strong>NTEP</strong>\u00a0<strong>2020</strong> guidelines, a newborn whose mother has active TB and is on ATT should be managed with <strong>prophylactic\u00a0isoniazid</strong> (INH) for <strong>6 months, BCG</strong> vaccination <strong>at birth</strong>, with the\u00a0<strong>continuation of breastfeeding,\u00a0</strong>after ruling out active TB.\u00a0</p>\n<p>INH prophylaxis\u00a0is given irrespective of the BCG or nutritional status. 10 mg/kg\u00a0is administered daily for a minimum of six months. During monthly tablet collection, the <strong>child</strong> should be closely monitored for TB symptoms to <strong>rule out active TB</strong> and also <strong>assess</strong> for any <strong>INH-related adverse effects</strong>.</p>\n<p>BCG vaccination can be given at birth even if INH preventive therapy is planned.</p>\n<p>In case the <strong>newborn</strong> is found to have <strong>active TB</strong>, <strong>ATT</strong> is to be initiated along with the administration of <strong>BCG vaccine</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A worried couple brought their 4-day-old baby to the pediatrician due to difficulty in feeding and abnormal posture. The baby was delivered at home and the mother never had a prenatal checkup. On examination, the baby's body was rigid, with flexed upper limb and extended back. The umbilical cord was covered with cow dung. The mother says it's their tradition, and that the dirt helps with the falling off of the cord. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "The toxin responsible affects the excitatory neurons"
      },
      {
        "id": 2,
        "text": "Metronidazole is given as a treatment"
      },
      {
        "id": 3,
        "text": "It occurs in infants of unimmunized mothers"
      },
      {
        "id": 4,
        "text": "Case fatality rate is 70-100%"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of <strong>neonatal tetanus.</strong> It is caused by a neurotoxin produced by <strong>Clostridium tetani</strong>, which <strong>inhibits inhibitory neurons</strong>, not excitatory neurons.</p>\n<p class=\"p1\">Clostridium tetani is a spore-forming obligate anaerobe commonly found in soil, dust, and gastrointestinal tracts of various animals. The baby's umbilical stump covered with cow dung serves as the source of infection. It also occurs in <strong>infants of unimmunized mothers.&nbsp;</strong>Tetanus typically manifests within 3-12 days of birth as progressive <strong>difficulty in feeding, rigidity,</strong> or<strong> spasms</strong>.</p>\n<p>Tetanus toxin binds at the neuromuscular junction and enters the motor nerve; it is then transported to the alpha-motoneuron via <strong>retrograde axonal transport</strong>. Subsequently, the toxin enters the adjacent <strong>spinal inhibitory interneurons</strong>, where it prevents the release of the neurotransmitters <strong>glycine and <span class=\"s1\">&gamma;</span>-aminobutyric acid</strong>. This leads to&nbsp;<strong>blockade of normal antagonistic muscle inhibition, </strong>while agonist muscles undergo sustained contraction without relaxing<strong>.</strong></p>\n<p>Neonatal tetanus presents with progressive <strong>feeding difficulty&nbsp;</strong>(sucking and swallowing), irritability, and crying. Characteristic features include reduced movement or complete muscle paralysis, rigidity, and <strong>spasms. </strong>These features may or may not be associated with&nbsp;<strong>opisthotonos</strong>.</p>\n<p><strong>Treatment&nbsp;</strong>includes supportive care in the form of muscle relaxants (<strong>diazepam</strong>), along with the administration of&nbsp;<strong>human tetanus immunoglobulin (TIG)</strong>&nbsp;and <strong>metronidazole,</strong>&nbsp;which&nbsp;is the antibiotic of choice. Parenteral penicillin G can serve as an alternate antibiotic.</p>\n<p>Excising the umbilical stump in a baby with neonatal tetanus is no longer recommended.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old unvaccinated child presents with complaints of sore throat and difficulty in swallowing. The patient also has fever and hoarseness of voice and her facial appearance is as shown below. A provisional diagnosis of Diptheria is made. Which of the following statements is true regarding this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "It can be diagnosed by the demonstration of antibody by ELISA"
      },
      {
        "id": 2,
        "text": "Immunization prevents the carrier state"
      },
      {
        "id": 3,
        "text": "Treatment of contacts is not indicated"
      },
      {
        "id": 4,
        "text": "Iron has a critical value in the production of toxins"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>&nbsp;</p>\n<ul>\n<li><strong>Cutaneous diphtheria&nbsp;</strong>is an indolent, non-progressive infection characterized by a superficial, ecthyma-like, non-healing ulcer with a gray-brown membrane.</li>\n<li>Occasionally, it causes mucocutaneous infections at other sites, such as otitis externa, purulent conjunctivitis, and vulvo-vaginitis.</li>\n</ul>\n<p>Diagnosis: The culture of the organism from the nose and throat swab specimens is the gold standard. Demonstration of the toxin is done by <strong>Elek's gel precipitation test</strong>. Gram stain and fluorescent antibody tests are unreliable.</p>\n<p>Complications<strong>&nbsp;</strong>include obstruction due to pseudomembrane, myocarditis, and polyneuropathy.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/78763fa07969428a8a5d02910bfb8cd8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3ea1b23645b442d95988da391e77efdx720x633.JPEG"
    ]
  },
  {
    "text": "A diphtheria screening camp is being held at a rural school to find carriers and to provide them adequate treatment. What is the investigation of choice in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Throat swab culture"
      },
      {
        "id": 2,
        "text": "Gram\u2019s stain"
      },
      {
        "id": 3,
        "text": "Albert\u2019s stain"
      },
      {
        "id": 4,
        "text": "Fluorescent antibody"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The investigation of choice for diphtheria <strong>carriers</strong> is <strong>throat swab culture.</strong></p>\n<p>Specimens for culture should be obtained from the <strong>nose</strong> and <strong>throat</strong> and any other mucocutaneous lesion. A portion of the membrane should be removed and sent for culture along with the underlying exudate in those with overt disease. Direct smear using Gram stain or specific fluorescent antibody is unreliable.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Anuj has been\u200b diagnosed with diphtheria and is being treated in the ward. His 3-year-old brother, Ajay who lives in the same house has received vaccination against diphtheria about 16 months back. What is the next best step for the management of the younger sibling, Ajay?",
    "choices": [
      {
        "id": 1,
        "text": "One booster dose"
      },
      {
        "id": 2,
        "text": "Nothing as the child is already exposed"
      },
      {
        "id": 3,
        "text": "Erythromycin + diphtheria toxoid"
      },
      {
        "id": 4,
        "text": "Erythromycin only"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In the given clinical scenario, a <strong>3-year-old child</strong>\u00a0is likely to have received the <strong>4th dose (1st booster)</strong> of the diphtheria vaccine between 16\u201324 months of age according to National Immunization Schedule (i.e., 16 months ago). Since he has received a <strong>booster dose within 5 years</strong>, only\u00a0<strong>erythromycin</strong> is indicated in case of <strong>close contact</strong> with the<strong> diphtheria patient</strong>.\u00a0</p>\n<p>All <strong>household contacts</strong> with diphtheria patients should be closely <strong>monitored</strong> for <strong>7 days</strong>. <strong>Culture</strong> should be taken from both the throat and nose. <strong>All</strong> <strong>contacts</strong> should receive <strong>antibiotic prophylaxis</strong> (<strong>benzathine penicillin G</strong> or <strong>erythromycin</strong>),\u00a0<strong>regardless of immunization status</strong>.\u00a0</p>\n<p>Children who have <strong>not received</strong> a <strong>booster dose</strong> of the diphtheria toxoid vaccine <strong>within 5 years</strong> should be given the vaccine in an age-appropriate form.\u00a0Children who have <strong>not yet received</strong> their <strong>4th dose</strong> should be vaccinated accordingly.\u00a0</p>\n<p>If <strong>fewer than three doses</strong> of diphtheria toxoid have been given, or vaccination <strong>history is unknown</strong>, an <strong>immediate dose </strong>of<strong> diphtheria</strong> <strong>toxoid</strong> should be given and the primary series completed according to the current schedule.\u00a0</p>\n<p><strong>Asymptomatic carriers</strong> of diphtheria are treated with <strong>antimicrobial</strong> <strong>prophylaxis</strong> for a period of <strong>10-14 days</strong>. If an individual has<strong> not received</strong> a <strong>booster dose</strong> of diphtheria toxoid <strong>within 1 year</strong>, an age-appropriate preparation of the <strong>vaccine</strong> should be <strong>administered</strong> promptly.\u00a0</p>\n<p><strong>Droplet precautions</strong> (respiratory colonization) or <strong>contact precautions</strong> (cutaneous colonization) of cases and carriers are maintained <strong>until two</strong> <strong>consecutive negative cultures</strong> (collected 24 hours apart) are obtained after cessation of therapy.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young boy is brought to the clinic with complaints of abdominal pain, diarrhea, and painful straining for 4 months. The symptoms were accompanied by rectal prolapse. Stool examination showed the following finding. Infection with which of the following helminths is most likely?",
    "choices": [
      {
        "id": 1,
        "text": "Trichinella spiralis"
      },
      {
        "id": 2,
        "text": "Enterobius vermicularis"
      },
      {
        "id": 3,
        "text": "Trichuris trichiura"
      },
      {
        "id": 4,
        "text": "Ascaris lumbricoides"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Albendazole</strong> is the drug of choice (400 mg, orally, for 3 days; for all ages).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a1dd279cf34b4108b2698c970411e871.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/16ad523e6dd246b5a2ec669cc3e75cc8x200x200.JPEG"
    ]
  },
  {
    "text": "An anxious mother brought her 4-year-old daughter to the pediatrician. The girl was passing loose, bulky stools for the past 4 days. This was often associated with pain in the abdomen. The pediatrician ordered stool examination, which showed the following organisms. Which vitamin deficiency is the child at the greatest risk for?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B1 deficiency"
      },
      {
        "id": 2,
        "text": "Vitamin A deficiency"
      },
      {
        "id": 3,
        "text": "Vitamin B6 deficiency"
      },
      {
        "id": 4,
        "text": "Vitamin C deficiency"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The stool examination (image) shows&nbsp;<strong>pear-shaped trophozoites</strong> having two nuclei and a flagellum, typical of <strong><em>Giardia lamblia</em>.&nbsp;</strong>Giardiasis is associated with&nbsp;a deficiency of fat-soluble vitamins like vitamin A.</p>\n<p><em>Giardia lamblia&nbsp;</em>is transmitted via contaminated drinking water.</p>\n<p>Clinical features include acute infectious diarrhea or <strong>chronic diarrhea</strong>, failure to thrive, and abdominal pain. Stools initially may be profuse and watery and later become greasy and <strong>foul-smelling</strong>. Stools do not contain blood, mucus, or leukocytes. It is associated with fat-soluble vitamin deficiencies, iron deficiency, and growth stunting.</p>\n<p>Diagnosis is done by <strong>stool enzyme immunoassay (EIA)</strong> or direct fluorescent antibody tests for<em> Giardia</em> antigens; EIA is superior to microscopy.</p>\n<p>Treatment includes tinidazole and nitazoxanide.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b254d177a26d47a192da5d336c15f58d.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "In a child, the amoebic liver abscess can be diagnosed by demonstrating which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Cysts in the sterile pus"
      },
      {
        "id": 2,
        "text": "Trophozoites in the pus"
      },
      {
        "id": 3,
        "text": "Cysts in the hepatic venous sample"
      },
      {
        "id": 4,
        "text": "Trophozoites in the feces"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Invasive amebiasis is treated with <strong>nitroimidazoles</strong> such as metronidazole or tinidazole. This is followed by a <strong>luminal amebicide</strong> such as paromomycin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e1da6c1d228448018585e4b9b92ee825x359x278.PNG"
    ]
  },
  {
    "text": "What is the most common route of acquiring Ancylostoma duodenale infection?",
    "choices": [
      {
        "id": 1,
        "text": "Ingestion of infected food items"
      },
      {
        "id": 2,
        "text": "Inhalation of droplets"
      },
      {
        "id": 3,
        "text": "Penetration of skin by larva"
      },
      {
        "id": 4,
        "text": "Inoculation into eroded skin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Treatment:</strong></p>\n<ul>\n<li>Mebendazole 100 mg bid, orally, for 3 days or single dose of 500 mg</li>\n<li>Albendazole 400 mg, orally, once</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0cb64cf9e4364a27aa88a76182c9826ax767x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/917df840e7594320a104dbcf2618f824x682x600.JPEG"
    ]
  },
  {
    "text": "A child from Bihar comes with a fever. Blood examination shows sheathed microfilaria as shown in the image. Identify the organism.",
    "choices": [
      {
        "id": 1,
        "text": "Brugia malayi"
      },
      {
        "id": 2,
        "text": "Wuchereria bancrofti"
      },
      {
        "id": 3,
        "text": "Loa loa"
      },
      {
        "id": 4,
        "text": "Oncocerca vovulous"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The incidence of Brugia malayi is more in children from Bihar and the image showing microfilaria with two nuclei at the tail. Hence the organism is&nbsp;<strong>Brugia malayi,</strong> which causes lymphatic <strong>filariasis</strong>.</p>\n<p><em>Brugia malayi</em> (Malayan filariasis), <em>Brugia timori</em>, and <em>Wuchereria bancrofti</em> (bancroftian filariasis) are thread-like nematodes that cause a similar infection called Filariasis. Infective larvae are introduced into humans during sucking of blood by the <strong>mosquito vector</strong> (commonly, culex).</p>\n<p>Clinical manifestations include episodic fever,&nbsp;<strong>lymphangitis</strong> of an extremity, lymphadenitis (especially the inguinal and axillary areas), headaches, and myalgias. Hepatosplenomegaly and generalized lymphadenopathy are often seen in children. These symptoms are caused by an acute inflammatory response triggered by the death of adult worms.</p>\n<p>Diagnosis is done by&nbsp;demonstration of <strong>microfilariae in the blood.&nbsp;</strong>Blood samples should be obtained between 10 pm and 2 am because microfilaremia is <strong>nocturnal.</strong></p>\n<p>Treatment:</p>\n<ul>\n<li><strong>Diethylcarbamazine</strong> 1 mg/kg PO as a single dose on day 1</li>\n<li>1 mg/kg tid on day 2</li>\n<li>1-2mg/kg tid on day 3</li>\n<li>6 mg/kg/day divided tid on days 4-14</li>\n</ul>\n<p>The image below shows the difference between microfilaria of various filarial nematodes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e6e67a860a484449aa14ae8cf0fac315.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/afafe8a8d3654e9dbe4c73431d0794eax1280x3830.0705218617773.JPEG"
    ]
  },
  {
    "text": "A boy is brought to the emergency with repeated episodes of generalized tonic-clonic seizures. History is significant for a dietary intake of pork. MRI reveals multiple ring-enhancing lesions as shown below. Which of the following organism is the likely cause for seizures in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Enterobius vermicularis"
      },
      {
        "id": 2,
        "text": "Taenia solium"
      },
      {
        "id": 3,
        "text": "Echinococcus"
      },
      {
        "id": 4,
        "text": "Taenia saginata"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The likely cause of <strong>seizures</strong> in a child who has&nbsp;multiple ring-enhancing lesions and dietary history of<strong>&nbsp;pork intake</strong> is an infection with <strong><em>Taenia solium</em>.</strong></p>\n<p>Children acquire the adult form of the parasite by ingestion of undercooked pork containing <strong>larvae cysts</strong>. In the intestines, the cyst converts into adult form. The adult form releases eggs in the stool.</p>\n<p>If the eggs are ingested (shed by tapeworm carriers or by unhygienic practices), the larvae are released from the <strong>eggs.&nbsp;</strong>The larva then&nbsp;invades through the intestines and migrate through the bloodstream to the <strong>muscles</strong> (and other organs), where they form tissue cysts called <strong>cysticercosis.</strong> When these larvae find their way to the <strong>brain,</strong> it&nbsp;is termed as&nbsp;<strong>neurocysticercosis</strong>.</p>\n<p><strong>Neurocysticercosis </strong>typically presents with <strong>seizures</strong> (focal or generalized). It can be associated with basilar arachnoiditis that can present with signs of meningeal irritation. Cysticerci in the tissues may present with focal findings from the mass effect. Ocular neurocysticercosis causes decreased visual acuity because of cysticerci in the retina or vitreous, retinal detachment, or iridocyclitis.</p>\n<p>Treatment includes management of seizures.&nbsp;<strong>albendazole</strong> therapy (treatment of choice). Praziquantel can also be used.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28aa9514617443c4b3b248eadc02c325.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding congenital toxoplasmosis?",
    "choices": [
      {
        "id": 1,
        "text": "It occurs through hematogenous dissemination to the placenta"
      },
      {
        "id": 2,
        "text": "Chorioretinitis is the most common manifestation"
      },
      {
        "id": 3,
        "text": "Immunoglobulin G (IgG) is diagnostic"
      },
      {
        "id": 4,
        "text": "It can manifests as hydrops fetalis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>IgG</strong> is <strong>not</strong> diagnostic for <strong>congenital toxoplasmosis.</strong></p>\n<p>The presence of IgG antibodies in a newborn can be due to an old infection in the mother, as IgG can cross the placenta. IgM cannot cross the placenta, hence the <strong>presence of IgM</strong> in newborns <strong>confirms</strong> the diagnosis of <strong>congenital toxoplasmosis.</strong> IgM immunosorbent agglutination assay (<strong>ISAGA</strong>) and <strong>IgA ELISA</strong> are the most useful diagnostic tests.</p>\n<p><strong>Toxoplasmosis&nbsp;</strong>is caused by <em>Toxoplasma gondi</em>.&nbsp;<em>Toxoplasma</em>&nbsp;can be transmitted to humans by three principal routes:</p>\n<ul>\n<li>Ingestion of raw or inadequately cooked infected meat</li>\n<li>Ingestion of oocysts through exposure to cat litter or soil</li>\n<li>Newly infected pregnant woman passing the infection to her unborn fetus</li>\n</ul>\n<p>It can be acquired orally, transplacentally or rarely, parenterally or by transfusion.</p>\n<p><strong>Congenital toxoplasmosis:&nbsp;</strong>When a mother acquires the infection during gestation, organisms may <strong>disseminate hematogenously</strong> to the placenta. Infection may be transmitted to the fetus transplacentally or during vaginal delivery.</p>\n<p>The <strong>characteristic triad</strong> of <strong>chorioretinitis, hydrocephalus, </strong>and <strong>cerebral calcifications&nbsp;</strong>may be present. Other clinical features include small size for gestational age, prematurity, persistent jaundice, mild thrombocytopenia, hydrops fetalis, and perinatal death.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common manifestation of congenital toxoplasmosis is ______",
    "choices": [
      {
        "id": 1,
        "text": "Hydrocephalus"
      },
      {
        "id": 2,
        "text": "Chorioretinitis"
      },
      {
        "id": 3,
        "text": "Hepatosplenomegaly"
      },
      {
        "id": 4,
        "text": "Thrombocytopenia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Chorioretinitis</strong> is the <strong>most common</strong> manifestation of congenital toxoplasmosis.</p>\n<p>The characteristic <strong>triad</strong> of congenital toxoplasmosis is <strong>chorioretinitis</strong>, <strong>hydrocephalus,</strong> and <strong>diffuse</strong> <strong>intracranial&nbsp;calcifications.&nbsp;</strong>Clinical manifestations&nbsp;apart from the triad include hydrops fetalis, <strong>intrauterine growth retardation</strong>, <strong>prematurity</strong>, peripheral retinal scars, persistent jaundice, and mild thrombocytopenia.</p>\n<p><strong>Congenital toxoplasmosis&nbsp;</strong>occurs when a pregnant woman&nbsp;acquires the infection during gestation. The organism may cross to the&nbsp;<strong>fetus&nbsp;transplacentally</strong> or at the time of vaginal delivery. The severity of the disease in the neonate is<strong> greater</strong> if the woman gets infected <strong>early in her pregnancy</strong>.&nbsp;The causative agent is <em>Toxoplasma gondii</em>, an obligate intracellular protozoan.</p>\n<p>The <strong>diagnosis</strong> is made by the detection of <strong>IgM</strong> anti-toxoplasma antibodies. IgG can cross the placenta is hence, cannot confirm infection in the infant. IgM immunosorbent agglutination assay (<strong>ISAGA</strong>) and&nbsp;<strong>IgA ELISA</strong>&nbsp;are the most useful diagnostic tests.</p>\n<p><strong>Spiramycin </strong>can be administered for cases of <strong>acute infection</strong> in&nbsp;<strong>early pregnancy&nbsp;</strong>to reduce vertical transmission. It does&nbsp;<strong>not cross</strong> the placenta and therefore cannot be used to treat an infected fetus.&nbsp;<strong>Pyrimethamine-sulfonamide</strong>&nbsp;(to be avoided in the first trimester) is used when<strong> a fetal infection</strong>&nbsp;is<strong>&nbsp;confirmed</strong>&nbsp;or&nbsp;in maternal<strong> infections after 18 weeks.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Maternal antibodies that do not provide significant immunity in a neonate:",
    "choices": [
      {
        "id": 1,
        "text": "Tetanus"
      },
      {
        "id": 2,
        "text": "Polio"
      },
      {
        "id": 3,
        "text": "Diptheria"
      },
      {
        "id": 4,
        "text": "Measles"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Maternal antibodies</strong> <strong>do not</strong> provide significant immunity to <strong>polio infection</strong> in a neonate.&nbsp;</p>\n<p>Administering an <strong>oral polio vaccine</strong> (OPV) dose at <strong>birth</strong> can <strong>provide early mucosal protection</strong>, safeguarding against enteric pathogens before they can hinder the intestinal mucosal immune response. Furthermore, administering OPV during the period when infants are protected by maternal antibodies may help prevent vaccine-associated paralytic polio (VAPP).</p>\n<p>All <strong>pregnant women</strong> should receive a tetanus toxoid, reduced diphtheria toxoid, and acellular pertussis (<strong>Tdap</strong>) vaccine during each pregnancy, as early in the 27&ndash;36-week-of-gestation window as possible. The <strong>maternal antibodies</strong> formed from<strong> Tdap</strong> will provide <strong>immunity against tetanus</strong>, <strong>diphtheria,</strong> and <strong>pertussis</strong> in the newborn. Administering the Tdap vaccine earlier, between the<strong> 27th and 36th week</strong> of gestation, <strong>maximizes</strong> the transfer of <strong>passive antibodies</strong> to the infant (options A and C).&nbsp;</p>\n<div class=\"page\" title=\"Page 6779\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Infants less than <strong>6 months</strong> are generally <strong>protected from measles</strong> by <strong>maternal antibodies</strong> (option D).</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the daily dosage of ethambutol for an adolescent of age 14 years?",
    "choices": [
      {
        "id": 1,
        "text": "20 mg/kg"
      },
      {
        "id": 2,
        "text": "10 mg/kg"
      },
      {
        "id": 3,
        "text": "40 mg/kg"
      },
      {
        "id": 4,
        "text": "30 mg/kg"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The daily dosage of ethambutol is 20 mg/kg body weight.</p>\n<p>First-line antitubercular drugs:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Drug</strong></td>\n<td><strong>Daily dosage </strong>(mg/kg)</td>\n<td><strong>Adverse effects</strong></td>\n</tr>\n<tr>\n<td><strong>Isoniazid</strong></td>\n<td>10-15</td>\n<td>Peripheral neuritis, hepatic enzyme elevation</td>\n</tr>\n<tr>\n<td><strong>Rifampin</strong></td>\n<td>15-20</td>\n<td>Orange discoloration of secretions and<br />urine</td>\n</tr>\n<tr>\n<td><strong>Ethambutol</strong></td>\n<td>20</td>\n<td>Optic neuritis,<br />decreased red-green color discrimination</td>\n</tr>\n<tr>\n<td><strong>Pyrazinamide</strong></td>\n<td>30-40</td>\n<td>Hepatotoxicity, hyperuricemia</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Note: </strong></p>\n<ul>\n<li>All first-line antitubercular drugs are hepatotoxic except ethambutol.</li>\n<li>All first-line antitubercular drugs are bactericidal except ethambutol, which is bacteriostatic.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a component of Hutchinson's triad in congenital syphilis?",
    "choices": [
      {
        "id": 1,
        "text": "Peg-shaped upper incisor"
      },
      {
        "id": 2,
        "text": "Interstitial keratitis"
      },
      {
        "id": 3,
        "text": "Sensorineural deafness"
      },
      {
        "id": 4,
        "text": "Saber shin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Saber shin is not a component of Hutchinson&rsquo;s triad. Saber shin is the anterior bowing of the midportion of the tibia.</p>\n<p><strong>Note: </strong>Peg-shaped upper central incisor is called as Hutchinson's teeth (erupts during the 6<sup>th</sup> year of life).</p>\n<p><strong>Hutchinson&rsquo;s triad</strong>:<strong>&nbsp;</strong>It is a triad of stigmata seen characteristically in congenital syphilis. The components are as follows:</p>\n<ul>\n<li>Hutchinson's teeth</li>\n<li>Interstitial keratitis</li>\n<li>Sensorineural deafness</li>\n</ul>\n<p><strong>Image</strong>:&nbsp;Hutchinson teeth (peg-shaped upper incisors)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6526c2bfed95473abd90b4b25c9af41cx720x384.JPEG"
    ]
  }
];
        let quizName = '17 Pediatric Bacterial And Parasitic Infections';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>