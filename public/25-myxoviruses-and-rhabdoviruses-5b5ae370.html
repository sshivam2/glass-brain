<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25 Myxoviruses And Rhabdoviruses - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">17</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following RNA viruses has an 8 segmented genome with its site of replication being the nucleus?",
    "choices": [
      {
        "id": 1,
        "text": "Influenza virus"
      },
      {
        "id": 2,
        "text": "Measles virus"
      },
      {
        "id": 3,
        "text": "Rubella virus"
      },
      {
        "id": 4,
        "text": "Mumps virus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Influenza virus</strong> has an 8 segmented genome.&nbsp;Its site of replication is the nucleus, unlike other RNA viruses.&nbsp;Influenza virus belongs to the Orthomyxoviridae family.&nbsp;</p>\n<p><strong>Most DNA</strong> viruses replicate in the <strong>nucleus,</strong>&nbsp;<strong>except pox</strong>.&nbsp;Most<strong> RNA</strong> viruses replicate in the <strong>cytoplasm,</strong>&nbsp;except&nbsp;<strong>retroviruses and orthomyxoviruses.</strong></p>\n<p>Examples of segmented viruses (ARBO):&nbsp;</p>\n<ul>\n<li><strong>A</strong>renavirus (2 segments)</li>\n<li><strong>R</strong>otavirus (11 segments)</li>\n<li><strong>B</strong>unyavirus (3 segments)</li>\n<li><strong>O</strong>rthomyxovirus (8 segments)</li>\n</ul>\n<p>The image below shows the segmented genome seen in the influenza virus (Orthomyxoviridae)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f5313a1cd2bb46efb68e8835a89a7643x1280x1476.JPEG"
    ]
  },
  {
    "text": "A microbiologist working on influenza virus in a lab, observes reversal of hemagglutination. What is this phenomenon known as?",
    "choices": [
      {
        "id": 1,
        "text": "Hemolysis"
      },
      {
        "id": 2,
        "text": "Precipitation"
      },
      {
        "id": 3,
        "text": "Elution"
      },
      {
        "id": 4,
        "text": "Complement fixation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Elution</strong> is the process of&nbsp;<strong>reversal of hemagglutination</strong> and the release&nbsp;of the virus from the red cell surface.</p>\n<p>Influenza virus contains two surface antigens:</p>\n<ul>\n<li><strong>Hemagglutinin</strong> (HA) - causes <strong>RBC agglutination;</strong> facilitates viral entry into cells</li>\n<li><strong>Neuraminidase</strong> (NA) - an enzyme that destroys the receptor HA uses to bind to RBCs causing <strong>elution</strong>/reversal of hemagglutination. Hence, it is also called a <strong>receptor destroying enzyme</strong> (RDE).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d0941a6e9da84951a385bbcb40822e0cx1280x1476.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is true regarding antigenic drift?",
    "choices": [
      {
        "id": 1,
        "text": "There is a gradual sequential change in antigenic structure"
      },
      {
        "id": 2,
        "text": "It doesn\u2019t account for the periodic epidemics of influenza"
      },
      {
        "id": 3,
        "text": "The new antigens thus formed are totally unrelated to the previous antigens"
      },
      {
        "id": 4,
        "text": "Antibodies to the predecessor viruses do not neutralise the new variants"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Antigenic drift</strong>&nbsp;causes a&nbsp;<strong>gradual sequential change</strong> in antigenic structure.</p>\n<p>It accounts for <strong>periodic epidemics.</strong>&nbsp;This property forms the basis for the development of annual influenza <strong>vaccines.</strong>&nbsp;</p>\n<p><strong>Antigenic variation</strong> is a property of<strong>&nbsp;influenza viruses&nbsp;</strong>by which it&nbsp;alters the antigenic structure on its surface and thus avoids a host immune response. It is of two types - Antigenic shift and antigenic drift.</p>\n<table style=\"width: 474px; height: 326px;\">\n<tbody>\n<tr>\n<td style=\"width: 143.062px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 147.539px; text-align: center;\"><strong>Antigenic shift</strong></td>\n<td style=\"width: 159.492px; text-align: center;\"><strong>Antigenic drift</strong></td>\n</tr>\n<tr>\n<td style=\"width: 143.062px; text-align: left;\"><strong>Antigenic structure</strong></td>\n<td style=\"width: 147.539px; text-align: left;\">Abrupt, drastic change</td>\n<td style=\"width: 159.492px; text-align: left;\">Gradual, sequential change&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 143.062px; text-align: left;\"><strong>Periodicity</strong></td>\n<td style=\"width: 147.539px; text-align: left;\">&nbsp;10 - 20 years</td>\n<td style=\"width: 159.492px; text-align: left;\">2 - 3 years &nbsp;&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 143.062px; text-align: left;\"><strong>Epidemiological effect</strong></td>\n<td style=\"width: 147.539px; text-align: left;\">Pandemics and major epidemics&nbsp;</td>\n<td style=\"width: 159.492px; text-align: left;\">Periodic epidemic and sporadic cases</td>\n</tr>\n<tr>\n<td style=\"width: 143.062px; text-align: left;\"><strong>Genetic cause</strong></td>\n<td style=\"width: 147.539px; text-align: left;\">Large genetic re-assortment</td>\n<td style=\"width: 159.492px; text-align: left;\">Point mutation</td>\n</tr>\n<tr>\n<td style=\"width: 143.062px; text-align: left;\"><strong>Antibodies to predecessor strains</strong></td>\n<td style=\"width: 147.539px; text-align: left;\">Do not neutralize the new variant</td>\n<td style=\"width: 159.492px; text-align: left;\">Neutralizes the new variant to varying degrees</td>\n</tr>\n<tr>\n<td style=\"width: 143.062px; text-align: left;\"><strong>Clinical relevance&nbsp;</strong></td>\n<td style=\"width: 147.539px; text-align: left;\">Animal-origin viruses infecting humans e.g. Swine flu, COVID-19</td>\n<td style=\"width: 159.492px; text-align: left;\">\n<p>Annual influenza vaccine development</p>\n<p>Common cold - People can get flu more than once</p>\n<p>&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms is represented by the given form of replication?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatitis virus"
      },
      {
        "id": 2,
        "text": "Influenza virus"
      },
      {
        "id": 3,
        "text": "HIV"
      },
      {
        "id": 4,
        "text": "Herpes virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the replication of <strong>influenza virus</strong>.</p>\n<p>Stages of replication:</p>\n<div class=\"page\" title=\"Page 583\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ol>\n<li><strong>Attachment, penetration, uncoating-</strong>&nbsp;the virus is internalized by receptor-mediated endocytosis&nbsp;</li>\n<li><strong>Transcription and translation-</strong>&nbsp;Viral transcription occurs in the nucleus. The mRNAs are produced from viral nucleocapsids.</li>\n<li><strong>Viral RNA replication-</strong>&nbsp;Viral genome replication is accomplished by the same virus-encoded polymerase proteins involved in transcription.</li>\n<li><strong>Maturation-</strong>&nbsp;The virus matures by budding from the surface of the cell.</li>\n</ol>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2f95a71e225842cd9d0f47b1091c0966.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You receive multiple patients from a poultry farm presenting with fever, dyspnea, cold, and cough. You suspect an outbreak of Avian flu. Which of the following virus strains causes the same?",
    "choices": [
      {
        "id": 1,
        "text": "H1N1"
      },
      {
        "id": 2,
        "text": "H5N1"
      },
      {
        "id": 3,
        "text": "H3N2"
      },
      {
        "id": 4,
        "text": "H2N2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>H5N1</strong> is a strain of <strong>avian influenza</strong>.</p>\n<p>Transmission occurs<strong> only from birds&nbsp;</strong>(e.g. poultry). Recombination occurs in&nbsp;<strong>pigs.&nbsp;</strong>Human-to-human transmission is very rare.&nbsp;</p>\n<p>It causes flu-like symptoms and can cause severe respiratory illness.&nbsp;</p>\n<p>Option A: H1N1 causes swine flu</p>\n<p>Option C: H3N2 causes Hong Kong flu</p>\n<p>Option D: H2N2 caused a pandemic in 1957&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old girl with a history of fever, rhinorrhea, sore throat, and myalgia presented with multiple episodes of vomiting and seizures. She was diagnosed with Reye's syndrome. Which of the following is incorrect about the most likely etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "Virus shedding is present before symptoms begins"
      },
      {
        "id": 2,
        "text": "5-12 years is a high risk group"
      },
      {
        "id": 3,
        "text": "Aquatic birds act as reservoir"
      },
      {
        "id": 4,
        "text": "Secondary attack rate is 5-15%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely etiological agent in the given case of Reye's syndrome is the\u00a0<strong>influenza virus.\u00a0 </strong>Children &lt;<strong>5-years</strong>, especially those<strong>\u00a0&lt;2-years</strong> of age are at the <strong>highest risk</strong> of serious <strong>complications</strong> related to <strong>influenza</strong> infection. Other high-risk groups for influenza include adults\u00a0\u226560 years of age, persons with chronic diseases, persons who are immunocompromised.</p>\n<p class=\"p1\">Option A: The virus is <strong>shed</strong> in respiratory secretions <strong>a day before the onset</strong> of illness and for <strong>3-4 days thereafter</strong>.</p>\n<p class=\"p1\">Option C: <strong>Birds</strong>, especially aquatic birds act as <strong>reservoirs</strong> of influenza viruses.</p>\n<p class=\"p1\">Option D: Secondary attack rate is <strong>5-15%</strong>.</p>\n<p class=\"p1\">Note: Reye's syndrome is precipitated by the interaction of a viral infection (such as influenza)\u00a0with salicylates.<strong>\u00a0</strong>Therefore, aspirin is not given to pediatric patients with influenza and influenza-like illness.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old boy is brought to the OPD with complaints of headache and drowsiness since 2 days. He had a history of fever, ear pain, and difficulty in swallowing for 1 week. On examination, you see the following. Brudzinki's sign is positive. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Croup"
      },
      {
        "id": 2,
        "text": "Mumps"
      },
      {
        "id": 3,
        "text": "Infectious mononucleosis"
      },
      {
        "id": 4,
        "text": "Herpangina"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with fever, parotitis, headache, drowsiness, and positive Brudzinki's sign is suggestive of <strong>meningitis</strong>&nbsp;secondary to <strong>mumps</strong>.&nbsp;</p>\n<p><strong>Mumps</strong> is caused by the mumps virus and is characterized by <strong>fever,</strong> bilateral or unilateral<strong> parotid swelling</strong> which may be <strong>tender.</strong> Parotitis can present with <strong>ear pain</strong>&nbsp;and <strong>difficulty in swallowing</strong>. It usually resolves in a week.</p>\n<p>Meningoencephalitis/<strong>aseptic meningitis&nbsp;</strong>can occur&nbsp;before, along with, or after parotitis. Most commonly, it manifests <strong>5 days after parotitis</strong>. It can present with headache, neck stiffness, and drowsiness.</p>\n<p><strong>Complications of mumps</strong>:</p>\n<ul>\n<li>Aseptic meningitis or meningoencephalitis</li>\n<li>Epididymo-orchitis- Usually unilateral. Seen in post-pubertal males</li>\n<li>Oophoritis</li>\n<li>Other complications include pancreatitis and myocarditis</li>\n</ul>\n<p>Note: Non-mumps parotitis can be caused by:</p>\n<ul>\n<li>Epstein-Barr virus - causes infectious mononucleosis</li>\n<li>Coxsackievirus - causes herpangina</li>\n<li>Parainfluenza virus - causes croup</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1d1e51e2ff114470ad51d34d9bb43b7a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  9-month-old child is brought to the OPD for MMR vaccine. Which strain of mumps virus is used in the same?",
    "choices": [
      {
        "id": 1,
        "text": "Edmonston-Zagreb strain"
      },
      {
        "id": 2,
        "text": "Nakayama strain"
      },
      {
        "id": 3,
        "text": "Jeryl-Lynn strain"
      },
      {
        "id": 4,
        "text": "RA 27/3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The strain of <strong>mumps</strong> virus used in the&nbsp;<strong>MMR vaccine</strong>&nbsp;(Measles, Mumps, Rubella) is the&nbsp;<strong>Jeryl-Lynn strain.</strong>&nbsp;</p>\n<p>The virus is&nbsp;<strong>attenuated</strong> by serial passage in embryonated eggs and grown in chick embryo fibroblast culture.&nbsp;</p>\n<p>Note: The schedule of MMR vaccine as per the National Immunisation Schedule is from 9 completed months to 12 months. (can be given till 5 years of age).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brings her 5-month-old baby to the casualty with complaints of fast breathing and poor feeding. She also gives a history of fever, cold, and cough for 3 days. On examination, nasal flaring and expiratory wheeze are present. Which of the following statements is false about the viral etiology of the same?",
    "choices": [
      {
        "id": 1,
        "text": "The cytopathic effect is syncytium formation"
      },
      {
        "id": 2,
        "text": "Ribavirin is the drug of choice"
      },
      {
        "id": 3,
        "text": "Omalizumab is given for prophylaxis"
      },
      {
        "id": 4,
        "text": "It is the most important cause of bronchiolitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>bronchiolitis</strong> caused by the&nbsp;<strong>respiratory syncytial virus</strong> (RSV). <strong>Palivizumab</strong> is given for <strong>RSV prophylaxis</strong> in <strong>high-risk infants</strong> such as premature babies, immunocompromised infants, etc.&nbsp;</p>\n<p>Option A - The characteristic&nbsp;cytopathic effect is <strong>syncytium formation&nbsp;</strong>(multinucleated giant cell).&nbsp;</p>\n<p>Option B -&nbsp;Inhaled <strong>ribavirin</strong> is the drug of choice.&nbsp;</p>\n<p>Option D - RSV causes <strong>upper</strong> and&nbsp;<strong>lower respiratory tract infections</strong> in infants, and is the&nbsp;most common cause of <strong>bronchiolitis</strong> from ages<strong> 6 weeks to 6 months.</strong> It can cause pneumonia and tracheobronchitis and is common during winters and monsoon.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An unimmunized man presents with fever, malaise, and an erythematous rash starting from behind the ears and progressing to the face and trunk. Given below is an image of lymphoid tissue taken from this patient. What pathological finding do you see here?",
    "choices": [
      {
        "id": 1,
        "text": "Warthin-Finkeldey giant cells"
      },
      {
        "id": 2,
        "text": "Warthin-Starry stain"
      },
      {
        "id": 3,
        "text": "Langhans giant cells"
      },
      {
        "id": 4,
        "text": "Aschoff giant cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Warthin-Finkeldey</strong> cells are seen here. These are&nbsp;<strong>multinucleate</strong> <strong>giant</strong> <strong>cells,</strong> which are found in the lymphoid tissues of patients with <strong>measles</strong>.</p>\n<p>The cytopathic effect of measles consists&nbsp;<strong>of multinucleate syncytium formation</strong> with numerous <strong>acidophilic nuclear and cytoplasmic</strong> inclusions, as shown in the image below.</p>\n<p>Option B: Warthin-Starry stain is used to detect spirochetes and to stain<em> H. pylori</em> and <em>B. henselae</em></p>\n<p>Option C: Langhans giant cells are seen in tuberculosis&nbsp;</p>\n<p>Option D: Aschoff giant cells are seen in rheumatic fever</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/769f15463f414889b2709df21d9d6bf7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/feb6086d3f834c2b8f3e551d884dfb1ex702x475.JPEG"
    ]
  },
  {
    "text": "A 3-year-old boy with no prior immunization history presents with fever, cough, and coryza. On examination of the buccal mucosa, you see the following. Which stage of the disease is this finding seen in?",
    "choices": [
      {
        "id": 1,
        "text": "Prodromal stage"
      },
      {
        "id": 2,
        "text": "Post measles stage"
      },
      {
        "id": 3,
        "text": "Eruptive stage"
      },
      {
        "id": 4,
        "text": "All the stages"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image below shows the characteristic maculopapular rash in measles</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4f135da22d284de995514dd77c1a5e7a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4093b2eac80741d8a9c42a3e9653c337x1280x1085.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2324178563d940e9882a3a7afc6b9464x700x463.JPEG"
    ]
  },
  {
    "text": "Which of the following disease has the highest mortality once clinically manifested?",
    "choices": [
      {
        "id": 1,
        "text": "Nipah"
      },
      {
        "id": 2,
        "text": "Rabies"
      },
      {
        "id": 3,
        "text": "Ebola"
      },
      {
        "id": 4,
        "text": "Zika"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Rabies</strong>&nbsp;is a vaccine-preventable, zoonotic, viral disease. Once clinical symptoms appear,&nbsp;rabies&nbsp;is virtually&nbsp;<strong>100</strong>% <strong>fatal.</strong></p>\n<p>Spread of rabies:</p>\n<ul>\n<li><strong>Centripetal</strong> spread -\n<ul>\n<li>The virus enters the <strong>peripheral</strong> neurons, it moves via&nbsp;<strong>retrograde fast axonal transport</strong> towards the spinal cord or brainstem a.k.a the central nervous system <strong>(CNS)&nbsp;</strong>at a speed of up to 250 mm/day.</li>\n<li>Once <strong>within CNS,</strong> it spreads quickly to other regions in the CNS&nbsp;through <strong>fast axonal transport</strong>. It infects neurons primarily, but may rarely infect astrocytes.</li>\n</ul>\n</li>\n<li><strong>Centrifugal</strong> spread - After <strong>CNS</strong> infection is established, it spreads along the&nbsp;<strong>sensory</strong> and <strong>autonomic nerves</strong> to:&nbsp;\n<ul>\n<li>Salivary glands&nbsp;</li>\n<li>Adrenal glands</li>\n<li>Skin&nbsp;</li>\n</ul>\n</li>\n</ul>\n<p>Rabies virus <strong>replicates</strong> in <strong>acinar cells</strong> of the <strong>salivary glands</strong> and is secreted in the saliva of rabid animals that serve as <strong>vectors.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old pet-groomer was brought to the casualty with a history of breathlessness, excessive agitation, and restlessness. His bystanders give a history of progressive behavioral change and he had a fever, sore throat, and generalized weakness 1 month back. On examination, pulse was 100 bpm, SpO2 was 98% on room air.  Which of the following samples will not be preferred to detect the etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "Corneal impression"
      },
      {
        "id": 2,
        "text": "Cerebrospinal fluid"
      },
      {
        "id": 3,
        "text": "Saliva"
      },
      {
        "id": 4,
        "text": "Skin biopsies including hair follicles"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case scenario is highly suggestive of <strong>rabies.&nbsp;Corneal impression</strong>&nbsp;smears are <strong>not performed</strong>, as they are of <strong>low diagnostic yield.</strong></p>\n<p>Laboratory diagnosis of rabies is performed by the following methods:</p>\n<ul>\n<li><strong>Antigen</strong> detection - Direct immunofluorescence (IF) from specimens of :\n<ul>\n<li><strong>Skin biopsy </strong>from the nape of the neck<strong> including hair follicles</strong>. Rabies antigen is present in cutaneous nerves at the base of hair follicles. It is the most <strong>sensitive and specific</strong> test.</li>\n<li>Corneal smears were previously used. They are not used anymore as they are of low diagnostic yield.</li>\n</ul>\n</li>\n<li><strong>Viral isolation</strong>- Intracerebral inoculation in mice can be attempted from the <strong>brain, CSF, and saliva.</strong></li>\n<li><strong>Antibody demonstration</strong> from <strong>serum</strong> and<strong> CSF.</strong></li>\n<li><strong>Viral RNA</strong> detection by <strong>RT-PCR .</strong></li>\n<li>Postmortem examination of <strong>brain tissue</strong> samples- demonstration of <strong>Negri bodies.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An officer of the Indian Forest Services is bitten by a rabid fox while on duty. Which of the following statements is true about the etiological agent?",
    "choices": [
      {
        "id": 1,
        "text": "The incubation period is 4 to 5 days"
      },
      {
        "id": 2,
        "text": "It doesn't produce Negri bodies"
      },
      {
        "id": 3,
        "text": "It causes disease"
      },
      {
        "id": 4,
        "text": "It doesn't affect salivary gland"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of infection with the street form of<strong> rabies</strong> virus. <strong>Street rabies</strong> causes <strong>disease</strong>.</p>\n<p>All mammals are susceptible to rabies. Cattle, cats and foxes are highly susceptible, whereas dogs and humans have intermediate susceptibility.&nbsp;</p>\n<p>Differences between street rabies and fixed rabies:</p>\n<table style=\"width: 431.883px; height: 173px;\">\n<tbody>\n<tr>\n<td style=\"width: 198px; text-align: center;\"><strong>Street rabies</strong></td>\n<td style=\"width: 218.883px; text-align: center;\"><strong>Fixed rabies (produced by repeated passages)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 198px; text-align: center;\">Causes disease</td>\n<td style=\"width: 218.883px; text-align: center;\">Doesn't cause disease</td>\n</tr>\n<tr>\n<td style=\"width: 198px; text-align: center;\">Produces Negri body</td>\n<td style=\"width: 218.883px; text-align: center;\">Doesn't produce Negri body</td>\n</tr>\n<tr>\n<td style=\"width: 198px; text-align: center;\">Affects salivary glands</td>\n<td style=\"width: 218.883px; text-align: center;\">Doesn't affect salivary glands</td>\n</tr>\n<tr>\n<td style=\"width: 198px; text-align: center;\">Incubation period- 3 months</td>\n<td style=\"width: 218.883px; text-align: center;\">Incubation period- 4-5 days</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old man was brought to you with a history of fever, behavioral changes, and seizures. He is foaming at the mouth and is unable to ingest liquids. The patient was admitted to the ICU, however he died soon after. Post mortem brain samples showed the following finding. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Yellow fever virus"
      },
      {
        "id": 2,
        "text": "Rabies virus"
      },
      {
        "id": 3,
        "text": "CMV"
      },
      {
        "id": 4,
        "text": "Molluscum contagiosum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given&nbsp;image showing&nbsp;<strong>Negri bodies </strong>and the case scenario of fever, neurological symptoms like&nbsp;<strong>seizures and</strong>&nbsp;<strong>altered sensorium</strong>, <strong>hydrophobia</strong> (due to painful muscle contractions during swallowing liquids), and <strong>hypersalivation</strong> are suggestive of<strong> encephalitic rabies</strong>.</p>\n<p>Negri bodies are <strong>eosinophilic cytoplasmic inclusions</strong> in neurons that are composed of rabies virus proteins and viral RNA. These are commonly observed in<strong> Purkinje cells</strong> of the cerebellum and in <strong>pyramidal neurons</strong> of the hippocampus. Their presence is a&nbsp;<strong>characteristic</strong> pathologic finding in rabies.</p>\n<p>The image below shows Negri bodies:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ddcb62a6437c4545b5d9507596aef85c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b4a0eb774a3a4d9cac629cd5154a5f6fx1280x1066.JPEG"
    ]
  },
  {
    "text": "Babes nodules are seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Polio"
      },
      {
        "id": 2,
        "text": "Rabies"
      },
      {
        "id": 3,
        "text": "Diphtheria"
      },
      {
        "id": 4,
        "text": "Herpes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most <strong>characteristic</strong> pathologic finding in rabies is the <strong>Negri body</strong>. These are eosinophilic <strong>cytoplasmic inclusions</strong> in <strong>brain</strong> neurons that are composed of rabies virus proteins and viral RNA. The image given below shows Negri bodies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baff19915d8443449d253d92894065f9x510x487.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f1e0e3834c3542f8b29a7c76708bf15dx1280x1066.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding rabies vaccination?",
    "choices": [
      {
        "id": 1,
        "text": "Bitten dog should be observed for a minimum of 10 days."
      },
      {
        "id": 2,
        "text": "Four-dose regimen is given as 0.1ml intramuscularly on days 0, 3, 7 and 28."
      },
      {
        "id": 3,
        "text": "Pre-exposure prophylaxis regimen consists of 3 doses."
      },
      {
        "id": 4,
        "text": "The dose of human anti rabies immunoglobulin is 20 IU/kg."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the <strong>Updated Thai Red Cross Regimen</strong> (2-2-2-0-2) for post exposure prophylaxis, reconstituted rabies vaccine is given as follows:</p>\n<ul>\n<li>0.1 ml<strong>&nbsp;</strong><strong>intradermally</strong></li>\n<li>Sites - two sites at the same visit. It is given in both the deltoids</li>\n<li>Schedule - Days 0, 3, 7, and 28</li>\n</ul>\n<p>Healthy dogs, cats, or ferrets may be confined and observed for 10 days.</p>\n<p>The dosage of <strong>equine rabies immunoglobulin (eRIG) </strong>is&nbsp;<strong>40 IU/kg</strong> while that of <strong>human anti-rabies immunoglobulin (hRIG)</strong> is <strong>20 IU/kg body weight.</strong></p>\n<p>PrEP regimens for individuals of all ages are as follows:</p>\n<ul>\n<li>Three intramuscular<strong>&nbsp;</strong>or&nbsp;intradermal&nbsp;vaccine doses on days 0, 7, and 21 or 28.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '25 Myxoviruses And Rhabdoviruses';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>