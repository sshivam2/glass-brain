<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11 Mechanical Asphyxia - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Forensic Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 33-year-old man who was found dead in his home was taken for a postmortem examination. It revealed clogging of the respiratory tract by semi-digested food particles consisting of rice and vegetable matter. This would fall under which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Smothering"
      },
      {
        "id": 2,
        "text": "Entrapment"
      },
      {
        "id": 3,
        "text": "Strangulation"
      },
      {
        "id": 4,
        "text": "Suffocation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario is suggestive of <strong>suffocation</strong> due to <strong>aspiration of food particles</strong>. It\u00a0is classified under mechanical asphyxia.</p>\n<p><strong>Mechanical asphyxia</strong> can be classified depending on the <strong>respiratory block:</strong></p>\n<ol>\n<li><strong>Compression</strong> / <strong>constriction</strong> of the <strong>neck</strong> - Hanging, strangulation, throttling</li>\n<li><strong>Blocking external orifices</strong> of respiration, i.e. mouth and/or nostrils - Smothering, overlying, suffocation, gagging</li>\n<li><strong>Impaction</strong> of <strong>foreign bodies</strong> in respiratory tract - Choking</li>\n<li><strong>Compression</strong> and mechanical <strong>fixation</strong> of the <strong>chest</strong> and <strong>abdomen</strong> preventing the respiratory movements - Traumatic asphyxia / crush asphyxia</li>\n<li><strong>Inhalation</strong> of <strong>fluid</strong> into the respiratory tract - Drowning</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During the postmortem examination of a 52-year-old man, the forensic surgeon notices the following finding in the lungs. Which of the following is a true statement regarding this?",
    "choices": [
      {
        "id": 1,
        "text": "Caused by rupture of capillaries"
      },
      {
        "id": 2,
        "text": "These spots are an unreliable indicator of asphyxial death"
      },
      {
        "id": 3,
        "text": "Expression of E-selectin can distinguish antemortem and postmortem cases"
      },
      {
        "id": 4,
        "text": "These findings are uncommon in the dependant position"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows petechiae called\u00a0<strong>Tardieu spots</strong>. They are an\u00a0<strong>unreliable</strong> sign of <strong>asphyxial</strong> death.</p>\n<p>Hemorrhages if\u00a0<strong>larger</strong> than <strong>2 mm</strong>\u00a0are called <strong>ecchymoses </strong>and <strong>smaller</strong> than <strong>2 mm</strong> are called <strong>petechiae</strong>. They\u00a0are common non-specific autopsy findings and many are post-mortem in origin, especially in the dependent positions. They are caused by the rupture of\u00a0<strong>small venules</strong>\u00a0(capillary bleeding is invisible to the naked eye).</p>\n<p>It is suggested that the elevated expression of <strong>P-selectin</strong> could be used as a criterion to <strong>distinguish</strong>\u00a0between<strong>\u00a0antemortem</strong> findings\u00a0from<strong> post-mortem</strong> artifacts.</p>\n<p>Other non-specific signs of asphyxia are:\u00a0</p>\n<ul>\n<li><strong>Congestion</strong> of the larynx with slight oozing\u00a0</li>\n<li>Emphysematous, congested lungs with serosanguinous fluid exudates in alveoli</li>\n<li><strong>Cyanosis</strong> or dark-colored blood due to accumulation of CO<sub>2.</sub></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/728b83f2ebfd4026a290793fb70e87ce.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following types of asphyxia can one see the most marked congestion and cyanosis?",
    "choices": [
      {
        "id": 1,
        "text": "Postural asphyxia"
      },
      {
        "id": 2,
        "text": "Traumatic asphyxia"
      },
      {
        "id": 3,
        "text": "Smothering"
      },
      {
        "id": 4,
        "text": "Ligature strangulation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most marked congestion and cyanosis are seen in a case of <strong>traumatic asphyxia</strong>.</p>\n<p>It is the mechanical fixation of the chest (sitting on the chest). It acts by restricting respiratory movements and thus prevents inspiration.</p>\n<p>The four signs&nbsp;of asphyxia are as follows.</p>\n<ul>\n<li>Petechial haemorrhages</li>\n<li>Congestion and edema</li>\n<li>Cyanosis</li>\n<li>Engorgement of the right heart and abnormal fluidity of the blood.</li>\n</ul>\n<p>These signs are non-specific. But in <strong>traumatic asphyxia,</strong> there is a marked demonstration of these signs. In no other condition, apart from postural dependency, is the degree of <strong>congestion</strong> and <strong>cyanosis</strong> so <strong>marked</strong>.</p>\n<p>The image shows the marked congestion seen in traumatic asphyxia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c438853178e489fb880cb71a7245e48x720x1195.JPEG"
    ]
  },
  {
    "text": "Which of the following is best described by the image shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Burking"
      },
      {
        "id": 2,
        "text": "Smothering"
      },
      {
        "id": 3,
        "text": "Throttling"
      },
      {
        "id": 4,
        "text": "Choking"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image depicts <strong>smothering.</strong> It&nbsp;refers to the blockage of the <strong>external air passages</strong>, usually by a<strong> hand </strong>or<strong> soft fabric</strong>.</p>\n<p><strong>Mechanical asphyxia</strong>&nbsp;can be classified depending on the&nbsp;<strong>respiratory block:</strong></p>\n<ol>\n<li><strong>Compression</strong>&nbsp;/&nbsp;<strong>constriction</strong>&nbsp;of the&nbsp;<strong>neck</strong>&nbsp;- Hanging, strangulation, throttling</li>\n<li><strong>Blocking external orifices</strong>&nbsp;of respiration, i.e. mouth and/or nostrils - Smothering, overlying, suffocation, gagging</li>\n<li><strong>Impaction</strong>&nbsp;of&nbsp;<strong>foreign bodies</strong>&nbsp;in the respiratory tract - Choking</li>\n<li><strong>Compression</strong>&nbsp;and mechanical&nbsp;<strong>fixation</strong>&nbsp;of the&nbsp;<strong>chest</strong>&nbsp;and&nbsp;<strong>abdomen</strong>&nbsp;preventing the respiratory movements - Traumatic asphyxia / crush asphyxia</li>\n<li><strong>Inhalation</strong>&nbsp;of&nbsp;<strong>fluid</strong>&nbsp;into the respiratory tract - Drowning</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/15ee7e73abed4f22988f4278f83c8aa1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding smothering?",
    "choices": [
      {
        "id": 1,
        "text": "Congestion of face clearly indicates asphyxial death"
      },
      {
        "id": 2,
        "text": "Intrathoracic petechiae clearly indicate asphyxial death"
      },
      {
        "id": 3,
        "text": "Pressure marks on the face clearly indicate smothering"
      },
      {
        "id": 4,
        "text": "Abrasion around the mouth clearly indicates smothering"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Abrasions around</strong> the <strong>mouth,</strong> cheeks, lips or lesions within the lips may reliably indicate <strong>smothering.</strong></p>\n<p>The non-specific signs in deaths due to asphyxia:</p>\n<ul>\n<li><strong>Petechial hemorrhages</strong>&nbsp;in the face, eyebrows, eyelids, forehead, ears, conjunctiva, sclera - When they occur in the visceral pleura, they are called&nbsp;<strong>Tardieu&rsquo;s spots</strong></li>\n<li>Emphysematous, congested lungs with serosanguinous fluid exudates in alveoli</li>\n<li><strong>Cyanosis</strong> or dark-colored blood due to accumulation of CO<sub>2.</sub></li>\n<li><strong>Congestion</strong> of the larynx with slight oozing&nbsp;</li>\n</ul>\n<p><strong>Pressure marks</strong> on the face can occur as a part of normal postmortem changes. Circumoral and circumnasal pallor can be caused merely by passive pressure of the dependent head after death.</p>\n<p>Note: The coexistence of these findings, in themselves, does not prove that death resulted from mechanical asphyxia. All these phenomena are non-specific and are in no way peculiar to this mode of death. They are of <strong>no value</strong> <strong>in proving</strong> that death resulted from mechanical asphyxia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The autopsy report of a victim of homicide revealed the cause of death as smothering and traumatic asphyxia. Which of the following best describes the crime?",
    "choices": [
      {
        "id": 1,
        "text": "Burking"
      },
      {
        "id": 2,
        "text": "Garroting"
      },
      {
        "id": 3,
        "text": "Throttling"
      },
      {
        "id": 4,
        "text": "Bansdola"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Burking</strong> is a combination of <strong>smothering</strong> and <strong>traumatic asphyxia</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a5ee7069b7b481fae6423b33b3239cdx580x438.JPEG"
    ]
  },
  {
    "text": "A 56-year-old man collapsed suddenly during dinner with his friends. They brought him to the ER but he was already dead. On asking further history, they revealed that they were drinking before having food. There were no signs of asphyxia, but on autopsy, a bolus of food lodging in the larynx was found. Which of the following statements about this syndrome is true?",
    "choices": [
      {
        "id": 1,
        "text": "Mostly occurs in thin built individuals"
      },
      {
        "id": 2,
        "text": "Autopsy shows food lodged in the larynx only"
      },
      {
        "id": 3,
        "text": "Death is due respiratory arrest"
      },
      {
        "id": 4,
        "text": "Death is often is due to parasympathetic overactivity"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is most likely suggestive of <strong>cafe coronary syndrome.</strong> Death in caf&eacute; coronary syndrome occurs due to <strong>parasympathetic overactivity.</strong> It is sudden and unexpected and happens rapidly.</p>\n<p>This is usually seen in well-built businessmen. In this syndrome, the victim dies <strong>during</strong> a <strong>meal</strong> with <strong>no signs</strong> of respiratory distress or classical signs of <strong>asphyxia</strong>.</p>\n<p>The <strong>cause of death</strong> in these patients is <strong>mechanical asphyxia</strong> leading to <strong>vasovagal reflex </strong>causing <strong>reflex cardiac inhibition</strong>.&nbsp;The <strong>mode of death</strong> is <strong>cardiac arrest</strong> (not the cause of death)&nbsp;presumably from parasympathetic overactivity occurring from <strong>stimulation</strong> of the <strong>laryngeal</strong> or pharyngeal mucosa.</p>\n<p><strong>Suppressed</strong> <strong>gag reflex</strong> due to gross <strong>intoxication</strong> with <strong>alcohol</strong> or large doses of <strong>tranquilizers</strong> in mental institutions or hospitals might be the predisposing factors. Autopsy reveals a<strong>&nbsp;bolus of food</strong>, lodged in the&nbsp;<strong>pharynx or larynx</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old lady was found dead with a ligature mark around her neck. Which among the following findings indicates death due to ligature strangulation?",
    "choices": [
      {
        "id": 1,
        "text": "A pale face with no petechiae"
      },
      {
        "id": 2,
        "text": "Bleeding from the nose and mouth"
      },
      {
        "id": 3,
        "text": "Dribbling of saliva from the mouth"
      },
      {
        "id": 4,
        "text": "Absence of fracture of thyroid cartilage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bleeding</strong> from the&nbsp;<strong>nose, mouth,</strong> and <strong>ears</strong> is commonly associated with death due to <strong>ligature strangulation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding laryngeal fractures in cases of strangulation is false?",
    "choices": [
      {
        "id": 1,
        "text": "The most common fracture is that of the thyroid horns"
      },
      {
        "id": 2,
        "text": "Damage to the larynx is more in ligature strangulation"
      },
      {
        "id": 3,
        "text": "The greater horns of hyoid is displaced medially"
      },
      {
        "id": 4,
        "text": "Lack of bleeding indicates postmortem fractures"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Damage</strong> to the <strong>laryngeal structures</strong> is <strong>more</strong> in <strong>manual</strong> strangulation than in ligature strangulation.</p>\n<p class=\"p1\">During manual strangulation the following structures are damaged:</p>\n<ul>\n<li class=\"p1\"><strong>Hyoid</strong> cornua or horns</li>\n<li class=\"p1\"><strong>Superior thyroid horns</strong></li>\n<li class=\"p1\"><strong>Cricoid</strong>&nbsp;cartilage</li>\n<li class=\"p1\">The main <strong>ala</strong> of the <strong>thyroid cartilage</strong></li>\n</ul>\n<p>It has been said that such direct violence from the front tends to splay the fractured horns laterally, whereas in<strong> manual strangulation </strong>the<strong> horn tends</strong> to<strong> fall medially.</strong></p>\n<p class=\"p1\">If there is <strong>no haemorrhage,</strong> the fracture must be <strong>post mortem</strong>. If there is a small bleed, then the lesion can be either antemortem or post-mortem. <strong>Large bleeds</strong> definitely indicate an <strong>antemortem</strong> fracture.</p>\n<p class=\"p1\"><strong>Damage</strong> to the <strong>laryngeal</strong> cartilages is much<strong> less common </strong>in<strong> ligature strangulation</strong>&nbsp;than in manual strangulation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the type of strangulation shown in this image called?",
    "choices": [
      {
        "id": 1,
        "text": "Burking"
      },
      {
        "id": 2,
        "text": "Garrotting"
      },
      {
        "id": 3,
        "text": "Lynching"
      },
      {
        "id": 4,
        "text": "Bansdola"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the <strong>tightening</strong> of a <strong>noose</strong> around the <strong>neck</strong> by twisting a rod within the <strong>ligature.</strong> This is called <strong>garrotting.&nbsp;</strong></p>\n<p>This is a mode of ligature strangulation that may be seen in homicide.</p>\n<p>This was a form of judicial execution once employed in <strong>Spain</strong>. The rod-like object used to tighten the ligature is called a&nbsp;<strong>Spanish windlass&nbsp;</strong>- this may be a ruler, stick, or screwdriver.&nbsp;The method was also used by Thagi&rsquo;s in the past in India, to kill the travelers and rob their belongings in lonely places.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/22dc85a0a4c544c3a3347568e6ecb363.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "While conducting an autopsy on a suspected case of death due to strangulation, which of the following methods is not followed?",
    "choices": [
      {
        "id": 1,
        "text": "Removal of the brain before dissection of the neck"
      },
      {
        "id": 2,
        "text": "Postmortem MRI of neck before dissection"
      },
      {
        "id": 3,
        "text": "X ray of the larynx before dissection"
      },
      {
        "id": 4,
        "text": "Incising the internal jugular vessles at the last"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Incising the <strong>internal jugular vessels early</strong> in the autopsy is done to relieve venous pressure, especially in cases where strangulation is suspected. This can help <strong>prevent</strong> <strong>artefactual</strong> <strong>haemorrhages</strong> that could otherwise complicate the interpretation of findings.\u00a0</p>\n<p>During an autopsy, it is <strong>essential to release the blood in the venous system</strong> before dissecting the neck to avoid or reduce artefactual haemorrhages that can occur in the region.</p>\n<p>The following methods are also followed while conducting the autopsy:\u00a0</p>\n<ul>\n<li>Reflect the scalp and remove the brain before dealing with the neck to release venous engorgement</li>\n<li><strong>Multislice spiral computed tomography (MSCT) </strong>and <strong>magnetic resonance imaging (MRI)</strong> or radiography of the neck may be carried out before dissecting.</li>\n<li>If the new techniques of post-mortem imaging are not available an alternative method is to <strong>X-ray</strong> the<strong> isolated larynx</strong> before dissection.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A homeless man was found dead and brought to the casualty. The autopsy findings showed a fracture of the thyroid cartilage, bruising and abrasions around the neck. What would be the cause of his death?",
    "choices": [
      {
        "id": 1,
        "text": "Hanging"
      },
      {
        "id": 2,
        "text": "Throttling"
      },
      {
        "id": 3,
        "text": "Strangulation"
      },
      {
        "id": 4,
        "text": "Garroting"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Both<strong> bruising around the neck</strong>&nbsp;and the<strong> fracture of the thyroid cartilage</strong>&nbsp;are findings seen in<strong> throttling.&nbsp;</strong></p>\n<p>Throttling/manual strangulation is when <strong>bare hands</strong> are used to <strong>compress</strong> the <strong>neck</strong> and strangulate.</p>\n<p>Mechanism of death:</p>\n<ul>\n<li><strong>Occlusion</strong> of blood vessels supplying blood to the brain (<strong>carotid arteries</strong>).</li>\n<li>Carotid sinus pressure may result in vagus nerve stimulation, resulting in cardiac arrest (<strong>vagal inhibition</strong>).</li>\n<li>Occlusion of the airway probably - a minor role</li>\n</ul>\n<p>Autopsy findings:</p>\n<ul>\n<li><strong>Bruising</strong> of the <strong>neck-</strong> due to the grasping of the neck by the assailant.</li>\n<li><strong>Abrasions</strong> on the neck- fingernail marks from assailant or victim.</li>\n<li><strong>Fracture</strong> of the <strong>thyroid cartilage.</strong></li>\n<li>Inward <strong>fracture</strong> of the greater cornu of the <strong>hyoid</strong> bone.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A person was brought dead and an autopsy was performed to find the cause of death. The following findings were noted on examination. What is the probable cause of death?",
    "choices": [
      {
        "id": 1,
        "text": "Throttling"
      },
      {
        "id": 2,
        "text": "Strangulation"
      },
      {
        "id": 3,
        "text": "Hanging"
      },
      {
        "id": 4,
        "text": "Mugging"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In throttling, the following mechanisms may lead to death:</p>\n<ul>\n<li><strong>Occlusion</strong> of\u00a0<strong>blood</strong>\u00a0<strong>supply</strong> to the blood to the brain - carotid arteries\u00a0</li>\n<li><strong>Occlusion</strong> of the <strong>airway</strong> - minor role</li>\n<li>Carotid sinus pressure may result in vagus nerve stimulation resulting in cardiac arrest (vasovagal shock)</li>\n</ul>\n<p>Other signs in deaths due to asphyxia:</p>\n<ul>\n<li><strong>Petechial hemorrhages</strong> in the face, eyebrows, eyelids, forehead, ears, conjunctiva, sclera\n<ul>\n<li>When they occur in the visceral pleura, they are called\u00a0<strong>Tardieu\u2019s spots</strong>\u00a0</li>\n</ul>\n</li>\n<li>Congested larynx with slight oozing</li>\n<li>Marked venous congestion of internal organs</li>\n<li>Emphysematous, congested\u00a0 lungs with serosanguinous fluid exudates in alveoli</li>\n<li>Dark-coloured blood due to accumulation of CO<sub>2</sub></li>\n</ul>\n<p>Option B: Strangulation is a very generalised term used to describe deaths due to violent asphyxia. Eg- ligature strangulation, throttling etc</p>\n<p>Option C:\u00a0 In the case of hanging, there will be a ligature mark, injury to the cervical spine etc.</p>\n<p>Option D: In case of mugging the neck is compressed or squeezed by holding it between the crook of the elbow or knee. The attack is usually made from behind. Though a victim killed by this method shows signs of asphyxia and other struggle marks, the examination neck will not show any evidence of violence, as the compression was affected by the soft muscles of the arm or leg.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d0767087b6fa4935bb58f486b34d63fd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f944dc10e22b4d44b1bb913836915e85x1280x1449.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33067fc16a6f4606a37dece50721e85ax1280x1449.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0fc45a99596a4d119139caa0c64ff201x1280x1449.JPEG"
    ]
  },
  {
    "text": "Police were investigating a serial killer who hangs his victims upside down which eventually led to their death. What is the most likely cause of death in these victims?",
    "choices": [
      {
        "id": 1,
        "text": "Suffocation"
      },
      {
        "id": 2,
        "text": "Traumatic asphyxia"
      },
      {
        "id": 3,
        "text": "Postural asphyxia"
      },
      {
        "id": 4,
        "text": "Mechanical asphyxia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In an inverted crucifixion, death occurs due to <strong>postural asphyxia.</strong></p>\n<p>In the case of inverted crucifixion, asphyxia occurs as a result of the impedance of inspiration by the weight of the abdominal viscera upon the diaphragm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Jack knife position causes death due to:",
    "choices": [
      {
        "id": 1,
        "text": "Wedging"
      },
      {
        "id": 2,
        "text": "Burking"
      },
      {
        "id": 3,
        "text": "Positional asphyxia"
      },
      {
        "id": 4,
        "text": "Traumatic asphyxia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Jack-knife position</strong>&nbsp;leads to&nbsp;<strong>positional asphyxia.</strong></p>\n<p>It is a position where the victim's thighs and knees are driven against the chest causing indirect compression of the chest and restriction of breathing movements.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A person was walking home from his work when suddenly a robber attacked him. They both started fighting and the robber held him from behind as shown in the image. During this, the victim lost his life due to difficulty in breathing. What is this type of strangulation known as?",
    "choices": [
      {
        "id": 1,
        "text": "Garrotting"
      },
      {
        "id": 2,
        "text": "Bansdola"
      },
      {
        "id": 3,
        "text": "Mugging"
      },
      {
        "id": 4,
        "text": "Burking"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Note:&nbsp;The original meaning of &lsquo;mugging&rsquo; has now been confused by its application, especially in North America, to any form of robbery with violence.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8a2ade635dd142dfb242167040ad9269.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e7d53599a8b48168b62ba588dc8d9dex1280x1713.JPEG"
    ]
  },
  {
    "text": "The weight of the head, arms and chest act as a constricting force in which of the following types of hanging?",
    "choices": [
      {
        "id": 1,
        "text": "Complete"
      },
      {
        "id": 2,
        "text": "Partial"
      },
      {
        "id": 3,
        "text": "Typical"
      },
      {
        "id": 4,
        "text": "Atypical"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The weight of the head, arms, and chest acts as a constricting force in <strong>partial hanging.</strong></p>\n<p>Types of hanging:</p>\n<ul>\n<li><strong>Complete</strong> hanging - the weight of the <strong>entire body</strong> acts as a <strong>constricting force.</strong></li>\n<li><strong>Partial </strong>hanging - the bodies are partially suspended, the weight of the <strong>head</strong> (5-6 kgs), <strong>arms,</strong> and <strong>chest</strong> act as a <strong>constricting force.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25826a41adce40d98ecff5c8e9ca8374x600x2775.JPEG"
    ]
  },
  {
    "text": "15 kg of tension in the ligature around the neck is enough to occlude which of the following structures?",
    "choices": [
      {
        "id": 1,
        "text": "Jugular vein"
      },
      {
        "id": 2,
        "text": "Jugular vein + Carotid artery"
      },
      {
        "id": 3,
        "text": "Jugular vein + Carotid artery + Trachea"
      },
      {
        "id": 4,
        "text": "Jugular vein + Carotid artery + Trachea + Vertebral artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>About <strong>15 kg</strong> of tension in the ligature around the neck <strong>occludes</strong> the <strong>jugular vein</strong>, <strong>carotid artery</strong> and <strong>trachea.</strong></p>\n<p>&nbsp;The force required to occlude the neck structures are as follows:</p>\n<ul>\n<li><strong>2 kg</strong>&nbsp;- occludes the&nbsp;<strong>jugular</strong>&nbsp;veins.</li>\n<li><strong>5 kg</strong>&nbsp;- occlude the<strong>&nbsp;jugular</strong> veins&nbsp;and<strong> carotid arteries</strong>.</li>\n<li><strong>15 kg </strong>- occludes the <strong>jugular</strong> veins, <strong>carotid</strong> arteries and&nbsp;<strong>trachea.</strong></li>\n<li><strong>30 kg</strong>&nbsp;- occludes the<strong>&nbsp;jugular</strong> veins, <strong>carotid</strong> arteries, <strong>trachea</strong> and <strong>vertebral arteries.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A victim of suicidal hanging is brought to you for examination. All the following lead to the death of this patient except-",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic neuronal death"
      },
      {
        "id": 2,
        "text": "Disruption of vertebral column"
      },
      {
        "id": 3,
        "text": "Laryngeal Spasm"
      },
      {
        "id": 4,
        "text": "Cardiac Arrest"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Causes of death in suicidal hangings are not from laryngeal&nbsp;spasms.</p>\n<p>Mechanisms of death in pressure on the neck:</p>\n<ul>\n<li>Airway occlusion</li>\n<li>Occlusion of the neck veins</li>\n<li>Occlusion of the carotid arteries</li>\n<li>Vagal cardiac arrest</li>\n</ul>\n<p>Death ultimately occurs from <strong>cerebral hypoxia and ischemic neuronal death</strong>.</p>\n<table style=\"height: 120px; width: 402px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 158px;\"><strong>Asphyxia</strong></td>\n<td style=\"width: 228px;\"><strong>Commonest mode of death</strong></td>\n</tr>\n<tr>\n<td style=\"width: 158px;\">Manual strangulation</td>\n<td style=\"width: 228px;\">Vagal cardiac arrest</td>\n</tr>\n<tr>\n<td style=\"width: 158px;\">Ligature strangulation</td>\n<td style=\"width: 228px;\">Asphyxia</td>\n</tr>\n<tr>\n<td style=\"width: 158px;\">Judicial hanging</td>\n<td style=\"width: 228px;\">Disruption of vertebral column&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The body of a person who committed suicide by hanging was brought to your casualty. Which of the following is an unlikely finding to be seen in this case?",
    "choices": [
      {
        "id": 1,
        "text": "The mark completely encircles the neck"
      },
      {
        "id": 2,
        "text": "The gap in the hanging mark indicates the point of suspension"
      },
      {
        "id": 3,
        "text": "The hanging mark is situated above the thyroid cartilage"
      },
      {
        "id": 4,
        "text": "The mark dries to a parchment like consistency postmortem"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hanging marks</strong> almost <strong>never completely encircles</strong> the <strong>neck</strong>&nbsp;unless a slipknot was used.</p>\n<p>The hanging mark has the following features:</p>\n<ul>\n<li>The <strong>point of suspension</strong> is indicated by a <strong>gap</strong> in the skin mark - This gap is usually seen at one or other side of the neck or at the center of the back of the neck. Much less often it is under the chin.</li>\n<li>It is <strong>situated higher above</strong> the <strong>thyroid cartilage - </strong>Being directly under the chin anteriorly, passing round beneath the jawbones and rising up at the sides or back of the neck to the usual gap under the knot.</li>\n<li>The <strong>mark</strong> may be abraded, brown, and dried to a<strong> parchment-like consistency</strong> <strong>after death</strong>.</li>\n<li>&nbsp;<strong>narrow red zone</strong> either above or below (or both sides) of the ligature mark - Due to displacement of blood laterally from under the zone of maximum pressure.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following findings will not be seen in suicidal hanging?",
    "choices": [
      {
        "id": 1,
        "text": "Absence of dribbling of saliva"
      },
      {
        "id": 2,
        "text": "Hypostasis involving hands and feet"
      },
      {
        "id": 3,
        "text": "Tears of the carotid artery"
      },
      {
        "id": 4,
        "text": "Ligature mark above the thyroid cartilage"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Dribbling of saliva</strong> will be seen in a case of <strong>suicidal hanging</strong>. This is considered as the <strong>surest sign</strong> of <strong>antemortem hanging</strong> as secretion of saliva is a vital function and it cannot occur after death.</p>\n<p>Autopsy findings in hanging:</p>\n<ul>\n<li><strong>Post-mortem hypostasis</strong>\u00a0is present in the legs and hands.</li>\n<li>Petechial haemorrhages - these are usually the exception, rather than the rule.</li>\n<li><strong>Ligature mark</strong> - above the thyroid cartilage, incomplete, parchment-like consistency</li>\n<li>Soft tissue haemorrhage may be seen.</li>\n<li>Laryngeal fractures - fractures of hyoid and thyroid may be seen.</li>\n<li><strong>Amussat sign</strong> - damage to intima and media of the carotid artery</li>\n<li><strong>Simon's sign</strong> - haemorrhages on the anterior aspects of intervertebral disks.</li>\n<li>Vertebral artery tears- The vertebral artery can show intimal tears, subintimal haemorrhages, and even rupture.</li>\n<li>A pale face is more commonly seen than congestion of the face.</li>\n<li><strong>Le facies sympathique </strong>- eyes remain open and pupils remain dilated due to compression of cervical sympathetic chain on the same side. It indicates antemortem hanging.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f6a4c3eec6344bcb96ba02b41e17a616x1279x1320.JPEG"
    ]
  },
  {
    "text": "A serial murderer has been sentenced to death by hanging. Where will the knot for the ligature be placed?",
    "choices": [
      {
        "id": 1,
        "text": "Between chin and ear"
      },
      {
        "id": 2,
        "text": "Below the chin"
      },
      {
        "id": 3,
        "text": "Occiput"
      },
      {
        "id": 4,
        "text": "Below the ear"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The knot in a case of\u00a0<strong>judicial hanging\u00a0</strong>is placed <strong>under</strong> the<strong> ear </strong>in India.\u00a0</p>\n<p>A legal death sentence is carried out by hanging the criminal. The face of the person is covered with a dark mask and he is made to stand on a platform above trapdoors</p>\n<p>A rope to allow a drop of five to seven meters according to the weight, build and age of the person, is looped around the neck, <strong>with the knot under the angle of the jaw. </strong></p>\n<p>Although placing the knot beneath the <strong>chin</strong> i.e, the submental position is said to be a more <strong>effective</strong> way, a knot at the angle of the jaw (below the ear) is the most widely practised method of judicial hanging in India</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The autopsy finding of a person who died due to hanging showed the presence of hemorrhages in the intervertebral disc of the lumbar spine. What are these called?",
    "choices": [
      {
        "id": 1,
        "text": "Victor's haemorrhage"
      },
      {
        "id": 2,
        "text": "Simon's haemorrhage"
      },
      {
        "id": 3,
        "text": "Robert's haemorrhage"
      },
      {
        "id": 4,
        "text": "Carl's haemorrhage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Simon&rsquo;s haemorrhage / Simon&rsquo;s sign / Simon&rsquo;s symptom is&nbsp;<strong>streaky haemorrhage</strong> on the<strong> anterior aspects</strong> of the<strong> intervertebral disc,</strong>&nbsp;particularly in the lower <strong>thoracic</strong> and <strong>lumbar spine.</strong> It is frequently observed in cases of <strong>hanging</strong>.</p>\n<p>Simon haemorrhage has been shown to occur also in the course of traumatic overextension of the spinal column, e.g. in traffic accidents or as a post-mortem artefact in decomposed bodies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Seminal stains are found near the penis on the legs of a victim brought to you for autopsy. These stains are an absolute indicator of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Autoerotic asphyxia"
      },
      {
        "id": 2,
        "text": "Any cause of asphyxia"
      },
      {
        "id": 3,
        "text": "Homicide following sexual activity"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">The finding of emission of <strong>semen</strong> at <strong>autopsy</strong> is a <strong>non-specific</strong> finding and does not indicate sexual activity or any particular mode of death.</p>\n<p class=\"p1\">The mere emission of semen found at autopsy does not confirm sexual activity in itself, as post-mortem discharge of semen from the meatus is common in any type of death, not only in asphyxia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following findings is not considered a spurious lesion in the neck, during an autopsy?",
    "choices": [
      {
        "id": 1,
        "text": "Haemorrhage on the posterior surface of the oesophagus"
      },
      {
        "id": 2,
        "text": "Haemorrhage on the anterior longitudinal ligament"
      },
      {
        "id": 3,
        "text": "Pale areas in the oesophageal mucosa causing banding"
      },
      {
        "id": 4,
        "text": "Haemorrhage over the front of larynx"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Bleeding over the front and sides of the larynx is usually genuine and not a spurious lesion.</p>\n<p>The following are the spurious haemorrhages that occur:</p>\n<ul>\n<li>The <strong>posterior</strong> surface of the <strong>oesophagus</strong></li>\n<li><strong>Anterior longitudinal ligament</strong> of the <strong>cervical</strong> spine</li>\n<li><strong>Banding of the oesophagus</strong>&nbsp;- pale areas in the mucosa caused by post-mortem hypostasis.</li>\n</ul>\n<p>Artefactual postmortem haemorrhage on the posterior surface of the oesophagus is called&nbsp;<strong>Prinsloo and Gordon artefact.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The friend and victim had alcohol and got into an argument over a common girlfriend, following which the friend kills the victim by sitting on his chest and covering his nose and mouth. This is an example of?",
    "choices": [
      {
        "id": 1,
        "text": "Burking"
      },
      {
        "id": 2,
        "text": "Smothering"
      },
      {
        "id": 3,
        "text": "Traumatic asphyxia"
      },
      {
        "id": 4,
        "text": "Overlaying"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option C:\u00a0<strong>Traumatic asphyxia</strong> results from respiratory arrest due to mechanical fixation of the chest, by a heavy substance or object. The normal movements of the chest wall are prevented. There is a gross compression of the chest and usually abdomen by a powerful force, due to which chest expansion and diaphragmatic lowering are prevented. For example stampede deaths, crushing by falls of the earth in coal mines, or earthquakes.</p>\n<p>Option D<strong>: Overlaying </strong>or <strong>compression suffocation</strong> results due to compression of the chest, so as to prevent breathing. It occurs when an intoxicated parent or other person shares a bed with an infant. The thoracic movements are limited and respiratory exchange is either reduced or completely prevented which leads to death. It is always accidental.</p>\n<p>Below image below shows overlaying.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ad75a64d3f54b83917733b45ce46e19x1280x1317.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d0ce4ac15db4030a3e2b38acbc8375ex1280x1789.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d375230c6deb44e4a3ee3e341a63027dx1280x1317.JPEG"
    ]
  }
];
        let quizName = '11 Mechanical Asphyxia';
        let hierarchy = ["Marrow", "qBank", "Forensic Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>