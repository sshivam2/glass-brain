<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 022 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following cells act as touch receptors?",
    "choices": [
      {
        "id": 1,
        "text": "Melanocytes"
      },
      {
        "id": 2,
        "text": "Keratinocytes"
      },
      {
        "id": 3,
        "text": "Langerhans cells"
      },
      {
        "id": 4,
        "text": "Merkel cells"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Merkel cells</strong> act as <strong>touch</strong> <strong>receptors</strong>.&nbsp;</p>\n<p>Merkel cells<strong> located in</strong> the <strong>basal layer</strong> of the <strong>epidermis</strong> and outer <strong>root sheath</strong> of some <strong>big hair follicles&nbsp;</strong>function as follows:</p>\n<ul>\n<li class=\"p1\">They act as<strong>&nbsp;slowly adapting mechanoreceptors </strong>in the skin&nbsp;that convey <strong>touch sensation</strong></li>\n<li class=\"p1\">They<strong> detect</strong> the <strong>directional deformation</strong> of the epidermis and <strong>hair movement</strong></li>\n<li class=\"p1\">They also sense <strong>sustained pressure</strong> and <strong>edges</strong> of applied objects on the skin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73d24aaf4425463da12a0d6221ea0de2x1080x854.JPEG"
    ]
  },
  {
    "text": "Which of the following hormones do not act on pancreas?",
    "choices": [
      {
        "id": 1,
        "text": "Secretin"
      },
      {
        "id": 2,
        "text": "Gastrin"
      },
      {
        "id": 3,
        "text": "Cholecystokinin"
      },
      {
        "id": 4,
        "text": "GIP"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Gastrin does not act upon the pancreas. Gastrin stimulates gastric acid secretion and gastric mucosal growth.</p>\n<p><strong>CCK:</strong></p>\n<p class=\"p1\">Stimulates:</p>\n<ul>\n<li class=\"p1\">Pancreatic enzyme secretion</li>\n<li class=\"p1\">Pancreatic bicarbonate secretion</li>\n<li class=\"p1\">Gallbladder contraction</li>\n<li class=\"p1\">Growth of exocrine pancreas</li>\n</ul>\n<p class=\"p1\">Inhibits:</p>\n<ul>\n<li>Gastric emptying</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old male has been diagnosed with a condition due to a DNA repair gene defect. He is having hyperpigmentation on the skin and high risk for the development of skin cancers as per the physician. Which of the following mechanisms is likely to be defective in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Nonhomologous End Joining Repair defect"
      },
      {
        "id": 2,
        "text": "Nucleotide Excision Repair defect"
      },
      {
        "id": 3,
        "text": "DNA Base Excision Repair defect"
      },
      {
        "id": 4,
        "text": "DNA Mismatch Repair defect"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above given clinical findings is suggestive of <strong>xeroderma pigmentosum</strong>.&nbsp;Xeroderma pigmentosum is an example of <strong>defective DNA nucleotide excision repair </strong>where there is an<strong> inability&nbsp;to repair DNA pyrimidine dimers </strong>caused by<strong> UV exposure.</strong></p>\n<p>Xeroderma Pigmentosum (XP) is a rare <strong>autosomal recessive</strong> genetic disorder characterized by defective DNA repair which leads to clinical and cellular <strong>hypersensitivity to ultraviolet radiation </strong>and other carcinogenic agents. &nbsp;</p>\n<p>Important <strong>clinical features</strong> are:</p>\n<p>Intense cutaneous photosensitivity, xerosis, poikiloderma, actinic keratosis, acute burning under minimal sun exposure, erythemas, hyperpigmented lentiginous macules, and malignant lesions in sun-exposed areas, including basocellular carcinoma, squamous cell carcinoma, and melanoma. &nbsp;</p>\n<p>The final diagnosis of XP can be confirmed by special laboratory tests by examining the DNA damage repair in cells from cultures exposed to ultraviolet radiation. The most common tests are <strong>skin biopsy</strong> and <strong>culture of skin fibroblasts</strong>. &nbsp;</p>\n<p>There is <strong>no cure</strong> for XP. Treatment consists of minimizing exposure to sunlight and regular dermatological care, as well as surgery for recurrent tumors excision. Patients should be <strong>followed up every 3 months</strong>.</p>\n<p><strong>Genetic counseling</strong> is important in a family that has an affected child and is considering having more children.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The biochemical form of amyloid in haemodialysis associated amylodosis is",
    "choices": [
      {
        "id": 1,
        "text": "AL"
      },
      {
        "id": 2,
        "text": "AA"
      },
      {
        "id": 3,
        "text": "A\u03b22m"
      },
      {
        "id": 4,
        "text": "ATTR"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hemodialysis-Associated Amyloidosis.</strong></p>\n<p>Patients on long term hemodialysis for renal failure can develop amyloidosis as a result of deposition <strong>of </strong><strong>&beta;2-microglobulin.</strong></p>\n<p>This protein is present in high concentrations in the serum of persons with renal disease.</p>\n<p><strong>Patients sometimes presented with carpal tunnel syndrome because of &beta;2-microglobulin deposition.</strong></p>\n<p></p>\n<table style=\"width: 363px;\">\n<tbody>\n<tr>\n<td style=\"width: 196px;\"><strong>Biochemical form of amyloid</strong></td>\n<td style=\"width: 158px;\"><strong>Clinicopathological category</strong></td>\n</tr>\n<tr>\n<td style=\"width: 196px;\"><strong>Systemic amyloidosis</strong></td>\n<td style=\"width: 158px;\"><strong>&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Immunocyte dyscrasias with amyloidosis (primary amyloidosis)</td>\n<td style=\"width: 158px;\">AL</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Reactive systemic amyloidosis (secondary amyloidosis)</td>\n<td style=\"width: 158px;\">AA</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Hemodialysis-associated amyloidosis</td>\n<td style=\"width: 158px;\">A&beta;2m</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\"><strong>Hereditary amyloidosis</strong></td>\n<td style=\"width: 158px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Familial Mediterranean fever</td>\n<td style=\"width: 158px;\">AA</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Familial amyloidotic neuropathies</td>\n<td style=\"width: 158px;\">ATTR</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Systemic senile amyloidosis</td>\n<td style=\"width: 158px;\">ATTR</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\"><strong>Localised</strong></td>\n<td style=\"width: 158px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Senile cerebral</td>\n<td style=\"width: 158px;\">A&beta;</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Medullary carcinoma of thyroid0</td>\n<td style=\"width: 158px;\">A Cal</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Islets of Langerhans</td>\n<td style=\"width: 158px;\">AIAPP</td>\n</tr>\n<tr>\n<td style=\"width: 196px;\">Isolated atrial amyloidosis</td>\n<td style=\"width: 158px;\">AANF</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms is seen in the given gram stain image?",
    "choices": [
      {
        "id": 1,
        "text": "Corynebacterium diphtheriae"
      },
      {
        "id": 2,
        "text": "Staphylococcus epidermidis"
      },
      {
        "id": 3,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 4,
        "text": "Streptococcus pneumoniae"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The gram stain shows<strong> gram-positive, club-shaped rods,</strong>&nbsp;which indicate&nbsp;<strong><em>Corynebacterium diphtheriae</em>.</strong></p>\n<p><strong>Clinical correlate:</strong></p>\n<ul>\n<li><strong>Diphtheria toxin</strong> is absorbed into the mucous membrane causing destruction of epithelium leading to <strong>pseudomembrane formation, myocarditis and tubular necrosis in kidneys.</strong></li>\n<li>In\ufb02ammation begins in the respiratory tract causing a sore throat and low-grade fever. Dyspnea soon follows because of the obstruction caused by the membrane.</li>\n</ul>\n<p>&nbsp;</p>\n<p>The following image shows <em>Staphylococcus</em> (gram-positive cocci) in clusters:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7ccc5680e1ea4cbbb48151fdf4242915.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/927a4a5645b449cb9238a04e72dc89b7x500x375.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0712cc919104480c9d2c66667071db05x1045x643.JPEG"
    ]
  },
  {
    "text": "A child presented with history of ingestion of unknown plant and developed mydriasis, tachycardia, dry mouth, warm skin and delirium. Which of the following group of drugs is likely to be responsible for the symptoms of child ?",
    "choices": [
      {
        "id": 1,
        "text": "Anticholinergic"
      },
      {
        "id": 2,
        "text": "Sympathomimetic"
      },
      {
        "id": 3,
        "text": "Opioid"
      },
      {
        "id": 4,
        "text": "Benzodiazepine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Mydriasis, tachycardia, dry mouth, warm (hot) skin and delirium are classical symptoms of anticholinergic overdose.&nbsp;Anticholinergic is the more appropriate option here considering the classical symptoms following the ingestion of unknown plants that can more likely be containing <strong>belladonna alkaloids</strong>.<strong> Physostigmine</strong> is the<strong> drug of choice </strong>for the treatment of <strong>atropine and belladona poisoning.</strong></p>\n<p>Sympathomimetics can cause mydriasis and tachycardia. Delirium is rare and hyperthermia can be seen secondarily to increased agitation and aggressive moments. They are unlikely to present with dry mouth. But the answer can also be sympathomimetic as dry mouth cannot be a differentiating factor. (Option B)</p>\n<p><strong>Opioid overdose</strong> results in <strong>miosis</strong> and other symptoms are not suggestive of opioid overdose (Option C).</p>\n<p><strong>Benzodiazepine</strong> causes <strong>CNS depression</strong> and changes in pupil diameter are highly unlikely with its overdose (Option D).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/90d79c493d094b8f939b8c5733497a51x1280x2559.JPEG"
    ]
  },
  {
    "text": "Identical twins have similarities in all except :",
    "choices": [
      {
        "id": 1,
        "text": "Blood group"
      },
      {
        "id": 2,
        "text": "DNA fingerprinting"
      },
      {
        "id": 3,
        "text": "Fingerprint pattern"
      },
      {
        "id": 4,
        "text": "Iris colour"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fingerprint pattern <strong>differs</strong> in identical twins.</p>\n<p>The pattern of the fingerprint comprises arches, loops, whorls or combinations of these three patterns, this is unique to every individual and does not match even for identical twins.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient complains that he feels like the room is spinning when he gets up from lying down or when he turns his head. He has no history of loss of consciousness. Which of the following could be the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Benign paroxysmal positional vertigo (BPPV)"
      },
      {
        "id": 2,
        "text": "Meniere's disease"
      },
      {
        "id": 3,
        "text": "Labyrinthitis"
      },
      {
        "id": 4,
        "text": "Syncope"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Based on the symptoms the most probable diagnosis is Benign paroxysmal positional vertigo(BPPV).</p>\n<ul>\n<li style=\"font-weight: 400;\">BPPV is one of the common causes of recurrent vertigo and the episodes are <strong>brief (&lt;1min)</strong> and are always <strong>provoked by changes in head position</strong>.</li>\n<li style=\"font-weight: 400;\">The attacks are caused by free-floating calcium carbonate crystals usually dislodged from the posterior canal.</li>\n<li style=\"font-weight: 400;\"><strong>Epleys maneuver</strong> is done to reposition the crystals into the macula from the semicircular canals.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following ocular lesions are seen in gout?",
    "choices": [
      {
        "id": 1,
        "text": "Episcleritis"
      },
      {
        "id": 2,
        "text": "Scleritis"
      },
      {
        "id": 3,
        "text": "Uveitis"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ocular manifestations seen in gout are episcleritis, scleritis, and uveitis.</p>\n<p>There is <strong>deposition of uric acid</strong> in the cornea, conjunctiva,&nbsp;and sclera.</p>\n<div class=\"page\" title=\"Page 3\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ocular structures have relatively poor solvent ability, in addition to lower temperatures, and therefore, they are predisposed to tophi deposition.</p>\n<p>As a result of urate deposits, <strong>crystal-induced inflammation of the affected tissue</strong> is responsible for causing episcleritis, scleritis,&nbsp;and uveitis.</p>\n</div>\n</div>\n</div>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Primaquine is contraindicated in______",
    "choices": [
      {
        "id": 1,
        "text": "Pregnancy"
      },
      {
        "id": 2,
        "text": "G-6PD deficiency"
      },
      {
        "id": 3,
        "text": "Infants"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Primaquine is contraindicated in <strong>pregnancy, infants and G6PD deficient patients</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The syndromic management of urethral discharge includes the treatment of_______",
    "choices": [
      {
        "id": 1,
        "text": "Neisseria gonorrhoeae and herpes genitalis"
      },
      {
        "id": 2,
        "text": "Chlamydia trachomatis and herpes genitalis"
      },
      {
        "id": 3,
        "text": "Neisseria gonorrhoeae and chlamydia trachomatis"
      },
      {
        "id": 4,
        "text": "Syphillis and chancroid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Syndromic management of urethral discharge in males involves the treatment of gonorrhea and chlamydial infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vaccines is not included in the Intensified Mission Indradhanush Scheme?",
    "choices": [
      {
        "id": 1,
        "text": "Rota virus vaccine"
      },
      {
        "id": 2,
        "text": "Japanese Encephalitis vaccine"
      },
      {
        "id": 3,
        "text": "Pneumococcal conjugate vaccine"
      },
      {
        "id": 4,
        "text": "Typhoid vaccine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Typhoid vaccine is not a part of the Intensified Mission Indradhanush scheme.&nbsp;</p>\n<p>The Intensified Mission Indradhanush has been introduced to ensure full immunization (more than 90%) by&nbsp;<strong>December 2018</strong>. It now includes <strong>12 vaccine preventable diseases</strong> (updated from the 7 VPDs that Mission Indradhanush focussed on). <strong>4 rounds of immunisation</strong> are proposed to be held for <strong>7 days each month</strong> (from the 7th-13th of each month). The diseases are:</p>\n<ul>\n<li>TB</li>\n<li>Polio</li>\n<li>Hep B</li>\n<li>Diphtheria</li>\n<li>Pertusis</li>\n<li>Tetanus</li>\n<li>Measles</li>\n</ul>\n<p>And included recently:</p>\n<ul>\n<li>Rotavirus diarrhoea</li>\n<li>Rubella (as MR vaccine)</li>\n<li>H. influenzae B diseases (as part of the pentavalent vaccine)</li>\n<li>Pneumococcal meningitis</li>\n<li>Japanese Encephalitis</li>\n</ul>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e35e514a661e4827be330f58fad8e4fcx647x404.JPEG"
    ]
  },
  {
    "text": "What is the GCS of a patient with a head injury who opens her eyes in response to a loud voice, localizes pain, and is confused and disoriented?",
    "choices": [
      {
        "id": 1,
        "text": "E3M5V4"
      },
      {
        "id": 2,
        "text": "E3M6V5"
      },
      {
        "id": 3,
        "text": "E4M4V5"
      },
      {
        "id": 4,
        "text": "E3M5V5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this patient GCS is&nbsp;<strong>E3M5V4</strong></p>\n<p>Eye-opening to loud voice-3</p>\n<p>Motor response localizes pain-5</p>\n<p>&nbsp;Verbal response is confused and disoriented-4</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with a prolonged fever for 2 weeks and new-onset seizures. Transthoracic echocardiography (TTE) obtained on admission showed a 1.5 cm vegetation on the tricuspid valve. Multiple painless skin lesions are present on the hands as shown in the image below. What are these lesions called?",
    "choices": [
      {
        "id": 1,
        "text": "Osler\u2019s node"
      },
      {
        "id": 2,
        "text": "Janeway lesion"
      },
      {
        "id": 3,
        "text": "Roth's spot"
      },
      {
        "id": 4,
        "text": "Pink rim rashes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The skin lesions shown in the image are&nbsp;<strong>Janeway lesions. </strong>They are <strong>non-tender</strong>, erythematous or hemorrhagic macular or nodular lesions, which are present on the palms or soles.</p>\n<p>Patients with infective endocarditis can have cardiac or non-cardiac manifestations.</p>\n<p>Cardiac manifestations of IE:</p>\n<ul>\n<li>Presence of&nbsp;<strong>new regurgitant murmurs</strong></li>\n<li><strong>Congestive heart failure</strong>&nbsp;due to valve dysfunction</li>\n<li>Perivalvular abscesses and intracardiac fistulae- This is caused due to the extension of infection beyond the valves and into the adjacent myocardial tissue</li>\n<li>Conduction system defects- due to the damage of the interventricular septum by the abscess.</li>\n<li>Embolization of coronary arteries</li>\n</ul>\n<p>Noncardiac manifestations of IE are:</p>\n<ul>\n<li><strong>Arterial emboli-&nbsp;</strong>causing pain of ischemia of the organs</li>\n<li><strong>Osler's nodes</strong>-are <strong>painful</strong>, <strong>red</strong>, nodular lesions usually located in the pads of the fingers and toes</li>\n<li><strong>Roth's spots</strong>- retinal hemorrhages with a pale center</li>\n<li><strong>Janeway lesions-&nbsp;</strong>In contrast to Osler's nodes, these are faint, red, <strong>painless</strong> macules on palms and soles. They occur as a result of septic embolization and are commonly associated with staphylococcal IE.</li>\n<li>Glomerulonephritis</li>\n<li>Positivity for<strong>&nbsp;rheumatoid factor</strong></li>\n<li>Petechiae on oral and conjunctival mucosa</li>\n<li>Splinter subungual haemorrhages-painless, dark red lines in the nailbed.</li>\n<li>Mycotic aneurysms</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9e5b9e328f9a4854941dbb69ffe8e003.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3d63edfc18c4f9f94efcc959cf489eex600x468.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cf5ec365ee3472488fbff96ed832bf2x768x1024.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11f090868c9b4d408151ffb0142b228dx720x548.JPEG"
    ]
  },
  {
    "text": "A 65-year-old woman came with complaints of headache for 1 month. She also reports aching of the jaw during her meals. Over the last week, she has experienced episodes of painless visual loss which lasts for around 10 minutes. Which will be the best investigation for the diagnosis of the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Temporal artery biopsy"
      },
      {
        "id": 2,
        "text": "Colour Doppler of Temporal artery"
      },
      {
        "id": 3,
        "text": "CT angiography"
      },
      {
        "id": 4,
        "text": "MR angiography"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of giant cell arteritis. The best investigation for the diagnosis of giant cell arteritis is <strong>temporal artery biopsy</strong>.</p>\n<p>Histopathology shows panarteritis with the presence of mononuclear cells and giant cells.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old man presents to the clinic with a non-specific history of malaise. Mild sensorineural hearing loss had been diagnosed during his early education, although hearing aids were not required. He gives a history of recurrent hematuria and current investigations reveal the same. What is the most likely diagnosis among the following?",
    "choices": [
      {
        "id": 1,
        "text": "Fanconi\u2019s anemia"
      },
      {
        "id": 2,
        "text": "Alport syndrome"
      },
      {
        "id": 3,
        "text": "Autosomal dominant polycystic kidney disease"
      },
      {
        "id": 4,
        "text": "IgA nephropathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Alport syndrome</strong> is the most likely diagnosis. Alport syndrome is a cause of <strong>recurrent hematuria</strong>, which is associated with <strong>sensorineural hearing loss.</strong></p>\n<p><strong>&nbsp;Other causes of recurrent hematuria</strong></p>\n<ul>\n<li>Alport syndrome</li>\n<li>IgA nephropathy</li>\n<li>Autosomal dominant polycystic kidney disease (ADPKD)</li>\n<li>Papillary necrosis</li>\n<li>Renal cell carcinoma&nbsp; &nbsp; &nbsp;&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients with confirmed sialolithiasis, what is the most common location of stone formation?",
    "choices": [
      {
        "id": 1,
        "text": "Parotid gland"
      },
      {
        "id": 2,
        "text": "Minor salivary glands"
      },
      {
        "id": 3,
        "text": "Submandibular gland"
      },
      {
        "id": 4,
        "text": "Sublingual gland"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The&nbsp;<strong>most common site</strong> for salivary gland stone formation is the&nbsp;<strong>submandibular gland</strong>&nbsp;due to highly viscous&nbsp;secretions.&nbsp;</p>\n<p>80% of<strong> submandibular </strong>stones are<strong> radio-opaque, </strong>while <strong>parotid duct </strong>stones are usually <strong>radiolucent</strong> and rarely visible on plain radiography.&nbsp;Parotid gland<strong> sialography</strong> is usually required to identify the stone. A stone located in the collecting duct or within the gland may be managed by either <strong>endoscopic retrieval </strong>or<strong> lithotripsy</strong>; in rare cases, surgical removal via a parotidectomy approach may be required.</p>\n<p>&nbsp;The below USG image shows a stone in the Wharton duct of the submandibular gland.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d49dd0e04d44facbdc8910d29aa1f4ax781x575.JPEG"
    ]
  },
  {
    "text": "In a patient with critical limb ischemia, what is the ankle-brachial pressure index (ABPI) likely to be?",
    "choices": [
      {
        "id": 1,
        "text": "< 0.1"
      },
      {
        "id": 2,
        "text": "< 0.3"
      },
      {
        "id": 3,
        "text": "< 0.5"
      },
      {
        "id": 4,
        "text": "< 0.9"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a patient with critical limb ischemia, the ABPI is\u00a0<strong>&lt; 0.3.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman presents to the clinic with a history of greenish discharge from the nipple for the past 1 month. Personal history is significant for cigarette smoking. On compression of her breast, greenish discharge from multiple ducts was observed. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Duct ectasia"
      },
      {
        "id": 2,
        "text": "Intraductal papilloma"
      },
      {
        "id": 3,
        "text": "Intraductal carcinoma"
      },
      {
        "id": 4,
        "text": "Paget's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis of a patient with greenish discharge from multiple ducts is<strong> duct ectasia.&nbsp;</strong></p>\n<p>Duct ectasia is the dilatation of breast ducts. It is the most common cause of nipple discharge in nonlactating women. This condition is associated with <strong>smoking</strong> and diabetes.</p>\n<p>The initial stage of this disease consists of dilatation of one or more lactiferous ducts. These ducts get filled with stagnant brown or <strong>green colored</strong> secretions. In the later stages, the accumulation of fluid in the lactiferous ducts leads to infection and inflammation, causing <strong>periductal mastitis</strong>. The infections are most often mixed infections of aerobic and anaerobic flora of the skin.</p>\n<p>Patients may present with nipple discharge, abscess, fistula or nipple retraction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following renal stones is not formed in acidic urine?",
    "choices": [
      {
        "id": 1,
        "text": "Uric acid stone"
      },
      {
        "id": 2,
        "text": "Struvite stone"
      },
      {
        "id": 3,
        "text": "Cystine stone"
      },
      {
        "id": 4,
        "text": "Oxalate stone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Struvite stone is produced in <strong>alkaline urine</strong>, especially when urea-splitting <strong>proteus </strong>organisms are present.</p>\n<ul>\n<li>Struvite is a <strong>triple</strong>-<strong>phosphate calculus </strong>(<strong>calcium</strong> phosphate often with <strong>ammonium magnesium</strong> phosphate), grossly smooth in texture, and dirty-white in color.</li>\n<li>The calculus may enlarge to fill most of the collecting system, forming a <strong>stag-horn calculus.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman complained of excessive vomiting and mild vaginal bleeding for 2 weeks at a period of gestation of 14 weeks. On examination, fundal height corresponds to 16 weeks and fetal heart sound is absent.  USG shows the presence of a snowstorm appearance. What is the management____",
    "choices": [
      {
        "id": 1,
        "text": "Chemotherapy"
      },
      {
        "id": 2,
        "text": "Hysterectomy"
      },
      {
        "id": 3,
        "text": "Suction and evacuation/curettage"
      },
      {
        "id": 4,
        "text": "Hysterotomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>molar pregnancy</strong> and regardless of uterine size, molar evacuation by <strong>suction and curettage</strong> is usually the preferred treatment.&nbsp;</p>\n<p>With large moles, adequate anesthesia, sufficient intravenous access, and blood-banking support are imperative.</p>\n<p><strong>Intraoperative sonography</strong> is recommended to help ensure that the <strong>uterine cavity has been emptied</strong>.</p>\n<p>Indication for hysterectomy in molar pregnancy:</p>\n<ul>\n<li>Preferred for women who have completed their family.</li>\n<li>In women &gt;40 years, who are at high risk for GTN.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old female patient was undergoing diagnostic dilatation and curettage. The instrument given below is used to expose the cervix prior to cervical dilatation. Identify the given instrument.",
    "choices": [
      {
        "id": 1,
        "text": "Sims' speculum"
      },
      {
        "id": 2,
        "text": "Cusco's speculum"
      },
      {
        "id": 3,
        "text": "Auvard's speculum"
      },
      {
        "id": 4,
        "text": "Doyen's retractor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The instrument shown in the image is <strong>Sims' speculum.</strong></p>\n<div class=\"page\" title=\"Page 97\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The Sims&rsquo; vaginal speculum with an anterior vaginal wall retractor can be used for <strong>examination</strong> of the <strong>cervix.</strong> This is used to&nbsp;expose the cervix prior to cervical dilatation. It is used for the assessment of the vaginal wall for <strong>cystocele</strong> and <strong>rectocele.</strong>&nbsp;</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cf12d1efb465411785a9ae0a0f5fcb62.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d424f609296484f8e87f0ec5ed8924cx1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1667cfb8089e42148ea1f463da3b7fa9x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a33a196dcb14117b6124eae8f392831x360x271.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c05d44bb16d54e50b2bca9105df4478cx1279x1116.JPEG"
    ]
  },
  {
    "text": "A 28-year-old primigravida had pre-pregnancy BMI of 30 kg/msq. What is the recommended weight gain in obese women during their pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "5-7 Kg"
      },
      {
        "id": 2,
        "text": "8-11 Kg"
      },
      {
        "id": 3,
        "text": "10-13 Kg"
      },
      {
        "id": 4,
        "text": "14-16 Kg"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The recommended weight gain the above case <strong>is not more than</strong> <strong>7 Kg.</strong></p>\n<p>Ideally weight gain should depend on the pre-pregnancy body mass index (BMI) level.</p>\n<table>\n<tbody>\n<tr>\n<td>\n<p>Category</p>\n</td>\n<td>\n<p>BMI</p>\n</td>\n<td>\n<p>Recommended weight gain</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Underweight</p>\n</td>\n<td>\n<p>&lt;18.5</p>\n</td>\n<td>\n<p>12.5&ndash;18 kg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Normal</p>\n</td>\n<td>\n<p>18.5&ndash;24.9</p>\n</td>\n<td>\n<p>11.5&ndash;14 kg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Overweight</p>\n</td>\n<td>\n<p>25&ndash;29.9</p>\n</td>\n<td>\n<p>7&ndash;11.5 kg</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Obese</p>\n</td>\n<td>\n<p>&gt;30</p>\n</td>\n<td>\n<p>7 kg</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following pathogens is responsible for the largest fraction of deaths due to gastroenteritis in children less than 5 years?",
    "choices": [
      {
        "id": 1,
        "text": "Norwalk virus"
      },
      {
        "id": 2,
        "text": "Rotavirus"
      },
      {
        "id": 3,
        "text": "Clostridium difficile"
      },
      {
        "id": 4,
        "text": "Shigella dysenteriae"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Rotavirus </strong>is the most common identifiable <strong>viral cause</strong> of gastroenteritis in children. It accounts for <strong>29% of deaths caused by diarrhea</strong> in children aged&nbsp;<strong>&lt; 5 years.</strong></p>\n<ul>\n<li>Most common cause of bacterial diarrhea : Enterotoxigenic E.Coli&nbsp;</li>\n<li>Most common cause of dysentry : Shigella flexneri</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A throw ball player presents to the emergency room with pain over the shoulder, arm abducted and externally rotated and loss of sensation over the proximal lateral aspect of the arm. Which of the following nerve injuries is likely associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lateral cutaneous nerve of arm"
      },
      {
        "id": 2,
        "text": "Radial nerve"
      },
      {
        "id": 3,
        "text": "Axillary nerve"
      },
      {
        "id": 4,
        "text": "Musculocutaneous nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical presentation is suggestive of anterior dislocation of shoulder. The most common nerve injured in these cases is the <strong>axillary nerve </strong>as it winds around the humerus.<strong><br /></strong></p>\n<p>In axillary nerve injury, there is loss of sensation over a small part of the deltoid region in upper arm (<strong>regimental badge area</strong>) and weakness in abduction (15-90 degress) due to denervation of deltoid. Overhead abduction is unaffected as it is the function of serratus anterior and trapezius muscles.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The Money bag heart is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Pericardial effusion"
      },
      {
        "id": 2,
        "text": "TGA"
      },
      {
        "id": 3,
        "text": "TOF"
      },
      {
        "id": 4,
        "text": "Pulmonary hypertension"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The Money bag heart is seen in <strong>pericardial</strong> <strong>effusion.</strong></p>\n<p>Plain PA chest X-ray shows an enlarged cardiac silhouette. There is <strong>effacement of the normal cardiac borders</strong>, development of a <strong>&lsquo;flask&rsquo;</strong> or &lsquo;<strong>water bottle&rsquo;</strong> cardiac configuration and bilateral hilar overlay which are features of pericardial effusion. It is also known as <strong>Money bag</strong> or <strong>leather bottle</strong>-shaped heart.</p>\n<p>Investigation of choice: <strong>Echocardiography</strong>.</p>\n<p>Signs on plain radiograph include:</p>\n<ul>\n<li>Globular enlargement of the cardiac shadow giving a&nbsp;<strong>water bottle</strong> configuration.</li>\n<li>Lateral CXR may show a vertical opaque line (pericardial fluid)&nbsp;separating a vertical lucent line directly behind the sternum (paracardial fat) anteriorly from a similar lucent vertical lucent line (epicardial fat) posteriorly; this is known as the&nbsp;<strong>Oreo cookie sign.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e6f2a2cf936b432b9bd736651e98ef7e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c68fa0f4530d4a3cbf4a9615efd01e98x1024x1024.PNG"
    ]
  },
  {
    "text": "Dialectical behaviour therapy is used in the management of?",
    "choices": [
      {
        "id": 1,
        "text": "Borderline personality disorder"
      },
      {
        "id": 2,
        "text": "Avoidant personality disorder"
      },
      {
        "id": 3,
        "text": "Narcissistic personality disorder"
      },
      {
        "id": 4,
        "text": "Antisocial personality disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Dialectical behaviour therapy (DBT)</strong>&nbsp;is used in the management of borderline personality disorder.</p>\n<p>It is a form of psychotherapy, which is the treatment of choice in borderline personality disorder. DBT is used especially for those with <strong>parasuicidal behavior</strong>, such as frequent cutting.</p>\n<p>Patients are seen weekly, to improve interpersonal skills and decrease self-destructive behavior using techniques involving advice, metaphor, storytelling, and confrontation.</p>\n<p>Other modalities of treatment include:</p>\n<ul>\n<li><strong>Mentalization-based treatment.</strong></li>\n<li><strong>Transference-focused psychotherapy</strong>.</li>\n<li>Drugs &ndash; antipsychotics, antidepressants (SSRI, TCA), and mood-stabilizing drugs.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The image shown below is the technique of insertion of?",
    "choices": [
      {
        "id": 1,
        "text": "Oropharyngeal airway"
      },
      {
        "id": 2,
        "text": "Nasopharyngeal airway"
      },
      {
        "id": 3,
        "text": "Laryngeal mask airway"
      },
      {
        "id": 4,
        "text": "Endotracheal tube"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shown above is the technique of insertion of laryngeal mask airway.</p>\n<p><strong>Laryngeal mask airway</strong> (LMA) is a supraglottic airway device that is positioned in the <strong>hypopharynx</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/881aac0becac4d21a5783d8c7ba9f929.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f1a5205e27954a4bb7131cda0f1499fex1280x1146.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f35153982f349149033f4199470e9efx1280x2807.JPEG"
    ]
  },
  {
    "text": "A 40-year-old woman presents with flaccid bullae over the mucosa and skin and oral ulcers. Histopathology shows a suprabasal acantholytic blister with superficial dermal infiltration by lymphocytes, macrophages, and eosinophils. Direct immunofluorescence for immunoglobulin IgG is as seen below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pemphigus vulgaris"
      },
      {
        "id": 2,
        "text": "Bullous pemphigoid"
      },
      {
        "id": 3,
        "text": "Dermatitis herpetiformis"
      },
      {
        "id": 4,
        "text": "Epidermolysis bullosa"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Flaccid bullae, oral ulcers, suprabasal acantholytic blisters and fish net appearance on immunofluorescence are characteristic of <strong>Pemphigus vulgaris.</strong></p>\n<p>The above image&nbsp;shows deposition of immunoglobulin along the plasma membrane of keratinocytes in a <strong>reticular&nbsp;or fish net-like pattern</strong> accompanied by suprabasalar loss of cell-to-cell adhesion <strong>(acantholysis).</strong></p>\n<p><strong>Pemphigus</strong> is a blistering disorder caused by autoantibodies that result in the dissolution of intercellular attachments within the epidermis and mucosal epithelium<strong>.</strong></p>\n<p><strong>Variants: </strong></p>\n<p>(1) Pemphigus vulgaris</p>\n<p>(2) pemphigus vegetans</p>\n<p>(3) pemphigus foliaceus:&nbsp;Autoantibodies are against <strong>Dsg1 alone, </strong>leading to superficial, <strong>subcorneal blisters</strong>.</p>\n<p>(4) pemphigus erythematosus</p>\n<p>(5) paraneoplastic pemphigus: in association with various malignancies, most commonly <strong>non-Hodgkin lymphoma</strong></p>\n<p><strong>Pemphigus vulgaris</strong></p>\n<ul>\n<li>Most common type of pemphigus</li>\n<li>Involves the mucosa and skin</li>\n<li>Autoantibodies against <strong>Desmoglein 1 and 3</strong></li>\n<li><strong>Histology: Suprabasal </strong>acantholytic blister leaving behind&nbsp;single layer of intact basal cells:<strong> the row of tombstones appearance</strong></li>\n<li>Direct immunofluorescence:<strong>&nbsp;A fish net-like pattern of intercellular IgG deposits.</strong>&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ba0c798acc034b4697a160051e6fdc20.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following compounds are used in PET scan?",
    "choices": [
      {
        "id": 1,
        "text": "Fluorodeoxyglucose"
      },
      {
        "id": 2,
        "text": "Technetium"
      },
      {
        "id": 3,
        "text": "Chromium"
      },
      {
        "id": 4,
        "text": "Cobalt"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>PET involves the use of a radiolabelled bio compound - 2-fluoro-2-deoxy-D-glucose (FDG) which is injected intravenously. It is based on the principle that tumour cells have a <strong>high metabolic rate.</strong>&nbsp;FDG is metabolised to FDG-6-phosphate which cannot be further metabolised by tumour cells, and hence it <strong>accumulates and concentrates in tumour cells.&nbsp;</strong>This <strong>accumulation is detected and quantified.</strong></p>\n<p><strong>Applications of PET :-</strong></p>\n<p>Oncologic:</p>\n<ul>\n<li>Detection, staging, drug response</li>\n<li>Differentiation between radiation necrosis and recurrence</li>\n</ul>\n<p>&nbsp;Neurologic:</p>\n<ul>\n<li>Early diagnosis of Alzheimer's disease</li>\n<li>Localisation of seizure focus in interictal phase</li>\n<li>Localising eloquent areas (e.g. speech, motor function)</li>\n</ul>\n<p>Cardiac: Identification of hibernating myocardium</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Fmge Mini Test - 022';
        const quizFilename = 'fmge-mini-test-022-079ba4e3.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>