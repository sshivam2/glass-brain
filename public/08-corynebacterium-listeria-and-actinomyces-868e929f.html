<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>08 Corynebacterium, Listeria And Actinomyces - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A father brought his 9-year-old unimmunized child to the pediatric OPD with complaints of fever, sore throat and difficulty in swallowing. The findings of oropharyngeal examination are shown in the image below. Which of the following is the most likely causative organism of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gram-negative diplococci"
      },
      {
        "id": 2,
        "text": "Spiral gram-negative bacteria"
      },
      {
        "id": 3,
        "text": "Club-shaped gram-positive bacilli"
      },
      {
        "id": 4,
        "text": "Gram-positive cocci in chains"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Other options:\u00a0</p>\n<p>Option A: Gram-negative diplococci\u00a0describes <strong><em>Neisseria menigitidis </em></strong>and<strong><em> N. gonorrhoeae.\u00a0</em></strong></p>\n<p>Option C: Spiral gram-negative bacteria describes <strong><em>Campylobacter spp.</em></strong> and <em><strong>Helicobacter spp.</strong>.</em></p>\n<p>Option D:\u00a0Gram-positive cocci in chains\u00a0describes <strong>Streptococci</strong>. They typically cause acute exudative pharyngitis characterised by purulent exudate over the tonsils.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/67c90e0c01b042e8ae4c6e3be9be52bc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dc4487200b7e400186dec19b3c48c8bax510x465.GIF"
    ]
  },
  {
    "text": "A patient has complains of fever with chills. A throat examination reveals swollen glands and a thick, whitish membrane over his tonsils. Albert staining is to be done. What are the constituents of Albert's stain?",
    "choices": [
      {
        "id": 1,
        "text": "Carbol fuschin and methylene blue"
      },
      {
        "id": 2,
        "text": "Carbol fuschin and malachite green"
      },
      {
        "id": 3,
        "text": "Toluidine and malachite green"
      },
      {
        "id": 4,
        "text": "Toluidine and methylene blue"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of <strong>diphtheria</strong> caused by <strong><em>Corynebacterium diphtheria</em></strong>. This organism is stained using <strong>Albert's stain</strong> which contains <strong>toluidine blue 'O'</strong> and <strong>malachite green.\u00a0</strong>Both these dyes\u00a0have an affinity for acidic cytoplasm as they are basic dyes.</p>\n<p>Albert\u2019s, Neisser\u2019s, and Ponder\u2019s stain are used to demonstrate the <strong>metachromatic granules</strong>(Volutin / Babes Ernst granules) of <em>Corynebacterium diphtheria</em>.</p>\n<p><em>Corynebacterium diphtheria </em>appears as green-coloured bacilli with purple-blue-coloured metachromatic granules in <strong>cuneiform</strong> arrangement.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d6225a1ac1242b2b91995eff21c5051x510x465.GIF"
    ]
  },
  {
    "text": "Which of the following is not a selective medium for Corynebacterium diptheriae?",
    "choices": [
      {
        "id": 1,
        "text": "Tinsdale medium"
      },
      {
        "id": 2,
        "text": "Loeffler's serum slope"
      },
      {
        "id": 3,
        "text": "Potassium tellurite agar"
      },
      {
        "id": 4,
        "text": "McLeod's medium"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Loeffler's serum slope </strong>is an <strong>enriched</strong>\u00a0<strong>medium</strong> for the growth of <em><strong>Corynebacterium diphtheriae</strong>. </em>It is not a selective medium as other organisms can also grow on this medium.</p>\n<p>The <strong>selective media</strong> for\u00a0<em>Corynebacterium diphtheria\u00a0</em>are <strong>potassium tellurite agar</strong>, <strong>T</strong><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">insdale medium</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">and <strong>McLeod's medium</strong> (tellurite blood agar). Tellurite inhibits the growth of other bacteria. </span><em style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">C. diphtheria</em><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> reduces the tellurite to metallic tellurium, giving its colonies a grey black colour. On\u00a0</span></p>\n<p>On Loeffler's serum slope, colonies appear as small white opaque discs that may acquire a yellow ting. The <strong>advantages</strong> for growing <em>C. diphtheriae</em>\u00a0on <strong>Loeffler's serum slope</strong> are rapid growth in 6-8 hrs and that its the best medium for metachromatic granules production. The <strong>disadvantage</strong> of using this medium is that on incubation beyond 6-8 hrs, it supports the growth of<strong> commensals</strong> as well.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A throat swab taken from a patient who presented with fever, dysphagia and cervical lymphadenopathy was sent for culture on potassium tellurite agar. The resultant colonies had a poached egg appearance. Which among the following is the most likely organism implicated here?",
    "choices": [
      {
        "id": 1,
        "text": "Corynebacterium diphtheriae gravis"
      },
      {
        "id": 2,
        "text": "Corynebacterium diphtheriae mitis"
      },
      {
        "id": 3,
        "text": "Corynebacterium diphtheriae intermedius"
      },
      {
        "id": 4,
        "text": "Corynebacterium pseudotuberculosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Poached egg </strong>colonies on <strong>potassium tellurite agar</strong> indicate\u00a0<em>Corynebacterium diphtheriae</em><strong><em> mitis</em>.</strong></p>\n<p><strong>Macleod</strong>\u00a0classified diphtheria bacilli based on <strong>colony morphology</strong> on tellurite blood agar into the following three types:</p>\n<ul>\n<li><strong>Gravis</strong>: They form <strong>daisy head</strong> colonies and are variably hemolytic. They ferment glycogen and starch.\u00a0</li>\n<li><strong>Intermedius</strong>: They form <strong>frog\u2019s egg</strong> colonies and are non-hemolytic. They do not ferment glycogen and starch.</li>\n<li><strong>Mitis</strong>: They form <strong>poached egg</strong> colonies and are hemolytic.\u00a0They do not ferment glycogen and starch.</li>\n</ul>\n<p>The following image shows the various colony morphologies of <em>C. diphtheriae.</em></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/24c24b8a8aa7459e9fd8707e63b73c5cx1280x3145.JPEG"
    ]
  },
  {
    "text": "The toxin produced by the organisms shown below acts via?",
    "choices": [
      {
        "id": 1,
        "text": "Increase in cAMP"
      },
      {
        "id": 2,
        "text": "Increase in cGMP"
      },
      {
        "id": 3,
        "text": "ADP ribosylation of EF2"
      },
      {
        "id": 4,
        "text": "RNA glycosidase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The given image shows <strong>gram-positive rods </strong>with club-shaped ends, beaded appearance, and a<strong>\u00a0Chinese-letter pattern</strong> of arrangement indicative of\u00a0<em><strong>Corynebacterium diphtheriae</strong></em>.</p>\n<p class=\"p1\">The toxin produced by the bacteria - <strong>diphtheria toxin </strong>-\u00a0inhibits polypeptide chain elongation and protein synthesis by inactivating the <strong>elongation factor</strong>-<strong>2</strong> (EF-2) by <strong>ADP ribosylation</strong>. It has two fragments - fragment B helps in binding of the toxin to host cells and fragment A inactivates EF-2.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2e8e24b2f8db4938b7060cc433bbde83.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b98450d3d234667ae9b48268ad812e2x1280x1204.JPEG"
    ]
  },
  {
    "text": "Which of the following bacteria gain toxigenicity by lysogenic conversion?",
    "choices": [
      {
        "id": 1,
        "text": "Corynebacterium diphtheriae"
      },
      {
        "id": 2,
        "text": "Enterotoxigenic E. coli"
      },
      {
        "id": 3,
        "text": "Shigella dysenteriae"
      },
      {
        "id": 4,
        "text": "Klebsiella pneumoniae"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Lysogenic</strong> or phage<strong> conversion</strong> is seen in <strong><em>Corynebacterium diphtheriae</em></strong>.</p>\n<p>The <strong>toxigenicity</strong> of <strong>diphtheria bacillus</strong> depends on the presence of the <strong>corynephages (tox+).\u00a0</strong>When the bacillus is cured of the phage, its toxigenic capacity is lost.\u00a0</p>\n<p>A <strong>bacteriophage</strong> is a virus that parasitises bacteria. It can carry host DNA and transfer it to another bacterium. In lysogenic conversion, the viral DNA is integrated with the bacterial DNA and thus can code for new characteristics, like toxin production. The conversion of non-toxigenic bacterial strains to toxigenic by infecting them with bacteriophages is known as<strong> lysogenic conversion.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f2237f422f140d79960037100b0c474x800x564.PNG"
    ]
  },
  {
    "text": "Which of the following factors does not affect the toxin production of Corynebacterium diphtheria?",
    "choices": [
      {
        "id": 1,
        "text": "Concentration of iron in the medium"
      },
      {
        "id": 2,
        "text": "Tox Phage"
      },
      {
        "id": 3,
        "text": "Biotype"
      },
      {
        "id": 4,
        "text": "Concentration of zinc in the medium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Toxin production</strong> of <em>Corynebacterium diphtheriae</em> depends on the concentration of <strong>iron</strong> in the medium, presence of\u00a0<strong>tox phage,</strong> and its\u00a0<strong>biotype.\u00a0</strong>Concentration of zinc in the medium has no effect on this process.</p>\n<p>An <strong>increase</strong> in<strong> iron</strong> concentration (option A) upregulates the <strong>DT</strong>\u00a0(diphtheria toxin)<strong> repressor gene</strong>, thereby <strong>decreasing</strong> the <strong>toxin</strong> production. The<strong> optimum level </strong>of iron in the medium for toxin production is<strong> 0.14 \u03bcg/millilitre</strong>, while a concentration of 0.5 \u03bcg/millilitre\u00a0inhibits the formation of toxins.</p>\n<p>The gene for diphtheria toxin is <strong>coded </strong>by<strong> bacteriophage </strong>(corynebacteriophage tox+) and thus the presence of phages (option B) is integral to toxin production. Toxin production also depends on the<strong>\u00a0</strong>biotype (option C) - gravis, intermedius, mitis and belfanti - of the bacilli. All four <strong>biotypes</strong> are toxigenic.</p>\n<p>Diphtheria toxin is also produced by <strong><em>Corynebacterium ulcerans</em> </strong>and <strong><em>Corynebacterium pseudotuberculosis.</em></strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is Elek\u2019s gel precipitation test used to test?",
    "choices": [
      {
        "id": 1,
        "text": "Susceptibility to Corynebacterium diphtheriae"
      },
      {
        "id": 2,
        "text": "Biotype of Corynebacterium diphtheriae"
      },
      {
        "id": 3,
        "text": "Toxigenicity of  Corynebacterium diphtheriae"
      },
      {
        "id": 4,
        "text": "Antibody titer against Corynebacterium diphtheriae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A: For checking susceptibility to diphtheria,\u00a0<strong>Schick test</strong> is used.</p>\n<p>Option B: The biotype of diphtheria can be determined based on <strong>colony morphology</strong> and <strong>biochemical reactions</strong>.</p>\n<p>Option D: The antibody titer against diphtheria can be measured by various <strong>serological methods</strong> like\u00a0passive haemagglutination, latex agglutination test, toxoid enzyme-linked immunosorbent assay (Toxoid-ELISA), and toxin-binding inhibition ELISA (ToBI-ELISA).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/642515ec8adf4640af4751eecdadd576x1280x1187.JPEG"
    ]
  },
  {
    "text": "What diphtheria antibody titer is considered optimally protective?",
    "choices": [
      {
        "id": 1,
        "text": ">0.1IU/ml"
      },
      {
        "id": 2,
        "text": ">0.01IU/ml"
      },
      {
        "id": 3,
        "text": ">0.05 IU/ml"
      },
      {
        "id": 4,
        "text": ">0.5 IU/ml"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Diphtheria antibody</strong> titer is considered\u00a0<strong>optimally protective</strong>\u00a0if the titre is\u00a0<strong>&gt;0.1 IU/mL.</strong></p>\n<p>Diphtheria is primarily the result of the action of <strong>diphtheria toxin</strong>, not bacterial invasion. Hence, antibodies to the diphtheria toxin is a good measure of protection against diphtheria. These antibodies can be induced by immunisation with <strong>diphtheria toxoid vaccine</strong>. The titers of<strong> IgG antibody </strong>against diphtheria toxoid vaccine reflect various levels of protection against the disease as follows:</p>\n<ul>\n<li>&lt;0.01 IU/mL: No protection</li>\n<li>0.01 -0.1 IU/mL: Minimal protection</li>\n<li>&gt;0.1 IU/mL: Optimal protection</li>\n</ul>\n<p>Note: The question asks optimally protective titer and not <strong>minimum effective titer</strong> which is <strong>&gt;0.01 IU/mL</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy presented with fever, sore throat, dysphagia, and a tonsillar pseudomembrane. Which of the following complications will you not anticipate in him?",
    "choices": [
      {
        "id": 1,
        "text": "Asphyxia"
      },
      {
        "id": 2,
        "text": "Otitis media"
      },
      {
        "id": 3,
        "text": "Myocarditis"
      },
      {
        "id": 4,
        "text": "Pupillary paralysis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A child with fever, sore throat, dysphagia, and a tonsillar pseudomembrane likely has<strong> diphthteria. Pupillary reactions </strong>remain<strong> normal</strong>\u00a0and pupillary paralysis is not a complication seen with diphtheria.</p>\n<p>The <strong>complications</strong> of <strong>diphtheria</strong> include <strong>asphyxia</strong> due to the mechanical airway obstruction by the pseudomembrane. <strong>Myocarditis</strong> and polyneuropathy are toxic complications of diphtheria. Patients may develop post diphtheritic paralysis involving palatine and ciliary nerves. Paralysis of the diaphragm and neurogenic bladder dysfunction may also occur.\u00a0Acute circulatory failure, septic complications, such as pneumonia and <strong>otitis media </strong>and renal failure may also occur.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features is not typically seen in diphtheroids?",
    "choices": [
      {
        "id": 1,
        "text": "They possess few or no metachromatic granules"
      },
      {
        "id": 2,
        "text": "They are usually arranged in parallel rows"
      },
      {
        "id": 3,
        "text": "Most of them do not produce toxins"
      },
      {
        "id": 4,
        "text": "They do not ferment sucrose"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Diphtheroids </strong>ferment both<strong> sucrose </strong>and<strong> glucose,</strong> whereas <em>Corynebacterium diphtheriae</em> ferments only glucose.</p>\n<p>Sucrose fermentation is done to differentiate between <em>C. diphtheriae</em> and diphtheroids.&nbsp;</p>\n<p><strong>Diphtheroids:</strong></p>\n<ul>\n<li>They are <strong>corynebacteria</strong> resembling <em>C. diphtheriae</em>&nbsp;which occur as <strong>normal commensals</strong>&nbsp;in the throat, skin, conjunctiva and other areas.</li>\n<li>In general, diphtheroids stain more uniformly than diphtheria bacilli and possess <strong>few or no metachromatic granules.</strong></li>\n<li>Most of them do<strong> not produce toxins</strong>.</li>\n<li>They tend to be arranged in <strong>parallel rows (palisades)</strong> rather than the cuneiform pattern.</li>\n<li>The common diphtheroids include <em>Corynebacterium</em>&nbsp;<em>xerosis<strong>.</strong></em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old fisherman presents with pain and a lesion in his hand similar to what is shown in the image.  What is the causative organism for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 2,
        "text": "Corynebacterium xerosis"
      },
      {
        "id": 3,
        "text": "Erysipelothrix rhusiopathiae"
      },
      {
        "id": 4,
        "text": "Bacillus anthracis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows a raised, well-circumscribed, violaceous lesion with the absence of pus. Thus, it is <strong>erysipeloid</strong>\u00a0which is a skin infection caused by <strong><em>Erysipelothrix</em>\u00a0<em>rhusiopathiae</em></strong><em><strong>.</strong></em></p>\n<p>Erysipeloid usually occurs on the fingers by <strong>direct\u00a0inoculation</strong> at the site of a cut or abrasion, in people who handle animals, fish or animal products. <strong>Pain</strong>, <strong>swelling</strong> and erythema develop and the condition has been called <strong>seal finger</strong> and <strong>whale finger.</strong>\u00a0<strong>Pus</strong> is\u00a0usually <strong>absent</strong> at the infection site, which helps differentiate it from staphylococcal and streptococcal skin infections. It resolves without treatment in 3-4 weeks.\u00a0</p>\n<p><em>Erysipelothrix rhusiopathiae</em> is a slender, non-motile, non-sporing Gram positive bacillus. It is catalase, oxidase, and indole negative. It causes disease in multiple land animals like swine, turkeys and sheep.\u00a0</p>\n<p>Note: <strong>Erysipelas</strong> is caused by <strong><em>Streptococcus pyogenes.\u00a0</em></strong>It<strong>\u00a0</strong>presents as\u00a0erythematous raised lesions with sharply demarcated edges.<strong>\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ae9ff2802fb94418a32345d6b01579f1.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 1-day-old newborn developed severe sepsis and died after 1 day despite aggressive treatment. On examination, multiple granulomas are present over the skin. The organism isolated from the blood sample shows the motility depicted below. What is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Treponema pallidum"
      },
      {
        "id": 2,
        "text": "Vibrio cholera"
      },
      {
        "id": 3,
        "text": "Listeria monocytogenes"
      },
      {
        "id": 4,
        "text": "Clostridium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Early onset sepsis with skin granulomas and organisms showing <strong>tumbling motility</strong> points to a diagnosis of <strong>granulomatosis infantiseptica</strong> caused by<em> <strong>Listeria </strong></em><strong><em>monocytogenes.</em></strong></p>\n<p>Listeria monocytogenes shows <strong>slow tumbling motility</strong> when grown at <strong>25 \u00b0C. </strong>But at 37\u00b0C, it is non-motile because the <strong>peritrichous</strong> <strong>flagella</strong> are produced by the bacillus optimally between 20\u00b0C<span style=\"font-size: xx-small;\">\u00a0</span>and 30\u00b0C. This is known as <strong>differential motility</strong> as motility pattern changes with a change in temperature. Listeria moves from cell-to-cell using host cell actin framework.</p>\n<p>Listeria infection can manifest as febrile gastroenteritis, bacteremia, neurolisteriosis and granulomatosis infantiseptica.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf959a3c2e254038850fd2abef7ffb3b.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presents to the OPD with complaints of fever with chills, headache, abdominal pain, and diarrhoea. He gives a history of consuming raw refrigerated cucumbers the previous day. What is the most likely etiologic organism?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Bacillus cereus"
      },
      {
        "id": 3,
        "text": "Listeria monocytogenes"
      },
      {
        "id": 4,
        "text": "Vibrio cholerae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fever, headache, abdominal pain, diarrhoea following consumption of refridgerated food is suggestive of <strong>food poisoning</strong>\u00a0caused by<strong>\u00a0<em>Listeria monocytogenes.</em></strong></p>\n<p><em>Listeria monocytogenes</em> can <strong>survive at</strong> refrigerator temperatures (<strong>4\u00b0C</strong>), under conditions of low pH and high salt. So it is able to overcome food preservation and safety barriers, making it an important foodborne pathogen.\u00a0</p>\n<p><strong>Healthy persons</strong> exposed to<em> L. monocytogenes</em> in food may develop a mild, self-limiting <strong>febrile gastroenteritis</strong> lasting 1\u20133 days. This develops after an<strong> incubation period </strong>of<strong> 6\u201348 hours</strong>. Symptoms include fever, chills, headache, myalgias, abdominal pain, and diarrhea. <strong>Immunocompromised</strong> individuals can develop <strong>meningoencephalitis, bacteremia</strong>, or focal infections.</p>\n<p>The\u00a0drug of choice is high dose\u00a0<strong>intravenous ampicillin.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Multiple abscesses with discharging sinuses, demonstrating sulphur granules in pus, are caused by",
    "choices": [
      {
        "id": 1,
        "text": "Actinomyces"
      },
      {
        "id": 2,
        "text": "Nocardia"
      },
      {
        "id": 3,
        "text": "Salmonella"
      },
      {
        "id": 4,
        "text": "Tularemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Multiple abscesses</strong> with <strong>discharging sinuses</strong>, demonstrating <strong>sulfur granules</strong> in pus, are characteristic of actinomycosis caused by <strong><em>Actinomyces</em>.</strong></p>\n<p><strong>Actinomycosis</strong>\u00a0is a chronic granulomatous infection characterized by <strong>indurated swellings </strong>in the\u00a0connective\u00a0tissue with\u00a0<strong>suppuration</strong> and discharge of <strong>sulfur</strong>\u00a0<strong>granules.</strong>\u00a0The <strong>most common</strong> causative agent is\u00a0<em><strong>Actinomyces israelli</strong>.</em></p>\n<p>Various clinical forms of actinomycosis include cervicofacial, thoracic, abdominal, and pelvic actinomycosis. Among them, <strong>oral-cervicofacial</strong> actinomycosis is most common, presenting as a soft tissue swelling, abscess, or mass lesion involving the <strong>angle</strong>\u00a0of the\u00a0<strong>jaw</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a false statement regarding Nocardia?",
    "choices": [
      {
        "id": 1,
        "text": "They are aerobes"
      },
      {
        "id": 2,
        "text": "They are acid-fast"
      },
      {
        "id": 3,
        "text": "They are commensals"
      },
      {
        "id": 4,
        "text": "They produce urease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><em><strong>Nocardia</strong></em> are <strong>free-living</strong> organisms and\u00a0not commensals.</p>\n<p><em>Nocardia</em>\u00a0are <strong>aerobic</strong> Gram-positive filamentous bacilli. They are non-sporing.\u00a0They are considered <strong>weakly acid-fast</strong>,<strong> </strong>determined by Kinyoun's acid-fast staining technique. They produce <strong>urease</strong> and are catalase positive. They are found in the soil.\u00a0 <strong><em>Nocardia asteroides</em></strong> is the\u00a0Nocardia species which is<strong> most commonly</strong> involved in <strong>human disease </strong>(cutaneous and systemic).\u00a0The<strong> paraffin bait\u00a0</strong>technique is used for the <strong>isolation</strong> of Nocardia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the organism from the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Mycobacterium leprae"
      },
      {
        "id": 2,
        "text": "Mycobacterium tuberculosis"
      },
      {
        "id": 3,
        "text": "Actinomyces israelli"
      },
      {
        "id": 4,
        "text": "Nocardia asteroides"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The organism shown in the image is<strong><em> Nocardia asteroides</em></strong>.</p>\n<p><em>Nocardia</em> species are <strong>weakly</strong> <strong>acid-fast filamentous </strong>organisms with <strong>hyphae-like branching</strong> on microscopy. They are aerobic, gram-positive, catalase-positive, and urease-positive. They are weakly acid-fast because they stain with carbolfuchsin and retain when decolourized with 1\u20134% sulfuric acid instead of the stronger acid-alcohol decolorant.</p>\n<p>Infection follows <strong>traumatic inoculation</strong> of the organism into the subcutaneous tissue from soil or vegetable sources. They can present with a characteristic <strong>powdery </strong>substance that appears as gritty or necrotic material on the skin or within soft tissues. Accompanying this are multiple <strong>discharging sinuses</strong>, which are abnormal openings that form as the body attempts to expel infected material. These sinuses can drain purulent, often foul-smelling discharge typically associated with localised abscesses, and the discharge may be viscous, sometimes containing necrotic tissue.</p>\n<p>Other options:</p>\n<p>Options A and B: <strong><em>Mycobacteria</em> </strong>species are acid-fast but not have branching filaments.</p>\n<p>Option C: <em><strong>Actinomyces</strong></em> species are not acid-fast. They are Gram-positive arranged in a sun-ray appearance.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6a19ff6ea5514bacb08cbe9b0f03a6b0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a mobile, warm to touch nodule in the neck. On the anaerobic culture of the biopsy material from this swelling, it showed colonies as shown in the image which had gram-positive branching rods on staining. Which of the following is the drug of choice in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Doxycycline"
      },
      {
        "id": 2,
        "text": "Cotrimoxazole"
      },
      {
        "id": 3,
        "text": "Penicillin"
      },
      {
        "id": 4,
        "text": "Surgical drainage"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows a patient with multiple cutaneous lesions caused by <em>Actinomyces</em>:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0a14d984b5d24a4f811f5ab034964c3d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8baebbe837aa478ab1eb3abf7a417457x401x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71207f08b1304388b3c728137772ec09x700x460.JPEG"
    ]
  },
  {
    "text": "Which of the following toxins act by inhibiting elongation factor -2?",
    "choices": [
      {
        "id": 1,
        "text": "1 & 4"
      },
      {
        "id": 2,
        "text": "2 & 4"
      },
      {
        "id": 3,
        "text": "3 & 4"
      },
      {
        "id": 4,
        "text": "4 & 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Both<strong> diphtheria toxin</strong> and <strong>pseudomonas exotoxin</strong> act by inhibiting<strong>\u00a0elongation factor-2(EF-2).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common clinical form of actinomycosis is",
    "choices": [
      {
        "id": 1,
        "text": "Abdominal"
      },
      {
        "id": 2,
        "text": "Cervicofacial"
      },
      {
        "id": 3,
        "text": "Pelvic"
      },
      {
        "id": 4,
        "text": "Thoracic"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>most common</strong> clinical form of actinomycosis is <strong>cervicofacial.</strong></p>\n<p><strong>Actinomycosis</strong> is a chronic granulomatous infection characterized by indurated swellings, mainly in the <strong>connective</strong> <strong>tissue</strong>, suppuration, and discharge of <strong>sulphur</strong> <strong>granules.</strong>\u00a0The most common causative agent is <em>Actinomycetes israelli.</em></p>\n<p>Various clinical forms of actinomycosis involves <strong>cervicofacial</strong>, <strong>thoracic</strong>, <strong>abdominal</strong>,\u00a0and <strong>pelvic</strong> actinomycosis. Among them, actinomycosis most frequently occurs as <strong>oral-cervicofacial </strong>form presenting as a soft tissue swelling, abscess, or mass lesion involving the <strong>angle</strong> of <strong>jaw</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/f6374b2baf364c0da62e3435d29f252fx700x1046.JPEG"
    ]
  }
];
        let quizName = '08 Corynebacterium, Listeria And Actinomyces';
        const quizFilename = '08-corynebacterium-listeria-and-actinomyces-868e929f.html';
        let hierarchy = ["Marrow", "qBank", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>