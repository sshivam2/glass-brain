<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Set Password</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Preload background -->
  <link rel="preload" href="bg.webp" as="image">

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, sans-serif;

      /* Background image settings */
      background: url("bg.webp") center center / cover no-repeat fixed;
      position: relative;
      overflow: hidden;
    }

    /* Blur overlay */
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.4); /* dark overlay */
      backdrop-filter: blur(10px);     /* blur effect */
      -webkit-backdrop-filter: blur(10px);
      z-index: 0;
    }

    .set-password-box {
      position: relative;
      z-index: 1;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div class="set-password-box rounded-2xl p-8 shadow-2xl max-w-sm w-full text-white">
    <h2 class="text-3xl font-bold mb-6 text-center">Set Your Password</h2>

    <input id="password" type="password" placeholder="New Password"
      class="w-full mb-6 p-3 rounded-lg bg-white/20 focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-white/70" />

    <button id="setPassword"
      class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:opacity-90 transition rounded-lg py-3 font-semibold">
      Set Password
    </button>

    <p id="message" class="text-center mt-4 text-sm opacity-80"></p>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    const SUPA_URL = 'https://mxymburfwdjqrbhsqzod.supabase.co'
    const SUPA_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14eW1idXJmd2RqcXJiaHNxem9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzc0NDYsImV4cCI6MjA3MzYxMzQ0Nn0.9xRwH5la1vqpDsGKGif5zM8wnaVWJbDbA6ARrZfg5pU'
    const supabase = createClient(SUPA_URL, SUPA_ANON)
    
    const passwordInput = document.getElementById('password')
    const setPasswordBtn = document.getElementById('setPassword')
    const message = document.getElementById('message')

    setPasswordBtn.onclick = async () => {
      const newPassword = passwordInput.value.trim()
      if(newPassword.length < 8) {
        message.textContent = "Password must be at least 8 characters."
        message.style.color = "red"
        return
      }
      message.textContent = "Setting password..."
      message.style.color = "white"

      try {
        const { error } = await supabase.auth.updateUser({ password: newPassword })
        if(error) throw error

        message.textContent = "Password set successfully! Redirecting to login..."
        message.style.color = "lightgreen"

        setTimeout(() => {
          location.href = '/login.html'
        }, 2500)
      } catch(err) {
        message.textContent = "Failed to set password: " + err.message
        message.style.color = "red"
      }
    }
  </script>
</body>
</html>
