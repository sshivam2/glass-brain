<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20 Stds And Surface Infections - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Community Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "When is World AIDS day observed?",
    "choices": [
      {
        "id": 1,
        "text": "March 24th"
      },
      {
        "id": 2,
        "text": "February 4th"
      },
      {
        "id": 3,
        "text": "December 1st"
      },
      {
        "id": 4,
        "text": "April 25th"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> World AIDS Day</strong> is observed on <strong>December 1st</strong>. The theme for 2021 is 'Ending the HIV epidemic: Equitable Access, Everyone&rsquo;s Voice'.</p>\n<p>Option A: &nbsp;The World Tuberculosis Day is on&nbsp;March 24.</p>\n<p>Option B: &nbsp;The World Cancer Day is on&nbsp;February 4.</p>\n<p>Option D: The World Malaria Day&nbsp;is on April 25.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What are the most common modes of transmission of HIV in India in descending order?",
    "choices": [
      {
        "id": 1,
        "text": "Transplacental, homosexual, heterosexual"
      },
      {
        "id": 2,
        "text": "Homosexual, heterosexual, transplacental"
      },
      {
        "id": 3,
        "text": "Heterosexual, transplacental, homosexual"
      },
      {
        "id": 4,
        "text": "Heterosexual, homosexual, transplacental"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>most common</strong> mode of transmission of HIV in India is <strong>heterosexual</strong>&nbsp;transmission, followed by<strong>&nbsp;transplacental</strong>&nbsp;and<strong>&nbsp;homosexual&nbsp;</strong>contact, respectively.</p>\n<p>The common modes of transmission of HIV are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Heterosexual (83.7%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Injecting drug users (5.6%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Transplacental transmission (3.8 %)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Homosexual (2.5%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Blood and blood products (0.8%)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Unknown (3.6%)</li>\n</ul>\n<p>The<strong> highest risk</strong> <strong>of transmission</strong> is seen in <strong>homosexuals</strong> due to the increased risk of abrasions during anal sex.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Health care workers will require post-exposure prophylaxis after exposure to which of the following body fluids of an HIV patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tears"
      },
      {
        "id": 2,
        "text": "Urine"
      },
      {
        "id": 3,
        "text": "Saliva"
      },
      {
        "id": 4,
        "text": "Menstrual blood"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Health care workers exposed&nbsp;to the&nbsp;<strong>menstrual blood</strong> of an HIV-positive patient will require <strong>post-exposure prophylaxis</strong>. The risk of transmission of HIV during vaginal intercourse is higher when the woman is menstruating.</p>\n<p>Tears, non-blood-stained saliva, urine, and sweat do not pose a significant risk. Exposure to these fluids does not require post-exposure prophylaxis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As per WHO staging of HIV, which of the following HIV-positive patients cannot be classified as stage IV?",
    "choices": [
      {
        "id": 1,
        "text": "A 29-year-old man diagnosed with cerebral toxoplasmosis"
      },
      {
        "id": 2,
        "text": "A 56-year-old woman with significant weight loss and muscle wasting"
      },
      {
        "id": 3,
        "text": "A 43-year-old lady being treated for Pneumocystis pneumonia"
      },
      {
        "id": 4,
        "text": "A 32-year-old man with oral candidiasis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Oral candidiasis</strong> is seen in <strong>stage 3,</strong> not stage 4 of HIV.</p>\n<p>The following conditions are included in the WHO stage IV of HIV:</p>\n<ul>\n<li><strong>HIV wasting syndrome</strong> (Slim disease)</li>\n<li>HIV encephalopathy</li>\n<li>HIV-associated nephropathy or cardiomyopathy</li>\n<li>Infections:\n<ul>\n<li><strong><em>Pneumocystis jiroveci</em> pneumonia</strong> (previously known as <em>Pneumocystis carinii</em>)</li>\n<li>Chronic herpes simplex infection, cytomegalovirus disease</li>\n<li><strong>Oesophageal/ tracheal candidiasis&nbsp;</strong></li>\n<li>Extrapulmonary TB or&nbsp;disseminated <em>M. avium</em> infection</li>\n<li><strong>CNS toxoplasmosis</strong></li>\n<li>Extrapulmonary cryptococcosis</li>\n<li>Chronic cryptosporidiosis or&nbsp;isosporiasis</li>\n<li>Disseminated fungal infections (histoplasmosis, coccidioidomycosis)</li>\n<li>Recurrent severe bacterial pneumonia or&nbsp;septicemia&nbsp;</li>\n<li>Atypical disseminated leishmaniasis</li>\n<li>Progressive multifocal leukoencephalopathy</li>\n</ul>\n</li>\n<li>Neoplasms:\n<ul>\n<li>Kaposi sarcoma</li>\n<li>Lymphoma (cerebral or B cell non-Hodgkin)</li>\n<li>Invasive cervical carcinoma</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year man with a high-risk sexual history now presents with prolonged fever for the past 1.5 months. On examination, the following finding is noted. Which one of the following additional features is required to diagnose this patient with AIDS?",
    "choices": [
      {
        "id": 1,
        "text": "Generalised lymphadenopathy > 1 month"
      },
      {
        "id": 2,
        "text": "Generalized pruritic dermatitis"
      },
      {
        "id": 3,
        "text": "Chronic diarrhea > 1 month"
      },
      {
        "id": 4,
        "text": "Persistent cough > 1 month"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This clinical scenario is suspicious for HIV infection. As per the WHO definition, the presence of&nbsp;<strong>chronic diarrhea &gt; 1 month</strong> is needed to diagnose this patient with <strong>AIDS</strong>.</p>\n<p>The WHO clinical definition is used for&nbsp;<strong>AIDS</strong> <strong>surveillance</strong> in the clinical setting. Patients <strong>&gt; 12 years</strong> of age are said to have AIDS if they have at least <strong>2 major&nbsp;</strong>and <strong>1 minor</strong>&nbsp;signs, provided other clinically similar conditions are be ruled out.</p>\n<p>Major signs:</p>\n<ul>\n<li>Weight loss &ge; 10% of body weight</li>\n<li>Chronic diarrhea &gt; 1 month</li>\n<li>Prolonged fever for &gt; 1 month (intermittent or constant)</li>\n</ul>\n<p>Minor signs:</p>\n<ul>\n<li>A persistent cough &gt; 1 month</li>\n<li>Generalized pruritic dermatitis</li>\n<li>History of herpes zoster</li>\n<li>Oropharyngeal candidiasis</li>\n<li>Chronic progressive or disseminated herpes simplex infection</li>\n<li>Generalized lymphadenopathy</li>\n</ul>\n<p>For surveillance purposes, the presence of either of the following is also considered <strong>sufficient to diagnose</strong> AIDS:</p>\n<ul>\n<li>Generalized <strong>Kaposi's sarcoma</strong></li>\n<li><strong>Cryptococcal meningitis</strong>&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a588ac7ccf234a548be050abda55c81e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect regarding the epidemiology of HIV?",
    "choices": [
      {
        "id": 1,
        "text": "HIV infected infants and children do not progress rapidly to AIDS"
      },
      {
        "id": 2,
        "text": "Seminal secretions are more infectious than vaginal secretion"
      },
      {
        "id": 3,
        "text": "People are infectious during the window period"
      },
      {
        "id": 4,
        "text": "HIV prevalence has not exceeded 5% in any subpopulation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Infants </strong>and<strong> children </strong>infected with HIV<strong> progress rapidly </strong>to<strong> AIDS.&nbsp;</strong></p>\n<p><strong>Semen</strong> is <strong>more infectious</strong> than vaginal or cervical fluids as it has a higher concentration of HIV.</p>\n<p>HIV-infected patients are <strong>highly infectious</strong> during:</p>\n<ul>\n<li><strong>Window period</strong> (very early stages before antibody production)&nbsp;</li>\n<li>Advanced stages of infection (due to higher levels of viremia)&nbsp;</li>\n</ul>\n<p><strong>&nbsp;HIV prevalence</strong> has consistently remained &lt; <strong>5%</strong> in all defined subpopulations.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In individuals exposed to HIV, within how many hours should prophylaxis be initiated?",
    "choices": [
      {
        "id": 1,
        "text": "6 hours"
      },
      {
        "id": 2,
        "text": "24 hours"
      },
      {
        "id": 3,
        "text": "48 hours"
      },
      {
        "id": 4,
        "text": "72 hours"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Post-exposure prophylaxis</strong> for HIV should ideally be initiated <strong>within 72 hours.</strong>&nbsp;It is recommended that it be started as even as early as &lt; 2 hours.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A nurse sustained a needle stick injury while sampling the blood of a patient who is HIV-positive. Which of the following is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Washing hands with soap and water"
      },
      {
        "id": 2,
        "text": "Administration of tenofovir monotherapy"
      },
      {
        "id": 3,
        "text": "Measure baseline viral markers of health care worker immediately"
      },
      {
        "id": 4,
        "text": "Measure viral markers after 6 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Triple therapy</strong>&nbsp;(<strong>tenofovir </strong>300mg +&nbsp;<strong>lamivudine </strong>300mg&nbsp;+ <strong>dolutegravir </strong>50mg) is recommended for <strong>HIV</strong> post-exposure prophylaxis (<strong>PEP</strong>), not monotherapy.&nbsp;</p>\n<p>Steps to be undertaken after a needlestick injury are:</p>\n<ul>\n<li>Wash the wound and skin with water and soap. Do not scrub and avoid antiseptics.</li>\n<li>Assess exposed individual:\n<ul>\n<li>Check <strong>baseline viral markers</strong></li>\n<li>Monitor for <strong>acute seroconversion</strong> illness within<strong> 3-6 weeks</strong> after exposure</li>\n<li>If testing is positive, refer to ART center&nbsp;</li>\n</ul>\n</li>\n<li>Assess exposure source and determine the risk of transmission&nbsp;</li>\n<li>Counseling and support</li>\n<li>Initiate <strong>PEP</strong> at the earliest - preferably &lt; 2 hours and ideally <strong>&lt; 72 hours</strong></li>\n<li><strong>28-day prescription</strong> with drug information</li>\n<li>HIV test at 3 months after exposure</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A resident doctor sustained a needlestick injury while sampling blood of a patient who is HIV positive. A decision is taken to offer him post-exposure prophylaxis. Which one of the following would be the best recommendation?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine + Lamivudine for 4 weeks"
      },
      {
        "id": 2,
        "text": "Lamivudine + Tenofovir + Efavirenz for 4 weeks"
      },
      {
        "id": 3,
        "text": "Lamivudine + Tenofovir  + Dolutegravir for 4 weeks"
      },
      {
        "id": 4,
        "text": "Zidovudine + Lamivudine + Nevirapine for 4 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Triple therapy</strong>&nbsp;with&nbsp;<strong>tenofovir </strong>300mg,&nbsp;<strong>lamivudine </strong>300mg, and&nbsp;<strong>dolutegravir </strong>50mg for 4 weeks is recommended for <strong>HIV</strong> post-exposure prophylaxis (<strong>PEP</strong>).</p>\n<p>Steps to be undertaken after a needlestick injury are:</p>\n<ul>\n<li>Wash the wound and skin with water and soap. Do not scrub and avoid antiseptics.</li>\n<li>Assess exposed individual:\n<ul>\n<li>Check <strong>baseline viral markers</strong></li>\n<li>Monitor for <strong>acute seroconversion</strong> illness within<strong> 3-6 weeks</strong> after exposure</li>\n<li>If testing is positive, refer to ART center&nbsp;</li>\n</ul>\n</li>\n<li>Assess exposure source and determine the risk of transmission&nbsp;</li>\n<li>Counseling and support</li>\n<li>Initiate <strong>PEP</strong> at the earliest - preferably &lt; 2 hours and ideally <strong>&lt; 72 hours</strong></li>\n<li><strong>28-day prescription</strong> with drug information</li>\n<li>HIV test at 3 months after exposure</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following HIV-infected patients would you start on cotrimoxazole prophylaxis?",
    "choices": [
      {
        "id": 1,
        "text": "A 24-year-old pregnant woman with WHO stage 2 disease."
      },
      {
        "id": 2,
        "text": "A 47-year-old man in a malaria-endemic area with WHO stage 1 disease"
      },
      {
        "id": 3,
        "text": "A 2-week-old HIV-exposed infant who is being exclusively breastfed"
      },
      {
        "id": 4,
        "text": "A 7-year-old girl with a CD4 count of 400 cells/cubic mm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>All HIV infected\u00a0<strong>adults and children</strong>\u00a0in <strong>malaria-endemic</strong> areas should be given <strong>cotrimoxazole prophylaxis</strong> regardless of CD4 count or WHO clinical stage.</p>\n<p>Cotrimoxazole is also indicated in areas with a\u00a0<strong>low prevalence of malaria</strong> as shown below:</p>\n<table style=\"height: 157px; width: 585px;\">\n<tbody>\n<tr>\n<td style=\"width: 148.28125px; text-align: center;\"><strong>Age group</strong></td>\n<td style=\"width: 137.71875px; text-align: center;\"><strong>Indication</strong></td>\n<td style=\"width: 281px; text-align: center;\"><strong>When to discontinue</strong></td>\n</tr>\n<tr>\n<td style=\"width: 148.28125px;\">HIV-exposed infants &gt; 4-6 weeks of age</td>\n<td style=\"width: 137.71875px;\">All infants</td>\n<td style=\"width: 281px;\">After HIV infection has been ruled out</td>\n</tr>\n<tr>\n<td style=\"width: 148.28125px;\">Children &lt; 5 years</td>\n<td style=\"width: 137.71875px;\">All children</td>\n<td style=\"width: 281px;\">\n<p>At 5 years in areas with\u00a0low prevalence of malaria\u00a0</p>\n<p>(In high prevalence areas, continue till adulthood)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 148.28125px;\">Children &gt; 5 years</td>\n<td style=\"width: 137.71875px;\">CD4 count &lt;350 and/or WHO stage 3/4</td>\n<td style=\"width: 281px;\">When CD4 &gt; 350 and they have been on ART &gt; 6 months</td>\n</tr>\n<tr>\n<td style=\"width: 148.28125px;\">Adults and pregnant women</td>\n<td style=\"width: 137.71875px;\">CD4 count &lt;350 and/or WHO stage 3/4</td>\n<td style=\"width: 281px;\">When CD4 count is rising and viral load is decreasing</td>\n</tr>\n<tr>\n<td style=\"width: 148.28125px;\">HIV and TB coinfection\u00a0</td>\n<td style=\"width: 137.71875px;\">All patients</td>\n<td style=\"width: 281px; text-align: center;\">\u2014</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man with HIV is being screened for symptoms of TB. He reports no cough, fever, night sweats, or weight loss. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Start 5 mg/kg/day Isoniazid daily for 9 months"
      },
      {
        "id": 2,
        "text": "Prophylaxis does not need to be started"
      },
      {
        "id": 3,
        "text": "Rifabutin prophylaxis should be started"
      },
      {
        "id": 4,
        "text": "Start weekly dose of rifapentine + isoniazid for 3 months"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The next step in management in this patient is to provide&nbsp;<strong>tuberculosis preventive therapy</strong>&nbsp;(TPT) with <strong>rifapentine+ isoniazid weekly</strong>&nbsp;for <strong>3&nbsp;months</strong>.</p>\n<p>According to the NTEP guidelines, TPT is indicated for the following groups:</p>\n<table style=\"width: 967.328px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; width: 402px; height: 18px;\"><strong>&nbsp; &nbsp; &nbsp; Risk group</strong></td>\n<td style=\"text-align: center; width: 549.328px; height: 18px;\"><strong>&nbsp; &nbsp; &nbsp; Criteria&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 54.7578px;\">\n<td style=\"width: 402px; height: 54.7578px;\">\n<ul>\n<li>People living with HIV</li>\n</ul>\n</td>\n<td style=\"width: 549.328px; height: 54.7578px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Negative 4 symptom test - start TPT after ruling out TB</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Patients with active TB - start TPT after completion of the ATT regimen</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 402px; height: 46px;\">\n<ul>\n<li>Household contacts (HHC) of pulmonary TB patients &nbsp;&lt; 5 years</li>\n</ul>\n</td>\n<td style=\"width: 549.328px; height: 46px;\">\n<ul>\n<li>Start TPT after ruling out active TB</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 165px;\">\n<td style=\"width: 402px; height: 165px;\">\n<ul>\n<li>Household contacts of pulmonary TB patients &nbsp;&ge; 5 years</li>\n<li>Other risk groups:</li>\n<li>Children/adults on immunosuppressive therapy</li>\n<li>Patients on anti-TNF treatment</li>\n<li>Patients on dialysis or post-transplantation</li>\n<li>Patients with silicosis</li>\n</ul>\n</td>\n<td style=\"width: 549.328px; height: 165px;\">\n<ul>\n<li>First rule out active TB</li>\n<li>Start TPT if <strong>IGRA or TST</strong> is <strong>positive</strong> with a normal chest x-ray</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>IGRA - interferon-gamma release assay; TST - tuberculin skin test; ATT - antituberculous therapy</p>\n<table style=\"height: 222px; width: 509px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 226px; height: 18px;\"><strong>Target Population</strong></td>\n<td style=\"width: 267px; height: 18px;\"><strong>Treatment option</strong></td>\n</tr>\n<tr>\n<td style=\"width: 226px;\">\n<ul>\n<li>People living with HIV (adults and children &gt; 2 years)</li>\n</ul>\n<ul>\n<li>HHC of pulmonary TB patients</li>\n</ul>\n</td>\n<td style=\"width: 267px;\">\n<ul>\n<li>3-month weekly Isoniazid (300 mg) and Rifapentine (300 mg) in persons older than 2 years</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 226px; height: 54px;\">\n<ul>\n<li>Infants &lt;12 months of age and Children &lt; 2years of age with HIV</li>\n</ul>\n</td>\n<td style=\"width: 267px; height: 54px;\">\n<ul>\n<li>6-months daily isoniazid (6H): 10 mg/kg/day</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>TPT is <strong>contraindicated</strong> under the following conditions:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Active TB</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Active hepatitis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Peripheral neuropathy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Regular and heavy alcohol consumption</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about the 2025 targets of the Global AIDS Strategy for 2021 to 2026?",
    "choices": [
      {
        "id": 1,
        "text": "B,E only"
      },
      {
        "id": 2,
        "text": "A,B,C only"
      },
      {
        "id": 3,
        "text": "A,B,D,E only"
      },
      {
        "id": 4,
        "text": "C,D only"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>95%</strong>, not 75% of<strong> HIV-exposed children</strong> are tested by <strong>2 months</strong> of age and after <strong>stopping breastfeeding</strong> according to the 2025 targets.</p>\n<p>Global AIDS Strategy 2021-2026 has the following targets for the year 2025:</p>\n<table style=\"height: 164px; width: 711px;\">\n<tbody>\n<tr>\n<td style=\"width: 140px; text-align: center;\"><strong>Target %</strong></td>\n<td style=\"width: 261.4375px; text-align: center;\"><strong>Target population</strong></td>\n<td style=\"width: 290.5625px; text-align: center;\"><strong>Target intervention</strong></td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">95% of</td>\n<td style=\"width: 261.4375px;\">People at risk of HIV infection</td>\n<td style=\"width: 290.5625px;\">Access to effective <strong>prevention</strong> <strong>options</strong></td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 261.4375px;\">Women of reproductive age</td>\n<td style=\"width: 290.5625px;\">Have their HIV, sexual, reproductive <strong>health service needs</strong> met</td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 261.4375px;\">Pregnant and breastfeeding women with HIV</td>\n<td style=\"width: 290.5625px;\">Suppressed <strong>viral loads</strong></td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 261.4375px;\">HIV-exposed children</td>\n<td style=\"width: 290.5625px;\">Tested by 2 months of age and again after stopping breastfeeding</td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">90% of</td>\n<td style=\"width: 261.4375px;\">People living with HIV</td>\n<td style=\"width: 290.5625px;\">Preventive treatment for <strong>TB</strong></td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 261.4375px;\">People living with HIV and people at risk</td>\n<td style=\"width: 290.5625px;\">\n<p>Linked to services for overall health and wellbeing including:</p>\n<ul>\n<li>Communicable and non-communicable diseases</li>\n<li>Sexual health</li>\n<li>Gender-based violence</li>\n<li>Mental health and substance abuse</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: center;\">75% of</td>\n<td style=\"width: 261.4375px;\">All children living with HIV</td>\n<td style=\"width: 290.5625px;\">Suppressed<strong> viral loads</strong> by 2023 (interim target)</td>\n</tr>\n<tr>\n<td style=\"width: 140px; text-align: left;\" colspan=\"3\"><strong>95&ndash;95&ndash;95</strong> testing and treatment targets to be achieved within all subpopulations, age groups, and geographic settings, including children living with HIV.</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old man comes to you with complaints of painful swelling in his right groin, as shown below. He gives a history of 3-4 painless ulcers over his penis 4 weeks ago that had resolved on its own. What is the likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Haemophilus ducreyi"
      },
      {
        "id": 2,
        "text": "Calymmotabacterium granulomatis"
      },
      {
        "id": 3,
        "text": "Treponema pallidum"
      },
      {
        "id": 4,
        "text": "Chlamydia trachomatis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical scenario and image showing the<strong> groove sign</strong> of Greenblatt are suggestive of&nbsp;lymphogranuloma venereum<strong>&nbsp;</strong>(<strong>LGV</strong>). The causative organism is <em><strong>Chlamydia trachomatis.</strong></em>&nbsp;</p>\n<p>LGV commonly presents with multiple <strong>small, painless ulcers</strong> on the genitalia that are often unrecognized and resolve spontaneously. This is followed by<strong> painful lymphadenopathy</strong> and <strong>bubo</strong> formation after 4-6 weeks. If left untreated, it can lead to extensive lymphatic damage, elephantiasis, and deformity of the genitalia.</p>\n<p>The treatment of choice is <strong>doxycycline</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e18f884c2ba243b396718760c4789f25.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the following conditions with their causative agents:",
    "choices": [
      {
        "id": 1,
        "text": "I-A, II-B, III-D, IV-C"
      },
      {
        "id": 2,
        "text": "I-B, II-A, III-C, IV-D"
      },
      {
        "id": 3,
        "text": "I-D, II-C, III-A, IV-B"
      },
      {
        "id": 4,
        "text": "I-C, II-D, III-B, IV-A"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The causative organisms of the given conditions are as follows:</p>\n<table style=\"height: 128px;\" width=\"328\">\n<tbody>\n<tr>\n<td style=\"width: 155.5146942138672px; text-align: center;\"><strong>Condition</strong></td>\n<td style=\"width: 155.5146942138672px; text-align: center;\"><strong>Organism</strong></td>\n</tr>\n<tr>\n<td style=\"width: 155.5146942138672px;\">Pinta</td>\n<td style=\"width: 155.5146942138672px;\"><em>Treponema carateum</em></td>\n</tr>\n<tr>\n<td style=\"width: 155.5146942138672px;\">Lymphogranuloma venereum</td>\n<td style=\"width: 155.5146942138672px;\"><em>Chlamydia trachomatis</em></td>\n</tr>\n<tr>\n<td style=\"width: 155.5146942138672px;\">Yaws</td>\n<td style=\"width: 155.5146942138672px;\"><em>Treponema pertenue</em></td>\n</tr>\n<tr>\n<td style=\"width: 155.5146942138672px;\">Granuloma inguinale</td>\n<td style=\"width: 155.5146942138672px;\"><em>Klebsiella granulomatis&nbsp;</em></td>\n</tr>\n</tbody>\n</table>\n<p><strong>India</strong> is the <strong>first country</strong> in the world to be officially acknowledged as being <strong>yaws-free</strong>. The WHO declared India free of yaws on <strong>5th May 2016</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following STDs with their respective incubation periods:",
    "choices": [
      {
        "id": 1,
        "text": "I-D, II-B, III-A, IV-C"
      },
      {
        "id": 2,
        "text": "I-A, II-C, III-D, IV-B"
      },
      {
        "id": 3,
        "text": "I-B, II-A, III-C, IV-D"
      },
      {
        "id": 4,
        "text": "I-C, II-D, III-B, IV-A"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The incubation periods of various STDs are as follows:</p>\n<table style=\"height: 126px;\" width=\"293\">\n<tbody>\n<tr>\n<td style=\"width: 138.01470947265625px; text-align: center;\"><strong>STD</strong></td>\n<td style=\"width: 138.01470947265625px; text-align: center;\"><strong>Incubation period</strong></td>\n</tr>\n<tr>\n<td style=\"width: 138.01470947265625px;\">Syphilis</td>\n<td style=\"width: 138.01470947265625px;\">10-90 days</td>\n</tr>\n<tr>\n<td style=\"width: 138.01470947265625px;\">Chlamydiasis</td>\n<td style=\"width: 138.01470947265625px;\">7-21 days</td>\n</tr>\n<tr>\n<td style=\"width: 138.01470947265625px;\">Donovanosis</td>\n<td style=\"width: 138.01470947265625px;\">3-40 days</td>\n</tr>\n<tr>\n<td style=\"width: 138.01470947265625px;\">Chancroid</td>\n<td style=\"width: 138.01470947265625px;\">2-3 days</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a part of case detection in STDs?",
    "choices": [
      {
        "id": 1,
        "text": "Screening"
      },
      {
        "id": 2,
        "text": "Contact tracing"
      },
      {
        "id": 3,
        "text": "Cluster testing"
      },
      {
        "id": 4,
        "text": "Notification"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Notification is not part of the <strong>case detection</strong> strategy for <strong>STDs</strong>.&nbsp;Case detection in STDs includes the following:</p>\n<ul>\n<li>Screening</li>\n<li>Contact tracing</li>\n<li>Cluster testing</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old man is diagnosed with syphilis. On probing, he gives you the information of other people in the same sociosexual environment as him. You then refer all these people for testing. What is this method of case detection?",
    "choices": [
      {
        "id": 1,
        "text": "Contact testing"
      },
      {
        "id": 2,
        "text": "High-risk screening"
      },
      {
        "id": 3,
        "text": "Selective screening"
      },
      {
        "id": 4,
        "text": "Cluster testing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This method of case detection is known as <strong>cluster testing.</strong></p>\n<p>The methods employed in case detection of STDs are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Screening</strong> - testing of apparently healthy volunteers from the general population for early detection of disease</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Contact tracing</strong>&nbsp;- technique by which the sexual partners of diagnosed patients are identified, located, investigated, and treated</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cluster testing</strong>&nbsp;- patients are asked to name other persons who move in the same socio-sexual environment, who are then tested</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old man with urethral discharge is treated with the grey kit. This treatment is effective for the control of which of the following organisms?",
    "choices": [
      {
        "id": 1,
        "text": "Neisseria gonorrhoeae and Herpes genitalis"
      },
      {
        "id": 2,
        "text": "Chlamydia trachomatis and Herpes genitalis"
      },
      {
        "id": 3,
        "text": "Neisseria gonorrhoeae and Chlamydia trachomatis"
      },
      {
        "id": 4,
        "text": "Neisseria gonorrhoea and Treponema pallidum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> grey kit</strong> is effective for the treatment of infections caused by <em><strong>Neisseria gonorrhoeae</strong></em> and <strong><em>Chlamydia trachomatis</em></strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false about the epidemiology of leprosy?",
    "choices": [
      {
        "id": 1,
        "text": "Increased prevalence in childhood indicates that the disease is active and spreading."
      },
      {
        "id": 2,
        "text": "Multibacillary cases are the most infectious in the community"
      },
      {
        "id": 3,
        "text": "Bacterial load is highest in patients with tuberculoid leprosy"
      },
      {
        "id": 4,
        "text": "Seldom may be transmitted by insect vectors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>bacterial load</strong> is&nbsp;<strong>highest</strong> in patients with&nbsp;<strong>lepromatous leprosy</strong>. 1 gram of leproma contains as many as 2-7 billion bacilli.</p>\n<p><strong>Multibacillary</strong> <strong>cases</strong> (lepromatous and borderline lepromatous) are the most <strong>important source</strong> of infection in the community.&nbsp;Infection can occur at any age. In general, cases rise to a peak between 10-20 years of age and then fall. In endemic areas, the disease is acquired commonly during <strong>childhood.</strong>&nbsp;A <strong>high prevalence</strong> in this age group indicates that the disease is <strong>active and spreading</strong>.</p>\n<p>The organism may also be transmitted by <strong>insect vectors</strong> or by <strong>tattooing</strong> needles. However, this is not clinically significant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Elimination of leprosy in India is defined as the prevalence of :",
    "choices": [
      {
        "id": 1,
        "text": "< 1 per 1000"
      },
      {
        "id": 2,
        "text": "< 1 per 10,000"
      },
      {
        "id": 3,
        "text": "< 5 per 1000"
      },
      {
        "id": 4,
        "text": "< 5 per 10,000"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Elimination</strong> of leprosy in India is defined as a prevalence of <strong>&lt; 1 per 10,000.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the prevalence of leprosy in India per 10,000?",
    "choices": [
      {
        "id": 1,
        "text": "More than 1"
      },
      {
        "id": 2,
        "text": "0.66"
      },
      {
        "id": 3,
        "text": "0.71"
      },
      {
        "id": 4,
        "text": "0.41"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>prevalence</strong> of <strong>leprosy</strong> in India is <strong>0.41</strong> per 10,000 as of March 2021.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The Ridley Jopling classification for leprosy uses which of the following parameters?",
    "choices": [
      {
        "id": 1,
        "text": "Clinical, bacteriological, immunological, epidemiological"
      },
      {
        "id": 2,
        "text": "Clinical, bacteriological, immunological, therapeutic"
      },
      {
        "id": 3,
        "text": "Clinical, bacteriological, immunological, histological"
      },
      {
        "id": 4,
        "text": "Clinical , immunological, epidemiological, operational"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The Ridley Jopling classification uses <strong>clinical</strong>, b<strong>acteriological, immunological,&nbsp;</strong>and <strong>histological</strong> parameters.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pathologist is studying the split skin smears taken from 4 sites of a leprosy patient. The following findings are noted in the samples. What is the bacteriological index?",
    "choices": [
      {
        "id": 1,
        "text": "3.5"
      },
      {
        "id": 2,
        "text": "4.5"
      },
      {
        "id": 3,
        "text": "5.5"
      },
      {
        "id": 4,
        "text": "2.5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>bacteriological index</strong>&nbsp;(BI) of the given samples is <strong>3.5</strong></p>\n<p>According to <strong>Ridley&rsquo;s</strong> <strong>logarithmic</strong> <strong>scale</strong>,&nbsp;&nbsp;&nbsp;</p>\n<ul>\n<li>10 bacilli out of 100 oil immersion fields indicate an index of 1+</li>\n<li>&gt; 1000 bacilli out of average fields imply an index of 6+&nbsp;</li>\n</ul>\n<p>The bacteriological index is calculated by adding the <strong>index from each site</strong> examined and dividing the total by the <strong>number of sites</strong> examined.</p>\n<p>Hence, BI = (1+1+6+6) / 4</p>\n<p style=\"padding-left: 60px;\">BI = 14/4</p>\n<p style=\"padding-left: 60px;\">BI = 3.5</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The lepromin test was performed on a patient with suspected leprosy. When will you ask him to come back for interpretation of the test results?",
    "choices": [
      {
        "id": 1,
        "text": "After 24 hrs and on 3rd day"
      },
      {
        "id": 2,
        "text": "After 48hrs and on 7th day"
      },
      {
        "id": 3,
        "text": "After 48 hrs and on 21st day"
      },
      {
        "id": 4,
        "text": "After 24 hrs and on 45th day"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient should be asked to come back after <strong>48 hours</strong> and on the&nbsp;<strong>21st day&nbsp;</strong>for interpretation of the test results.</p>\n<p>The <strong>lepromin test</strong> is a skin test for <strong>delayed hypersensitivity</strong> and is the only method to study immunity in leprosy patients. It is performed by injecting 0.1ml of lepromin reagent&nbsp;intradermally&nbsp;into the inner aspect of the forearm. The following 2 reactions are observed:</p>\n<table style=\"height: 104px; width: 462.5px;\">\n<tbody>\n<tr>\n<td style=\"width: 226px;\"><strong>Early reaction of Fernandez</strong></td>\n<td style=\"width: 227.5px;\"><strong>Late reaction of Mitsuda</strong></td>\n</tr>\n<tr>\n<td style=\"width: 226px;\">Develops in&nbsp;24-48 hours&nbsp;</td>\n<td style=\"width: 227.5px;\">Starts at 7-10 days, peaks at 3-4 weeks (read on day 21)</td>\n</tr>\n<tr>\n<td style=\"width: 226px;\">Remains for 3-5 days</td>\n<td style=\"width: 227.5px;\">Gradually subsides over the next few weeks</td>\n</tr>\n<tr>\n<td style=\"width: 226px;\">Poorly defined erythema and induration. Carries less significance</td>\n<td style=\"width: 227.5px;\">Considered positive if there is a nodule &gt; 5 mm in diameter</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false about the lepromin test?",
    "choices": [
      {
        "id": 1,
        "text": "It is negative in most children in the first 4 months of life"
      },
      {
        "id": 2,
        "text": "It can be used as a diagnostic test"
      },
      {
        "id": 3,
        "text": "It is used to classify leprosy cases"
      },
      {
        "id": 4,
        "text": "False positive may be seen in those who underwent BCG vacination"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> lepromin test</strong> is not a diagnostic test. It is only used to assess the<strong> immune status</strong>, <strong>classify</strong> the cases, and estimate the <strong>prognosis</strong>.</p>\n<p>The two main drawbacks of this test are:&nbsp;</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>False-positive</strong> results in those who received BCG vaccination</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>False-negative</strong> results in lepromatous and borderline lepromatous cases</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A group of public health workers is trying to identify trachoma cases at an ophthalmology camp. Which of the following is the best index to assess for trachoma inflammation?",
    "choices": [
      {
        "id": 1,
        "text": "Follicles on the upper tarsal conjuctiva"
      },
      {
        "id": 2,
        "text": "Limbal follicles and Herbert's pits"
      },
      {
        "id": 3,
        "text": "Presence of trichiasis and entropion"
      },
      {
        "id": 4,
        "text": "Vascular pannus at the superior limbus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In epidemiological studies, the <strong>upper tarsal conjunctiva</strong> is the <strong>best index</strong> of <strong>trachomatous</strong> <strong>inflammation</strong> in the eye.</p>\n<p>For the purpose of diagnosis, <strong>any 2</strong> of the following <strong>diagnostic criteria</strong> must be present:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Follicles on the upper tarsal conjunctiva</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Limbal follicles and Herbert's pits</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Typical conjunctival scarring (trichiasis and entropion)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Vascular pannus, most marked at the superior limbus</li>\n</ul>\n<p>\u00a0The following image shows follicles on the upper tarsal conjunctiva seen in trachomatous inflammation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1496d95d2bf84055bcfb00b217adcce3x1024x660.JPEG"
    ]
  },
  {
    "text": "Which of the following is true about the organisms causing trachoma?",
    "choices": [
      {
        "id": 1,
        "text": "Morax- Axenfeld bacillus is the most widespread"
      },
      {
        "id": 2,
        "text": "Gonococcus is the most dangerous organism contributing to the disease process"
      },
      {
        "id": 3,
        "text": "Koch-Weeks bacillus is the most innocuous"
      },
      {
        "id": 4,
        "text": "C. trachomatis type D commonly causes permanent visual damage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Gonococcus</strong> is the <strong>most dangerous</strong> organism contributing to the disease process in <strong>trachoma.</strong></p>\n<p>Classic endemic trachoma is caused by&nbsp;<strong><em>Chlamydia trachomatis</em></strong> types<strong> A, B, C</strong>. &nbsp;Other pathogenic organisms that contribute to the disease process are:&nbsp;</p>\n<ul>\n<li>Morax-Axenfeld diplobacillus - most innocuous</li>\n<li>Kochs-Weeks bacillus - most widespread</li>\n<li>Gonococcus - most dangerous</li>\n</ul>\n<p>The <strong>types</strong> <strong>D-K</strong>&nbsp;of <em>C. trachomatis</em> are sexually transmitted and<em>&nbsp;</em>cause<em>&nbsp;</em><strong>inclusion conjunctivitis</strong>. It rarely causes permanent vision loss.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The elimination of neonatal tetanus is defined as:",
    "choices": [
      {
        "id": 1,
        "text": "< 1 case / 100 live births"
      },
      {
        "id": 2,
        "text": "< 1 case / 1000 live births"
      },
      {
        "id": 3,
        "text": "< 1 case / 10,000 live births"
      },
      {
        "id": 4,
        "text": "< 1 case / 1,00,000 live births"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The elimination of neonatal tetanus is defined as <strong>&lt;1 case per 1000 live births</strong> in every district.&nbsp;Maternal and neonatal tetanus (MNT) was eliminated in India in <strong>2015.</strong></p>\n<p>Since July 2018, TT vaccines have been replaced by the&nbsp;<strong>Td vaccine</strong> for dual protection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following diseases is called the 8th day disease?",
    "choices": [
      {
        "id": 1,
        "text": "Trench fever"
      },
      {
        "id": 2,
        "text": "Pertussis"
      },
      {
        "id": 3,
        "text": "Tetanus"
      },
      {
        "id": 4,
        "text": "Scarlet fever"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Neonatal tetanus</strong> is known as the <strong>8th-day disease.</strong>&nbsp;This is because the clinical features are often seen after the 7th day after birth due to infection of the umbilical cord.</p>\n<p>Option A: Trench fever is also called the 5-day fever.</p>\n<p>Option B: Pertussis is called the 100-day cough.</p>\n<p>Option D:&nbsp;Scarlet fever is also known as the 2nd disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 13-year-old girl is brought to the casualty a few hours after being injured by a rusty knife. According to her parents, her course of tetanus vaccination was completed 7 years ago. What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Full course of tetanus toxoid"
      },
      {
        "id": 2,
        "text": "Single dose of tetanus toxoid"
      },
      {
        "id": 3,
        "text": "Human tetanus immunoglobulin"
      },
      {
        "id": 4,
        "text": "Human tetanus immunoglobulin and single dose of toxoid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario is suggestive of a <strong>contaminated wound</strong> in a patient who received complete immunization against tetanus 7 years ago. She comes under <strong>category B</strong> of tetanus immunization and must be&nbsp;given a single dose of <strong>tetanus toxoid alone</strong>.</p>\n<p>The WHO recommends a 3-dose primary vaccination series with tetanus-diphtheria-containing vaccine followed by 3 booster doses. Ideally, there should be at least 4 years between booster doses.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '20 Stds And Surface Infections';
        let hierarchy = ["Marrow", "qBank", "Community Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>