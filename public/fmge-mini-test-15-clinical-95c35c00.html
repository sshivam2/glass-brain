<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 15 (Clinical) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2024
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "During a neck dissection, a surgeon accidentally damages the hypoglossal nerve. Which neck triangle is likely being dissected?",
    "choices": [
      {
        "id": 1,
        "text": "Muscular triangle"
      },
      {
        "id": 2,
        "text": "Carotid triangle"
      },
      {
        "id": 3,
        "text": "Posterior triangle"
      },
      {
        "id": 4,
        "text": "Submental triangle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The surgeon has accidentally injured the hypoglossal nerve, which has its major course in the <strong>carotid triangle.</strong></p>\n<p>The hypoglossal nerve leaves the skull through the hypoglossal canal. It then descends to the carotid triangle. Here, in the carotid triangle, the nerve makes a loop lateral to the internal and external carotid arteries. The nerve then ascends to the digastric triangle, reaches further up supplying the muscles of the tongue.</p>\n<p>Contents of the carotid triangle:</p>\n<ul>\n<li>Common carotid artery, internal and external carotid artery</li>\n<li>Branches of external carotid \u2013 superior thyroid, lingual, facial, ascending pharyngeal, and occipital artery</li>\n<li>Internal jugular vein</li>\n<li>Vagus nerve</li>\n<li>Hypoglossal nerve</li>\n<li>Spinal part of the accessory</li>\n<li>Sympathetic chain</li>\n<li>Ansa cervicalis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/389d40d36a1343419b112c71176642c0x1280x1274.JPEG"
    ]
  },
  {
    "text": "The agglutination test of a 2-day-old baby born to an Rh-negative mother is given below. The baby is at the risk of having hemolytic reactions due to the presence of?",
    "choices": [
      {
        "id": 1,
        "text": "A antigen"
      },
      {
        "id": 2,
        "text": "B antigen"
      },
      {
        "id": 3,
        "text": "H antigen"
      },
      {
        "id": 4,
        "text": "D antigen"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The baby is at the risk of having hemolytic reactions due to the presence of the <strong>D antigen</strong>. The given agglutination test shows <strong>agglutination only with</strong> the <strong>Rh antiserum</strong>. The&nbsp;<strong>Rh antigen</strong> in the given options is the <strong>D antigen</strong>.</p>\n<p>From the given agglutination test, the blood group of the baby is <strong>O-positive,&nbsp;</strong>as there is agglutination with the Rh antiserum, but no agglutination with A or B antisera.&nbsp;</p>\n<p>Rh alloimmunization occurs when an <strong>Rh-negative mother</strong> produces <strong>antibodies</strong> to Rh antigens due to an <strong>Rh-positive fetus.&nbsp;</strong></p>\n<p>In an Rh-positive individual, the presence of<strong>&nbsp;</strong>the D antigen is specific and carries antigenic properties responsible for hemolytic reactions.&nbsp;</p>\n<p>There are six common types of Rh antigens (C, D, E and c, d, e) each of which is called an <strong>Rh factor.</strong> The <strong>type D antigen</strong> is more antigenic than the others. Individuals who have the type D antigen are said to be Rh-positive, whereas those who don't have it are Rh-negative.</p>\n<p><strong>ABO blood typing</strong> is performed by mixing the individual's red blood cells with antisera that contains the various agglutinins on a slide and observing for the presence of clumping or agglutination.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ee6d0ac3b08a479d8b4624bac2c650fc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/56a9fca19b1f4dbc8d11e98777095dcax1280x917.JPEG"
    ]
  },
  {
    "text": "A 20-year-old female patient presents with the following finding as shown in the image below. On further investigation, she is found to have reduced levels of the enzyme UDP-glucuronosyltransferase. Which of the following disorders is she most likely suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "Type I Crigler-Najjar syndrome"
      },
      {
        "id": 2,
        "text": "Gilbert syndrome"
      },
      {
        "id": 3,
        "text": "Dubin Johnson syndrome"
      },
      {
        "id": 4,
        "text": "Rotor syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>With the given clinical scenario and with reduced levels of enzyme UDP-glucuronosyltransferase, the patient is most likely suffering from <strong>Gilbert syndrome</strong>.\u00a0<br /><br /><strong>Gilbert syndrome</strong> is an autosomal recessive condition characterized by <strong>decreased activity</strong> of the <strong>enzyme\u00a0UDP-glucuronosyltransferase</strong>, which is responsible for the conjugation of bilirubin. This leads to <strong>unconjugated hyperbilirubinemia</strong>, that presents as yellowish discolouration of the sclera (icterus/jaundice) as seen in the given image.</p>\n<p>Individuals with Gilbert syndrome are usually <strong>asymptomatic</strong> except for <strong>intermittent episodes of jaundice</strong>, which usually occurs for the first time during <strong>adolescence</strong>, due to changes in the concentration of sex hormones.\u00a0Some patients may have complaints like malaise, fatigue, nausea, anxiety, loss of appetite, and abdominal discomfort. Symptoms are usually precipitated by <strong>triggers</strong> such as fasting, intercurrent illness, menstruation, and dehydration.</p>\n<div class=\"page\" title=\"Page 2601\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Administration of <strong>phenobarbital</strong> shows normalisation of the serum bilirubin concentration and hepatic bilirubin clearance.</p>\n<p>Gilbert syndrome usually doesn't require any treatment.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Other options:<br /><br />Option A: <strong>Type I Crigler-Najjar syndrome</strong> is characterized by a complete deficiency of the enzyme\u00a0UDP-glucuronosyltransferase. It usually presents as severe congenital jaundice (serum bilirubin levels over 20 mg/dL) and accompanying brain damage.<br /><br />Options C and D: <strong>Dubin Johnson</strong> and <strong>Rotor syndrome</strong>\u00a0both have\u00a0elevated conjugated bilirubin in the blood, and are due to defective secretion of conjugated bilirubin into the bile.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/239cf30b48884c9598691ba84680bb40.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old man complains of shortness of breath and coughing at night that awakens him from sleep. He is a known case of COPD. On examination, distended neck veins and S3 sounds were noted. The bronchoalveolar lavage of this patient is given below. Identify the marked cells.",
    "choices": [
      {
        "id": 1,
        "text": "Inflammatory cells"
      },
      {
        "id": 2,
        "text": "Siderophages"
      },
      {
        "id": 3,
        "text": "Type I pneumocytes"
      },
      {
        "id": 4,
        "text": "Cardiac smooth muscle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario is suggestive of<strong>&nbsp;</strong>heart failure. The image shows <strong>heart failure cells</strong>, which are&nbsp;<strong>siderophages </strong>or&nbsp;<strong>hemosiderin-containing macrophages</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4b3da306d8d44bc98c914efd936ea1d.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bfd1d3ae980d467785cc750da38e7df4x1280x1570.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ee5a6dd878904ea890a09b3fac62bd3fx640x604.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baa777aa8f4744798d52a9427908e328x1280x1856.JPEG"
    ]
  },
  {
    "text": "A patient has complaints of fever with a mild headache associated with some difficulty in swallowing. A throat examination reveals swollen glands and a thick, whitish membrane over his tonsils which bleeds on scraping the lesion.  A sample is taken from the exudate and a gram stain is done, which is as shown below. What is the organism associated with the disease?",
    "choices": [
      {
        "id": 1,
        "text": "Parvovirus B19"
      },
      {
        "id": 2,
        "text": "HHV6"
      },
      {
        "id": 3,
        "text": "Corynebacterium diphtheriae"
      },
      {
        "id": 4,
        "text": "Beta hemolytic streptococci"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The history of <strong>white membrane </strong>over the tonsils and gram stain image showing <strong>gram-positive bacilli </strong>in<strong> Chinese letter arrangement</strong> points towards the diagnosis of <strong>faucial diphtheria </strong>caused by<strong> <em>Corynebacterium diphtheriae.</em></strong></p>\n<p><em>Corynebacterium diphtheria&nbsp;</em>is a gram-positive bacillus with clubbing at both ends. They possess characteristic polymetaphosphate granules also called <strong>metachromatic granules </strong>or<strong> Babes-Ernst granules</strong>.&nbsp;On microscopy, the bacilli are arranged at angles to each other which is seen as the <strong>Chinese letter</strong> or <strong>cuneiform</strong> pattern.&nbsp;</p>\n<p><strong>Albert&rsquo;s stain</strong> or <strong>Neisser&rsquo;s stain</strong>&nbsp;or <strong>Loeffler's methylene blue</strong> are used to demonstrate the metachromatic granules of <em>Corynebacterium diphtheria.</em> These granules are called as <strong>polar bodies</strong> as they are situated at the ends of the bacilli.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/94299d9a7cb34903a60d29f07c605ac9.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f5251e51f1924a019ee3899cc68ff786x1280x2413.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6547702439144d15ba7e700253a8f4d9x720x1019.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b8f618e599d84c3eac0868cdb45484e1x268x332.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2ed779b7b0943f289553ab773fa0af9x1280x1511.JPEG"
    ]
  },
  {
    "text": "A 54-year-old woman presented to the clinic with difficulty in vision. She is a known case of rheumatoid arthritis for which she has been on medication for many years along with drugs for the management of her diabetes and hypertension. Fundus examination of the patient shows the following finding. Which of the following drug could have caused this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Sulfonylurea"
      },
      {
        "id": 2,
        "text": "Captopril"
      },
      {
        "id": 3,
        "text": "Hydroxychloroquine"
      },
      {
        "id": 4,
        "text": "Nonsteroidal anti-inflammatory drugs"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image&nbsp;depicts the<strong> bull&rsquo;s eye maculopathy </strong>which can be caused by<strong> hydroxychloroquine</strong>.<strong>&nbsp;</strong>This patient's history of being treated for rheumatoid arthritis is the most probable reason for the lesion.</p>\n<p>Bull's-eye maculopathy refers to the ophthalmoscopic appearance of a<strong> central area</strong> of<strong> retinal pigment epithelial depigmentation</strong> surrounded by relatively normal retinal pigment epithelium, giving a \"bulls-eye\" appearance to the macula.</p>\n<p><strong>Hydroxychloroquine</strong>, which is generally used for the treatment of rheumatoid arthritis, toxicity causes bull&rsquo;s eye maculopathy. Chloroquine binds to melanin in the retinal pigment epithelium,&nbsp;causing&nbsp;cytotoxic effects.</p>\n<p>Causes of bull&rsquo;s eye maculopathy include:</p>\n<ul>\n<li>Chloroquine</li>\n<li>Hydroxychloroquine</li>\n<li>Congenital cone dystrophy</li>\n</ul>\n<p>Other adverse effects of chloroquine:</p>\n<ul>\n<li>Nail bed and mucosal membrane discoloration</li>\n<li>Irreversible retinopathy</li>\n<li>Ototoxicity</li>\n<li>Toxic myopathy</li>\n<li>Cardiopathy</li>\n<li>Peripheral neuropathy</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a8b96202a0d4910a43d7c1f31323a4b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c699ca5e02ed49288892c025fec28dcfx500x333.PNG"
    ]
  },
  {
    "text": "During the autopsy of a patient who died of suspected poisoning, it was noted that he had pink-coloured skin and mucosa. Prior to death, he had a bitter almond smell from his breath and frothy discharge.  What is the most likely cause of death in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Carbon monoxide poisoning"
      },
      {
        "id": 2,
        "text": "Cyanide poisoning"
      },
      {
        "id": 3,
        "text": "Hydrogen sulphide poisoning"
      },
      {
        "id": 4,
        "text": "Datura poisoning"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario points towards <strong>cyanide poisoning.</strong></p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Poisoning by cyanide:</strong></p>\n<ul>\n<li>Cyanides are protoplasmic cytotoxic poisons.</li>\n<li>They act by inhibiting cytochrome oxidases for utilising O2 in a cell, leading to internal asphyxia (cellular asphyxia), leading to death.</li>\n<li>It can also act on other enzymes mildly.</li>\n<li><strong>It also acts as a corrosive on mucosa.</strong></li>\n<li>Inhalation brings about death instantaneously by respiratory arrest.</li>\n</ul>\n<p><strong>Clinical Features in small doses</strong></p>\n<ul>\n<li>Saltish taste in mouth</li>\n<li>Smell of bitter almonds to the breath</li>\n<li>Salivation, nausea, vomiting</li>\n<li>Cyanosis</li>\n</ul>\n<p><strong>Clinical Features in large doses</strong></p>\n<ul>\n<li>Rapid loss of consciousness, convuslions, coma, death</li>\n<li>Very often found deadat the scene&nbsp;</li>\n</ul>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Treatment of cyanide poisoning:</p>\n<ul>\n<li>Nitrites&nbsp;<strong>(Amyl nitrite,Sodium nitrite)</strong>&nbsp;are given to convert haemoglobin to methaemoglobin.</li>\n<li>Cyanides combine with methaemoglobin to form cyanmethaemoglobin , which in the presence of&nbsp;<strong>rhodonase &amp; sodium thiosulphate</strong>&nbsp;converts cyanide to thiocyanate which is excreted in urine.</li>\n</ul>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Other antidotes:</strong></p>\n<ul>\n<li><strong>Hydroxycobalamin (vitamin B12)</strong></li>\n<li><strong>Dicobalt EDTA</strong></li>\n<li><strong>PAPP</strong>(Para amino propio phenol)</li>\n</ul>\n</div>\n</div>\n<div class=\"ng-scope\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old girl is brought to you by her mother with complaints of mouth breathing. She has a flat, expressionless, long face with an open mouth. On examination, a high-arched palate and crowded upper teeth are noted. The X-ray is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lingual tonsils"
      },
      {
        "id": 2,
        "text": "Quinsy"
      },
      {
        "id": 3,
        "text": "Tonsillar hypertrophy"
      },
      {
        "id": 4,
        "text": "Adenoid hypertrophy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario along with the x-ray which shows <strong>enlarged adenoids</strong>&nbsp;suggests the diagnosis of <strong>adenoid hypertrophy</strong>.</p>\n<p>Clinical features:</p>\n<ul>\n<li><strong>Nasal obstruction</strong> is the most common symptom. This leads to <strong>mouth breathing</strong>. Nasal obstruction also interferes with feeding or suckling in a child. As respiration and feeding cannot take place simultaneously, a child with adenoid enlargement <strong>fails to thrive</strong>.</li>\n<li>Nasal discharge, sinusitis, and epistaxis.</li>\n<li>Bilateral conductive hearing loss and <strong>serous otitis media</strong> due to eustachian tube obstruction.</li>\n<li><strong>Rhinolalia clausa</strong> - hyponasal voice.</li>\n<li><strong>Adenoid facies</strong> - elongated face with a dull expression, pinched up nose, <strong>absent nasolabial crease</strong>, open mouth, prominent and crowded upper teeth.</li>\n<li><strong>Sleep apnoea</strong> - chronic cases lead to hypoxemia and pulmonary vasoconstriction. This consequently leads to pulmonary hypertension and cor pulmonale.</li>\n<li><strong>Aprosexia</strong> - lack of concentration.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8dbe7492304347b2a86da881a068ce4c.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/5ff524698c534cee99df0c96654e9743x503x451.PNG",
      "https://cdn1.dailyrounds.org/uploads/76d9a8e4d298497dacc46010d9e7769cx498x429.JPEG"
    ]
  },
  {
    "text": "A 60-year-old diabetic male presents with a history of decreased vision. Fluorescein angiography showed the following image. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Mild non-proliferative diabetic retinopathy"
      },
      {
        "id": 2,
        "text": "Severe non-proliferative diabetic retinopathy"
      },
      {
        "id": 3,
        "text": "Bird shot choroidopathy"
      },
      {
        "id": 4,
        "text": "Proliferative diabetic retinopathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image of&nbsp;fundus fluorescein angiography (FFA) depicts <strong>neovascularization</strong>, which is the&nbsp;hallmark of <strong>proliferative diabetic retinopathy.</strong></p>\n<p>The neovascularization arises from the optic nerve head; there is <strong>neovascularization of the disc (NVD)</strong>&nbsp;along the large vessels and&nbsp;<strong>neovascularization elsewhere (NVE)</strong>.</p>\n<p>The treatment available for proliferative diabetic retinopathy is <strong>photocoagulation of the ischaemic areas</strong> to reduce the metabolic demand and decrease or prevent the release of vasoproliferative factors.</p>\n<p>Stages and fundus picture in diabetic retinopathy:</p>\n<p><strong>Background Diabetic Retinopathy:</strong></p>\n<ul>\n<li>Microaneurysms&nbsp;</li>\n<li>Dot and Blot hemorrhages&nbsp;</li>\n<li>Exudates</li>\n</ul>\n<p><strong>Preproliferative Diabetic Retinopathy&nbsp;</strong>(indicates progressive retinal ischemia):</p>\n<ul>\n<li>Intra-retinal microvascular abnormalities</li>\n<li>Venous changes (such as beading)</li>\n<li>Cotton wool spots</li>\n<li>Deep retinal hemorrhages</li>\n</ul>\n<p><strong>Proliferative Diabetic Retinopathy:</strong></p>\n<ul>\n<li>NeoVascularization of the optic Disc (NVD)</li>\n<li>NeoVascularization Elsewhere in the periphery of the fundus (NVE)</li>\n</ul>\n<p><strong>Advanced Diabetic Eye Disease:</strong></p>\n<ul>\n<li>Tractional retinal detachment</li>\n<li>Vitreous hemorrhage</li>\n<li>Neovascular glaucoma</li>\n</ul>\n<p>Diabetic Maculopathy is a separate entity that is applied to the changes that occur in the macula such as macular edema or ischemia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/12dfd5efdb02411d8b74afdb158db902.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/09b727d3cc0e48dd88f2072026e2b76ex1280x1359.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8b187ab86fb142ee808b67139fcfb3f4x512x399.PNG"
    ]
  },
  {
    "text": "A 20 yr old man presents with fever and malaise for 4 days and a rash for the past 2 days. It was initially on his back, but then it appeared on his arms and legs too. On examination, he has a pleomorphic rash with areas of papules, vesicles, and a few crusts. Until when should the patient be isolated?",
    "choices": [
      {
        "id": 1,
        "text": "Until fever and malaise subside"
      },
      {
        "id": 2,
        "text": "Until all lesions disappear"
      },
      {
        "id": 3,
        "text": "Until he finishes a course of acyclovir"
      },
      {
        "id": 4,
        "text": "Until all lesions are crusted"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient most likely has <strong>chickenpox</strong> and needs to <strong>isolate</strong> himself until all the <strong>lesions are crusted</strong>, which takes approximately 6 days from onset of rash. Only <strong>symptomatic treatment</strong> is needed in this case. Acyclovir is recommended only if administered within 24 hours.</p>\n<p>The period of infectivity is from ~48 h before the onset of the vesicular rash, during the period of vesicle formation that generally lasts 4&ndash;5 days, and until all vesicles are crusted.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9 month old baby with diarrhoea is feeding well and is thirsty. Skin pinch when done returns in 4 seconds. What is the management?",
    "choices": [
      {
        "id": 1,
        "text": "200-400 ml of ORS to be given in the first four hours."
      },
      {
        "id": 2,
        "text": "400-700 ml of ORS to be given in the first four hours."
      },
      {
        "id": 3,
        "text": "700-900 ml of ORS to be given in the first 4 hours."
      },
      {
        "id": 4,
        "text": "In addition to the usual fluid intake, 100-200 ml should be given after each loose stool."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the IMNCI classification, the baby has 'some dehydration' and comes under Plan B.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/29e4fb807eef409285f789dc6b929f0ex780x458.JPEG"
    ]
  },
  {
    "text": "You are a medical officer evaluating the community health meal programs in your area. One of the program's objectives is to attract more children to maintain attendance in school. Which one of the following statements about this meal program is correct?",
    "choices": [
      {
        "id": 1,
        "text": "Provides 1/3rd of daily energy requirement and 1/2 of daily protein requirement"
      },
      {
        "id": 2,
        "text": "Provides 1/2 of daily energy requirement and 1/3rd of daily protein requirement"
      },
      {
        "id": 3,
        "text": "Provides 1/4th of daily energy requirement and 1/2 of daily protein requirement"
      },
      {
        "id": 4,
        "text": "Provides 1/3rd of daily energy requirement and 1/4th of daily protein requirement"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct statement regarding the mid-day meal program is the meal should <strong>provide at least 1/3rd of the daily energy requirement and 1/2 of the daily protein requirement.</strong>\u00a0</p>\n<p>The mid-day meal program (MDMP)/ school lunch program is catered to provide meals for school children.\u00a0It\u00a0is offered to school children in an effort to persuade more children to enroll in schools thereby improving <strong>children's literacy</strong>. It aims to <strong>maintain attendance</strong> in schools. Currently, it functions under the broad coverage of the<strong>\u00a0minimum needs program</strong>.<strong>\u00a0</strong>It is run by the<strong> Ministry of Education</strong>.</p>\n<p>The meal provided under the MDMP should <strong>only</strong> be a\u00a0<strong>supplement</strong>\u00a0and not a substitute for home diets. It must cover at least<strong>\u00a01/2 </strong>of the <strong>total daily protein requirement </strong>and<strong> 1/3rd </strong>of<strong>\u00a0the total daily energy requirement</strong>\u00a0for children in schools. The<strong>\u00a0cost </strong>of meals should be reasonably<strong> low</strong>. The meals should be <strong>easy </strong>to<strong> cook</strong>\u00a0<strong>in schools</strong>.\u00a0<strong>Locally available foods</strong>\u00a0must be used whenever possible. The <strong>menu</strong> should be\u00a0<strong>regularly changed</strong>\u00a0to avoid monotony.</p>\n<p>The <strong>mid-day meal scheme</strong> functions under the ministry of Human Resources Development as a centrally sponsored scheme. Under this, a cooked mid-day meal with at least <strong>300 calories</strong>\u00a0and <strong>8-12 grams</strong> of <strong>protein</strong> is provided to all children of <strong>classes I-V</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes to ED with fever and headache. On examination he has neck stiffness. CSF analysis was done and it shows the following findings Opening pressure \u2013 Increased, Proteins- Mildly increased, Glucose \u2013 Normal, Lymphocytes \u2013 Increased. Most likely diagnosis is:",
    "choices": [
      {
        "id": 1,
        "text": "TB"
      },
      {
        "id": 2,
        "text": "Neisseria Gonorrhoea"
      },
      {
        "id": 3,
        "text": "Cryptococcus"
      },
      {
        "id": 4,
        "text": "Coxsackie"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Meningitis with <strong>normal glucose</strong> is a tell-tale evidence <strong>of viral meningitis</strong>.</p>\n<p><strong>CSF findings in Viral meningitis</strong>:</p>\n<ul>\n<li>Mild increase in CSF protein/pressure</li>\n<li>Normal glucose</li>\n<li>Mild increase in lymphocytes in CSF.</li>\n<li></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman from Sweden comes to the hospital complaining of blurry vision from the past 3 days. Her symptoms are aggravated when she takes a hot shower. She also complains of an electric shock-like sensation radiating down her spine into her legs. This is the first time that such an attack has happened. Which of the following drugs is used in the treatment of the first attack of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Glatiramer"
      },
      {
        "id": 2,
        "text": "Methylprednisolone"
      },
      {
        "id": 3,
        "text": "IFN-\u03b2-1a"
      },
      {
        "id": 4,
        "text": "Natalizumab"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient's clinical features are suggestive of <strong>multiple sclerosis</strong>. <strong>Glucocorticoids</strong> are used in the clinical management of either first attacks or acute exacerbations.</p>\n<p>Intravenous methylprednisolone administration at a dose of 500&ndash;1000 mg/day for 3-5 days, followed by a course of oral prednisolone beginning at a dose of 60&ndash;80 mg/day and gradually tapered over 2 weeks is given.</p>\n<p>These medications reduce the severity and shorten the duration of attacks.</p>\n<p>Some of the disease-modifying therapies for relapsing forms of multiple sclerosis are:</p>\n<div class=\"page\" title=\"Page 3584\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>&nbsp;<strong>IFN-&beta;-1a</strong> (Avonex)</li>\n<li><strong>IFN-&beta;-1a</strong> (Rebif)</li>\n<li><strong>Glatiramer acetate&nbsp;</strong></li>\n<li><strong>Natalizumab</strong>&nbsp;</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 3584\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old woman comes for evaluation of recurrent fetal losses. She has had 4 spontaneous abortions all at <10 weeks of gestational age, and has a history of deep vein thrombosis. There is no history of SLE.  Which of the following antibodies are not useful in making a diagnosis in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lupus anti coagulant"
      },
      {
        "id": 2,
        "text": "Anti cardiolipin"
      },
      {
        "id": 3,
        "text": "Anti beta-2 glycoprotein"
      },
      {
        "id": 4,
        "text": "Anti beta-2 microglobulin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical history of &gt;3 spontaneous abortions at &lt;10 weeks of gestational age along with a history of deep vein thrombosis suggests a diagnosis of <strong>antiphospholipid syndrome. </strong>Anti beta-2 microglobulin is not useful in the diagnosis of this condition.</p>\n<p>For the diagnosis of antiphospholipid syndrome, high titers of <strong>one or more</strong> of the following three should be demonstrated along with at least one clinical symptom of thrombosis or pregnancy complications.</p>\n<ul>\n<li><strong>Lupus anticoagulant (LA)</strong> -&nbsp;<strong>most specific</strong></li>\n<li><strong>Anticardiolipin (aCL) antibodies</strong> - <strong>most sensitive</strong></li>\n<li><strong>Anti-beta-2 glycoprotein 1 antibodies</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are on duty in the gastroenterology department as a second-year resident, evaluating patients for upper and lower gastrointestinal lesions. What will be your diagnosis of the following images?",
    "choices": [
      {
        "id": 1,
        "text": "A- Barrett's esophagus, B- Mallory Weiss tear"
      },
      {
        "id": 2,
        "text": "A- Mallory Weiss tear, B- Barrett's esophagus"
      },
      {
        "id": 3,
        "text": "A- Crohn\u2019s Disease, B- Ulcerative Colitis"
      },
      {
        "id": 4,
        "text": "A- Ulcerative Colitis, B- Crohn\u2019s Disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Image A shows\u00a0<strong>ulcerative colitis</strong> and image B shows\u00a0<strong>Crohn's disease</strong>.</p>\n<p>The given<strong> image A</strong> shows continuous involvement of mucosa with no normal mucosa in between, which indicates <strong>ulcerative colitis</strong>.\u00a0</p>\n<p><strong>Ulcerative colitis</strong>\u00a0is an\u00a0<strong>inflammatory bowel disease</strong>\u00a0resulting in\u00a0<strong>superficial erosions</strong>\u00a0confined to the\u00a0<strong>mucosa</strong>\u00a0and\u00a0<strong>submucosa</strong>\u00a0of the colon. It starts from the\u00a0<strong>rectum</strong>\u00a0and extends proximally in a continuous manner.</p>\n<p><strong>Colonoscopy</strong>\u00a0shows loss of typical vascular pattern, granularity, friability, and ulceration involving the distal rectum, extending proximally in symmetric, continuous, and circumferential patterns.\u00a0Fistula is not a complication of ulcerative colitis.\u00a0</p>\n<p>Image<strong> B\u00a0</strong>shows a\u00a0<strong>cobblestone appearance</strong>\u00a0seen in\u00a0<strong>Crohn's disease</strong>. Normal mucosa in between the ulcers leads to this appearance. Fine granular mucosa is the earliest barium enema finding in Ulcerative colitis.\u00a0<strong>Fistula</strong> is seen with <strong>Crohn\u2019s disease</strong>.</p>\n<p>Crohn's disease may occur in any area of the GI tract, but the\u00a0most common sites involved at presentation are the<strong>\u00a0terminal ileum, ileocecal valve, and cecum.\u00a0</strong>It is<strong>\u00a0associated with smoking.</strong></p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">\u00a0In Crohn's disease, the following are seen:</p>\n<ul>\n<li><strong>Aphthous</strong>\u00a0<strong>ulcers\u00a0</strong>- Small, shallow ulcers surrounded by erythema</li>\n<li><strong>Longitudinal ulcers -</strong>\u00a0Linear or serpiginous deep ulcers\u00a0</li>\n<li>Cobblestone appearance - Deep, longitudinal ulcerations interlaced with intervening normal mucosa</li>\n<li><strong>Strictures</strong>\u00a0</li>\n<li>Fistulas</li>\n</ul>\n</div>\n</div>\n<p>Other options:</p>\n<p><strong>Barrett's esophagus</strong> is a condition in which the mucosal lining of the swallowing tube that connects the mouth to the stomach (esophagus) becomes damaged by acid reflux, which causes the lining to thicken and become red. It is associated with an increased risk of developing esophageal cancer.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8f8d9d09d4e349788f7d1a158694588b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d787db00369f450d880380069738a1d1x376x342.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5d0f7193a874dbaa5d87694b9ff7355x722x558.JPEG"
    ]
  },
  {
    "text": "An elderly male patient presented with painless, gross hematuria. He was evaluated for the same, and a cystoprostatectomy was done. The gross specimen image is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Leukoplakia"
      },
      {
        "id": 2,
        "text": "Bladder carcinoma"
      },
      {
        "id": 3,
        "text": "Prostate carcinoma"
      },
      {
        "id": 4,
        "text": "Schistosomiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image of the <strong>cystoprostatectomy</strong> specimen shows a large, fungating growth from the bladder wall involving the entire bladder with the two lobes of the prostate not being much affected. The most likely diagnosis is <strong>bladder carcinoma</strong>.&nbsp;</p>\n<p><strong>Painless</strong>,<strong> gross hematuria </strong>is&nbsp;the most common symptom that&nbsp;<span style=\"font-size: 14px;\">is indicative of a bladder carcinoma until proven otherwise. S</span>ubsequent clots and urinary retention can occur. Increased frequency and discomfort during urination may be seen. It can lead to pelvic pain due to extravesical spread, loin pain due to hydronephrosis, and suprapubic pain if the nerve is involved.</p>\n<p>Depending upon the depth of invasion, bladder carcinoma is divided into 3 groups:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Flat, non-invasive carcinoma in situ (CIS)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Non-muscle invasive bladder cancer - does not invade detrusor muscle but can invade lamina propria. It accounts for 70% of cases.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Muscle-invasive bladder cancer - invades the detrusor muscle.</li>\n</ul>\n<p>Diagnosis and staging are done by <strong>cystoscopy </strong>and<strong> resection </strong>of the tumor. A bimanual examination should be performed after the resection of the tumor. Complete urinary tract imaging is required using contrast computed tomography (CT) or magnetic resonance (MR) urography.</p>\n<p>Management:</p>\n<ul>\n<li>Non-muscle invasive bladder cancer - Endoscopic resection and intravesical instillations of mitomycin C/ epirubicin, immunotherapy with regular intravesical instillations of Bacille Calmette-Guerin (BCG)</li>\n<li>Muscle invasive bladder cancer - Radical cystectomy along with urinary diversion procedure and lymph node dissection +/- neoadjuvant chemotherapy</li>\n</ul>\n<p>Other options:&nbsp;</p>\n<p>Option A- <strong>Leukoplakia</strong> is <strong>squamous metaplasia</strong> of the bladder characterized by white particles (keratin) in the urine. Diffuse leukoplakia of the bladder is <strong>pre-malignant</strong>&nbsp;and can lead to squamous cancer of the bladder. It has to be assessed by cystoscopy and localized areas may be resected.</p>\n<p>Option C-&nbsp;<strong>Prostate carcinoma</strong> presents with symptoms only during <strong>advanced</strong> disease. It causes bladder outlet obstruction, pelvic pain, hematuria, and renal failure. It is surgically managed by radical prostatectomy, which only involves the removal of the prostate and seminal vesicles and preserving the bladder. Unlike the given gross specimen one or more lobes are predominantly involved in prostatic carcinoma.</p>\n<p>Option D- <strong>Schistosomiasis</strong> of the bladder is a parasitic infection by<em> Schistosoma haematobium</em>. Cystoscopy would show nodules, pseudotubercles, ulceration, or sandy patches. Chronic infection can lead to squamous cell carcinoma of the bladder.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fb8dd6485a0f42328547676e78567d47.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old man is brought to the emergency after being trapped in a landslide for 3-4 hours. He has multiple rib fractures, pneumothorax, hemothorax, and lab findings of elevated creatinine, creatine phosphokinase, hyperkalemia, metabolic acidosis, and hypocalcemia. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Fat embolism"
      },
      {
        "id": 2,
        "text": "Crush syndrome"
      },
      {
        "id": 3,
        "text": "Hemorrhagic shock"
      },
      {
        "id": 4,
        "text": "Acute compartment syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The history of prolonged entrapment, clinical features, and laboratory findings are all suggestive of <strong>crush syndrome.</strong>\u00a0</p>\n<p>Crush syndrome can result when a <strong>limb is compressed</strong> for a prolonged period (e.g. getting crushed or entrapped in a vehicle or machinery) and after extended use of a <strong>pneumatic antishock garment</strong>. This results in hypoperfusion and <strong>myonecrosis</strong> in the crushed limb. When the limb is released from the compression, toxic metabolites get released to cause reperfusion injury.\u00a0</p>\n<p>Crush syndrome can result in a <strong>systemic reaction</strong> due to tissue necrosis. Free myoglobin can lead to <strong>acute tubular necrosis</strong> and <strong>renal failure</strong>. Myonecrosis can lead to <strong>metabolic acidosis</strong> with <strong>hyperkalemia</strong> and <strong>hypocalcemia</strong>. The procoagulants that escaped into the systemic circulation can produce <strong>systemic coagulopathy</strong>.\u00a0</p>\n<p>Clinical features:</p>\n<ul>\n<li>The affected limb is pulseless, red, and swollen</li>\n<li>In some cases, sensation and muscle power may be lost.</li>\n</ul>\n<p><strong>Management of crush syndrome</strong></p>\n<ul>\n<li>Encouraging high urine flow, along with alkalization of urine with sodium bicarbonate to prevent precipitation of myoglobin in the renal tubules.</li>\n<li>Renal hemofiltration if there is oliguria or renal failure.</li>\n<li>If compartment syndrome is confirmed, then fasciotomy is performed.</li>\n<li>Radical excision of necrosed muscle to avoid sepsis.</li>\n<li>Aggressive management of the open wound.</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Fat embolism</strong>\u00a0is the presence of fat globules in vital organs and peripheral circulation after a fracture of the long bone or other major trauma. It is usually seen 2-3 days following the injury. Clinical features include tachycardia, rise in temperature, breathlessness, and mild mental confusion.<strong>\u00a0</strong></p>\n<p>Option C: <strong>Hemorrhagic shock</strong> is the most common cause of shock in surgical or trauma patients. Here the patient presents with agitation, <strong>cold clammy extremities, hypotension, tachycardia, and weak peripheral pulses</strong>. Acidosis and elevated lactate levels may be seen due to hypoperfusion of tissues.</p>\n<p>Option D:<strong>\u00a0Acute compartment syndrome</strong>\u00a0refers to an elevation of the intracompartmental pressure (ICP) which increases the risk for tissue ischemia and necrosis. It can occur following fractures(commonly) or soft tissue injuries and is a<strong> localized condition involving the affected limb</strong>. The clinical features include <strong>pain, paraesthesia, pallor, paralysis, and pulselessness</strong>. The diagnosis is confirmed by measuring the intracompartmental pressures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient underwent laparoscopic cholecystectomy and was discharged after removing the drain tube on the first postoperative day. On day two, the patient came back to the hospital with complaints of increasing abdominal pain and was febrile on examination. On ultrasound examination, there was a 5 x 5 cm collection in the subhepatic space. What is the most likely cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Infection"
      },
      {
        "id": 2,
        "text": "Surgical site pain"
      },
      {
        "id": 3,
        "text": "Bile leak"
      },
      {
        "id": 4,
        "text": "Retained gall stones"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical situation suggests\u00a0<strong>a bile duct injury</strong> following laparoscopic cholecystectomy leading to a bile leak.\u00a0</p>\n<p><strong>Bile duct injury </strong></p>\n<ul>\n<li>Usually is manifested in the <strong>postoperative period</strong></li>\n<li><strong>Clinical features </strong>\n<ul>\n<li>Fever</li>\n<li>Increasing abdominal pain</li>\n<li>Jaundice</li>\n<li>Bile leakage from an incision</li>\n</ul>\n</li>\n</ul>\n<p><strong>Diagnosis</strong></p>\n<p><strong>Imaging:</strong>\u00a0Ultrasonography</p>\n<ul>\n<li>To assess for a fluid collection and to evaluate the biliary tree<strong>\u00a0</strong></li>\n</ul>\n<p><strong>Treatment strategy</strong></p>\n<ul>\n<li><strong>Control of infection, limiting inflammation </strong>\n<ul>\n<li>Percutaneous drainage of periportal fluid collections</li>\n<li>Parenteral antibiotics</li>\n</ul>\n</li>\n<li><strong>Clear and thorough delineation </strong>of the<strong> entire biliary anatomy</strong>\n<ul>\n<li>Magnetic resonance cholangiopancreatography<em>\u00a0</em>(MRCP) or percutaneous transhepatic cholangiography (PTC)</li>\n<li>Endoscopic retrograde cholangiopancreatography\u00a0(ERCP), especially if a cystic-duct stump leak is suspected</li>\n</ul>\n</li>\n<li><strong>Reestablishment of biliary-enteric continuity (surgery)</strong>\n<ol>\n<li>Tension-free, mucosa-to-mucosa anastomosis</li>\n<li>Roux-en-Y hepaticojejunostomy</li>\n</ol>\n</li>\n</ul>\n<p>\u00a0Option A: <strong>Infection</strong> is very unlikely to present in the immediate postoperative period with a pus collection of 5x5cms particularly after laparoscopic cholecystectomy.</p>\n<p>Option B: <strong>Surgical site pain</strong> will not be severe and diffuse instead it is localized and bearable.</p>\n<p>Option D: Retained <strong>gallstones</strong> are very unlikely.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young male patient, with a history of blunt abdominal trauma, was brought to the ER. As he was hemodynamically unstable, and FAST examination revealed free fluid, an immediate laparotomy was done. Since severe bleeding from the liver was present, the following manoeuvre was done to visualize the injury but, the bleeding continued even after clamping. What could be the probable source of bleeding in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatic arterial bleeding"
      },
      {
        "id": 2,
        "text": "Hepatic vein bleeding"
      },
      {
        "id": 3,
        "text": "Portal venous bleeding"
      },
      {
        "id": 4,
        "text": "Both hepatic arterial and Portal venous bleeding"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows clamping of hepatoduodenal ligament, which is done in&nbsp;<strong>Pringle maneuver</strong> and bleeding from<strong>&nbsp;hepatic vein</strong>&nbsp;will continue even after clamping of hepatoduodenal ligament.</p>\n<p><strong>Pringle maneuver:</strong></p>\n<ul>\n<li>When&nbsp;severe bleeding from the liver is present, the Pringle maneuver is a valuable adjunct to slow blood flow enough to visualize the injury.</li>\n<li>The hepatoduodenal ligament is encircled with a vessel loop or vascular clamp to occlude hepatic blood flow from the hepatic artery and portal vein.</li>\n<li>This maneuver helps <strong>distinguish hepatic arterial and portal venous bleeding from hepatic vein bleeding, which will persist with the hepatoduodenal ligament clamped.</strong></li>\n<li>In many cases, the liver laceration can then be explored and any actively bleeding vessels controlled with suture ligation.</li>\n<li>Hepatic parenchyma that appears to be devitalized should be debrided and drains should be placed when injuries appear to be at risk for a bile leak.</li>\n<li>A vascularized pedicle of the omentum may reduce parenchymal bleeding and promote healing of the laceration when it is packed with the liver injury.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c27d5ffb7bdd4464b5f21eea421bfa85.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/568b5a113a00471cb0fd7f9c579fba36x300x318.PNG"
    ]
  },
  {
    "text": "A P5 female bleeds profusely after delivery of the placenta. You initiate IV fluids with oxytocin.  However, the patient continues to bleed over the next 10 min even after adequate uterine massage. On examination,  she is tachycardic, hypotensive and the uterus is soft and boggy.  What is the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "Ligation of internal iliac arteries"
      },
      {
        "id": 2,
        "text": "Carry out balloon tamponade"
      },
      {
        "id": 3,
        "text": "Ligation of uterine arteries"
      },
      {
        "id": 4,
        "text": "Hysterectomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The next step of management is to carry\u00a0out <strong>balloon tamponade</strong>.</p>\n<ul>\n<li>When the uterine bleeding is unresponsive to uterotonic agents, <strong>bimanual uterine compression</strong> can be performed, <strong>IV lines</strong> must be placed and volume resuscitation started.</li>\n<li>A <strong>Bakri postpartum balloon</strong> may be inserted and inflated to tamponade the endometrial cavity.\u00a0</li>\n</ul>\n<p>Other options mentioned are surgical methods of management. These are tried after all forms of medical management have failed.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d74eb474b78b4133b76f0fd5c6406b98x1280x2558.JPEG"
    ]
  },
  {
    "text": "A 62-year-old female with history of ovarian carcinoma in the mother achieved menopause with smooth transition. And she is on hormone replacement therapy. She developed abdominal pain and on examination the right adnexal mass was palpable, non tender. On USG examination she has a 3 X 3 cm smooth cyst in her ovary. Which is the next step",
    "choices": [
      {
        "id": 1,
        "text": "Reassure and advise regular follow up once in 6 months"
      },
      {
        "id": 2,
        "text": "Confirm USG findings by ordering CT scan"
      },
      {
        "id": 3,
        "text": "Do an exploratory laparoscopy to visualise the nature of cyst"
      },
      {
        "id": 4,
        "text": "Do CA-125 levels, if normal advise regular check up"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Doing a <strong>CA-125 level measurement</strong> is the next best step according to the latest <strong>RCOG guidelines for Post-menopausal Ovarian cyst.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman comes with complaints of warty lesions on the vulva. On examination, multiple warty growths on the vulva and around the anal canal are seen. This condition is most likely seen in?",
    "choices": [
      {
        "id": 1,
        "text": "Condyloma accuminata"
      },
      {
        "id": 2,
        "text": "Molluscum contagiosum"
      },
      {
        "id": 3,
        "text": "Chancroid"
      },
      {
        "id": 4,
        "text": "Herpes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Multiple warty growths</strong> on the vulva and around the anal canal are suggestive of&nbsp;<strong>condyloma acuminata </strong>(genital&nbsp;warts).</p>\n<p>The verrucous growths may appear discrete or coalesce to form large <strong>cauliflower-like growths </strong>(as shown in the image below). Human papillomaviruses are implicated in causing this condition.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Genital warts:</strong></p>\n<p>Genital warts/ venereal warts/ condyloma acuminata are verrucous growths that affect the skin of the labia majora, perineum, perianal region, and vulva.&nbsp;They are most commonly caused by infection with&nbsp;<strong>human papillomavirus (HPV) types 6 and 11.&nbsp;</strong>The growths may be discrete or coalesce to form cauliflower-like growth. The disease is sexually transmitted. The growth of the warts is favored by vaginal discharge, the use of oral contraceptives, and pregnancy.</p>\n<p>HPV causes structural changes in the epithelial cells of the skin. These abnormal epithelial cells are called&nbsp;<strong>koilocytes</strong>, and their presence is characteristic of HPV infection. The koilocytes have large hyperchromatic nuclei and a perinuclear halo.</p>\n<p>Diagnosis is made by&nbsp;<strong>colposcopic</strong>&nbsp;<strong>studies</strong>. The lesions on the vulva are stained by toluidine blue. The skin with abnormal nuclei retains the blue dye. These abnormal areas are then biopsied for histopathological examination.</p>\n<p>Treatment:&nbsp;</p>\n<ul>\n<li>Local application of&nbsp;<strong>podophyllin</strong>&nbsp;25% in alcohol or podophyllin 20% in tincture benzoin or podophyllin cream</li>\n<li>25% trichloroacetic acid plus 5% fluorouracil</li>\n<li><strong>Diathermy loop</strong>, laser ablation, cryotherapy for larger lesions</li>\n<li>Surgical excision</li>\n<li><strong>Interferon ointment</strong>&nbsp;or local injection</li>\n</ul>\n</div>\n</div>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d95b45e89554c63a516b07066a64f01x720x799.PNG"
    ]
  },
  {
    "text": "You are a resident observing an intern resuscitate a newborn in the labor room. After half a minute of bag and mask ventilation by the intern, the infant is still pale and hypoxic. What would you advise the intern?",
    "choices": [
      {
        "id": 1,
        "text": "Increase FiO2 to 100%"
      },
      {
        "id": 2,
        "text": "Readjust the mask and head position"
      },
      {
        "id": 3,
        "text": "Intubate"
      },
      {
        "id": 4,
        "text": "Start chest compressions"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The next step in this newborn with ineffective bag and mask ventilation (BMV) is to <strong>readjust the mask and reposition the head.</strong></p>\n<p><strong>Positive pressure ventilation\u00a0</strong>(PPV) by BMV is given when infants fail to breathe at birth. The infant's neck is slightly extended to make sure the airway is open. The care provider is at the head end of the baby and a face mask of appropriate size is chosen to cover the mouth and nose. The <strong>adequacy</strong> of ventilation is indicated by <strong>visible chest rise</strong> and when normal chest rise is observed, ventilation should be started.</p>\n<p>Increasing heart rate; spontaneous respiration; and improvement in color, saturation, and tone help to assess the infant's improvement.</p>\n<p>When there is <strong>no improvement after 30 seconds of BMV</strong>(according to Nelson's textbook of pediatrics)<strong> or 15 seconds of BMV </strong>(according to the Indian Association of Pediatrics), <strong>ventilation corrective steps</strong> should be taken. It is as follows - <strong>MRSOPA</strong></p>\n<ul>\n<li><span style=\"box-sizing: border-box; margin: 0px; padding: 0px;\"><strong>M</strong>ask</span>\u00a0has to be reapplied\u00a0</li>\n<li><strong>R</strong>eposition the infant's head</li>\n<li><strong>S</strong>uction the secretions</li>\n<li><strong>O</strong>pen the mouth</li>\n<li>Increase the <strong>P</strong>ressure</li>\n<li>Use an <strong>A</strong>lternative airway.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b1c8111ef9943fca99bd65b81bdc391x1280x2475.JPEG"
    ]
  },
  {
    "text": "The following anomaly is seen in :",
    "choices": [
      {
        "id": 1,
        "text": "Osteogenesis imperfecta"
      },
      {
        "id": 2,
        "text": "Cleido cranial dysplasia"
      },
      {
        "id": 3,
        "text": "Achondroplasia"
      },
      {
        "id": 4,
        "text": "Osteopetrosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above picture depicts <strong>Starfish hand</strong>&nbsp;and is seen in<strong> Achondroplasia</strong>.</p>\n<p>In these patients, middle finger is shorter than usual resulting in all<strong> digits being of equal length (starfish hand)</strong>. There is separation between middle and ring fingers described as <strong>Trident hand.</strong></p>\n<p><strong>Other features:</strong></p>\n<ul>\n<li><strong>Most common</strong> form of <strong>disproportionate dwarfism</strong>.</li>\n<li>Inheritance is <strong>autosomal dominant</strong></li>\n<li>Usually <strong>normal intelligence </strong>and<strong> sexual development</strong></li>\n<li>Hands are short and broad</li>\n<li><strong>Posterior scalloping</strong> of vertebrae</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f9fbd3b4eee847108f44d56786b3978f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old female presents to the clinic requesting liposuction. She feels she is obese and would like to get rid of the \"excess fat\". On further enquiry, she reveals a habit of eating high-calorie food multiple times a month which she later regrets and skipping meals at times. Her BMI is 23. An examination of her hands is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anorexia nervosa"
      },
      {
        "id": 2,
        "text": "Bulimia nervosa"
      },
      {
        "id": 3,
        "text": "Binge-eating disorder"
      },
      {
        "id": 4,
        "text": "Purging disorder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows calluses and pigmentation on knuckles, known as <strong>Russell's sign</strong>. The given clinical history of binge eating, body-image issues,&nbsp;Russell's sign<strong>&nbsp;</strong>along<strong>&nbsp;</strong>with a&nbsp;<strong>normal BMI</strong>&nbsp;is suggestive of <strong>bulimia nervosa.</strong></p>\n<p><strong>Bulimia nervosa</strong> is an eating disorder, often seen in young women. It is characterized by <strong>binge-eating episodes</strong>, followed by inappropriate, compensatory measures to stop&nbsp;weight gain, like&nbsp;<strong>self-induced vomiting</strong>, laxative abuse, diuretics, enema, and emetic abuse. The calluses on hands form due to the repeated scraping of knuckles on the teeth, during self-induced vomiting. These binge-eating episodes occur at least once a week and are present for at least 3 months. The patient fears gaining weight and has a relentless drive to be thin.&nbsp;</p>\n<p><strong>Treatment </strong>of bulimia nervosa:</p>\n<ul>\n<li>Without comorbid mood disorders - fluoxetine, topiramate, CBT</li>\n<li>With comorbid mood disorders - carbamazepine</li>\n</ul>\n<div class=\"page\" title=\"Page 529\">\n<div class=\"layoutArea\">&nbsp;</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/62038ac15abe4bbcad64eae9609c134f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A known cardiac patient who underwent PCI with stent placement 6 months ago is on regular aspirin ever since. He is posted for emergency hernia surgery for the strangulated hernia. What would be your advice regarding aspirin?",
    "choices": [
      {
        "id": 1,
        "text": "Continue aspirin"
      },
      {
        "id": 2,
        "text": "Stop aspirin and replace with heparin"
      },
      {
        "id": 3,
        "text": "Stop aspirin and give platelet transfusion"
      },
      {
        "id": 4,
        "text": "Postpone the surgery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>If a patient on a coronary stent taking aspirin is posted for surgery, <strong>aspirin</strong> should be <strong>continued</strong> even on the day of surgery to avoid the risk of stent rethrombosis, myocardial infarction or death.</p>\n<p>Antiplatelet drugs <strong>should not be interrupted</strong> in patients with <strong>coronary stents</strong> without consultation with a cardiologist.</p>\n<ul>\n<li><strong>Drug-eluting coronary stents</strong> require antiplatelet administration for at least&nbsp;<strong>6 months.</strong></li>\n<li><strong>Bare metal stents</strong> for at least <strong>one month.</strong></li>\n</ul>\n<p>Ideally,<strong> elective surgery is avoided</strong> for one month in patients with bare coronary stents and one year for those with drug-eluting stents. But&nbsp;<strong>emergency surgeries</strong>&nbsp;<strong>cannot be postponed.</strong></p>\n<p>Note: The drug-eluting stents <strong>delay this endothelial growth by eluting drugs like sirolimus/paclitaxel</strong> etc and thereby reduce the risk of endothelial overgrowth causing occlusion. But this prolonged lack of endothelial lining causes an increased risk of thrombosis and hence a l<strong>onger duration of antiplatelet therapy is required with drug-eluting stents</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old woman presents with pruritic hypopigmented macules and confluent patches over the chest as seen in the image. Which of the following color would you expect on Wood's lamp examination?",
    "choices": [
      {
        "id": 1,
        "text": "Coral pink"
      },
      {
        "id": 2,
        "text": "Red"
      },
      {
        "id": 3,
        "text": "Pale yellow"
      },
      {
        "id": 4,
        "text": "Green"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical scenario of pruritic lesion over the trunk and image showing sharply demarcated multiple <strong>hypopigmented</strong>\u00a0<strong>macules</strong>\u00a0and coalescing into\u00a0<strong>patches</strong>\u00a0with fine scales is suggestive of <strong>pityriasis versicolor\u00a0</strong>or\u00a0<strong>tinea versicolor</strong>.\u00a0On Wood's lamp examination these lesions show <strong>pale</strong>\u00a0<strong>yellow fluorescence.\u00a0</strong></p>\n<p><strong>Wood's lamp</strong> is a source of ultraviolet rays. All visible rays from this source are excluded by Wood's filter. In fungal infections like <strong>pityriasis versicolor</strong>, it shows the <strong>pale\u00a0yellow</strong>\u00a0fluorescence as given below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/55daa65ad4d549f7b17a6ce6643d3b14.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6a3650814ef04cd3ab3b1cbb370f901ex1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/19ac6f734f1346b4bfb48d2eb6fc8344x720x514.JPEG"
    ]
  },
  {
    "text": "An 18-month-child is brought to the pediatrician with the history of distension of abdomen and delayed mental development. On examination, the cornea is cloudy and radiograph of the child is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hurler syndrome"
      },
      {
        "id": 2,
        "text": "Sanfilippo"
      },
      {
        "id": 3,
        "text": "Gaucher\u2019s disease"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>As the child presents with <strong>mental retardation, hepatosplenomegaly</strong> and <strong>cloudy cornea</strong> and given x-ray shows a <strong>J-shaped sella and a thickened calvaria, </strong>the most likely diagnosis is<strong> Hurler Syndrome.</strong></p>\n<p>Hurler syndrome is also known as&nbsp;<strong>MPS 1</strong>. This is due to the defect in the&nbsp;<strong>&alpha;-L Iduronidase</strong>&nbsp;leading to the accumulation of&nbsp;<strong>heparin sulphate and dermatan sulphate</strong>.</p>\n<p>Radiological features in Hurler Syndrome:</p>\n<ul>\n<li>Macrocephaly</li>\n<li><strong>J-shaped sella </strong>(seen in above radiograph)</li>\n<li>Thickened calvaria (skull cap)</li>\n<li><strong>Oar-shaped ribs</strong> (seen below)</li>\n<li>Hook-shaped vertebral bodies</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/83258addfe2342a4b9341bdb509eba18.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf148f29d9f74b39bac03d225ce6c43ax512x377.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b8c98567e866421abd0695f0bc44b083x720x539.JPEG"
    ]
  },
  {
    "text": "A child with recurrent UTIs is suspected to have a congenital renal anomaly. The following picture is seen on IV urography. Based on these findings, which of the following would you suspect?",
    "choices": [
      {
        "id": 1,
        "text": "Retrocaval ureter"
      },
      {
        "id": 2,
        "text": "Vesicoureteric reflux"
      },
      {
        "id": 3,
        "text": "Medullary sponge kidney"
      },
      {
        "id": 4,
        "text": "Multicystic dysplastic kidney"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a right-sided<strong> fish hook&nbsp;</strong>or <strong>S-shaped&nbsp;</strong>ureter. It describes the appearance of a&nbsp;<strong>retrocaval ureter</strong> as the right ureter hooks behind the IVC.</p>\n<p><strong>Circumcaval </strong>or retrocaval ureter is a developmental anomaly of the inferior vena cava (<strong>IVC</strong>). It is due to abnormal development of the right supracardinal system. There is a <strong>persistent</strong>&nbsp;right posterior<strong> cardinal vein&nbsp;</strong>that ends up passing in front of the ureter. The anomaly <strong>always</strong> occurs on the <strong>right side</strong>, as this is the side of the normal IVC.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c8c0a53b31d04449aeaaa97e79409dbe.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2cac9fcfb46e4d52af3e55a449bd518fx1280x1587.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a8813ec2e13487c894176ae6f3f7c31x1280x1587.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c63b681645c34d5e903aaa36fc14e9cax1280x1535.JPEG"
    ]
  }
];
        let quizName = 'Fmge Mini Test - 15 (Clinical)';
        const quizFilename = 'fmge-mini-test-15-clinical-95c35c00.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2024"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>