<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>259 Paediatrics Aiims 2020 (May And Nov Ini-Cet) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">13</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is least likely regarding Rh incompatibility in a newborn?",
    "choices": [
      {
        "id": 1,
        "text": "Increased unconjugated bilirubin"
      },
      {
        "id": 2,
        "text": "Increased fecal urobilinogen"
      },
      {
        "id": 3,
        "text": "Increased urine bilirubin"
      },
      {
        "id": 4,
        "text": "Increased stercobilinogen"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Amongst the given options, <strong>increased urine bilirubin</strong> is <strong>least likely</strong> with <strong>Rh incompatibility</strong> in newborns.&nbsp;</p>\n<p><strong>Rh incompatibility</strong> leads to <strong>hemolysis</strong> in the newborn, causing the release of large amounts of <strong>hemoglobin</strong>. This hemoglobin is converted to <strong>biliverdin</strong> and then to<strong> unconjugated bilirubin</strong>.</p>\n<p>The newborn liver has a <strong>limited capacity</strong> to convert this large amount of unconjugated bilirubin to its soluble form through glucuronide conjugation. As a result, levels of <strong>unconjugated bilirubin</strong> <strong>increase&nbsp;</strong>(option A). <strong>Unconjugated bilirubin</strong>, being <strong>water-insoluble</strong> and bound to <strong>albumin</strong>, is <strong>not excreted in urine</strong>.&nbsp;</p>\n<p>Intestinal bacteria convert unconjugated bilirubin to <strong>urobilinogen</strong> and <strong>stercobilinogen</strong>, which are excreted in urine and stool (options B and D).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old toxic child presents with tachypnea, high-grade fever, inspiratory stridor, and developed difficulty in swallowing with drooling of saliva within 4-6 hours of fever. Along with airway management which of the following needs to be given?",
    "choices": [
      {
        "id": 1,
        "text": "Nebulisation with racemic adrenaline"
      },
      {
        "id": 2,
        "text": "IV ceftriaxone"
      },
      {
        "id": 3,
        "text": "Diphtheria antitoxin"
      },
      {
        "id": 4,
        "text": "Start steroids"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical presentation of a <strong>toxic-looking</strong> child with high-grade fever, tachypnea, inspiratory<strong> stridor</strong>, <strong>dysphagia</strong>, and salivary <strong>drooling</strong> strongly suggests <strong>acute epiglottitis</strong>. Once the <strong>airway is secured</strong>, empirical antimicrobial therapy with <strong>intravenous ceftriaxone</strong> is recommended in the management of acute epiglottitis.\u00a0</p>\n<p>The <strong>most common</strong> causative agents of epiglottitis in vaccinated children are <strong>Streptococcus pyogenes</strong>, Streptococcus<strong> pneumoniae</strong>, non-typeable Haemophilus influenzae, and <strong>Staphylococcus</strong> aureus. The incidence of <strong>Haemophilus influenzae</strong> type B has <strong>decreased</strong> significantly due to<strong> vaccination</strong>.\u00a0</p>\n<p>The child presents with a high <strong>fever</strong>, sore throat, <strong>dyspnea</strong>, <strong>dysphagia</strong>, and progressive <strong>respiratory obstruction</strong>. The child may exhibit a <strong>toxic</strong> appearance, with salivary <strong>drooling</strong> and assuming a <strong>tripod position</strong>. The presence of <strong>stridor</strong> indicates near-complete obstruction of the airway.</p>\n<p><strong>Laryngoscopy</strong> should be promptly conducted in a controlled setting, such as an<strong> operating room</strong> or<strong> intensive care</strong> unit when the diagnosis of epiglottitis is certain or likely based on clinical evaluation.\u00a0</p>\n<p>Acute epiglottitis is a<strong> medical emergency</strong> due to unpredictable clinical course and sudden airway obstruction.\u00a0<strong>Immediate airway management</strong> through<strong> endotracheal</strong> or <strong>nasotracheal intubation</strong> or tracheostomy is crucial, regardless of the severity of respiratory distress. Empiric treatment with <strong>antibiotics</strong> like <strong>ceftriaxone, cefepime</strong>, or <strong>meropenem</strong> is recommended until culture and susceptibility results are available.<strong> Dexamethasone</strong> may also be administered to <strong>reduce pharyngeal edema.\u00a0</strong></p>\n<p>Other options:\u00a0</p>\n<p>Option A: Nebulisation with racemic <strong>adrenaline</strong> is given in <strong>moderate to severe croup</strong>.\u00a0</p>\n<p>The image below shows the\u00a0<strong>thumb sign</strong> in epiglottitis:\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53482c61d5eb4c9f987753bf83b216e2x720x804.PNG"
    ]
  },
  {
    "text": "A child transfers an object from one hand to another. What does it signify?",
    "choices": [
      {
        "id": 1,
        "text": "Visual motor co-ordination"
      },
      {
        "id": 2,
        "text": "Ability to compare objects"
      },
      {
        "id": 3,
        "text": "Ability to handle small objects"
      },
      {
        "id": 4,
        "text": "Voluntary release"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The milestone of<strong> transfer of objects</strong> from one hand to another in a child signifies the<strong> ability of the child to compare objects.&nbsp;</strong>The transfer of objects is a motor milestone occurring at <strong>6 months</strong> of age.</p>\n<p>Other options:</p>\n<p>Option A: When the child <strong>reaches for objects</strong> it implies the onset of <strong>visuomotor coordination</strong>. It is attained at 4 months</p>\n<p>Option C: <strong>Thumb finger grasp</strong> implies the ability to handle <strong>small objects</strong>. It is attained at 8 months.&nbsp;</p>\n<p>Option D<strong>: The voluntary release/ Release phenomenon</strong> is used to denote the<strong> disappearance of</strong>&nbsp;the&nbsp;<strong>palmar grasp</strong>, which is seen at 4 months.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Surgical correction of  VSD is performed in an infant. This will help in relieving which of the following features?",
    "choices": [
      {
        "id": 1,
        "text": "Respiratory alkalosis"
      },
      {
        "id": 2,
        "text": "Failure to thrive"
      },
      {
        "id": 3,
        "text": "Arrythmia"
      },
      {
        "id": 4,
        "text": "Heart block"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Surgery for ventricular septal defect (VSD) mainly <strong>helps to relieve congestive cardiac failure</strong> which manifests as a&nbsp;<strong>failure to thrive</strong> in an infant. The main aim of performing surgery in VSD is to get the symptoms of heart failure in control and to prevent the development of pulmonary vascular disease.&nbsp;</p>\n<p><strong>Ventricular septal defect</strong> (VSD) is the <strong>most common</strong> congenital heart disease. The most common subtype is the <strong>membranous type</strong>.&nbsp;</p>\n<p><strong>Small VSDs</strong> with trivial left-to-right shunts and normal pulmonary artery pressure (PAP) are the most common. These patients are <strong>asymptomatic</strong>. A <strong>loud, harsh</strong>, or <strong>blowing</strong> <strong>holosystolic murmur</strong> is present and heard best over the <strong>lower left sternal border</strong>, and it is accompanied by a thrill.&nbsp;</p>\n<p>Small VSDs close spontaneously, especially within the first two years of life. Muscular VSDs have a higher closure rate (up to 80%) compared to membranous VSDs.&nbsp;</p>\n<p><strong>Large VSDs</strong> with excessive pulmonary blood flow and pulmonary hypertension can lead to signs of <strong>congestive heart failure</strong> in early infancy. These signs may include <strong>dyspnea</strong>, <strong>feeding difficulties</strong>, <strong>poor weight gain</strong>, profuse <strong>perspiration</strong>, irritability, weak crying, and recurrent pulmonary infections.&nbsp;The holosystolic murmur associated with a <strong>large</strong> <strong>VSD</strong> is <strong>less harsh</strong> and <strong>more blowing</strong> compared to that of a small VSD. This is due to the absence of a significant pressure gradient across the defect.&nbsp;</p>\n<p>The<strong> indications of surgery</strong> in VSD are:&nbsp;</p>\n<ul>\n<li><strong>Large defects</strong> in patients of any age with uncontrolled <strong>symptoms</strong> or <strong>failure to thrive</strong>.</li>\n<li><strong>Moderate to large defects</strong> associated with <strong>pulmonary hypertension</strong> in infants between 6 and 12 months, even if symptoms are controlled by medication.</li>\n<li>Patients older than 24 months with a<strong> Qp: Qs ratio</strong> greater than <strong>2:1&nbsp;</strong>(ratio of total pulmonary blood flow-Qp to total systemic blood flow-Qs).</li>\n<li><strong>Supracristal VSDs</strong> of any size, due to the higher risk of developing aortic valve regurgitation.</li>\n</ul>\n<p>Severe pulmonary vascular disease nonresponsive to pulmonary vasodilators is a contraindication to VSD closure.</p>\n<p>Other options:</p>\n<p>Options A and C: Respiratory alkalosis and arrhythmia are other rare complications of VSD.</p>\n<p>Options D: Heart block may occur perioperatively in VSD.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All the following PFT findings in a child are suggestive of asthma except?",
    "choices": [
      {
        "id": 1,
        "text": "Increase in FEV1> 12% after salbutamol inhalation"
      },
      {
        "id": 2,
        "text": "FEV1/FVC< 80%"
      },
      {
        "id": 3,
        "text": "Day- night variation of FEV1 > 15%"
      },
      {
        "id": 4,
        "text": "Decrease in FEV1>15% after exercise"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Day-night variation of FEV1 &gt; 15% is not suggestive of asthma,\u00a0<strong>variation\u00a0\u226520%</strong> is suggestive of asthma.</p>\n<p class=\"p1\">Lung Function Abnormalities in Childhood Asthma</p>\n<ul>\n<li class=\"p1\"><strong>Spirometry</strong> showing <strong>airflow limitation</strong>: Low FEV<span class=\"s1\">1 </span>(relative to the percentage of predicted norms) and <strong>FEV<span class=\"s1\">1</span>:FVC</strong> ratio <strong>&lt;0.80 </strong>(option B)</li>\n<li class=\"p1\"><strong>Bronchodilator response </strong>(to inhaled \u03b2-agonist):\u00a0Improvement in <strong>FEV<span class=\"s1\">1 </span>\u226512%</strong> and <strong>\u2265200 mL\u00a0</strong>after inhalation of a short-acting beta agonist (option A).</li>\n<li class=\"p1\"><strong>Exercise challenge:\u00a0</strong>Worsening in FEV<span class=\"s1\">1 </span>\u226515% (option D)</li>\n<li class=\"p1\"><strong>Daily peak expiratory flow (PEF)\u00a0</strong>or <strong>FEV<span class=\"s1\">1 </span>monitoring</strong>: day to day and/or <span class=\"s3\">A</span>.<span class=\"s3\">M</span>.-to-<span class=\"s3\">P</span>.<span class=\"s3\">M</span>.\u00a0<strong>variation \u226520%</strong></li>\n<li class=\"p1\"><strong>Exhaled nitric oxide\u00a0</strong>(FeNO): A value of <strong>&gt;20ppb</strong> (parts per billion) supports the clinical diagnosis of asthma in children.\u00a0</li>\n</ul>\n<p>FEV1: Forced expiratory volume in 1 sec; FVC: Forced vital capacity.\u00a0</p>\n<p><strong>Childhood asthma</strong> can be classified into two types: <strong>recurrent wheezing</strong> in early childhood, often triggered by respiratory viral infections and resolves during preschool/lower school years, and <strong>chronic asthma</strong> associated with allergies that persist into later childhood and adulthood.\u00a0</p>\n<p>Based on the severity, acute asthma is classified as mild, moderate, and severe.\u00a0</p>\n<table style=\"height: 282px;\" width=\"688\">\n<tbody>\n<tr>\n<td style=\"width: 165px;\">Clinical parameter</td>\n<td style=\"width: 165px;\"><strong>Mild</strong></td>\n<td style=\"width: 165px;\"><strong>Moderate</strong></td>\n<td style=\"width: 165px;\"><strong>Severe</strong></td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Color</td>\n<td style=\"width: 165px;\">Normal</td>\n<td style=\"width: 165px;\">Normal</td>\n<td style=\"width: 165px;\">Pale</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Sensorium</td>\n<td style=\"width: 165px;\">Normal</td>\n<td style=\"width: 165px;\">Anxious</td>\n<td style=\"width: 165px;\">Agitated</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Respiratory rate</td>\n<td style=\"width: 165px;\">Increased</td>\n<td style=\"width: 165px;\">Increased</td>\n<td style=\"width: 165px;\">Increased</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Dyspnea</td>\n<td style=\"width: 165px;\">Absent</td>\n<td style=\"width: 165px;\">Moderate</td>\n<td style=\"width: 165px;\">Severe</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Use of accessory muscles</td>\n<td style=\"width: 165px;\">Nil or minimal</td>\n<td style=\"width: 165px;\">Chest indrawing</td>\n<td style=\"width: 165px;\">Indrawing, nasal flare</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Rhonchi</td>\n<td style=\"width: 165px;\">Expiratory and/or inspiratory</td>\n<td style=\"width: 165px;\">Expiratory and/or inspiratory</td>\n<td style=\"width: 165px;\">Expiratory or absent.</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Oxygen saturation</td>\n<td style=\"width: 165px;\">&gt;95%</td>\n<td style=\"width: 165px;\">90-95%</td>\n<td style=\"width: 165px;\">&lt;90%</td>\n</tr>\n<tr>\n<td style=\"width: 165px;\">Speech</td>\n<td style=\"width: 165px;\">Sentence</td>\n<td style=\"width: 165px;\">Phrases</td>\n<td style=\"width: 165px;\">Difficulty in speech</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a symptom of severe dehydration?",
    "choices": [
      {
        "id": 1,
        "text": "Drowsy child"
      },
      {
        "id": 2,
        "text": "Skin pinch retracts slowly"
      },
      {
        "id": 3,
        "text": "Thirsty child"
      },
      {
        "id": 4,
        "text": "Sunken fontanelle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A <strong>thirsty child</strong> signifies <strong>some dehydration</strong>, not severe dehydration.&nbsp;</p>\n<p>Clinical features of <strong>severe dehydration</strong> in a child include:</p>\n<ul>\n<li><strong>Drowsy</strong>, <strong>lethargic</strong>, or unconscious, with <strong>deeply sunken eyes</strong> and absent tears</li>\n<li><strong>Sunken fontanelle</strong></li>\n<li>Drinks poorly or <strong>not able to drink</strong></li>\n<li>Deep breathing</li>\n<li>Skin pinch goes back very slowly <strong>(recoil in &gt;2 seconds</strong>)</li>\n<li>Tachycardia, with bradycardia in most severe cases</li>\n<li>Weak, thready, or impalpable pulse</li>\n<li><strong>Prolonged capillary refill</strong></li>\n<li>Cold, mottled, and cyanotic extremities</li>\n<li><strong>Minimal urine output&nbsp;</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a criteria for severe acute malnutrition?",
    "choices": [
      {
        "id": 1,
        "text": "Weight for height less than -3 SD"
      },
      {
        "id": 2,
        "text": "MUAC < 115mm"
      },
      {
        "id": 3,
        "text": "B/L Pedal Edema"
      },
      {
        "id": 4,
        "text": "Weight for age less than -3 SD"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Severe acute malnutrition</strong> (SAM) according to the WHO criteria is the&nbsp;<strong>w</strong><strong>eight for height (not age) less than minus -3 SD.</strong></p>\n<p><strong>Severe acute malnutrition</strong> (SAM) in children of ages <strong>6 to 59 months</strong> is defined by the WHO as any of the following:</p>\n<ul>\n<li><strong>Weight-for-length</strong> (or height) <strong>below &minus;3 SD</strong> of the WHO child growth standards</li>\n<li>Presence of <strong>bipedal edema</strong></li>\n<li>Mid-upper arm circumference&nbsp;<strong>(</strong><strong>MUAC)</strong>&nbsp;<strong>&lt;11.5 cm</strong>.<strong>&nbsp;</strong></li>\n</ul>\n<p>Management of SAM is given below:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00d582a91da04e21a88a06688cfccbf1x720x799.JPEG"
    ]
  },
  {
    "text": "Phototherapy converts bilirubin to _________",
    "choices": [
      {
        "id": 1,
        "text": "Stercobilin"
      },
      {
        "id": 2,
        "text": "Lumirubin"
      },
      {
        "id": 3,
        "text": "Biliverdin"
      },
      {
        "id": 4,
        "text": "Urobilin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Phototherapy converts bilirubin to<strong>&nbsp;lumirubin</strong>. It is used to&nbsp;manage&nbsp;<strong>clinical jaundice</strong> and <strong>indirect hyperbilirubinemia</strong>.</p>\n<p>It involves exposing the patient to <strong>high-intensity light</strong> in the visible spectrum.&nbsp;Bilirubin absorbs light most effectively in the <strong>blue range</strong> (<strong>420 to 470nm</strong>).&nbsp;</p>\n<p>Phototherapy <strong>converts</strong> <strong>toxic bilirubin</strong> into two forms: <strong>lumirubin</strong>, formed by <strong>irreversible structural isomerization</strong> that can be excreted by the <strong>kidneys,</strong> and a <strong>reversible</strong> isomer (4Z,15E-bilirubin), formed by <strong>photoisomerization</strong> that can be excreted in <strong>bile</strong> without conjugation.</p>\n<p>The <strong>effectiveness</strong> of phototherapy depends on factors such as the appropriate wavelength range, distance to the infant, skin surface area exposure, and the infant's bilirubin metabolism. The infant's<strong>&nbsp;eyes</strong>&nbsp;should be <strong>covered</strong> to prevent corneal damage. <strong>Continuous</strong> conventional phototherapy is typically used, with <strong>frequent repositioning</strong> of the infant.&nbsp;</p>\n<p>Phototherapy can be discontinued once&nbsp;<strong>two TSB&nbsp;</strong>(total serum bilirubin)&nbsp;values 12 hours apart&nbsp;<strong>fall below</strong>&nbsp;current&nbsp;<strong>age-specific cut-offs</strong>.</p>\n<p><strong>Complications</strong> of phototherapy may include <strong>loose stools</strong>, erythematous macular <strong>rash</strong>, purpuric rash (linked to transient porphyrinemia), <strong>overheating</strong>, <strong>dehydration</strong> (due to increased insensible water loss and diarrhea), and<strong> hypothermia from exposure</strong>.</p>\n<p><strong>Bronze baby syndrome</strong> is a&nbsp;<strong>dark grayish-brown</strong> skin discoloration seen in infants undergoing phototherapy in the presence of <strong>direct hyperbilirubinemia</strong>. <strong>Porphyria</strong> is a <strong>contraindication</strong> for phototherapy because photosensitivity and blistering can be severe in these infants.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the vitamin which when deficient can lead to neonatal seizures.",
    "choices": [
      {
        "id": 1,
        "text": "Pyridoxine"
      },
      {
        "id": 2,
        "text": "Thiamine"
      },
      {
        "id": 3,
        "text": "Riboflavin"
      },
      {
        "id": 4,
        "text": "Pantothenic acid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Pyridoxine deficiency</strong>&nbsp;can cause <strong>refractory seizures</strong> in the <strong>neonatal period</strong> and<strong> infancy</strong>.</p>\n<p><strong>Pyridoxal 5'-phosphate</strong> (P5P) is the active form of pyridoxine and functions as a cofactor for enzymes involved in <strong>neurotransmitter</strong> synthesis, <strong>amino acid</strong> metabolism, and <strong>glycogen</strong> metabolism.&nbsp;<strong>Intracellular P5P deficiency</strong> in the brain can lead to a <strong>seizure disorder</strong> that does not respond to typical anticonvulsant medications but shows a response to pyridoxine.</p>\n<p><strong>Antiquitin</strong> deficiency is the most common cause of <strong>pyridoxine-dependent epilepsy&nbsp;</strong>(due to mutations in the <strong>ALDH7A1</strong> alleles)</p>\n<p>They primarily present with <strong>generalized seizures&nbsp;</strong>in the <strong>early days</strong> of life. The seizures can be of various types, recurrent focal motor seizures, generalized tonic seizures, and myoclonus.&nbsp;Additional manifestations may include <strong>dystonia</strong>, <strong>respiratory distress</strong>, <strong>abdominal distention</strong> with <strong>vomiting</strong>, <strong>hepatomegaly</strong>, <strong>hypoglycemia</strong>, and <strong>hypothermia</strong>.&nbsp;</p>\n<p>Increased &alpha;-aminoadipic semialdehyde and pipecolic acid levels are observed in the CSF, plasma, and urine.<strong> Treatment</strong> with <strong>vitamin B6</strong> (<strong>50-100 mg/day</strong>) shows significant improvement in seizures. <strong>Life-long therapy</strong> is needed.</p>\n<p>Other options:&nbsp;</p>\n<p>Option B: Thiamine (vitamin B1) deficiency causes beriberi.&nbsp;</p>\n<p>Option C: Riboflavin (vitamin B2) deficiency causes glossitis, cheilosis, keratitis, and corneal vascularization.&nbsp;</p>\n<p>Option D: Pantothenic acid (vitamin B5) deficiency causes burning feet syndrome.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A baby assessed 5 minutes after birth is found to be pink, with blue extremities, and irregular respiration. Heart rate is 80 beats per minute. There is grimace and some flexion. What is the Apgar score for this baby?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Causes for <strong>false positive Apgar</strong> score are:</p>\n<ul>\n<li>Prematurity</li>\n<li>Drugs like analgesics, narcotics, sedatives, magnesium sulfate</li>\n<li>Acute cerebral trauma</li>\n<li>Precipitous delivery</li>\n<li>Airway obstruction (choanal atresia)</li>\n<li>Congenital pneumonia or sepsis</li>\n<li>Hemorrhage- hypovolemia</li>\n</ul>\n<p><strong>False-negative Apgar</strong> score is seen in maternal acidosis and high fetal catecholamine levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e3e438686eb4a6d9eccb9c35b5fddd7x1279x1330.JPEG"
    ]
  },
  {
    "text": "A child suffering from steroid-dependent nephrotic syndrome is brought to the OPD for vaccination. Which of the following is true about vaccination in this child?",
    "choices": [
      {
        "id": 1,
        "text": "All live vaccines under NIS can be given as per schedule"
      },
      {
        "id": 2,
        "text": "All killed vaccines under NIS can be given"
      },
      {
        "id": 3,
        "text": "Only pneumococcal vaccine should be given to the child in acute phase"
      },
      {
        "id": 4,
        "text": "Live vaccines are contraindicated in the child\u2019s sibling"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a child with steroid-dependent nephrotic syndrome, <strong>all</strong> <strong>killed vaccines</strong> can be given.</p>\n<p>Option A:<strong> Live virus</strong> vaccines are <strong>administered with caution</strong> in children receiving <strong>corticosteroid therapy</strong>. They can be given to patients in whom the prednisone<strong> dose is below</strong> <strong>1mg/kg daily</strong> or <strong>2mg/kg on alternate days</strong>. If the patient is receiving <strong>corticosteroid-sparing agents</strong> (cyclophosphamide, cyclosporine), <strong>live virus vaccines</strong> are <strong>contraindicated</strong>.\u00a0</p>\n<p>Option C: Only live vaccines are contraindicated in this child. Full <strong>pneumococcal</strong> vaccination (with the 13-valent conjugate vaccine and 23-valent polysaccharide vaccine) and <strong>influenza</strong> vaccination can be given <strong>annually</strong> to the <strong>child</strong> and their <strong>household contacts</strong>.</p>\n<p>Option D: <strong>Immunization</strong> of<strong> siblings/healthy household contacts</strong> with <strong>live vaccines</strong> is <strong>necessary</strong> to reduce the risk of infection transmission to the immunosuppressed child.\u00a0Direct exposure to the gastrointestinal/respiratory secretions of the household contacts is avoided for about 3-6 weeks after vaccination.\u00a0</p>\n<p><strong>Minimal change</strong> nephrotic syndrome is the\u00a0<strong>most common cause of nephrotic syndrome</strong>. It is\u00a0characterized by heavy <strong>proteinuria</strong>, <strong>edema</strong>, <strong>hypoalbuminemia</strong>, and <strong>hyperlipidemia</strong>.\u00a0The diagnosis is confirmed by performing a urinalysis and urine protein: creatinine ratio. Nephrotic range proteinuria is<strong> proteinuria greater than 3.5 g per 24 hours</strong> (3+ or 4+) or a <strong>urine protein : creatinine ratio</strong> exceeding<strong> 2</strong>.</p>\n<p>The recommended initial treatment for nephrotic syndrome is a <strong>daily dose of 2mg/kg</strong> (max 60mg) of <strong>prednisolone</strong> for <strong>6 weeks</strong> followed by an <strong>alternate dose of 1.5mg/kg</strong> (max 40mg) for the <strong>next 6-8 weeks</strong>.\u00a0</p>\n<p>Definitions regarding the course of nephrotic syndrome:\u00a0</p>\n<ul>\n<li><strong>Frequently relapsing</strong> nephrotic syndrome: \u22652 relapses in 6 months or 3 or more relapses in 12 months.</li>\n<li><strong>Steroid-dependent</strong> nephrotic syndrome: Relapse during steroid tapering or within 2 weeks of discontinuation.</li>\n<li><strong>Steroid resistance</strong>: Failure to achieve remission despite therapy with daily prednisolone for 6 weeks\u00a0</li>\n</ul>\n<p><strong>Alternative drugs</strong> used in steroid-dependent patients, frequent relapsers, steroid-resistant patients, and those with severe corticosteroid toxicity are cyclophosphamide, calcineurin inhibitors: cyclosporine and Tacrolimus, mycophenolate, levamisole, and rituximab (a chimeric monoclonal antibody against CD20).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young girl presents with the complaints of continuous dribbling of urine. However, she also voids normally. Her parents tell you that she had never been totally dry since her birth. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ectopic ureter"
      },
      {
        "id": 2,
        "text": "Ureterocele"
      },
      {
        "id": 3,
        "text": "Congenital megaureter"
      },
      {
        "id": 4,
        "text": "Vesicoureteric reflux"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical presentation of a young<strong> girl</strong> with <strong>continuous dribbling of urine</strong>, despite <strong>normal voiding</strong>, strongly suggests the diagnosis of an <strong>ectopic ureter</strong>.</p>\n<p>An <strong>ectopic ureter</strong> refers to a condition where the<strong> ureter drains outside the bladder</strong>. It is more common in <strong>females </strong>and&nbsp;opens either into the <strong>urethra below the sphincter</strong> or into the <strong>vagina</strong>. Hence, they present with <strong>constant urinary dripping</strong> all day, even though the child<strong> voids regularly</strong> (<strong>p</strong><strong>aradoxical incontinence</strong>).</p>\n<p>The terminal part of the ureter is frequently narrowed, leading to <strong>hydroureteronephrosis</strong>. <strong>Urinary tract infections</strong> (UTIs) are common due to urinary stasis.</p>\n<p>In <strong>males</strong>, ectopic ureters usually enter the <strong>posterior urethra above the external sphincter</strong>, hence they are usually <strong>continent</strong> and most patients present with <strong>UTI</strong> or <strong>epididymitis</strong>.&nbsp;</p>\n<p><strong>Investigations</strong> include renal ultrasound (USG), voiding cystourethrogram (VCUG), and renal scan to assess function. USG shows a <strong>hydronephrotic kidney</strong> or <strong>dilated upper pole</strong> and <strong>ureter</strong>. If there is a satisfactory function, the recommended<strong> treatment</strong> options are <strong>ureteral reimplantation</strong> into the bladder or <strong>ureteroureterostomy</strong>. The poor function may require partial or total nephrectomy.&nbsp;</p>\n<p>Other options:</p>\n<p>Option B: A <strong>ureterocele</strong> is a <strong>cystic dilation</strong> of the <strong>terminal ureter</strong>, typically obstructive due to a small ureteral opening.&nbsp;In childhood, they commonly present with<strong> infections</strong>. Larger ureteroceles can cause obstruction at the bladder neck.&nbsp;</p>\n<p>Option C: Congenital <strong>megaureter</strong> (<strong>dilated ureter</strong>) presents <strong>UTI</strong>, urinary stones, hematuria, and flank pain because of urinary stasis.</p>\n<p>Option D: <strong>Vesicoureteral reflux</strong> (VUR) is characterized by the retrograde flow of urine from the bladder to the ureter and kidney. They usually present with <strong>recurrent attacks of UTI</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-month-old child with Hb 6.3 was undergoing repeated blood transfusions. The last transfusion was given in the 9th month. Which of the following investigation is used for a definitive diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "High performance liquid chromatography"
      },
      {
        "id": 2,
        "text": "Ferritin levels estimation"
      },
      {
        "id": 3,
        "text": "Bone marrow aspiration"
      },
      {
        "id": 4,
        "text": "Globin gene sequencing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">The given clinical scenario of <strong>repeated transfusion</strong>,&nbsp;<strong>low hemoglobin level</strong>, and&nbsp;<strong>target cells</strong> in the smear are suggestive of&nbsp;<strong>thalassemia. G</strong><strong>lobin gene sequencing is&nbsp;</strong>used for its&nbsp;<strong>definitive diagnosis</strong>.&nbsp;</p>\n<p class=\"ng-binding\">High-performance liquid chromatography (HPLC) is used as a <strong>screening test</strong> for thalassemia (option A).&nbsp;</p>\n<p class=\"ng-binding\"><strong>Thalassemia</strong> is a hemoglobinopathy that arises due to deficient <strong>synthesis of the globin chains</strong>. Depending on the chain affected, it is classified into <strong>&alpha;-thalassemia</strong> and <strong>&beta;-thalassemia</strong>.</p>\n<p class=\"ng-binding\">&beta;-thalassemia is caused by <strong>point mutations</strong> of the &beta;-thalassemia gene on chromosome 11, which diminish the synthesis of &beta;-globin chains.<strong> Splicing mutations</strong> are the <strong>most common</strong> cause of (&beta;+) thalassemia.&nbsp;</p>\n<p class=\"ng-binding\">There is a deficit in the synthesis of HbA with an <strong>elevation of HbA2</strong> and<strong> HbF</strong> levels in &beta;-thalassemia. Children with severe thalassemia present with distinctive facial features such as <strong>maxilla hyperplasia</strong>, a <strong>flat nasal bridge</strong>, and <strong>frontal bossing</strong>. Other manifestations include pathologic <strong>bone fractures</strong>, significant<strong> hepatosplenomegaly</strong>, and cachexia.&nbsp;</p>\n<p class=\"ng-binding\">Blood smears show marked <strong>anisocytosis</strong>,&nbsp;<strong>poikilocytosis</strong>, and microcytic hypochromic anemia. <strong>Target cells</strong>, basophilic stippling, and fragmented red cells also are common. A radiographic image of the skull shows the <strong>classic 'crew cut'</strong> appearance.</p>\n<p class=\"ng-binding\"><strong>Hb Electrophoresis</strong> and<strong> high-performance liquid chromatography</strong> (HPLC) are used as <strong>screening tests</strong> for thalassemia. <strong>DNA diagnosis</strong> to detect &beta;-thalassemia mutations is used for definitive diagnosis. The&nbsp;<strong>Mentzer index</strong> is the ratio of MCV to RBC count. It is used to differentiate between iron-deficiency anemia and &beta;-thalassemia trait. The Mentzer index is <strong>&lt;13</strong> in <strong>thalassemia minor</strong> syndrome.</p>\n<p class=\"ng-binding\">Transfusions are administered every 3-4 weeks to maintain a pretransfusion hemoglobin level of 9.5-10.5 g/dL. <strong>Transfusion-induced hemosiderosis</strong> is a significant complication in transfusion-dependent thalassemia. Iron deposition occurs in the <strong>liver, endocrine organs</strong>, and <strong>heart</strong>, resulting in complications including hypothyroidism, hypogonadotropic hypogonadism, growth hormone deficiency, hypoparathyroidism, diabetes mellitus, heart failure, and arrhythmias.&nbsp;</p>\n<p class=\"ng-binding\">The image below shows <strong>thalassemic facies&nbsp;</strong>and&nbsp;<strong>crew cut appearance</strong> on X-ray:</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bd0c48a8dd0f43f3a180c62010a5543f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/14d024e36191482ebf99ba4bbcc29994x512x357.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fa3808e1a1f642e29ecff68602d94c41x720x549.JPEG"
    ]
  }
];
        let quizName = '259 Paediatrics Aiims 2020 (May And Nov Ini-Cet)';
        let hierarchy = ["Marrow", "PYQs", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>