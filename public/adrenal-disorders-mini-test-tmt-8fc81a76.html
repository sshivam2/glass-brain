<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adrenal Disorders Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 35-year-old man presents with persistent hypertension despite being on three different antihypertensive drugs. He also complains of muscle weakness and frequent headaches. On examination, his blood pressure is 160/110 mm of Hg, and laboratory tests reveal hypokalemia. Which of the following is the most appropriate initial test in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Cosyntropin test"
      },
      {
        "id": 2,
        "text": "Saline infusion test"
      },
      {
        "id": 3,
        "text": "Aldosterone-renin ratio"
      },
      {
        "id": 4,
        "text": "Plasma ACTH levels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical presentation of\u00a0<strong>hypokalemia</strong> and <strong>treatment-resistant hypertension</strong> points to a diagnosis of <strong>primary hyperaldosteronism</strong>. The initial test for this condition is the\u00a0concurrent measurement of <strong>plasma renin</strong> and<strong> aldosterone</strong>, followed by\u00a0the calculation of the <strong>aldosterone-renin ratio (ARR)</strong>.</p>\n<p>Primary hyperaldosteronism, also known as Conn\u2019s syndrome, is characterized by <strong>excessive production of aldosterone</strong> by the adrenal glands, leading to <strong>sodium retention, potassium excretion, and subsequent hypertension.</strong> Drug-resistant hypertension is a <strong>hallmark</strong> of this condition. The symptom of muscle weakness in this patient is most likely due to hypokalemia.</p>\n<p>The aldosterone-renin ratio is the <strong>most appropriate screening test</strong> for primary hyperaldosteronism, this can be followed by a <strong>saline infusion test</strong> (Option B), which is used to <strong>confirm the diagnosis</strong> of Conn\u2019s syndrome.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Cosyntropin test </strong>detects <strong>adrenal insufficiency</strong> by measuring cortisol response to synthetic ACTH (Cosyntropin).</p>\n<p>Option D: Measuring <strong>plasma ACTH levels </strong>helps diagnose <strong>adrenal insufficiency or Cushing\u2019s syndrome.</strong> It is not useful in suspected hyperaldosteronism.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-weeks-old infant diagnosed with primary adrenal insufficiency presented with failure to thrive, recurrent vomiting, and hepatosplenomegaly. Radiological imaging shows bilateral adrenal calcification. Enzyme studies revealed a deficiency of lysosomal acid lipase. What is the most likely disease in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Hurler's disease"
      },
      {
        "id": 2,
        "text": "Scheie's disease"
      },
      {
        "id": 3,
        "text": "Wolman's disease"
      },
      {
        "id": 4,
        "text": "I cell disease"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An infant with primary adrenal insufficiency with hepatosplenomegaly, recurrent emesis, and bilateral adrenal calcification is suggestive of\u00a0<strong>Wolman's disease. </strong>It is due to the deficiency of the enzyme\u00a0<strong>acid lipase. </strong></p>\n<p>It is a lipid disorder caused by a <strong>deficiency of lysosomal acid lipase</strong> (chromosome 10) which leads to the accumulation of cholesterol esters and triglycerides in the most visceral organs. It is an <strong>Autosomal recessive </strong>disease<strong>. </strong></p>\n<p>The child presents in the\u00a0first few weeks of life with failure to thrive, vomiting, abdominal distention, steatorrhea, <strong>hepatosplenomegaly,</strong> and <strong>hyperlipidemia with</strong> <strong>extensive bilateral calcifications of the adrenal glands</strong>.No specific therapy is available and death usually occurs within 6 months of life.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the given conditions with their usual clinical presentation:",
    "choices": [
      {
        "id": 1,
        "text": "1-c, 2-d, 3-b, 4-a"
      },
      {
        "id": 2,
        "text": "1-d, 2-c, 3-b, 4-a"
      },
      {
        "id": 3,
        "text": "1-b, 2-d, 3-a, 4-c"
      },
      {
        "id": 4,
        "text": "1-c, 2-b, 3-d, 4-a"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The correct answer is <strong>1-c, 2-d, 3-b, 4-a.</strong>\u00a0</p>\n<table style=\"border-collapse: collapse; width: 44.2831%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 27.3276%;\">1. Conn\u2019s syndrome</td>\n<td style=\"width: 72.6735%;\">c. Fatigue, hypertension, low potassium, low renin</td>\n</tr>\n<tr>\n<td style=\"width: 27.3276%;\">2. Cushing\u2019s syndrome</td>\n<td style=\"width: 72.6735%;\">d. Fatigue, hypertension, high sodium, high bicarbonate</td>\n</tr>\n<tr>\n<td style=\"width: 27.3276%;\">3. Addison\u2019s disease</td>\n<td style=\"width: 72.6735%;\">b. Nausea, vomiting, hypotension, hyperkalemia, high BUN</td>\n</tr>\n<tr>\n<td style=\"width: 27.3276%;\">4. SIADH</td>\n<td style=\"width: 72.6735%;\">a. Nausea, vomiting, normal blood pressure, normal potassium, low BUN</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Conn\u2019s syndrome</strong> or <strong>primary hyperaldosteronism</strong>, is characterized by <strong>excessive production of aldosterone</strong>, which increases <strong>sodium reabsorption</strong> and<strong> potassium excretion</strong> in the kidneys. This results in <strong>hypertension, hypokalemia,</strong> fatigue due to electrolyte imbalance, and <strong>low renin</strong> levels due to feedback inhibition.</p>\n<p><strong>Cushing\u2019s syndrome</strong> involves high levels of <strong>cortisol</strong>. This can lead to <strong>sodium retention, potassium loss, high bicarbonate, and altered glucose metabolism</strong>. This causes symptoms of <strong>hypertension, fatigue,</strong> and elevated blood glucose.\u00a0</p>\n<p><strong>Addison\u2019s disease</strong> is caused due to <strong>insufficient production of cortisol and aldosterone</strong>. The lack of cortisol causes <strong>reduced gluconeogenesis </strong>and <strong>increased ACTH secretion</strong>, which in turn leads to increased potassium levels. The lack of aldosterone causes<strong> reduced sodium reabsorption and increased potassium retention.</strong> This results in symptoms of <strong>hypotension, nausea, vomiting,</strong> and <strong>elevated BUN</strong> due to impaired renal function.</p>\n<p><strong>SIADH </strong>(syndrome of inappropriate ADH secretion) involves excessive secretion of ADH despite <strong>normal or low plasma osmolality.</strong> This causes <strong>water retention, diluting serum sodium, and increasing urine osmolality.</strong> The resultant fluid overload can cause <strong>nausea, vomiting, and low BUN.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman undergoes an abdominal CT which incidentally reveals a 2 cm adrenal mass. Further tests show that it is non-functional. What is the most appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Follow-up CT after 6 months"
      },
      {
        "id": 2,
        "text": "Medical therapy with spironolactone"
      },
      {
        "id": 3,
        "text": "Unilateral open adrenalectomy"
      },
      {
        "id": 4,
        "text": "Unilateral laparoscopic adrenalectomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this patient with a <strong>2 cm non-functional adrenal</strong> <strong>mass</strong>, the most appropriate initial approach is <strong>conservative management</strong> with\u00a0a <strong>follow-up CT after 6 months</strong> to monitor for any growth or changes in the adrenal mass.</p>\n<p>Adrenal incidentalomas are <strong>asymptomatic</strong> adrenal masses detected incidentally on imaging performed for other reasons. These can be benign or malignant<strong> </strong>tumors of <strong>adrenal or extra-adrenal</strong> <strong>origin</strong>. These tumors can be <strong>functioning </strong>(secreting excess hormones) or<strong> non-functioning</strong>.</p>\n<p>Management of an adrenal incidentaloma largely depends on its size and functional status. Incidentalomas which are <strong>small (&lt;3 cm)</strong>, <strong>benign, non-functioning tumors</strong> <strong>do not require immediate surgery</strong>. Instead, these patients should undergo a <strong>follow-up CT/MRI at 6 months</strong> to monitor for any changes or growth in the adrenal mass.</p>\n<p><strong>Adrenalectomy</strong> is indicated in <strong>all tumors &gt;4 cm</strong>\u00a0<strong>functional tumors, </strong>tumors showing <strong>imaging </strong>characteristics of <strong>malignancy</strong> or <strong>significant</strong> <strong>growth</strong>.</p>\n<p>Other options:\u00a0</p>\n<p>Option B: <strong>Medical therapy </strong>with <strong>spironolactone</strong> is not indicated for non-functional adrenal masses.</p>\n<p>Option C: <strong>Open adrenalectomy</strong> is suggested for unilateral adrenal masses that exhibit radiological signs of malignancy.</p>\n<p>Option D:\u00a0<strong>Laparoscopic adrenalectomy</strong> is advised for unilateral <strong>adrenal masses &lt; 6 cm </strong>in diameter that show radiological features suggesting malignancy but lack signs of local invasion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old female presented with a history of fatigue. Examination findings are shown below. Which of the following is used to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "ACTH stimulation test"
      },
      {
        "id": 2,
        "text": "Serum cortisol measurement"
      },
      {
        "id": 3,
        "text": "Low-dose dexamethasone suppression test"
      },
      {
        "id": 4,
        "text": "High-dose dexamethasone suppression test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a patient presenting with <strong>fatigue</strong> and <strong>hyperpigmentation of the palms and the oral cavity (mucocutaneous hyperpigmentation)</strong>, a diagnosis of <strong>primary adrenal insufficiency</strong> <strong>(Addison's disease)</strong> is most likely. The <strong>test used to confirm</strong> the diagnosis of adrenal insufficiency is the <strong>ACTH stimulation test\u00a0</strong>(also known as\u00a0the <strong>short cosyntropin test</strong> or <strong>short Synacthen test</strong>).</p>\n<p><strong>ACTH stimulation test</strong> involves the <strong>administration of an exogenous, synthetic peptide</strong> that has an\u00a0<strong>activity similar to ACTH</strong> on the adrenal glands. <strong>Serum cortisol</strong> levels are <strong>measured prior to, and after the administration</strong> of the synthetic peptide. <strong>Cortisol levels lower than the cut-off</strong> value indicate a <strong>failure of the adrenal glands to increase the production of cortisol</strong> in response to synthetic ACTH\u00a0\u2014 thus <strong>confirming the diagnosis</strong> of adrenal insufficiency. Note that this will be <strong>seen in both primary and secondary</strong> adrenal insufficiency.</p>\n<p>Adrenal insufficiency can be divided into:</p>\n<p><strong>Primary adrenal insufficiency</strong> <strong>(Addison's disease)</strong> is most commonly due to <strong>autoimmune adrenalitis</strong>. These patients are likely to develop other autoimmune diseases such as vitiligo, premature ovarian failure, and autoimmune thyroid disease. Other causes of Addison's disease include <strong>destruction of the adrenal gland due to infections such as TB</strong>, <strong>hemorrhage</strong> (<strong>Waterhouse-Friderichsen syndrome</strong> due to meningococcemia) or <strong>infiltration</strong>.</p>\n<p><strong>Secondary adrenal insufficiency</strong> occurs due to hypothalamic-pituitary axis dysfunction. This can include <strong>iatrogenic suppression</strong> due to chronic therapy with glucocorticoids, or because of <strong>pituitary</strong> and <strong>hypothalamic</strong> <strong>tumors</strong>.<strong> Pituitary apoplexy</strong> because of hypovolemic shock during parturition <strong>(Sheehan syndrome)</strong> can also cause secondary adrenal insufficiency.</p>\n<p>The patients present with <strong>fatigue</strong> and <strong>loss of energy</strong>. Primary adrenal insufficiency causes <strong>hyperpigmentation due to excess ACTH</strong>, which stimulates the melanocytes to produce more pigment. Hyperpigmentation is <strong>maximally seen in areas exposed to sunlight</strong> or that which <strong>undergo friction</strong>. However, <strong>secondary adrenal insufficiency</strong> presents with<strong> skin paleness</strong> due to the complete absence of ACTH.\u00a0</p>\n<p>The <strong>diagnosis</strong> of adrenal insufficiency is <strong>established by the ACTH stimulation test</strong> as described above. Primary and secondary adrenal insufficiencies can be differentiated biochemically:</p>\n<table style=\"width: 399.203px;\">\n<tbody>\n<tr>\n<td style=\"width: 194px;\"><strong>Primary adrenal insufficiency</strong></td>\n<td style=\"width: 184.203px;\"><strong>Secondary adrenal insufficiency</strong></td>\n</tr>\n<tr>\n<td style=\"width: 194px;\">Serum cortisol after ACTH stimulation: low</td>\n<td style=\"width: 184.203px;\">Serum cortisol after ACTH stimulation: low</td>\n</tr>\n<tr>\n<td style=\"width: 194px;\">Serum ACTH: <strong>high</strong></td>\n<td style=\"width: 184.203px;\">Serum ACTH: <strong>low</strong></td>\n</tr>\n<tr>\n<td style=\"width: 194px;\">Plasma renin: <strong>high</strong> (minerocorticoid deficiency also present, since adrenal gland itself is not functioning)</td>\n<td style=\"width: 184.203px;\">Plasma renin: <strong>normal</strong> (adrenal gland itself is functional and can be regulated by renin-angiotensin system)</td>\n</tr>\n</tbody>\n</table>\n<p><br />Patients should also undergo screening for steroid autoantibodies and a CT scan of the adrenal glands to narrow down the cause of the adrenal insufficiency.\u00a0</p>\n<p>Treatment is with <strong>oral hydrocortisone</strong> 15-25 mg/day in 2-3 divided doses. <strong>Long-acting agents are not preferred</strong> because they cause receptor activation even when the cortisol levels are supposed to be physiologically low in the body. Mineralocorticoid replacement is done with <strong>fludrocortisone</strong> 100-150 \u03bcg.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5fb4f3c9766d4c708438d2c5aa11f3d5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of fatigue and lethargy is being evaluated for adrenal insufficiency. The diagnosis was confirmed using a cosyntropin stimulation test, and subsequent testing revealed low morning ACTH levels. What is the next best diagnostic test for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Adrenal autoantibodies"
      },
      {
        "id": 2,
        "text": "Adrenal CT"
      },
      {
        "id": 3,
        "text": "MRI pituitary"
      },
      {
        "id": 4,
        "text": "Chest X-ray"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient with adrenal insufficiency has <strong>low ACTH levels</strong> suggestive of <strong>secondary adrenal insufficiency</strong>. Thus, the next best test would be an<strong> MRI pituitary.</strong></p>\n<p>Secondary adrenal insufficiency results from defects in <strong>ACTH secretion</strong> by the<strong> pituitary</strong> gland or <strong>CRH secretion</strong> by the <strong>hypothalamus</strong>. In this context, an <strong>MRI of the pituitary</strong> is the most appropriate next step.</p>\n<p><strong>Adrenal insufficiency</strong> is the decreased production of adrenocortical hormones and is classified as <strong>primary</strong>, or <strong>secondary</strong>. Evaluation of adrenal insufficiency begins with <strong>clinical suspicion</strong> based on symptoms such as <strong>weight loss</strong>, <strong>fatigue,</strong> <strong>postural hypotension</strong>, <strong>hyperpigmentation</strong>, and <strong>hyponatremia</strong>.</p>\n<p><strong>Diagnosis </strong>is confirmed with a <strong>cosyntropin stimulation test</strong>, which measures the adrenal glands' response to <strong>synthetic ACTH (cosyntropin)</strong>. A baseline cortisol level is obtained, followed by cosyntropin administration, with cortisol levels measured again after 30-60 minutes. In adrenal insufficiency, cortisol levels remain low despite stimulation.</p>\n<p>Differentiation between<strong> primary </strong>and <strong>secondary</strong> causes involves measuring <strong>plasma ACTH levels</strong>. <strong>High ACTH levels</strong> indicate<strong> primary adrenal insufficiency</strong>, warranting <strong>adrenal autoantibody tests</strong> and further <strong>imaging </strong>like chest X-ray or adrenal CT to determine the cause. <strong>Low or normal ACTH </strong>levels indicate <strong>secondary adrenal insufficiency</strong>, necessitating an <strong>MRI of the pituitary</strong> to identify possible lesions or other underlying causes (in patients not taking corticosteroids).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fb5cb8423cd7445f90ae0986a246a898x1200x2468.JPEG"
    ]
  },
  {
    "text": "Which of the following statements are true regarding pheochromocytoma?",
    "choices": [
      {
        "id": 1,
        "text": "2, 3"
      },
      {
        "id": 2,
        "text": "1, 2, 3, 5"
      },
      {
        "id": 3,
        "text": "2, 4"
      },
      {
        "id": 4,
        "text": "1, 3, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pheochromocytoma</strong> can present with both <strong>paroxysmal</strong> <strong>and sustained hypertension</strong>, and<strong> DOPA-PET can be used for the localization</strong> of the tumor.</p>\n<p><strong>Pheochromocytomas</strong> and <strong>paragangliomas</strong> are <strong>catecholamine-producing tumors</strong> that are <strong>derived from the autonomic nervous system</strong>. According to WHO terminology, the term <strong>pheochromocytoma</strong> is restricted to <strong>adrenal tumors</strong>, while the term <strong>paraganglioma</strong> is used for <strong>all the other sites</strong>.</p>\n<p>The patients present with the <strong>classic triad of headache</strong>, <strong>sweating</strong>, and <strong>palpitations</strong>. The dominant finding seen in the patients is <strong>hypertension</strong>. <strong>Both</strong> <strong>episodic/paroxysmal and sustained hypertension</strong> can be seen in the patients. During one of these episodes, there can be arrhythmias and heart failure. Pheochromocytoma is a state of <strong>contraction of the intravascular volume</strong>. This is because <strong>increased catecholamines</strong> cause <strong>systemic vasoconstriction</strong>. Further, there is<strong> increased activity of the renin-angiotensin-aldosterone system</strong>, causing <strong>efferent arteriolar vasoconstriction and increased filtration</strong> in the kidneys. Intravascular volume contraction causes <strong>orthostatic hypotension</strong>.\u00a0</p>\n<p><strong>Biochemical tests</strong> used to diagnose pheochromocytoma include <strong>24-hour urinary</strong> catecholamines and metanephrines, <strong>and</strong> <strong>plasma</strong>\u00a0<strong>catecholamines and metanephrines</strong>. <strong>T2 weighted MRI with gadolinium contrast</strong> is the investigation of choice <strong>for localization</strong> of the tumor. This is better than contrast-enhanced CT for detecting extra-adrenal tumors. <strong>Localization</strong> can <strong>also </strong>be done<strong> using</strong> <strong>MIBG</strong> and <strong>DOPA-PET scan</strong>. These agents are also useful for <strong>assessing metastatic disease</strong>.</p>\n<p>The optimal<strong> treatment is by resection of the tumor</strong>, either by <strong>partial or complete adrenelectomy</strong>. Normal adrenal cortex preservation is important to prevent the development of Addison's disease when the tumor is present bilaterally. The <strong>pre-operative preparation</strong> consists of giving <strong>oral phenoxybenzamine for\u00a0\u03b1 blockade first</strong>. Oral prazosin or IV phentolamine can be given to the patient while adequate\u00a0\u03b1 blockade with phenoxybenzamine is awaited.\u00a0\u03b1 blockade is achieved first in patients with pheochromocytoma because <strong>\u03b2 blockade alone will cause severe vasoconstriction</strong> because of the elevated catecholamine levels. <strong>Once\u00a0\u03b1 blockade</strong> is <strong>achieved,</strong>\u00a0<strong>\u03b2 blockers</strong> are then <strong>added</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of 11-beta-hydroxylase deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Hypertension"
      },
      {
        "id": 4,
        "text": "Virilization"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>11-beta-hydroxylase deficiency</strong>&nbsp;is associated with<strong>&nbsp;metabolic alkalosis</strong>, not metabolic acidosis.</p>\n<p>It is a rare form of congenital adrenal hyperplasia that presents with the following features:</p>\n<ul>\n<li>Glucocorticoid deficiency:\n<ul>\n<li>Hypoglycemia</li>\n<li>Hyperpigmentation around the genitals due to excess adrenocorticotropic hormone (ACTH) secretion&nbsp;</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Mineralocorticoid excess:\n<ul>\n<li><strong>Hypokalemia</strong></li>\n<li><strong>Hypertension</strong></li>\n<li>Metabolic alkalosis</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Adrenal androgen excess\n<ul>\n<li><strong>Virilization</strong> in females</li>\n<li>Precocious puberty in males</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following changes were observed on the administration of a drug. Which of the following is the likely drug?",
    "choices": [
      {
        "id": 1,
        "text": "Epinephrine"
      },
      {
        "id": 2,
        "text": "Norepinephrine"
      },
      {
        "id": 3,
        "text": "Propranolol"
      },
      {
        "id": 4,
        "text": "Isoproterenol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Since the administration of the given drug shows an <strong>increase in systolic, diastolic, and mean arterial pressure</strong>, along with <strong>reflex bradycardia</strong>, the drug is likely to be <strong>norepinephrine</strong>.</p>\n<p><strong>Norepinephrine</strong> acts on\u00a0<strong>\u03b1<sub>1</sub> </strong>and<strong>\u00a0\u03b2<sub>1</sub> receptors</strong> to increase the <strong>peripheral vascular resistance</strong> and <strong>stroke volume</strong>\u00a0respectively. This causes an <strong>increase </strong>in<strong> diastolic, systolic, </strong>and<strong> mean arterial pressure</strong>. Increased mean arterial pressure leads to <strong>reflex bradycardia</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/167cc0209d68468b9f26c06d1e2b22c5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/475c8edb8a074b809384fa8fcaacdfd5x1280x1988.JPEG"
    ]
  },
  {
    "text": "Which among the following is the most sensitive test to distinguish between Cushing\u2019s disease from ectopic ACTH production?",
    "choices": [
      {
        "id": 1,
        "text": "MRI pituitary"
      },
      {
        "id": 2,
        "text": "Inferior petrosal sinus sampling"
      },
      {
        "id": 3,
        "text": "High dose dexamethasone suppression test"
      },
      {
        "id": 4,
        "text": "CRH stimulation test"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The best test to differentiate <strong>Cushing\u2019s disease</strong> from<strong> Ectopic ACTH</strong> production is <strong>Inferior petrosal sinus sampling </strong>(IPSS) owing to its high sensitivity (95%) and specificity (99%).\u00a0</p>\n<p>During <strong>IPSS</strong>, catheters are placed in the <strong>inferior petrosal sinuses</strong>, which drain blood directly from the pituitary gland. Blood samples are collected from these sinuses and from a <strong>peripheral vein</strong> to measure ACTH levels.</p>\n<p>The principle of IPSS is based on the anatomical and functional characteristics of the pituitary gland:</p>\n<p><strong>Central-to-Peripheral Gradient:</strong> The <strong>pituitary </strong>gland directly releases ACTH into the venous blood that drains through the <strong>inferior petrosal sinuses.</strong> Therefore, in cases of<strong> Cushing's disease</strong> (where the source of excess ACTH is a pituitary adenoma), ACTH levels will be significantly higher in the blood samples taken from the <strong>inferior petrosal sinuses</strong> compared to the <strong>peripheral blood</strong>.</p>\n<p><strong>Baseline Ratio:</strong> A central-to-peripheral <strong>ACTH ratio greater than 2</strong> at baseline indicates the <strong>pituitary</strong> is the <strong>primary source </strong>of excess ACTH rather than from an ectopic source.</p>\n<p><strong>Stimulated Ratio:</strong> After the administration of CRH (corticotropin-releasing hormone), which stimulates ACTH secretion by the pituitary gland, a central-to-peripheral <strong>ACTH ratio greater than 3</strong> further confirms a <strong>pituitary source</strong>. This is because CRH administration would cause a more pronounced increase in ACTH release from a pituitary adenoma compared to ectopic sources.</p>\n<p>The absence of such a gradient (a ratio less than the thresholds mentioned) suggests that the source of excess ACTH is not the pituitary gland, but rather an <strong>ectopic source</strong> elsewhere in the body.</p>\n<p>MRI pituitary is not sensitive enough to detect small pituitary ACTH-secreting adenomas (&lt;2 mm).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Shown below is a section taken from a specimen of an adrenal gland. Which of the following results in a decrease in the hormone exclusively secreted by the layer marked as '1'?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperkalemia"
      },
      {
        "id": 2,
        "text": "ACTH"
      },
      {
        "id": 3,
        "text": "Renin"
      },
      {
        "id": 4,
        "text": "Hypernatremia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 926\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>In the above image, the layer marked as '1' is <strong>zona glomerulosa,\u00a0</strong>and\u00a0<strong>aldosterone </strong>is\u00a0exclusively secreted by this layer.\u00a0<strong>Hypernatremia </strong>decreases<strong> aldosterone secretion</strong>.\u00a0</p>\n<p>The\u00a0<strong>zona glomerulosa\u00a0</strong>is\u00a0a thin layer of cells that lies just underneath the capsule\u00a0of<strong>\u00a0</strong>the<strong>\u00a0adrenal gland.</strong></p>\n<p>The following factors are known to play roles in the regulation of aldosterone:\u00a0</p>\n<ul>\n<li><strong>Hyperkalemi</strong><strong>a\u00a0increases</strong> aldosterone secretion.</li>\n<li><strong>Increased angiotensin II</strong> concentration <strong>increases</strong>\u00a0aldosterone secretion.</li>\n<li><strong>Hypernatremia\u00a0</strong>concentration in the extracellular fluid<strong>\u00a0slightly decreases\u00a0</strong>aldosterone secretion.</li>\n<li><strong>ACTH</strong> from the anterior pituitary gland is necessary for aldosterone secretion but has <strong>minimal effect</strong> in physiological conditions.</li>\n<li>Increased sodium ion concentration in the extracellular fluid decreases aldosterone secretion.</li>\n</ul>\n<p>Other options:</p>\n<p>The adrenal cortex has three zones. From outer to inner, they are:</p>\n<ul>\n<li>Zona glomerulosa: Secretes mineralocorticoids (Aldosterone)</li>\n<li>Zona fasiculata: Secretes glucocorticoids (Cortisol)</li>\n<li>Zona reticularis: Secretes sex steroids</li>\n</ul>\n<p>The adrenal medulla secretes catecholamines.\u00a0</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/45e4c35bf17942a59b1d207bb2617e5e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f8f678ebee14a4c898fd7b400c9c2afx1279x984.JPEG"
    ]
  },
  {
    "text": "CRH responsiveness and residual ACTH suppression by high-dose dexamethasone are seen in hypercortisolism due to:",
    "choices": [
      {
        "id": 1,
        "text": "Pituitary adenoma"
      },
      {
        "id": 2,
        "text": "ACTH dependent adrenal tumor"
      },
      {
        "id": 3,
        "text": "Small cell lung cancer"
      },
      {
        "id": 4,
        "text": "ACTH independent adrenal tumor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>CRH responsiveness is seen only in hypercortisolism which is due to a pituitary cause.</p>\n<p>Physiologically, CRH released from the hypothalamus has a stimulatory effect on the pituitary corticotropic cells, thus producing ACTH.</p>\n<p>Hypercortisolism may be <strong>endogenous </strong>or <strong>iatrogenic</strong>.</p>\n<ul>\n<li>Iatrogenic hypercortisolism is not affected by dynamic testing</li>\n<li>Endogenous hypercortisolism may be ACTH-dependent or ACTH-independent</li>\n</ul>\n<p>ACTH-dependent Cushing&rsquo;s syndrome can be further classified by dynamic testing:</p>\n<p>Pituitary cause:</p>\n<ul>\n<li>CRH test &ndash; Positive. ACTH increase &gt; 40% at 15&ndash;30 min + cortisol increase &gt;20% at 45&ndash;60 min after CRH 100 &mu;g IV</li>\n<li>High-dose dexamethasone suppression test - Positive. Cortisol suppression &gt;50% after q6h 2 mg dexamethasone administration for 2 days</li>\n</ul>\n<p>Ectopic cause:</p>\n<ul>\n<li>CRH test - Negative</li>\n<li>High-dose dexamethasone suppression test - Negative</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female is suspected to have Cushing's syndrome. Which of the following investigations is not performed until a confirmatory diagnosis of Cushing's syndrome is established?",
    "choices": [
      {
        "id": 1,
        "text": "Estimation of midnight salivary cortisol"
      },
      {
        "id": 2,
        "text": "High dose dexamethasone suppression test"
      },
      {
        "id": 3,
        "text": "Low dose dexamethasone suppression test"
      },
      {
        "id": 4,
        "text": "Measurement of 24 hours urinary free cortisol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>high-dose dexamethasone suppression test</strong> is done only <strong>after a diagnosis</strong> of Cushing's syndrome is established in a patient.</p>\n<p>The high-dose dexamethasone suppression test is used in patients with confirmed Cushing syndrome. It helps to <strong>differentiate between Cushing's disease (i.e a pituitary cause) and ectopic ACTH production</strong>.</p>\n<p>The basis for this test is that in subjects with Cushing disease, a <strong>higher dose of dexamethasone</strong> (usually 8 mg) is <strong>required to suppress ACTH </strong>secretion and drop cortisol levels in serum, urine, and saliva.</p>\n<p><strong>Standard 2-day (high dose) dexamethasone suppression test:</strong></p>\n<ul>\n<li><strong>Serum cortisol level</strong> and/or 24-hour <strong>urinary free cortisol i</strong>s measured as a baseline, and then dexamethasone <strong>2 mg</strong> orally is taken <strong>every 6 hours</strong> for 48 hours; urine for free cortisol is collected during the test, and serum cortisol is checked <strong>6 hours after the last dose</strong>. The <strong>suppression</strong> of cortisol secretion to <strong>&gt;50 % of the baseline</strong> is considered positive and indicative of Cushing's disease</li>\n</ul>\n<p>The following four investigations are used to establish an initial diagnosis of endogenous Cushing's syndrome as per the clinical guidelines of the endocrine society.</p>\n<ul>\n<li><strong>24-hour urinary free cortisol</strong> (increased 3x above normal)</li>\n<li><strong>Midnight salivary cortisol</strong> ( &gt;5nmol/L)</li>\n<li>Overnight dexamethasone suppression (plasma cortisol &gt;50 nmol/L at 8-9 AM after 1 mg dexamethasone at 11 PM)</li>\n<li>Standard 2-day <strong>(low dose)</strong> <strong>dexamethasone suppression test</strong> (plasma cortisol &gt; 50 nmol/L after <strong>0.5 mg</strong> dexamethasone 6th hourly for 48 hours).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old man is brought to the emergency department with altered mental status. Lab workup shows serum sodium of 110 mEq/L and negative alcohol and toxicology screens. An opacity in the left lower lung is seen on the chest X-Ray. What is the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Fluid restriction"
      },
      {
        "id": 2,
        "text": "Demeclocycline"
      },
      {
        "id": 3,
        "text": "3% saline"
      },
      {
        "id": 4,
        "text": "Conivaptan"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>syndrome of inappropriate antidiuretic hormone&nbsp;</strong>(SIADH) with&nbsp;<strong>altered mental status</strong>, and the management in this patient is&nbsp;<strong>3% saline</strong>.</p>\n<p>SIADH occurs due to <strong>excessive production</strong> of <strong>ADH</strong> (or vasopressin). The most common cause are neuroendocrine neoplasms like <strong>small cell lung carcinoma</strong>&nbsp;(at least half the cases) and carcinoids.</p>\n<p>Symptoms include decreased thirst, lethargy, nausea, confusion, depressed mental status, and seizures. However, most patients are asymptomatic and are diagnosed incidentally due to the presence of <strong>hyponatremia</strong>. The severity of symptoms indicates the severity of hyponatremia. Hyponatremia occurs with <strong>decreased serum osmolality</strong> and <strong>normal</strong> or <strong>increased urine osmolality</strong>.</p>\n<p>Management includes <strong>correction of hyponatremia</strong> and treatment of the underlying malignancy. Since hyponatremia develops over several weeks to months, it should be corrected <strong>gradually</strong> at a rate of 0.5&ndash;1 meq/L/h to prevent brain dehydration and central pontine myelinolysis (an acute life-threatening neurological syndrome characterized by quadriparesis, ataxia, and abnormal extraocular movements).</p>\n<ul>\n<li><strong>Hypervolemic hyponatremia</strong>:\n<ul>\n<li><strong>Fluid restriction</strong> to less than urine output, plus insensible losses, with strict monitoring of fluid intake in mild cases</li>\n<li><strong>Vasopressin receptor antagonists</strong>, like conivaptan and tolvaptan, in severe cases</li>\n</ul>\n</li>\n<li><strong>Hypovolemic hyponatremia</strong> and/or <strong>altered mental status&nbsp;</strong>(indicating severe hyponatremia of &lt;115 mEq/L): <strong>Hypertonic (3%) </strong>or <strong>isotonic saline</strong> infusion</li>\n</ul>\n<p><strong>Demeclocycline</strong>, an inhibitor of vasopressin, is not preferred due to its relatively <strong>slower onset</strong> of action (1&ndash;2 weeks).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old woman presents with a history of palpitations, panic attacks, and difficulty swallowing. Examination reveals a heart rate of 110 bpm, a blood pressure of 156/100 mmHg, and a neck swelling that moves with swallowing. Labs show hypercalcemia, elevated calcitonin, and parathormone levels and an MRI shows bilateral adrenal masses. What gene is responsible for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "p53 tumor suppressor gene"
      },
      {
        "id": 2,
        "text": "MEN I tumor suppressor gene"
      },
      {
        "id": 3,
        "text": "RET proto-oncogene"
      },
      {
        "id": 4,
        "text": "CDKN1B gene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient most likely has <strong>multiple endocrine neoplasia 2A</strong>\u00a0(MEN) due to a <strong>gain of function mutation</strong> of <strong>RET proto-oncogene</strong>.\u00a0</p>\n<p>Palpitations, panic attacks, tachycardia, hypertension with bilateral adrenal masses suggest the presence of a <strong>pheochromocytoma</strong>. Difficulty swallowing and a neck swelling that moves with swallowing along with elevated calcitonin indicated <strong>medullary carcinoma of the thyroid</strong>. Hypercalcemia and elevated PTH could reflect <strong>parathyroid hyperplasia.</strong>\u00a0Pheochromocytoma, medullary carcinoma of the thyroid, and parathyroid hyperplasia is seen in MEN 2A.</p>\n<p><strong>MEN type 2 </strong>is classified into MEN 2A and MEN 2B.\u00a0</p>\n<p><strong>MEN 2A</strong> is also called <strong>Sipple syndrome</strong> and characterized by</p>\n<ul>\n<li>Pheochromocytoma</li>\n<li>Medullary carcinoma of the thyroid</li>\n<li>Parathyroid hyperplasia.</li>\n</ul>\n<p><strong>MEN 2B</strong> is characterized by</p>\n<ul>\n<li>Medullary carcinoma of the thyroid</li>\n<li>Pheochromocytoma.</li>\n<li>Mucosal neuromas of lips and tongue, intestinal ganglioneuromas, marfanoid habitus, and lax joints.</li>\n<li><strong>Parathyroid hyperplasia</strong> is <strong>absent</strong>.\u00a0</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: Mutations in the <strong>MEN1 tumor suppressor gene </strong>lead to<strong>\u00a0</strong><strong>MEN 1,\u00a0</strong>also called <strong>Wermer syndrome. </strong>\u00a0It is characterized by</p>\n<ul>\n<li>Parathyroid hyperplasia or adenoma</li>\n<li>Pancreas - endocrine tumors</li>\n<li>Pituitary - the most common anterior pituitary tumor is prolactinoma</li>\n</ul>\n<p>Option D: <strong>CDKN1B mutations</strong>\u00a0cause\u00a0<strong>MEN 4. </strong>This\u00a0is characterized by clinical features similar to MEN 1.</p>\n<p>Option A:\u00a0<strong>p53 tumor suppressor gene</strong> mutations can lead to <strong>Li Fraumeni syndrom</strong>e. This is an autosomal dominant hereditary cancer disorder. Patients develop multiple cancers at a young age such as sarcomas, breast cancer, brain tumors, and leukemias.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The graph below shows the variations in the levels of an adrenocortical hormone over a period of 24 hours. Excessive synthesis of this hormone can lead to which of the following features?",
    "choices": [
      {
        "id": 1,
        "text": "Decreased lipolysis"
      },
      {
        "id": 2,
        "text": "Decreased appetite"
      },
      {
        "id": 3,
        "text": "Decreased cellular immunity"
      },
      {
        "id": 4,
        "text": "Decreased protein catabolism"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The adrenocortical hormone likely plotted above is <strong>cortisol</strong> as the graph shows a diurnal variation with the maximum peak occurring around 8.00 AM. Excessive synthesis of this hormone<strong> </strong>leads to <strong>decreased</strong>\u00a0<strong>cellular immunity.</strong>\u00a0</p>\n<p>Cortisol <strong>suppresses</strong>\u00a0<strong>cellular immunity</strong> by <strong>inhibiting</strong> the <strong>production</strong> of <strong>IL-2</strong> and <strong>decreasing</strong> the <strong>proliferation</strong> of <strong>T-lymphocytes</strong>. This action is used for suppressing immunity by administering exogenous glucocorticoids to reduce the rejection reactions during transplantation. \u00a0</p>\n<p>Cortisol is secreted in a pulsatile fashion and has a <strong>diurnal variation</strong> in its level. The <strong>maximum level occurs in the morning</strong>\u00a0just before awakening (at around 8.00 AM). It gradually declines later and the\u00a0<strong>lowest levels</strong> are seen in the evening and midnight, after falling asleep.\u00a0</p>\n<p><strong>Cortisol</strong> is the major glucocorticoid hormone synthesized in the adrenal cortex, mainly in the zona fasciculata layer. Its <strong>actions </strong>are -\u00a0</p>\n<p>i) Metabolic effects:</p>\n<ul>\n<li>On carbohydrates: It stimulates gluconeogenesis, increases glycogen synthesis, and decreases the utilization of glucose in peripheral tissues. Thus, excess stimulation of cortisol causes <strong>hyperglycemia.\u00a0</strong></li>\n<li>On fat: Increases\u00a0<strong>lipolysis</strong>.\u00a0</li>\n<li>On protein: Exerts a catabolic effect and causes <strong>proteolysis</strong></li>\n<li>Effect on appetite: Increases the <strong>appetite</strong> and food intake by inducing the synthesis of <strong>neuropeptide-Y</strong>.</li>\n</ul>\n<p>ii) Anti-inflammatory\u00a0and immunosuppressive effects:</p>\n<ul>\n<li><strong>Induce</strong> the synthesis of <strong>lipocortin</strong>, an inhibitor of phospholipase A2</li>\n<li><strong>Inhibit</strong> the release of <strong>histamine</strong> and <strong>serotonin</strong>\u00a0</li>\n<li><strong>Inhibit</strong> the production of <strong>IL-2</strong> and <strong>T lymphocytes</strong>, and depresses\u00a0<strong>cellular immunity</strong></li>\n</ul>\n<p>iii) Maintenance of vascular responsiveness to catecholamines:</p>\n<ul>\n<li>Cortisol up-regulates <strong>\u03b11 receptors</strong> on arterioles, increasing their sensitivity to the <strong>vasoconstrictor</strong> effect of norepinephrine, thereby causing <strong>hypertension</strong> in hypercortisolism.\u00a0</li>\n</ul>\n<p>iv) Bone formation inhibition by decreasing the type 1 collagen synthesis, intestinal calcium absorption, and osteoblastic activity.\u00a0</p>\n<p>v) In the central nervous system, cortisol receptors are majorly found in the limbic system. Hence, stimulation of this decreases the rapid eye movement during sleep and increases awake time. Thus, high levels of cortisol are seen in the morning just before awakening.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9e6c292891ea40b2aec8613acc0f597a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman presents with a 2-month history of fatigue, muscle weakness, headaches, and palpitations. Her pulse is 75/min, and her blood pressure is 175/92 mm Hg. Physical examination is unremarkable and lab results show serum potassium of 2.8  mEq/L, increased plasma aldosterone levels, and suppressed plasma renin activity. Which of the following tests can confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dexamethasone suppression test"
      },
      {
        "id": 2,
        "text": "Saline infusion test"
      },
      {
        "id": 3,
        "text": "MRI brain"
      },
      {
        "id": 4,
        "text": "Renal duplex scan"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario along with lab findings suggests <strong>primary hyperaldosteronism</strong>. The diagnosis can be confirmed via <strong>saline infusion test.</strong></p>\n<p>The<strong> saline infusion tes</strong>t is a <strong>confirmatory</strong> test that involves administering intravenous saline to suppress aldosterone secretion. In normal physiology, <strong>increased intravascular volume</strong> from saline should <strong>suppress aldosterone </strong>production. However, in <strong>primary hyperaldosteronism</strong>, aldosterone levels remain<strong> elevated</strong> despite saline infusion, confirming <strong>autonomous</strong> aldosterone production.</p>\n<p><strong>Primary hyperaldosteronism </strong>(Conn syndrome), is characterized by excessive production of aldosterone by the adrenal glands. Patients commonly present with <strong>fatigue</strong>, <strong>muscle weakness</strong>, <strong>headaches</strong>,<strong> palpitations</strong>, and <strong>high blood pressure</strong>. <strong>Hypokalemia</strong> can cause <strong>muscle cramps</strong>, <strong>weakness</strong>, and even paralysis in severe cases. The <strong>diagnosis </strong>is suspected based on <strong>clinical presentation</strong> and laboratory findings of<strong> elevated plasma aldosterone</strong> and <strong>suppressed plasma renin </strong>activity</p>\n<p><strong>Approach to diagnosing hyperaldosteronism:</strong></p>\n<p>Evaluation begins with measuring<strong> plasma aldosterone concentration</strong> (PAC) and<strong> plasma renin activity</strong> (PRA). <strong>Elevated PAC and low PRA </strong>\u00a0suggest <strong>primary hyperaldosteronism. </strong>E.g. an<strong> adrenal mass </strong>that secretes <strong>aldosterone</strong> will increase PAC and intravascular volume but PRA is reduced because of negative feedback on the JG apparatus.</p>\n<p><strong>Elevated PAC and PRA</strong> indicate hyperaldosteronism due to a <strong>secondary</strong> cause such as <strong>renal artery stenosis</strong><span style=\"box-sizing: border-box; margin: 0px; padding: 0px;\"><strong> </strong></span>in which reduced perfusion to the kidney will activate RAAS and increase both renin and aldosterone.</p>\n<p><strong> Low levels</strong> of <strong>PAC and PRA</strong> suggest <strong>pseudo-hyperaldosteronism</strong>. e.g. The excess cortisol (which has mineralocorticoid activity) in Cushing's will cause symptoms of mineralocorticoid excess but renin and angiotensin will be low because of negative feedback on the RAAS system.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b3de5dfb7a54f349201ea0020de6ddex987x1104.PNG"
    ]
  },
  {
    "text": "A 3-year-old boy is brought with complaints of abdominal distension for the last 1 month. On examination, an irregular mass is palpated, which is crossing the midline. The patient's blood pressure is normal. Urine examination shows the presence of vanillylmandelic acid and homovanillic acid. Which of the following is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pheochromocytoma"
      },
      {
        "id": 2,
        "text": "Wilms tumor"
      },
      {
        "id": 3,
        "text": "Neuroblastoma"
      },
      {
        "id": 4,
        "text": "Hepatoblastoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario of a child presenting with a <strong>large abdominal mass</strong> with <strong>normal blood pressure</strong> and <strong>vanillylmandelic acid</strong>&nbsp;(VMA) and <strong>homovanillic acid</strong>&nbsp;(HVA) present <strong>in the urine</strong>, a diagnosis of <strong>neuroblastoma</strong> is most likely.</p>\n<p><strong>Neuroblastoma</strong> is the most frequently diagnosed <strong>malignancy in infancy</strong>. It most commonly arises from the <strong>adrenal glands</strong>, followed by sites along the sympathetic chain, such as the paravertebral region of the abdomen and posterior mediastinum. Neuroblastoma is derived from <strong>primordial neural crest cells</strong> which populate these sites. In young children, they present as large <strong>abdominal masses</strong> with fever and weight loss. They can also metastasize widely and present with symptoms related to other systems.&nbsp;</p>\n<p>90% of neuroblastoma produce <strong>catecholamines</strong>. Urinary levels of <strong>VMA</strong> and <strong>HVA</strong> act as important <strong>tumor markers</strong> and help in making the diagnosis of the disease. Despite the elaboration of catecholamines, <strong>hypertension is less frequent</strong> in these tumors compared to pheochromocytoma. Histologically, neuroblastoma show small, primitive-appearing cells with dark nuclei&nbsp;&mdash; and thus may be difficult to differentiate from other <strong>small round blue cell</strong> tumors. The background shows faintly <strong>eosinophilic fibrillary material (neuropil)</strong> which represents the neuritic processes of the primitive neuroblasts. Around the neuropil, the <strong>tumor cells</strong> are <strong>arranged concentrically</strong>. This is referred to as <strong>Homer-Wright pseudorosettes</strong>.</p>\n<p>Other options:</p>\n<p>Option A: The dominant clinical feature in <strong>pheochromocytoma</strong> is <strong>hypertension</strong>. Most patients have <strong>paroxysmal episodes</strong>, which are abrupt elevations in blood pressure. They are accompanied by <strong>tachycardia</strong>, <strong>palpitations</strong>, <strong>headache</strong>, and sweating. Lab diagnosis of pheochromocytoma is based on the demonstration of <strong>increased urinary excretion</strong> of <strong>free catecholamines</strong> and their metabolites such as <strong>VMA</strong>.</p>\n<p>Option B: <strong>Wilms tumor (nephroblastoma)</strong> usually presents as a <strong>unilateral abdominal mass</strong>, abdominal pain, <strong>hypertension</strong>, and gross <strong>hematuria</strong>. Wilms tumor thrombus can extend into the inferior vena cava and the right atrium. Laboratory findings that can be seen include <strong>polycythemia</strong> and <strong>thrombocytosis</strong>.</p>\n<p>Option D: <strong>Hepatoblastoma</strong> presents as an <strong>asymptomatic mass in the right upper quadrant</strong> of the abdomen. It mostly arises from the right lobe of the liver. Patients have <strong>non-specific symptoms</strong> such as fever, fatigue, weight loss, and anorexia. A biopsy of the liver mass is necessary to make the diagnosis. <strong>Alpha-fetoprotein (AFP)</strong> is a useful tumor marker that is used in diagnosis and monitoring.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/865333df5e6d4bc6944f21720fcf027cx1280x1096.JPEG"
    ]
  },
  {
    "text": "A 33-year-old man collapses during a family vacation. At the hospital, blood pressure is found to be 86/52 mm Hg, and random blood sugar is 49 mg/dl. His wife says that he has been on treatment for Addison's disease for two years but had forgotten to pack his medication for the trip. What is the drug of choice for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Norepinephrine"
      },
      {
        "id": 2,
        "text": "Hydrocortisone"
      },
      {
        "id": 3,
        "text": "Dexamethasone"
      },
      {
        "id": 4,
        "text": "Fludrocortisone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario is suggestive of an<strong> adrenal crisis</strong> triggered by missed medication. In this patient who is a <strong>known</strong> <strong>case</strong> of adrenal insufficiency, <strong>IV hydrocortisone</strong> is the drug of choice.</p>\n<p>However, in patients with <strong>newly diagnosed</strong> adrenal insufficiency,\u00a0<strong>dexamethasone</strong> is used for the treatment of adrenal crisis. This is because dexamethasone is not measured in cortisol assays and would <strong>not interfere</strong> with the\u00a0<strong>diagnostic</strong> <strong>tests</strong>, whereas hydrocortisone interferes with cortisol assays.</p>\n<p>Acute adrenal insufficiency requires the immediate initiation of the following therapeutic strategies:</p>\n<ul>\n<li>Rehydration -\u00a0<strong>saline</strong> infusion at an initial rate\u00a0of 1 L/h with continuous cardiac monitoring.</li>\n<li><strong>Glucocorticoid</strong> replacement<strong> -\u00a0</strong>bolus injection of 100 mg hydrocortisone<strong>, </strong>followed by the maintenance dose of 100\u2013200 mg over 24h.</li>\n<li><strong>Mineralocorticoid</strong> replacement -\u00a0initiated once the daily hydrocortisone dose has been reduced to &lt;50 mg as higher doses\u00a0of hydrocortisone have sufficient mineralocorticoid action.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a 3-month history of unintentional weight gain and fatigue. An exam reveals high blood pressure (149/88 mm Hg), central obesity, and abdominal striae. Lab results show elevated 24-hour urinary-free cortisol and suppressed serum ACTH. Which test would most likely confirm the underlying cause of these symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Inferior petrosal sinus sampling"
      },
      {
        "id": 2,
        "text": "CT scan of the abdomen"
      },
      {
        "id": 3,
        "text": "High dose dexa suppression test"
      },
      {
        "id": 4,
        "text": "CT scan of the chest"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient's symptoms and lab findings indicate hypercortisolism, likely <strong>Cushing's syndrome</strong>. The <strong>suppressed ACTH </strong>suggests that the source of cortisol is <strong>ACTH-independent</strong>, often due to an <strong>adrenal mass</strong> which can be confirmed with an unenhanced <strong>CT scan of the abdomen</strong>.</p>\n<p>The<strong> diagnostic</strong> evaluation for <strong>Cushing's syndrome</strong> begins with confirming <strong>hypercortisolism</strong> through tests such as the <strong>24-hour urinary free cortisol test</strong>, <strong>overnight dexamethasone suppression test</strong>, or <strong>midnight salivary cortisol test</strong>. Once hypercortisolism is confirmed, the next step is determining whether the cause is <strong>ACTH-dependent</strong> or <strong>ACTH-independent</strong>. This is done by measuring plasma ACTH levels.</p>\n<p>If <strong>ACTH levels are suppressed </strong>it indicates an <strong>ACTH-independent</strong> cause, typically suggesting an adrenal source. Imaging studies, such as a <strong>CT scan of the abdomen</strong>, are performed to identify any <strong>adrenal masses</strong> (e.g., adenomas, carcinomas, or hyperplasia).</p>\n<p>If <strong>ACTH levels are elevated or normal </strong>it suggests an<strong> ACTH-dependen</strong>t cause, possibly due to a <strong>pituitary adenoma</strong> (Cushing's disease) or <strong>ectopic ACTH production</strong>. Further evaluation includes a <strong>high-dose dexamethasone suppression test</strong> and a <strong>CRH stimulation test</strong>. If cortisol levels <strong>decrease</strong> significantly after high-dose dexamethasone and the<strong> CRH test is positive</strong>, it suggests a <strong>pituitary source</strong> (Cushing's disease) which can be confirmed with an MRI. If cortisol levels <strong>are not suppressed</strong>, and the <strong>CRH test is negative</strong> the patient should be evaluated for<strong> ectopic ACTH production</strong>. In case of <strong>equivocal results</strong>, an<strong> Inferior petrosal sinus sampling</strong> may be performed to differentiate the two causes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/85809380960f4804a98cadbd31d24b80x1200x2435.JPEG"
    ]
  }
];
        let quizName = 'Adrenal Disorders Mini Test - -Tmt';
        const quizFilename = 'adrenal-disorders-mini-test-tmt-8fc81a76.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>