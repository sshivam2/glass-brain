<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphs Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The image shows a graph plotted between the rate of reaction (on the y-axis) and substrate concentration (on the x-axis). Which of the following statements is not true regarding this plot?",
    "choices": [
      {
        "id": 1,
        "text": "It is not seen with monomeric enzymes"
      },
      {
        "id": 2,
        "text": "It shows cooperative binding"
      },
      {
        "id": 3,
        "text": "Follows Michaelis Menten kinetics"
      },
      {
        "id": 4,
        "text": "The enzyme may have multiple binding sites"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Follows Michaelis Menten kinetics statement is not true regarding this plot.&nbsp;</p>\n<p>The given plot shows a<strong> sigmoid curve</strong> suggestive of <strong>cooperative binding</strong> of the enzymes to their substrates. This type of saturation kinetics is explained by <strong>Hill equation</strong>.&nbsp;</p>\n<p>Michaelis - Menten Kinetics:</p>\n<p>The&nbsp;Michaelis - Menten equation gives the mathematical relationship between initial reaction velocity, v, and substrate concentration [S] which is as given below.</p>\n<p>v = Vmax[S]/Km+[S]</p>\n<p>where Km is the substrate concentration at which vi is half the maximal velocity (Vmax/2) which is reached at a particular concentration of the enzyme.</p>\n<p>A graph showing a&nbsp;<strong>hyperbola</strong>&nbsp;is suggestive of&nbsp;<strong>Michaelis - Menten kinetics</strong>&nbsp;of the enzyme which is as follows.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/faaecbceff0e44c5acd76abb409a38c5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53d8941f098149da9505f6087dca6c5cx720x307.PNG"
    ]
  },
  {
    "text": "A 14-year-old boy presented with jaundice, fever and mild splenomegaly. The patient is asked to get an Eosin-5\u2019-maleimide (EMA) test which turns out to be positive. In this condition, what property of the red blood cells produces the graph (A) in the osmotic fragility curve?",
    "choices": [
      {
        "id": 1,
        "text": "Initial increase then decrease in SA/V ratio"
      },
      {
        "id": 2,
        "text": "Decreased V/SA ratio"
      },
      {
        "id": 3,
        "text": "Increased V/SA ratio"
      },
      {
        "id": 4,
        "text": "Initial decrease then increase in SA/V ratio"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span style=\"font-family: arial, helvetica, sans-serif;\">In the given clinical scenario, the symptoms of <strong>jaundice, fever</strong> and <strong>mild splenomegaly</strong> with a positive Eosin-5\u2032-maleimide (<strong>EMA</strong>)\u2013binding test, point towards the diagnosis of <strong>Hereditary spherocytosis</strong>. This can be confirmed by the <strong>right shift</strong> seen in the osmotic fragility curve which occurs due to an <strong>increased V/SA ratio.</strong></span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">Osmotic fragility is the ability of red blood cells to resist hemolysis when placed in <strong>increasing dilutions</strong> of saline solution. In the graph, the x-axis represents the saline concentration while the y-axis represents the percentage of red cells that have undergone hemolysis. Normal hemolysis <strong>begins</strong> at a concentration of <strong>0.5% </strong>NaCl and is <strong>completed</strong> at a concentration of <strong>0.3%</strong> NaCl as shown in the graph.</span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">In Hereditary Spherocytosis, the osmotic fragility of the red blood cells is characteristically <strong>increased</strong> and they lyse more easily in a hypotonic solution than normal discoid RBCs due to the <strong>increased volume/surface area ratio.</strong>\u00a0This is seen as a <strong>right</strong> shift in the osmotic fragility graph. Here hemolysis begins at a higher concentration of the saline solution.\u00a0</span></p>\n<div class=\"page\" title=\"Page 254\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">Decreased osmotic fragility indicates the presence of unusually flattened red cells (leptocytes) in which the RBCs have<strong> decreased volume/surface area ratio. </strong>Such changes occur in <strong>iron deficiency anaemia</strong> and <strong>thalassaemia</strong> in which the red cells with <strong>low</strong> mean cell haemoglobin <strong>(MCH) </strong>and mean cell volume <strong>(MCV)</strong> are unusually resistant to osmotic lysis. This is seen as a <strong>left</strong> shift in the osmotic fragility graph.</span></p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9fbc32d84cc841259a2dce3884933090.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/95a58cb42c2e4626a8a7dbb6c7271e89x1280x1123.JPEG",
      "https://cdn1.dailyrounds.org/uploads/ca83ecf1d6404ea0880cc349cf9a0097.JPEG"
    ]
  },
  {
    "text": "A 33-year-old lady presents with complaints of ear pain associated with impaired hearing. Further evaluation by otoscopy reveals a dull and lustreless tympanic membrane with prominent lateral process of the malleus. Which of the following curves will be obtained if she undergoes tympanometry?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">In the given clinical case, otoscopy findings of a dull and lustreless tympanic membrane with prominent lateral process of the malleus, are highly suggestive of a <strong>retracted tympanic membrane.&nbsp;</strong>On Tympanometry, a <strong>Type C tympanogram </strong>(Curve 1)<strong> </strong>with <strong>normal compliance</strong> and <strong>negative</strong>&nbsp;<strong>pressure</strong> is seen in the case of<strong> </strong>a<strong> retracted tympanic membrane.</strong></p>\n<p>Features of retracted TM:</p>\n<ul>\n<li>TM is <strong>dull</strong> and <strong>lustreless.</strong></li>\n<li>The cone of light is absent or interrupted.</li>\n<li>The handle of the malleus appears foreshortened.</li>\n<li>The <strong>lateral</strong> process of the <strong>malleus</strong> becomes more <strong>prominent.</strong></li>\n<li>Anterior and posterior malleal folds become sickle-shaped.</li>\n</ul>\n<p class=\"p1\"><strong>Tympanometry:&nbsp;</strong>It is used in evaluating the <strong>status of the middle ear</strong> and the&nbsp;<strong>functioning of the eustachian tube</strong>. Results of tympanometry are plotted in the form of a <strong>tympanogram</strong>&nbsp;with:</p>\n<ul>\n<li><strong>Compliance</strong>&nbsp;on the&nbsp;<strong>Y&nbsp;</strong>axis (ease of mobility of TM)</li>\n<li>Middle ear&nbsp;<strong>pressure</strong>&nbsp;on the&nbsp;<strong>X</strong>&nbsp;axis (regulated by eustachian tube)</li>\n</ul>\n<p class=\"p1\"><strong> Principle</strong>: When a sound wave strikes the tympanic membrane, some of the sound energy is absorbed while the rest is reflected. A stiffer tympanic membrane would reflect more sound energy than a compliant one.</p>\n<div class=\"page\" title=\"Page 52\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Tympanometry has also been used to evaluate the function of the <strong>eustachian tube</strong> in cases of intact or perforated tympanic membrane. A pressure of &mdash;200 or +200 mm H<sub>2</sub>O is created in the middle ear and the person is asked to swallow 5 times in 20 seconds. The ability to equilibrate the pressure indicates <strong>normal</strong> tubal function. It <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">is also used in evaluating the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">patency of the grommet</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> inserted in the tympanic membrane for treating serous otitis media.</span></p>\n<p>Curve 2- <strong>Type B</strong> curve. A <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">flat or dome-shaped graph. No change </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">in compliance with pressure changes. Seen in middle ear fluid or thick tympanic membrane.</span></p>\n<p>Curve 3- <strong>Type As</strong> curve. C<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">ompliance is lower at or near ambient air </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">pressure. Seen in </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">otosclerosis or malleus fixation.</span></p>\n<p>Curve 4- <strong>Type Ad </strong>curve. <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">High compliance at or near ambient </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">pressure. Seen in ossicular discontinuity </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">or thin and lax tympanic membrane.</span></p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">By charting the compliance of the tympano-ossicular system against various pressure changes, different types of graphs called </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">tympanograms</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> are obtained. They are as follows:</span></p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f65c8da680334e9aa5ffde40c28a9ef3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0ee955ecd78437ea4212f93c7082a5fx1280x2078.JPEG"
    ]
  },
  {
    "text": "In the given left ventricular pressure-volume loop, which of the following corresponds to the 'c' wave of JVP?",
    "choices": [
      {
        "id": 1,
        "text": "Point A to Point B"
      },
      {
        "id": 2,
        "text": "Point B to Point C"
      },
      {
        "id": 3,
        "text": "Point C to Point D"
      },
      {
        "id": 4,
        "text": "Point D to Point A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given left ventricular pressure-volume loop, the event that occurs between <strong>Points B</strong> and<strong> C</strong> is <strong>iso-volumetric contraction</strong>,<strong> </strong>which corresponds to the <strong>\u2018c\u2019 wave\u00a0of JVP.</strong></p>\n<p>In iso-volumetric contraction, the ventricular muscle continues to contract, even though the ventricular volume does not change, with all valves closed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/004de49d2b394a2493c923b6670604ce.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/4104819310e844c5bb68cfc86fda6911.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b35c30d3d1444ce28a07bc83908402fbx1280x1418.PNG"
    ]
  },
  {
    "text": "An opioid overdose victim with severe respiratory depression was brought to the casualty. You start the patient on the most potent drug known to reverse respiratory depression in this condition. Which of the following graphs represents the action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Graph 1"
      },
      {
        "id": 2,
        "text": "Graph 2"
      },
      {
        "id": 3,
        "text": "Graph 3"
      },
      {
        "id": 4,
        "text": "Graph 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The drug of choice for the <strong>reversal&nbsp;</strong>of<strong> respiratory depression</strong> in opium overdose is <strong>naloxone&nbsp;</strong>which acts as a <strong>competitive opioid antagonist </strong>represented by <strong>graph 3.</strong></p>\n<p><strong>Competitive</strong>&nbsp;<strong>antagonist</strong> is an agent which blocks or reduces the action of an agonist on a receptor but does not have any effect of its own. Naloxone acts on the <strong>&micro; receptors&nbsp;</strong>in the brainstem respiratory centres.</p>\n<p><strong>Naltrexone</strong> is also an opioid antagonist that blocks opioid effects, particularly euphoria, and discourages per&shy;sons with opioid dependence from substance-seeking behaviour. It is <strong>not the first choice</strong> in acute opioid overdose.</p>\n<p><strong>Graph 1 </strong>represents the <strong>agonist</strong>: An agonist is an agent which initiates the <strong>normal</strong> <strong>physiological response</strong> when combined with a receptor. Example: <strong>Salbutamol</strong> is a beta-2 receptor agonist.&nbsp;</p>\n<div><strong>Graph 2</strong> represents a <strong>partial agonist</strong>: An agent which produces a <strong>submaximal or partial effect</strong> when combined with a receptor. Example: <strong>B</strong><span class=\"ILfuVd\" lang=\"en\"><span class=\"hgKElc\"><strong>uprenorphine</strong> and butorphanol are partial agonists at opioid receptors.</span></span></div>\n<div style=\"padding-left: 30px;\">&nbsp;</div>\n<div><strong>Graph 4</strong> represents an<strong> inverse agonist</strong>: An agent which activates a receptor to produce an effect in the opposite direction to that of the agonist. Example: &beta;-<strong>Carboline</strong> is an inverse agonist at the benzodiazepine site of the GABA-A receptor.</div>\n<div>&nbsp;</div>\n<div><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">According to the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">receptor occupation theory</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">, the ability of a drug to bind to a receptor is its </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">affinity,</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> and the ability to induce functional change in the receptor is designated as the</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> intrinsic activity (IA)</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of the drug. These 2 properties are</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> independent</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of each other.</span></div>\n<div>\n<p>The intrinsic activities of the above groups of drugs are given below:</p>\n<table style=\"width: 310px; height: 200px;\">\n<tbody>\n<tr style=\"height: 31px;\">\n<td style=\"height: 31px; width: 155.766px;\">\n<p><strong>Type of drugs</strong></p>\n</td>\n<td style=\"height: 31px; width: 138.234px;\">\n<p><strong>Intrinsic activity</strong></p>\n</td>\n</tr>\n<tr style=\"height: 31px;\">\n<td style=\"height: 31px; width: 155.766px; text-align: center;\">\n<p>Agonists</p>\n</td>\n<td style=\"height: 31px; width: 138.234px; text-align: center;\">\n<p>1</p>\n</td>\n</tr>\n<tr style=\"height: 31px;\">\n<td style=\"height: 31px; width: 155.766px; text-align: center;\">\n<p>Partial agonists</p>\n</td>\n<td style=\"height: 31px; width: 138.234px; text-align: center;\">\n<p>&gt;0 to &lt;1</p>\n</td>\n</tr>\n<tr style=\"height: 31px;\">\n<td style=\"height: 31px; width: 155.766px; text-align: center;\">\n<p>Competitive antagonists</p>\n</td>\n<td style=\"height: 31px; width: 138.234px; text-align: center;\">\n<p>0</p>\n</td>\n</tr>\n<tr style=\"height: 31px;\">\n<td style=\"height: 31px; width: 155.766px; text-align: center;\">\n<p>Inverse agonists</p>\n</td>\n<td style=\"height: 31px; width: 138.234px; text-align: center;\">\n<p>&lt;0 to -1</p>\n</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>The image given below shows the action of various types of selective receptor modulators:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b9f8b272dac541afbb362328ee71e2ed.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d7167c153aa42a5bdc0787fd454473ex1280x1252.JPEG"
    ]
  },
  {
    "text": "Which of the following modes of transport follows transportation kinetics similar to that marked by the arrow in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Facilitated diffusion"
      },
      {
        "id": 2,
        "text": "Na+-Ca2+ exchanger"
      },
      {
        "id": 3,
        "text": "Simple diffusion"
      },
      {
        "id": 4,
        "text": "Coupled transport"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image indicates a transportation process that shows a linear increase and does <strong>not get saturated at higher concentrations</strong>. <strong>Simple diffusion</strong> is <strong>not a carrier-mediated</strong> transport and hence, does\u00a0<strong>not follow saturation kinetics.</strong></p>\n<p>Facilitated diffusion, primary active transport, and secondary active transport all involve integral membrane proteins and are called <strong>carrier-mediated transport</strong>.\u00a0All<strong> carrier-mediated transport </strong>system follows<strong> saturation kinetics</strong>.\u00a0The figure shows that as the concentration of the diffusing substance increases, the rate of simple diffusion continues to increase proportionately, but in the case of facilitated diffusion, the rate of diffusion cannot rise greater than the<strong> transport maximum</strong> (Tm). Tm is analogous to the\u00a0<strong>maximum velocity</strong> (V<sub>max</sub>) level in enzyme kinetics.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/40e74fcb56a54660a9823907f9d9446f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57ca1b0e751c4de3b0537fdd51104884x1280x959.JPEG"
    ]
  },
  {
    "text": "A 5-month-old boy presents with repeated epileptic spasms. Lately, his parents noticed that he is no longer able to hold his head steadily. EEG findings are given below. On examination, ash-leaf-like hypopigmented macules on both hands and an irregularly thickened skin-coloured patch on the lower back are seen. What is the drug of choice for treating this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Vigabatrin"
      },
      {
        "id": 2,
        "text": "ACTH"
      },
      {
        "id": 3,
        "text": "Valproate"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario of <strong>infantile spasms, developmental</strong> <strong>regression </strong>(inability to hold his head steadily) and the EEG showing <strong>hypsarrhythmia </strong>(high-voltage, slow, chaotic background with multifocal spikes) are suggestive of <strong>West syndrome</strong>.&nbsp;The presence of <strong>ash leaf-like hypopigmented</strong> macules and an irregularly thickened skin-coloured patch on the lower back (<strong>Shagreen patch</strong>) also suggests the child has <strong>Tuberous Sclerosis.</strong>&nbsp;</p>\n<p>The drug of choice for treating this condition is <strong>Vigabatrin</strong>. Vigabatrin is a GABA uptake <strong>inhibitor</strong> that has been found to be effective in controlling infantile spasms associated with Tuberous Sclerosis.&nbsp;</p>\n<p>West syndrome starts between the ages of <strong>2 and 12 months </strong>and is characterized by <strong>salaam spells</strong>&nbsp;(sudden dropping of the head or flexion of arms, followed by tonic extension of arms and legs) and&nbsp;<strong>hypsarrhythmia</strong> on EEG.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/00fd9d1fbe324b278054d7b44363fa1a.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/d6d904bf59764876ac6c40c43d33cab9.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c9ed2a28a824a6fa902d9eeb85412c2x1280x2409.JPEG"
    ]
  },
  {
    "text": "Which of the following serological titers in a patient with acute hepatitis B has been incorrectly labeled?",
    "choices": [
      {
        "id": 1,
        "text": "1- HBsAg"
      },
      {
        "id": 2,
        "text": "4- HBcAg"
      },
      {
        "id": 3,
        "text": "3-  Anti HBc"
      },
      {
        "id": 4,
        "text": "2- Anti HBs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span style=\"font-family: arial, helvetica, sans-serif;\">In the given graph of serological markers, in a patient with acute hepatitis B infection curve 4 is incorrectly labeled. Curve 4 represents, </span><strong><span style=\"font-family: arial, helvetica, sans-serif;\">IgM Anti HBc</span></strong><span style=\"font-family: arial, helvetica, sans-serif;\">.</span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">The parameters marked in the graph respectively include:</span></p>\n<ol>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\">HBsAg antigen</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\">Anti HBs</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\">Total Anti HBc</span></li>\n<li><strong><span style=\"font-family: arial, helvetica, sans-serif;\">IgM Anti HBc</span></strong></li>\n</ol>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">Hepatitis B virus contains a 27-nm nucleocapsid core particle which is coded for by the <strong>C gene.</strong> The antigen expressed on the surface of the nucleocapsid core is hepatitis B core antigen <strong>(HBcAg),</strong> and its corresponding antibody is <strong>anti-HBc. </strong></span><span style=\"font-family: arial, helvetica, sans-serif;\">Because HBcAg is <strong>intracellular </strong>and sequestered within an HBsAg coat, naked core particles do not circulate in serum, and therefore, HBcAg is <strong>not detectable</strong> routinely in the serum of patients with HBV infection.</span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">Specific diagnosis of hepatitis B rests on the serological demonstration of the viral markers:</span></p>\n<div class=\"page\" title=\"Page 559\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\"><strong>HBsAg</strong>\u00a0is the\u00a0<strong>first marker</strong>\u00a0seen in the blood following infection and can be detected prior to the clinical manifestation and elevation of transaminases. Typically, they\u00a0<strong>disappear\u00a0</strong>within about\u00a0<strong>two months</strong>\u00a0of the start of clinical disease, but may sometimes persist for six months.</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\"> <strong>Anti-HBs</strong> antibodies are <strong>protective</strong> antibodies and they appear when the antigens are no longer detectable and they remain for very long periods.\u00a0</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\"><strong>Anti-HBc</strong> antibody\u00a0is the\u00a0<strong>earliest marker\u00a0</strong>seen in blood a week or two after the appearance of HBsAg.<strong> IgM anti-HBc</strong> is predominant in <strong>acute</strong> infections. Later, it is replaced by IgG anti-HBc. It remains for a lifetime and thus indicates a <strong>prior infection.</strong></span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\"><strong>HBeAg</strong>\u00a0appears in blood\u00a0along\u00a0with\u00a0HBsAg\u00a0or following its appearance. Circulating HBeAg is an indicator of active intrahepatic\u00a0<strong>viral replication</strong>, and the presence of DNA polymerase, HBV DNA, and virions, reflect\u00a0<strong>high infectivity</strong>.</span></li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 2604\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 2604\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 2606\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong style=\"font-family: arial, helvetica, sans-serif;\">Note:</strong></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\"><strong>Recovery</strong> from hepatitis B: <strong>Anti-HBsAg </strong>and <strong>Anti-HBc IgG </strong>will be positive in case of recovery.</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\">History of Hepatitis B in the<strong> remote past</strong>: <strong>Anti-HBc IgG</strong> is the serological marker.</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\"><strong>Chronic hepatitis </strong>with low infectivity: <strong>HBsAg, Anti-HBeAg,\u00a0</strong>and<strong> Anti-HBc IgG </strong>will be positive.</span></li>\n<li><span style=\"font-family: arial, helvetica, sans-serif;\">In<strong> immunized</strong> individuals, <strong>only Anti-HBsAg</strong> will be positive.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9aef8e50f2fe48a3a8065bf637a7e2b7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young male patient presented to the casualty after a road traffic accident and was diagnosed with intracranial hemorrhage on the CT brain. He was started on hypertonic saline. Which of the following images best depict the changes in the fluid volumes after administration of the given saline?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>After the administration of hypertonic saline, the changes in the fluid volume occur as depicted in <strong>image 4.</strong></p>\n<p>The clinical features depict raised intracranial pressure due to intracranial haemorrhage. Patients are started on osmotic diuretics like mannitol or hypertonic saline to <strong>prevent cerebral swelling</strong>. The administration of the osmotic agents increases the osmolarity of the plasma. The cerebral tissues have lower osmolarity compared to the plasma. Therefore, this leads to the flow of excess water from cerebral tissues to the blood via osmosis.</p>\n<p>Whenever hypertonic saline is added to the extracellular fluid (ECF),&nbsp;the extracellular osmolarity increases. It causes osmosis of water out of the cells into the extracellular compartment. Almost all the added sodium chloride remains in the extracellular compartment and fluid diffuses into the extracellular space to achieve osmotic equilibrium. The net effect is that the <strong>volume of ECF increases</strong>, the volumes of<strong> intracellular fluid (ICF) decreases</strong>, and the <strong>osmolarity</strong> of <strong>both</strong> compartments <strong>increase.&nbsp;</strong></p>\n<p>Whenever <strong>isotonic saline</strong> is added to the extracellular fluid, the osmolarity of fluids does not change. The main effect is that it <strong>increases the ECF</strong> volume</p>\n<p>Whenever <strong>hypotonic saline</strong> is added to ECF, the osmolarity of ECF decreases. This leads to the movement of water from the ECF to the ICF until both attain the same osmolarity.&nbsp;Both the <strong>intracellular and extracellular volumes</strong> are <strong>increased</strong> by the addition of hypotonic fluid, but the intracellular volume increases to a greater extent. Osmolarity decreases in both the compartments.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/976f4848e62c45f29eb4739f00841179.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8512a47f2b74f4895873c591a8f0aecx1280x1825.2186177715091.JPEG"
    ]
  },
  {
    "text": "Given below is a graph of the 24-hour levels of a hormone. Identify the correct set of conditions that stimulate the release of this hormone.",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The hormone depicted in the graph shows&nbsp;<strong>pulsatile secretion</strong>, with an&nbsp;<strong>increase</strong> during strenuous&nbsp;<strong>exercise</strong>&nbsp;and&nbsp;<strong>early periods of sleep</strong>, indicating that it is <strong>growth hormone&nbsp;</strong>(GH). The conditions that stimulate the release of GH are given in option A - a <strong>decrease</strong> in <strong>blood glucose</strong> and <strong>free fatty acid</strong> levels and an <strong>increase</strong> in blood <strong>amino acid </strong>(especially arginine) levels.&nbsp;</p>\n<p><strong>Growth hormone</strong> is secreted by the <strong>somatotropes</strong>&nbsp;located in the&nbsp;<strong>anterior pituitary</strong>. The levels of growth hormones show&nbsp;<strong>diurnal variation</strong>&nbsp;as well as variation across different age groups.&nbsp;<strong>Adolescents</strong>&nbsp;have the&nbsp;<strong>highest</strong>&nbsp;<strong>circulating levels</strong>&nbsp;of growth hormone, followed by children and adults. The levels are relatively low during the day and the pulsatile release of this hormone occurs during sleep.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/16cd67938ea74fd6ae5dd50482897d71.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 15-year-old girl presented with fever, hypotension, and skin rash with a tampon in situ for more than 1 week. A bacterial cause is suspected. The factor responsible for this disease is produced during which of the following phases in the bacterial growth curve?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above presentation of <strong>fever, hypotension,</strong> <strong>skin rash</strong> and presence of a <strong>retained vaginal tampon,</strong>&nbsp;point towards a likely diagnosis of&nbsp;<strong>toxic shock syndrome </strong>which mainly occurs due to<strong>&nbsp;toxic shock syndrome toxin-1 (TSST-1), </strong>produced during the<strong> stationary phase (3) </strong>of the bacterial growth curve.</p>\n<p>Many bacteria produce&nbsp;<strong>secondary metabolic products</strong>&nbsp;such as&nbsp;<strong>exotoxins</strong> and <strong>antibiotics</strong> during the <strong>stationary phase</strong> of the bacterial growth curve.</p>\n<p><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Bacterial Growth Curve</strong></p>\n<div class=\"page\" title=\"Page 1229\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1229\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 31\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>When a bacterium is seeded into a suitable liquid medium and incubated, its growth follows a definite <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">course. If bacterial counts are made at intervals after inoculation and plotted in relation to time, a growth curve is obtained. The curve shows the following phases:</span></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b22fcd9c49044c6923a2853c5a854fb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b88c347154df42a38850a750e7eb5844x1280x1172.JPEG"
    ]
  },
  {
    "text": "A statistician is working on a study about the haemoglobin status of children in an area. He plotted the frequency distribution as shown below.  Which of the following statements represents this type of distribution curve?",
    "choices": [
      {
        "id": 1,
        "text": "3,4,5"
      },
      {
        "id": 2,
        "text": "1,3,4"
      },
      {
        "id": 3,
        "text": "2,3,4"
      },
      {
        "id": 4,
        "text": "1,2,5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"ng-star-inserted\">\n<p class=\"table-responsive font-weight-light answer-scroll mb-0 ng-star-inserted\">The image given shows a&nbsp;<strong>negatively skewed</strong>&nbsp;distribution where&nbsp;<strong>mean &lt; median &lt; mode</strong>.&nbsp;</p>\n<p class=\"table-responsive font-weight-light answer-scroll mb-0 ng-star-inserted\"><strong>Skewed distributions</strong>&nbsp;are the ones that have <strong>asymmetric</strong> frequency distributions. They can be identified as positive (right) or negative (left) according to the location of the <strong>tail</strong> <strong>of the curve </strong>and<span style=\"color: #000000;\"> not by the location of the hump.</span> In the image, the tail is located on the negative side of the graph (left side) so it is a <strong>negative or left-skewed distribution</strong>.</p>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e8714cc1c41d4bb58372d3420c2d0613.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d4fba4981eb45a99611a9ad51944c37x1279x1114.JPEG"
    ]
  },
  {
    "text": "If the cutoff value of the given screening test is changed from point B to point A, what will happen to the negative and positive predictive values, respectively?",
    "choices": [
      {
        "id": 1,
        "text": "Increase, decrease"
      },
      {
        "id": 2,
        "text": "Decrease, increase"
      },
      {
        "id": 3,
        "text": "Decrease, no change"
      },
      {
        "id": 4,
        "text": "No change, decrease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>As the cutoff point shifts from point B to point A, the test's negative predictive value <strong>increases</strong> and the positive predictive value <strong>decreases.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37eda0a4ee7f4decb420d483727f00a0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd3edf675b3f4e30a140e2ff769dc087x1200x1109.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male patient presents with right-sided sensorineural hearing loss and tinnitus. On examining his ear, you notice numbness in the posterosuperior meatal wall of the external auditory canal. Which of the following speech audiometric graphs represents this condition?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "D"
      },
      {
        "id": 4,
        "text": "C"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario, symptoms of <strong>unilateral</strong> <strong>sensorineural hearing loss, tinnitus</strong> and numbness in the posterosuperior meatal wall of the external auditory canal <strong>(Hitzelberger</strong>\u00a0<strong>sign)\u00a0</strong>are highly suggestive of <strong>Acoustic Neuroma </strong>which shows the characteristic <strong>roll-over phenomenon (Graph D),</strong> in speech audiometry.</p>\n<p>In\u00a0<strong>speech audiometry</strong>,\u00a0the patient\u2019s ability to hear and understand speech is measured.\u00a0<strong>Speech reception threshold</strong>\u00a0and <strong>discrimination score</strong>/<strong>score percentage </strong>are studied under this test. The speech reception threshold is the lowest intensity of sound at which 50% of the words are repeated correctly by the patient, and the discrimination score is the <strong>percentage</strong> of test words correctly repeated by the patient and is calculated as follows:</p>\n<p>If a <strong>50</strong>-word list is used,<strong> 2%</strong> is given for each correct response, and if a <strong>25</strong>-word list is used, <strong>4%</strong> is given for each correct response.</p>\n<p><strong>The Roll-over phenomenon</strong> is seen on plotting the discrimination score against the amplitude of the sound. It is a feature of <strong>retro-cochlear/neural lesions</strong>\u00a0wherein the\u00a0<strong>speech discrimination</strong>\u00a0steadily\u00a0<strong>increases </strong>with intensity\u00a0but\u00a0<strong>suddenly drops</strong> significantly beyond a particular intensity of sound due to <strong>nerve fatigue</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95d5b007a3a84ddc9362f16f09df096c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/94528ef60add4332843f3ea11197b89fx1280x1416.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b81a62385fb4da491ea928f50073f81x800x593.JPEG",
      "https://cdn1.dailyrounds.org/uploads/a739e7ff470541d09a3375c08607fdda.JPEG"
    ]
  },
  {
    "text": "A primigravida at 34 weeks of gestation presented with sudden-onset abdominal pain and vaginal bleeding. On examination uterine tenderness is present along with frequent contractions. You advise for a cardiotocography to be done which shows the following findings. All of the following conditions are considered differentials except?",
    "choices": [
      {
        "id": 1,
        "text": "Severe Fetomaternal haemorrhage"
      },
      {
        "id": 2,
        "text": "Injudicious use of oxytocin"
      },
      {
        "id": 3,
        "text": "Postmaturity"
      },
      {
        "id": 4,
        "text": "Spinal anaesthesia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span style=\"font-size: 12pt;\">In the given clinical scenario, the symptoms of <strong>sudden-onset abdominal pain</strong> and<strong> vaginal bleeding</strong> along with the presence of <strong>uterine tenderness</strong> and <strong>frequent contractions </strong>on examination, point towards the diagnosis of <strong>pl</strong><strong>acental abruption. </strong></span><span style=\"font-size: 12pt;\">The given cardiotocograph shows <strong>decelerations</strong> that <strong>begin after</strong> the onset of the uterine contraction called <strong>l</strong><strong>ate</strong> <strong>decelerations</strong>/\u00a0<strong>Type II Dips,</strong> which is\u00a0associated with <strong>pl</strong><strong>acental abruption. </strong>It is also seen in cases of <strong>injudicious use of oxytocin</strong>, <strong>postmaturity</strong> and <strong>spinal anaesthesia.</strong><strong> Severe </strong></span><span style=\"font-size: 12pt;\"><strong>Fetomaternal haemorrhage </strong>is associated with the <strong>sinusoidal pattern\u00a0</strong>on cardiotocography.</span></p>\n<p><span style=\"font-size: 12pt;\">Baseline variability is observed in many conditions such as:</span></p>\n<p><span style=\"font-size: 12pt;\"><strong>1. Acceleration:</strong> Transient <strong>increase in fetal heart rate </strong>(FHR) by <strong>15 bpm</strong> or more, lasting for <strong>at least 15 seconds</strong>. It denotes intact neurohormonal and cardiovascular activity and, therefore, a <strong>healthy fetus</strong>.</span></p>\n<p><span style=\"font-size: 12pt;\"><strong>2. Deceleration</strong>: Transient <strong>decrease in FHR </strong>below the baseline by<strong> 15 bpm</strong> or more and <strong>lasting \u226515 seconds</strong>. Three basic types of deceleration are early, late, and variable:</span></p>\n<table style=\"border-collapse: collapse; width: 476px; height: 727.749px;\" border=\"1\" cellspacing=\"22\">\n<tbody>\n<tr style=\"height: 67.1953px;\">\n<td style=\"width: 79.3281px; height: 67.1953px;\"><span style=\"font-size: 10pt;\"><strong>Feature</strong></span></td>\n<td style=\"width: 116.945px; height: 67.1953px;\"><span style=\"font-size: 10pt;\"><strong>Early deceleration/Type I Dips</strong></span></td>\n<td style=\"width: 126.188px; height: 67.1953px;\"><span style=\"font-size: 10pt;\"><strong>Late deceleration/</strong><strong>Type II Dips</strong></span></td>\n<td style=\"width: 97.3516px; height: 67.1953px;\"><span style=\"font-size: 10pt;\"><strong>Variable deceleration</strong></span></td>\n</tr>\n<tr style=\"height: 332.781px;\">\n<td style=\"width: 79.3281px; height: 332.781px;\"><span style=\"font-size: 10pt;\">The pattern of heart rate fall</span></td>\n<td style=\"width: 116.945px; height: 332.781px;\">\n<p><span style=\"font-size: 10pt;\"><strong>Gradual decline\u00a0</strong>and gradual recovery of heart rate.</span></p>\n<p><span style=\"font-size: 10pt;\">The maximum dip of the deceleration <strong>corresponds </strong>with the peak of the contraction.\u00a0</span></p>\n</td>\n<td style=\"width: 126.188px; height: 332.781px;\">\n<p><span style=\"font-size: 10pt;\"><strong>Symmetrical </strong>and<strong> gradual decline\u00a0</strong>in heart rate.</span></p>\n<p><span style=\"font-size: 10pt;\"><strong>Begins after</strong> the onset of the uterine contraction.</span></p>\n<p><span style=\"font-size: 10pt;\">Onset, maximum dip, and recovery occur<strong> after</strong> the onset, peak, and recovery of contraction respectively.</span></p>\n</td>\n<td style=\"width: 97.3516px; height: 332.781px;\">\n<p><span style=\"font-size: 10pt;\"><strong>Abrupt fall\u00a0</strong>in the heart rate.\u00a0 \u00a0</span></p>\n<div class=\"page\" title=\"Page 596\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span style=\"font-size: 10pt;\">Decelerations are <strong>variable</strong> in respect of the size, shape, depth, duration, and timing of uterine contractions.</span></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 111.992px;\">\n<td style=\"width: 79.3281px; height: 111.992px;\"><span style=\"font-size: 10pt;\">Time taken to reach the maximum dip of deceleration</span></td>\n<td style=\"width: 116.945px; height: 111.992px;\"><span style=\"font-size: 10pt;\">\u00a0&gt;30seconds</span></td>\n<td style=\"width: 126.188px; height: 111.992px;\"><span style=\"font-size: 10pt;\">\u00a0&gt;30seconds</span></td>\n<td style=\"width: 97.3516px; height: 111.992px;\"><span style=\"font-size: 10pt;\">\u00a0&lt;30 seconds</span></td>\n</tr>\n<tr style=\"height: 215.781px;\">\n<td style=\"width: 79.3281px; height: 215.781px;\"><span style=\"font-size: 10pt;\">Causes</span></td>\n<td style=\"width: 116.945px; height: 215.781px;\"><span style=\"font-size: 10pt;\"><strong>Fetal head compression</strong></span></td>\n<td style=\"width: 126.188px; height: 215.781px;\">\n<p><span style=\"font-size: 10pt;\">i) Placental pathology (<strong>postmaturity,</strong> hypertension, diabetes, <strong>placental abruption</strong>);</span></p>\n<p><span style=\"font-size: 10pt;\">(ii) <strong>Excessive uterine</strong> <strong>contractions</strong>;</span></p>\n<p><span style=\"font-size: 10pt;\">(iii) <strong>Injudicious use of oxytocin</strong>; (iv) <strong>Regional anaesthesia</strong> (<strong>spinal</strong> or epidural)</span></p>\n</td>\n<td style=\"width: 97.3516px; height: 215.781px;\"><span style=\"font-size: 10pt;\"><strong>Umbilical cord compression</strong></span></td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b4bc7b1512e648f6b71b90601f7ade3f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4661dee096f4ccf8f8a0a70fd8fc954x1279x856.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36c6e4adc4d044f9952e9d7b8c699f7fx600x630.JPEG"
    ]
  },
  {
    "text": "A 24-year-old man with type 1 diabetes mellitus presents with vomiting, abdominal pain, and a respiratory rate of 36 breaths/min. His breath has a fruity odor and his urine Rothera test is positive. The results of his ABG analysis will fall under which of the following areas given in the graph below?",
    "choices": [
      {
        "id": 1,
        "text": "B and F"
      },
      {
        "id": 2,
        "text": "F and D"
      },
      {
        "id": 3,
        "text": "B and C"
      },
      {
        "id": 4,
        "text": "C and D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span style=\"font-family: arial, helvetica, sans-serif; font-size: 12pt;\">The presence of <strong>fruity-smelling</strong> breath and a <strong>positive Rothera test</strong> in a type 1 diabetic patient, points to the diagnosis of <strong>Diabetic Ketoacidosis(DKA). </strong>In the given <strong>acid-base nomogram</strong>,&nbsp;the area marked <strong>F</strong> corresponds to <strong>acidic pH </strong>with <strong>decreased&nbsp;HCO<sub>3</sub><sup>-</sup> </strong>levels, suggesting <strong>metabolic acidosis</strong> which is the acid-base disorder associated with Diabetic ketoacidosis. Elevated respiratory rate indicates the <strong>hyperventilatory</strong> response leading to <strong>compensatory</strong> <strong>respiratory alkalosis</strong> (area marked <strong>D</strong>).&nbsp;</span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif; font-size: 12pt;\">An acid-base nomogram, also known as a <strong>Davenport diagram, </strong>is a graphical representation of acid-base balance to interpret arterial blood gas (ABG) results. It helps determine the primary acid-base disorder and identify compensatory mechanisms. It is plotted as arterial HCO<sub>3</sub><sup>-</sup> against arterial blood pH.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c78c4781bf2f483ab5ddcda2d169dadb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57ff06a34f154db39cd8ca4b607c32ffx1280x1452.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/01fd496be3d648ad90620f6ae75921d4x1280x2847.JPEG"
    ]
  },
  {
    "text": "In the given nerve action potential curve, which point represents the beginning of the slow return of K+ channels to the closed state?",
    "choices": [
      {
        "id": 1,
        "text": "Point C"
      },
      {
        "id": 2,
        "text": "Point A"
      },
      {
        "id": 3,
        "text": "Point B"
      },
      {
        "id": 4,
        "text": "Point E"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Point E</strong> in the given nerve action potential curve represents the beginning of the slow return of the <strong>K+ channels</strong> to the <strong>closed state</strong> also called <strong>after-hyperpolarization.</strong></p>\n<p><strong>The sequence of events occurring during an action potential is shown below\u00a0</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Point A represents the resting state where <strong>both</strong> channels are <strong>closed</strong>.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Na+ channels open in response to depolarizing stimulus and sodium enters the cell. The initiation of action potential occurs only after a certain potential is reached, called the <strong>threshold potential</strong> represented by point B.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">After this, the sodium influx causes the <strong>opening</strong> of more <strong>Na<sup>+</sup></strong> channels through a <strong>positive</strong> feedback mechanism. Rapid depolarization occurs to reach point C.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">At point C, Na<sup>+</sup> channels close and K<sup>+</sup> channels open, causing repolarization due to K<sup>+</sup> efflux.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Point D represents continued repolarization due to potassium efflux.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"color: #000000;\"><strong>From point E, </strong>t</span>he K<sup>+</sup> channels\u00a0<strong>slowly</strong> return to the <strong>closed</strong> state, causing <strong>after-hyperpolarization. </strong>Na<sup>+</sup> channels are reset and are ready to respond to another depolarizing stimulus.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">As both channels close, the membrane returns to resting membrane potential back to point A.</li>\n</ul>\n<p>Point <strong>B-D </strong>is a part of the <strong>refractory period. </strong>During this period, the application of even a stronger stimulus will not elicit an action potential.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bc3937e3a1034590b6e05a9d0c690ac0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b142a264fb7f4271af9a4127a31a35b8x1280x1683.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman presents with a 3-week history of dry cough, dyspnea and chest x-ray showing the characteristic garland triad. Her pulmonary function test will most likely resemble which of the following curves?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><span style=\"color: #000000; font-family: arial, helvetica, sans-serif;\">In the above clinical scenario, the patient's symptoms of <strong>dry cough</strong> and <strong>dyspnea</strong> along with the chest x-ray showing the <strong>garland triad </strong>are characteristic of <strong>Sarcoidosis </strong>which shows a <strong><span style=\"font-family: arial, helvetica, sans-serif;\">restrictive pattern </span></strong><span style=\"font-family: arial, helvetica, sans-serif;\">on the flow-volume curve, </span>represented by <strong>curve 4. \u00a0\u00a0</strong></span></p>\n<div class=\"page\" title=\"Page 2178\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span style=\"font-family: arial, helvetica, sans-serif;\"><span style=\"color: #000000;\"><strong>Sarcoidosis </strong></span>presents with\u00a0<strong>ventilatory restriction </strong>due to<strong> increased elastic recoil.</strong> It is characterized by a\u00a0<strong>decrease </strong>in total lung capacity and vital capacity, hence, the loop shrinks or narrows and shifts <strong>toward the right</strong> as seen in curve 4 in comparison to curve<strong>\u00a01</strong>\u00a0which represents the\u00a0<strong>normal</strong>\u00a0<strong>flow-volume curve.</strong></span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">Increased flow occurs as the increased lung recoil drives greater maximal flow at any lung volume and also because airway diameters are relatively increased due to greater radially outward traction exerted on bronchi by the stiff lung parenchyma.\u00a0\u00a0</span></p>\n</div>\n</div>\n</div>\n</div>\n<p><span style=\"color: #000000; font-family: arial, helvetica, sans-serif;\">In restrictive diseases, both\u00a0<strong>FEV1</strong>\u00a0(Forced expiratory volume in the first second) and\u00a0<strong>FVC</strong>\u00a0(forced vital capacity) are\u00a0<strong>reduced</strong>\u00a0but FEV1/FVC ratio is <strong>normal</strong> or <strong>increased</strong> as FVC is reduced to a greater degree due to <strong>decreased</strong> compliance.</span></p>\n<p><span style=\"color: #000000; font-family: arial, helvetica, sans-serif;\">An\u00a0<strong>FEV1/FVC ratio &gt; 0.7</strong>\u00a0signifies\u00a0<strong>restrictive</strong>\u00a0lung disorder, whereas\u00a0<strong>&lt;0.7</strong>\u00a0is seen in\u00a0<strong>obstructive</strong>\u00a0diseases.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b72befd1ef744ffd8af13975c7874641.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/572db3805ebd4ba9b920c60a83856d51x1280x1455.JPEG",
      "https://cdn1.dailyrounds.org/uploads/7c08f3e499554daa82a94abbaa834206.JPEG"
    ]
  },
  {
    "text": "In a study of a group of 40 people, a physiologist is studying the pacemaker actions of the sinoatrial node and the action potentials of each one of them were plotted in the graph given below. The ion channels predominantly responsible for the phase 0 marked in the graph is?",
    "choices": [
      {
        "id": 1,
        "text": "h-type sodium channels"
      },
      {
        "id": 2,
        "text": "L-type calcium channels"
      },
      {
        "id": 3,
        "text": "T-type calcium channels"
      },
      {
        "id": 4,
        "text": "Potassium channels"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ion channels predominantly responsible for <strong>phase 0</strong> marked in the graph is the <strong>L-type calcium channels.&nbsp;</strong></p>\n<p>The graph in the given image represents the action potential of the SA (sinoatrial) node (i.e.,<strong> the pacemaker potential</strong>).<strong>&nbsp;</strong>In the figure,<strong> phase 0</strong> corresponds to the <strong>impulse/upstroke</strong> and, this is predominantly due to the opening of<strong> 'L' (long-acting) </strong>type of <strong>calcium channels</strong> resulting in an intracellular movement of the calcium ions down its electrochemical gradient.</p>\n<p>The resting membrane potential (RMP) of the <strong>SA node</strong> is <strong>-55 to-60 millivolts.&nbsp;</strong>Phases of this potential are:&nbsp;</p>\n<ul>\n<li aria-level=\"1\"><strong>Phase 0&nbsp;</strong>- <strong>Upstroke wave.&nbsp;</strong>It is due to the <strong>influx of Ca2+</strong> ions by the opening of <strong>voltage-gated L-type channels.</strong></li>\n</ul>\n<ul>\n<li aria-level=\"1\"><strong>Phase 3&nbsp;</strong>- <strong>Downstroke wave. </strong>It is due to the <strong>efflux of K+</strong> leading to <strong>repolarization</strong>.</li>\n</ul>\n<ul>\n<li aria-level=\"1\"><strong>Phase 4</strong>- <strong>Prepotential</strong>. Because of ongoing <strong>K+ efflux</strong>, hyperpolarization sets in. This makes the channel more permeable to Na+ ions and since these Na+ channels are activated during hyperpolarization they are referred to as <strong>funny currents (Ih/ If)</strong>. They form the first half of the pre-potential. The <strong>second</strong> <strong>half</strong> of the prepotential is <strong>completed</strong> by the <strong>opening</strong> of the <strong>voltage-gated T-(transient) type Ca2+ channel</strong>.&nbsp;The slope of Phase 4 in the SA node determines the heart rate.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fc8abd22c42445599258f189d197a3f7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/72463b08cb6a44848f032162d449409bx800x600.GIF"
    ]
  },
  {
    "text": "ECG findings of a patient with first degree heart block is given below. Which of the following conditions will result in the same change in the PR interval as shown below?",
    "choices": [
      {
        "id": 1,
        "text": "1,5"
      },
      {
        "id": 2,
        "text": "3,5"
      },
      {
        "id": 3,
        "text": "2,4"
      },
      {
        "id": 4,
        "text": "2,3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 1937\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">In <strong>first-degree</strong> AV block, a <strong>prolonged</strong> PR interval (of over 200 ms) is seen which indicates a slowing of conduction between the atria and ventricles, usually due to slow conduction through the atrioventricular node (AV node). <strong>Wenckebach block</strong> and <strong>hyperkalemia</strong> also show a prolongation in the PR interval.</span></p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3110d4e728384fde94580c35e4516ffb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb2b1bf5fccd42d69c29723f44fe0ad7x436x132.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ce5ef2267310469eafeb7e4c8f6ea784x608x600.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eeba5011417b4da7a5c8584dc8401b57x436x135.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe5f3695d29449e391e74d1f2dd270b5x442x133.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b5bec5ce0dc4d5991bf7d1c409b3f5ex1279x1256.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f80236ecaa074054a1cc3f53f86bbfcfx248x188.JPEG"
    ]
  }
];
        let quizName = 'Graphs Mini Test - -Tmt';
        const quizFilename = 'graphs-mini-test-tmt-84bad01d.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>