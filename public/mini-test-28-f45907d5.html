<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 28 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the embryological origin of the structure marked in the X-ray?",
    "choices": [
      {
        "id": 1,
        "text": "Somatopleuric mesoderm"
      },
      {
        "id": 2,
        "text": "Paraxial mesoderm"
      },
      {
        "id": 3,
        "text": "Intermediate mesoderm"
      },
      {
        "id": 4,
        "text": "Splanchnopleuric mesoderm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked in the given X-ray image is the <strong>renal pelvis</strong>. It is embryologically derived from <strong>intermediate mesoderm.</strong></p>\n<p>The urinary and reproductive organs are developed from the intermediate mesoderm.&nbsp;</p>\n<p>After the notochord is formed, the intraembryonic mesoderm on either side can be seen organized into 3 layers:</p>\n<ul>\n<li class=\"p1\"><strong>Paraxial mesoderm</strong>: A thickened plate of the mesoderm close to the midline, on either side of the notochord. This forms the&nbsp;<strong>somitomeres</strong> and <strong>somites</strong>.</li>\n<li class=\"p1\"><strong>Intermediate mesoderm</strong>: Longitudinal strip of mesoderm that connects paraxial with the lateral plate mesoderm. The <strong>urinary </strong>and<strong> genital systems</strong> are derived from the intermediate mesoderm.</li>\n<li class=\"p1\"><strong>Lateral plate mesoderm:</strong>&nbsp;A thinner layer of mesoderm that lies laterally. This layer develops a large cavity called the intraembryonic coelom that gives rise to <strong>pericardial</strong>, <strong>pleural</strong>, and <strong>peritoneal cavities</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/634121cf291e4776915cffeb946a6648.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the gastrointestinal hormones in column A to the cells producing them in column B.",
    "choices": [
      {
        "id": 1,
        "text": "1-e, 2-d, 3-c, 4-a"
      },
      {
        "id": 2,
        "text": "1-c, 2-d, 3- a, 4- b"
      },
      {
        "id": 3,
        "text": "1-d, 2-e, 3-a, 4-b"
      },
      {
        "id": 4,
        "text": "1-c, 2-e, 3-a, 4-d"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct match is&nbsp;<strong>1-d, 2-e, 3-a, 4-b.</strong></p>\n<p>Gastrointestinal hormones- site of secretion and their actions</p>\n<table style=\"width: 640.375px;\">\n<tbody>\n<tr>\n<td style=\"width: 140px;\"><strong>Hormones</strong></td>\n<td style=\"width: 193px;\"><strong>Site of secretion</strong></td>\n<td style=\"width: 282.375px;\"><strong>Action</strong></td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Gastrin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">G cells of the antrum, duodenum, and jejunum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates gastric acid secretion and mucosal growth</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Cholecystokinin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">I cells of the duodenum, jejunum, and ileum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p>Stimulates</p>\n<ul>\n<li>Pancreatic enzyme secretion</li>\n<li class=\"p1\">Pancreatic bicarbonate secretion</li>\n<li class=\"p1\">Gallbladder contraction</li>\n<li class=\"p1\">Growth of exocrine pancreas</li>\n</ul>\n<p class=\"p1\">Inhibits gastric emptying</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Secretin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">S cells of the duodenum, jejunum, and ileum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates</p>\n<ul>\n<li class=\"p1\">Pepsin secretion</li>\n<li class=\"p1\">Pancreatic bicarbonate secretion</li>\n<li class=\"p1\">Biliary bicarbonate secretion</li>\n<li class=\"p1\">Growth of exocrine pancreas</li>\n</ul>\n<p class=\"p1\">Inhibits gastrin release and gastric acid secretion</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Glucose-dependent insulinotropic peptide (also called&nbsp;<strong>gastric inhibitory peptide- GIP</strong>)</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">K cells of the duodenum and jejunum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates insulin release</p>\n<p class=\"p1\">Inhibits gastric acid secretion</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Motilin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">M cells of the duodenum and jejunum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates</p>\n<ul>\n<li class=\"p1\">Gastric motility</li>\n<li class=\"p1\">Intestinal motility</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">Somatostatin</td>\n<td style=\"width: 193px;\">D cells of pancreas</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Inhibits the secretion of various gastrointestinal hormones, gastrointestinal motility, and absorption of glucose, amino acids, and triglycerides.</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following enzymes is deficient in metachromatic leucodystrophy?",
    "choices": [
      {
        "id": 1,
        "text": "\u03b2-Galactosidase"
      },
      {
        "id": 2,
        "text": "Arylsulfatase"
      },
      {
        "id": 3,
        "text": "Sphingomyelinase"
      },
      {
        "id": 4,
        "text": "Ceramidase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Metachromatic leucodystrophy</strong> occurs due to the <strong>deficiency</strong> of<strong> arylsulfatase A enzyme</strong>.</p>\n<p>Metachromatic leucodystrophy is an autosomal recessive disorder. Deficiency of arylsulfatase A enzyme leads to accumulation of <strong>sulfated glycosphingolipids</strong> in white matter with subsequent <strong>demyelination</strong>. Affected infants (infantile form) present with c<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">ognitive deterioration, <strong>m</strong></span><strong>uscle weakness</strong>, <strong>hypotonia</strong>, <strong>nystagmus</strong>, myoclonic seizures, optic atrophy and progressive paralysis.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man sustained a closed, diaphyseal tibial fracture of the left leg in a road traffic accident. As he had no distal neurovascular deficits or any open wound, he was managed conservatively with a cast for 6 weeks. After this period, he noticed a significant reduction in the girth of his left calf compared to the right. What is the type of atrophy likely to be responsible for this?",
    "choices": [
      {
        "id": 1,
        "text": "Denervation atrophy"
      },
      {
        "id": 2,
        "text": "Physiologic atrophy"
      },
      {
        "id": 3,
        "text": "Ischemic atrophy"
      },
      {
        "id": 4,
        "text": "Disuse atrophy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Disuse atrophy</strong>&nbsp;due to decreased workload is seen in this scenario. Disuse atrophy occurs in a limb that has been immobilized following a fracture.</p>\n<p><strong>Physiologic atrophy</strong>:</p>\n<ul>\n<li><strong>Loss of hormonal stimulation: </strong>Atrophy of the uterus after parturition; atrophy of the endometrium, vaginal epithelium, and breast after menopause.</li>\n<li><strong>During embryonic development:</strong> Certain structures, like the notochord and thyroglossal duct, undergo atrophy during fetal development.</li>\n</ul>\n<p><strong>Pathologic atrophy:</strong></p>\n<ul>\n<li><strong>Disuse Atrophy</strong>&nbsp;(decreased workload): e.g., atrophy in a limb that has been immobilized following a fracture</li>\n<li><strong>Denervation atrophy</strong>&nbsp;(loss of nerve supply): e.g., skeletal muscle atrophy following nerve injury</li>\n<li><strong>Ischemic atrophy:</strong> e.g.,<strong>&nbsp;</strong>senile atrophy of the brain and heart due to atherosclerosis</li>\n<li><strong>Inadequate nutrition: </strong>e.g., severe muscle wasting in marasmus</li>\n<li><strong>Pressure atrophy:</strong> e.g., atrophy of surrounding uninvolved tissues caused by an enlarging benign tumor&nbsp;</li>\n</ul>\n<p><strong>Mechanisms of atrophy:</strong></p>\n<ul>\n<li>Decreased protein synthesis&nbsp;because of&nbsp;decreased metabolic activity</li>\n<li>Increased destruction of proteins by the ubiquitin-proteasome pathway</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about the properties of MHC proteins?",
    "choices": [
      {
        "id": 1,
        "text": "MHC Class III- Presents extracellular antigens"
      },
      {
        "id": 2,
        "text": "MHC Class II - Presents intracellular antigens"
      },
      {
        "id": 3,
        "text": "MHC Class II - Expressed on antigen presenting cells"
      },
      {
        "id": 4,
        "text": "MHC Class I - Does not present antigens"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>MHC proteins:</p>\n<ul>\n<li>MHC Class I- Presents intracellular antigens, expressed by all the nucleated cells</li>\n<li>MHC Class II- Presents extracellular antigens, expressed by antigen presenting cells</li>\n<li>MHC Class III- include some complement components and TNF-alpha and Lymphotoxin-alpha, do not function in antigen presentation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old pregnant woman presented with features suggestive of thyrotoxicosis. Which of the following is not a treatment option for her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Methimazole"
      },
      {
        "id": 2,
        "text": "Propylthiouracil"
      },
      {
        "id": 3,
        "text": "Radioactive iodine"
      },
      {
        "id": 4,
        "text": "Subtotal thyroidectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Radioactive iodine therapy</strong> is<strong> contraindicated</strong> during pregnancy and lactation. Therefore, it is not a treatment option in this patient.</p>\n<p>Thyrotoxicosis in pregnancy:</p>\n<p>The <strong>drug of choice</strong> for the treatment of thyrotoxicosis during the<strong> first trimester </strong>of pregnancy is <strong>propylthiouracil (PTU).</strong></p>\n<p>Methimazole and its prodrug (carbimazole) are usually avoided in the first trimester due to <strong>teratogenic risk.</strong>&nbsp;However, methimazole is used for the remainder of the pregnancy due to the concern for <strong>PTU-associated liver failure.</strong>&nbsp;</p>\n<p><strong>Subtotal thyroidectomy</strong> can be performed during the <strong>mid-trimester.</strong></p>\n<p><strong>Radioactive iodine </strong>crosses the placenta and causes the destruction of the fetal thyroid. Therefore, it&nbsp;is<strong> contraindicated</strong> during pregnancy and lactation.</p>\n<p>Treatment of thyrotoxicosis in pregnancy</p>\n<table style=\"height: 108px; width: 381px;\">\n<tbody>\n<tr style=\"height: 46px;\">\n<td style=\"width: 137.828125px; height: 46px; text-align: center;\"><strong>Trimester</strong></td>\n<td style=\"width: 227.1875px; height: 46px; text-align: center;\"><strong>Treatment for thyrotoxicosis</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 137.828125px; height: 46px;\"><strong>First trimester</strong></td>\n<td style=\"width: 227.1875px; height: 46px;\">\n<ul>\n<li>Propylthiouracil</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 137.828125px; height: 64px;\"><strong>Second trimester</strong></td>\n<td style=\"width: 227.1875px; height: 64px;\">\n<ul>\n<li>Methimazole</li>\n<li>Subtotal thyroidectomy</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 137.828125px;\"><strong>Third trimester</strong></td>\n<td style=\"width: 227.1875px;\">\n<ul>\n<li>Methimazole</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old patient is diagnosed to have bilateral sensorineural hearing loss. He struggles to hear and understand speech despite appropriately fit hearing aids. The ENT specialist decided that a cochlear implant would be the best treatment for this patient. What is the site in which the electrode is placed?",
    "choices": [
      {
        "id": 1,
        "text": "Round window"
      },
      {
        "id": 2,
        "text": "Oval window"
      },
      {
        "id": 3,
        "text": "Scala vestibuli"
      },
      {
        "id": 4,
        "text": "Scala tympani"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The electrode of a cochlear implant is placed in the <strong>s</strong><strong>cala tympani.</strong></p>\n<p>A cochlear implant is an electronic device that\u00a0<strong>replaces </strong>the <strong>organ of Corti</strong> i.e. when hair cells of the organ of Corti are severely damaged these implants bypass it and directly<strong> stimulate</strong> the <strong>auditory nerve</strong>. In cochlear implant surgery, the\u00a0<strong>electrode array</strong>\u00a0is placed within the <strong>s</strong><strong>cala</strong>\u00a0<strong>t</strong><strong>ympani</strong> of the cochlea. Thus, an<strong> intact vestibulocochlear (CN VIII)\u00a0nerve</strong> and the higher auditory pathway a prerequisites for cochlear implant surgery.</p>\n<p>It is indicated in\u00a0severe to profound<strong> sensorineural hearing loss\u00a0</strong>and in those who cannot benefit from hearing aids.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/51bb14a7b2b64e1b98d13107998e2b93x1280x1808.JPEG"
    ]
  },
  {
    "text": "A patient presents with complaints of glare and discomfort of the eyes. Findings seen on slit-lamp examination are given below. He suffers from lupus erythematosus, for which he is being treated with chloroquine. Which of the following findings would you expect to see on a fundoscopy?",
    "choices": [
      {
        "id": 1,
        "text": "Hypotonic maculopathy"
      },
      {
        "id": 2,
        "text": "Bull\u2019s eye maculopathy"
      },
      {
        "id": 3,
        "text": "Cystoid maculopathy"
      },
      {
        "id": 4,
        "text": "No maculopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the slit lamp findings of <strong>cornea verticillata</strong> point to toxicity caused due to<strong>\u00a0chloroquine</strong>. The fundoscopy in this patient is most likely to reveal<strong> bull\u2019s eye maculopathy.<br /></strong></p>\n<p>Prolonged administration of chloroquine leads to bull\u2019s eye maculopathy. <strong>\u00a0</strong></p>\n<p>The image below shows bull\u2019s eye maculopathy:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3bb6216e7877472ba9cd24b359de542f.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c807f3e7e4f047a399362602e62bac94x589x216.PNG"
    ]
  },
  {
    "text": "A study to determine the association between maternal smoking during pregnancy and low birth weight is being carried out. It involves obtaining smoking histories from pregnant women during their antenatal visits and then subsequently assessing the birth weight of their babies soon after delivery. What type of study is this?",
    "choices": [
      {
        "id": 1,
        "text": "Prospective cohort"
      },
      {
        "id": 2,
        "text": "Retrospective cohort"
      },
      {
        "id": 3,
        "text": "Case control"
      },
      {
        "id": 4,
        "text": "Cross sectional"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">The study of choice is </span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>a prospective cohort study.\u00a0</strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">This study is a prospective cohort study because the subjects (pregnant women) were categorized on the basis of exposure or lack of exposure to a risk factor -smoking during pregnancy. They were followed to determine if the outcome, the low birth weight of the babies occurred or not.</span></div>\n<div>\u00a0</div>\n<div><strong>A prospective cohort study</strong> is a study in which the <strong>outcome has not yet occurred</strong> at the time that the investigations begin. They <strong>begin</strong> in the <strong>present</strong> and <strong>continue</strong> into the <strong>future</strong>. The design of a prospective cohort is shown below.</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f391022577a432882f37243dae2c1d4x720x743.JPEG"
    ]
  },
  {
    "text": "A 28-year-old male patient presents to the OPD with complaints of swelling in front of the neck as shown in the image. On examination, it is a well-defined smooth midline swelling that moves with deglutition and protrusion of the tongue. The swelling was surgically removed and histopathological examination of the specimen showed the presence of malignant cells. Which of the following is the most common variant of carcinoma likely to be seen in such cases?",
    "choices": [
      {
        "id": 1,
        "text": "Follicular carcinoma"
      },
      {
        "id": 2,
        "text": "Papillary carcinoma"
      },
      {
        "id": 3,
        "text": "Medullary carcinoma"
      },
      {
        "id": 4,
        "text": "Anaplastic carcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario and the image given are suggestive of the&nbsp;<strong>thyroglossal cyst</strong>&nbsp;and<strong>&nbsp;papillary carcinoma</strong> is&nbsp;the most common type of cancer (seen in 85% cases) found in thyroglossal cysts.</p>\n<p>The thyroid gland descends early in fetal life from the base of the tongue towards its position in the lower neck. At the time of descent, the hyoid bone has not been formed and the track of the thyroid gland is variable, passing in front, through, or behind the eventual position of the hyoid body.&nbsp;<strong>Thyroglossal cyst </strong>represents the <strong>persistence</strong> of the track of the<strong> thyroid gland </strong>and can be found adjacent to the<strong> midline.</strong></p>\n<p>Classically the cyst moves upwards on swallowing and on tongue protrusion, and it indicates attachment to the hyoid bone. Although they often occur in children they may also present in adults, even as late as the 6th or 7th decade.</p>\n<p>Complications:</p>\n<ul>\n<li>The most common complication is infection.</li>\n<li>1% of thyroglossal duct cysts are found to be malignant of which the most common type of cancer is&nbsp;<strong>papillary</strong>&nbsp;(85%). Medullary thyroid carcinomas are not found in thyroglossal duct cysts</li>\n</ul>\n<p>Treatment:</p>\n<p><strong>Sistrunk&rsquo;s operation</strong></p>\n<p>Excision of the cyst along and the whole thyroglossal tract up to the foramen caecum along with the removal of the body of the hyoid bone. This is essential to avoid recurrence of the sinuses.</p>\n<p><strong>Note:</strong></p>\n<p>Sistrunk operation with total thyroidectomy is indicated only if a papillary carcinoma is found to arise from the cyst in the setting of :&nbsp;</p>\n<ul>\n<li>Lymph node metastasis</li>\n<li>Thyroid nodularity</li>\n<li>Cyst wall invasion</li>\n<li>Large tumors</li>\n</ul>\n<p>The image below shows the Sistrunk procedure-</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1ad18bb622034c48b189d08eeb8b3da2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5229737a9d6346e89b01cab62aac1f2cx512x358.PNG"
    ]
  },
  {
    "text": "A lady with 2 weeks of amenorrhea and a positive urine pregnancy test came for medical termination of the pregnancy. Menstrual aspiration is being performed. Which is the instrument used for this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\"><span class=\"s1\"><strong>Karman&rsquo;s cannula (image 3)&nbsp;</strong>is used for menstrual aspiration.</span></p>\n<p class=\"p1\"><span class=\"s1\"><strong>Menstrual regulation or aspiration</strong> is the aspiration of the endometrial cavity 1-3 weeks after a missed period in a woman with a previous normal cycle and a positive urine pregnancy test. It is performed using Karman's cannula.</span></p>\n<p class=\"p1\"><span class=\"s1\">Procedure - </span></p>\n<ul class=\"ul1\">\n<li class=\"li1\"><span class=\"s1\">Under aseptic precautions, the cervix may be gently dilated using 4-5 mm size dilators.</span></li>\n<li class=\"li1\"><span class=\"s1\">Then 5-6mm Karman&rsquo;s cannula is inserted and attached to a 50ml syringe for suction.</span></li>\n<li class=\"li1\"><span class=\"s1\">The cannula is rotated, pushed in and out with gentle strokes.</span></li>\n</ul>\n<p><span class=\"s1\">This procedure is contraindicated in advanced pregnancy and in the presence of local pelvic inflammation.</span></p>\n<p class=\"p1\"><span class=\"s1\">The drawback of the procedure - an implanted zygote can be missed, an ectopic pregnancy can be unrecognized.</span></p>\n<p class=\"p1\"><span class=\"s1\">Other options:</span></p>\n<ul>\n<li class=\"p1\"><span class=\"s1\">Instrument <strong>1</strong> is <strong>Rubins cannula</strong>. It is used for hysterosalpingography.</span></li>\n<li class=\"p1\"><span class=\"s1\">Instrument <strong>2</strong> is <strong>Leech Wilkinson's cannula</strong>. It can be identified by the spiral cone at the tip and is used for hysterosalpingography.</span></li>\n<li class=\"p1\"><span class=\"s1\">Instrument <strong>4</strong> is <strong>Simpson's uterine sound</strong>. It can be identified by the markings used for measurement and&nbsp;is used to measure the length of the uterus.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/46f014ab24b748d7bacead11c60f5a47.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old woman presents with acute onset abdominal pain, nausea, and vomiting. She has a low-grade fever, with a pulse rate of 90 bpm and blood pressure of 126/84 mm Hg. She has regular menstrual cycles of 28 days. Pelvic examination shows a tender right adnexal mass.  Ultrasound scan reveals a swollen oedematous ovary, globular in shape with disruption in adnexal flow seen on doppler. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Rupture of Graafian follicle"
      },
      {
        "id": 2,
        "text": "Tubo-ovarian abcsess"
      },
      {
        "id": 3,
        "text": "Ectopic pregnancy"
      },
      {
        "id": 4,
        "text": "Ovarian torsion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario is suggestive of <strong>ovarian torsion.</strong></p>\n<p>Torsion of the ovaries is a <strong>gynecological emergency</strong> and is most commonly seen in women of the reproductive age group. Ovarian cysts including mucous cystadenomas and dermoid cysts have the highest risks of undergoing torsion. Adnexal masses measuring &gt;6 cm in diameter have the highest rates of torsion.</p>\n<p>A patient with torsion presents with <strong>sharp lower abdominal pain</strong>, usually localized to the involved side with radiation to the flank, groin, or thigh. <strong>Nausea and vomiting</strong> are commonly associated. Adnexal necrosis may cause a <strong>low-grade fever</strong>.\u00a0</p>\n<p>During torsion, the low-pressure veins are initially compressed by the twisting pedicle. This leads to continuous inflow with decreased outflow causing <strong>stromal edema and congestion</strong>. The increasing stromal swelling later compresses the arteries causing ischemia and necrosis.</p>\n<p>On USG, the ovary appears enlarged, globular, and has a heterogenous appearance compared to the contralateral ovary due to edema, engorgement, and hemorrhage. Twisting of the vascular pedicle may give rise to a '<strong>whirlpool sign</strong>', a round hyperechoic structure with concentric hypoechoic stripes. <strong>Colour Doppler</strong> sonography should be performed in suspected torsion as it may show <strong>disruption to blood flow,</strong> which is highly suggestive of torsion. However, some cases of incomplete torsion or chronic torsion, may not show decreased flow on Doppler. MRI or CT imaging can be used in patients with normal Doppler but with characteristic signs and symptoms of torsion, to confirm or rule out the diagnosis.</p>\n<p>Management involves <strong>urgent laparotomy or laparoscopic evaluation.</strong> Salvage of the involved adnexa with the removal of any associated cyst/tumor and possible oophoropexy are the goals. However, necrosis of the adnexa necessitates the removal of the adnexal structures.</p>\n<p>Other options:</p>\n<p>Option A:\u00a0In a woman of reproductive age group, ovulatory pain following the rupture of Graafian follicle (ovulation) may present similarly with lower abdominal pain, nausea, and vomiting. This patient has a regular 28-day cycle and should have ovulated around the 14<sup>th</sup> day.\u00a0</p>\n<p>Option B: Tubo-ovarian abscess presents with a more indolent course, and may be associated with fever. The characteristic appearance on USG is of a complex, multilocular mass.\u00a0</p>\n<p>Option C: Ectopic pregnancy presents with nausea, vomiting, and adnexal pain, with or without a mass. However, this patient has a negative UPT, and serum\u00a0\u03b2-HCG level is in the non-pregnant range (&lt; 2 mIU/L) excluding ectopic pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old male patient presents to the outpatient clinic with complaints of severe joint pain on his big toe with multiple such episodes in the past. The X-ray shows the 'G' sign. Which of the following signs is also expected to be seen on ultrasound in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Linguine sign"
      },
      {
        "id": 2,
        "text": "Double contour sign"
      },
      {
        "id": 3,
        "text": "Accordion sign"
      },
      {
        "id": 4,
        "text": "Water lily sign"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The X-ray of this patient shows&nbsp;<strong>Martel's sign</strong>/&nbsp;<strong>G-sign</strong>&nbsp;which&nbsp;refers to<strong>&nbsp;</strong>the punched-out lytic lesion and overhanging margin of the new bone. It is seen in <strong>chronic gout</strong>. Among the given options, the radiological sign that is seen in chronic gout is the&nbsp;<strong>double contour sign.&nbsp;</strong></p>\n<p><strong>Double contour sign</strong>&nbsp;is an ultrasound finding that&nbsp;is characterized by an echogenic line on the outer surface of the joint cartilage due to the deposition of monosodium urate crystals on the surface of articular cartilage.</p>\n<p>Gout is a metabolic disease that is characterized by the deposition of&nbsp;<strong>monosodium urate&nbsp;crystals</strong>&nbsp;in joints and connective tissue. It is more common in males and it usually presents as monoarthritis that may be acute and episodic or chronic.&nbsp;</p>\n<ul>\n<li>Acute gout presents with a joint that is red, hot, swollen, and extremely tender on examination.&nbsp;The metatarsophalangeal joint of the great toe is the most frequently involved joint.</li>\n</ul>\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Chronic gout may present with chronic nonsymmetric synovitis, gouty arthritis, and periarticular tophaceous deposits.</p>\n<p>Synovial fluid analysis of joint aspirate is diagnostic and shows the following features-</p>\n</div>\n</div>\n</div>\n<ul>\n<li>Increased leukocyte count with a neutrophilic predominance</li>\n<li>Negatively birefringent crystals on polarized light microscopy of the synovial fluid.</li>\n</ul>\n<p>Other options-</p>\n<p>Option A:&nbsp;<strong>Linguine sign</strong> is seen in intracapsular rupture of <strong>silicone breast implant</strong>.</p>\n<p>Option C:&nbsp;The <strong>Accordion sign</strong> is seen in <strong>pseudomembranous colitis</strong>.</p>\n<p>Option D: <strong>Water lily sign</strong> is seen in<strong> hydatid cyst</strong>.</p>\n<p>&nbsp;</p>\n<p>Ultrasound double contour sign:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3de43f49bd4e40759a5b0e13035c443cx600x530.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98836b886fc34a328eb80455f715ae6cx889x657.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c50ef63667fa4172883ba7848612003dx720x1251.PNG"
    ]
  },
  {
    "text": "Following general anaesthesia for a procedure, a 45-year-old lady experienced prolonged somnolescence. On administration of physostigmine, she showed rapid improvement of her mental status. Which of the following drugs is not likely to cause this syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Glycopyrrolate"
      },
      {
        "id": 2,
        "text": "Atropine"
      },
      {
        "id": 3,
        "text": "Antihistaminics"
      },
      {
        "id": 4,
        "text": "Tricyclic antidepressants"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette is suggestive of the central anticholinergic syndrome, which is not caused by glycopyrrolate.\u00a0</p>\n<p><strong>Glycopyrrolate</strong>\u00a0usually does not produce central anticholinergic syndrome because is a<strong> quaternary amine compound, lipid insoluble, and\u00a0</strong><strong>does not cross the blood-brain barrier</strong>. Glycopyrrolate blocks the peripheral muscarinic side effects (caused by increased acetylcholine levels by neostigmine) without causing unwanted central anticholinergic effects.</p>\n<p>Drugs that can cause anticholinergic syndrome include:</p>\n<ul>\n<li>Atropine</li>\n<li>Scopolamine</li>\n<li>First-generation antihistamines\u00a0</li>\n<li>Tricyclic antidepressants\u00a0</li>\n<li>Phenothiazines</li>\n</ul>\n<p><span class=\"ej-keyword\" data-value=\"Anticholinergic syndrome\">The anticholinergic syndrome</span>\u00a0can present with central manifestations ranging from delirium and agitation to CNS depression, stupor and coma. It is a rare reaction due to either overdose or any unusual reaction to the usage of the drugs mentioned above.\u00a0Physostigmine is useful in reversing the central anticholinergic syndrome produced by overdosage or an unusual reaction to these drugs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old male patient is brought to the psychiatry OPD by his wife. He is convinced that the lead actress of a film he watched recently is deeply in love with him and wants to marry him. She also says that he is socially withdrawn and doesn't have many friends. Upon conducting a mental status examination, there are no other significant findings. What is the most likely diagnosis of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "De Cl\u00e9rambault syndrome"
      },
      {
        "id": 2,
        "text": "Capgras syndrome"
      },
      {
        "id": 3,
        "text": "Delusion of\u00a0reference"
      },
      {
        "id": 4,
        "text": "Othello syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario, the man has a false belief that his chairman wants to marry him, which is a <strong>delusion </strong>of<strong>\u00a0love</strong>, also known as <strong>de Cl\u00e9rambault syndrome</strong>/<strong>erotomania</strong>\u00a0/psychose passionelle.</p>\n<p>Delusions are\u00a0<strong>false beliefs</strong> that are\u00a0<strong>firmly</strong>\u00a0held despite objective and obvious contradictory proof. It can be present in conditions like schizophrenia, mania, major depressive disorders, and delusional disorders.\u00a0</p>\n<p>The <strong>erotomania</strong>\u00a0is more common in women but can be seen in men as well. The patient feels that someone, who is usually of a <strong>higher status</strong>, is <strong>deeply in love with them</strong>. Patients with this delusion are usually <strong>solitary, withdrawn</strong>, dependent, and sexually inhibited. It is usually sudden in onset and runs a chronic course. It is seen in conditions like\u00a0schizophrenia, mood disorder, and other organic disorders.</p>\n<p class=\"p1\">Other options:\u00a0</p>\n<p class=\"p1\">Option B: <strong>Capgras syndrome</strong> is\u00a0a <strong>delusion </strong>of<strong> misidentification</strong>.<strong>\u00a0</strong>Here, the patient believes that a <strong>familiar person</strong> has been <strong>replaced</strong> by an exact double, i.e. an <strong>impostor</strong>.</p>\n<p class=\"p1\">Option C: In the <strong>delusion </strong>of<strong>\u00a0reference,</strong> the patient believes that events, objects, or behaviour of others have a special significance to him. For, when he comes across people talking, he might assume that the discussion is about them.</p>\n<p class=\"p1\">Option D: <strong>Othello syndrome </strong>is\u00a0the presence of\u00a0marked\u00a0morbid, pathological, or <strong>delusional jealousy</strong>. The patient here has\u00a0<strong>doubts </strong>of<strong> infidelity,</strong> which is also known as <strong>conjugal paranoia</strong>.\u00a0The person holds an\u00a0<strong>abnormal belief</strong>\u00a0that their\u00a0<strong>spouse </strong>or<strong> partner </strong>is <strong>being</strong>\u00a0<strong>unfaithful</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old man presented with complaints of a rash in the elbows and knees as shown below. It has been associated with intense itching for a few weeks. On further evaluation, direct immunofluorescence  shows IgA deposition in the dermal papillae and serology revealed the presence of anti-TTG.  Which of the following drugs will you prescribe as first line for this patient along with dietary modification?",
    "choices": [
      {
        "id": 1,
        "text": "Sulphapyridine"
      },
      {
        "id": 2,
        "text": "Sulphasalazine"
      },
      {
        "id": 3,
        "text": "Sulphamethoxypyridazine"
      },
      {
        "id": 4,
        "text": "Dapsone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of a middle-aged male patient with positive anti-TTG, multiple pruritic erythematous macules and papules on the knees and elbows (as shown in image) and IgA deposition in dermal papillae are suggestive of <strong>dermatitis herpetiformis</strong> in association with <strong>gluten-sensitive enteropathy</strong>. <strong>Dapsone </strong>will be the <strong>first-line drug</strong> in this case.</p>\n<p>Dapsone helps in short-term management of dermatitis herpetiformis by its effects on neutrophil function and recruitment.</p>\n<p>Adverse side effects:</p>\n<ul>\n<li>Hemolysis especially in patients with G6PD deficiency</li>\n<li>Methaemoglobinaemia</li>\n<li>Agranulocytosis</li>\n<li>Dapsone hypersensitivity syndrome</li>\n<li>Peripheral neuropathy</li>\n</ul>\n<p>Dapsone should always be used in combination with a gluten\u2010free diet. It doesn't show any effect on the gastrointestinal symptoms of the associated&nbsp;gluten-sensitive enteropathy.</p>\n<p>Dermatitis herpetiformis is a chronic, intensely pruritic, skin condition associated with <strong>gluten\u2010sensitive enteropathy.&nbsp;</strong></p>\n<ul>\n<li>It can also be associated with autoimmune thyroid disease<strong>.</strong></li>\n<li>It is associated with&nbsp;HLA\u2010DQ2.</li>\n<li class=\"p1\">It typically appears in the 4th decade, and the patients present with itching and rash, most typically over the extensor surfaces of the elbows, knees, buttocks, and scalp.</li>\n<li class=\"p1\">They may also have&nbsp;symptoms associated with gluten-sensitive enteropathies, like bloating, diarrhea and other gastrointestinal complaints.</li>\n</ul>\n<p class=\"p1\"><strong>On examination</strong>, multiple erythematous macules and papules can be seen over the extensor aspects. They appear symmetrical and heal without scarring. The oral cavity may show mucosal abnormalities and enamel pits.</p>\n<p class=\"p1\"><strong>Diagnosis</strong> can be made by&nbsp;clinical features, histopathology, direct immunofluorescence testing, and serology.</p>\n<p class=\"p1\">The <strong>histopathology</strong> of an intact vesicle in dermatitis herpetiformis will show <strong>subepidermal blister formation</strong> with neutrophils located at the tips of the dermal papillae.&nbsp;Perivascular infiltrates can also be seen.</p>\n<p class=\"p1\"><strong>Direct immunofluorescence</strong> can be done to the skin samples taken from the lesion and perilesional skin. It will show the deposition of <strong>IgA antibodies</strong> in the papillary dermis in a <strong>granular or fibrillar pattern</strong>.&nbsp;Complement 3 may also be found along with the IgA deposits.</p>\n<p class=\"p1\">Serology many show the presence of&nbsp;<strong>IgA anti-endomysial autoantibodies</strong> that target <strong>epidermal&nbsp;transglutaminase 3.</strong></p>\n<p class=\"p1\">Treatment ladder for Dermatitis herpetiformis:</p>\n<p>First-line:</p>\n<ul>\n<li><strong>Gluten-free diet</strong> is the mainstay of treatment</li>\n<li><strong>Dapsone</strong> -&nbsp;short term management of the symptoms</li>\n<li>Potent topical steroid</li>\n</ul>\n<p>Second-line:</p>\n<ul>\n<li>Sulphamethoxypyridazine</li>\n</ul>\n<p>Third-line:</p>\n<ul>\n<li>Sulphasalazine&nbsp;</li>\n<li>Sulphapyridine&nbsp;&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/07a18547aecc487688ef4cf81a7fb21b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d32614f6e37b4505b5d36ecc692002f9x250x193.PNG"
    ]
  },
  {
    "text": "A 38-year-old male patient presents to the OPD for evaluation of low backache. The patient gives a history that he also feels pain in the back of the leg and at the ankles. On examination there is decreased sensation in the ankle region and ankle jerk reflex is diminished. The test shown in the image is positive. Which of the following is not an absolute indication for surgical management in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Progressive neurological deficit"
      },
      {
        "id": 2,
        "text": "Cauda equina paralysis"
      },
      {
        "id": 3,
        "text": "Recurrent episodes of severe sciatica"
      },
      {
        "id": 4,
        "text": "Marked progressive weakness of the muscles"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical features and a <strong>positive straight leg raising tes</strong>t as shown in the image are suggestive of an <strong>intervertebral disc prolapse involving L5-S1 nerve root.</strong>\u00a0Recurrent episodes of severe sciatica is only a relative indication for surgical management.</p>\n<p>Indications for surgical management:\u00a0</p>\n<p>Absolute indications:</p>\n<ul>\n<li>Failed conservative management.</li>\n<li>Marked progressive weakness of muscles.</li>\n<li>Progressive neurological deficit.</li>\n<li>Cauda equina paralysis.</li>\n</ul>\n<p>Relative Indications:</p>\n<ul>\n<li>Recurrent episodes of incapacitating sciatica</li>\n<li>Pain unrelieved by complete rest from activity.</li>\n</ul>\n<p><strong>Intervertebral disc prolapse</strong></p>\n<p><strong>Features of IVDP pain:</strong></p>\n<ul>\n<li>Pain is <strong>increased</strong> by flexion episodes, sneezing, coughing, straining, and sitting.\u00a0</li>\n<li>Pain is\u00a0<strong>decreased</strong> by rest and in the <strong>semi-Fowler position</strong>.\u00a0Semi-Fowler position<span class=\"ILfuVd yZ8quc\">\u00a0is lying in a bed supine with the head of the bed raised at approximately 30 to 45 degrees.</span></li>\n<li>Leg pain equal to or more than the back pain in IVDP cases is evidence of involvement of the nerve root due to the herniated disc.</li>\n</ul>\n<p><strong>Important tests for diagnosis:</strong></p>\n<p class=\"p1\"><strong>1. Straight Leg Raising Test (SLRT) or Lasegue sign</strong></p>\n<p class=\"p1\">This is done to assess nerve root irritation in the lumbosacral area.<span class=\"Apple-converted-space\">\u00a0\u00a0</span>The patient is made to lie on the back with the head extended, with hips and legs in the neutral position. The affected leg is then passively and slowly raised by the ankle with the knee fully extended. The examiner stops further leg elevation when pain is elicited. Normally it should be possible to raise the limb to 80\u201390 degrees. The SLRT test is positive if the patient develops pain when the leg is between 30 and 60/70 degrees from horizontal. The pain should be radicular type and radiating to the back of the thigh or to the calf.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3179069f108341e58e5f6608baa258dd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21c521e2b1604f82adf915631ce0d66cx1279x1414.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2620078ca3e04edc864dd89596ac463dx1280x1375.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7c8b35f22a8d422ea24039e5c9fed7e1x1279x1459.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91ccb8fb2ada4706aa735f167a846e4cx1280x1557.JPEG"
    ]
  },
  {
    "text": "A woman brought her 13-month-old daughter to the pediatric OPD with recurrent urinary tract infections. Investigations reveal Grade-III vesicoureteral reflux and acute UTI. After treating her infection, which of the following investigation will she be followed up with, after 6 months?",
    "choices": [
      {
        "id": 1,
        "text": "Voiding cystourethrogram"
      },
      {
        "id": 2,
        "text": "Magnetic resonance imaging"
      },
      {
        "id": 3,
        "text": "DMSA scan"
      },
      {
        "id": 4,
        "text": "Ultrasonogram"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A dimercaptosuccinic acid (<strong>DMSA</strong>) scan may be done after 4&ndash;6 months of <strong>acute infection</strong> as it may help to locate and delineate the scarring.</p>\n<p><strong>Vesicoureteral reflux (VUR)</strong> severity is graded according to the&nbsp;appearance of the urinary tract on a contrast voiding cystourethrogram.</p>\n<p>It is classified into 5 grades (Grade I to V):</p>\n<p><strong>Grading of vesicoureteral re\ufb02ux:</strong></p>\n<ul>\n<li>Grade I: VUR into a non-dilated ureter</li>\n<li>Grade II: VUR into the upper collecting system without dilation</li>\n<li>Grade III: VUR into the dilated ureter and/or blunting of calyceal fornices.</li>\n<li>Grade IV: VUR into a grossly dilated ureter</li>\n<li>Grade V: Massive VUR, with significant ureteral dilation and tortuosity and loss of the papillary impression.</li>\n</ul>\n<p>In a typical<strong>&nbsp;</strong>first episode&nbsp;of&nbsp;urinary tract infection (UTI) in children,&nbsp;initial imaging&nbsp;should be&nbsp;<strong>ultrasonography&nbsp;</strong>of the kidneys, ureters, and bladder.</p>\n<p>A <strong>Voiding cystourethrogram</strong> is indicated only if the ultrasound study is abnormal, the patient has atypical features, or after a recurrent febrile UTI.</p>\n<p>A dimercaptosuccinic acid <strong>(DMSA) scan</strong> may be done after 4&ndash;6 months of acute infection as it may help to locate and delineate the scarring.</p>\n<p>Magnetic resonance imaging does not have any significant role in the follow-up of this condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa5d29ec0b5c4e22ba62c9243ce03cf4x1024x700.jpeg",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99a867d5ba2741bdb60f9f3c81de15d7x1280x7345.JPEG"
    ]
  },
  {
    "text": "A young woman was admitted for ingestion of several acetaminophen tablets. After 2 weeks of admission, she developed disturbed sleep and mild confusion. Investigations revealed deranged prothrombin time and bleeding time. The resident wanted to assess the requirement of liver transplantation using the King's College Hospital criteria. All of the following parameters are required to evaluate this patient except?",
    "choices": [
      {
        "id": 1,
        "text": "Serum creatinine level >3.4 mg/dL"
      },
      {
        "id": 2,
        "text": "Grade 3 or 4 encephalopathy"
      },
      {
        "id": 3,
        "text": "pH < 7.3"
      },
      {
        "id": 4,
        "text": "Age < 10 or > 40 years"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>King's college hospital criteria for paracetamol overdose does not include age &lt; 10 or &gt; 40 years. This parameter is included in the non paracetamol cases of liver failure.</p>\n<p><strong>King's college hospital criteria</strong> is a selection criterion in <strong>acute liver failure</strong> for <strong>liver transplantation</strong><strong>.\u00a0</strong>It includes the following parameters:</p>\n<p>Liver transplantation is indicated in <strong>acetaminophen-induced</strong> ALF if there is a presence of</p>\n<ul>\n<li>Either pH\u00a0&lt;7.3</li>\n<li>Or all of the following\n<ul>\n<li class=\"p1\">Prothrombin time &gt;100 sec</li>\n<li class=\"p1\">Serum creatinine level &gt;3.4 mg/dL (300\u00a0<span class=\"s1\">\u03bc</span>mol/L)</li>\n<li class=\"p1\">Grade 3-4 encephalopathy</li>\n</ul>\n</li>\n</ul>\n<p>Liver transplantation is indicated in <strong>nonacetaminophen</strong> causes of ALF if there is a presence of\u00a0</p>\n<ul>\n<li class=\"p1\">Either prothrombin time &gt;100 sec</li>\n<li class=\"p1\">Or any three of the following\n<ul>\n<li class=\"p1\">Jaundice to encephalopathy time &gt; 7 days</li>\n<li class=\"p1\">Age &lt; 10 or &gt; 40 years</li>\n<li class=\"p1\">Indeterminate or drug-induced causes</li>\n<li class=\"p1\">Bilirubin &gt; 300 \u03bcmol/L (&gt;3.4 mg/dL)</li>\n<li class=\"p1\">Prothrombin time &gt; 50 secs</li>\n</ul>\n</li>\n<li class=\"p1\">Or Factor V level &lt; 15% and encephalopathy grade 3 or 4</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The rate of postmortem cooling is higher in which among the following situations?",
    "choices": [
      {
        "id": 1,
        "text": "An adult body kept in a dry environment"
      },
      {
        "id": 2,
        "text": "A body with excess fat kept in a closed room"
      },
      {
        "id": 3,
        "text": "A fully clothed body kept under a blanket"
      },
      {
        "id": 4,
        "text": "A body kept in a well ventilated humid environment"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The rate of post mortem cooling is <strong>higher</strong> in a body kept in a <strong>well ventilated humid environment.\u00a0</strong></p>\n<p>Moist air is a better conductor of heat than dry air, therefore postmortem cooling is more rapid in a humid environment than dry environment. A body kept in a well ventillated room will cool more rapidly than one kept in a closed room.</p>\n<p>Rate of cooling is slow when the body is clothed as clothes are bad conductors of heat.\u00a0</p>\n<p>Fat is a bad conductor of heat. Fat bodies cool slowly and lean bodies cool rapidly.</p>\n<p><strong>Factors increasing the rate of postmortem cooling:</strong></p>\n<ul>\n<li>Increased difference in the temperature between body and the atmosphere</li>\n<li>Large body surface area</li>\n<li>Children and old aged people</li>\n<li>Higher humidity and rapid air velocity</li>\n<li>Body immersed in running water</li>\n</ul>\n<p><strong>Rate of cooling is decreased in:</strong></p>\n<ul>\n<li>Excess fat</li>\n<li>Edema</li>\n<li>Body covered with clothing</li>\n<li>Bodies in small, ill-ventilated room</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Mini Test 28';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>