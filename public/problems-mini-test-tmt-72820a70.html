<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problems Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "5 people out of 60 who landed from an international flight were positive for COVID-19. Totally, 75 people were in contact with these 5 cases, out of these 15 were found to be positive within 2 weeks of the incubation period. Calculate the secondary attack rate in this?",
    "choices": [
      {
        "id": 1,
        "text": "50%"
      },
      {
        "id": 2,
        "text": "25%"
      },
      {
        "id": 3,
        "text": "20%"
      },
      {
        "id": 4,
        "text": "15%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The secondary attack rate, in this case, is<strong> 20%</strong></p>\n<p>In this scenario, the total number of <strong>primary cases were 5.</strong></p>\n<p>The<strong> total number exposed</strong> people who were in contact with the primary cases were <strong>75</strong>&nbsp;and the total number of <strong>exposed people developing the disease</strong> were <strong>15</strong>.</p>\n<p><strong>Secondary attack rate</strong>=(Number of exposed people developing the disease within the incubation period/Number of people exposed)&times;100</p>\n<p>=(15/75)&times;100</p>\n<p>=(1/5)x100</p>\n<p>=20</p>\n<p>Therefore the <strong>secondary attack rate</strong> is 20%</p>\n<p>&nbsp;</p>\n<p><strong>Note</strong>:</p>\n<p>The incubation period of COVID-19 may extend up to 14 days, with a median incubation period between 4-5 days from exposure to symptoms onset.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a village with a given population, the total number of births in a year is 5100. There were 100 stillbirths. 25 newborns died within the first 7 days of life whereas 175 died due to various causes between 8 \u2013 28 days of life. There were 50 deaths between the age of 1 month to 6 months of life. What is the neonatal mortality rate in this population?",
    "choices": [
      {
        "id": 1,
        "text": "40"
      },
      {
        "id": 2,
        "text": "12. 5"
      },
      {
        "id": 3,
        "text": "100"
      },
      {
        "id": 4,
        "text": "50"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Neonatal mortality rate = Number of deaths of children under 28 days of age in a year x 1000/Total live births in the same year</p>\n<p>The total live births in this scenario is 5100 \u2013 100 = 5000 live births.</p>\n<p>NMR = (25+175) x 1000/5000 = 40.</p>\n<p>Note: Still births and deaths after 28 days of life are not considered in\u00a0Neonatal Mortality Rate.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The biological value of a food substance is 800 and its digestibility coefficient is 12. Calculate its Net Protein Utilization and identify the food substance.",
    "choices": [
      {
        "id": 1,
        "text": "50, Groundnut"
      },
      {
        "id": 2,
        "text": "96, Egg"
      },
      {
        "id": 3,
        "text": "81, Cow milk"
      },
      {
        "id": 4,
        "text": "65, Rice"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong><span data-preserver-spaces=\"true\">&nbsp;96 and the food substance is an egg.</span></strong></p>\n<p><strong><span data-preserver-spaces=\"true\">NPU = (Biological value of a food substance x Digestability coefficient) / 100 = (800x12) / 100 = 96.&nbsp;</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Eggs have the highest NPU value and that is why it is considered as a&nbsp;</span><strong><span data-preserver-spaces=\"true\">reference protein.&nbsp;</span></strong></p>\n<p><strong><span data-preserver-spaces=\"true\">Few Important food substances whose NPU is to be remembered:</span></strong></p>\n<p><span data-preserver-spaces=\"true\">(Different books give different value, these values are mentioned considering Park's textbook of Preventive and social medicine, 25th edition)</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Egg - 100</span></li>\n<li><span data-preserver-spaces=\"true\">Cow milk - 75</span></li>\n<li><span data-preserver-spaces=\"true\">Meat - 80</span></li>\n<li><span data-preserver-spaces=\"true\">Rice - 65</span></li>\n<li><span data-preserver-spaces=\"true\">Groundnut/ pulses - 50</span></li>\n</ul>\n<p><strong><span data-preserver-spaces=\"true\">Net protein utilization</span></strong><span data-preserver-spaces=\"true\">&nbsp;is used to describe the percentage of nitrogen retained in the body concerning nitrogen intake.</span></p>\n<p><span data-preserver-spaces=\"true\">Note: The NPU of the Indian diet is between 50 and 80.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While examining a pregnant woman, you measure her fundal height to be 32 cm and the station of the fetal head is at -2. What could be the probable weight of the fetus?",
    "choices": [
      {
        "id": 1,
        "text": "2.3Kg"
      },
      {
        "id": 2,
        "text": "3.5Kg"
      },
      {
        "id": 3,
        "text": "3.1Kg"
      },
      {
        "id": 4,
        "text": "4.0Kg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The fetal weight in the above case is<strong> 3.1Kg.</strong></p>\n<p>In the above case, fetal weight can be estimated using&nbsp;<strong>Johnson's formula</strong>. Height of uterus is 32cm, the station is &ndash;2 implying the head is above the ischial spines. Therefore, it is calculated as follows:&nbsp;[32-12] x 155 = 3100 grams = 3.1Kg</p>\n<p>Estimation of fetal weight:</p>\n<ul>\n<li><strong>Johnson&rsquo;s formula:&nbsp;</strong>This is only applicable in vertex presentation.\n<ul>\n<li>If station of head is <strong>below</strong> the level of the ischial spine: [Height of uterus above pubic symphysis (in cm)<strong>-11</strong>] x 155 in grams</li>\n<li>If station of head is <strong>above</strong> the level of the ischial spine: [Height of uterus above pubic symphysis (in cm)<strong>-12</strong>] x 155 in grams</li>\n</ul>\n</li>\n<li><strong>Sonography:</strong>&nbsp;Fetal weight has been estimated by combining a number of biometric data, e.g. biparietal diameter (BPD), head circumference (HC),&nbsp;abdominal circumference (AC) and femur length (FL), using the following formulae:\n<ul>\n<li>Shepard&rsquo;s formula</li>\n<li>Hadlock&rsquo;s formula.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ae395dfdcef14bedb1eec4ec4edde0ffx1280x1373.JPEG"
    ]
  },
  {
    "text": "In a village with 200 eligible couples, family planning data of contraceptive methods is as follows:\n\nVasectomy \u2013 30\nTubectomy \u2013 30\nIUD users \u2013 12\nOral pill users \u2013 30\nCondom users \u2013 18\n\nWhat is the couple protection rate in the village?",
    "choices": [
      {
        "id": 1,
        "text": "33%"
      },
      {
        "id": 2,
        "text": "60%"
      },
      {
        "id": 3,
        "text": "75%"
      },
      {
        "id": 4,
        "text": "50%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Couple protection rate (CPR)</strong> is defined as the percentage of eligible couples effectively protected against childbirth by one or the other approved methods of family planning.</p>\n<p>In this scenario, a total of 120 couples out of 200 eligible couples are using contraceptive methods.</p>\n<p>Therefore, CPR = (120/200) x 100 =<strong> 60%&nbsp;</strong></p>\n<p><strong>Eligible couple:&nbsp;</strong>It refers to a currently married couple, wherein the <strong>wife is at the reproductive age</strong>, which is generally assumed to lie between the <strong>ages 15 and 45 years.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "32 grams of bleaching powder was required to disinfect 1820 liters of well water. When measuring the chlorine demand with the below-given apparatus for this well water, which cup would have shown the blue color after adding the indicator?",
    "choices": [
      {
        "id": 1,
        "text": "5th cup"
      },
      {
        "id": 2,
        "text": "4th cup"
      },
      {
        "id": 3,
        "text": "3rd cup"
      },
      {
        "id": 4,
        "text": "2nd cup"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image is of <strong>Horrock's apparatus</strong> used to measure <strong>chlorine demand </strong>of water, <strong>4th\u00a0cup</strong> would have shown blue color for it to require 32 grams of bleaching powder to disinfect 1820 liters of well water.</p>\n<p>Since 1820/455=4, the amount of bleaching powder required to disinfect<strong> 455 liters</strong> of water is 32/4=<strong>8\u00a0grams</strong></p>\n<p>To calculate the <strong>dose of bleaching</strong> required to disinfect<strong> 455</strong> liters of water, the formula is<strong> (n\u00d72).</strong>\u00a0As we know the dose required,<strong> we have to calculate 'n'\u00a0</strong>(n represents the position of the cup which was first to show the color).</p>\n<p>8=n\u00d72, therefore <strong>n=4.</strong></p>\n<p>The<strong>\u00a0fourth cup</strong> would have turned<strong> blue</strong> on adding the indicator.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6b825e67d69d487d89c90b748c5c5b38.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A drug trial compares the effect of a drug compared to placebo in decreasing cholesterol levels in 2 groups of 500 individuals each. A side effect to be studied simultaneously is the elevation of creatine kinase due to rhabdomyolysis. 10 individuals who received the drug develop this side effect, while only 5 individuals who are on placebo have this side effect. Calculate the number needed to harm (NNH).",
    "choices": [
      {
        "id": 1,
        "text": "5"
      },
      {
        "id": 2,
        "text": "10"
      },
      {
        "id": 3,
        "text": "100"
      },
      {
        "id": 4,
        "text": "500"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The number needed to harm (NNH) for this particular drug is <strong>100</strong>.</p>\n<p>The <strong>number needed to harm</strong> is given as the number of individuals we need to treat, to encounter an effect or side-effect of a particular drug. The higher the NNH, the better is the drug.</p>\n<p>For example, if we see a side effect of a drug in 1 out of every 100 patients we are treating, it is better as compared to encountering 1 side effect after treating 10 patients.</p>\n<p>The NNH to harm is 100 and 10 respectively in these cases, and the former drug is better because it has lesser side effects.</p>\n<p>NNH is calculated as <strong>1/absoulte risk increase\u00a0</strong>(i.e. 1/ARI).</p>\n<p>Step1: Calculate the risk of side effects with the drug as well as placebo</p>\n<p>The risk with drug = 10/500</p>\n<p>The risk with placebo = 5 /500</p>\n<p>Step 2: Calculate the absolute risk increase:\u00a0 ARI= side effect with drug-side effect even with placebo</p>\n<p>10/500 - 5/500 = 5/500 = 1/100 = 0.01</p>\n<p>Step 3: Calculate the NNH</p>\n<p>1/ARI = 1/0.01 = 100</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The fasting blood glucose levels of a  group of diabetics were found to be normally distributed with a mean of 110 mg /dL and a standard deviation of 10 mg /dL. From this data, it can be inferred that approximately 99% of diabetics will have their fasting blood glucose levels within the limits of ____.",
    "choices": [
      {
        "id": 1,
        "text": "70 -150 mg/dL"
      },
      {
        "id": 2,
        "text": "80 - 140 mg/dL"
      },
      {
        "id": 3,
        "text": "90 -110 mg/dL"
      },
      {
        "id": 4,
        "text": "80 -100 mg/dL"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In this scenario with a<strong> mean</strong> blood sugar level of <strong>110mg/dL</strong> and a <strong>standard deviation</strong> of <strong>10mg/dL</strong>, <strong>99%</strong> of <strong>diabetics</strong> will have their fasting blood glucose levels between <strong>80-140mg/dL</strong>.</p>\n<p>99.7% of the distribution falls within <strong>three standard deviations </strong>of the mean. This proportion is true for every normal distribution. Thus, we have to add and subtract 30 (three standard deviations = 10 x 3) from the mean to arrive at the limits within which 99% of the population would have their blood sugar, i.e.,&nbsp;<strong>mean &plusmn; 3 SD </strong>which will be <strong>80 and 140 mg</strong>.</p>\n<p>The standard deviation is the most frequently used <strong>measure</strong> of <strong>dispersion</strong>. <strong>Range</strong> and<strong> mean</strong> are the other measures. The shape of a frequency distribution is determined by the standard deviation and mean which in turn depends on the individual observations. A frequency distribution with a symmetrical, <strong>bell-shaped curve</strong> is known as a <strong>normal distribution</strong>. It is also known as <strong>Gaussian distribution</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A known amount of inulin and Evans blue dye is injected into a healthy woman of 60 Kgs. The volume of distribution of inulin was found to be 10L and the volume of distribution of Evans blue dye was found to be 2.5L. Which among the following is true regarding the volumes of various body fluids in this woman?",
    "choices": [
      {
        "id": 1,
        "text": "Interstitial fluid volume is 7.5L"
      },
      {
        "id": 2,
        "text": "Intracellular fluid volume is 7.5L"
      },
      {
        "id": 3,
        "text": "Interstitial fluid volume is 20L"
      },
      {
        "id": 4,
        "text": "Extracellular fluid volume is 20L"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this woman, the <strong>interstitial fluid</strong> volume is <strong>7.5 L.</strong></p>\n<p>In the above scenario, the volume of distribution of Evans blue, which measures the volume of <strong>plasma</strong> is <strong>2.5 L.\u00a0</strong>The volume of distribution of inulin, which measures the <strong>extracellular fluid</strong> is <strong>10 L.\u00a0</strong></p>\n<p>Therefore,</p>\n<p><strong>Interstitial fluid volume</strong> = Extracellular fluid volume - Plasma volume</p>\n<p>= 10L- 2.5L</p>\n<p>= <strong>7.5 L</strong></p>\n<p>Other volumes</p>\n<p>About two-thirds of the total body water is present as intracellular fluid and one-third are present as extracellular fluid. Therefore, <strong>intracellular fluid</strong> will be approximately 2 times the extracellular fluid, which is around <strong>20L</strong>. The addition of extracellular fluid with the intracellular fluid will give <strong>total body water</strong>, that is 20L+ 10L = <strong>30L</strong></p>\n<p class=\"p1\">The total body fluid is distributed mainly between two compartments, the <strong>extracellular fluid</strong>, and the <strong>intracellular\u00a0<span class=\"s1\">fluid</span></strong><span class=\"s1\"><strong>.</strong> The intracellular fluid is about two-thirds of the total body water and the extracellular fluid (ECF) is about one-third of the total body water.\u00a0</span>The ECF is divided into the interstitial fluid and the blood plasma. Interstitial fluid is about three-fourth of the ECF and blood plasma constitutes about one-fourth of ECF.</p>\n<p>In an adult <strong>man,</strong> total body water is <strong>60%</strong> of the total body weight whereas, in a <strong>woman,</strong> the total body water is<strong> 50%</strong> of the body weight.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An epidemiologist is calculating the incubation period for measles in children aged 2 to 14 years. He was assigned a rural area with a sizeable portion of unvaccinated children and adolescents. He takes the sample size as 100. The median incubation period is 10 days, and the standard deviation he obtains is 4. What will be the standard error in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "0.4"
      },
      {
        "id": 2,
        "text": "1.0"
      },
      {
        "id": 3,
        "text": "2.0"
      },
      {
        "id": 4,
        "text": "0.5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The formula for standard error is <strong>SE = standard deviation/ square root of sample size.</strong></p>\n<p>In this scenario, the standard error = 4/10 = <strong>0.4</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient's ECG strip is given below. His cardiac output was found to be 4.8 L/min. What is the stroke volume?",
    "choices": [
      {
        "id": 1,
        "text": "100 ml"
      },
      {
        "id": 2,
        "text": "60 ml"
      },
      {
        "id": 3,
        "text": "120 ml"
      },
      {
        "id": 4,
        "text": "80 ml"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Cardiac output is calculated by the following formula -</p>\n<p>Cardiac output = Heart rate x Stroke volume</p>\n<p>The patient's <strong>cardiac output is 4.8L/min</strong>.</p>\n<p>His heart rate can be calculated from the rhythm strip given i.e., HR = 300/number of large squares between consecutive beats. There are approximately 5 large boxes between beats in this ECG.</p>\n<p><strong>HR = 300/5 = 60 beats/min.</strong></p>\n<p>Therefore, the patient's stroke volume = CO/HR = 4.8L/min/60 beats/min = 0.08 L = <strong>80ml</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/55e0754e85aa4cd3aa9a9395929311b3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old male patient has the following laboratory findings: pH 7.2, plasma sodium 136 mEq/L, chloride 110 mEq/L, bicarbonate 15 mEq/L, and potassium 2.6 mEq/L. Urine studies show a pH of 5.1. Following the administration of intravenous sodium bicarbonate, the urine pH is 5.8. Which of the following conditions is the most likely underlying cause?",
    "choices": [
      {
        "id": 1,
        "text": "Type I renal tubular acidosis"
      },
      {
        "id": 2,
        "text": "Type II renal tubular acidosis"
      },
      {
        "id": 3,
        "text": "Diabetic ketoacidosis"
      },
      {
        "id": 4,
        "text": "Lactic acidosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The laboratory findings are most likely suggestive of <strong>type II (proximal) renal tubular acidosis.</strong></p>\n<p>The arterial blood gas analysis shows <strong>normal anion gap metabolic acidosis (NAGMA).</strong></p>\n<p><strong>Interpretation:</strong></p>\n<p><strong>Step 1:</strong> The<strong> pH </strong>is<strong> 7.2</strong> (&lt;7.35) suggestive of acidosis</p>\n<p><strong>Step 2:</strong> Plasma bicarbonate is 15 mEq/L indicating metabolic acidosis</p>\n<p><strong>Step 3:</strong> A<strong>ssessment of the anion gap:</strong></p>\n<p>\u202fAnion gap = [Na+] &ndash; ([Cl-] + [HCO3-])</p>\n<p>= 136 - (110 + 15)</p>\n<p>= 136 - 125</p>\n<p>= 11 mEq/L (Normal range: 8-12&nbsp;mEq/L)</p>\n<p>Hence, the laboratory findings are suggestive of <strong>normal anion gap metabolic acidosis.</strong></p>\n<p><strong>Renal tubular acidosis</strong> is one of the common causes of NAGMA. The serum potassium is low (<strong>hypokalemia</strong>), suggestive of <strong>either type I or type II renal tubular acidosis.</strong> Type III RTA is rare and is seen mostly in children, while type IV RTA is associated with hyperkalemia.</p>\n<p>The urine pH is initially 5.1 (&lt;5.5, acidic), which increased to 5.8 (&gt;5.5) following administration of sodium bicarbonate (alkali therapy), suggestive of <strong>poor bicarbonate reabsorption</strong> in the proximal tubules of the kidney, making the diagnosis of <strong>type II (proximal) renal tubular acidosis.</strong></p>\n<p><strong>Type II RTA&nbsp;</strong>is commonly caused due to generalized proximal tubular dysfunction, associated with&nbsp;<strong>Fanconi syndrome (glycosuria, aminoaciduria,</strong> and <strong>phosphaturia).</strong> The bicarbonate is poorly reabsorbed in the proximal convoluted tubule, leading to its increased excretion <strong>(bicarbonaturia).</strong> This leads to decreased plasma bicarbonate levels and metabolic acidosis.</p>\n<p>As the plasma bicarbonate levels fall below the renal threshold for reabsorption of the HCO<sub>3</sub><sup>- </sup>in patients with type II RTA, all the bicarbonate is reabsorbed thus maintaining the urinary pH acidic (&lt;5.5). When sodium bicarbonate is administered intravenously, it increases the plasma bicarbonate levels above the limited renal threshold, leading to increased excretion of HCO<sub>3</sub><sup>-&nbsp;</sup>causing increased urinary pH (&gt; 5.5).</p>\n<p><strong>Alkali therapy</strong>&nbsp;for correcting plasma bicarbonate in type II RTA should be carried out with caution, as sudden increased availability of HCO<sub>3</sub><sup>- </sup>to the distal tubules stimulates the secretion of potassium, further exaggerating the <strong>hypokalemia</strong>. Hence, potassium salts are usually administered along with alkali therapy. An oral solution of a combination of<strong> sodium and potassium citrate</strong> is commonly prescribed alkali therapy for this reason.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A clinical pharmacologist is studying the effect of the first-pass metabolism on the systemic availability and absorption of the drug 'X'. Drug 'X' is an oral formulation whose experimental absorption value was predicted to be 1. Hepatic clearance determined for this drug is 60L/ kg/hr. Considering the normal hepatic blood flow in a healthy individual to be 90L/kg/hr, calculate the systemic bioavailability for Drug 'X'.",
    "choices": [
      {
        "id": 1,
        "text": "55%"
      },
      {
        "id": 2,
        "text": "33%"
      },
      {
        "id": 3,
        "text": "44%"
      },
      {
        "id": 4,
        "text": "22%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The systemic bioavailability of this drug is 33%.</p>\n<p>The <strong>systemic bioavailability (F)</strong> of a drug is based on the <strong>extraction ratio (ER)</strong> and the <strong>extent of absorption of the drug (f)</strong>.</p>\n<p><strong>F = f x (1-ER)</strong></p>\n<p>Extraction ratio is the parameter used to express the effect of hepatic first-pass metabolism on the drug.</p>\n<p><strong>ER = CL(liver clearance) / Q (Blood flow to the liver)</strong></p>\n<p>Thus, ER = 60 / 90 = 0.67</p>\n<p>In the given question f= 1.</p>\n<p>Thus, F = 1 X (1-0.67) = 0.33 OR 33%</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a part of a research team working on a new rapid diagnostic screening test for COVID. The following table shows the results of 10,000 people who took the new screening test. Calculate the positive predictive value of this screening test.",
    "choices": [
      {
        "id": 1,
        "text": "99.7%"
      },
      {
        "id": 2,
        "text": "28.5%"
      },
      {
        "id": 3,
        "text": "66.6%"
      },
      {
        "id": 4,
        "text": "98.9%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>positive predictive value</strong> of this screening test is <strong>66.6%.</strong> Positive predictive value<strong>&nbsp;</strong>implies the probability of a person with a<strong>&nbsp;positive test, actually having the disease</strong>.&nbsp;</p>\n<p>This is calculated using the following formula :</p>\n<p>(TP/TP+FP) x 100</p>\n<p>where,</p>\n<p>TP - True positive (Screening test and diagnosis is positive for the disease)</p>\n<p>FP - False positive (Screening test is positive but the diagnosis is negative)</p>\n<p>In this scenario :</p>\n<p>(40/40+20) x 100 = (40/60) x 100 = 0.666 x 100 =&nbsp;<strong>66.6%</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is undergoing the estimation of p-aminohippuric acid (PAH) clearance. He was infused with PAH and the plasma and urinary concentration were measured. It shows the following values-",
    "choices": [
      {
        "id": 1,
        "text": "GFR is 400mL/min"
      },
      {
        "id": 2,
        "text": "GFR is 490 ml/min"
      },
      {
        "id": 3,
        "text": "ERPF is 490mL/min"
      },
      {
        "id": 4,
        "text": "ERPF is 400mL/min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In this scenario, the&nbsp;effective renal plasma flow (RPF) is <strong>490mL/min.&nbsp;</strong></p>\n<p><strong>Clearance&nbsp;</strong>is defined as the volume of plasma from which a particular substance is completely removed by the kidney in a given amount of time (usually minutes). Para aminohippuric acid (PAH) is filtered by the glomeruli and secreted by the tubular cells. Therefore, the amount of the PAH that enters the kidney is almost completely removed. It means that the entire renal plasma is cleared from PAH in a given time. Because of this reason, PAH clearance measures the renal plasma flow.</p>\n<p>The formula used to calculate PAH clearance (C<span style=\"font-size: 11.6667px;\">PAH</span>) is:</p>\n<p><strong>&nbsp;U<sub>PAH</sub>&nbsp;&times; V &frasl; P<sub>PAH</sub></strong><sub><strong>&nbsp;</strong>&nbsp;</sub>where,</p>\n<p>U<sub>PAH&nbsp;</sub>- Concentration of PAH in urine- 14mg/mL</p>\n<p>P<sub>PAH&nbsp;</sub>- Concentration of PAH in plasma- 0.02mg/mL</p>\n<p>V - Urine flow- 0.7 mL/min</p>\n<p>Substituting the values given in the question, we get:</p>\n<p>PAH clearance =&nbsp;&nbsp;U<sub>PAH</sub>&nbsp;&times; V &frasl; P<sub>PAH ,</sub></p>\n<p>= (14 x 0.7)/0.02</p>\n<p>= 9.8 / 0.02</p>\n<p><strong>= 490 mL/min.</strong></p>\n<p>In an actual scenario, about 90% of the PAH is removed by the kidney. Therefore this is called <strong>effective renal plasma flow. </strong>Actual renal plasma flow is calculated by dividing the PAH clearance with an extraction ratio. The extraction ratio is&nbsp;arterial concentration minus renal venous concentration divided by arterial concentration. Normally the extraction ratio is<strong> 0.9.</strong></p>\n<p>If we consider the extraction ratio to be 0.9 in this scenario, the <strong>actual renal plasma flow</strong> will be</p>\n<p>= 490/0.9</p>\n<p>= <strong>~544 mL/min</strong></p>\n<p>Similarly, inulin and creatine clearance is used in the measurement of the <strong>glomerular filtration rate.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a molecular biochemist working on genetic elements and the organization of human recombinant chimeric DNA (cDNA). In a sample of extracted DNA element, you determine the percentage of thymine residues to be 22%. What would be the expected percentage of cytosine?",
    "choices": [
      {
        "id": 1,
        "text": "28"
      },
      {
        "id": 2,
        "text": "22"
      },
      {
        "id": 3,
        "text": "36"
      },
      {
        "id": 4,
        "text": "44"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The percentage of cytosine in DNA will be&nbsp;<strong>28%.</strong></p>\n<p>According to <strong>Chargaff's rule</strong> in cellular<strong> DNA regardless </strong>of<strong> species,</strong></p>\n<p><strong>Purines = Pyrimidines</strong></p>\n<p>Sum of purine = Sum of pyrimidines i.e <strong>A+G=C+T. </strong></p>\n<p>In the question it is given that thymine is 22%, therefore adenine is also 22%.</p>\n<p>Hence adenine + thymine = 44% and&nbsp;Guanine + cytosine = 56%.&nbsp;</p>\n<p>No of Guanine = No of Cytosine, so the percentage of cytosine = 56/2 = 28%.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "400 mg of a drug was administered to a patient, of which 40 mg is excreted in 60 minutes. Assuming the drug follows first-order kinetics, how much of the drug would remain after 2 hours?",
    "choices": [
      {
        "id": 1,
        "text": "324 mg"
      },
      {
        "id": 2,
        "text": "360 mg"
      },
      {
        "id": 3,
        "text": "243 mg"
      },
      {
        "id": 4,
        "text": "270 mg"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>After 2 hours, <strong>324mg </strong>of the drug will remain.</p>\n<p>In first-order&nbsp;kinetics, <strong>a constant fraction of the drug</strong> is excreted in a given time<strong>.</strong>&nbsp;</p>\n<p>In the given question, 40 mg out of 400 mg is excreted in 60 minutes ---&gt; 40/400 = <strong>0.1 fraction&nbsp;is eliminated every 60 minutes.</strong></p>\n<p>After 60 minutes; 400 mg - 40 mg = 360 mg remains&nbsp;</p>\n<p>The next 60 minutes (after 2 hours) = 360 * 0.1 = 36 mg is eliminated and 360 - 36 = 324 mg remains.</p>\n<p><strong>Simpler way -</strong></p>\n<ul>\n<li>1/10 fraction is excreted in 60 minutes&nbsp;&rarr; 9/10 remains after 60 minutes.</li>\n<li>2 hours (120 min) is 2 times of 60 minutes.</li>\n<li>So 400 * (9/10)(9/10) = 324 mg remains after 120 minutes.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A student was asked to record ECG by using bipolar limb leads. The below image shows the arrangement of the bipolar electrodes and the potentials recorded across lead I and lead II. What is the potential recorded across lead III?",
    "choices": [
      {
        "id": 1,
        "text": "+1.7 mV"
      },
      {
        "id": 2,
        "text": "-1.7 mV"
      },
      {
        "id": 3,
        "text": "+0.7 mV"
      },
      {
        "id": 4,
        "text": "-0.7 mV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><span class=\"s1\">According to\u00a0Einthoven\u2019s law, the potential recorded across <strong>lead III</strong> is\u00a0<strong>+0.7 mV.</strong></span></p>\n<p class=\"p1\"><span class=\"s1\"><strong>Einthoven\u2019s Law</strong>:\u00a0</span>Einthoven\u2019s law states that if the ECGs are recorded simultaneously with the three limb leads, the sum of the potentials recorded in leads I and III will equal the potential in lead II.</p>\n<p class=\"p2\"><strong>Lead I potential + Lead III potential = Lead II potential</strong></p>\n<p class=\"p2\">Lead III = Lead II \u2013 Lead I = (1.2-0.5) = <strong>+0.7 mV.</strong></p>\n<p class=\"p2\">Note: Einthoven's triangle is an imaginary triangle drawn around the area of the heart. It is formed by the arrangement of three bipolar limb leads (the two arms and left leg).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a9b3abfc84f2446cb642b2521cfedbe8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A newborn is being assessed at 5 minutes after birth. He is found to have a heart rate of 110bpm, coughs on stimulation, and has a strong cry. His limbs are well flexed, the body is pink, but extremities appear blue. The Apgar score for this newborn is ______",
    "choices": [
      {
        "id": 1,
        "text": "7"
      },
      {
        "id": 2,
        "text": "10"
      },
      {
        "id": 3,
        "text": "8"
      },
      {
        "id": 4,
        "text": "9"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The Apgar score for this newborn is 9.</p>\n<p>In this baby:</p>\n<ul>\n<li>Body pink, extremities blue: score 1</li>\n<li>Heart rate, &gt;100 beats/min: score 2</li>\n<li>Coughs on stimulation, score 2</li>\n<li>Well flexed of the extremities: score 2</li>\n<li>Strong cry: score 2</li>\n</ul>\n<p>Thus the total score is 9.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient was brought to the emergency room after a road traffic accident. He produces unrecognizable sounds only, opens his eyes only to a painful stimulus and his right pupil alone is unreactive to light. His posture on the bed is shown below.  What is this patient's calculated GCS-P score?",
    "choices": [
      {
        "id": 1,
        "text": "5"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "6"
      },
      {
        "id": 4,
        "text": "7"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above patient has a <strong>GCS-P score of 6</strong> which is calculated as follows.</p>\n<p>The score for eye-opening - opens only to painful stimulus - 2<br />The score for verbal response - sounds only - 2<br />The score for motor response - decorticate posturing - 3<br />Pupillary score - one pupil non-reactive - 1</p>\n<p><strong>GCS-P score -&nbsp;</strong></p>\n<p>It is the Glasgow Coma Scale score with the incorporation of pupillary function. The pupillary function was added so that the brainstem function is also represented by the score.&nbsp;</p>\n<p>The total score is calculated by adding the score for eye-opening, verbal, and motor responses and <strong>subtracting the pupil score from the sum.</strong></p>\n<p>Total score = 2 + 2 + 3 - 1 = 6</p>\n<p><strong>Decorticate posture:</strong></p>\n<ul>\n<li>The&nbsp;<strong>upper limbs are flexed</strong>, the&nbsp;<strong>lower limbs</strong>&nbsp;are&nbsp;<strong>extended</strong>&nbsp;with toes pointed slightly inward, and the head is extended.</li>\n<li>Decorticate posturing is given a score of&nbsp;<strong>3</strong>&nbsp;in best motor response in Glasgow Coma Scale.</li>\n</ul>\n<p><strong>Decerebrate posture:</strong></p>\n<ul>\n<li>Here,&nbsp;<strong>lower extremities are extended</strong>&nbsp;with toes pointed inward and&nbsp;<strong>upper extremities</strong>&nbsp;<strong>extended</strong>&nbsp;with&nbsp;<strong>fingers flexed</strong>&nbsp;and forearms pronated. The neck and head are extended.&nbsp;</li>\n<li>Decerebrate posture has a score of&nbsp;<strong>2&nbsp;</strong>in best motor response on the Glasgow Coma Scale.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/63c143f67fa748deb8cc8a100e1f6125.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08b33179f1d54b5e990b756216b4cda6x1280x1314.JPEG"
    ]
  }
];
        let quizName = 'Problems Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>