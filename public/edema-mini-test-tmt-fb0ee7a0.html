<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edema Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Choose the correct option with respect to the histopathological finding shown below.",
    "choices": [
      {
        "id": 1,
        "text": "Intracellular edema in stratum spinosum"
      },
      {
        "id": 2,
        "text": "Intercellular edema in stratum granulosum"
      },
      {
        "id": 3,
        "text": "Intracellular edema in stratum granulosum"
      },
      {
        "id": 4,
        "text": "Intercellular edema in stratum spinosum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above image shows <strong>intercellular</strong> <strong>edema</strong> involving the <strong>stratum spinosum</strong> which is suggestive of <strong>spongiosis.</strong>&nbsp;Spongiosis<strong>&nbsp;</strong>is the characteristic histopathological feature of&nbsp;<strong>a</strong><strong>cute eczema</strong>.&nbsp;</p>\n<p>In contrast, <strong>b</strong><strong>allooning degeneration</strong> is a term that refers to the<strong> intracellular</strong> <strong>edema</strong> occurring in the&nbsp;<strong>stratum</strong> <strong>spinosum</strong>. This results in <strong>acantholysis</strong>.&nbsp;Ballooning degeneration&nbsp;is often seen secondary to viral infections like <strong>herpes.</strong>&nbsp;</p>\n<p>The image below shows ballooning degeneration<strong>&nbsp;</strong>(intracellular edema is seen).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c45cb50917ce4bdb84aa77adf1b6bc8f.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/97e42554b10549c8961b8a0c1c0cb94ax800x533.JPEG"
    ]
  },
  {
    "text": "Herediatry angioneurotic edema is associated with deficiency of __________ .",
    "choices": [
      {
        "id": 1,
        "text": "C1 esterase Inhibitor"
      },
      {
        "id": 2,
        "text": "C3b and its regulatory protein"
      },
      {
        "id": 3,
        "text": "C9"
      },
      {
        "id": 4,
        "text": "C3b inactivator"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Deficiency of C1 esterase inhibitor</strong> is associated with <strong>hereditary angioneurotic edema.</strong></p>\n<p>Herediatry angioneurotic edema a condition characterised by <strong>episodic angioedema</strong> of the <strong>subcutaneous</strong> <strong>tissue</strong> or of <strong>mucosa</strong> <strong>of the respiratory or</strong> <strong>alimentary tracts.</strong></p>\n<p>Clinical syndromes associated with genetic deficiencies of complement components ---</p>\n<table style=\"width: 368px;\">\n<tbody>\n<tr>\n<td style=\"width: 144px;\">Deficiency</td>\n<td style=\"width: 216px;\">Syndrome</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\"><strong>C1 esterase inhibitor</strong></td>\n<td style=\"width: 216px;\"><strong>Herediatry angioneurotic edema</strong></td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">Early components of classical pathway C1, C2, C4</td>\n<td style=\"width: 216px;\">SLE and other collagen vascular diseases</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\"><strong>C3 and its regulatory protein</strong></td>\n<td style=\"width: 216px;\"><strong>Severe recurrent pyogenic infections</strong></td>\n</tr>\n<tr>\n<td style=\"width: 144px;\">C5 to C8</td>\n<td style=\"width: 216px;\">Bacterial(Meningococcal infection), mainly with gram negative diplococci, toxoplasmosis</td>\n</tr>\n<tr>\n<td style=\"width: 144px;\"><strong>C9</strong></td>\n<td style=\"width: 216px;\"><strong>No particular disease</strong></td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a cause of cerebral edema?",
    "choices": [
      {
        "id": 1,
        "text": "Lead intoxication"
      },
      {
        "id": 2,
        "text": "Hypernatremia"
      },
      {
        "id": 3,
        "text": "Liver failure"
      },
      {
        "id": 4,
        "text": "Rapid ascent into high altitude"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hypernatermia does not cause cerebral edema but hyponatremia causes it.</strong></p>\n<p><strong>Acute cerebral edema</strong> is generally seen in hyponatremia due to the following mechanism:</p>\n<p><strong>Acute hyponatremia</strong>-&gt;Increased interstitial pressure -&gt; Shunting of extracellular fluid (ECF) and solutes from interstitial space to CSF and then systemic circulation-&gt; Efflux of Na<sup>+</sup>, K<sup>+,</sup> and Cl<sup>-</sup> from brain cells -&gt; Rapid decrease in tonicity overwhelms regulatory mechanisms -&gt; Acute hyponatremic encephalopathy -&gt;\u00a0<strong>Acute cerebral edema.</strong></p>\n<ul>\n<li><strong>Lead and Cerebral Edema: </strong>Toxic effects of systemic <strong>lead</strong> exposure manifest in the CNS generally as <strong>acute encephalopathy in children</strong> and <strong>polyneuropathy in adults. </strong>Cerebral edema, especially of the white matter is most commonly seen in children with lead intoxication.</li>\n<li><strong>Liver Failure and Cerebral Edema: </strong><strong>Acute liver failure</strong> commonly causes <strong>brain edema, seizures, and agitation. </strong>Brain edema has been linked to <strong>persistent hyperammonemia</strong> in acute liver failure. Brain edema is one of the leading causes of mortality in acute liver failure.</li>\n<li><strong>High-Altitude Cerebral Edema (HACE): </strong>HACE is a condition in the spectrum of<strong> altitude-related neurologic disorders</strong> that occurs in rapid ascent. It is an <strong>encephalopathy</strong> that rapidly causes <strong>ataxia and altered consciousness</strong> with diffuse cerebral involvement but without focal neurological deficits.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Kumar presented with massive proteinuria and peripheral oedema. Which among the following conditions is the most likely diagnosis, based on the slide obtained after renal biopsy?",
    "choices": [
      {
        "id": 1,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 2,
        "text": "Minimal change disease"
      },
      {
        "id": 3,
        "text": "Membranous nephropathy"
      },
      {
        "id": 4,
        "text": "Kimmelstiel-Wilson disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The slide shows a <strong>normal glomerulus</strong> which rules out the other diagnosis. Hence, the most likely diagnosis is <strong>minimal change disease</strong> as it has a normal appearance on light microscopy.</p>\n<p>Minimal change disease shows <strong>effacement of podocyte foot processes</strong> on electron microscopy. This finding can also be seen in membranous nephropathy and focal segmental glomerulosclerosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bc124ad38803499786c99d07df888eb6.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e1e7ebc6869d46f0afd427582896d91fx720x687.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/959d7af4d055414a93609aabe667f0e1x1024x683.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2e5b58cf7ca34dc4a9f1ce3611202c6ax1280x465.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b53dbac5ee714a54b06b8593fb3bcca6x720x542.JPEG"
    ]
  },
  {
    "text": "Which of the following is not one of the mechanisms involved in the pathogenesis of edema?",
    "choices": [
      {
        "id": 1,
        "text": "Increased plasma colloid osmotic pressure"
      },
      {
        "id": 2,
        "text": "Increased intravascular hydrostatic pressure"
      },
      {
        "id": 3,
        "text": "Lymphatic obstruction"
      },
      {
        "id": 4,
        "text": "Increased vascular permeability"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Increased plasma colloid osmotic pressure </strong>is not one of the mechanisms in the pathogenesis of edema.\u00a0</p>\n<p><strong>Edema</strong> is the accumulation of tissue fluid in the <strong>extracellular space</strong>, resulting from hemodynamic changes in the body. Normally, the <strong>outward hydrostatic pressure</strong> in the blood vessels is <strong>balanced by</strong> the <strong>inward pull</strong> of the <strong>colloid osmotic pressure</strong> exerted by plasma proteins. Any remaining fluid in the interstitial space is usually <strong>drained by</strong> the <strong>lymphatics</strong> into the thoracic duct, and thereby, back into the bloodstream.\u00a0</p>\n<p>Edema results when there is an <strong>abnormality</strong> in any of these <strong>balancing forces.</strong> In <strong>heart failure</strong>, there is <strong>increased hydrostatic pressure</strong> in the venous system due to the inability of the heart to pump blood. This can result in edema which usually begins in the lower extremities.</p>\n<p>In<strong> liver disease</strong>, there is a failure to synthesize adequate amounts of plasma proteins. On the other hand, in <strong>nephrotic disease </strong>of the <strong>kidney,</strong> there is excessive excretion of plasma proteins. Both of these conditions can result in <strong>decreased plasma colloid osmotic pressure</strong>. This normally acts as an inward pull on fluid from the interstitial spaces into the blood vessels.</p>\n<p>Another mechanism of edema is in the setting of <strong>acute inflammation</strong> when there is <strong>increased vessel permeability</strong>, leading to fluid leaks into the interstitium.</p>\n<p><strong>Lymphatic obstruction</strong> due to <strong>infection or malignant infiltration</strong> can stop the normal tissue fluid drainage which results in fluid accumulation.</p>\n<p><strong>Renal failure</strong> is another cause of edema, which occurs due to the <strong>retention of sodium </strong>and <strong>water</strong> in large amounts, which ultimately increase the hydrostatic pressure within the vessels as mentioned above.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An ultrasound was done on a pregnant Rh-negative patient  to screen for hydrops fetalis. What is the earliest sign that may be seen on USG?",
    "choices": [
      {
        "id": 1,
        "text": "Scalp edema"
      },
      {
        "id": 2,
        "text": "Pleural effusion"
      },
      {
        "id": 3,
        "text": "Pericardial effusion"
      },
      {
        "id": 4,
        "text": "Ascites"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The earliest sign of hydrops fetalis on a USG is<strong> scalp edema</strong>. Subcutaneous scalp edema is also known as the <strong>Halo sign</strong>.\u00a0</p>\n<p>Other USG signs include:</p>\n<ul>\n<li>Ascites</li>\n<li>Pleural effusion\u00a0</li>\n<li>Pericardial effusion\u00a0</li>\n<li>Typical position termed as <strong>Buddha's position \u00a0</strong>\u00a0</li>\n</ul>\n<p>The image below shows skin thickening at the level of the fetal skull, on ultrasonography:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fb48b0e1582e4815a4737a94b88f5670x416x310.JPEG"
    ]
  },
  {
    "text": "Match the given conditions with the mechanism causing edema in them.",
    "choices": [
      {
        "id": 1,
        "text": "1- d, 2- d, 3- b, 4- a, 5- c"
      },
      {
        "id": 2,
        "text": "1- c, 2- d, 3- a, 4- b, 5- d"
      },
      {
        "id": 3,
        "text": "1- c, 2- d, 3- a, 4- b, 5- a"
      },
      {
        "id": 4,
        "text": "1- a, 2- d, 3- a, 4- b, 5- d"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correctly matched conditions and mechanisms causing edema are: <strong>1- c, 2- d, 3- a, 4- b, 5- d</strong></p>\n<table style=\"border-collapse: collapse; width: 49.3659%; height: 134.39px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 35.8385%; height: 22.3984px;\">Conditions</td>\n<td style=\"width: 64.1615%; height: 22.3984px;\">Mechanism</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 35.8385%; height: 22.3984px;\">1. Lymphatic blockage</td>\n<td style=\"width: 64.1615%; height: 22.3984px;\">c. Increase in interstitial oncotic pressure</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 35.8385%; height: 22.3984px;\">2. Nephrotic syndrome</td>\n<td style=\"width: 64.1615%; height: 22.3984px;\">d. Decrease in capillary osmotic pressure</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 35.8385%; height: 22.3984px;\">3. Heart failure</td>\n<td style=\"width: 64.1615%; height: 22.3984px;\">a. Increase in capillary pressure</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 35.8385%; height: 22.3984px;\">4. Infections</td>\n<td style=\"width: 64.1615%; height: 22.3984px;\">b. Increase in capillary permeability</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 35.8385%; height: 22.3984px;\">5. Liver failure</td>\n<td style=\"width: 64.1615%; height: 22.3984px;\">d. Decrease in plasma proteins</td>\n</tr>\n</tbody>\n</table>\n<p>Option 1: The lymphatic system returns small amounts of proteins and fluid that leak into the interstitium back to circulation. In case of <strong>lymphatic blockage</strong>, these proteins and fluids cannot be cleared and instead accumulate in the interstitium. This fluid accumulation leads to edema. The accumulating proteins <strong>increase</strong> the <strong>interstitial colloidal osmotic pressure</strong> and draw more fluid into the interstitium.</p>\n<p>Options 2 and 5: In <strong>nephrotic syndrome</strong>, there is a <strong>loss of proteins</strong> in the urine while in <strong>liver cirrhosis</strong> there is<strong> failure of production</strong> of proteins. Both of these conditions result in <strong>decreased plasma proteins</strong>. Plasma proteins are responsible for the <strong>capillary colloidal osmotic pressure</strong> that causes the osmosis of fluid into the capillary. A decrease in the capillary oncotic pressure causes more fluid to move into the interstitium, causing edema.\u00a0</p>\n<p>Option 3: In <strong>heart failure</strong>, there is an inability of the heart to pump out the blood. This <strong>pump inefficiency</strong> causes back pressure and an increase in venous and capillary pressure. This <strong>increase</strong> in <strong>capillary hydrostatic pressure</strong> forces the fluid out of the capillary and causes edema.</p>\n<p>Option 4: <strong>Infections</strong> cause inflammation and <strong>membrane damage</strong>. This leads to<strong> increased capillary permeability </strong>and fluid leaks into the interstitium causing edema.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Cardiac edema and neuropathy are seen in which of the following vitamin deficiencies?",
    "choices": [
      {
        "id": 1,
        "text": "Biotin"
      },
      {
        "id": 2,
        "text": "Thiamine"
      },
      {
        "id": 3,
        "text": "Pyridoxine"
      },
      {
        "id": 4,
        "text": "Riboflavin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cardiac edema and neuropathy</strong> are associated with the<strong> deficiency of thiamine (vitamin B1)</strong>.\u00a0</p>\n<p>Early symptoms of thiamine deficiency include\u00a0<strong>peripheral neuropathy</strong>,<strong> irritability</strong>,<strong>\u00a0loss of deep tendon reflexes</strong>,\u00a0and\u00a0<strong>proprioception</strong>.\u00a0As the disease progresses, increased intracranial pressure, meningismus, and coma develop.</p>\n<p><strong>Wet beriberi (cardiac)</strong> is associated with tachycardia, cardiomegaly, cardiac failure, and edema. It is commonly seen in the\u00a0<strong>refugee camps</strong>\u00a0where people consume\u00a0<strong>polished rice\u00a0</strong>based monotonous diets. Diagnosis of thiamine deficiency can be established by\u00a0<strong>erythrocyte transketolase</strong>\u00a0activity assessment.</p>\n<p><strong>Dry beriberi</strong>\u00a0is associated with <strong>neurological</strong> deficits such as optic atrophy, ataxia, and irritability.</p>\n<p><strong>Complications</strong> include\u00a0lactic acidosis\u00a0and Wernicke encephalopathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A term baby is noted to have a diffuse edematous swelling on the scalp immediately after birth. He was delivered by normal vaginal delivery with vertex presentation. The most likely site of the swelling noted in this baby would be:",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given scenario, the baby has developed a\u00a0<strong>diffuse edematous swelling</strong> on the scalp <strong>immediately after birth</strong> suggestive of <strong>caput succedaneum.</strong>\u00a0The most likely site of this swelling is represented by the structure marked as<strong> 1</strong> in the image.</p>\n<p>1- <strong>Caput succedaneum</strong> is a <strong>diffuse </strong><strong>edematous collection</strong> in the <strong>soft tissues</strong> of the scalp with <strong>vertex</strong> <strong>presentation</strong>. It can extend across skull sutures and disappears within the first week of life.</p>\n<p>2-\u00a0<strong>Cephalohematoma</strong> is a subperiosteal hemorrhage. It occurs following <strong>instrumental delivery</strong> which results in rupture of emissary veins of the skull. It<strong> does not cross suture lines.</strong>\u00a0The\u00a0swelling appears only\u00a0<strong>several hours after birth.</strong>\u00a0They are\u00a0resorbed within<strong> two weeks</strong> to<strong> 3 months,</strong>\u00a0depending on their size.</p>\n<p>3- <strong>Subgaleal hemorrhage</strong> is a collection of <strong>blood</strong> under the <strong>aponeurosis</strong> of the scalp. It occurs as a result of <strong>ventouse deliveries</strong> due to tears of the <strong>emissary veins</strong> which connect to the dural venous sinuses. It can occur in hereditary coagulopathies and is associated with skull fractures.</p>\n<p>4- <strong>Epidural hemorrhage </strong>is usually <strong>traumatic</strong> in origin. These are associated with <strong>cephalo-pelvic disproportion</strong>, <strong>prolonged labor</strong>, <strong>breech, precipitous</strong> <strong>labors</strong>, or as a result of <strong>mechanical assistance in labor</strong>. Majority resolve with <strong>no intervention</strong>.</p>\n<p>The image given below shows various birth injuries to the head.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8fbb65c5464048a391e67fb55c9d982e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3417712db30f498780cd3e1a4d88fac0x1280x1035.2011291460833.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man presented with bilateral pedal edema. Urine examination showed proteinuria. Histopathology of the kidney was as shown below. It was found PAS positive. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Renal amyloidosis"
      },
      {
        "id": 2,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 3,
        "text": "Kimmelstiel-Wilson disease"
      },
      {
        "id": 4,
        "text": "Lupus nephritis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and histopathology image showing\u00a0<strong>acellular</strong> periodic acid Schiff <strong>(PAS)-positive nodules</strong>\u00a0are suggestive of <strong>Kimmelstiel\u2013Wilson disease. </strong>It\u00a0occurs in patients with\u00a0<strong>diabetic nephropathy</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e794348770904e638aee1a1178270a98.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8811a478c7604b15819986cc1373117ax1280x1131.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dc7fbd1fda6b4718ae1fe9fc97f0217cx1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/27d7028e8987415b822a650c43c99774x800x533.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1318a0826b7446218a0a279eabfe9febx1280x853.JPEG"
    ]
  },
  {
    "text": "A body of a 30-year-old man is retrieved from the local river and subjected to autopsy. His family accuses his friend of murdering him by pushing him into the river after making him unconscious by hitting his head with a wooden stick. Which autopsy finding will favor the family's accusation?",
    "choices": [
      {
        "id": 1,
        "text": "Edema aquosum"
      },
      {
        "id": 2,
        "text": "Hydrostatic lung"
      },
      {
        "id": 3,
        "text": "Emphysema aquosum"
      },
      {
        "id": 4,
        "text": "Diatoms in lungs only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The finding of <strong>edema aquosum</strong> in the autopsy will favor the family's accusation. Edema aquosum occurs when the victim is <strong>alive </strong>but <strong>unconscious</strong> at the time of the drowning. This is <strong>mere flooding of the lungs</strong> with the water <strong>without the formation of froth</strong> as respiratory efforts are absent.</p>\n<p>Autopsy findings\u00a0in\u00a0drowning:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Froth</strong> - The presence of copious amounts of fine, shaving-lather-like froth at the mouth and the nostrils is the most characteristic finding of antemortem drowning. It is caused by the vigorous agitation of the tracheal and bronchial mucous secretions, edema fluid, and alveolar surfactant during respiratory efforts.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cutis anserina</strong> - The contraction of the erector pilorum muscles causes puckering and a grainy appearance of the skin. This resembles goose skin; hence, it is called cutis anserina.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Washerwoman\u2019s hand</strong> - Maceration of the skin on the palms and soles gives a wrinkled, sodden, and bleached appearance due to submersion.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cadaveric spasm</strong> - Gravel, weed, soil, grass, etc. is firmly held in the clenched hands due to cadaveric spasm. This is a <strong>vital sign</strong> of <strong>antemortem drowning</strong>. The material also indicates the place of submersion.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Rigor mortis</strong> - This appears early in cases of a violent antemortem struggle.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Face - It is bloated and discolored, with cyanosis.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Eyes - Conjunctiva are suffused and pupils dilated.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Tongue - It may be swollen and protruded.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Antemortem injuries</strong> - These may be sustained by striking objects, such as rocks, during the fall into the water body. Examination for such injuries must be performed only after the body is dry.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Lungs</strong> - They appear <strong>voluminous</strong> and <strong>distended</strong> show ballooning. The cut section will exude copious amounts of frothy, bloodstained fluid.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Larynx, trachea, and bronchioles - The presence of sand, silt, and aquatic vegetation in the trachea and lower respiratory tract are characteristic findings of antemortem drowning.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Heart and blood vessels- <strong>Gettler test</strong> can be done to estimate the chloride content in the right and left sides of the heart to differentiate between freshwater and saltwater drowning.\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Diatom test</strong>- Diatoms are microscopic algae. Their presence in the organs, particularly in the <strong>bone marrow</strong>, is suggestive of <strong>antemortem drowning</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Stomach and small intestines- These organs may contain water in some cases. Water present in the small intestine is positive evidence of death by drowning.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Middle ear - The presence of water in the middle ear is highly suggestive of antemortem drowning.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Brain - It is congested, and edematous, with loss of gray-white junction.</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: <strong>Hydrostatic lung,</strong> is seen in postmortem drowning. When a dead body is thrown into the water, water passes into the lungs due to hydrostatic pressure.\u00a0</p>\n<p>Option C: <strong>Emphysema aquosum</strong> - This is seen in cases when the victim is alive and conscious. Overinflation of the lungs in drowning is known as emphysema aquosum. It is one of the most valuable <strong>positive</strong> signs of <strong>drowning.</strong> The edema fluid in the bronchi blocks the <strong>passive collapse</strong> that normally occurs at death. Hence, the lungs are held in the <strong>inspiratory position.</strong> The impression of the ribs on this overinflated lung leaves visible and palpable grooves on the lateral surface.\u00a0</p>\n<p>Option D: <strong>Diatom test-</strong> Diatoms are microscopic algae. Their presence in the organs, particularly in the <strong>bone marrow,</strong> is suggestive of <strong>antemortem</strong> drowning. In <strong>postmortem drowning,</strong> diatoms do not spread to distant organs because of the absence of circulation and are <strong>limited</strong> to the <strong>lungs.</strong></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old woman presents with hoarseness and a low-pitched voice. She is a singer and a known smoker. Her laryngoscopy findings are given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Reinke's edema"
      },
      {
        "id": 2,
        "text": "Laryngeal papilloma"
      },
      {
        "id": 3,
        "text": "Vocal polyp"
      },
      {
        "id": 4,
        "text": "Vocal nodules"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The laryngoscopy findings show <strong>diffuse bilateral edema</strong> of the vocal folds suggestive of <strong>Reinke's edema.</strong></p>\n<p>It occurs due to edema of the subepithelial space (<strong>Reinke\u2019s space</strong>) of the vocal cords\u00a0in the<strong> glottis</strong>.</p>\n<p><strong>Key clinical features</strong></p>\n<ul>\n<li>History of <strong>smoking</strong> and/or voice abuse.</li>\n<li><strong>Hoarseness</strong> is the most common symptom.</li>\n<li>Patients use false cords for voice production and this gives them a <strong>low-pitched</strong> and rough voice.</li>\n</ul>\n<p>On indirect laryngoscopy, both vocal cords show diffuse symmetrical swellings. They appear as fusiform swellings with a pale translucent look. Ventricular bands may appear hyperemic and hypertrophic and may hide the view of the true cords.</p>\n<p><strong>Treatment</strong></p>\n<ul>\n<li>Voice rest and cessation of smoking</li>\n<li>Decortication of the vocal cords, i.e. removal of a strip of epithelium</li>\n<li>Speech therapy for proper voice production.</li>\n</ul>\n<p>Other options</p>\n<p>Option B: <strong>Laryngeal papilloma/ squamous papilloma</strong> are <strong>benign tumors</strong> of the larynx caused by the human papillomavirus (<strong>HPV type 6 and 11</strong>). They occur in children (<strong>juvenile papillomatosi</strong>s) as well as adults.\u00a0Patients present with hoarseness, dyspnea or stridor.</p>\n<p>Laryngoscopy shows pinkish to white \u201c<strong>grape-like</strong>\u201d projections that can be sessile or pedunculate with a visible central vascular core.\u00a0</p>\n<p>The image below shows laryngeal papilloma.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da302df4f4ab41928c8b2739273fb052.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/33a0ca51918c422a8ac174c58204c36cx512x422.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2c7edadc331644ceb6249ab5cc7fd429x507x258.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3581adddfd984e86b17bc92a97d0b573x512x380.PNG"
    ]
  },
  {
    "text": "A young female presents with sudden onset severe pain in the left eye after watching a movie. She rushes to the hospital as there is a progressive loss of vision. She has ciliary injection and a shallow anterior chamber. The pupil is semi dilated and the cornea appears oedematous. What is the procedure of choice for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Laser iridotomy"
      },
      {
        "id": 2,
        "text": "Trabeculectomy"
      },
      {
        "id": 3,
        "text": "Trabeculotomy"
      },
      {
        "id": 4,
        "text": "Trabeculoplasty"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of <strong>sudden onset severe pain</strong> in the eye,\u00a0<strong>progressive loss</strong> of vision,\u00a0<strong>shallow anterior chamber,</strong> semi-dilated pupil, and <strong>edematous cornea</strong> is suggestive of <strong>acute\u00a0angle-closure glaucoma.\u00a0</strong><strong>Laser iridotomy </strong>is the procedure of choice especially in emergency situations.\u00a0</p>\n<p>The attack may have been precipitated by <strong>pupillary dilation</strong>, which may result from activities such as going to a\u00a0movie theater. Laser iridotomy re-establishes the\u00a0communication between the posterior and anterior chamber, bypassing the pupillary block;\u00a0hence, it immediately relieves crowding of the angle.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which vitamin, when infused in supraphysiological doses, causes macular edema and macular cysts?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin A"
      },
      {
        "id": 2,
        "text": "Vitamin D"
      },
      {
        "id": 3,
        "text": "Vitamin E"
      },
      {
        "id": 4,
        "text": "Vitamin B3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Macular cysts</strong> and <strong>edema</strong> may develop in patients due to the infusion of <strong>supraphysiological doses</strong> of\u00a0<strong>vitamin B3 </strong>(niacin\u00a0toxicity).</p>\n<p>The<strong> toxic effects</strong> of niacin include:</p>\n<ul>\n<li><strong>Flushing</strong>\u00a0associated with skin dryness, itching, paresthesia, and headache is seen. These effects\u00a0may be seen with even a low dose of 30mg/day. <strong>Pre-medication</strong> with<strong> aspirin alleviates</strong> these symptoms as these symptoms are mediated by <strong>prostaglandins.</strong></li>\n<li><strong>Macular edema </strong>and <strong>macular cysts</strong></li>\n<li>Nausea, vomiting, and abdominal pain.</li>\n<li>Hepatic toxicity presents as jaundice with elevated AST and ALT levels.</li>\n<li>Fulminant hepatitis requiring liver transplantation.</li>\n<li>Glucose intolerance</li>\n<li>Hyperuricemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of papilledema?",
    "choices": [
      {
        "id": 1,
        "text": "Extracellular edema"
      },
      {
        "id": 2,
        "text": "Axonal swelling"
      },
      {
        "id": 3,
        "text": "Stasis of axoplasmic flow"
      },
      {
        "id": 4,
        "text": "Disruption of neurofilament"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Disruption</strong> <strong>of neurofilaments is not a feature</strong> <strong>of papilledema.</strong></p>\n<p>Papilledema is the\u00a0<strong>swelling of the optic nerve head</strong> secondary to <strong>raised intracranial pressure (ICP). </strong></p>\n<p>\"Disc swelling\" and \"disc edema\" are non-specific terms that include papilledema but also indicate a disc swollen from other causes.</p>\n<p>All patients with papilledema should be <strong>suspected</strong> of harboring an<strong> intracranial mass.</strong></p>\n<p><strong>Features of papilledema:</strong></p>\n<ul>\n<li>Raised ICP</li>\n<li><strong>Edema </strong>of the\u00a0optic nerve head\n<ul>\n<li>Blockage of axoplasmic flow</li>\n<li>Axonal swelling</li>\n<li>Collection of extracellular fluid</li>\n</ul>\n</li>\n<li><strong>Painless progressive</strong> loss of vision</li>\n<li><strong>Enlargement </strong>of<strong>\u00a0</strong>the <strong>blind\u00a0spot</strong></li>\n<li>Color vision, visual acuity, and pupillary reaction are\u00a0<strong>n</strong><strong>ormal</strong>, until optic atrophy sets in.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An adult presents with massive proteinuria, edema, and hematuria. The biopsy image is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Rapidly progressive glomerulonephritis (RPGN) type I"
      },
      {
        "id": 2,
        "text": "Membranous nephropathy"
      },
      {
        "id": 3,
        "text": "Goodpasture's syndrome"
      },
      {
        "id": 4,
        "text": "Minimal change disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient's clinical features and biopsy image showing uniform, <strong>diffuse thickening of the glomerular capillary wall</strong> are suggestive of<strong> membranous glomerulonephritis.</strong></p>\n<div class=\"page\" title=\"Page 914\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Membranous nephropathy is a <strong>chronic immune complex\u2013mediated</strong>\u00a0disease\u00a0characterized by diffuse thickening of the glomerular capillary wall due to the accumulation of deposits containing Ig. Immunofluorescence microscopy demonstrates that the <strong>granular deposits</strong> contain both immunoglobulins and complement.</p>\n<p>It will present as <strong>nephrotic syndrome\u00a0</strong>with massive proteinuria, generalized edema, hyperlipidemia, and lipiduria.\u00a0Most of the cases are primary. Some of the secondary causes include</p>\n<ul>\n<li>Drugs (penicillamine, captopril, NSAIDs, gold),</li>\n<li>Malignant tumors- Lung, colon, and melanoma</li>\n<li>SLE</li>\n<li>Infections -Chronic Hep B, Hep C, syphilis</li>\n<li>Autoimmune disorders.\u00a0</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>In<strong> RPGN Type I</strong> and <strong>Goodpasture syndrome</strong>, a characteristic <strong>linear pattern</strong> is observed on immunofluorescence which is a classic anti-GBM disease.\u00a0<strong>Minimal Change disease</strong>\u00a0has <strong>negative\u00a0</strong>immunofluorescence.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6083f5e262114792ab17f9a06d3ec64c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Peripheral edema seen with the use of calcium channel blockers is primarily due to which of the following mechanisms?",
    "choices": [
      {
        "id": 1,
        "text": "Reduced glomerular filtration rate and renal blood flow"
      },
      {
        "id": 2,
        "text": "Increased hydrostatic pressure in the capillaries of lower extremeties"
      },
      {
        "id": 3,
        "text": "Decreased oncotic pressure due to loss of plasma proteins in urine"
      },
      {
        "id": 4,
        "text": "Precapillary constriction and post capillary dilation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Calcium channel blockers induced <strong>peripheral edema</strong> is most likely due to<strong> increased hydrostatic pressure</strong> <strong>in the capillaries of the lower extremities.</strong></p>\n<p>The increased hydrostatic pressure occurs due to<strong> precapillary dilation</strong> and <strong>reflex\u00a0postcapillary constriction.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman presents with complaints of dysphagia. She also says that her hands and feet turn cold and blue when she goes to visit her daughter who lives in a hill station. Her examination findings are as given in the image. What is the earliest cutaneous manifestation that can be seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Reduced hair growth"
      },
      {
        "id": 2,
        "text": "Reduced sweating"
      },
      {
        "id": 3,
        "text": "Thickening of skin"
      },
      {
        "id": 4,
        "text": "Non-pitting edema"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>systemic sclerosis</strong>.\u00a0The earliest cutaneous manifestations in systemic sclerosis are<strong> non-pitting edema and puffiness</strong> <strong>of the fingers, hands, and face.\u00a0</strong></p>\n<p>The image shows a woman with <strong>mask-like facies</strong> with stretched, shiny skin, and loss of normal facial lines, <strong>microstomia,</strong>\u00a0and resorption of distal phalanges of the fingers. The clinical history describes Raynaud's phenomenon (hands and feet turn cold and blue in cold climate) and hence, the probable diagnosis is systemic sclerosis.</p>\n<p><strong>Systemic sclerosis</strong> is an autoimmune rheumatic disease in which there is a <strong>4: 1 female predominance</strong>.</p>\n<p>Cutaneous features:</p>\n<ul>\n<li>Hands and feet - <strong>Raynaud's phenomenon</strong>, non-pitting edema, painful ulcerations which heal with<strong> pitted scars,</strong> sclerodactyly, contractures,<strong> loss of sweat glands</strong>, bone resorption.</li>\n<li>Face - periorbital edema, <strong>mask-like facies</strong>, telangiectasia, and <strong>diffuse hyperpigmentation.</strong></li>\n<li>Trunk - firm, shiny, and thickened skin.</li>\n<li><strong>Reduced hair growth</strong> is seen.</li>\n</ul>\n<p>Systemic features:</p>\n<ul>\n<li>GIT- <strong>dysphagia</strong>, GERD, diminished peristalsis, malabsorption</li>\n<li>Lungs- pulmonary fibrosis and alveolitis</li>\n<li>Heart- cardiac conduction defects, heart failure</li>\n<li>Kidney- uremia, malignant hypertension</li>\n<li>Musculoskeletal- weakness, carpal tunnel syndrome.</li>\n</ul>\n<p>Using\u00a0<strong>modified Rodnan skin score</strong>\u00a0<strong>(MRSS</strong>). the\u00a0<strong>degree of skin sclerosis is scored from 0 to 3</strong>\u00a0by manual palpation at\u00a0<strong>17</strong>\u00a0different body sites. The\u00a0<strong>maximum score</strong>\u00a0that can be attained is\u00a0<strong>51</strong>. This method has been shown to correlate with skin biopsy thickness, disease severity, and long\u2010term outcome of the disease.</p>\n<p>The scoring of each skin region is determined by\u00a0<strong>skin thickness and tethering</strong>:<br />0 = Normal<br />1 = Possible thickening<br />2 = Unable to pinch the skin<br />3 = Unable to move the skin (which is fixed to deeper tissues)</p>\n<p>This modified score does not include the assessment of the neck and back. If these areas are included, the maximum attainable score increases to 57.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3f2da3fded314623b678615432dba9d3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A  post-cataract surgery patient came with complaints of blurring of vision for the past 2 weeks. His cataract surgery was done 3 months back. His optical coherence tomography (OCT) image is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cystoid macular edema"
      },
      {
        "id": 2,
        "text": "Macular hole"
      },
      {
        "id": 3,
        "text": "Central serous retinopathy"
      },
      {
        "id": 4,
        "text": "Senile macular degeneration"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of a\u00a0<strong>post-cataract surgery</strong> patient presenting with a blurring of vision and an\u00a0OCT image showing <strong>intraretinal cystoid spaces</strong>\u00a0is suggestive of\u00a0<strong>cystoid macular edema</strong> (CME).</p>\n<p>Common causes of CME include previous <strong>cataract surgery</strong>, uveitis, central retinal vein occlusions, <strong>diabetic retinopathy</strong>, retinitis pigmentosa, and retinopathy of prematurity, and topical <strong>prostaglandins</strong>. Cystoid macular edema in post-cataract surgery patients is termed as <strong>Irvine-Gass</strong> syndrome.\u00a0</p>\n<p>In CME, OCT shows foveal depression, <strong>intraretinal cystoid spaces</strong>, and retinal thickening.</p>\n<p>CME occurs due to a break in the <strong>inner and outer blood-retinal barrier</strong>. Due to retinal vessel leak fluid or exudate comes out and forms cystic space in the central retina. Mostly it gets <strong>accumulated</strong> in the <strong>outer plexiform</strong> (Henle's layer) and <strong>inner nuclear layers</strong> of the retina.\u00a0</p>\n<p>On fundoscopy, the multiple cystoid oval spaces in CME appear as a\u00a0 <strong>\"honeycomb appearance\"</strong>.</p>\n<p>In Fundus fluorescein angiography fluid accumulation in outer plexiform, layer shows a characteristic\u00a0<strong>flower petal pattern</strong> (<strong>petaloid appearance</strong>) as shown below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/29c7e52da981464eba28abdeb9fc0f9f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/75f339fe6bc94e2eb96be8fd4804c332x204x136.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/07394bd891a14ccc920a99f2a2b06eb9x338x106.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1abc1b9b97c648928ab85cd932d22189x800x502.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6eb066eba435403f93d482edd84137b8x259x157.PNG"
    ]
  },
  {
    "text": "A 50-year-old diabetic man, presented with pain, redness and swelling of his left leg as shown in the image below.  Aspiration of the edema fluid revealed a high protein concentration. Which of the following is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Venous insufficiency"
      },
      {
        "id": 2,
        "text": "Cellulitis"
      },
      {
        "id": 3,
        "text": "Stasis dermatitis"
      },
      {
        "id": 4,
        "text": "Deep vein thrombosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario along with the image showing the affected lower limb with <strong>diffuse borders, erythema, and edema,</strong> are suggestive of <strong>cellulitis</strong>.</p>\n<p>Edema fluid showing a high protein concentration is also characteristic of cellulitis. It is typically lower in venous thrombosis.</p>\n<p><strong>Cellulitis</strong> is a <strong>painful</strong>, <strong>diffuse</strong> infection of the <strong>dermis</strong> and the <strong>subcutaneous tissue</strong>. It is characterized by <strong>poorly demarcated</strong> areas of marked edema, dilated superficial capillaries, and extravasation of red blood cells and inflammatory cells into the <strong>dermis</strong>.</p>\n<p>The image given below shows poorly demarcated areas of edema and erythema in cellulitis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/153cfd7b27804d7e86ef55cb39d4729d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98801793022b40ac98e2ebd7f011ff20x1280x960.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b312b8a6128c474d967676b4204e3af9x720x540.JPEG"
    ]
  }
];
        let quizName = 'Edema Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>