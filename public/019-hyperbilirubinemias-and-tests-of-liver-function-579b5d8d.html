<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>019 Hyperbilirubinemias And Tests Of Liver Function - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 4-month-old child was brought with a history of recurrent episodes of jaundice. Blood investigations were suggestive of hereditary spherocytosis.  Which of the following liver function test findings is likely to be seen here?",
    "choices": [
      {
        "id": 1,
        "text": "Direct bilirubin >50% of total bilirubin"
      },
      {
        "id": 2,
        "text": "Direct bilirubin >85% of total bilirubin"
      },
      {
        "id": 3,
        "text": "Direct bilirubin >15% of total bilirubin"
      },
      {
        "id": 4,
        "text": "Direct bilirubin <15% of total bilirubin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario describes <strong>recurrent</strong>&nbsp;<strong>hemolysis </strong>in a patient with hereditary spherocytosis leading to<strong> jaundice</strong>. In hemolytic conditions, only the unconjugated/ <strong>indirect bilirubin</strong> is<strong> raised</strong> and conjugated/<strong>direct bilirubin</strong> remains&nbsp;<strong>normal</strong> i.e. &lt;15% of total bilirubin.</p>\n<p><strong>Bilirubin</strong> is synthesized from heme which is <strong>released</strong> primarily from the <strong>breakdown of old RBCs</strong>. This bilirubin is in its&nbsp;<strong>unconjugated </strong>form.<strong>&nbsp;</strong>It&nbsp;enters the circulation and reaches the<strong> liver</strong>. It&nbsp;is converted to <strong>conjugated bilirubin</strong> which is then secreted into the <strong>biliary tree</strong>.</p>\n<p>Therefore, in a healthy person,&nbsp;<strong>most </strong>of the<strong> circulating bilirubin</strong> is unconjugated/<strong>indirect bilirubin</strong>. Hence, the normal liver function tests show indirect bilirubin <strong>&gt;85%</strong> and direct/conjugated bilirubin &lt;15% of the total bilirubin. The normal bilirubin values are as follows:</p>\n<ul>\n<li>Total bilirubin levels - 1 to 1.5 mg/dL</li>\n<li>Direct bilirubin - &lt;0.3 mg/dL</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 2-week-old baby presented with yellowish discoloration of the skin. Investigations revealed markedly elevated direct bilirubin levels. Which of the following conditions should be suspected in the newborn?",
    "choices": [
      {
        "id": 1,
        "text": "Biliary atresia"
      },
      {
        "id": 2,
        "text": "Physiological jaundice"
      },
      {
        "id": 3,
        "text": "Breast milk jaundice"
      },
      {
        "id": 4,
        "text": "Hemolytic disease of the newborn"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>raised direct bilirubin levels</strong> indicate <strong>conjugated hyperbilirubinemia</strong>. Among the given options, <strong>biliary atresia</strong> causes conjugated hyperbilirubinemia.</p>\n<p><strong>Biliary atresia</strong> is a disorder characterised by&nbsp;<strong>destruction</strong> or <strong>absence </strong>of<strong> bile ducts</strong> in a newborn. It leads to obstruction to the flow of bile thereby causing leaking of conjugated bilirubin into the circulation.</p>\n<p>Option B:<strong> Physiological jaundice</strong> of the newborn occurs due to&nbsp;<strong>immaturity</strong> of the newborn's<strong>&nbsp;liver.</strong>&nbsp; It is not able to conjugate the excess bilirubin produced after birth. It leads to <strong>unconjugated</strong> hyperbilirubinemia.</p>\n<p>Option C: <strong>Breast milk</strong>&nbsp;may contain certain <strong>factors </strong>that<strong> inhibit </strong>the<strong> conjugation</strong> of bilirubin leading to <strong>unconjugated</strong> hyperbilirubinemia.</p>\n<p>Option D: <strong>Hemolytic disease of the newborn</strong> causes&nbsp;excess production of bilirubin due to<strong> hemolysis</strong> leading to&nbsp;<strong>unconjugated</strong> hyperbilirubinemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Investigations performed in a patient with recurrent jaundice gave the following results. What is the possible cause of jaundice in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hemolytic anaemia"
      },
      {
        "id": 2,
        "text": "Gilbert syndrome"
      },
      {
        "id": 3,
        "text": "Criggler-Najjar syndrome"
      },
      {
        "id": 4,
        "text": "Dubin Johnson syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The presence of <strong>urinary bilirubin</strong>&nbsp;and increased total bilirubin indicates <strong>conjugated hyperbilirubinemia</strong>. Among the given options, <strong>Dubin Johnson syndrome</strong> causes conjugated hyperbilirubinemia.</p>\n<p>Only <strong>conjugated bilirubin</strong> can appear in the urine because it is <strong>water-soluble</strong> and filterable by the kidney. <strong>Unconjugated bilirubin</strong> is water-insoluble and <strong>bound to albumin</strong>, hence it cannot be filtered by the kidney.</p>\n<p><strong>Causes</strong> <strong>of</strong> <strong>unconjugated</strong> <strong>hyperbilirubinemia</strong>:</p>\n<ul>\n<li style=\"font-weight: 400;\">Increased bilirubin production-</li>\n<ul>\n<li style=\"font-weight: 400;\">Hemolytic anemias&nbsp;</li>\n<li style=\"font-weight: 400;\">Hematomas</li>\n</ul>\n<li style=\"font-weight: 400;\">Impaired bilirubin uptake and conjugation-</li>\n<ul>\n<li style=\"font-weight: 400;\">Gilbert syndrome</li>\n<li style=\"font-weight: 400;\">Crigler Najjar syndrome</li>\n<li style=\"font-weight: 400;\">Drugs - Probenecid, Rifampin</li>\n</ul>\n</ul>\n<p><strong>Causes</strong> <strong>of conjugated hyperbilirubinemia</strong>:</p>\n<ul>\n<li style=\"font-weight: 400;\">Hereditary cholestatic syndromes</li>\n<li style=\"font-weight: 400;\">Dubin Johnson syndrome</li>\n<li style=\"font-weight: 400;\">Rotor syndrome</li>\n<li style=\"font-weight: 400;\">Biliary obstruction</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a cause of unconjugated hyperbilirubinemia?",
    "choices": [
      {
        "id": 1,
        "text": "Probenecid"
      },
      {
        "id": 2,
        "text": "Amoxicillin-clavulanate"
      },
      {
        "id": 3,
        "text": "Acute hepatitis"
      },
      {
        "id": 4,
        "text": "Stone in the common bile duct"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Probenecid</strong> causes <strong>impaired hepatic uptake</strong> of bilirubin<strong>&nbsp;</strong>which leads to<strong>&nbsp;unconjugated hyperbilirubinemia.</strong></p>\n<p>Amoxicillin-clavulanate, acute hepatitis and stone in the common bile duct are causes that lead to mixed hyperbilirubinemia (both conjugated and unconjugated bilirubin elevated) or predominantly conjugated hyperbilirubinemias.</p>\n<p>Levels of conjugated and unconjugated bilirubin are useful in determining pre-hepatic causes of jaundice but are not useful in differentiating between intrahepatic and post-hepatic causes of jaundice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old woman presents with jaundice. She had been on OCPs for the past month. Her LFT and liver biopsy findings are given below. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gilbert syndrome"
      },
      {
        "id": 2,
        "text": "Crigler- Najjar syndrome"
      },
      {
        "id": 3,
        "text": "Rotor syndrome"
      },
      {
        "id": 4,
        "text": "Dubin Johnson syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>Dubin Johnson syndrome&nbsp;</strong>(DJS). The LFT describes <strong>conjugated hyperbilirubinemia</strong>&nbsp;with normal liver enzyme levels. The given image of microscopic examination of liver <strong>biopsy </strong>shows an accumulation of <strong>dark melanin-like pigment</strong> in the hepatocytes which is seen in this condition.</p>\n<p>DJS is an <strong>autosomal recessive</strong> condition causing <strong>defective expression </strong>of<strong> MRP 2 protein</strong>&nbsp;which is important for the biliary excretion of conjugated bilirubin. The&nbsp;patient has icterus but is otherwise asymptomatic.</p>\n<p>DJS also impairs biliary excretion of various compounds like <strong>epinephrine metabolites</strong>. The <strong>dark melanin-like pigment</strong> is derived from these metabolites causing the liver to appear black.</p>\n<p><strong>Rotor syndrome</strong> is also an autosomal recessive condition causing&nbsp;<strong>conjugated hyperbilirubinemia</strong> but it does not present with pigmentation of the liver.&nbsp;</p>\n<p><strong>Gilbert</strong> and <strong>Crigler-Najjar</strong> syndromes are characterized by <strong>unconjugated hyperbilirubinemia</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c71b91e8a4c54685a18d7692c7228b17.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the defect seen in patients with Rotor syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Absent UDP glucuronosyl transferase"
      },
      {
        "id": 2,
        "text": "Mutation in organic anion transport protein"
      },
      {
        "id": 3,
        "text": "Mutation in multidrug resistance\u2013associated protein 2"
      },
      {
        "id": 4,
        "text": "Reduced UDP glucuronosyl transferase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Rotor syndrome </strong>occurs due to<strong> mutation in OATP </strong>(organic anion transport protein)<strong> 1B1 </strong>and <strong>1B3.</strong></p>\n<p>Rotor syndrome is an inherited&nbsp;<strong>autosomal recessive&nbsp;</strong>disorder with <strong>conjugated hyperbilirubinemia</strong>. It is a benign disorder with mild elevation of bilirubin levels. It is similar to Dubin Johnson syndrome but the liver does not show any black pigmentation.&nbsp;<strong>No treatment</strong> is <strong>required</strong> for these patients.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While evaluating a patient with jaundice, all of the following investigations would help you to differentiate between Dubin Johnson syndrome and Rotor syndrome except:",
    "choices": [
      {
        "id": 1,
        "text": "Oral cholecystography"
      },
      {
        "id": 2,
        "text": "Total urinary coproporphyrin"
      },
      {
        "id": 3,
        "text": "Serum bilirubin levels"
      },
      {
        "id": 4,
        "text": "Bromsulphalein clearance test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Serum bilirubin levels are not helpful in differentiating between <strong>Dubin Johnson</strong> syndrome (DJS) and <strong>Rotor's</strong> syndrome as both these conditions present with <strong>mild elevation</strong> of <strong>serum bilirubin</strong>.</p>\n<p>These two conditions can be differentiated as follows:</p>\n<table style=\"height: 172px;\" width=\"904\">\n<tbody>\n<tr>\n<td style=\"width: 303.156px;\"><strong>Test</strong></td>\n<td style=\"width: 289.359px;\"><strong>Rotor Syndrome</strong></td>\n<td style=\"width: 289.484px;\"><strong>Dubin Johnson syndrome</strong></td>\n</tr>\n<tr>\n<td style=\"width: 303.156px;\">Oral cholecystography</td>\n<td style=\"width: 289.359px;\">Gall bladder is visualized</td>\n<td style=\"width: 289.484px;\">\n<p>Gall bladder not visualised&nbsp;</p>\n<p>Impaired ability to concentrate the contrast material into bile</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 303.156px;\">Total urinary coproporphyrin</td>\n<td style=\"width: 289.359px;\">Elevated</td>\n<td style=\"width: 289.484px;\">\n<p>Normal&nbsp;</p>\n<p>Increased excretion of coproporphyrin 1 and decreased excretion of coproporphyrin 3</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 303.156px;\">Bromsulphalein (BSP) clearance test</td>\n<td style=\"width: 289.359px;\">\n<p>Delayed clearance of BSP</p>\n<p>No reflux</p>\n</td>\n<td style=\"width: 289.484px;\">\n<p>Rise in plasma levels of BSP after 90 minutes of injection</p>\n<p>Reflux of BSP from hepatocytes&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with unconjugated hyperbilirubinemia, which feature helps confirm the diagnosis of Crigler- Najjar syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Presence of kernicterus"
      },
      {
        "id": 2,
        "text": "Absence of hemolysis"
      },
      {
        "id": 3,
        "text": "UGT1A1 mutation"
      },
      {
        "id": 4,
        "text": "Autosomal recessive inheritance"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Kernicterus</strong>&nbsp;is seen in<strong> Crigler-Najjar syndrome</strong> but not in Gilbert syndrome. Gilbert syndrome does not cause a significant elevation in unconjugated bilirubin to cause kernicterus.</p>\n<p><strong>Crigler-Najjar</strong> syndrome and <strong>Gilbert</strong> syndrome are both caused by various<strong> mutations </strong>in the <strong>UGT1A1 gene</strong>. This leads to <strong>decreased activity</strong> of bilirubin <strong>UDP-glucuronosyltransferase</strong> enzyme leading to <strong>unconjugated hyperbilirubinemia</strong>. Both are predominantly inherited in an <strong>autosomal</strong> <strong>recessive</strong> pattern.&nbsp;</p>\n<p>These syndromes present with <strong>jaundice </strong>in<strong> infants</strong>. The unconjugated hyperbilirubinemia in these syndromes is not associated with any hemolysis. All the other liver function tests are usually normal.</p>\n<p><strong>Crigler Najjar</strong> syndrome may lead to kernicterus causing severe brain damage. <strong>Liver transplantation</strong> is required without which the infant may not survive beyond 1-2 years of age. Whereas,&nbsp;<strong>Gilbert</strong> syndrome is a benign <strong>asymptomatic</strong> condition that does not need any intervention.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant presented with yellow discolouration of the skin, poor feeding, and seizures. Investigations revealed total bilirubin- 40 mg/dL and unconjugated bilirubin- 34 mg/dL. Phenobarbitone was administered while blood was being arranged for an exchange transfusion. However, there was no improvement. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gilbert syndrome"
      },
      {
        "id": 2,
        "text": "Crigler-Najjar syndrome type 1"
      },
      {
        "id": 3,
        "text": "Crigler-Najjar syndrome type 2"
      },
      {
        "id": 4,
        "text": "Rotor syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The normal serum bilirubin (between 1 and 1.5 mg/dL) present in serum represents a balance between input from the production of bilirubin and hepatic/biliary removal of the pigment.</p>\n<p>Isolated elevation of the bilirubin:</p>\n<ul>\n<li>Conjugated hyperbilirubinemia- &gt;15% conjugated bilirubin</li>\n<li>Unconjugated hyperbilirubinemia- &lt;15% conjugated bilirubin</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child presents with jaundice and easy fatiguability. He had a history of ear infection which was treated with amoxicillin-clavulanic acid. Investigations done are shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Drug induced hepatitis"
      },
      {
        "id": 2,
        "text": "Hemolytic jaundice"
      },
      {
        "id": 3,
        "text": "Obstructive jaundice"
      },
      {
        "id": 4,
        "text": "Gilbert syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>hemolytic jaundice</strong>. It can present with the following features:</p>\n<ul>\n<li><strong>Low hemoglobin</strong></li>\n<li><strong>Unconjugated hyperbilirubinemia</strong></li>\n<li>Pigment <strong>gall stones</strong> - excess bilirubin in bile&nbsp;</li>\n<li>Development of cholestasis when the gall stones obstruct the flow of bile. This would result in the elevation of conjugated bilirubin and LFTs show a cholestatic picture.</li>\n</ul>\n<p>Hepatic and obstructive causes of jaundice are not likely as the other liver function tests are normal. The various causes of jaundice can be differentiated as follows:</p>\n<table style=\"width: 651px; height: 313px;\">\n<tbody>\n<tr>\n<td style=\"width: 128.688px;\">&nbsp;<strong>Jaundice</strong></td>\n<td style=\"width: 138.156px; text-align: center;\"><strong>Pre hepatic</strong></td>\n<td style=\"width: 173.359px; text-align: center;\"><strong>Hepatic</strong></td>\n<td style=\"width: 182.797px; text-align: center;\"><strong>Post hepatic</strong></td>\n</tr>\n<tr>\n<td style=\"width: 128.688px;\"><strong>Cause</strong></td>\n<td style=\"width: 138.156px;\">\n<p>Excessive amount of bilirubin is presented to the liver</p>\n</td>\n<td style=\"width: 173.359px;\">\n<p>Impaired cellular uptake/ defective conjugation/ defective secretion of bilirubin</p>\n</td>\n<td style=\"width: 182.797px;\">Defective excretion due to mechanical obstruction to the flow of bile</td>\n</tr>\n<tr>\n<td style=\"width: 128.688px;\"><strong>LFT</strong></td>\n<td style=\"width: 138.156px;\">Elevated unconjugated bilirubin</td>\n<td style=\"width: 173.359px;\">\n<p>Elevated conjugated and unconjugated bilirubin</p>\n<p>Marked elevated levels of AST and ALT (&gt;1000U/L)</p>\n</td>\n<td style=\"width: 182.797px;\">\n<p>Elevated conjugated bilirubin</p>\n<p>Elevated levels of ALP and GGT</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 128.688px;\"><strong>Example</strong></td>\n<td style=\"width: 138.156px;\">Hemolytic anaemia</td>\n<td style=\"width: 173.359px;\">Hepatitis</td>\n<td style=\"width: 182.797px;\">Choledocholithiasis</td>\n</tr>\n</tbody>\n</table>\n<p>Inherited hyperbilirubinemias like <strong>Gilbert syndrome</strong> are suspected when there is <strong>no associated hemolysis</strong>. It is unlikely&nbsp;in this patient because there are clear hemolytic features.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is associated with increased activity of 5\u2019- nucleotidase?",
    "choices": [
      {
        "id": 1,
        "text": "Bone diseases"
      },
      {
        "id": 2,
        "text": "Prostate cancer"
      },
      {
        "id": 3,
        "text": "Chronic renal failure"
      },
      {
        "id": 4,
        "text": "Cholestatic disorders"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>5\u0374-nucleotidase</strong> is usually <strong>elevated</strong> in <strong>cholestasis</strong>.</p>\n<p>Enzymes elevated in cholestasis are :</p>\n<ul>\n<li>Alkaline phosphatase (ALP)</li>\n<li>5\u0374-nucleotidase</li>\n<li>&gamma;-glutamyl transpeptidase (GGT)</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the most specific indicator of liver cell injury?",
    "choices": [
      {
        "id": 1,
        "text": "Alkaline phosphatase"
      },
      {
        "id": 2,
        "text": "Gamma glutamyl transpeptidase"
      },
      {
        "id": 3,
        "text": "Alanine aminotransferase"
      },
      {
        "id": 4,
        "text": "Aspartate aminotransferase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the given options,<strong> alanine aminotransferase</strong> is the <strong>most specific</strong> indicator of liver cell injury.</p>\n<p>Alanine aminotransferase (ALT) and aspartate aminotransferase (AST) are indicators of liver cell injury. This is because ALT is found primarily in the liver, whereas, AST is found in the liver, cardiac muscle, skeletal muscle, kidneys, brain, pancreas, etc.</p>\n<p class=\"p1\"><strong>GGT</strong> and <strong>ALP</strong> are enzymes that primarily reflect <strong>cholestasis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with acute viral hepatitis, what level of serum transaminases will you expect?",
    "choices": [
      {
        "id": 1,
        "text": "10-40 IU/L"
      },
      {
        "id": 2,
        "text": "<500 IU/L"
      },
      {
        "id": 3,
        "text": "40-300 IU/L"
      },
      {
        "id": 4,
        "text": ">1000 IU/L"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In a patient with <strong>acute viral hepatitis</strong>, serum<strong> transaminases</strong> are elevated to <strong>&gt;1000 IU/L</strong></p>\n<p>The <strong>normal</strong> levels of serum transaminases are <strong>10-40 IU/L</strong>.&nbsp;Marked elevation of serum transaminases&nbsp;&gt;1000 IU/L is seen in conditions with extensive hepatocellular injury. These include:</p>\n<ul>\n<li>Viral hepatitis</li>\n<li>Ischemic injury to the liver in conditions like acute heart failure</li>\n<li>Toxin/drug-induced liver injury</li>\n</ul>\n<p>Minor elevations of serum transaminase levels up to 300 IU/L are non-specific and can be found in any liver disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 64-year-old man with jaundice and abdominal pain was found to have an ALP level of 200 mg/dL. His LFT reports from a month ago had shown an ALP level of 50 mg/dL. What is your inference?",
    "choices": [
      {
        "id": 1,
        "text": "Normal finding for age"
      },
      {
        "id": 2,
        "text": "Could be due to fatty meal intake"
      },
      {
        "id": 3,
        "text": "Indicative of hemolysis"
      },
      {
        "id": 4,
        "text": "Suggestive of cholestatic liver disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A <strong>4 fold rise </strong>of<strong> serum ALP</strong> (alkaline phosphatase)&nbsp;is suggestive of <strong>cholestatic liver disease</strong>. However, serum ALP levels cannot differentiate between extrahepatic and intrahepatic cholestasis.&nbsp;</p>\n<p>The <strong>normal range</strong> for serum ALP is considered <strong>40-125 IU/L</strong>.&nbsp;Serum alkaline phosphatase is found in the liver, bone, small intestines, and placenta. Hence, a <strong>mild increase</strong> in ALP, i.e., 1 - 1.5 times normal, can be seen in these conditions:</p>\n<ul>\n<li>Following a<strong> fatty meal intake&nbsp;</strong>- influx of intestinal alkaline phosphatase into the blood. Hence, the patient is advised to fast before the blood sample is collected for the test.</li>\n<li>In <strong>pregnancy</strong> - placental ALP</li>\n<li>In <strong>children</strong> - rapid bone growth</li>\n<li>In elderly people <strong>over 60 years</strong> of age</li>\n</ul>\n<p>ALP can be raised even in conditions like metastatic bone disease, inflammatory bowel disease, Hodgkin's lymphoma, etc. Hence, it needs to be correlated with raised levels of <strong>gamma-glutamyltransferase</strong> (GGT) and <strong>5' nucleotidase</strong> which are <strong>more specific for liver</strong> disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding liver enzymes is true?",
    "choices": [
      {
        "id": 1,
        "text": "ALT is raised to >1000 IU/L in cirrhosis"
      },
      {
        "id": 2,
        "text": "Absolute levels of aminotransferases correlate with the prognosis"
      },
      {
        "id": 3,
        "text": "AST:ALT ratio <1 is seen in nonalcoholic fatty liver disease"
      },
      {
        "id": 4,
        "text": "AST:ALT ratio >1 is seen in chronic viral hepatitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>AST:ALT ratio &lt;1</strong> is seen in <strong>NAFLD</strong> (nonalcoholic fatty liver disease).</p>\n<p>The AST:ALT ratio can be interpreted as follows:</p>\n<table style=\"width: 345px;\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 71px;\"><strong>AST:ALT</strong></td>\n<td style=\"text-align: center; width: 258px;\"><strong>Condition</strong></td>\n</tr>\n<tr>\n<td style=\"width: 71px;\">&lt;1</td>\n<td style=\"width: 258px;\">Chronic viral hepatitis, Nonalcoholic fatty liver disease</td>\n</tr>\n<tr>\n<td style=\"width: 71px;\">&gt;1</td>\n<td style=\"width: 258px;\">Cirrhosis</td>\n</tr>\n<tr>\n<td style=\"width: 71px;\">&gt;2:1</td>\n<td style=\"width: 258px;\">\n<p>Suggestive of alcoholic liver disease</p>\n<p>Alcohol intake is associated with the&nbsp;deficiency of pyridoxal phosphate which in turn leads to decreased levels of ALT enzyme. So, AST&gt;ALT.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 71px;\">&gt;3:1</td>\n<td style=\"width: 258px;\">Highly suggestive of alcoholic liver disease.</td>\n</tr>\n</tbody>\n</table>\n<p>Option A: Patients with <strong>cirrhosis</strong> have only <strong>mildly elevated</strong> or even normal levels of serum <strong>transaminases</strong>.</p>\n<p>Option B: <strong>Absolute levels</strong> of <strong>aminotransferases</strong> are not used for predicting prognosis. This is because there is a <strong>poor correlation</strong> between the <strong>degree of liver cell damage</strong> and the levels of aminotransferases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Liver function tests of a patient show isolated elevation of gamma-glutamyltransferase with other liver enzymes within normal limits. All of the following drugs could be responsible for this finding except:",
    "choices": [
      {
        "id": 1,
        "text": "Barbiturates"
      },
      {
        "id": 2,
        "text": "Griseofulvin"
      },
      {
        "id": 3,
        "text": "Penicillin"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Among the given options, penicillin does not lead to elevated gamma-glutamyltransferase&nbsp;(GGT) levels.&nbsp;</p>\n<p><strong>GGT</strong> is a <strong>microsomal enzyme</strong>. Hence, drugs that are microsomal <strong>enzyme</strong> <strong>inducers</strong> can lead to an <strong>increase</strong> in GGT levels. However, other liver enzyme levels will be normal. Therefore, an isolated rise in GGT level does not indicate cholestatic liver disease.</p>\n<p><strong>Drugs that increase levels of GGT</strong> are:</p>\n<ul>\n<li><strong>Barbiturates</strong></li>\n<li>Carbamazepine</li>\n<li>Ethanol</li>\n<li><strong>Griseofulvin</strong></li>\n<li>Rifampicin</li>\n<li><strong>Phenytoin</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding prothrombin time is false?",
    "choices": [
      {
        "id": 1,
        "text": "Indicates prognosis in acute liver disease"
      },
      {
        "id": 2,
        "text": "Indicates prognosis in chronic liver disease"
      },
      {
        "id": 3,
        "text": "Measures factors II, V, VIII, X"
      },
      {
        "id": 4,
        "text": "Measures factors II, V, VII, X"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Prothrombin time </strong>(PT) can help in estimating the levels of&nbsp;<strong>factors&nbsp;II, V, VII, and X</strong>.</p>\n<p>PT evaluates the <strong>extrinsic</strong> and the <strong>common</strong> <strong>pathway</strong> of coagulation. Factor VII is required in the extrinsic pathway and factors II, V, X are required in the common pathway.</p>\n<p><strong>Coagulation factors</strong> are <strong>produced</strong> <strong>by</strong> the <strong>liver</strong> (except factor VIII) and they have a short half-life. Hence, they <strong>indicate</strong> the <strong>synthetic function</strong> of the liver and are very useful in assessing acute hepatic dysfunction.&nbsp;Factor VIII is produced by vascular endothelial cells.</p>\n<p><strong>Prolonged</strong> <strong>PT</strong> that is not corrected by vitamin K administration indicates <strong>poor prognosis</strong> in both acute and chronic liver disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is a marker of chronic liver disease?",
    "choices": [
      {
        "id": 1,
        "text": "Prothrombin"
      },
      {
        "id": 2,
        "text": "Albumin"
      },
      {
        "id": 3,
        "text": "5'- nucleosidase"
      },
      {
        "id": 4,
        "text": "Alkaline phosphatase (ALP)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Serum albumin</strong> is a marker of <strong>chronic liver disease</strong> because it is synthesized by the hepatocytes and has a <strong>long half-life</strong> of 18&ndash;20 days.&nbsp;Serum albumin is not a good indicator of acute or mild hepatic dysfunction.</p>\n<p><strong>Hypoalbuminemia</strong> is more common in chronic liver disorders such as cirrhosis and usually reflects <strong>severe liver damage</strong>.&nbsp;In hepatitis, albumin levels <strong>&lt;3 g/dL</strong> should raise the possibility of chronic liver disease.</p>\n<p><strong>Prothrombin time</strong> is used to assess <strong>acute</strong> parenchymal liver disease. <strong>5' nucleosidase</strong> is elevated in <strong>cholestasis</strong>.&nbsp;Elevation of <strong>ALP</strong> (&lt;3 fold) is <strong>not specific</strong> to liver diseases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can be seen in a patient with chronic liver disease?",
    "choices": [
      {
        "id": 1,
        "text": "Hypergammaglobulinemia"
      },
      {
        "id": 2,
        "text": "Hypogammaglobulinemia"
      },
      {
        "id": 3,
        "text": "Rise in beta globulin levels"
      },
      {
        "id": 4,
        "text": "Rise in alpha globulin levels"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Chronic liver disease</strong> is associated with&nbsp;<strong>hypergammaglobulinemia</strong>.&nbsp;Chronic liver diseases with hypergammaglobulinemia include autoimmune hepatitis, primary biliary cirrhosis, and alcoholic liver disease.</p>\n<p>The liver produces all globulins except gamma globulin<strong>&nbsp;</strong>which&nbsp;are produced by B cells. In <strong>chronic liver diseases</strong> like liver cirrhosis, there is&nbsp;<strong>impaired</strong> <strong>reticuloendothelial</strong> <strong>function</strong> in hepatic sinusoids. Hence the liver fails to clear the&nbsp;bacterial antigens. This causes an increased production of gamma globulin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a marker for liver fibrosis?",
    "choices": [
      {
        "id": 1,
        "text": "Procollagen peptide III (PIIINP)"
      },
      {
        "id": 2,
        "text": "Hyaluronic acid"
      },
      {
        "id": 3,
        "text": "Tissue inhibitor of metalloproteinase 1(TIMP1)"
      },
      {
        "id": 4,
        "text": "Telopeptide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Telopeptide</strong> is not a marker for liver fibrosis. It is a marker for <strong>bone resorption</strong>.</p>\n<p>Various <strong>non-invasive markers to detect hepatic fibrosis</strong> are given below:</p>\n<table style=\"height: 160px; width: 374px;\">\n<tbody>\n<tr>\n<td style=\"width: 130px; text-align: center;\"><strong>Non-invasive test for fibrosis&nbsp;</strong></td>\n<td style=\"width: 231px; text-align: center;\"><strong>Components tested</strong></td>\n</tr>\n<tr>\n<td style=\"width: 130px;\">&nbsp;Fibrotest/FibroSure</td>\n<td style=\"width: 231px;\">\n<ul>\n<li>&alpha;2-macroglobulin</li>\n<li>Haptoglobin</li>\n<li>Apolipoprotein A-1</li>\n<li>GGT</li>\n<li>Total bilirubin</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 130px;\">Enhanced Liver Fibrosis (ELF) assay</td>\n<td style=\"width: 231px;\">\n<ul>\n<li>Hyaluronic acid</li>\n<li><strong>Procollagen peptide III</strong> (PIIINP)</li>\n<li><strong>Tissue inhibitor of metalloproteinase</strong> (TIMP)</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 130px;\">Transient elastography (FibroScan)</td>\n<td style=\"width: 231px;\">\n<ul>\n<li>Ultrasound waves are used to measure liver stiffness</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 130px;\">Fibrospect II</td>\n<td style=\"width: 231px;\">\n<ul>\n<li><strong>Hyaluronic acid</strong></li>\n<li>Alpha 2 macroglobulin</li>\n<li>Tissue inhibitor of metalloproteinase 1 (TIMP 1)</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following patients planned for a liver biopsy, would you not be required to use the transjugular approach?",
    "choices": [
      {
        "id": 1,
        "text": "A patient with prolonged INR"
      },
      {
        "id": 2,
        "text": "A patient with significant ascites"
      },
      {
        "id": 3,
        "text": "A patient with splenomegaly"
      },
      {
        "id": 4,
        "text": "A morbidly obese patient"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Liver biopsy</strong> can be performed in a patient with <strong>splenomegaly</strong> via the <strong>percutaneous approach</strong>.</p>\n<p>When the percutaneous approach is not advisable, liver biopsy can be performed via the transjugular approach.<strong>&nbsp;</strong>In this approach,<strong>&nbsp;</strong>a cannula is inserted via the jugular vein which is then passed into hepatic veins through which the biopsy sample is taken. Therefore, any bleeding resulting from the procedure will drain into the hepatic veins.</p>\n<p><strong>Indications of transjugular liver biopsy:</strong></p>\n<ul>\n<li>Percutaneous approach contraindicated\n<ul>\n<li>Significant <strong>ascites</strong></li>\n<li><strong>Prolonged INR</strong></li>\n<li>Coagulopathies</li>\n</ul>\n</li>\n<li>Difficulty in accessing the liver via the percutaneous route\n<ul>\n<li>Morbid <strong>obesity</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '019 Hyperbilirubinemias And Tests Of Liver Function';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>