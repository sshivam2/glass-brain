<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>063 Microbiology Aiims 2019  (May & Nov) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A farmer from the sub-Himalayan belt had a thorn prick injury a year back and developed a warty, verrucous growth at the site of prick. A skin biopsy sample was taken and sent for histopathological examination. The characteristic microscopic body as shown in the image was seen. Which of the following could be the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Blastomycosis"
      },
      {
        "id": 2,
        "text": "Pheohyphomycosis"
      },
      {
        "id": 3,
        "text": "Chromoblastomycosis"
      },
      {
        "id": 4,
        "text": "Sporotrichosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The history of a slowly spreading <strong>warty, verrucous lesion</strong> following a thorn prick injury and the histopathological image showing <strong>medlar bodies</strong>\u00a0is suggestive of\u00a0<strong>chromoblastomycosis.</strong></p>\n<p>Chromoblastomycosis (chromomycosis) is a <strong>subcutaneous mycotic infection</strong> that is usually caused by <strong>traumatic inoculation.\u00a0</strong>Over months to years, the primary lesion becomes verrucous and wart-like with extension along the draining lymphatics.\u00a0</p>\n<p><strong>Histologically</strong>, the lesions are granulomatous and the <strong>dark sclerotic bodies</strong> may be seen within leukocytes or giant cells called <strong>medlar/copper penny bodies.</strong></p>\n<table style=\"height: 660px; width: 428.43px;\">\n<tbody>\n<tr>\n<td style=\"width: 170px;\">\n<div class=\"page\" title=\"Page 683\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Subcutaneous mycoses</strong></p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 241.43px;\"><strong>Causative agent/s</strong></td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<div class=\"page\" title=\"Page 685\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Sporotrichosis</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 241.43px;\">\n<ul>\n<li>Sporothrix\u00a0schenckii</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">Chromoblastomycosis</td>\n<td style=\"width: 241.43px;\">\n<div class=\"page\" title=\"Page 685\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Phialophora verrucosa</li>\n<li>Fonsecaea pedrosoi</li>\n<li>Fonsecaea compact</li>\n<li>Rhinocladiella aquaspersa</li>\n<li>Cladophialophora carrionii</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<div class=\"page\" title=\"Page 686\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Phaeohyphomycosis</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 241.43px;\">\n<ul>\n<li>Exophiala jeanselmei</li>\n<li>Phialophora richardsiae</li>\n<li>Bipolaris spicifera</li>\n<li>Wangiella dermatitidis</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170px;\">\n<div class=\"page\" title=\"Page 686\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 687\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Mycetoma</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 241.43px;\">\n<ul>\n<li>Pseudallescheria boydii (Anamorph Scedosporium apiospermum).</li>\n<li>Madurella mycetomatis</li>\n<li>Madurella grisea</li>\n<li>E jeanselmei</li>\n<li>Acremonium falciforme</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/090c65be15b64cd189d9a06e8fc8e081.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the wrong statement about Plasmodium species:",
    "choices": [
      {
        "id": 1,
        "text": "Drug resistant falciparum is seen in India"
      },
      {
        "id": 2,
        "text": "Presence of duffy blood group antigen is protective against vivax"
      },
      {
        "id": 3,
        "text": "Severe malaria with shock  is called algid malaria"
      },
      {
        "id": 4,
        "text": "Relapse is seen in P. ovale"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>absence</strong>, not the presence,<strong> of the Duffy blood group antigen, is protective against <em>P. vivax</em></strong> because the Duffy antigen normally serves as the receptor for Plasmodium vivax.&nbsp;</p>\n<p>&nbsp;</p>\n<p><strong>Drug Efflux pumps are the&nbsp;primary&nbsp;mode of&nbsp;resistance for&nbsp;Chloroquine</strong>.&nbsp;It is mediated by an ABC transporter encoded by <em>P. falciparum</em> multidrug resistance gene 1 (Pfmdr1). The resistance&nbsp;of <em>P. falciparum</em> to chloroquine increased over time and is present across all regions of the country.</p>\n<p>&nbsp;</p>\n<p>Algid malaria is a rare complication of severe malaria characterized by hemodynamic collapse manifesting as shock with pronounced metabolic changes and hypothermia.</p>\n<p>&nbsp;</p>\n<p><strong>Relapse is seen in cases of <em>Plasmodium vivax</em> and&nbsp;<em>Plasmodium</em><em>&nbsp;ovale</em>.</strong></p>\n<p><strong>Malaria relapse :</strong></p>\n<p>True relapse is caused due to Hypnozoites.</p>\n<p>These are resting forms.</p>\n<p>In the case of&nbsp;<strong>Plasmodium vivax and ovale</strong>&nbsp;two kinds of sporozoites are seen, some of which :</p>\n<ul>\n<li>multiply inside hepatic cells to form -&nbsp;&nbsp;<strong>Schizonts</strong></li>\n<li>others persist and remain dormant as -&nbsp;&nbsp;<strong>hypnozoites</strong></li>\n</ul>\n<p>From time to time some are activated to&nbsp;<strong>become schizonts and release merozoites,</strong>&nbsp;which go on&nbsp;<strong>infecting RBCs producing clinical relapse.</strong></p>\n<p>In the case of&nbsp;<strong><em>Plasmodium falciparum</em> and&nbsp;<em>Plasmodium</em><em>&nbsp;malariae</em></strong>, the initial&nbsp;<strong>tissue phase disappears completely and no hypnozoites are found</strong>, hence&nbsp;<strong>technically relapse is not seen.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A HIV patient with fever, chronic diarrhea presented to OPD. His stool was examined which showed the following oocysts. Identify the components used for staining the stool.",
    "choices": [
      {
        "id": 1,
        "text": "Crystal violet, iodine, acid alcohol, carbol fuchsin"
      },
      {
        "id": 2,
        "text": "Methanol, Kinyoun\u2019s carbol fuchsin, acid alcohol, methylene blue"
      },
      {
        "id": 3,
        "text": "Methanol, dilute carbol fuchsin, acid alcohol, crystal violet"
      },
      {
        "id": 4,
        "text": "Methylene blue, iodine, acid alcohol, carbol fuchsin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Diarrhea in an HIV patient is suggestive of a&nbsp;<strong>coccidian</strong>&nbsp;parasitic infestation. The image shows a<strong> blue background</strong> and <strong>red-stained</strong> <strong>oocysts,</strong> suggestive of modified acid-fast stain positive&nbsp;<strong><em>Cryptosporidium parvum</em>.</strong></p>\n<p>The <strong>modified Ziehl-Neelsen (ZN) method </strong>is used for staining cryptosporidium and isospora species. Unlike the ZN-stain, the modified ZN stain does not require heating of the reagents.</p>\n<p>The<strong> reagents </strong>used in<strong> modified ZN stain </strong>include:</p>\n<ul>\n<li>Absolute <strong>methanol</strong> for fixation</li>\n<li><strong>Kinyoun&rsquo;s Carbol fuchsin</strong> - Primary stain</li>\n<li><strong>Acid alcohol</strong> - Decolourising agent</li>\n<li><strong>Methylene blue</strong> or<strong> Malachite green</strong> - Counterstain</li>\n</ul>\n<div class=\"ng-scope\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7f64082852c848309a5ba11596b5a554.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which immunoglobulin is elevated in a case of chronic allergy?",
    "choices": [
      {
        "id": 1,
        "text": "IgA"
      },
      {
        "id": 2,
        "text": "IgM"
      },
      {
        "id": 3,
        "text": "IgE"
      },
      {
        "id": 4,
        "text": "IgG"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>IgE</strong> is elevated in cases of <strong>chronic allergy.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is diagnosed with Hepatitis B infection. Which of the following markers will always be present in his serum, even during recurrences, or if he develops chronic hepatitis?",
    "choices": [
      {
        "id": 1,
        "text": "HBc Ag"
      },
      {
        "id": 2,
        "text": "Anti HBs Ab"
      },
      {
        "id": 3,
        "text": "Anti HBc Ab"
      },
      {
        "id": 4,
        "text": "HBe Ag"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A patient who has had exposure to HBV will have <strong>anti-HBc antibody</strong>\u00a0even when he has moved into the chronic or recurrent stages.\u00a0<strong>IgM</strong> anti-HBc reappears during acute\u00a0<strong>recurrences</strong> while <strong>IgG</strong>\u00a0anti-HBc is found in <strong>chronic</strong> states.\u00a0</p>\n<p>The <strong>HBsAg</strong> antigen is present in <strong>chronic</strong> hepatitis B, while the antibody anti-HBs is not.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following occupation is a risk factor for this presenting illness?",
    "choices": [
      {
        "id": 1,
        "text": "Kennel Worker"
      },
      {
        "id": 2,
        "text": "Lifeguard in a swimming pool"
      },
      {
        "id": 3,
        "text": "Veterenarian"
      },
      {
        "id": 4,
        "text": "Poultry worker"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above image shows <strong>cutaneous larva migrans. Being a kennel worker is a risk factor </strong>for this job as exposure to animal feces is high.</p>\n<p>As&nbsp;Larvae are found on sandy beaches, and under dwellings, swimming in natural water bodies would be a risk and not artificial ones like swimming pools.&nbsp;</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>CLM</strong>&nbsp;is caused by various animal&nbsp;<strong>hookworm</strong>&nbsp;species (e.g.,&nbsp;<em>Ancylostoma</em><em>&nbsp;brazilienses</em>), and the parasite is acquired from&nbsp;<strong>direct skin contact</strong>&nbsp;with soil&nbsp;<strong>contaminated</strong>&nbsp;by dog or cat&nbsp;<strong>feces.&nbsp;</strong>The parasitic infection usually begins with an inflamed&nbsp;<strong>papule</strong>, often located between the toes, where the hookworm species (e.g.,&nbsp;<em>Ancylostoma brazilienses</em>)&nbsp;<strong>larvae</strong>&nbsp;enter the skin.</p>\n<p><strong>Serpentine</strong>&nbsp;or&nbsp;<strong>linear</strong>&nbsp;<strong>single</strong>-<strong>track</strong>&nbsp;lines later mark the course of the larvae as they migrate through the&nbsp;<strong>epidermis</strong>&nbsp;of the trunk and lower extremities.</p>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Ivermectin is the first-line drug</strong>&nbsp;for the treatment of&nbsp;cutaneous larva migrans, taken as a single 200 &mu;g/kg oral dose.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b8a484a168d48bb85ddd8073ec4ce80.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Transmission assessment survey is carried out for:",
    "choices": [
      {
        "id": 1,
        "text": "P. vivax"
      },
      {
        "id": 2,
        "text": "P. falciparum"
      },
      {
        "id": 3,
        "text": "Filariasis"
      },
      {
        "id": 4,
        "text": "Leishmania"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Transmission assessment survey is carried out for <strong>filariasis.</strong></p>\n<p><strong>Mass Drug Administration</strong> is used to reduce infection in the community to levels below a threshold at which mosquitoes are unable to continue spreading the parasites from person to person and thus new infections are prevented.</p>\n<p>The <strong>transmission assessment survey</strong> (TAS) is used to <strong>determine when</strong> infections have been reduced below target thresholds and <strong>Mass Drug Administration can stop</strong>. Once MDA has stopped, <strong>TAS is used as a surveillance tool</strong> to determine that infection levels are sustained below target thresholds.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is a subcutaneous fungal agent?",
    "choices": [
      {
        "id": 1,
        "text": "Cryptococcus neoformans"
      },
      {
        "id": 2,
        "text": "Histoplasma capsulatum"
      },
      {
        "id": 3,
        "text": "Sporothrix schenckii"
      },
      {
        "id": 4,
        "text": "Talaromyces marneffei"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sporothrix</strong> <strong>schenckii</strong> is a subcutaneous fungal agent. The other three mentioned are systemic mycoses.</p>\n<p>&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ecc1b5de1c484a3a9dc58dbcd8fda2b9x1200x1923.JPEG"
    ]
  },
  {
    "text": "A hospital has reported an outbreak of MRSA infection. On investigation, it was found out that a staff nurse had nasal carriage of MRSA. Which of the following drugs helps in the removal of colonization of bacteria?",
    "choices": [
      {
        "id": 1,
        "text": "Oral vancomycin"
      },
      {
        "id": 2,
        "text": "Inj cephalosporin"
      },
      {
        "id": 3,
        "text": "Topical mupirocin"
      },
      {
        "id": 4,
        "text": "Inhaled colistin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Topical mupirocin</strong> is the <strong>preferred agent for the elimination of nasal carriers of MRSA.</strong></p>\n<p>As Mupirocin has no structural similarities with existing systemic antibiotics that might lead to the development of cross-resistance and has minimal toxicity in its topical form, it is approved for the prevention of MRSA outbreaks</p>\n<p>Mixed therapy with systemic agents is not preferred as it would cause unnecessary antibiotic exposure potentially paving way for drug resistance.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mw vaccine is extracted from which bacteria, mentioned below:",
    "choices": [
      {
        "id": 1,
        "text": "M. indicus pranii"
      },
      {
        "id": 2,
        "text": "M. welchii"
      },
      {
        "id": 3,
        "text": "M. leprae"
      },
      {
        "id": 4,
        "text": "M. bovis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Mw vaccine is extracted from&nbsp;M. indicus pranii</p>\n<p>MIP immunotherapy is used as an adjunct to chemotherapy for category II tuberculosis.&nbsp;</p>\n<p>Here, <strong>indicus </strong>stands for<strong> India</strong>, where the M. indius pranii was isolated; and&nbsp;<strong>pranii </strong>stands for<strong> the person who discovered </strong>the species&nbsp;(Prof. Pran Talwar) and&nbsp;<strong>National Institute of Immunology (nii)</strong>, where trials were conducted (pran + nii).</p>\n<p>Administration: 0.1 ml <strong>intradermal</strong>. &nbsp;It is divided into two equal doses and<strong>&nbsp;given on both arms</strong>.&nbsp;Booster doses are injected only on one arm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which toxin acts via the mechanism depicted in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Botulinum"
      },
      {
        "id": 2,
        "text": "Tetanus"
      },
      {
        "id": 3,
        "text": "Diphtheria"
      },
      {
        "id": 4,
        "text": "Pertussis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image given above depicts the mechanism of action of <strong>botulinum toxin</strong>.</p>\n<p>It&nbsp;causes <strong>proteolysis</strong> of <strong>snare proteins. </strong>Snare proteins&nbsp;have three components- synaptobrevin, SNAP25 and syntaxin. The snare protein is required for the <strong>excocytosis of acetylcholine</strong> vesicles. Thus it leads to <strong>presynaptic inhibition</strong> of<strong>&nbsp;</strong>neuronal transmission.</p>\n<p>There are 7 different strains of clostridium botulinum and each strain acts by a different mechanism. Toxins of C. Botulinum A, C and E cleave SNAP25. Type C also cleaves syntaxin. Type B, D, F and G cleave synaptobrevin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc7e91efa2fb4b08a31fa9ace2fc4517.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The toxin produced by the organisms shown below acts via?",
    "choices": [
      {
        "id": 1,
        "text": "Increase in cAMP"
      },
      {
        "id": 2,
        "text": "Increase in cGMP"
      },
      {
        "id": 3,
        "text": "ADP ribosylation of EF2"
      },
      {
        "id": 4,
        "text": "RNA glycosidase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The given image shows <strong>gram-positive rods </strong>with club-shaped ends, beaded appearance, and a<strong>\u00a0Chinese-letter pattern</strong> of arrangement indicative of\u00a0<em><strong>Corynebacterium diphtheriae</strong></em>.</p>\n<p class=\"p1\">The toxin produced by the bacteria - <strong>diphtheria toxin </strong>-\u00a0inhibits polypeptide chain elongation and protein synthesis by inactivating the <strong>elongation factor</strong>-<strong>2</strong> (EF-2) by <strong>ADP ribosylation</strong>. It has two fragments - fragment B helps in binding of the toxin to host cells and fragment A inactivates EF-2.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2e8e24b2f8db4938b7060cc433bbde83.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b98450d3d234667ae9b48268ad812e2x1280x1204.JPEG"
    ]
  },
  {
    "text": "A 25-year old man presents with a history of urethral discharge for the last three days. A gram stain smear of the discharge is shown below. All of the following are true regarding the likely etiology except?",
    "choices": [
      {
        "id": 1,
        "text": "Catalase and oxidase positive"
      },
      {
        "id": 2,
        "text": "Pili is a virulence factor"
      },
      {
        "id": 3,
        "text": "Obligate intracellular organism"
      },
      {
        "id": 4,
        "text": "Shows twitching motility"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\">The given slide shows <strong>gram-negative diplococci</strong> within the polymorphs, characteristic of <em><strong>Neisseria gonorrhoeae</strong></em> infection. Neisseria is not an obligate intracellular organism, it can also occur extracellularly i.e, it is\u00a0a<strong> facultative intracellular</strong> organism.\u00a0The other neisseria that are found as normal inhabitants of the human respiratory tract occur extracellularly.</p>\n<p style=\"text-align: left;\"><em>Neisseria gonorrhoeae</em> is a gram-negative,<strong> non-sporulating</strong>, <strong>non-motile diplococcus</strong> that is\u00a0aerobic\u00a0but may grow anaerobically also. It is <strong>oxidase </strong>and<strong> catalase-positive.</strong></p>\n<p style=\"text-align: left;\">Although Neisseria are<strong>\u00a0</strong>non-motile organisms, they show\u00a0<strong>twitching motility. </strong>This\u00a0is a <strong>flagella-independent</strong> form of bacterial translocation over moist surfaces that occurs by the extension and retraction of <strong>polar type IV pili</strong>. These\u00a0pili act as virulence factors by promoting attachment to host cells and inhibiting phagocytosis.</p>\n<p>Virulence factors for gonococci:</p>\n<ol>\n<li>Outer Membrane Proteins (OMPs)</li>\n<li>IgA proteases</li>\n<li>Pili</li>\n<li>Lipo-oligosaccharide (LOS)</li>\n<li>Transferrin</li>\n<li>Lactoferrin-binding protein</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2d2b8a14b1804d32aac112e7e610423e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The CLED medium is preferred over MacConkey agar for the culture of organisms in case of  UTI because:",
    "choices": [
      {
        "id": 1,
        "text": "It inhibits proteus swarming"
      },
      {
        "id": 2,
        "text": "It promotes the growth of candida, streptococcus and staphylococcus"
      },
      {
        "id": 3,
        "text": "It differentiates between lactose-fermenting and non-lactose fermenting bacteria"
      },
      {
        "id": 4,
        "text": "It promotes the growth of pseudomonas"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>CLED</strong> (Cysteine lactose electrolyte-deficient) medium is <strong>preferred</strong> over MacConkey agar for the culture of organisms involved in <strong>urinary tract infections</strong> because it is<strong>\u00a0less inhibitory</strong>\u00a0and promotes the growth of <strong>gram-positive bacteria </strong>(except\u00a0\u03b2 hemolytic streptococcus) and<strong> candida.\u00a0</strong></p>\n<p>A combination of blood agar and MacConkey agar is used for the processing of urine specimens. CLED medium is used as an alternative for this combination. It can also <strong>prevent swarming </strong>of <em>Proteus</em>, and is thus different from blood agar. Like MacConkey agar, it <strong>differentiates</strong> between <strong>lactose fermenters</strong> and <strong>non-fermenters.</strong> Lactose fermenters change the colour of the medium from green to yellow. However, these two facts are not the reason it is better than MacConkey agar for evaluation of UTI.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c853fc6818544389a60e58d0d9aaabf5x762x542.JPEG"
    ]
  },
  {
    "text": "Which of the following organisms cause multiple alveolar-like lesions in the liver?",
    "choices": [
      {
        "id": 1,
        "text": "Echinococcus multilocularis"
      },
      {
        "id": 2,
        "text": "Echinococcus granulosus"
      },
      {
        "id": 3,
        "text": "Entamoeba histolytica"
      },
      {
        "id": 4,
        "text": "Cysticercus cellulosae"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The water-lily sign occurs due to the detachment of the endocyst membrane from the cyst wall, giving the appearance of floating membranes within the pericyst. This mimics the appearance of a water lily. It is classically visualised on plain radiographs (mainly chest X-ray) when the collapsed membranes are calcified but may be seen on ultrasound, CT, or MRI.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1d0bcc0948bf4d86abcdd120d6a227bax600x667.JPEG"
    ]
  },
  {
    "text": "All of the following can be seen intracellularly in hepatocytes except:",
    "choices": [
      {
        "id": 1,
        "text": "Toxoplasma"
      },
      {
        "id": 2,
        "text": "Plasmodium"
      },
      {
        "id": 3,
        "text": "Babesia"
      },
      {
        "id": 4,
        "text": "Leishmania"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Babesia</strong> is an intracellular parasite of<strong> RBCs,</strong>&nbsp;not of the hepatocytes.</p>\n<p>Its trophozoites invade the RBCs.</p>\n<p><span class=\"s2\">The liver is usually not affected a</span>s b<span class=\"s2\">abesia lack an exoerythrocytic phase.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A Giemsa stain of a thin peripheral smear is prepared. Which of the following cannot be diagnosed?",
    "choices": [
      {
        "id": 1,
        "text": "Coxiella burnetii"
      },
      {
        "id": 2,
        "text": "Toxoplasma gondii"
      },
      {
        "id": 3,
        "text": "Bartonella henselae"
      },
      {
        "id": 4,
        "text": "Ehrlichia chaffeensis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The diagnosis of <strong>Coxiella burnetii</strong> cannot be done using a Giemsa stain of a thin peripheral smear.</p>\n<p>It is done mainly by<strong> serology,</strong> which shows\u00a0a rise in the titer of specific antibodies to C. burnetii.</p>\n<p>Microorganisms such as Histoplasma, Leishmania, Toxoplasma, and Pneumocystis can also be detected with Giemsa, and in gastric tissues, Helicobacter pylori (H. pylori) appear thin and distinctly blue. Giemsa\u2019s stain is frequently used for diagnostic purposes in haematology to differentiate the nuclear and cytoplasmic morphology of platelets, RBCs, WBCs, and parasites.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false about influenza?",
    "choices": [
      {
        "id": 1,
        "text": "Virus shedding is present before symptoms begins"
      },
      {
        "id": 2,
        "text": "5-12 years is a high risk group"
      },
      {
        "id": 3,
        "text": "Aquatic birds act as reservoir"
      },
      {
        "id": 4,
        "text": "Secondary attack rate is 5-15%"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Children &lt;<strong>5-years</strong>, especially those<strong>&nbsp;&lt;2-years</strong> of age are at the highest risk of serious <strong>complications</strong> related to influenza infection.</p>\n<p>Other high-risk groups for influenza include adults&nbsp;&ge;60 years of age, persons with chronic diseases, persons who are immunocompromised.</p>\n<p class=\"p1\">Option A: The virus is<strong> shed</strong> in respiratory secretions <strong>a day before</strong> the onset of illness and for<strong> 3-4 days thereafter.</strong></p>\n<p class=\"p1\">Option C: Birds, especially <strong>aquatic birds</strong> act as<strong> reservoirs</strong> of influenza viruses.</p>\n<p class=\"p1\">Option D: Secondary attack rate is 5- 15%.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "\u03b2 1-3 glucan assay is used to diagnose all except?",
    "choices": [
      {
        "id": 1,
        "text": "Candidiasis"
      },
      {
        "id": 2,
        "text": "Aspergillosis"
      },
      {
        "id": 3,
        "text": "Pneumocystis pneumonia"
      },
      {
        "id": 4,
        "text": "Mucormycosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> \u03b2-1-3 glucan</strong> assay <strong>cannot</strong> be used to <strong>diagnose</strong> <strong>mucormycosis</strong>. This condition is usually diagnosed based on clinical features and culture.</p>\n<p class=\"p1\">The \u03b2-1-3 glucan assay detects the presence of (1-3)-\u03b2-<span class=\"small-caps\">d</span>-glucan (BDG), an abundant <strong>cell wall polysaccharide</strong> found in most fungi. It is a chromogenic, <strong>quantitative enzyme immunoassay</strong> (EIA) designed to detect beta-D-glucan by using purified, lysed horseshoe crab (<em>Limulus polyphemus</em>) amebocytes. 1,3 Beta D Glucan level of <strong>\u226580 pg/mL</strong> is considered a\u00a0<strong>positive </strong>result.</p>\n<p class=\"p1\">Fungi that do not contain BDG in their cell walls include <em>Cryptococcus neoformans, </em>zygomycetes like rhizopus and mucor and <em>Blastomyces dermatitidis. </em><strong>Mucormycosis</strong> is an <strong>opportunistic mycosis</strong> caused by <strong>z<span class=\"s2\">y</span>gomycetes,\u00a0</strong>which do not contain (1-3)-\u03b2-<span class=\"small-caps\">d</span>-glucan, and hence, the \u03b2 1-3 glucan assay cannot be used for its diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a xenodiagnostic method?",
    "choices": [
      {
        "id": 1,
        "text": "Rabbit ileal loop assay for ETEC"
      },
      {
        "id": 2,
        "text": "Injecting Aedes thorax with blood of a patient with suspected dengue"
      },
      {
        "id": 3,
        "text": "Injecting a hamster with splenic biopsy for diagnosis of leishmaniasis"
      },
      {
        "id": 4,
        "text": "Intradermal test on guinea pigs for toxigenicity of Corynebacterium diphtheria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Injecting Aedes thorax with blood of a patient with suspected dengue is the xenodiagnostic method among the given options.</p>\n<p><strong>Xenodiagnosis</strong> (xenos- foreign) is an <strong>indirect method</strong> of identifying the infectious disease agents (i.e. the pathogen). In xenodiagnosis, the <strong>vector</strong> of a pathogenic agent is infected and the pathogen is allowed to multiply in the vector. The vector acts as the <strong>&ldquo;foreign&rdquo; host.</strong> Later, the vector is examined for the presence of the pathogen.</p>\n<p>This method was first used by Brumpt for the <strong>diagnosis of Chagas disease.</strong> Laboratory bred Reduviid bugs (vector/ foreign host) are allowed to feed on the suspected patients (original host). After 4-5 weeks, the feces of the bugs are microscopically examined for amastigote forms of <em>Trypanosoma cruzi</em> (pathogen).</p>\n<p>Another method of xenodiagnosis is the<strong> intrathoracic inoculation </strong>of the<strong> mosquitoes</strong> (vector) with viruses (pathogen). The virus multiplies in different organs of the mosquito and can be easily demonstrated. <em>Aedes aegypti</em>, <em>Aedes albopictus,</em> and <em>Toxorhynchites</em> mosquitoes are used for the identification of the dengue virus.</p>\n<p>In <em>Trichinella spiralis</em> infection, muscle biopsy bits from suspected patients are fed to laboratory rats (vector for<em> T. spiralis</em>). The larvae of <em>T. spiralis</em> can be demonstrated in the muscles of the infected lab rats.&nbsp;</p>\n<p><strong>Advantage of xenodiagnosis:</strong> It is useful in cases where a direct microscopic diagnosis is difficult due to the low count of pathogens in the blood of the host/patient.</p>\n<p>Other options:</p>\n<p><strong>Option A: </strong>Rabbit ileal loop assay for ETEC is a method of <strong>detection of toxigenicity/ virulence testing.</strong></p>\n<p><strong>Option C:</strong> Injecting a hamster with splenic biopsy for diagnosis of leishmaniasis is a method of<strong> animal inoculation.</strong></p>\n<p><strong>Option D:</strong> Intradermal test on guinea pigs for toxigenicity of Corynebacterium diphtheria is a method of <strong>virulence testing.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '063 Microbiology Aiims 2019  (May & Nov)';
        let hierarchy = ["Marrow", "PYQs", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>