<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>43  Soles - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        DAMS / DQB / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "id": 50000,
    "choices": [
      {
        "id": 200000,
        "text": "Plane"
      },
      {
        "id": 200001,
        "text": "Ball & Socket"
      },
      {
        "id": 200002,
        "text": "Saddle"
      },
      {
        "id": 200003,
        "text": "Pivot"
      }
    ],
    "text": "Talocalcaneonavicular joint is -",
    "unique_key": "Q5624662",
    "question_audio": null,
    "question_video": null,
    "map_id": 34971909,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Ball & Socket The talocalcaneonavicular joint is a ball and socket joint. This joint is formed by the articulation of the talus, calcaneus, and navicular bones. It allows for a significant range of movement, including inversion, eversion, and some degree of rotation, similar to the movement seen in ball and socket joints, although the motion is more restricted compared to joints like the shoulder or hip. The shape of the talus (which resembles a ball) fitting into the concave surface of the calcaneus and navicular bones enables a multi-axial movement pattern, which is characteristic of ball and socket joints. Incorrect Responses: (A) Plane A plane joint is characterized by two flat surfaces that allow for limited sliding or gliding movements, typically found between bones that have flat or slightly curved surfaces. The talocalcaneonavicular joint does not exhibit the limited sliding motion typical of a plane joint; instead, it permits a more complex range of motions, making it unsuitable for this classification. (C) Saddle A saddle joint allows movement in two planes, typically permitting flexion, extension, abduction, adduction, and circumduction. The best example of a saddle joint is the carpometacarpal joint of the thumb. However, the talocalcaneonavicular joint does not fit this description, as it allows for more rotational movement rather than just two planes of motion, ruling out the saddle classification. (D) Pivot A pivot joint allows for rotational movement around a single axis. An example of a pivot joint is the atlantoaxial joint in the neck, which allows rotation of the head. The talocalcaneonavicular joint, on the other hand, permits multi-axial movements, not just rotational motion, so it is not classified as a pivot joint.",
    "correct_choice_id": 200001,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24640001697983838/24640001697983838.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24640001697983838/24640001697983838.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50001,
    "choices": [
      {
        "id": 200004,
        "text": "Inversion"
      },
      {
        "id": 200005,
        "text": "Plantar flexion"
      },
      {
        "id": 200006,
        "text": "Eversion"
      },
      {
        "id": 200007,
        "text": "Dorsiflexion"
      }
    ],
    "text": "Due to bony support, the most stable position of the ankle joint is",
    "unique_key": "Q7203915",
    "question_audio": null,
    "question_video": null,
    "map_id": 34639535,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Dorsiflexion. Explanation for Correct Answer: The most stable position of the ankle joint is dorsiflexion. In dorsiflexion, the angle between the dorsum of the foot and the leg decreases, causing the talus bone to fit more snugly into the mortise of the tibia and fibula. This position aligns the bones more securely and increases the bony congruency, thereby providing greater stability to the joint. The stability is further enhanced by the ligaments and the overall structure of the ankle joint in this position. Explanation for Incorrect Answers: (A) Inversion: Inversion involves tilting the sole of the foot inward, which can lead to strain on the lateral ligaments and make the joint less stable, increasing the risk of sprains. It is not the most stable position because the ligaments and structures are not as well aligned as in dorsiflexion. (B) Plantar flexion: Plantar flexion involves pointing the toes downward, and while it might seem stable, it actually reduces the bony congruency between the talus and the tibia/fibula. The ankle joint is less stable in plantar flexion because the talus doesn't fit as securely into the mortise of the tibia and fibula. (C) Eversion: Eversion refers to the outward tilting of the sole of the foot. This position puts strain on the medial ligaments of the ankle and can destabilize the joint. It is not a stable position for the ankle joint.",
    "correct_choice_id": 200007,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/33915511697984095/33915511697984095.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/33915511697984095/33915511697984095.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50002,
    "choices": [
      {
        "id": 200008,
        "text": "Calcaneum"
      },
      {
        "id": 200009,
        "text": "Cuboid"
      },
      {
        "id": 200010,
        "text": "Talus"
      },
      {
        "id": 200011,
        "text": "Navicular"
      }
    ],
    "text": "The keystone of the medial longitudinal arch of the foot is",
    "unique_key": "Q5457577",
    "question_audio": null,
    "question_video": null,
    "map_id": 34317856,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Talus. Explanation for Correct Answer: The talus is considered the keystone of the medial longitudinal arch of the foot. It is the bone that sits at the top of the arch, forming the main connection between the foot and the leg. The talus plays a crucial role in maintaining the shape and stability of the medial longitudinal arch because it is centrally positioned and bears the weight of the body as it transfers from the tibia to the foot. Its positioning and structure help support the other bones that form the arch, making it the keystone of the medial arch. Explanation for Incorrect Answers: (A) Calcaneum: The calcaneus (heel bone) forms the foundation of the foot and supports the body weight, but it does not serve as the keystone of the medial longitudinal arch. It provides support to the posterior part of the arch, while the talus is the central keystone. (B) Cuboid: The cuboid is located on the lateral side of the foot and helps support the lateral longitudinal arch, not the medial one. It is not involved in the formation or maintenance of the medial longitudinal arch. (D) Navicular: The navicular bone is important in maintaining the medial arch, but it is not considered the keystone. The navicular works closely with the talus and other bones of the arch, but the talus, being centrally located and bearing most of the weight, is the true keystone.",
    "correct_choice_id": 200010,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/5046461697984145/5046461697984145.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/5046461697984145/5046461697984145.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50003,
    "choices": [
      {
        "id": 200012,
        "text": "Peroneus longus"
      },
      {
        "id": 200013,
        "text": "Peroneus brevis"
      },
      {
        "id": 200014,
        "text": "Peroneus tertius"
      },
      {
        "id": 200015,
        "text": "Extensor digitorum"
      }
    ],
    "text": "In forceful inversion of foot, fracture of the tuberosity of 5th metatarsal is due to pull exerted by which tendon-",
    "unique_key": "Q7306740",
    "question_audio": null,
    "question_video": null,
    "map_id": 34262152,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Peroneus brevis. Forceful inversion of the foot can result in an avulsion fracture of the tuberosity of the 5th metatarsal due to the pull exerted by the peroneus brevis tendon. The peroneus brevis originates from the lower two-thirds of the lateral surface of the fibula and inserts into the tuberosity of the 5th metatarsal. During an inversion injury, the foot is twisted inward forcefully, causing the peroneus brevis to contract suddenly in an attempt to stabilize the foot. This sudden, strong pull on its insertion can lead to an avulsion fracture of the 5th metatarsal tuberosity, a common injury in such scenarios. Explanation of the incorrect options: (A) Peroneus longus: The peroneus longus originates from the upper part of the lateral fibula and inserts on the medial cuneiform and base of the 1st metatarsal. It plays a role in plantarflexion and eversion of the foot but does not attach to the 5th metatarsal, so it cannot cause its fracture during inversion. (C) Peroneus tertius: The peroneus tertius originates from the distal fibula and inserts on the dorsal surface of the base of the 5th metatarsal. While it does attach to the 5th metatarsal, it assists in dorsiflexion and eversion. It is not the primary tendon involved in inversion injuries, as its line of pull does not contribute to avulsion fractures of the 5th metatarsal tuberosity. (D) Extensor digitorum: The extensor digitorum longus is a muscle that extends the toes and dorsiflexes the foot. It does not insert on the 5th metatarsal, nor does it play a role in inversion-related injuries.",
    "correct_choice_id": 200013,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/22153851697985849/22153851697985849.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/22153851697985849/22153851697985849.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50004,
    "choices": [
      {
        "id": 200016,
        "text": "Ankle joints"
      },
      {
        "id": 200017,
        "text": "Subtalar joints"
      },
      {
        "id": 200018,
        "text": "Tibiotalar joints"
      },
      {
        "id": 200019,
        "text": "Transverse tarsal joints"
      }
    ],
    "text": "Inversion / Eversion movements occurs at -",
    "unique_key": "Q4471267",
    "question_audio": null,
    "question_video": null,
    "map_id": 34279642,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Subtalar joints. The movements of inversion (turning the sole of the foot inward) and eversion (turning the sole outward) primarily occur at the subtalar joint, also known as the talocalcaneal joint. This joint is formed by the articulation between the talus and the calcaneus and allows for the side-to-side movement necessary for these actions. The subtalar joint is critical for adapting the foot to uneven terrain and maintaining balance during walking or running. Its unique structure, including an oblique axis, facilitates these rotational movements. Explanation of the incorrect options: (A) Ankle joints: The ankle joint (talocrural joint) is a hinge joint formed by the tibia, fibula, and talus. Its primary movements are dorsiflexion (lifting the foot upward) and plantarflexion (pointing the foot downward). It does not allow for inversion or eversion, as these movements occur at more distal joints. (C) Tibiotalar joints: The tibiotalar joint is another name for the talocrural (ankle) joint. Like the ankle joint, it only allows dorsiflexion and plantarflexion and is not involved in inversion or eversion movements. (D) Transverse tarsal joints: The transverse tarsal joint (Chopart\u2019s joint) is formed by the talonavicular and calcaneocuboid joints. While it assists in inversion and eversion to some extent, it plays a secondary role compared to the subtalar joint. It functions more in conjunction with the subtalar joint to enhance foot adaptability.",
    "correct_choice_id": 200017,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/49112241697985867/49112241697985867.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/49112241697985867/49112241697985867.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50005,
    "choices": [
      {
        "id": 200020,
        "text": "Medial malleolus"
      },
      {
        "id": 200021,
        "text": "Talus"
      },
      {
        "id": 200022,
        "text": "Calcaneum"
      },
      {
        "id": 200023,
        "text": "Lateral malleolus"
      }
    ],
    "text": "Deltoid ligament is attached to all except -",
    "unique_key": "Q2095920",
    "question_audio": null,
    "question_video": null,
    "map_id": 34896838,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Lateral malleolus. Explanation for the Correct Answer: The deltoid ligament is a strong, triangular ligament located on the medial side of the ankle joint. It attaches to several bones in this area, but it does not attach to the lateral malleolus. The deltoid ligament originates from the medial malleolus of the tibia, and its fibers extend to attach to the talus and calcaneus bones. The lateral malleolus is located on the opposite side of the ankle (on the fibula), and is not part of the deltoid ligament's attachment. The lateral malleolus is associated with the lateral collateral ligament of the ankle. Explanation for Incorrect Answers: A. Medial malleolus: The deltoid ligament originates from the medial malleolus of the tibia, which is one of the primary attachment points for this ligament. B. Talus: The deltoid ligament attaches to the talus bone on its medial surface. This attachment is crucial for stabilizing the ankle joint. C. Calcaneum: The deltoid ligament also attaches to the calcaneus bone. This helps provide medial support to the foot and ankle, especially during weight-bearing activities.",
    "correct_choice_id": 200023,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/13328931697986769/13328931697986769.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/13328931697986769/13328931697986769.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50006,
    "choices": [
      {
        "id": 200024,
        "text": "Tibialis anterior"
      },
      {
        "id": 200025,
        "text": "Tibialis posterior"
      },
      {
        "id": 200026,
        "text": "Peroneous longus"
      },
      {
        "id": 200027,
        "text": "Extensor hallucis longus"
      }
    ],
    "text": "Muscle attached to navicular tuberosity is ?",
    "unique_key": "Q5096513",
    "question_audio": null,
    "question_video": null,
    "map_id": 34298924,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Tibialis posterior. Explanation for the Correct Answer: The tibialis posterior muscle is attached to the navicular tuberosity, a bony prominence on the medial side of the foot. The tibialis posterior tendon inserts into the navicular tuberosity and plays a key role in supporting the medial arch of the foot, as well as contributing to plantar flexion and inversion of the foot. Explanation for Incorrect Answers: A. Tibialis anterior: This is incorrect. The tibialis anterior tendon does not insert into the navicular tuberosity. It attaches to the medial cuneiform and the first metatarsal bones, and it is responsible for dorsiflexion and inversion of the foot. C. Peroneus longus: This is incorrect. The peroneus longus tendon inserts into the lateral side of the foot, specifically on the base of the first metatarsal and the medial cuneiform. It helps in plantar flexion and eversion of the foot. D. Extensor hallucis longus: This is incorrect. The extensor hallucis longus tendon inserts into the distal phalanx of the great toe, not the navicular tuberosity. It is responsible for extension of the big toe and assists in dorsiflexion of the foot.",
    "correct_choice_id": 200025,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/17959321697988315/17959321697988315.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/17959321697988315/17959321697988315.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50007,
    "choices": [
      {
        "id": 200028,
        "text": "Abductor hallucis"
      },
      {
        "id": 200029,
        "text": "Flexor hallucis longus"
      },
      {
        "id": 200030,
        "text": "Flexor hallucis brevis"
      },
      {
        "id": 200031,
        "text": "Adductor hallucis"
      }
    ],
    "text": "First layer of sole has",
    "unique_key": "Q7502661",
    "question_audio": null,
    "question_video": null,
    "map_id": 34016430,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Abductor hallucis. Explanation for the Correct Answer: The first layer of the sole of the foot includes muscles that are primarily responsible for supporting the arch and providing basic movement. The Abductor hallucis is one of the muscles in this layer. It is located along the medial side of the foot and is responsible for the abduction of the big toe (hallux). It is one of the intrinsic muscles of the foot and is part of the first layer. Explanation for Incorrect Answers: B. Flexor hallucis longus: This is incorrect because the Flexor hallucis longus is not part of the first layer of the sole. It is a muscle of the deep posterior compartment of the leg and is responsible for flexing the big toe, but it does not contribute to the first layer of muscles in the sole. C. Flexor hallucis brevis: This is incorrect because the Flexor hallucis brevis is part of the third layer of the muscles in the sole of the foot, not the first. It is involved in flexing the big toe at its metatarsophalangeal joint. D. Adductor hallucis: This is incorrect because the Adductor hallucis is part of the third layer of muscles in the sole of the foot, not the first. It plays a role in adducting the big toe and stabilizing the metatarsal joint.",
    "correct_choice_id": 200028,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/56748361697987750/56748361697987750.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/56748361697987750/56748361697987750.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50008,
    "choices": [
      {
        "id": 200032,
        "text": "Tibialis anterior"
      },
      {
        "id": 200033,
        "text": "Tibialis posterior"
      },
      {
        "id": 200034,
        "text": "Peroneus longus"
      },
      {
        "id": 200035,
        "text": "Extensor hallucis longus"
      }
    ],
    "text": "All of the following muscles are responsible for inversion except",
    "unique_key": "Q9880957",
    "question_audio": null,
    "question_video": null,
    "map_id": 34740423,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A,B-Tibialis anterior and Tibialis posterior performs the inversion.Inversion & eversion takes place at subtalar & midtarsal joints. Option C-Peroneus longus is the muscle of eversion. Option D-Extensor hallucis longus also does the inversion,along with extension of great toe.",
    "correct_choice_id": 200034,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/49285701701776604/49285701701776604.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/49285701701776604/49285701701776604.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50009,
    "choices": [
      {
        "id": 200036,
        "text": "Tibialis anterior"
      },
      {
        "id": 200037,
        "text": "Tibialis posterior"
      },
      {
        "id": 200038,
        "text": "Flexor digitorum"
      },
      {
        "id": 200039,
        "text": "Flexor hallucis longus"
      }
    ],
    "text": "Doctor inverted the ankle against resistance and palpate a tendon behind medial malleolus",
    "unique_key": "Q6978334",
    "question_audio": null,
    "question_video": null,
    "map_id": 34598884,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Option A-Tibialis anterior is located anterior to medial malleolus. Option B-Tibialis posterior is located behind medial malleolus and can be palpated. Option C,D-Flexor digitorum and Flexor hallucis longus are also located behind medial malleolus but they are difficult to palpate.",
    "correct_choice_id": 200037,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50010,
    "choices": [
      {
        "id": 200040,
        "text": "Subtalar and midtarsal"
      },
      {
        "id": 200041,
        "text": "Calcaneonavicular"
      },
      {
        "id": 200042,
        "text": "Midtarsal"
      },
      {
        "id": 200043,
        "text": "Calcaneocuboid only"
      }
    ],
    "text": "Inversion and eversion occurs at which joint:",
    "unique_key": "Q7342296",
    "question_audio": null,
    "question_video": null,
    "map_id": 34003865,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Subtalar and midtarsal joints. Inversion and eversion occur primarily at the subtalar and midtarsal joints. The subtalar joint is located between the talus and the calcaneus and allows for the movement of the foot in the frontal plane, enabling inversion (turning the sole of the foot inward) and eversion (turning the sole outward). The midtarsal joint, which consists of the talonavicular and calcaneocuboid joints, also contributes to these movements, allowing for further adjustment of foot position during walking and running. These two joints work together to control the orientation of the foot in relation to the ground. Reasons for Incorrect Options: B. Calcaneonavicular joint: The calcaneonavicular joint, also known as the spring ligament, is important for supporting the arch of the foot but does not directly contribute to inversion and eversion. This joint helps maintain the integrity of the medial arch, and while it plays a role in foot biomechanics, it is not the primary site for inversion and eversion movements. C. Midtarsal joint: The midtarsal joint is indeed involved in inversion and eversion, but it cannot be considered in isolation without the subtalar joint, which is the more important contributor to these movements. The subtalar joint and the midtarsal joint together contribute to the inversion and eversion of the foot, making option A a more comprehensive and correct answer. D. Calcaneocuboid only: The calcaneocuboid joint is a component of the midtarsal joint and contributes to foot mobility, but it alone does not produce significant inversion and eversion. The movement is more complex and involves both the calcaneocuboid and the talonavicular components of the midtarsal joint, as well as the subtalar joint.",
    "correct_choice_id": 200040,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50011,
    "choices": [
      {
        "id": 200044,
        "text": "Soleus"
      },
      {
        "id": 200045,
        "text": "EHL"
      },
      {
        "id": 200046,
        "text": "Tibilis anterior"
      },
      {
        "id": 200047,
        "text": "Peroneus brevis"
      }
    ],
    "text": "Planter flexion is brought about by which of these muscles -",
    "unique_key": "Q7664687",
    "question_audio": null,
    "question_video": null,
    "map_id": 34624944,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Planter flexion is brought about by Soleus (muscle of posterior compartment). Dorsiflexion is brought about by EHL & Tibialis anterior (muscle of anterior compartment) Eversion is brought about by Peroneus brevis (muscle of lateral compartment).",
    "correct_choice_id": 200044,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50012,
    "choices": [
      {
        "id": 200048,
        "text": "Tibiocalcacaneal"
      },
      {
        "id": 200049,
        "text": "Tibiotalar"
      },
      {
        "id": 200050,
        "text": "Tibiofibular"
      },
      {
        "id": 200051,
        "text": "Tibionavicular"
      }
    ],
    "text": "Deltoid ligament is composed of all of following parts except-",
    "unique_key": "Q2538571",
    "question_audio": null,
    "question_video": null,
    "map_id": 34748230,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Tibiofibular. The deltoid ligament, also known as the medial collateral ligament of the ankle, does not include the tibiofibular part. The deltoid ligament is a strong, triangular ligament located on the medial side of the ankle, and it has several components, but the tibiofibular ligament is not one of them. The tibiofibular ligament is part of the syndesmosis that connects the tibia and fibula, and it is not part of the deltoid ligament. Reasons for Incorrect Options: A. Tibiocalcaneal: The tibiocalcaneal ligament is a part of the deltoid ligament. It connects the tibia to the calcaneus (heel bone) and plays a key role in stabilizing the medial side of the ankle joint. Therefore, option A is part of the deltoid ligament. B. Tibiotalar: The tibiotalar ligament is also part of the deltoid ligament. It connects the tibia to the talus bone and is crucial for stabilizing the ankle during movement. Therefore, option B is part of the deltoid ligament. D. Tibionavicular: The tibionavicular ligament is another component of the deltoid ligament. It connects the tibia to the navicular bone and provides stability to the medial side of the ankle. Therefore, option D is part of the deltoid ligament.",
    "correct_choice_id": 200050,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50013,
    "choices": [
      {
        "id": 200052,
        "text": "Calcaneonavicular ligament"
      },
      {
        "id": 200053,
        "text": "Calcaneocubiod ligament"
      },
      {
        "id": 200054,
        "text": "Transverse tibiofibular ligament"
      },
      {
        "id": 200055,
        "text": "Talocaleaneal ligament"
      }
    ],
    "text": "Spring ligament is also called \u2013",
    "unique_key": "Q3743949",
    "question_audio": null,
    "question_video": null,
    "map_id": 34864483,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Calcaneonavicular ligament. The spring ligament, also known as the calcaneonavicular ligament, is a crucial ligament of the foot. It connects the calcaneus (heel bone) to the navicular bone and plays a key role in supporting the medial longitudinal arch of the foot. The ligament helps maintain the integrity of the arch and contributes to the ability to walk and bear weight. Its nickname \"spring ligament\" comes from its role in providing elastic support to the foot. Reasons for Incorrect Options: B. Calcaneocuboid ligament: The calcaneocuboid ligament connects the calcaneus (heel bone) to the cuboid bone, located on the lateral side of the foot. This ligament helps stabilize the lateral aspect of the foot, but it is not involved in supporting the medial arch, which is the role of the spring (calcaneonavicular) ligament. Therefore, option B is incorrect. C. Transverse tibiofibular ligament: The transverse tibiofibular ligament is located between the tibia and fibula in the lower leg, specifically in the syndesmosis joint. It is not involved in foot arch support and is unrelated to the spring ligament. Therefore, option C is incorrect. D. Talocalcaneal ligament: The talocalcaneal ligament connects the talus to the calcaneus in the ankle joint. While it plays a role in stabilizing the subtalar joint, it is not the same as the calcaneonavicular (spring) ligament, which is located more medially and is primarily involved in supporting the arch of the foot.",
    "correct_choice_id": 200052,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50014,
    "choices": [
      {
        "id": 200056,
        "text": "Tibialis anterior"
      },
      {
        "id": 200057,
        "text": "Tibialis posterior"
      },
      {
        "id": 200058,
        "text": "Peroneus tertius"
      },
      {
        "id": 200059,
        "text": "Peroneus longus"
      }
    ],
    "text": "Eversion of foot is produced by \u2013",
    "unique_key": "Q3891832",
    "question_audio": null,
    "question_video": null,
    "map_id": 34677699,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Peroneus longus. Eversion of the foot involves turning the sole outward, away from the midline. This movement is primarily produced by the muscles in the lateral compartment of the leg, namely the peroneus longus and peroneus brevis. The peroneus longus is the more significant contributor to eversion. It originates from the fibula and inserts on the medial cuneiform and the base of the first metatarsal, passing under the foot. Its action pulls the sole laterally, producing eversion. Additionally, the peroneus longus supports the transverse arch of the foot, making it essential for both movement and stability. Explanation of the incorrect options: (A) Tibialis anterior: The tibialis anterior is a muscle located in the anterior compartment of the leg. Its primary actions are dorsiflexion and inversion of the foot. It is not involved in eversion, as it pulls the foot medially rather than laterally. (B) Tibialis posterior: The tibialis posterior is located in the deep posterior compartment of the leg. It plays a role in plantarflexion and inversion of the foot. Like the tibialis anterior, it pulls the foot medially and supports the arch, so it does not contribute to eversion. (C) Peroneus tertius: The peroneus tertius, a small muscle in the anterior compartment of the leg, assists in dorsiflexion and weak eversion of the foot. However, its contribution to eversion is minimal compared to the peroneus longus and brevis, and it is not the primary muscle for this action.",
    "correct_choice_id": 200059,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50015,
    "choices": [
      {
        "id": 200060,
        "text": "Tibialis posterior"
      },
      {
        "id": 200061,
        "text": "Peroneus tertius"
      },
      {
        "id": 200062,
        "text": "Peroneus brevis"
      },
      {
        "id": 200063,
        "text": "Gastrocnemius"
      }
    ],
    "text": "Invertor of foot is-",
    "unique_key": "Q7221980",
    "question_audio": null,
    "question_video": null,
    "map_id": 34782879,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Tibialis posterior. Inversion of the foot involves turning the sole inward, toward the midline of the body. The tibialis posterior is the primary muscle responsible for this action. It is located in the deep posterior compartment of the leg. The muscle originates from the posterior surfaces of the tibia and fibula and inserts on the navicular and several other tarsal bones. Its contraction pulls the sole medially, producing inversion. In addition to inversion, the tibialis posterior supports the medial longitudinal arch of the foot, making it crucial for maintaining foot stability and proper alignment. Explanation of the incorrect options: (B) Peroneus tertius: The peroneus tertius is a muscle in the anterior compartment of the leg. It assists in dorsiflexion and weak eversion of the foot but does not contribute to inversion. Its primary role is opposite to that of the tibialis posterior. (C) Peroneus brevis: The peroneus brevis is a muscle in the lateral compartment of the leg. It is a strong evertor of the foot, working alongside the peroneus longus. It pulls the sole outward, away from the midline, which is the opposite of inversion. (D) Gastrocnemius: The gastrocnemius is a large muscle in the posterior compartment of the leg, primarily responsible for plantarflexion of the ankle. While it plays a crucial role in movements like walking and running, it does not contribute to inversion of the foot.",
    "correct_choice_id": 200060,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50016,
    "choices": [
      {
        "id": 200064,
        "text": "Common peroneal nerve"
      },
      {
        "id": 200065,
        "text": "Deep peroneal nerve"
      },
      {
        "id": 200066,
        "text": "Superficial peroneal nerve"
      },
      {
        "id": 200067,
        "text": "Tibial nerve"
      }
    ],
    "text": "A young patients presented with loss of sensation in sole of foot with paralysis of medial side of plantar muscles of the foot, Most likely nerve involvement is-",
    "unique_key": "Q7411348",
    "question_audio": null,
    "question_video": null,
    "map_id": 34713801,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) The tibial nerve is a branch of the sciatic nerve that innervates the posterior compartment of the leg and the plantar region of the foot. It supplies sensation to the sole of the foot and motor innervation to most of the plantar muscles, including those on the medial side. Key Points: Loss of sensation in the sole of the foot and paralysis of the medial plantar muscles strongly suggests tibial nerve involvement. The tibial nerve divides into the medial and lateral plantar nerves, which supply the plantar aspect of the foot. Why Other Options Are Incorrect: A. Common peroneal nerve: Supplies the anterior and lateral compartments of the leg and does not affect the sole of the foot. B. Deep peroneal nerve: Innervates the anterior compartment of the leg and supplies sensation to the first web space of the foot, not the sole. C. Superficial peroneal nerve: Supplies the lateral compartment of the leg and provides sensation to the dorsum of the foot, not the sole.",
    "correct_choice_id": 200067,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50017,
    "choices": [
      {
        "id": 200068,
        "text": "Tibialis anterior"
      },
      {
        "id": 200069,
        "text": "Tibialis posterior"
      },
      {
        "id": 200070,
        "text": "Flexor digitorum longus"
      },
      {
        "id": 200071,
        "text": "Flexor hallucis longus"
      }
    ],
    "text": "Which of the following tendons passes below the sustentaculum tali -",
    "unique_key": "Q9212502",
    "question_audio": null,
    "question_video": null,
    "map_id": 34163522,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Flexor hallucis longus. Explanation for the Correct Answer: The flexor hallucis longus tendon passes below the sustentaculum tali. The sustentaculum tali is a bony prominence on the calcaneus (heel bone), and the flexor hallucis longus tendon travels posteriorly and inferiorly to pass below this structure. This tendon is responsible for flexing the great toe (big toe) and helps in plantarflexion of the foot. Explanation for Incorrect Answers: A. Tibialis anterior: The tibialis anterior tendon runs along the anterior aspect of the ankle and does not pass below the sustentaculum tali. It functions primarily in dorsiflexing and inverting the foot. B. Tibialis posterior: The tibialis posterior tendon passes behind the medial malleolus, but it does not pass below the sustentaculum tali. It plays a key role in foot inversion and maintaining the arch of the foot. C. Flexor digitorum longus: The flexor digitorum longus tendon also passes behind the medial malleolus, but it runs in a separate path and does not pass below the sustentaculum tali. It is responsible for flexing the toes.",
    "correct_choice_id": 200071,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50018,
    "choices": [
      {
        "id": 200072,
        "text": "Peroneus longus and peroneus brevis"
      },
      {
        "id": 200073,
        "text": "Peroneus brevis"
      },
      {
        "id": 200074,
        "text": "Peroneus longus and tibialis posterior"
      },
      {
        "id": 200075,
        "text": "Peroneus brevis and tibialis posterior"
      }
    ],
    "text": "Which of the following forms the tendinous sling in the lateral arch of foot?",
    "unique_key": "Q2179415",
    "question_audio": null,
    "question_video": null,
    "map_id": 34680289,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Peroneus longus and peroneus brevis. Explanation for the Correct Answer: The lateral arch of the foot is supported by a tendinous sling formed by the peroneus longus and peroneus brevis muscles. These muscles help stabilize the lateral side of the foot and contribute to its arch. Specifically: The peroneus longus tendon passes under the foot and attaches to the medial cuneiform and the first metatarsal bone. It plays a crucial role in maintaining the lateral arch. The peroneus brevis tendon runs along the lateral side of the foot and helps support the lateral arch, although it is primarily involved in foot eversion and plantar flexion. The tendons of these two muscles create a \"sling\" effect across the lateral aspect of the foot, aiding in both the structural integrity and function of the foot's arch. Explanation for Incorrect Answers: B. Peroneus brevis: While the peroneus brevis contributes to the lateral arch, it is not the sole muscle that forms the tendinous sling. The peroneus longus also plays an essential role in this function. C. Peroneus longus and tibialis posterior: The tibialis posterior is important for supporting the medial arch of the foot but does not directly contribute to the tendinous sling of the lateral arch. D. Peroneus brevis and tibialis posterior: Again, the tibialis posterior supports the medial arch and does not form part of the tendinous sling in the lateral arch.",
    "correct_choice_id": 200072,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50019,
    "choices": [
      {
        "id": 200076,
        "text": "Psaoas major"
      },
      {
        "id": 200077,
        "text": "Sartorius"
      },
      {
        "id": 200078,
        "text": "Gluteus maximus"
      },
      {
        "id": 200079,
        "text": "Rectus femoris"
      }
    ],
    "text": "Flexor of hip joint are all except",
    "unique_key": "Q3300863",
    "question_audio": null,
    "question_video": null,
    "map_id": 34702891,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Gluteus maximus. Explanation for the Correct Answer: The gluteus maximus is primarily a hip extensor, not a flexor. It is responsible for extending and laterally rotating the hip joint, particularly during movements such as standing up from a sitting position, running, or climbing stairs. It plays a significant role in activities that involve moving the leg behind the body, but it does not contribute to flexion at the hip joint. Explanation for Incorrect Answers: A. Psoas major: The psoas major is one of the primary flexors of the hip. It originates from the lumbar vertebrae and inserts into the lesser trochanter of the femur, facilitating hip flexion. B. Sartorius: The sartorius is another hip flexor. It is the longest muscle in the body and helps in flexing, abducting, and laterally rotating the hip joint. D. Rectus femoris: The rectus femoris, part of the quadriceps muscle group, is also a hip flexor. It crosses the hip joint and helps in flexing the thigh while also contributing to knee extension.",
    "correct_choice_id": 200078,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50020,
    "choices": [
      {
        "id": 200080,
        "text": "Superficial peroneal nerve"
      },
      {
        "id": 200081,
        "text": "Deep peroneal nerve"
      },
      {
        "id": 200082,
        "text": "Tibial nerve"
      },
      {
        "id": 200083,
        "text": "Sciatic nerve"
      }
    ],
    "text": "Extensor hallucis longus is supplied by -",
    "unique_key": "Q9707336",
    "question_audio": null,
    "question_video": null,
    "map_id": 34677152,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Deep peroneal nerve. Explanation for the Correct Answer: The extensor hallucis longus (EHL) muscle is responsible for extending the big toe and dorsiflexing the ankle. It is innervated by the deep peroneal nerve, a branch of the common peroneal nerve. The deep peroneal nerve specifically supplies the muscles in the anterior compartment of the leg, including the extensor hallucis longus, which plays an important role in toe extension and foot dorsiflexion. Explanation for Incorrect Answers: A. Superficial peroneal nerve: The superficial peroneal nerve innervates muscles in the lateral compartment of the leg, such as the peroneus longus and peroneus brevis, but it does not supply the extensor hallucis longus. C. Tibial nerve: The tibial nerve innervates muscles in the posterior compartment of the leg, such as the gastrocnemius, soleus, and flexor muscles, but not the extensor hallucis longus. This muscle belongs to the anterior compartment, which is innervated by the deep peroneal nerve. D. Sciatic nerve: The sciatic nerve is a major nerve that innervates muscles in the posterior thigh and leg, but it does not directly supply the extensor hallucis longus. The sciatic nerve does contribute to the tibial nerve, which innervates other muscles, but not the anterior compartment muscles like the EHL.",
    "correct_choice_id": 200081,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '43  Soles';
        const quizFilename = '43-soles-3daaba4b.html';
        let hierarchy = ["DAMS", "DQB", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on navigation
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>