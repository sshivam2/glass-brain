<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>48 Reconstructive Surgery - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A scar excision followed by reconstruction with a split skin graft was performed on the forearm of a  28-year-old man. The survival of the graft during the first 48 hours will be mainly dependent on ________.",
    "choices": [
      {
        "id": 1,
        "text": "Inosculation"
      },
      {
        "id": 2,
        "text": "Imbibition"
      },
      {
        "id": 3,
        "text": "Early revascularization"
      },
      {
        "id": 4,
        "text": "Stored glycogen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Skin grafts survive by <strong>imbibition</strong> during the <strong>first</strong> <strong>48 hours.</strong>&nbsp;</p>\n<p>The stage of imbibition is the first stage of graft uptake during which the <strong>graft draws nourishment</strong> from the<strong> plasma exudate </strong>at the <strong>host site</strong> (by simple diffusion).&nbsp;After this inosculation and revascularization take over.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a leg injury was treated with a skin graft as shown below. Which of the following statements is false regarding this type of skin graft?",
    "choices": [
      {
        "id": 1,
        "text": "Degree of contraction is dependant on amount of dermis in graft"
      },
      {
        "id": 2,
        "text": "Healing with abnormal pigmentation are more common."
      },
      {
        "id": 3,
        "text": "High reliability of take"
      },
      {
        "id": 4,
        "text": "Meshing grafts improve their ultimate cosmetic appearance"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows a meshed, <strong>split-thickness skin graft</strong>. Split grafts are&nbsp;<strong>meshed</strong> to <strong>expand the surface area</strong> that can be covered but it does not improve the cosmetic appearance.</p>\n<p><strong>Less dermis</strong> in the split-thickness skin graft translates into<strong> less primary contraction</strong> (the degree to which a graft shrinks in surface area after harvesting and before grafting) and <strong>more secondary contraction</strong> (the degree to which a graft shrinks during healing).</p>\n<p>Less dermis also translates into a <strong>better chance of graft survival.&nbsp;</strong>Thin split grafts have a low primary contraction, high secondary contraction, and high reliability of graft take. However, they tend to heal with <strong>abnormal pigmentation </strong>and<strong> poor durability.</strong></p>\n<table style=\"height: 218px; width: 600px;\">\n<tbody>\n<tr>\n<td style=\"width: 272.312px;\"><strong>Type of graft</strong></td>\n<td style=\"width: 311.688px;\"><strong>Split-thickness graft</strong></td>\n<td style=\"width: 292px;\"><strong>Full-thickness graft</strong></td>\n</tr>\n<tr>\n<td style=\"width: 272.312px;\"><strong>Composition</strong></td>\n<td style=\"width: 311.688px;\">Epidermis + part of the dermis</td>\n<td style=\"width: 292px;\">Epidermis + full dermis</td>\n</tr>\n<tr>\n<td style=\"width: 272.312px;\"><strong>Cosmetic appearance</strong></td>\n<td style=\"width: 311.688px;\">Relatively poor</td>\n<td style=\"width: 292px;\">Good (texture and pigmentation are better matched)</td>\n</tr>\n<tr>\n<td style=\"width: 272.312px;\"><strong>Graft take/survival</strong></td>\n<td style=\"width: 311.688px;\">High chance of survival</td>\n<td style=\"width: 292px;\">Poor (long healing time and vascularization)</td>\n</tr>\n<tr>\n<td style=\"width: 272.312px;\"><strong>Contraction</strong></td>\n<td style=\"width: 311.688px;\">Lesser primary contraction and more secondary contraction</td>\n<td style=\"width: 292px;\">More primary contraction and lesser secondary contraction</td>\n</tr>\n<tr>\n<td style=\"width: 272.312px;\"><strong>Use</strong></td>\n<td style=\"width: 311.688px;\">Can cover large areas of defects</td>\n<td style=\"width: 292px;\">For areas where least contraction (finger) or best cosmesis (face) is desired</td>\n</tr>\n</tbody>\n</table>\n<p><span data-preserver-spaces=\"true\">The image given below shows the procedure of obtaining a&nbsp;</span><strong><span data-preserver-spaces=\"true\">split-thickness skin graft</span></strong><span data-preserver-spaces=\"true\">&nbsp;using a handheld&nbsp;</span><strong><span data-preserver-spaces=\"true\">Humby knife.</span></strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df5e0a7cbeea431890874ccd46232ac1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f187b86fb6ff4edab65561cb149db399x720x668.GIF"
    ]
  },
  {
    "text": "A 34-year-old man sustains facial burns and is being planned for reconstruction with a skin graft. Which type of graft should he receive to achieve a better cosmetic appearance and minimal contraction?",
    "choices": [
      {
        "id": 1,
        "text": "Wolfe graft"
      },
      {
        "id": 2,
        "text": "Thiersch graft"
      },
      {
        "id": 3,
        "text": "Composite graft"
      },
      {
        "id": 4,
        "text": "Blair-Brown graft"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient should receive a <strong>Wolfe graft</strong> to achieve a better cosmetic appearance and minimal contraction. Wolfe grafts are full-thickness skin grafts that are used for small areas of skin replacement where good elastic skin that will not contract is required (such as fingers, eyelids, and facial parts).</p>\n<table style=\"width: 380px; height: 579px;\">\n<tbody>\n<tr style=\"height: 54px;\">\n<td style=\"width: 76px; height: 54px;\">&nbsp;</td>\n<td style=\"width: 126.217px; height: 54px;\"><strong>Full-thickness skin graft (Wolfe)</strong></td>\n<td style=\"width: 148.783px; height: 54px;\"><strong>Split thickness skin graft (Thiersche)</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 76px; height: 54px;\">Structure</td>\n<td style=\"width: 126.217px; height: 54px;\">Epidermis + <strong>complete dermis</strong> &plusmn; fat</td>\n<td style=\"width: 148.783px; height: 54px;\">Epidermis + <strong>part of dermis</strong></td>\n</tr>\n<tr style=\"height: 61px;\">\n<td style=\"width: 76px; height: 61px;\">Donor site location</td>\n<td style=\"width: 126.217px; height: 61px;\">Post auricular, supra/infra-clavicular.&nbsp;<br />Never axillary</td>\n<td style=\"width: 148.783px; height: 61px;\">Thigh &gt; buttocks</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 76px; height: 54px;\">Donor site wound</td>\n<td style=\"width: 126.217px; height: 54px;\">Must be sutured</td>\n<td style=\"width: 148.783px; height: 54px;\">Requires only dressing and can be reused</td>\n</tr>\n<tr style=\"height: 74.0417px;\">\n<td style=\"width: 76px; height: 74.0417px;\">Recipient site</td>\n<td style=\"width: 126.217px; height: 74.0417px;\">Must be well vascularised. Small area</td>\n<td style=\"width: 148.783px; height: 74.0417px;\">May be inadequately vascularized. Larger area (achieved by meshing)</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Graft features</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 76px; height: 18px;\">Durability</td>\n<td style=\"width: 126.217px; height: 18px;\">High</td>\n<td style=\"width: 148.783px; height: 18px;\">Low</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Contracture</td>\n<td style=\"width: 126.217px; height: 36px;\">Primary &gt; secondary</td>\n<td style=\"width: 148.783px; height: 36px;\">High secondary contracture</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Uptake</td>\n<td style=\"width: 126.217px; height: 36px;\">Require more care to ensure uptake</td>\n<td style=\"width: 148.783px; height: 36px;\">High-reliability</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Cosmetic result</td>\n<td style=\"width: 126.217px; height: 36px;\">Good</td>\n<td style=\"width: 148.783px; height: 36px;\">Poor (abnormal pigmentation)</td>\n</tr>\n</tbody>\n</table>\n<p>Option B: Partial-thickness skin grafts or split-thickness grafts are called <strong>Thiersch grafts</strong>. They consist of the epidermis and a portion of the dermis. They tend to heal with <strong>abnormal pigmentation</strong> and result in suboptimal cosmetic appearance.</p>\n<p>Option C: <strong>Composite grafts</strong> are grafts that contain <strong>skin and fat</strong> or <strong>skin and cartilage</strong>. They are often taken from the ear margin and useful for rebuilding missing elements of the nose, eyelids, and fingertips.</p>\n<p>Option D: <strong>Blair-Brown grafts</strong> are a type of <strong>intermediate</strong> <strong>thickness</strong> split skin graft.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common cause of skin graft failure is ____",
    "choices": [
      {
        "id": 1,
        "text": "Hematoma"
      },
      {
        "id": 2,
        "text": "Infection"
      },
      {
        "id": 3,
        "text": "Graft movement"
      },
      {
        "id": 4,
        "text": "Poor quality of the recipient bed"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common cause of skin graft failure is<strong> hematoma</strong> under the graft, where the <strong>blood clot is a barrier </strong>to contact of the graft and bed for revascularization.</p>\n<p>Other&nbsp;causes are shearing or movement of the graft on the bed, infection, poor quality of the recipient bed, and characteristics of the graft itself, such as&nbsp;thickness or&nbsp;vascularity&nbsp;of the donor site.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old lady sustained extensive burns over her left forearm for which a split-thickness skin graft was planned. During surgery, after obtaining a skin graft from the anterior thigh, the patient became hemodynamically unstable and a transplant to the forearm could not be completed. What would you do with the harvested graft?",
    "choices": [
      {
        "id": 1,
        "text": "It must be discarded and fresh graft harvested before repeat surgery"
      },
      {
        "id": 2,
        "text": "It can be stored for up to 2-3 days at +4\u00b0C in saline"
      },
      {
        "id": 3,
        "text": "It can be stored for up to 2-3 weeks at +4\u00b0C in saline"
      },
      {
        "id": 4,
        "text": "It can be stored for 2-3 months at +4\u00b0C in saline"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The harvested graft can be stored at <strong>+4&deg;C</strong> in refrigeration after <strong>wrapping</strong> it in a <strong>sterile gauze</strong> <strong>pad moistened</strong> with<strong> saline</strong>. The process of harvesting and storing skin grafts is called <strong>skin banking</strong>. Skin banks store grafts using various methods. Most commonly preferred is to store the graft for up to<strong> 2-3 weeks at +4&deg;C.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true with respect to a skin graft harvested from the post-auricular area?",
    "choices": [
      {
        "id": 1,
        "text": "Harvested using Humby knife"
      },
      {
        "id": 2,
        "text": "Donor site must be sutured"
      },
      {
        "id": 3,
        "text": "Lower rates of graft failure"
      },
      {
        "id": 4,
        "text": "Secondary contracture is more common"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Graft harvested from the <strong>postauricular area</strong> is a <strong>full-thickness skin graft</strong>. As it <strong>involves</strong> harvesting the <strong>complete dermis</strong> <strong>donor site needs to be sutured</strong> following harvest.</p>\n<table style=\"width: 380px; height: 579px;\">\n<tbody>\n<tr style=\"height: 54px;\">\n<td style=\"width: 76px; height: 54px;\">&nbsp;</td>\n<td style=\"width: 126.217px; height: 54px;\"><strong>Full-thickness skin graft (Wolfe)</strong></td>\n<td style=\"width: 148.783px; height: 54px;\"><strong>Split thickness skin graft (Thiersche)</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 76px; height: 54px;\">Structure</td>\n<td style=\"width: 126.217px; height: 54px;\">Epidermis + <strong>complete dermis</strong> &plusmn; fat</td>\n<td style=\"width: 148.783px; height: 54px;\">Epidermis + <strong>part of dermis</strong></td>\n</tr>\n<tr style=\"height: 61px;\">\n<td style=\"width: 76px; height: 61px;\">Donor site location</td>\n<td style=\"width: 126.217px; height: 61px;\">Post auricular, supra/infra-clavicular.&nbsp;<br />Never axillary</td>\n<td style=\"width: 148.783px; height: 61px;\">Thigh &gt; buttocks</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 76px; height: 54px;\">Donor site wound</td>\n<td style=\"width: 126.217px; height: 54px;\">Must be sutured</td>\n<td style=\"width: 148.783px; height: 54px;\">Requires only dressing and can be reused</td>\n</tr>\n<tr style=\"height: 74.0417px;\">\n<td style=\"width: 76px; height: 74.0417px;\">Recipient site</td>\n<td style=\"width: 126.217px; height: 74.0417px;\">Must be well vascularised. Small area</td>\n<td style=\"width: 148.783px; height: 74.0417px;\">May be inadequately vascularized. Larger area (achieved by meshing)</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Graft features</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 76px; height: 18px;\">Durability</td>\n<td style=\"width: 126.217px; height: 18px;\">High</td>\n<td style=\"width: 148.783px; height: 18px;\">Low</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Contracture</td>\n<td style=\"width: 126.217px; height: 36px;\">Primary &gt; secondary</td>\n<td style=\"width: 148.783px; height: 36px;\">High secondary contracture</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Uptake</td>\n<td style=\"width: 126.217px; height: 36px;\">Require more care to ensure uptake</td>\n<td style=\"width: 148.783px; height: 36px;\">High-reliability</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 76px; height: 36px;\">Cosmetic result</td>\n<td style=\"width: 126.217px; height: 36px;\">Good</td>\n<td style=\"width: 148.783px; height: 36px;\">Poor (abnormal pigmentation)</td>\n</tr>\n</tbody>\n</table>\n<p><br />&nbsp;Option A: <strong>Humby knife</strong> is used to harvest <strong>split-thickness skin grafts</strong> (Thiersche grafts).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d22782707b045fbbe58e6588fdd19dax720x710.PNG"
    ]
  },
  {
    "text": "A child is being prepared for a Millard\u2019s repair as seen in the image. The factors influencing the development of his condition are all except __________________.",
    "choices": [
      {
        "id": 1,
        "text": "Smoking during pregnancy"
      },
      {
        "id": 2,
        "text": "Infections during pregnancy"
      },
      {
        "id": 3,
        "text": "Vitamin A deficiency during pregnancy"
      },
      {
        "id": 4,
        "text": "Increased parental age"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vitamin A deficiency</strong> during pregnancy is not a factor influencing the development of cleft lip/palate. Millard&rsquo;s repair is the most common surgical repair of cleft lip and is usually performed between 3 to 6 months of age.</p>\n<p>The cause of orofacial clefting is felt to be <strong>multifactorial</strong>. Factors that likely increase the incidence of clefting include increased parental age, drug use and infections during pregnancy, and smoking during pregnancy.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e239e60e1d5e4141875fb9515dd0e500.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The given image shows a forearm flap harvested for the reconstruction of the oral cavity of a 45-year-old patient with squamous cell carcinoma. Identify the type of flap.",
    "choices": [
      {
        "id": 1,
        "text": "Axial flap"
      },
      {
        "id": 2,
        "text": "Islanded flap"
      },
      {
        "id": 3,
        "text": "Free flap"
      },
      {
        "id": 4,
        "text": "Random flap"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The picture shows a radial forearm <strong>free flap</strong>. Fasciocutaneous radial forearm free flap is the most common free flap used in head and neck reconstruction.&nbsp;</p>\n<p>A flap defines the tongue of tissue whereas a pedicle is used to describe the base or stem with the vascular supply.</p>\n<p>In a <strong>free flap</strong>, the blood supply is isolated, disconnected, and then reconnected using microsurgery at the new site. Other Eg for free flaps: free fibular flap, DIEP flap (Deep inferior epigastric perforators)</p>\n<p>Option A:<strong> Axial flaps</strong> are much longer and are based on known blood vessels. Eg: Latissmus Dorsi flap, TRAM (Transverse rectus abdominis myocutaneous) flap.</p>\n<p>Option B: An <strong>islanded flap</strong> is that in which the axial blood supply is swung round on a stalk.</p>\n<p>Option D: A<strong> random flap</strong> includes three sides of a rectangle, bearing no specific relationship to where the blood supply enters. Eg: V-Y plasty, Z plasty, Limberg, or rhomboid flap.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9b8d5a8449b645e0a9f581c7cb4edf79.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38a465d7aeef48e38e7ebd9b07c4908ex1280x4958.JPEG"
    ]
  },
  {
    "text": "The flap shown in the picture is which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Serratus anterior flap"
      },
      {
        "id": 2,
        "text": "Pectoral myocutaneous  flap"
      },
      {
        "id": 3,
        "text": "TRAM flap"
      },
      {
        "id": 4,
        "text": "VRAM flap"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<table style=\"height: 395px; width: 609px;\">\n<tbody>\n<tr style=\"height: 13px;\">\n<td style=\"width: 185.062px; height: 13px;\" colspan=\"3\">\n<p><strong>Classification of muscle flaps</strong></p>\n</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 185.062px; height: 13px;\"><strong>Based on blood supply</strong></td>\n<td style=\"width: 181.938px; height: 13px;\">\n<p><strong>Random flap\u00a0</strong></p>\n<p>Unnamed vessel supplying flap</p>\n</td>\n<td style=\"width: 230px; height: 13px;\">\n<p><strong>Axial flap</strong></p>\n<p>Named vessel supplying flap.\u00a0 \u00a0\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 108.4px;\">\n<td style=\"width: 185.062px; height: 108.4px;\">\u00a0\n<p><strong>Method of movement</strong></p>\n</td>\n<td style=\"width: 181.938px; height: 108.4px;\">\n<p><strong>Local transfer\u00a0</strong></p>\n<p>Rotation flap</p>\n<p>Transposition flap</p>\n<p>Advancement flap</p>\n</td>\n<td style=\"width: 230px; height: 108.4px;\">\n<p><strong>Distant transfer\u00a0</strong></p>\n<p>Pedicle flap</p>\n<p>Free flap</p>\n<p>\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 13px;\">\n<td style=\"width: 185.062px; height: 13px;\">\n<p><strong>Based on composition</strong></p>\n\u00a0</td>\n<td style=\"width: 181.938px; height: 13px;\">\n<p><strong>Simple Flap</strong></p>\n<p>Cutaneous flap</p>\n<p>Musculocutaneous\u00a0</p>\n<p>Fasciocutaneous</p>\n</td>\n<td style=\"width: 230px; height: 13px;\">\n<p><strong>Composite flap</strong></p>\n<p>Osseocutaneous flap</p>\n<p>Sensory flap</p>\n<p>\u00a0</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/94ad53221e514ac3a77321bc5db3053f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image shows a surgical technique used to release Dupuytren's contracture. Which of the following statements is true regarding this?",
    "choices": [
      {
        "id": 1,
        "text": "It can also be used in the surgical management of keloid scars and contractures"
      },
      {
        "id": 2,
        "text": "It reorients the direction of the central wound by 90 degrees"
      },
      {
        "id": 3,
        "text": "Triangular flaps created using 60 degrees can lengthen the scar by 50%"
      },
      {
        "id": 4,
        "text": "It is a type of local advancement flap"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows a typical example of a <strong>Z Plasty.</strong></p>\n<p>It is a type of <strong>transposition flap</strong> that incorporates qualities of both advancement and rotation flaps. Z plasty is used for the <strong>lengthening of linear scars</strong>. It is best used in releasing simple contractures.</p>\n<p>Usually, all the limbs are of equal length and ideally, the angle between them is 60&deg;. Two triangular flaps are raised.&nbsp;Theoretically, a <strong>60-degree angle</strong> flap will result in a <strong>75% increase</strong> in the length of the scar and a <strong>90-degree reorientation of central wound.</strong></p>\n<p>Angles smaller than 60 degrees are easier to transpose but result in less lengthening and realignment of the scar to less than 90 degrees. Angles larger than 60 degrees should be avoided because the force required to transpose the flaps increases markedly, making the closure of the wound difficult.&nbsp;</p>\n<p>Relative contraindications to Z-plasty include patients with <strong>keloids</strong> and hypertrophic scarring tendencies.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37201123fb36416f88b9ec4abbbe78bd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c7eaf0c200347cf83fbc89918e701b0x510x468.GIF"
    ]
  },
  {
    "text": "A truck driver undergoes a Limberg flap operation using a random flap for recurrent pilonidal sinus infections. What is the generally accepted safe and reliable length: width ratio for this type of flap?",
    "choices": [
      {
        "id": 1,
        "text": "1.5:1"
      },
      {
        "id": 2,
        "text": "2:1"
      },
      {
        "id": 3,
        "text": "3:1"
      },
      {
        "id": 4,
        "text": "2.5:1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The Limberg flap is a type of <strong>random flap</strong> and the safe and reliable length:width ratio for the random flap<strong> 3:1</strong>.</p>\n<p>Random pattern flaps have a blood supply based on <strong>small, unnamed blood vessels</strong> in the dermal-subdermal plexus, as opposed to the discrete, well described, directional vessels of axial pattern flaps. As random flaps have a variable blood supply, they need an <strong>adequate base (width)</strong> to survive.</p>\n<p>The rhomboid (Limberg) flap involves creating a skin flap with two opposing angles of 60\u00b0 and 120\u00b0 at the corners, forming a rhomboid shape positioned directly next to the defect. The design allows the flap to be rotated into the defect, with the donor site closed primarily, ensuring minimal distortion to the surrounding tissues. This method is especially useful in areas like the gluteal region, where complex closure techniques help achieve optimal results.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A free flap is used to resurface a tendoachilles defect in a 58-year-old chronic smoker. As a first-year surgical resident, you are asked to monitor the flap for venous occlusion. Which of the following should you be looking out for?",
    "choices": [
      {
        "id": 1,
        "text": "Increasing warmth"
      },
      {
        "id": 2,
        "text": "Increasing paleness"
      },
      {
        "id": 3,
        "text": "Increasing coolness"
      },
      {
        "id": 4,
        "text": "Increasing sluggishness of pinprick bleeding"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The first sign of <strong>venous occlusion</strong> in a free flap is <strong>increasing warmth.</strong></p>\n<p class=\"p1\">Clinical signs of arterial and venous compromise in a free flap:</p>\n<table style=\"height: 199px;\" width=\"482\">\n<tbody>\n<tr>\n<td style=\"width: 153.295px;\">\n<p class=\"p1\"><strong>Clinical Sign</strong></p>\n</td>\n<td style=\"width: 153.295px;\"><strong>Arterial Compromise</strong></td>\n<td style=\"width: 154.205px;\"><strong>Venous Compromise</strong></td>\n</tr>\n<tr>\n<td style=\"width: 153.295px;\">\n<p class=\"p1\">Color</p>\n</td>\n<td style=\"width: 153.295px;\">Becoming paler</td>\n<td style=\"width: 154.205px;\">Increasingly reddish&nbsp;or purplish</td>\n</tr>\n<tr>\n<td style=\"width: 153.295px;\">\n<p class=\"p1\">Temperature&nbsp;</p>\n</td>\n<td style=\"width: 153.295px;\">Becoming cooler</td>\n<td style=\"width: 154.205px;\">Becoming warmer</td>\n</tr>\n<tr>\n<td style=\"width: 153.295px;\">\n<p>Tissue turgor&nbsp;&nbsp;</p>\n</td>\n<td style=\"width: 153.295px;\">Reducing</td>\n<td style=\"width: 154.205px;\">Increasing</td>\n</tr>\n<tr>\n<td style=\"width: 153.295px;\">\n<p class=\"p1\">Capillary refill time</p>\n</td>\n<td style=\"width: 153.295px;\">Becoming slower&nbsp;</td>\n<td style=\"width: 154.205px;\">Becoming faster</td>\n</tr>\n<tr>\n<td style=\"width: 153.295px;\">\n<p class=\"p1\">Pinprick bleeding</p>\n</td>\n<td style=\"width: 153.295px;\">\n<p class=\"p1\">Increasingly sluggish</p>\n</td>\n<td style=\"width: 154.205px;\">\n<p class=\"p1\">Quickening (and darkening)</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p class=\"p1\">Note: Venous and arterial compromise may coexist, and one may lead to the other.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about the flap given in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Pedicled TRAM based on superior epigastric artery"
      },
      {
        "id": 2,
        "text": "Free TRAM based on superior and inferior epigastric artery"
      },
      {
        "id": 3,
        "text": "DIEP based on deep inferior epigastric artery"
      },
      {
        "id": 4,
        "text": "Lower Abdominal Fat based inferior epigastric vessels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image showing only skin and fat moved to the chest is suggestive of a\u00a0<strong>deep inferior epigastric artery perforator flap</strong> (DIEP), based on<strong>\u00a0</strong>the<strong> deep inferior epigastric artery.</strong></p>\n<p>DIEP is a variant of TRAM flap and free flap where only the <strong>skin</strong> and <strong>fat</strong> are moved to the chest. A<strong>\u00a0microvascular technique</strong> is used in which <strong>no muscle is taken</strong> and the perforating vessels are dissected out.</p>\n<p>As the muscle is spared in DIEP, there is<strong>\u00a0</strong>a <strong>reduced risk of abdominal wall weakness</strong> and its associated complications.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Options A and B: The<strong> pedicled\u00a0TRAM flap</strong> is based on the superior epigastric artery and the <strong>free TRAM flap</strong> is based on superior and inferior epigastric arteries (supercharged TRAM flap); however, the given image depicts a deep inferior epigastric artery flap. In TRAM flaps:\u00a0</p>\n<ul>\n<li>The <strong>skin</strong>, <strong>fat,</strong> and <strong>muscle</strong> are moved to the chest.</li>\n<li>It provides good cosmesis and bulk since it has a soft tissue consistency similar to the breast.</li>\n<li>Disadvantages include epigastric bulge, partial flap loss, fat necrosis, abdominal wall weakness, and hernias.</li>\n</ul>\n<p>The given image below shows a TRAM flap:\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5bf83a483d1b47beb5a8c67096f0d29a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bd753d65292d41a180d9a45f7d268338x1280x1547.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman who underwent a skin-sparing mastectomy a year ago has returned to your clinic to discuss her options for breast reconstruction. All of the following are options to consider except:",
    "choices": [
      {
        "id": 1,
        "text": "A TRAM flap provides the best cosmetic result than LD flap"
      },
      {
        "id": 2,
        "text": "An LD flap provides adequate bulk of breast tissue"
      },
      {
        "id": 3,
        "text": "Reconstruction may be delayed or immediate"
      },
      {
        "id": 4,
        "text": "Capsular contraction is a dreaded complication of silicone implants"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The timing of reconstruction<strong>&nbsp;may be immediate or delayed</strong>. Impediments to immediate reconstruction include insufficient theatre time and a lack of experienced reconstructive surgeons. In addition, the patient is likely to need post-op radiotherapy, then a delayed reconstruction using a flap often gives better results.</p>\n<p>The easiest type of reconstruction is using a <strong>silicone gel implant under the pectoralis major muscle</strong>. Capsular contraction is a dreaded complication of silicone implants.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/173f8c208dfb4aec85dc9d4073226836x814x664.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b302d387c19045a8b392cff8b0efb11bx878x1006.PNG"
    ]
  },
  {
    "text": "A 35-year-old man with osteosarcoma of the mandibular ramus is planned for resection and reconstruction with a flap. The flap used most commonly in mandibular reconstruction is based on which of the following vascular structures?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior tibial artery"
      },
      {
        "id": 2,
        "text": "Peroneal artery"
      },
      {
        "id": 3,
        "text": "Posterior tibial artery"
      },
      {
        "id": 4,
        "text": "Dorsalis pedis artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most commonly used osseous flap for <strong>mandibular reconstruction</strong> is the <strong>fibular free flap</strong>. The fibular free flap is based on the <strong>peroneal artery and vein</strong>, and the blood supply to the foot should be investigated before harvesting this flap.</p>\n<p>Common flaps and their uses</p>\n<table style=\"width: 412.389px;\">\n<tbody>\n<tr>\n<td style=\"width: 122px;\"><strong>Name of flap</strong></td>\n<td style=\"width: 134px;\"><strong>Use</strong></td>\n<td style=\"width: 130.389px;\"><strong>Based on</strong></td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Pectoralis major myocutaneous&nbsp;</td>\n<td style=\"width: 134px;\">Head and neck reconstruction</td>\n<td style=\"width: 130.389px;\">Pectoral branch of thoracoacromial artery</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Deltopectoral&nbsp;</td>\n<td style=\"width: 134px;\">Head and neck reconstruction</td>\n<td style=\"width: 130.389px;\">Internal mammary vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Radial forearm&nbsp;</td>\n<td style=\"width: 134px;\">Head and neck reconstruction</td>\n<td style=\"width: 130.389px;\">Radial vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Abbe Estlander&nbsp;</td>\n<td style=\"width: 134px;\">Midline lip and angle of mouth reconstruction</td>\n<td style=\"width: 130.389px;\">Labial vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Karapandzic&nbsp;</td>\n<td style=\"width: 134px;\">Lip reconstruction</td>\n<td style=\"width: 130.389px;\">Labial vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Transverse rectus abdominis myocutaneous (TRAM)</td>\n<td style=\"width: 134px;\">Breast reconstruction (most commonly used flap)</td>\n<td style=\"width: 130.389px;\">Superior epigastric vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Free TRAM</td>\n<td style=\"width: 134px;\">Breast reconstruction</td>\n<td style=\"width: 130.389px;\">Inferior epigastric vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Lattisimus dorsi&nbsp;</td>\n<td style=\"width: 134px;\">Breast reconstruction</td>\n<td style=\"width: 130.389px;\">Thoracodorsal vessels</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Deep inferior epigastric artery</td>\n<td style=\"width: 134px;\">Breast reconstruction</td>\n<td style=\"width: 130.389px;\">Deep inferior epigastric artery perforators</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">Free fibular&nbsp;</td>\n<td style=\"width: 134px;\">Mandibular reconstruction&nbsp; Andy Gump deformity</td>\n<td style=\"width: 130.389px;\">Peroneal vessels</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;The <strong>free fibular flap</strong> may also be used to correct the <strong>Andy Gump</strong> deformity. It is an <strong>anterior mandibular defect</strong> that creates the <strong>appearance of an absent chin and lower lip</strong> and <strong>severely retrognathic lower jaw</strong>, which is named after a character in an early 20th-century comic strip.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1bbbee37c7fb4ae6bf589b674a83d13cx900x1190.PNG"
    ]
  },
  {
    "text": "A 56-year-old patient suffering from alcoholic cirrhosis receives a healthy liver from his biological son. What is this type of transplant known as?",
    "choices": [
      {
        "id": 1,
        "text": "Autograft"
      },
      {
        "id": 2,
        "text": "Allograft"
      },
      {
        "id": 3,
        "text": "Xenograft"
      },
      {
        "id": 4,
        "text": "Isograft"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Transplant of an organ/tissue from a son to a parent is an example of an<strong> allograft.</strong></p>\n<p>An allograft is transplant of cells/tissues/organs from a <strong>genetically non-identical donor</strong> of the same species.</p>\n<p>Isografts are allografts in which cells/tissues/organs are transplanted from a donor to a genetically identical recipient. (monozygotic twins)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What incision would you make to excise a lesion on the bridge of the nose, in order to cause minimal scarring?",
    "choices": [
      {
        "id": 1,
        "text": "Vertical"
      },
      {
        "id": 2,
        "text": "Horizontal"
      },
      {
        "id": 3,
        "text": "Oblique"
      },
      {
        "id": 4,
        "text": "Circular"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span style=\"font-size: 12pt;\">A <strong>horizontal incision</strong> should be taken as the relaxed skin tension lines (Borge's lines) at the bridge of the nose are <strong>horizontal</strong>.</span></p>\n<p><span style=\"font-size: 12pt;\">Aligning a surgical incision or excision with skin tension lines results in <strong>minimal tension</strong> across the closure of the defect. This leads to <strong>optimal scar formation</strong> and <strong>minimizes wound contraction.</strong></span></p>\n<p><span style=\"font-size: 12pt;\">Skin tension lines reflect internal tension within the skin and are produced by the parallel alignment of&nbsp;<span class=\"term tooltipstered\" data-term-id=\"43\">connective tissue</span>&nbsp;of the&nbsp;<span class=\"term tooltipstered\" data-term-id=\"61\">dermis. Several different skin tension lines have been described.&nbsp;<strong>Borge's lines</strong> which are also called <strong>relaxed skin tension lines are most useful to guide surgical incision.&nbsp;</strong>These are often confused with Langer's lines.</span></span></p>\n<p><span style=\"font-size: 12pt;\">Langer's lines, also called <strong>cleavage lines</strong>&nbsp;are topological lines drawn based on the shape of wounds on cadavers. These were not intended as a guide for surgical incisions and they do not always correspond to the best orientation of skin tension and often run perpendicular to skin folds.&nbsp;</span><span style=\"font-size: 12pt;\"><span class=\"term tooltipstered\" data-term-id=\"61\">On the face, these two sets of lines often run at right angles to one another.</span></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bf98b66c9bf499194f9b475091e5e5dx1280x2908.JPEG"
    ]
  },
  {
    "text": "A plastic surgeon performs an upper eyelid reconstruction using a tarsoconjunctival flap for a patient who underwent a sebaceous gland carcinoma excision. What is the maximum tissue loss for which a primary repair would have sufficed?",
    "choices": [
      {
        "id": 1,
        "text": "<5%"
      },
      {
        "id": 2,
        "text": "<10%"
      },
      {
        "id": 3,
        "text": "<25%"
      },
      {
        "id": 4,
        "text": "<40%"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Defects comprising <strong>&lt;25%</strong> of the upper eyelid can generally be closed <strong>primarily</strong> in pentagonal approximating fashion.</p>\n<p>For defects involving <strong>25&ndash;50% </strong>of the upper eyelid, lateral canthotomy and cantholysis can be performed.</p>\n<p>Defects <strong>more than 50% </strong>need proper flap cover.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brings her 3-week-old baby to the pediatrics OPD, with a lesion on his abdomen which has been growing in size since birth. On examination, the lesion is red, nodular, and blanches on pressure. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Local resection with carbon dioxide laser"
      },
      {
        "id": 2,
        "text": "En bloc excision with skin grafting"
      },
      {
        "id": 3,
        "text": "Emollient application and intralesional triamcinalone"
      },
      {
        "id": 4,
        "text": "Monitoring of the lesion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical picture is suggestive of <strong>infantile hemangioma.</strong> Only <strong>monitoring</strong> of the lesion is required as in 50% of cases, complete <strong>involution is seen by 5 years</strong> of age.</p>\n<p>Hemangioma growth frequently peaks before the first year, and then the lesions enter the involuting phase. The involution phase begins in 50% of children by 5 years of age and in 70% by 7 years of age. It continues until 10 years of age.</p>\n<p>Indications for immediate treatment are complications such as ulceration or those pertaining to the location of the mass (e.g. visual issues due to large hemangioma over eyelid).</p>\n<p>Treatment options include:</p>\n<ul>\n<li><strong>Beta blockers&nbsp;</strong>- oral propranolol</li>\n<li><strong>Steroids&nbsp;</strong>- intralesional triamcinolone, topical clobetasol, systemic steroids</li>\n<li><strong>Interferon alfa-2a and vincristine&nbsp;</strong>- for steroid-resistant lesions</li>\n<li><strong>Local resection</strong>&nbsp;with cutting cautery or carbon dioxide laser</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/48702bcae0e04a5e90ce95c86d9ce453.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = '48 Reconstructive Surgery';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>