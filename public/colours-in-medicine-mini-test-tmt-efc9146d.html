<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colours In Medicine Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A child is brought to the OPD because of repeated attacks of dermatitis. On examination, ulceration and scarring can be seen on the sun-exposed areas like his face and limbs. He also has reddish-brown discolouration of teeth. On investigation, urine discoloration is observed as shown in the image below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Polycystic kidney disease"
      },
      {
        "id": 2,
        "text": "Congenital erythropoietic porphyria"
      },
      {
        "id": 3,
        "text": "Paroxysmal nocturnal hematuria"
      },
      {
        "id": 4,
        "text": "Myoglobinuria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows reddish discoloration of urine known as a <strong>port-wine appearance</strong>. The clinical scenario describes <strong>photosensitivity</strong> and <strong>erythrodontia </strong>(<span style=\"background-color: #ba372a;\"><span style=\"background-color: #ffffff;\">reddish-brown </span></span>discoloration of teeth). All these features are suggestive of <strong>congenital erythropoietic porphyria</strong>.</p>\n<p>Congenital erythropoietic porphyria also known as\u00a0<strong>Gunther's disease</strong>\u00a0is\u00a0<strong>autosomal recessive</strong>\u00a0porphyria due to the\u00a0<strong>uroporphyrinogen III synthase</strong>\u00a0defect. It presents with\u00a0<strong>non-immune hydrops</strong>\u00a0in utero or shortly after birth.\u00a0<strong>Severe cutaneous photosensitivity</strong>\u00a0is present.\u00a0<strong>Uroporphyrin I and coproporphyrin I</strong>\u00a0accumulate in teeth, bone marrow, erythrocytes, plasma urine, and feces.</p>\n<p>The most characteristic presentation is <strong>port-wine\u00a0urine</strong>\u00a0or <strong>pink staining\u00a0</strong>of diapers by urine. <strong>Reddish-brown teeth</strong> are seen under normal light and when illuminated with UV light, the teeth show a\u00a0<strong>reddish fluorescence</strong> phenomenon known as erythrodontia (as shown in the image below).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c14875d1d84e4c5a884cceb038c04773.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7bb06248d2c74a1996bb3ae8d66d684cx422x713.PNG"
    ]
  },
  {
    "text": "According to the Anemia Mukt Bharat Scheme, which of the following IFA (Iron Folic acid) tablets is to be given to a lactating mother of a 3-month-old infant?",
    "choices": [
      {
        "id": 1,
        "text": "1\u00a0red color IFA tablet weekly"
      },
      {
        "id": 2,
        "text": "1 red\u00a0color IFA tablet daily"
      },
      {
        "id": 3,
        "text": "1 pink\u00a0color IFA tablet weekly"
      },
      {
        "id": 4,
        "text": "1 blue\u00a0color IFA tablet weekly"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the Anemia Mukt Bharat Scheme,&nbsp;<strong>lactating mothers</strong> of 0 to 6-month-old children are given a&nbsp;<strong>daily </strong>dose&nbsp;of&nbsp;<strong><span style=\"background-color: #ff0000;\">red</span> color </strong>IFA tablet containing&nbsp;<strong>60 mg</strong> of elemental <strong>iron</strong> and <strong>500</strong>&nbsp;<strong>mcg</strong> of folic acid.</p>\n<p><strong>Weekly </strong>doses of<strong> red color </strong>IFA tablets (Option A) containing&nbsp;<strong>60 mg</strong> of elemental <strong>iron</strong> and <strong>500 mcg</strong> of <strong>folic acid</strong> are given to<strong> women of&nbsp;reproductive&nbsp;age&nbsp;</strong>(non-pregnant, non-lactating), between&nbsp;<strong>20-49 years</strong> of age.</p>\n<p><strong>Children&nbsp;</strong>between<strong>&nbsp;5-9 years of age</strong>&nbsp;are given <strong><span style=\"background-color: #ff00ff;\">pink</span> color</strong> (Option C) sugar-coated tablets containing&nbsp;<strong>45 mg </strong>of elemental <strong>iron </strong>and<strong> 400 mcg </strong>of<strong> folic acid</strong>&nbsp;tablets&nbsp;<strong>once a&nbsp;week</strong>.</p>\n<p><strong><span style=\"background-color: #00ccff;\">Blue</span>&nbsp;color</strong> (Option D) tablets containing&nbsp;<strong>60 mg</strong> of elemental <strong>iron</strong> and <strong>500 mcg</strong> of <strong>folic acid</strong> can be given to <strong>school-going</strong> adolescent <strong>girls</strong> and <strong>boys</strong> of 10-19 years and <strong>out-of-school adolescent girls</strong> of age 10-19 years.</p>\n<p>The <strong>Anemia Mukt Bharat scheme</strong>&nbsp;is an initiative that aims to <strong>strengthen</strong> the existing mechanisms and foster newer strategies for <strong>tackling anemia</strong>. It focuses on <strong>six</strong> <strong>target</strong> <strong>beneficiary</strong> <strong>groups</strong>, through <strong>six interventions</strong> and <strong>six institutional</strong> mechanisms to achieve their target by 2022.</p>\n<p>Interventions include:</p>\n<ul>\n<li>Prophylactic <strong>iron </strong>and<strong> folic acid</strong> supplementation.</li>\n<li><strong>Deworming.</strong></li>\n<li>Intensified year-round Behaviour Change Communication Campaign (Solid Body, Smart Mind) including ensuring<strong> delayed cord clamping</strong> in newborns.</li>\n<li><strong>Testing</strong> of <strong>anemia</strong> using digital methods and point-of-care treatment.</li>\n<li>Mandatory provision of Iron and Folic Acid <strong>fortified foods</strong> in government-funded health programs.</li>\n<li>Addressing <strong>non-nutritional</strong> <strong>causes</strong> of anemia in endemic pockets, with a special focus on malaria, hemoglobinopathies, and fluorosis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Arrange the following colour codes used in triage in the increasing order of priority starting with the least priority.",
    "choices": [
      {
        "id": 1,
        "text": "2 ->1 -> 4 ->3"
      },
      {
        "id": 2,
        "text": "4 ->3 ->1 ->2"
      },
      {
        "id": 3,
        "text": "2 ->4 ->3 ->1"
      },
      {
        "id": 4,
        "text": "2 ->1 ->3 ->4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct sequence of triage color coding priority is <span style=\"color: #ffffff; background-color: #000000;\"><strong>black</strong></span> (least priority) -&gt; <span style=\"background-color: #2dc26b;\"><strong>Green</strong></span> -&gt; <span style=\"background-color: #ffff00;\"><strong>Yellow</strong></span> -&gt; <span style=\"background-color: #f8cac6;\"><strong>Red</strong></span>(Highest Priority)</p>\n<p>Triage means &lsquo;to sort&rsquo; and is essential in the management of <strong>mass casualties</strong>. It aims to identify the patients in whom <strong>treatment at the earliest</strong> produces the <strong>maximum benefit</strong>. It is carried out at the site of the disaster to determine the <strong>priority</strong> for<strong> immediate medical attention</strong>, <strong>transportation</strong>, and <strong>admission</strong> to the hospital.</p>\n<p>Triage includes <strong>rapid classification</strong> of the injured based on their <strong>injuries</strong> and the <strong>chances of survival</strong> with prompt medical intervention.&nbsp;</p>\n<table style=\"height: 489px; width: 388px;\">\n<tbody>\n<tr style=\"height: 17px;\">\n<td style=\"width: 69.328125px; height: 17px;\"><strong>Priority</strong></td>\n<td style=\"width: 61.203125px; height: 17px;\"><strong>Colour</strong></td>\n<td style=\"width: 114.03125px; height: 17px;\"><strong>Medical need</strong></td>\n<td style=\"width: 115.484375px; height: 17px;\"><strong>Clinical status</strong></td>\n</tr>\n<tr style=\"height: 69px;\">\n<td style=\"width: 69.328125px; height: 69px;\">First (I)</td>\n<td style=\"width: 61.203125px; height: 69px;\"><span style=\"background-color: #f8cac6;\">Red</span></td>\n<td style=\"width: 114.03125px; height: 69px;\">Immediate</td>\n<td style=\"width: 115.484375px; height: 69px;\">Critical, but likely to survive if the treatment given early</td>\n</tr>\n<tr style=\"height: 52px;\">\n<td style=\"width: 69.328125px; height: 52px;\">Second (II)</td>\n<td style=\"width: 61.203125px; height: 52px;\"><span style=\"background-color: #ffff00;\">Yellow</span></td>\n<td style=\"width: 114.03125px; height: 52px;\">Urgent</td>\n<td style=\"width: 115.484375px; height: 52px;\">Critical, likely to survive if the treatment given within hours</td>\n</tr>\n<tr style=\"height: 47px;\">\n<td style=\"width: 69.328125px; height: 47px;\">Third (III)</td>\n<td style=\"width: 61.203125px; height: 47px;\"><span style=\"background-color: #2dc26b;\">Green</span></td>\n<td style=\"width: 114.03125px; height: 47px;\">Non-urgent</td>\n<td style=\"width: 115.484375px; height: 47px;\">Stable, likely to survive even if treatment is delayed for hours to days</td>\n</tr>\n<tr style=\"height: 73px;\">\n<td style=\"width: 69.328125px; height: 73px;\">Last (0)</td>\n<td style=\"width: 61.203125px; height: 73px;\"><span style=\"color: #ffffff; background-color: #000000;\">Black</span></td>\n<td style=\"width: 114.03125px; height: 73px;\">Unsalvageable</td>\n<td style=\"width: 115.484375px; height: 73px;\">Not breathing, pulseless, so severely injured that no medical care is likely to help</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A senior resident during his ward rounds advises the nurse to insert an 18 gauge IV cannula for a patient and start fluids. Which of the following cannulas will she use?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An <strong>18 gauge</strong> IV cannula is <span style=\"background-color: #bfedd2;\"><strong>green</strong></span> in color as shown in image 1.\u00a0</p>\n<p>In the above image, the cannulae numbered 1 to 4 are respectively:</p>\n<ol>\n<li><strong>18G</strong>\u00a0- <span style=\"background-color: #bfedd2;\">green</span></li>\n<li><strong>20G</strong>\u00a0- <span style=\"background-color: #e20ee8;\">pink</span></li>\n<li><strong>22G</strong>\u00a0- <span style=\"background-color: #c2e0f4;\">blue</span></li>\n<li><strong>24G</strong>\u00a0- <span style=\"background-color: #ecf728;\">yellow</span></li>\n</ol>\n<p>A<strong>\u00a0standard wire gauge</strong>\u00a0(SWG) is used to size cannulas. It is a measure of the cross-sectional area. It refers to the number of wires of the same size as the cannula that could pass through a hole of a standard size in parallel. Therefore\u00a0<strong>larger cannulae\u00a0</strong>have a<strong>\u00a0smaller gauge number</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/515d7b9f35424e998aea69268f7d5278.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with infective endocarditis is started on an intravenous antibiotic and has developed the following reaction within a few minutes of starting it. What is the most likely antibiotic which can cause this reaction?",
    "choices": [
      {
        "id": 1,
        "text": "Daptomycin"
      },
      {
        "id": 2,
        "text": "Vancomycin"
      },
      {
        "id": 3,
        "text": "Clindamycin"
      },
      {
        "id": 4,
        "text": "Chloramphenicol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows<strong> <span style=\"background-color: #f8cac6;\">red</span> man syndrome </strong>and the drug causing it is <strong>vancomycin.</strong></p>\n<p>Red man syndrome is a common adverse effect of the <strong>rapid administration</strong> of vancomycin. The redness is due to the release of <strong>histamine</strong> in the body. This should always be anticipated while giving vancomycin infusion and can be prevented by <strong>prior administration of antihistamines</strong> and <strong>prolonging the infusion </strong>period to 1 to 2 hours.</p>\n<p>Other such syndromes associated with drugs are:</p>\n<ul>\n<li>Blue man syndrome - Amiodarone</li>\n<li>Gray baby syndrome -\u00a0Chloramphenicol</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da80a218b6c64dbab05dfa0c33bf5dd3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is not true regarding the tape shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Used in children aged 6-59 months."
      },
      {
        "id": 2,
        "text": "Reading in the red zone\u00a0is considered to be severe chronic malnutrition"
      },
      {
        "id": 3,
        "text": "Reading in the yellow zone\u00a0is considered to be moderate acute malnutrition"
      },
      {
        "id": 4,
        "text": "Reading in the green zone\u00a0is considered to be normal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows <strong>Shakir's tape</strong>. The reading in the <strong><span style=\"background-color: #ff0000;\">red</span> zone</strong>&nbsp;is considered to be&nbsp;severe<strong> acute</strong> malnutrition (<strong>SAM</strong>).</p>\n<p><strong>Shakir's tape</strong> is used for the screening of malnourished children and for their admission into therapeutic feeding centers. It is useful mainly for <strong>frontline field workers</strong>.&nbsp;The target population is malnourished children or those at risk, aged <strong>6-59 months&nbsp;</strong>(Option A).</p>\n<p>It is used for the measurement of <strong>mid-upper arm circumference</strong>. To locate the midpoint of the left arm, the arm is flexed at the right angle, and the mid-point is marked <strong>halfway between the acromion and olecranon process</strong>. Color coding of the measurements and their significance is as follows:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"background-color: #ff0000;\"><strong>Red</strong></span> is from <strong>0</strong> to <strong>11.5</strong> cm - <strong>Severe acute malnutrition</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"background-color: #ffff00;\"><strong>Yellow</strong></span> is from <strong>11.5</strong> to <strong>12.5</strong> cm - <strong>Moderate acute malnutrition&nbsp;</strong>(Option C)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"background-color: #00ff00;\"><strong>Green</strong></span> is from <strong>12.5 </strong>to<strong> 26.5</strong> cm - <strong>Normal&nbsp;</strong>(Option D)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/87cde44e9fb3464e941935d49b41c438.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c1f72910281748efb49f88144b1b1571x1280x1350.JPEG"
    ]
  },
  {
    "text": "Gray baby syndrome is caused due to intake of which of the following drugs?",
    "choices": [
      {
        "id": 1,
        "text": "Chloramphenicol"
      },
      {
        "id": 2,
        "text": "Carbimazole"
      },
      {
        "id": 3,
        "text": "Valproate"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><span style=\"background-color: #95a5a6;\">Gray</span> baby syndrome</strong> occurs when high doses of <strong>chloramphenicol</strong> (100 mg/kg) were given prophylactically to neonates, especially premature babies.</p>\n<p>This syndrome usually begins <strong>2 to 9 days</strong> after starting the treatment. Initially in the first 24 hours, the baby develops <strong>vomiting</strong>, <strong>refusal to feed</strong>, irregular and rapid respiration, <strong>abdominal distention</strong>, periods of cyanosis, and passage of loose green stools. Over the next day, neonates turn to <strong>ashen-gray color</strong> and become <strong>hypothermic</strong> and&nbsp;<strong>flaccid</strong>.</p>\n<p>It happens due to the&nbsp;<strong>developmental deficiency</strong>&nbsp;of the enzyme<strong>&nbsp;glucoronyl transferase</strong>. This enzyme metabolizes chloramphenicol in neonates. Its deficiency leads to an&nbsp;<strong>inability</strong>&nbsp;to&nbsp;<strong>excrete unconjugated drugs</strong>&nbsp;adequately through renal excretion.</p>\n<p><strong>Death</strong> occurs in 40% of patients within 2 days of initial symptoms, but if there is a <strong>recovery</strong>, there are&nbsp;<strong>no sequelae </strong>usually.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old male patient presents to the clinic with a 2-month history of hypopigmented lesions with occasional itching.  Wood's lamp examination was performed, and the finding is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pityriasis versicolor"
      },
      {
        "id": 2,
        "text": "Vitiligo"
      },
      {
        "id": 3,
        "text": "Tinea capitis"
      },
      {
        "id": 4,
        "text": "Albinism"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of <strong>hypopigmented lesions</strong> and an image showing<span style=\"background-color: #ecf0f1;\"><strong> ivory</strong>\u00a0or </span><strong><span style=\"background-color: #ecf0f1;\">milky-white</span> fluorescence</strong>\u00a0on <strong>Wood's lamp</strong> examination are suggestive of <strong>vitiligo</strong>.</p>\n<p><strong>Vitiligo</strong>\u00a0is a localized depigmentation that occurs due to a\u00a0<strong>progressive loss in the melanocytes\u00a0</strong>in the\u00a0<strong>basal layer </strong>of the skin.<strong> </strong>Vitiligo shows a strong association with several <strong>autoimmune disorders</strong>, the <strong>strongest</strong> one being autoimmune <strong>thyroid</strong> <strong>disorders</strong> (hyperthyroidism and hypothyroidism).</p>\n<p>The lesions become apparent between <strong>20-30 years</strong> of age. Hypopigmented macules in vitiligo are commonly found in the\u00a0<strong>hips, dorsum </strong>of the<strong> hands/fingers</strong>,\u00a0<strong>feet, elbows, knees,\u00a0</strong>and<strong>\u00a0ankle areas.</strong>\u00a0These are the areas of repeated friction.\u00a0<strong>Koebner phenomenon\u00a0</strong>is seen, which is the development of\u00a0<strong>lesions at the site of trauma</strong>\u00a0on the uninvolved skin.</p>\n<p>Under the<strong> Wood's lamp </strong>examination, the depigmented areas emit an<strong> ivory-white\u00a0</strong>or<strong>\u00a0milky-white\u00a0fluorescence\u00a0</strong>and<strong>\u00a0appear sharply demarcated</strong>.\u00a0Woods lamp is helpful in diagnosing vitiligo, especially in fair-skinned people whose lesions may not be evident to the naked eye.</p>\n<p>The topical application of\u00a0<strong>corticosteroids</strong>\u00a0is the\u00a0<strong>first line of treatment</strong>. Topical calcineurin inhibitors like\u00a0pimecrolimus and <strong>tacrolimus</strong> have also been successful. <strong>Psoralen photochemotherapy,</strong>\u00a0khellin, and selective\u00a0<strong>ultraviolet B therapy</strong>\u00a0are used as\u00a0<strong>second-line treatments</strong>. In patients who do not respond to this treatment, surgical grafting techniques can be used, where the melanocytes from a normal pigmented area are transferred to a non-pigmented area. In patients with extensive vitiligo, where only a few pigmented areas are left, depigmentation can be done.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95373cdf5568475f989b7429ca4e2b79.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "During your internship, you notice the following cylinder attached to an anesthetic machine present in the operation theater.  In which of the following scenario the inhalational agent from this can be used?",
    "choices": [
      {
        "id": 1,
        "text": "Tympanic membrane grafting"
      },
      {
        "id": 2,
        "text": "Sedation in dental procedure"
      },
      {
        "id": 3,
        "text": "Intestinal obstruction"
      },
      {
        "id": 4,
        "text": "Pulmonary air cyst"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a\u00a0<strong><span style=\"background-color: #c2e0f4;\">blue</span> color cylinder</strong>\u00a0that is used to store <strong>n</strong><strong>itrous</strong> <strong>oxide</strong> (N<sub>2</sub>O).<strong>\u00a0</strong>It is commonly used for analgesia and <strong>sedation in dental procedures</strong>.</p>\n<p>Nitrous oxide is <strong>35 times more soluble</strong> than nitrogen in the blood. It tends to <strong>diffuse into air-containing cavities</strong> more rapidly than nitrogen is absorbed by the bloodstream. Due to this reason nitrous oxide is\u00a0<strong>contraindicated\u00a0</strong>in:</p>\n<ul>\n<li>Venous or arterial air embolism</li>\n<li>Pneumothorax</li>\n<li><strong>Acute intestinal obstruction</strong> with bowel distention</li>\n<li>Intracranial air (pneumocephalus following dural closure or pneumoencephalography)</li>\n<li><strong>Pulmonary air cysts</strong></li>\n<li>Intraocular air bubbles</li>\n<li><strong>Tympanic membrane grafting</strong></li>\n</ul>\n<p><strong>Side effects\u00a0</strong>of nitrous oxide are:</p>\n<ul>\n<li><strong>Megaloblastic anemia</strong></li>\n<li>Bone marrow depression</li>\n<li>Teratogenicity</li>\n<li><strong>Peripheral neuropathy</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68b269ef55234d2c8fd25edd20257dea.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the given amniotic fluid findings with their respective causative condition.",
    "choices": [
      {
        "id": 1,
        "text": "1-d, 2-b, 3-a, 4-c"
      },
      {
        "id": 2,
        "text": "1-e, 2-b, 3-a, 4-c"
      },
      {
        "id": 3,
        "text": "1- e, 2-a, 3-c, 4-b"
      },
      {
        "id": 4,
        "text": "1-a, 2-b, 3-c, 4-d"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Abnormal color of the Amniotic fluid and their causes are as follows</p>\n<table style=\"width: 238px; height: 305px;\">\n<tbody>\n<tr>\n<td style=\"width: 78.75px; text-align: center;\">Color of amniotic fluid</td>\n<td style=\"width: 143.25px; text-align: center;\">Conditions</td>\n</tr>\n<tr>\n<td style=\"width: 78.75px;\">1. <span style=\"background-color: #ba372a;\">Dark</span> <span style=\"background-color: #ba372a;\">maroon</span></td>\n<td style=\"width: 143.25px;\">d. Abruptio placenta</td>\n</tr>\n<tr>\n<td style=\"width: 78.75px;\">2. <span style=\"background-color: #169179;\">Green</span></td>\n<td style=\"width: 143.25px;\">\n<p>b. Fetal distress</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 78.75px;\">3. <span style=\"background-color: #f1c40f;\">Golden-yellow</span></td>\n<td style=\"width: 143.25px;\">a. Rh-incompatibility&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 78.75px;\">4. <span style=\"background-color: #e67e23;\">Saffron</span></td>\n<td style=\"width: 143.25px;\">c. Post-maturity&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 78.75px;\">&nbsp;</td>\n<td style=\"width: 143.25px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>Amniotic fluid in <strong>early pregnancy</strong> is <strong>colorless</strong>, but <strong>near term</strong> it becomes <strong>pale straw-colored</strong> due to the presence of exfoliated lanugo and epidermal cells from the fetal skin.&nbsp;<strong>Golden-colored&nbsp;</strong>amniotic fluid is seen in<strong>&nbsp;Rh incompatibility.&nbsp;</strong>This appearance is due to&nbsp;<strong>excess bilirubin</strong>&nbsp;in the amniotic fluid due to the hemolysis of fetal RBCs.</p>\n<p class=\"p1\"><strong><span class=\"s1\">Meconium stained (green) amniotic fluid&nbsp;</span></strong>is suggestive of&nbsp;<strong>fetal distress</strong>.</p>\n<p>In a&nbsp;<strong>post-term (&gt; 42 weeks)</strong>&nbsp;pregnancy,&nbsp;the amniotic fluid is found to be&nbsp;<strong>Saffron</strong>&nbsp;in color.</p>\n<p>In&nbsp;<strong>intrauterine death</strong>&nbsp;( absent fetal movements and FHS absent on doppler), a<strong>&nbsp;tobacco juice-colored&nbsp;</strong>amniotic fluid is seen.&nbsp;The dark color is due to the frequent presence of&nbsp;<strong>old HbA</strong>.</p>\n<p><strong>Dark red/maroon colored</strong> amniotic fluid is seen in <strong>concealed accidental hemorrhage </strong>as in cases of <strong>abruptio placenta</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are an intern working in the emergency department. Your resident asks you to insert Foley's catheter in a patient. You try inserting orange coded Foleys catheter but it is not possible to insert. You ask a paramedical staff to get a smaller catheter. Which one of the following catheter would you ask for?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The Foley's catheter coded with <strong><span style=\"background-color: #bfedd2;\">green</span> color</strong> is smaller than the <span style=\"background-color: #e67e23;\">orange</span> colored one. Therefore, this should be used in the patient. All other colors mentioned are larger than the orange coded catheters.</p>\n<p>The size of the urine catheters are measured by <strong>French (Fr). </strong><strong>&nbsp;</strong>The French scale refers to the<strong> external diameter</strong> of the catheter, and <strong>1Fr</strong> is <strong>0.3&nbsp;mm</strong> in diameter.</p>\n<p>In a patient, if there is difficulty in catheterization, a lower Fr number should be used instead.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1553398af2e42e1a7e03d20a0ab473e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You notice that a patient is given an inhalational anesthetic through a yellow-colored vaporizer during daycare surgery. Which of the following gases would you expect it to contain?",
    "choices": [
      {
        "id": 1,
        "text": "Sevoflurane"
      },
      {
        "id": 2,
        "text": "Halothane"
      },
      {
        "id": 3,
        "text": "Isoflurane"
      },
      {
        "id": 4,
        "text": "Desflurane"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Sevoflurane</strong> is the&nbsp;inhaled anesthetic, delivered through a <span style=\"background-color: #ffff00;\"><strong>yellow</strong></span>-<strong>colored</strong>&nbsp;vaporizer.</p>\n<p><strong>Sevoflurane</strong>&nbsp;is a<strong>&nbsp;fluorinated volatile anesthetic&nbsp;</strong>and is an<strong>&nbsp;ideal induction agent</strong>. Its&nbsp;<strong>non-pungency</strong>&nbsp;and&nbsp;<strong>rapid onset</strong>&nbsp;make it an excellent choice for<strong> smooth</strong> and<strong> rapid inhalation inductions</strong> in pediatric and adult patients.</p>\n<p>Sevoflurane is the&nbsp;<strong>inhalational anesthetic</strong>&nbsp;of choice for <strong>daycare surgery</strong>. The low blood-gas partition coefficient (0.69), blood&ndash;brain coefficient (1.7), and minimal airway irritation of sevoflurane promote&nbsp;<strong>rapid induction</strong>&nbsp;and&nbsp;<strong>rapid recovery.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man with a history of chronic rhinosinusitis is referred to the dermatology OPD for abnormal-looking nails as shown in the image. Which of the following is not a feature of this patient\u2019s condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pleural effusion"
      },
      {
        "id": 2,
        "text": "Malignant neoplasms"
      },
      {
        "id": 3,
        "text": "Bronchiectasis"
      },
      {
        "id": 4,
        "text": "Pitting edema"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The condition shown in the above image is <strong><span style=\"background-color: #ffff00;\">yellow</span> nail syndrome</strong>. It is associated with <strong>lymphedema</strong>, which is non-pitting.</p>\n<p>It is a rare disease characterized by the classical triad of:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong><span style=\"background-color: #ffff00;\">Yellow</span> dystrophic nails</strong>, due to thickening of nails</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Primary <strong>lymphedema</strong> (due to underdevelopment of the lymphatic vessels)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Pleural effusion</strong></li>\n</ul>\n<p>Other common manifestations include chronic <strong>rhinosinusitis</strong>, chronic <strong>bronchitis</strong>, <strong>bronchiectasis</strong>, increased risk of <strong>malignancy</strong>.</p>\n<p>It is also associated with <strong>D-penicillamine</strong> therapy and <strong>nephrotic</strong> syndrome. Hypothyroidism and AIDS may show yellow nails, but it is unclear whether this is due to yellow nail syndrome or simply due to retarded growth.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f0b0fbdba6cd40bc8d1ec6a654aad6d1.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following vacutainers is incorrectly matched with their clinical use?",
    "choices": [
      {
        "id": 1,
        "text": "Red\u00a0vacutainer - Serology\u00a0tests"
      },
      {
        "id": 2,
        "text": "Purple\u00a0vacutainer - Routine hematological studies\u00a0like CBC"
      },
      {
        "id": 3,
        "text": "Blue\u00a0vacutainer - Coagulation studies"
      },
      {
        "id": 4,
        "text": "Grey\u00a0vacutainer - HLA typing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><span style=\"background-color: #ced4d9;\"><strong>Grey</strong></span> vacutainers are used for the <strong>estimation </strong>of <strong>blood glucose</strong>. It contains&nbsp;<strong>sodium fluoride </strong>which&nbsp;<strong>inhibits glycolysis</strong>. For <strong>HLA typing</strong>&nbsp;and DNA studies,&nbsp;<span style=\"background-color: #ecf728;\"><strong>yellow</strong></span> vacutainers&nbsp;containing&nbsp;<strong>acid-citrate dextrose&nbsp;</strong>are used.</p>\n<p>Other options:</p>\n<p>Option A:<strong>&nbsp;<span style=\"background-color: #f8cac6;\">Red</span></strong>&nbsp;vacutainers contain <strong>no additives</strong>. They are used for <strong>serum chemistry</strong> tests, <strong>serology&nbsp;tests</strong>, and in blood banks, where serum is required for cross-matching.</p>\n<p>Option B:&nbsp;<span style=\"background-color: #b96ad9;\"><strong>Purple</strong></span>&nbsp;vacutainers contain<strong>&nbsp;EDTA</strong>.&nbsp;It is used for&nbsp;<strong>routine hematological studies</strong>&nbsp;like <strong>CBC</strong> (Complete blood counts).<br /><br />Option C: <span style=\"background-color: #c2e0f4;\"><strong>Blue</strong></span>&nbsp;vacutainers contain&nbsp;<strong>citrate</strong>. It is used for<strong> coagulation studies</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following poisoning with the corresponding color seen during livor mortis.",
    "choices": [
      {
        "id": 1,
        "text": "1-c, 2-a, 3-b, 4-d"
      },
      {
        "id": 2,
        "text": "1-d, 2-c, 3-a, 4-b"
      },
      {
        "id": 3,
        "text": "1-b, 2-d, 3-c, 4-a"
      },
      {
        "id": 4,
        "text": "1-a, 2-b, 3-d, 4-c"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct matches are:</p>\n<table style=\"height: 147px; width: 294.645px;\">\n<tbody>\n<tr>\n<td style=\"text-align: center; width: 161px;\"><strong>Poisoning</strong></td>\n<td style=\"width: 117.645px;\"><strong>Color in Livor Mortis</strong></td>\n</tr>\n<tr>\n<td style=\"width: 161px;\">1. Hydrocyanic acid</td>\n<td style=\"width: 117.645px;\">d.<span style=\"background-color: #f8cac6;\"> Bright red</span></td>\n</tr>\n<tr>\n<td style=\"width: 161px;\">2. Phosphorus</td>\n<td style=\"width: 117.645px;\">c.&nbsp;<span style=\"background-color: #be4e4e;\">Dark-brown</span></td>\n</tr>\n<tr>\n<td style=\"width: 161px;\">3. Hydrogen sulfide</td>\n<td style=\"width: 117.645px;\">a. <span style=\"background-color: #c2e0f4;\">Bluish-<span style=\"background-color: #bfedd2;\">green</span></span></td>\n</tr>\n<tr>\n<td style=\"width: 161px;\">4.&nbsp;Carbon monoxide</td>\n<td style=\"width: 117.645px;\">b.&nbsp;<span style=\"background-color: #e03e2d;\">Cherry-red</span></td>\n</tr>\n</tbody>\n</table>\n<p><strong>Postmortem hypostasis/Postmortem staining/Postmortem lividity/Livor mortis/Suggilation</strong>&nbsp;refers to bluish-purple or reddish-purple discoloration&nbsp;of the superficial layers of the skin due to the collection of blood in toneless capillaries.&nbsp;</p>\n<p>It is an&nbsp;<strong>early</strong>&nbsp;postmortem change that occurs due to<strong>&nbsp;engorged vessels</strong>&nbsp;showing through the skin seen on the&nbsp;<strong>dependent parts</strong>&nbsp;due to the pooling of blood under the effect of gravity.&nbsp;</p>\n<p>This staining starts as<strong>&nbsp;mottled patches</strong><strong>&nbsp;</strong>1-3 hours&nbsp;following death and develops to a&nbsp;<strong>uniform area</strong>&nbsp;of staining in 3-6 hours.&nbsp;Full development and<strong>&nbsp;fixation of hypostasis&nbsp;</strong>occur within&nbsp;<strong>6-12 hours.&nbsp;</strong>This finding<span class=\"s1\">&nbsp;usually develops within 4 hours and&nbsp;<strong>persists until putrefaction.&nbsp;</strong>Fixation of hypostasis&nbsp;occurs&nbsp;<strong>earlier</strong>&nbsp;in&nbsp;<strong>summer.&nbsp;</strong>It&nbsp;is&nbsp;<strong>delayed&nbsp;</strong>in<strong>&nbsp;asphyxial deaths</strong>&nbsp;and in<strong>&nbsp;intracranial lesions</strong>.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following bio-medical waste materials are disposed off in yellow bags?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 4"
      },
      {
        "id": 2,
        "text": "2, 3, 4"
      },
      {
        "id": 3,
        "text": "3, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 3, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Expired <strong>drugs</strong>, <strong>placenta</strong>, and <strong>blood bags</strong> are disposed of in <span style=\"background-color: #ecf728;\"><strong>yellow</strong></span>-colored&nbsp;containers or non-chlorinated plastic bags.</p>\n<p><strong>Latex gloves</strong> are disposed of in <strong>red</strong>-colored containers.</p>\n<p><strong>Used pacemakers</strong> are discarded in <strong>blue</strong>-colored containers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old boy presenting with photophobia, sweating,  joint pains, and puffy, painful, pinkish hands and feet, is suspected to have pink disease caused due to a chronic metal poisoning. Which of the following is not associated with the poisoning by this metal?",
    "choices": [
      {
        "id": 1,
        "text": "Danbury tremors"
      },
      {
        "id": 2,
        "text": "Erethism"
      },
      {
        "id": 3,
        "text": "Minamata disease"
      },
      {
        "id": 4,
        "text": "Aldrich mees\u00a0lines"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Pink<span style=\"background-color: #ecf0f1;\"> </span>disease</strong> is seen in chronic\u00a0<strong>mercury </strong>poisoning.\u00a0<strong>Aldrich mees\u00a0lines</strong> are characteristic of chronic\u00a0<strong>arsenic</strong> poisoning, not mercury.</p>\n<p><strong>Pink disease</strong>\u00a0or <strong>acrodynia</strong>\u00a0occurs due to an <strong>idiosyncratic hypersensitivity reaction</strong> resulting from chronic exposure to\u00a0<strong>mercury </strong>and\u00a0is seen particularly in <strong>children</strong>. The onset is insidious with anorexia, <strong>sweating,</strong> <strong>skin rash</strong>,\u00a0insomnia, and <strong>photophobia</strong>. Hands and feet become <strong>puffy, pinkish</strong>, and<strong> painful</strong>. Associated <strong>joint pain</strong>, paresthesia, shedding of teeth, and skin <span style=\"background-color: #ecf0f1;\">peeling</span> are also seen.</p>\n<p>Other eponymous features associated with <strong>mercury poisoning</strong>:</p>\n<ul>\n<li><span data-preserver-spaces=\"true\"><strong>Danbury tremors</strong>\u00a0are coarse, intentional tremors. The advanced condition is called\u00a0<strong>Hatter's shakes</strong>/<strong>Glass blower's</strong> <strong>shakes</strong>.</span></li>\n<li><span data-preserver-spaces=\"true\"><span data-preserver-spaces=\"true\"><strong>Minamata disease</strong>: This is caused by the <strong>eating</strong> of<strong> fish poisoned</strong> by <strong>mercury</strong>. The i</span></span>ndustrial discharges of mercury into <strong>Minamata Bay</strong> in Japan became biomethylated to form <strong>methyl mercury</strong>, which then accumulated in fish. On consumption of these fishes, people developed <strong>visual deficits</strong> and several neurological manifestations such as <strong>loss of\u00a0sensation</strong>, <strong>gait</strong>, <strong>memory</strong>, cognition, etc.</li>\n<li><span data-preserver-spaces=\"true\"><strong>Erethism</strong>: These are psychological symptoms due to mercury toxicity, which is seen among persons working in mirror manufacturing firms. It is characterized by <strong>shyness</strong>, <strong>timidity</strong>, irritability, loss of confidence, <strong>mental depression</strong>, loss of memory, and insomnia.</span></li>\n<li><span data-preserver-spaces=\"true\"><strong>Mercuria lentis</strong>: This term refers to the peculiar eye change seen due to exposure to mercury vapor. It appears as<strong> brownish deposits</strong> of mercury on the <strong>anterior lens capsule</strong>.</span></li>\n</ul>\n<p>The image below shows\u00a0<strong><span style=\"background-color: #ffffff;\">transverse white</span> lines\u00a0</strong>(Leukonychia striata) called\u00a0<strong>Aldrich Mees Lines\u00a0</strong>typically seen in\u00a0<strong>arsenic poisoning</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd851163402d4a708b7c0825c078c93ex720x616.JPEG"
    ]
  },
  {
    "text": "A 25-year-old patient came to the Suraksha clinic with the following presentation in the right inguinal region.  Which of the following kits should be given to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Grey kit"
      },
      {
        "id": 2,
        "text": "Blue kit"
      },
      {
        "id": 3,
        "text": "Red kit"
      },
      {
        "id": 4,
        "text": "Black kit"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The<strong> <span style=\"background-color: #000000; color: #ffffff;\">black kit</span></strong> should be used for the treatment of this patient. In the image shown above, the <strong>groove sign</strong> is seen in the<strong> inguinal region</strong>. It is the characteristic feature of <strong>lymphogranuloma venereum </strong>caused by <em>Chlamydia trachomatis</em>.</p>\n<p>The<strong> <span style=\"color: #ffffff; background-color: #000000;\">black kit</span></strong> comprises of tablet <strong>azithromycin 1 gm</strong> single dose + <strong>tablet doxycycline 100 mg</strong> twice daily for 21 days.</p>\n<p>It is used in the <strong>following presentation</strong>:</p>\n<ul>\n<li>Swelling in the inguinal region may be painful</li>\n<li>The preceding history of genital ulcer or discharge</li>\n<li>Systemic symptoms like malaise, fever, etc.</li>\n</ul>\n<p>All&nbsp;<strong>partners </strong>in the last<strong> 3 weeks</strong> should be<strong>&nbsp;treated</strong>.</p>\n<p>Other options:</p>\n<p>Option A - The <span style=\"background-color: #ced4d9;\"><strong>grey kit</strong></span> is used in men for <strong>urethral discharge</strong> and <strong>scrotal swelling</strong>. All <strong>recent partners</strong>&nbsp;should be <strong>treated</strong>. However, when used for cervical discharge in women, only symptomatic male partners need to be treated.</p>\n<p>Option B - The <span style=\"background-color: #3598db;\"><strong>blue kit</strong></span> is used in <strong>non-herpetic genital ulcer disease</strong> when the patient is <strong>allergic</strong> to <strong>penicillin</strong>. All <strong>partners</strong> in the last <strong>3 months</strong> should be treated.</p>\n<p>Option C - The <span style=\"background-color: #f8cac6;\"><strong>red kit</strong></span> is used in<strong> herpetic genital ulcer disease,</strong> in which the <strong>treatment</strong> of <strong>asymptomatic</strong> partners is <strong>not</strong> <strong>required</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b04f1866ba754fe68e93d9eed60b3bdc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "During an ophthalmoscopic examination of a patient in bright light, you notice that the fundus has a golden yellow color in the light-adapted state. The same patient is made to sit in a dark room and a subsequent examination reveals a normal fundus after prolonged dark adaptation. What is the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Oguchis disease"
      },
      {
        "id": 2,
        "text": "Retinitis pigmentosa"
      },
      {
        "id": 3,
        "text": "Fundus albipunctatus"
      },
      {
        "id": 4,
        "text": "Fundus flavimaculatus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This unusual presentation of the fundus showing a <span style=\"background-color: #ffcc00;\">golden yellow</span> color in light and a normal color in dark adaptation is known as<strong> Mizuo or Mizuo\u2013Nakamura phenomenon</strong>\u00a0and is seen in\u00a0<strong>Oguchi's disease.</strong></p>\n<p>It is a type of<strong>\u00a0congenital stationary night blindness</strong> with<strong> abnormal fundus.\u00a0</strong>The following image shows a comparison in the fundus appearances (\"A\" shows the <span style=\"background-color: #ffcc00;\">golden yellow</span> color of the fundus in a light-adapted state; \"B\" shows normal-appearing funds after prolonged dark adaptation of 3 to 4 hours).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bba1501381694da898eef3180601b8d6x512x219.JPEG"
    ]
  },
  {
    "text": "A pathologist is examining a specimen from a patient with amyloidosis. When amyloid is stained with Congo red and visualized under ordinary light, which color does it acquire?",
    "choices": [
      {
        "id": 1,
        "text": "White"
      },
      {
        "id": 2,
        "text": "Apple-green birefringence"
      },
      {
        "id": 3,
        "text": "Red"
      },
      {
        "id": 4,
        "text": "Dark brown"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>When amyloid is stained with <strong>Congo <span style=\"background-color: #f8cac6;\">red</span></strong> and is visualized under ordinary light, it shows&nbsp;<strong>red colour.</strong></p>\n<p><strong>Amyloidosis</strong> results from the&nbsp;<strong>abnormal folding of proteins</strong>, which become insoluble, get aggregated, and are deposited as <strong>fibrils</strong> in <strong>extracellular</strong> tissues. Normally, misfolded proteins are degraded. Amyloid may be <strong>systemic</strong> (generalized), involving several organ systems, or it may be <strong>localized</strong>&nbsp;to a single organ.</p>\n<div class=\"page\" title=\"Page 268\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The histologic diagnosis of amyloid is based almost entirely on its staining characteristics:</p>\n<p>1. Light microscopy&nbsp;with <strong>hematoxylin </strong>and <strong>eosin</strong> stain:<strong>&nbsp;</strong>Amyloid appears as an <strong>amorphous, eosinophilic, hyaline</strong>&nbsp;substance in extracellular space.</p>\n<p>2. <strong>Congo red stain</strong>:&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li><strong>Under ordinary light</strong>, it imparts a <strong>pink</strong> or <strong><span style=\"background-color: #f8cac6;\">red</span> color</strong> to tissue deposits.</li>\n<li><strong>Under the polarizing microscope</strong>,&nbsp;it imparts <strong><span style=\"background-color: #2dc26b;\">apple-green</span> birefringence</strong>&nbsp;to amyloid deposits.</li>\n</ul>\n<p>Images below show amyloid stained with congo red stain, under ordinary light, and under polarised light respectively</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d059b4d8f34c4f00899519648f228d58x640x480.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08c75b99c8fd40ce822121f787ae58f8x720x540.JPEG"
    ]
  }
];
        let quizName = 'Colours In Medicine Mini Test - -Tmt';
        const quizFilename = 'colours-in-medicine-mini-test-tmt-efc9146d.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>