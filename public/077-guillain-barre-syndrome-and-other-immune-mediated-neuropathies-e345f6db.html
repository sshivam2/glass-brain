<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>077 Guillain-Barre Syndrome And Other Immune-Mediated Neuropathies - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the most common antecedent infectious cause of Guillain-Barre syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Cytomegalovirus"
      },
      {
        "id": 2,
        "text": "Mycoplasma pneumoniae"
      },
      {
        "id": 3,
        "text": "Campylobacter jejuni"
      },
      {
        "id": 4,
        "text": "Epstein Barr virus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><em><strong>Campylobacter jejuni</strong></em>&nbsp;is one of the <strong>most common </strong>risk factors for GBS.</p>\n<p>Infections that may trigger GBS are:</p>\n<ul>\n<li><em>Campylobacter jejuni</em>&nbsp;</li>\n<li>Cytomegalovirus (CMV)</li>\n<li>Epstein Barr virus</li>\n<li>Mycoplasma</li>\n<li>Varicella zoster virus</li>\n<li>Human immunodeficiency virus (HIV), dengue, or influenza, Zika, hepatitis</li>\n</ul>\n<p>Less commonly <strong>vaccinations</strong>, <strong>surgical procedures</strong>, and <strong>trauma</strong> have been reported to trigger the development of GBS.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following autoantibody isotype is involved in the pathogenesis of Guillian-Barre syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "IgA"
      },
      {
        "id": 2,
        "text": "IgG"
      },
      {
        "id": 3,
        "text": "IgM"
      },
      {
        "id": 4,
        "text": "IgE"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>IgG&nbsp;</strong>isotype of autoantibody is involved in the pathogenesis of GBS.</p>\n<p><strong>IgM</strong> isotype autoantibodies are known to play a role in some types of <strong>chronic immune neuropathies</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In Guillain-Barre syndrome due to antecedent infection with Campylobacter jejuni, the autoantibodies are most commonly directed against which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "GM1"
      },
      {
        "id": 2,
        "text": "GD1a"
      },
      {
        "id": 3,
        "text": "GD1b"
      },
      {
        "id": 4,
        "text": "GalNac-GD1a"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Autoantibodies</strong> in GBS due to <em><strong>Campylobacter jejuni</strong></em> infection are directed most commonly against <strong>GM1 gangliosidase.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common type of Guillian-Barre syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Acute motor axonal neuropathy"
      },
      {
        "id": 2,
        "text": "Acute inflammatory demyelinating polyneuropathy"
      },
      {
        "id": 3,
        "text": "Acute motor sensory axonal neuropathy"
      },
      {
        "id": 4,
        "text": "Miller Fisher syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Acute inflammatory demyelinating</strong> <strong>polyneuropathy (AIDP)</strong> is the most common type of GBS.</p>\n<p>There are several <strong>types of Guillain&ndash;Barre syndrome,</strong> which are recognized by electrodiagnostic studies and pathological distinctions. These include:</p>\n<p>A. Demyelinating</p>\n<ul>\n<li><strong>Acute inflammatory demyelinating polyneuropathy</strong> (AIDP) - most common</li>\n</ul>\n<p>B. Axonal</p>\n<ul>\n<li><strong>Acute motor axonal neuropathy</strong> (AMAN)</li>\n<li><strong>Acute motor&ndash;sensory axonal neuropathy</strong> (AMSAN)</li>\n</ul>\n<p>C. Regional GBS syndromes</p>\n<ul>\n<li><strong>Miller&ndash;Fisher syndrome</strong> (MFS)</li>\n<li>Pure sensory forms</li>\n<li>Ophthalmoplegia with anti-GQ1b antibodies as part of severe motor-sensory GBS</li>\n<li>GBS with severe bulbar and facial paralysis</li>\n<li>Acute pandysautonomia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which type of Guillain-Barre syndrome most commonly affects patients in the pediatric age group?",
    "choices": [
      {
        "id": 1,
        "text": "Acute motor axonal neuropathy"
      },
      {
        "id": 2,
        "text": "Acute inflammatory demyelinating polyneuropathy"
      },
      {
        "id": 3,
        "text": "Acute motor sensory axonal neuropathy"
      },
      {
        "id": 4,
        "text": "Miller Fisher syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>acute motor axonal neuropathy (AMAN)</strong> subtype of Guillain-Barre syndrome (GBS) is more common in <strong>pediatric age groups</strong>.</p>\n<table style=\"height: 120px; width: 431px;\">\n<tbody>\n<tr style=\"height: 43.7431px;\">\n<td style=\"width: 279.698px; height: 43.7431px;\"><strong>Type</strong></td>\n<td style=\"width: 137.302px; height: 43.7431px;\"><strong>Age group affected</strong></td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 279.698px; height: 35px;\">Acute inflammatory demyelinating polyneuropathy (AIDP)</td>\n<td style=\"width: 137.302px; height: 35px;\">Adults\u00a0</td>\n</tr>\n<tr style=\"height: 77px;\">\n<td style=\"width: 279.698px; height: 77px;\">Acute motor axonal neuropathy (AMAN)</td>\n<td style=\"width: 137.302px; height: 77px;\">\n<p>Children</p>\n<p>Young adults</p>\n</td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 279.698px; height: 35px;\">Acute motor-sensory axonal neuropathy (AMSAN)</td>\n<td style=\"width: 137.302px; height: 35px;\">Mostly adults</td>\n</tr>\n<tr style=\"height: 77px;\">\n<td style=\"width: 279.698px; height: 77px;\">Miller\u2013Fisher syndrome</td>\n<td style=\"width: 137.302px; height: 77px;\">\n<p>Adults\u00a0</p>\n<p>Children</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Acute inflammatory demyelinating polyneuropathy differs from acute motor axonal neuropathy, in that, in the latter, the complement deposition along with IgG antibodies occurs at:",
    "choices": [
      {
        "id": 1,
        "text": "Nodes of Ranvier"
      },
      {
        "id": 2,
        "text": "Neuromuscular junction"
      },
      {
        "id": 3,
        "text": "Oligodendrocytes"
      },
      {
        "id": 4,
        "text": "Schwann cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>AMAN,</strong> the complement along with IgG is deposited at the <strong>nodes of Ranvier</strong>\u00a0of <strong>large motor axons.</strong></p>\n<p>In <strong>AIDP,</strong> complement deposits along the outer surface of the <strong>Schwann cell.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features would you not expect to see in a patient with Guillian-Barre syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Absent reflexes in lower limb"
      },
      {
        "id": 2,
        "text": "Ascending paralysis"
      },
      {
        "id": 3,
        "text": "Early bladder dysfunction"
      },
      {
        "id": 4,
        "text": "Bulbar paralysis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Bladder dysfunction is not usually severe and does not appear early in the course of <strong>Guillain-Barre Syndrome(GBS)</strong>. If bladder dysfunction is a prominent feature and comes early in the course, diagnostic possibilities other than GBS should be considered.</p>\n<p>GBS is an acute demyelinating polyradiculoneuropathy. It is an autoimmune disorder triggered by infections like:</p>\n<ul>\n<li><em>Campylobacter jejuni&nbsp;</em></li>\n<li>Cytomegalovirus (CMV)</li>\n<li>Epstein Barr virus</li>\n<li>Mycoplasma</li>\n<li>Varicella zoster virus</li>\n<li>Human immunodeficiency virus (HIV), dengue, or influenza</li>\n</ul>\n<p>It manifests as a rapidly evolving <strong>areflexic motor paralysis</strong>, with or without sensory disturbance. The usual pattern is&nbsp;<strong>ascending paralysis</strong>. Proximal and distal muscles are equally involved. The lower cranial nerves are frequently affected, causing <strong>bulbar weakness</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following sensory deficits is severely affected in a patient with Guillain-Barre syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Pain"
      },
      {
        "id": 2,
        "text": "Temperature"
      },
      {
        "id": 3,
        "text": "Proprioception"
      },
      {
        "id": 4,
        "text": "Touch"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Loss</strong> of<strong> proprioception</strong> is <strong>severe</strong> in&nbsp;Guillain-Barre syndrome <strong>(GBS).</strong></p>\n<p>GBS affects the large sensory fibers, leading to attenuation or loss of deep tendon reflexes and loss of proprioception.</p>\n<p>Cutaneous sensory deficits (e.g., loss of pain and temperature sensation) are usually relatively mild.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with complaints of lower extremity weakness. He initially noticed difficulty climbing the stairs and now he is unable to stand. He gives a history of bloody diarrhea a few weeks ago. Which of the following parameters are expected to be elevated in the CSF of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Lymphocytes"
      },
      {
        "id": 2,
        "text": "Neutrophils"
      },
      {
        "id": 3,
        "text": "Opening pressure"
      },
      {
        "id": 4,
        "text": "Proteins"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario is suggestive of&nbsp;<strong>Guillain-Barre syndrome (GBS).&nbsp;</strong><strong>Protein </strong>levels are <strong>elevated</strong> (100-1000mg/dl) in the <strong>CSF</strong> of a patient with this condition.</p>\n<p>The CSF cell counts are usually normal. <strong>Albuminocytologic dissociation</strong>, which is an elevation in CSF protein without an elevation in white blood cells, is characteristic in GBS.</p>\n<p>Causes of&nbsp;albuminocytologic dissociation are:</p>\n<ul>\n<li>Guillain-Barre Syndrome</li>\n<li>Spinal cord&nbsp;tumours</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions does not present with autonomic dysfunction?",
    "choices": [
      {
        "id": 1,
        "text": "Amyloidosis"
      },
      {
        "id": 2,
        "text": "Guillain-Barr\u00e9 syndrome"
      },
      {
        "id": 3,
        "text": "Botulism"
      },
      {
        "id": 4,
        "text": "Subclavian steal syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Subclavian steal syndrome does not present with autonomic dysfunction.</p>\n<p>Option A: <strong>Polyneuropathy</strong> is seen in sporadic and familial amyloidosis. In some cases, <strong>autonomic insufficiency</strong> presents before&nbsp;distal painful polyneuropathy accompanied by sensory loss</p>\n<p>Option B:&nbsp;<strong>Guillain-Barr&eacute;</strong> syndrome is associated with autonomic instability. This can present with <strong>BP fluctuations</strong>, <strong>arrhythmias,</strong> and GI disturbances.</p>\n<p>Option C: Botulinum toxin binds&nbsp;presynaptically to cholinergic nerve terminals. After uptake into the cytoplasm, it&nbsp;<strong>blocks ACh</strong> <strong>release</strong>. Thus, patients with <strong>botulism</strong> present with motor paralysis and <strong>autonomic disturbances.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old patient presents with rapidly progressing symmetric ascending paralysis since 2 days. Nerve conduction studies are consistent with demyelination. He is found to have an elevated protein level in his CSF. Which of the following autonomic disturbance is likely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Postural hypotension"
      },
      {
        "id": 2,
        "text": "Urinary incontinence"
      },
      {
        "id": 3,
        "text": "Diarrhea"
      },
      {
        "id": 4,
        "text": "Increased sweating"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is suggestive of&nbsp;<strong>Guillian-Barre syndrome</strong> (GBS).&nbsp;<strong>Postural hypotension</strong> is a common autonomic disturbance seen in this condition.</p>\n<p>Autonomic involvement is common and may occur even in patients whose GBS is otherwise mild.</p>\n<p>The usual autonomic manifestations are:</p>\n<ul>\n<li>Loss of vasomotor control with wide fluctuation in blood pressure, postural&nbsp;hypotension</li>\n<li>Cardiac dysrhythmias</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The triad of Miller-Fisher syndrome includes all of the following, except:",
    "choices": [
      {
        "id": 1,
        "text": "Ataxia"
      },
      {
        "id": 2,
        "text": "Weakness"
      },
      {
        "id": 3,
        "text": "Areflexia"
      },
      {
        "id": 4,
        "text": "Ophthalmoplegia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Miller Fisher syndrome&nbsp;is a variant of Guillain-Barr&eacute;&nbsp;syndrome(GBS). Like Guillain-Barr&eacute; syndrome, symptoms may be preceded by a viral illness. It classically presents as a triad of:</p>\n<ul>\n<li>Ataxia</li>\n<li>Areflexia</li>\n<li>Ophthalmoplegia</li>\n</ul>\n<p>The condition is usually not associated with weakness, and even if present, is very mild. It is strongly associated with antibodies to the ganglioside GQ1b.</p>\n<p>The prognosis in Miller Fisher syndrome is usually good with recovery beginning within 2 to 4 weeks of the symptom onset, and completing by 6 months. Some individuals are left with residual deficits. Relapses are rare.</p>\n<p>Treatment for Miller Fisher syndrome is identical to treatment for Guillain-Barr&eacute; syndrome: intravenous immunoglobulin (IVIg) or plasmapheresis and supportive care.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented to the ER with tingling, numbness, and weakness in all four limbs.  She says that the weakness started in the lower limbs and progressed to the upper limbs within a day. History is significant for a recent COVID-19 infection and surgery for cervical spondylosis and disc herniation 3 years ago. CT brain was normal and an MRI of the lumbar spine showed foraminal narrowing at L2-L3. CSF analysis showed increased protein levels. Which of the following is recommended for the initial therapy of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Intrathecal steroids"
      },
      {
        "id": 2,
        "text": "Remdesivir"
      },
      {
        "id": 3,
        "text": "IV Immunoglobulin"
      },
      {
        "id": 4,
        "text": "Plasmapheresis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>High-dose intravenous immune globulin (IVIg) and&nbsp;plasmapheresis are both equally effective in GBS and can be used as the initial therapy. However, IVIg is often the initial therapy chosen because of its ease of administration and good safety record. It is administered as <strong>five daily infusions</strong> for a total dose of <strong>2 g/kg</strong> body weight.&nbsp;Glucocorticoids have not been found to be effective in GBS.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with Guillain-Barre syndrome, chronic inflammatory demyelinating polyneuropathy is suspected when _______",
    "choices": [
      {
        "id": 1,
        "text": "GBS deteriorates >5 weeks after onset or relapses at least three times"
      },
      {
        "id": 2,
        "text": "GBS deteriorates >5 weeks after onset or relapses at least two times"
      },
      {
        "id": 3,
        "text": "GBS deteriorates >9 weeks after onset or relapses at least three times"
      },
      {
        "id": 4,
        "text": "GBS deteriorates >8 weeks after onset or relapses at least two times"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Chronic inflammatory demyelinating polyneuropathy<strong> (CIDP) </strong>should be suspected when <strong>GBS</strong> deteriorates <strong>&gt;9 weeks</strong> after onset or <strong>relapses</strong> at <strong>least three times.</strong></p>\n<p>Onset is usually gradual over a few months or longer, but in a few cases, the initial attack is indistinguishable from that of GBS.</p>\n<p><strong>CIDP</strong> is distinguished from GBS by its chronic course. In other respects, this neuropathy shares many features with the common demyelinating form of GBS, including <strong>elevated CSF protein levels </strong>and the electrodiagnostic studies findings of <strong>acquired demyelination.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions are not associated with chronic inflammatory demyelinating polyneuropathy?",
    "choices": [
      {
        "id": 1,
        "text": "Diabetic mellitus"
      },
      {
        "id": 2,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 3,
        "text": "Lymphoma"
      },
      {
        "id": 4,
        "text": "Hepatitis A  infection"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Hepatitis A infection is not associated with CIDP.</p>\n<p>Diseases associated with CIDP are:</p>\n<ul>\n<li>Hepatitis B</li>\n<li>Hepatitis C</li>\n<li>Lymphoma&nbsp;</li>\n<li>HIV</li>\n<li>Diabetic mellitus</li>\n<li>Systemic lupus erythematosus (SLE)</li>\n<li>Pregnancy&nbsp;</li>\n<li>Paraneoplastic syndrome&nbsp;</li>\n<li>Inflammatory bowel disease</li>\n<li>Amyloidosis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are true about chronic inflammatory demyelinating polyneuropathy, except:",
    "choices": [
      {
        "id": 1,
        "text": "Symptoms present for  > 8 weeks duration"
      },
      {
        "id": 2,
        "text": "Relapse at least 3 times in a patient with Guillain-Barr\u00e9 syndrome"
      },
      {
        "id": 3,
        "text": "Symmetrical weakness"
      },
      {
        "id": 4,
        "text": "Small nerve fibers are affected more than large fibers"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Large nerve fibers</strong> are <strong>affected more</strong> than small fibers in <strong>CIDP.</strong></p>\n<p>Difference between CIDP and\u00a0Guillain-barr\u00e9 syndrome(GBS):</p>\n<table style=\"width: 327px;\">\n<tbody>\n<tr style=\"height: 28.7049px;\">\n<td style=\"width: 160px; text-align: center; height: 28.7049px;\">\u00a0</td>\n<td style=\"width: 160px; text-align: center; height: 28.7049px;\"><strong>GBS</strong></td>\n<td style=\"width: 155px; text-align: center; height: 28.7049px;\"><strong>CIDP</strong></td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 160px; height: 17px;\">Duration\u00a0</td>\n<td style=\"width: 160px; height: 17px;\">&lt;4 weeks</td>\n<td style=\"width: 155px; height: 17px;\">&gt;8 weeks</td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 160px; height: 35px;\">Motor symptoms</td>\n<td style=\"width: 160px; height: 35px;\">Affected</td>\n<td style=\"width: 155px; height: 35px;\">Affected</td>\n</tr>\n<tr style=\"height: 113px;\">\n<td style=\"width: 160px; height: 113px;\">Sensory symptoms</td>\n<td style=\"width: 160px; height: 113px;\">Mild\u00a0</td>\n<td style=\"width: 155px; height: 113px;\">\n<p>More significant</p>\n<p>Largefiber &gt; small fiber</p>\n</td>\n</tr>\n<tr style=\"height: 53px;\">\n<td style=\"width: 160px; height: 53px;\">Autonomic nervous system</td>\n<td style=\"width: 160px; height: 53px;\">Affected\u00a0</td>\n<td style=\"width: 155px; height: 53px;\">Rare</td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 160px; height: 35px;\">Antecedent event</td>\n<td style=\"width: 160px; height: 35px;\">Present</td>\n<td style=\"width: 155px; height: 35px;\">Rare</td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 160px; height: 35px;\">Deep tendon reflex</td>\n<td style=\"width: 160px; height: 35px;\">Absent\u00a0</td>\n<td style=\"width: 155px; height: 35px;\">Absent</td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 160px; height: 35px;\">Steroid</td>\n<td style=\"width: 160px; height: 35px;\">No role</td>\n<td style=\"width: 155px; height: 35px;\">2nd line of treatment</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with chronic inflammatory demyelinating polyneuropathy is undergoing nerve conduction study. Which of the following findings is least likely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Low amplitude"
      },
      {
        "id": 2,
        "text": "Decreased conduction velocity"
      },
      {
        "id": 3,
        "text": "Increased distal latency"
      },
      {
        "id": 4,
        "text": "Conduction block"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In CIDP, the<strong> amplitude</strong> is <strong>normal</strong> since the axons are intact.</p>\n<p>Nerve conduction study (NCS) in axonal injury and demyelinating diseases:</p>\n<table style=\"height: 84px; width: 450px;\">\n<tbody>\n<tr>\n<td style=\"width: 112px;\">&nbsp;</td>\n<td style=\"width: 150px; text-align: center;\"><strong>Axonal injury&nbsp;</strong></td>\n<td style=\"width: 172px; text-align: center;\"><strong>Demyelination&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Amplitude</td>\n<td style=\"width: 150px;\">Decreased&nbsp;</td>\n<td style=\"width: 172px;\">Normal&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Distal latency&nbsp;</td>\n<td style=\"width: 150px;\">Normal</td>\n<td style=\"width: 172px;\">Prolonged&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Conduction velocity&nbsp;</td>\n<td style=\"width: 150px;\">Normal&nbsp;</td>\n<td style=\"width: 172px;\">Slow&nbsp;&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Conduction block&nbsp;</td>\n<td style=\"width: 150px;\">Absent</td>\n<td style=\"width: 172px;\">Present</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">Temporal dispersion&nbsp;</td>\n<td style=\"width: 150px;\">Absent</td>\n<td style=\"width: 172px;\">Present&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">H wave</td>\n<td style=\"width: 150px;\">Normal or absent</td>\n<td style=\"width: 172px;\">Prolonged or absent</td>\n</tr>\n<tr>\n<td style=\"width: 112px;\">F wave</td>\n<td style=\"width: 150px;\">Normal or absent</td>\n<td style=\"width: 172px;\">Prolonged or absent</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following situations is nerve biopsy not indicated in patients with chronic inflammatory demyelinating polyneuropathy?",
    "choices": [
      {
        "id": 1,
        "text": "When the diagnosis not clear"
      },
      {
        "id": 2,
        "text": "When other causes of polyneuropathy cannot be ruled out"
      },
      {
        "id": 3,
        "text": "When electromyography shows axonal involvement"
      },
      {
        "id": 4,
        "text": "When there is no clinical or electrophysiological evidence of nerve functionality"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Nerve biopsy should not be done if there is no clinical or electrophysiological evidence of nerve functionality of that nerve in <strong>CIDP</strong> patients. This is because&nbsp;completely degenerated nerves usually convey limited information.</p>\n<p>In CIDP, <strong>nerve biopsy</strong> is indicated when:</p>\n<ul>\n<li>Diagnosis is not clear</li>\n<li>Other causes of polyneuropathy cannot be ruled out</li>\n<li>Electromyography (EMG) shows axonal involvement</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following can be used for the treatment of a patient with chronic inflammatory demyelinating polyneuropathy, except:",
    "choices": [
      {
        "id": 1,
        "text": "IV Immunoglobulin"
      },
      {
        "id": 2,
        "text": "Plasmapheresis"
      },
      {
        "id": 3,
        "text": "NSAIDs"
      },
      {
        "id": 4,
        "text": "Glucocorticoids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>NSAIDs are not used in the treatment of CIDP.</p>\n<p>The treatment of chronic inflammatory demyelinating polyneuropathy (CIDP) includes <strong>high-dose IV immunoglobulin</strong>,<strong>&nbsp;plasmapheresis, </strong>and<strong> glucocorticoids.</strong></p>\n<p>Initial therapy is usually with IV immunoglobulin. If all the first-line agents fail, immunosuppressants are attempted either alone or as an adjunctive treatment.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 63-year-old man presented with complaints of fatiguability and chronic back pain. On evaluation, he was found to have anemia and hypercalcemia. The X-ray of his skull is given below. Which of the following statements is true with regard to neuropathy seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Polyneuropathy is seen in 50% of patients presenting with osteoporotic bone lesions"
      },
      {
        "id": 2,
        "text": "Polyneuropathy is seen in 5% of patients presenting with osteosclerotic features"
      },
      {
        "id": 3,
        "text": "The pattern is sensorimotor"
      },
      {
        "id": 4,
        "text": "Treatment may reverse severe neuropathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of <strong>multiple myeloma</strong> and the pattern of&nbsp;<strong>polyneuropathy</strong>&nbsp;seen in this condition is&nbsp;<strong>sensorimotor&nbsp;type.</strong></p>\n<p>Multiple myeloma-associated polyneuropathies occur in&nbsp;~5% of patients&nbsp;with the&nbsp;commonly encountered type of multiple myeloma.</p>\n<p>Myeloma with osteosclerotic features, although representing&nbsp;only 3% of all myelomas, is associated with&nbsp;polyneuropathy&nbsp;in one-half of cases.&nbsp;</p>\n<p>Polyneuropathy&nbsp;generally&nbsp;does not reverse&nbsp;even&nbsp;with successful suppression of the&nbsp;myeloma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c636aac01984449e93116cc7a831604b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most common pattern of peripheral neuropathy in patients with polyarteritis nodosa?",
    "choices": [
      {
        "id": 1,
        "text": "Pure motor neuropathy"
      },
      {
        "id": 2,
        "text": "Pure sensory neuropathy"
      },
      {
        "id": 3,
        "text": "Symmetric motor-sensory neuropathy"
      },
      {
        "id": 4,
        "text": "Mononeuropathy multiplex"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Most common pattern of peripheral neuropathy in <strong>polyarteritis nodosa</strong> (PAN) is <strong>mononeuritis multiplex</strong> (multifocal motor-sensory neuropathy). It is asymmetric, due to ischemic lesions of nerve trunks and roots.</p>\n<p>Some cases present as a distal, symmetric sensorimotor polyneuropathy. Small- to medium-sized arteries of the vasa nervorum, particularly the epineural vessels, are affected in PAN, resulting in a widespread ischemic neuropathy.</p>\n<p>Combination therapy with <strong>glucocorticoids</strong> and <strong>rituximab</strong> is increasingly recommended as the standard initial treatment, particularly for ANCA-associated vasculitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '077 Guillain-Barre Syndrome And Other Immune-Mediated Neuropathies';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>