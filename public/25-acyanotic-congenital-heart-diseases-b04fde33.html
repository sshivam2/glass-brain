<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25 Acyanotic Congenital Heart Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The most common mode of inheritance of congenital heart disease is_____.",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant"
      },
      {
        "id": 2,
        "text": "Autosomal recessive"
      },
      {
        "id": 3,
        "text": "X linked recessive"
      },
      {
        "id": 4,
        "text": "Multifactorial"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most common mode of inheritance</strong> of congenital heart disease is <strong>multifactorial. </strong></p>\n<p>Multifactorial inheritance refers to traits that are caused by a combination of inherited, environmental, and stochastic factors.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As a medical officer working under the RBSK scheme, the commonest congenital heart disease you would encounter is __________.",
    "choices": [
      {
        "id": 1,
        "text": "Atrial septal defect"
      },
      {
        "id": 2,
        "text": "Ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 4,
        "text": "Tetrology of Fallot"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ventricular septal defect(VSD) </strong>is the most common congenital heart disease.</p>\n<p>The <strong>prevalence of congenital heart disease</strong> is estimated at<strong> 6-8 per 1000 live births.</strong></p>\n<p>The relative frequency of major CHD: VSD &gt; ASD = PDA &gt; CoA = ToF</p>\n<p>NOTE:</p>\n<p>Tetralogy of Fallot is the most common cyanotic heart disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As an intern posted in the pediatrics department, you notice a neonate with jaundice and a characteristic blueberry muffin rash. The mother gives an antenatal history of fever with a rash in her first trimester. On examination, he has bilateral cataracts, hepatosplenomegaly, and a murmur on auscultation. BERA reveals sensorineural deafness. On cardiac evaluation, which of the following is least likely to be found?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial septal defect"
      },
      {
        "id": 2,
        "text": "Ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 4,
        "text": "Pulmonary stenosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The classical triad of <strong>cataract, sensorineural deafness, and congenital heart disease</strong>&nbsp;point towards&nbsp;<strong>congenital rubella syndrome</strong>. <strong>Atrial septal defect</strong> (ASD) is <strong>not found</strong> in congenital rubella infection.</p>\n<p>Prenatal exposure to rubella increases the risk of congenital heart defects like:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Patent ductus arteriosus (Most common)</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Peripheral pulmonic stenosis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ventricular septal defect (VSD)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Myocarditis</li>\n</ul>\n<p>Nonspecific signs of TORCH infections are hepatosplenomegaly, thrombocytopenia, jaundice, and growth restriction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother reports to you that her baby is irritable and cries all the time. She has also noticed that her infant sweats excessively while feeding. Which of the following findings noted during the examination would you not include under NADA's major criteria?",
    "choices": [
      {
        "id": 1,
        "text": "Wide and variable S2"
      },
      {
        "id": 2,
        "text": "Congestive cardiac failure"
      },
      {
        "id": 3,
        "text": "Grade 2 mid-diastolic murmur at the mitral area"
      },
      {
        "id": 4,
        "text": "Grade 3 pansystolic murmur at the lower left sternal border"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Wide and variable S2 </strong>(Abnormal S2)&nbsp;is not included under Nada's major criteria.</p>\n<p>Features of congestive cardiac failure, a grade 3 pansystolic murmur with wide and variable S2, and an MDM at the mitral area suggest a diagnosis of<strong> large VSD</strong> in this baby.</p>\n<p><strong>NADA's criteria</strong> for clinical diagnosis of congenital heart disease:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Major criteria&nbsp;</strong></td>\n<td><strong>Minor criteria</strong></td>\n</tr>\n<tr>\n<td>Systolic murmur&nbsp; grade 3 or more</td>\n<td>Systolic murmur &lt; grade 3</td>\n</tr>\n<tr>\n<td>Any diastolic murmur</td>\n<td>Abnormal second sound (S2)</td>\n</tr>\n<tr>\n<td>Cyanosis</td>\n<td>Abnormal ECG</td>\n</tr>\n<tr>\n<td>Congestive cardiac failure</td>\n<td>\n<p>Abnormal chest X-ray findings</p>\n</td>\n</tr>\n<tr>\n<td>&nbsp;</td>\n<td>\n<p>Abnormal BP</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>The presence of 1 major or 2 minor criteria indicates congenital heart disease.</p>\n<p><strong>Pansystolic murmurs</strong> are <strong>always pathological</strong> no matter their intensity.</p>\n<p><strong>Short, soft systolic murmurs of intensity &lt;3</strong> are often detected during febrile illnesses, after which they disappear. Such murmurs are called <strong>innocent murmurs</strong>. Before labeling any murmur as innocent, it should be <strong>reassessed</strong> after an interval.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The most common type of ventricular septal defect is ______.",
    "choices": [
      {
        "id": 1,
        "text": "Membranous"
      },
      {
        "id": 2,
        "text": "Muscular"
      },
      {
        "id": 3,
        "text": "Supracristal"
      },
      {
        "id": 4,
        "text": "A and B have equal prevalence"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Membranous </strong>is the most <strong>common type </strong>of ventricular&nbsp;septal defect (VSD) to occur.</p>\n<p><strong>VSD</strong> is the <strong>most common congenital cardiac malformation.</strong></p>\n<p>Types of VSD include membranous (most common), muscular, inlet/atrioventricular canal defects, and supracristal defects.</p>\n<p><strong>Swiss Cheese septum</strong>: a special type of muscular VSD with defects in the mid-portion or apical region of the ventricular septum.</p>\n<p>Restrictive VSD -A small VSD where the size of the lesion is usually &lt;5 mm. It is associated with normal right ventricular pressure.</p>\n<p>Non-restrictive VSD -A large VSD where the size of the lesion is usually &gt;10 mm leading to equalization of pressures in the right and left ventricle.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infant born to a diabetic mother was diagnosed with a ventricular septal defect. On examination of the baby, all of the following features can be found except:",
    "choices": [
      {
        "id": 1,
        "text": "Ejection systolic murmur at the pulmonary area"
      },
      {
        "id": 2,
        "text": "Holosystolic murmur at the left 4th intercostal space"
      },
      {
        "id": 3,
        "text": "Reverse splitting of second heart sound (S2)"
      },
      {
        "id": 4,
        "text": "A mid-diastolic murmur at the mitral area."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Wide, variable splitting of S2 </strong>is a feature of VSD and not reverse splitting.</p>\n<p>The basic defect in VSD is a <strong>left-to-right shunt</strong> which occurs at the ventricular level. During systole, the left ventricle empties into the aorta and the right ventricle via the VSD, because of which the total amount of blood in the right side of the heart increases, and that on the left decreases. Due to this increase, the right ventricle takes a longer time to empty causing a <strong>delayed P2</strong> and on the other hand, the left ventricle empties sooner causing an<strong> early A2.</strong> This explains the wide S2. Variations due to respiration still happen and hence, the second heart sound is widely and variably split.</p>\n<p>Auscultatory findings of VSD include a <strong>pansystolic murmur</strong> also known as<strong> Roger's murmur</strong>/shunt murmur can be best heard in the fourth left intercostal space. Flow murmurs that can be heard include, an <strong>MDM </strong>at the<strong> mitral area</strong> and an <strong>ejection systolic murmur </strong>at the<strong> pulmonary area.</strong></p>\n<p>A hyperdynamic precordium, a palpable P2, parasternal heave, a laterally displaced apical impulse, and a systolic thrill can be detected on palpation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother is worried about her 4-month-old infant's growth. She says that her infant feeds slowly and often requires periods of rest during feeding. On examination:",
    "choices": [
      {
        "id": 1,
        "text": "Left atrial enlargement"
      },
      {
        "id": 2,
        "text": "Cardiomegaly with left ventricular apex"
      },
      {
        "id": 3,
        "text": "Pulmonary edema"
      },
      {
        "id": 4,
        "text": "Pulmonary oligemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Significant cardiomegaly, prominence of the pulmonary arterial trunk, pulmonary plethora (increased vascular markings seen in the lung fields) can be seen on the X-ray image.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e539ebc415e45a4b3f604b18b1f8e3cx358x265.PNG"
    ]
  },
  {
    "text": "A 6-week-old infant is brought to the pediatrician for immunization. She has a loud and harsh holosystolic murmur best heard over the lower left sternal border and is accompanied by a thrill. The chest radiographs and EKG are normal. Echocardiography reveals a small muscular VSD. What is the appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Fenton's operation at 4 years"
      },
      {
        "id": 2,
        "text": "Wait and watch till 5 years and then operate"
      },
      {
        "id": 3,
        "text": "Restrict physical activity and operate at 2 years"
      },
      {
        "id": 4,
        "text": "Reassure the parents"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In patients with <strong>small VSDs</strong>, parents should be <strong>reassured</strong> of the relatively benign nature of the lesion, and the child should be encouraged to live a normal life, with<strong> no restrictions</strong> on physical activity. Surgical repair is not recommended.</p>\n<p>Guidelines from the Council on Cardiovascular Disease in the Young of the American Heart Association (AHA) state that an isolated, <strong>small, hemodynamically insignificant</strong> VSD is <strong>not an indication for surgery</strong>. VSDs may get smaller or close completely without treatment, but they won't get any bigger.</p>\n<p><strong>Echocardiography</strong> is used to estimate pulmonary artery pressure, screen for the development of Left ventricular outflow tract pathology (subaortic membrane or aortic regurgitation), and <strong>confirm spontaneous closure.</strong></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A good surgeon knows when not to operate. As a pediatric surgeon, on which of the following cases of VSD would you operate?",
    "choices": [
      {
        "id": 1,
        "text": "5 only"
      },
      {
        "id": 2,
        "text": "3,5"
      },
      {
        "id": 3,
        "text": "1,2,4"
      },
      {
        "id": 4,
        "text": "1,2,3,4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Severe pulmonary vascular disease unresponsive</strong> to pulmonary vasodilators is a <strong>contraindication</strong> to the closure of a VSD - due to <strong>permanent remodeling</strong> of the pulmonary vasculature.</p>\n<p><strong>Indications for surgical closure</strong> of a VSD include:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Patients at any age with large defects in whom clinical symptoms and <strong>failure to thrive</strong> cannot be controlled medically;\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Infants between 6 and 12 mo of age with moderate to large defects associated with<strong> pulmonary hypertension</strong>, even if the symptoms are<strong> controlled by medication</strong>; and patients older than 24 mo with a <strong>Qp: Qs ratio greater than 2: 1.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Patients with a <strong>supracristal VSD of any size</strong> are usually referred for surgery because of their higher risk for developing <strong>aortic valve regurgitation</strong></li>\n</ol>\n<p>A child with large VSD showing<strong> transient improvement</strong> in symptoms with better exercise tolerance may be the<strong> first sign of developing pulmonary hypertension</strong> and indicates an urgent need for evaluation and immediate surgery - the increased pulmonary pressure reduces the amount of blood pushed into the lungs and thereby, congestion transiently.</p>\n<p>The presence of a<strong> mid-diastolic, low-pitched rumble at the apex</strong> is caused by increased blood flow across the mitral valve and usually<strong> indicates a Qp: Qs ratio \u2265of 2: 1</strong>. This murmur is best appreciated with the bell of the stethoscope.\u00a0</p>\n<p>Surgical risks are somewhat higher for defects in the muscular septum, particularly apical defects and multiple (Swiss cheese\u2013type) VSDs. These patients may require pulmonary arterial banding if symptomatic, with subsequent de-banding and repair of multiple VSDs at an older age.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Rahel, a 3-year-old girl who is a known case of congenital heart disease is admitted to your pediatric ward because of low-grade fever with afternoon elevations.  On examination, she is febrile and has painless small erythematous lesions on her palms. Her echocardiography showed oscillating intracardiac vegetation. Which one of the following congenital defects is most likely associated with the above findings?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial septal defect"
      },
      {
        "id": 2,
        "text": "Ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 4,
        "text": "Pulmonic stenosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above findings are suggestive of a diagnosis of <strong>infective endocarditis</strong> according to <strong>Modified Duke&rsquo;s criteria</strong>. Patients with <strong>high-velocity blood flow </strong>lesions such as<strong> ventricular septal defect </strong>(VSD) and <strong>aortic stenosis</strong> are at high risk for infective endocarditis.</p>\n<p>To make a diagnosis of IE,she has evidence of endocardial involvement (1 major) and fever, predisposing heart condition, Janeway lesions(a painless small erythematous lesion on palms)- 3 minor criteria.</p>\n<p>In VSD, a high-pressure gradient across the defect &rarr; turbulent blood flow &rarr; traumatizes the vascular endothelium &rarr; predisposition for infective endocarditis. Important <strong>complications of VSD</strong> include <strong>infective endocarditis&nbsp;and&nbsp;Eisenmengerisation,</strong></p>\n<p>High-risk cardiac lesions for which<strong> endocarditis prophylaxis</strong> is advised before dental procedures and invasive procedures like tonsillectomy/adenoidectomy are <strong>prosthetic heart valves, prior endocarditis, post-cardiac transplant, congenital heart disease(6 months post repair and unrepaired).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brings her 4-year-old child to the OPD. She says that the child has recurrent chest infections, easy fatiguability, and poor growth. You notice a limb abnormality as shown in the image below and find the given X-ray of the child's arm in his medical history. Based on all the findings, you suspect a congenital heart disease. Which of the following conditions are you most likely to find on screening echocardiography?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial septal defect"
      },
      {
        "id": 2,
        "text": "Coarctation of aorta"
      },
      {
        "id": 3,
        "text": "Pulmonic stenosis"
      },
      {
        "id": 4,
        "text": "Patent ductus arteriosus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The X-ray of the upper limb shows <strong>radial ray defects</strong> (absent radius and thumb) and the <strong>family history of heart disease</strong> suggest a diagnosis of<strong> Holt-Oram syndrome </strong>(aka hand-heart syndrome). Out of all the syndromes associated with cardiac defects, HOLT- ORAM has the<strong> strongest </strong>familial<strong> tendency&nbsp;</strong>- it is inherited in an <strong>Autosomal dominant</strong> manner.<br />Holt&ndash;Oram syndrome/cardiac limb syndrome is most commonly associated with <strong>atrial septal defect (ASD).</strong></p>\n<p>Features of Holt-Oram syndrome include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypoplastic or absent thumbs, radii</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Triphalangism</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Phocomelia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">1st-degree heart block</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">ASD</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7d0d9407df76479596d49d13932b1492.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child born to a 35-year-old mother was found to have a round face, flat occiput, and a protruding tongue. Karyotyping of the child is as shown below. Which of the following is commonly associated with this disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Bicuspid aortic valve"
      },
      {
        "id": 2,
        "text": "Endocardial cushion defect"
      },
      {
        "id": 3,
        "text": "Ventricular septal defect"
      },
      {
        "id": 4,
        "text": "Coarctation of aorta"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical findings and the karyotyping suggest a diagnosis of <strong>Trisomy 21 or Down syndrome</strong>. The most common cardiovascular lesion in Down&rsquo;s syndrome is an&nbsp;<strong>endocardial cushion defect</strong>.</p>\n<p>Other associated defects are atrial septum defects (ASD), ventricular septum defect (VSD), and patent ductus arteriosus (PDA), aberrant subclavian artery, and pulmonary hypertension.</p>\n<p>Other congenital defects are seen in some syndromes:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Syndrome</strong></td>\n<td><strong>Congenital defect</strong></td>\n</tr>\n<tr>\n<td>Trisomy 21 (Down syndrome)</td>\n<td>Endocardial cushion defect, VSD, ASD</td>\n</tr>\n<tr>\n<td>XO (Turner syndrome)</td>\n<td>Bicuspid aortic valve, coarctation of aorta</td>\n</tr>\n<tr>\n<td>William's syndrome</td>\n<td>Supravalvular aortic stenosis, peripheral pulmonic stenosis</td>\n</tr>\n<tr>\n<td>Noonan syndrome</td>\n<td>Pulmonic stenosis, ASD</td>\n</tr>\n<tr>\n<td>Holt&ndash;Oram syndrome</td>\n<td>ASD, 1st-degree heart block</td>\n</tr>\n<tr>\n<td>Marfan's Syndrome</td>\n<td>Mitral or Aortic Regurgitation</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/99ca46d5b944485a9dc4ffa257edfc9b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the most common type of atrial septal defect?",
    "choices": [
      {
        "id": 1,
        "text": "5"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>ASD is characterized by an&nbsp;<strong>abnormal opening</strong>&nbsp;in the atrial septum allowing communication between the right and left atria.&nbsp;There are&nbsp;<strong>four</strong>&nbsp;<strong>types</strong>&nbsp;based on their location within the septum:</p>\n<ul>\n<li>Secundum ASD -&nbsp;<strong>most common</strong>, usually an isolated abnormality</li>\n<li>Primum ASD - associated with abnormal mitral valve leaflet (partial AV septal defect)</li>\n<li>Sinus venous -&nbsp;is located&nbsp;at the&nbsp;junction of the superior vena cava and right atrium. Associated with anomalous right pulmonary venous return to the&nbsp;SVC or RA</li>\n<li>Coronary sinus type ASD - also called unroofed coronary sinus</li>\n</ul>\n<p><strong>Ostium primum ASD: </strong>is located at<strong>&nbsp;</strong>lower atrial septum</p>\n<p><strong>Endocardial cushion defect/</strong>An AV septal defect/ AV canal defect consists of contiguous atrial and VSDs with markedly abnormal AV valves. The lesion is common in children with <strong>Down syndrome</strong>.</p>\n<p>Congenital conditions associated with ASD include:</p>\n<ul>\n<li><strong>Down's</strong>&nbsp;syndrome - usually an ostium primum defect</li>\n<li><strong>Holt-Oram</strong>&nbsp;syndrome - autosomal dominant disorder with upper limb bony defects and cardiac septal defects, commonly secundum ASD</li>\n<li><strong>Ellis-van Creveld</strong>&nbsp;syndrome - chondroectodermal dysplasia associated with postaxial polydactyly and ASD</li>\n<li><strong>Lutembacher</strong>&nbsp;syndrome - combined ASD and mitral stenosis due to rheumatic valvulitis</li>\n<li>Mitral valve prolapse</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f1330d83cfe843c5a9b247ae23b68d6f.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e533c26bb3a94ce3a7eab0935e30831bx1280x1274.5839210155148.JPEG"
    ]
  },
  {
    "text": "A 6-year-old child was brought to her pediatrician for routine well-child care. Her physical examination is normal except for a systolic murmur and a widely split second heart sound that does not vary with respiration. She has no family history of heart disease. Which among the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Total anomalous pulmonary venous connection"
      },
      {
        "id": 2,
        "text": "Ventricular Septal defect"
      },
      {
        "id": 3,
        "text": "Atrial septal defect"
      },
      {
        "id": 4,
        "text": "Pulmonic stenosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The age of the patient, normal physical findings except for a systolic murmur, and wide and fixed splitting of S2 are all in favor of a diagnosis of <strong>Atrial septal defect.</strong></p>\n<p>Most ASDs are<strong> asymptomatic</strong> and are picked up during routine physical examinations. A <strong>soft ejection systolic murmur</strong> best heard over the left upper sternal border is also commonly found.<br />The soft ejection systolic murmur is a flow murmur heard due to <strong>increased blood flow</strong> through the<strong> normal pulmonary valv</strong>e. A <strong>delayed diastolic murmur</strong> can also be heard in the tricuspid area. As the right ventricle now receives more blood, the time required for its emptying is increased resulting in<strong> prolonged P2</strong>. Since the <strong>two atria are linked,</strong> inspiration does not produce any net pressure changes between them <strong>abolishing respiration-related changes</strong> in venous return hence causing <strong>fixed S2.</strong></p>\n<p>Causes of Wide and fixed splitting of S2 include,</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Atrial septal defect</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">RBBB</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">TAPVC</li>\n</ol>\n<p>Other options:</p>\n<p>TAPVC -&nbsp; patients usually present with cyanosis and congestive cardiac failure around 4-10 weeks of age - this is when the fetal pulmonary vasculature regresses and there is increased pulmonary blood flow which results in early-onset cardiac failure. The physical findings are identical to ASD.</p>\n<p>VSD - is an acyanotic heart disease and physical findings include a pansystolic murmur best heard in the left 4th parasternal area and a wide and variable split S2 which is usually masked by the pansystolic murmur.</p>\n<p>PS - is an acyanotic heart disease and physical findings include an ejection systolic murmur and a thrill in the left second interface and a wide and variable split S2 because of delayed closure of P2.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child who used to play for hours together now comes back home and says he gets tired too easily, his concerned mother brings him to you. On auscultation, you find that there is a wide and fixed splitting of the second heart sound, ECG shows left axis deviation and features of left ventricular hypertrophy. What is your probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ostium secundum atrial septal defect"
      },
      {
        "id": 2,
        "text": "Ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Ostium primum atrial septal defect"
      },
      {
        "id": 4,
        "text": "Patent ductus arteriosus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong><span class=\"TextRun SCXW84427756\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW84427756\">Wide splitting of the 2</span></span><span class=\"TextRun SCXW84427756\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW84427756\" data-fontsize=\"14\">nd</span></span></strong><span class=\"TextRun SCXW84427756\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW84427756\"><strong>&nbsp;heart sound</strong> with <strong>left axis deviation</strong> (LAD) and<strong> left ventricular hypertrophy</strong> (LVH) points to the diagnosis of <strong>ostium primum atrial septal defec</strong>t (ASD).&nbsp;</span></span>Wide-fixed splitting of the 2nd heart sound is characteristic of ASD.&nbsp;</p>\n<p>In ostium primum ASD, the basic abnormality is the combination of&nbsp;<strong>left-to-right shunt</strong> across the atrial defect and <strong>mitral insufficiency due to mitral valve clefts</strong>. Mitral valvular insufficiency<strong> increases the volume load on the left ventricle (seen as LAD &amp; LVH on ECG).&nbsp;</strong>When mitral insufficiency is severe enough to cause clinical symptoms like fatigue on exertion, the left atrium enlarges as a result of the regurgitant flow, and the left ventricle becomes hypertrophied and dilated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An ECG finding of right ventricular enlargement in a 2-year-old child is most consistent with which of the following disorders?",
    "choices": [
      {
        "id": 1,
        "text": "Atrial septal defect"
      },
      {
        "id": 2,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 3,
        "text": "Ventricular septal defect"
      },
      {
        "id": 4,
        "text": "Tricuspid atresia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>atrial septal defect</strong> (ASD), there is a <strong>left-to-right shunt,</strong> resulting in <strong>increased blood flow</strong> through the<strong> right side of the heart,</strong> which leads to enlargement of the right atrium and ventricle and dilation of the pulmonary artery, the left atrium may also be enlarged, but the left ventricle and aorta are normal in size.</p>\n<p><strong>Patent ductus arteriosus</strong> (PDA): There is shunting of blood from the aorta to the pulmonary trunk<strong>,</strong>&nbsp;which goes into the lungs and then again to the LA and LV. If the ductus is large, left ventricular or biventricular hypertrophy is present.</p>\n<p>In <strong>ventricular septal defect</strong> (VSD), there is shunting of blood from the left ventricle to the&nbsp;right ventricle, but most of the <strong>blood is shunted directly to the inflow tract</strong> of the pulmonary trunk, so, there is <strong>no</strong> <strong>significant right ventricular hypertrophy</strong>. In VSD, the pulmonary artery left atrium, and left ventricle are enlarged<strong>.</strong></p>\n<p>In <strong>Tricuspid atresia</strong>, there is right to left shunting of blood through an ASD as the tricuspid valve is dysfunctional due to which the entire <strong>systemic venous return enters the left side</strong> of the heart using the foramen ovale or through an ASD, and hence, there is <strong>left ventricular hypertrophy.</strong></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During an outreach program, you incidentally discover a child with an asymptomatic ASD. His parents are anxious as they had read on the web about transcatheter device closure and want to know if their child needs one. Your advice is he does not require it, for now, but needs regular follow-up. During the course of follow-up, you would take up the child for transcatheter device closure immediately in all of the following instances except:",
    "choices": [
      {
        "id": 1,
        "text": "If the child becomes  symptomatic"
      },
      {
        "id": 2,
        "text": "If the size of the defect is <5mm at 2 years of age."
      },
      {
        "id": 3,
        "text": "If the Qp: Qs ratio is > 2:1"
      },
      {
        "id": 4,
        "text": "If  he develops RV enlargement"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>An ASD defect of size <strong>&lt;5mm</strong> at <strong>2\u00a0years</strong> of age does <strong>not</strong> need\u00a0immediate transcatheter device closure.\u00a0<br />Small ASDs (3 to &lt;6mm in diameter) may grow smaller or close spontaneously. They do not cause symptoms and usually only need observation.\u00a0</p>\n<p><strong>Transcatheter device or surgical closure</strong> is advised for:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">All <strong>symptomatic</strong> patients</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Asymptomatic patients with a <strong>Qp: Qs ratio of at least 2: 1</strong>\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Those with <strong>RV enlargement</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">ASD size <strong>&gt;8mm</strong></li>\n</ol>\n<p>Closure (if indicated) is recommended <strong>before</strong> <strong>school entry</strong>. Repair is preferred during early childhood because surgical mortality and morbidity are significantly greater in adulthood.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As an obstetrician, you discover an atrial septal defect incidentally in a 20-year-old primigravida. You will be watchful about all of the following complications, except:",
    "choices": [
      {
        "id": 1,
        "text": "Infective endocarditis"
      },
      {
        "id": 2,
        "text": "Stroke"
      },
      {
        "id": 3,
        "text": "Arrhythmias"
      },
      {
        "id": 4,
        "text": "Pulmonary hypertension"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Infective endocarditis is extremely rare in isolated atrial septal defect (ASD)</strong> and antibiotic prophylaxis for isolated ASDs is not recommended.&nbsp;</p>\n<p>ASD is a <strong>low-pressure gradient defect</strong> whereas a high-pressure gradient across a defect is required to create a turbulent flow, which traumatizes the vascular endothelium, making the patient susceptible to endocarditis.</p>\n<p>Patients with a small or moderate ASD are asymptomatic unless a complication occurs. Pulmonary hypertension, atrial dysrhythmias, tricuspid or mitral insufficiency, and heart failure may initially appear during the <strong>increased volume load of pregnancy.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a NICU you examine a preterm baby, who has a loud, harsh, continuous, machinery murmur in the Gibson area. All of the following can be found, except:",
    "choices": [
      {
        "id": 1,
        "text": "Narrow pulse pressure"
      },
      {
        "id": 2,
        "text": "Congestive heart failure"
      },
      {
        "id": 3,
        "text": "Necrotising enterocolitis"
      },
      {
        "id": 4,
        "text": "Cardiomegaly"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A preterm baby with the classical continuous machinery murmur in the Gibson&rsquo;s area is in favor of <strong>patent ductus arteriosus</strong> as the diagnosis. Preterm babies with patent ductus arteriosus (PDA) have wide pulse pressure, hyperdynamic precordium, and bounding peripheral pulses with a continuous murmur.</p>\n<p>If the PDA is large, it can cause<strong> overloading of the left ventricle</strong> leading to <strong>cardiomegaly</strong> and <strong>congestive heart failure.&nbsp;</strong>Retrograde aortic flow, decreased systemic blood flow, and moderate hypotension is common in premature infants with a PDA predisposing them to <strong>necrotizing enterocolitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are posted as an intern in the pediatrics OPD and your professor asks you to examine an interesting case of cyanosis. On examination, you notice the bluish discoloration of the lower limbs but the upper limb and head are pink and on examination of the chest you see a parasternal heave and a thrill is palpable. These findings can occur in which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 2,
        "text": "Transposition of great vessels"
      },
      {
        "id": 3,
        "text": "Tricuspid stenosis"
      },
      {
        "id": 4,
        "text": "Ventricular septal defect"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Differential cyanosis</strong> can be seen in <strong>patent ductus arteriosus</strong> (PDA) when there is a<strong> reversal of shunt.</strong></p>\n<p>Differential cyanosis is manifested as <strong>cyanosis</strong> of only the <strong>lower extremities</strong>&nbsp;while upper extremities are unaffected.&nbsp;It is a result of reduced arterial oxygen saturation in the distal aorta compared to that in the aorta proximal to the&nbsp;left subclavian artery.</p>\n<p>&nbsp;It is seen with:</p>\n<ul>\n<li><strong>right-to-left shunting</strong> across a ductus arteriosus in the presence of <strong>coarctation</strong> or an <strong>interrupted aortic arch</strong></li>\n<li>patent ductus arteriosus (PDA) with severe pulmonary artery hypertension&nbsp;<strong>(PAH)</strong></li>\n</ul>\n<p>The rest of the options cause cyanosis of all extremities. Among the options, PDA is the only condition that can manifest with differential cyanosis when there is a reversal of shunt<strong>.</strong></p>\n<p><strong>Image</strong>: Right to left shunting of blood flow through a PDA between the&nbsp;aortic arch and pulmonary artery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0b1b61873c9945bf8943ef96d741693ax1280x1433.JPEG"
    ]
  },
  {
    "text": "Where would you place the pulse oximeter to measure pre-ductal oxygen saturation in an infant who was born 3 minutes ago?",
    "choices": [
      {
        "id": 1,
        "text": "Left upper limb"
      },
      {
        "id": 2,
        "text": "Left lower limb"
      },
      {
        "id": 3,
        "text": "Right upper limb"
      },
      {
        "id": 4,
        "text": "Right lower limb"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> right upper limb</strong> is the best area to check<strong> pre-ductal oxygen saturation </strong>in a newborn infant as it receives blood supply primarily from the <strong>right</strong>&nbsp;<strong>brachial artery</strong>, which arises from the aorta <strong>before </strong>the<strong> ductus</strong> <strong>arteriosus.</strong></p>\n<p>In routine neonatal screening for <strong>critical congenital heart diseases</strong> (CCHD), saturation probes are placed on the right upper limb (pre-ductal) and the right lower limb (post-ductal) respectively.</p>\n<p>If the <strong>difference</strong> between <strong>pre-ductal</strong> and <strong>post-ductal</strong> saturation is more than <strong>five percent,</strong> it confirms the presence of <strong>hypoxemia</strong>. Any reading showing an <strong>SpO2 &lt;90%</strong> or greater than a <strong>three percent</strong> difference between the right hand and right foot for <strong>three successive readings</strong> separated by an <strong>hour</strong> each would suggest the <strong>presence </strong>of a<strong> congenital cardiac disease.</strong></p>\n<p>Screening is done to<strong> </strong>identify critical conditions <strong>before they present symptomatically</strong>, and before the neonate <strong>leaves the hospital</strong> post-delivery. This would allow for early and effective treatment of an underlying disease.&nbsp;</p>\n<p>Critical congenital heart diseases include<strong>&nbsp;coarctation of the aorta</strong>, double outlet right ventricle, <strong>Ebstein anomaly</strong>, hypoplastic left heart syndrome, interrupted aortic arch, <strong>pulmonary atresia</strong>, single ventricle, tetralogy of Fallot (<strong>TOF</strong>), total anomalous pulmonary venous return (<strong>TAPVC</strong>), d-transposition of the great arteries (<strong>TGA</strong>), tricuspid atresia, and truncus arteriosus.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During neonatal resuscitation of a baby delivered via Cesarean section, you hear a continuous murmur. Which of the following would you not include in your differential diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Aortopulmonary window"
      },
      {
        "id": 2,
        "text": "Small ventricular septal defect"
      },
      {
        "id": 3,
        "text": "Patent ductus arteriosus"
      },
      {
        "id": 4,
        "text": "Pulmonary arteriovenous malformation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Small ventricular septal defect (VSD) characteristically produces a<strong> loud, harsh, or blowing holosystolic murmur (not </strong>continuous murmur) and is heard best over the lower left sternal border; it is frequently accompanied by a thrill.</p>\n<p><strong>Pansystolic or holosystolic murmurs</strong> begin almost simultaneously with the 1st heart sound and continue <strong>throughout systole&nbsp;</strong>(do not spill into diastole like a continuous murmur).</p>\n<p><strong>Continuous murmur</strong> is a systolic murmur that <strong>continues or &ldquo;spills&rdquo; into diastole</strong> and indicates continuous flow, such as in the presence of a patent ductus arteriosus or other aortopulmonary communication.</p>\n<p>Other options:</p>\n<p>Patent ductus arteriosus (PDA): The classic <strong>continuous murmur</strong> is described as being like <strong>machinery</strong> in quality.</p>\n<p>Aortopulmonary window: The findings can mimic those of a patent ductus arteriosus (PDA) (wide pulse pressure and a <strong>continuous murmur</strong>).</p>\n<p>Pulmonary arteriovenous malformations: Large fistulas are associated with dyspnea, cyanosis, clubbing, <strong>a continuous murmur,</strong> and polycythemia, commonly associated with <strong>Osler Weber Rendu disease</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy starts seizing while playing catch with his father. He is immediately brought to the casualty. On examination, blood pressure in the upper extremity measured as 200/140 mm Hg and femoral pulses were not palpable. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Takayasu aortoarteritis"
      },
      {
        "id": 2,
        "text": "Renal parenchyma disease"
      },
      {
        "id": 3,
        "text": "Grand mal seizure"
      },
      {
        "id": 4,
        "text": "Coarctation of the aorta"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Here, the diagnosis is coarctation of the aorta because the classic sign of coarctation of the aorta is a <strong>disparity in pulsation</strong> and<strong> blood pressure in the arms and legs</strong>&nbsp;(as seen in this patient). The <strong>femoral</strong>, popliteal, posterior tibial, and dorsalis pedis pulses are<strong> weak (or absent</strong> in up to 40% of patients), in contrast to the bounding pulses of the arms and carotid vessels. <strong>Seizure</strong> is a complication secondary to systemic hypertension since untreated coarctation can increase the risk for <strong>intracranial hemorrhage</strong> and <strong>hypertensive encephalopathy.</strong></p>\n<p>The most common site of coarctation of the aorta is distal to the origin of the left subclavian artery near the insertion of ligamentum arteriosum (juxtaductal coarctation).</p>\n<p>DDx:&nbsp;<strong>Takayasu arteritis </strong>is a<strong> chronic vasculitis</strong> of unknown etiology, <strong>predominantly affecting women</strong> with an age of onset that is usually between 10 and 40 years. The disease primarily affects the aorta and its primary branches.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A chest X-ray of a patient shows inferior rib notching. Which of the following diseases would you include in your differential diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bidirectional Glen shunt"
      },
      {
        "id": 2,
        "text": "Modified Blalock-Taussig shunt"
      },
      {
        "id": 3,
        "text": "Inferior vena caval occlusion"
      },
      {
        "id": 4,
        "text": "Coarctation of the aorta"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Notching of the inferior border of the ribs (four to eighth ribs)</strong> from pressure erosion by enlarged collateral vessels is a characteristic finding in the coarctation of the aorta by late childhood.</p>\n<p><strong>Causes of rib notching</strong></p>\n<table>\n<tbody>\n<tr>\n<td>Superior rib notching</td>\n<td>Inferior rib notching</td>\n</tr>\n<tr>\n<td>\n<p>Poliomyelitis</p>\n<p><strong>Osteogenesis imperfecta</strong></p>\n<p><strong>Neurofibromatosis</strong></p>\n<p><strong>Marfan's syndrome</strong></p>\n<p>Connective tissue diseases</p>\n<ul>\n<li>Rheumatoid arthritis</li>\n<li>Systemic lupus erythematosus</li>\n<li>Scleroderma</li>\n<li>Hyperparathyroidism</li>\n</ul>\n</td>\n<td>\n<p><strong>Coarctation of the aorta</strong></p>\n<p>Blalock&ndash;Taussig shunt</p>\n<p>Superior vena cava obstruction</p>\n<p>AV malformation of chest wall</p>\n<p>Schwannoma</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2757186e8e7c4f13915976a257c73760x1080x810.JPEG"
    ]
  },
  {
    "text": "What\u2019s your diagnosis and which is the most common anomaly associated with reference to the X-ray given below?",
    "choices": [
      {
        "id": 1,
        "text": "Transposition of great vessels , renal dysplasia"
      },
      {
        "id": 2,
        "text": "Coactation of the aorta, bicuspid aortic valve"
      },
      {
        "id": 3,
        "text": "Coarctation of aorta, renal dysplasia"
      },
      {
        "id": 4,
        "text": "Transposition of great vessels, bicuspid aortic valve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given X-ray demonstrates the&nbsp;<strong>&ldquo;3&rdquo; sign,</strong> which is pathognomic of <strong>coarctation of aorta. Bicuspid aortic valve</strong> is commonly associated with coarctation of the aorta.</p>\n<p>3 sign: Indentation of the aorta at the site of coarctation, pre and post-stenotic dilatation along the left paramediastinal shadow</p>\n<p>Other Chest X-ray features in coarctation of aorta:<strong><br /></strong></p>\n<ul>\n<li>Dilated left subclavian artery</li>\n<li>Dilated ascending aorta</li>\n<li><strong>Notching of 3<sup>rd</sup>&nbsp;and 9<sup>th</sup> ribs</strong> due to<strong> rib erosion by dilated collateral vessels</strong></li>\n</ul>\n<p>10% of individuals with CoA have a&nbsp;<strong>circle of Willis aneurysm.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c0ed2996a604ae3815a3b5826b09712.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/de7ae24f3e5a42bcab37e6dcd498ad30x413x529.PNG"
    ]
  }
];
        let quizName = '25 Acyanotic Congenital Heart Diseases';
        const quizFilename = '25-acyanotic-congenital-heart-diseases-b04fde33.html';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>