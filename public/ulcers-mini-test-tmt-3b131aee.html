<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulcers Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A young man presented with pain abdomen, diarrhoea, and fever gradually increasing in a step ladder pattern over the past 2 weeks. A Widal test confirmed the diagnosis and he was admitted. A few days later, he developed intestinal perforation and was taken up for exploratory laparotomy. Which of the following findings would you see in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Longitudinal intestinal ulcers"
      },
      {
        "id": 2,
        "text": "Stricture formation"
      },
      {
        "id": 3,
        "text": "Pinpoint ulcers"
      },
      {
        "id": 4,
        "text": "Transverse intestinal ulcers"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\"><strong>Typhoid</strong> causes&nbsp;<strong>longitudinal ulcers</strong>.</p>\n<p class=\"p1\">Typhoid fever is caused by <strong>Salmonella typhi. </strong>It&nbsp;presents with <strong>step-ladder fever</strong> and <strong>abdominal pain</strong> after an incubation period of 10&ndash;20 days. Over the next week, the patient can develop:</p>\n<ul class=\"ul1\">\n<li class=\"li1\">Distension</li>\n<li class=\"li1\">Diarrhoea</li>\n<li class=\"li1\">Splenomegaly</li>\n<li class=\"li1\">Characteristic <strong>rose spots</strong> on the abdomen caused by a vasculitis</li>\n</ul>\n<p class=\"p1\">Surgical complications of typhoid are:</p>\n<ul>\n<li class=\"p1\"><strong>Paralytic ileus</strong></li>\n<li class=\"p1\">Intestinal haemorrhage</li>\n<li class=\"p1\">Free ileal <strong>perforation</strong> (characteristically occurs during the <strong>third week</strong> of the illness)</li>\n<li class=\"p1\">Cholecystitis</li>\n<li class=\"p1\">Longitudinal ulcers (usually situated in the distal ileum)</li>\n</ul>\n<p>Diagnosis of typhoid is confirmed by <strong>culture of blood or stool</strong>.</p>\n<p class=\"p1\">Treatment is by antibiotics, usually <strong>chloramphenicol</strong>.&nbsp;</p>\n<p class=\"p1\"><strong>Perforation</strong> requires <strong>surgery</strong> to wash out and close the ulcer. Intestinal resection is usually avoided. In unstable patients, with evidence of septic shock, the bowel should be exteriorized and the perforation closed after recovery. Paratyphoid infection also resembles typhoid fever and is treated in a similar manner.&nbsp;</p>\n<p class=\"p1\">Note: Transverse ulcers&nbsp;with stricture formation are seen in tuberculosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the earliest sign in Crohn's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Cobblestone appearance"
      },
      {
        "id": 2,
        "text": "Deep fissured ulcers"
      },
      {
        "id": 3,
        "text": "Rose-thorn appearance"
      },
      {
        "id": 4,
        "text": "Aphthous ulcers"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Aphthous ulcers</strong>, surrounded by a rim of erythematous mucosa, are the <strong>earliest</strong> lesions seen in a patient with Crohn's disease during<strong> endoscopy.</strong></p>\n<p>Crohn's colitis usually spares the rectum and is <strong>most severe </strong>in the <strong>ileocaecal region</strong>.</p>\n<ul>\n<li>In early Crohn's disease, small, <strong>punched-out aphthous ulcers</strong> are often seen (the result of submucosal lymphoid follicle expansion).</li>\n<li>In moderate disease, the aphthous ulcers coalesce into larger ulcers, which may take on the appearance of a star (stellate ulcers).</li>\n<li>As disease severity increases, submucosal edema and injury can result in <strong>cobblestoning</strong> of the mucosa (option A) and eventually the formation of <strong>serpiginous ulcers</strong>, which are typical findings in Crohn's disease.&nbsp;</li>\n</ul>\n<p>Thorn-like extraluminal projections in <strong>barium studies</strong> are known as <strong>rose-thorn appearance</strong>, and are a typical sign of Crohn's disease. They represent <strong>deep penetrating linear ulcers</strong> or fissurings typically seen within stenosed terminal ileum with a thickened wall. (Options C and D)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old male patient who had sustained burn injuries over bilateral lower limbs 1 year ago, has an ulcer over his left leg that has not healed despite regular treatment, and malignant transformation is suspected. Which of the following types of edge would most likely be seen in this ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "C"
      },
      {
        "id": 2,
        "text": "D"
      },
      {
        "id": 3,
        "text": "E"
      },
      {
        "id": 4,
        "text": "B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">A chronic non-healing ulcer with <strong>malignant transformation</strong> would have <strong>everted edges,</strong> as shown in image E.</span></p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">The majority of wounds that have </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">not healed in 3 months</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> are considered </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">chronic </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">and are prone to malignant changes. Malignant wounds are differentiated clinically from non-malignant wounds by the presence of overturned edges</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">.\u00a0</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>Biopsy of the wound edges</strong> should be performed to rule out malignancy. </span><strong>Malignant transformation</strong> can occur in <strong>any long-standing wound.</strong> The image shows a <strong>Marjolin's ulcer </strong>with <strong>everted edges</strong>. It is <strong>squamous cell carcinoma</strong> that develops on a long-standing burn.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/635a6aa04977412f842213222087e8a6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fcf459e5346a446fabacb52f40eff0d7x1088x864.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4c2c9b20dca450aa7135d3537e04f37x1280x2186.JPEG"
    ]
  },
  {
    "text": "In patients with which of the following conditions, would the following procedure be contraindicated?",
    "choices": [
      {
        "id": 1,
        "text": "Surgical wound dehiscence"
      },
      {
        "id": 2,
        "text": "Diabetic foot ulcer"
      },
      {
        "id": 3,
        "text": "Bedsore"
      },
      {
        "id": 4,
        "text": "Marjolin\u2019s ulcer"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image is depictive of<strong> Vacuum-assisted closure (VAC) </strong>or <strong>Negative Pressure Wound Therapy (NPWT). </strong><strong>Malignancy</strong> developing from a wound (like <strong>Marjolin\u2019s ulcer)</strong> is a <strong>contraindication</strong> for <strong>NPWT.</strong>\u00a0</p>\n<p>Vacuum-assisted closure<strong> (VAC)</strong> or<strong> NPWT</strong> is a therapeutic technique using a <strong>vacuum dressing</strong> to <strong>promote healing</strong> in acute and chronic wounds. The principle of VAC is an intermittent<strong> negative pressure of ~125 mmHg</strong> hastens debridement and <strong>formation of granulation tissue</strong> in chronic wounds. The negative pressure <strong>removes the interstitial fluid</strong> to decrease the edema and also<strong> increases the blood flow. </strong>The principle is used in treating<strong> diabetic foot ulcers</strong> as well as<strong> stage III and IV pressure ulcers</strong>.\u00a0It is useful for the same reason in traumatic wounds, flaps and grafts, and<strong> dehisced incisions.</strong></p>\n<p>Some of the contraindications of NPWT are:</p>\n<ul>\n<li style=\"font-weight: 400;\"><strong>Exposed vasculature or organ surfaces</strong>\u00a0has an increased risk of leakage of blood following tissue erosion.</li>\n<li style=\"font-weight: 400;\">Non-enteric and unexplored fistulae can lead to dehydration and electrolyte imbalance.</li>\n<li><strong>Necrotic tissue</strong> or <strong>eschar\u00a0</strong>in the wound bed can exacerbate the non healing and necrosis.\u00a0</li>\n<li style=\"font-weight: 400;\">Inadequate debridement of <strong>devitalized soft tissue</strong> <strong>or bone</strong> increases the risk of infection.</li>\n<li style=\"font-weight: 400;\">The presence of an underlying\u00a0<strong>malignancy </strong>due to its ability to propagate and metastasize.</li>\n<li style=\"font-weight: 400;\">Active osteomyelitis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90bccde779e44b92808432d462117d62.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions would you consider as possible differentials in a patient presenting with a painless genital ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 2 only"
      },
      {
        "id": 2,
        "text": "1 and 3 only"
      },
      {
        "id": 3,
        "text": "4 and 5 only"
      },
      {
        "id": 4,
        "text": "1, 2 and 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Painless</strong> genital ulcers are seen in <strong>syphilis, granuloma inguinale, </strong>and <strong>lymphogranuloma venerum.</strong></p>\n<p>Genital herpes is typically associated with painful vesicles and chancroid is characterized by painful genital ulcers.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old woman presents to you with complaints of mass descending per vaginum for the past 6 months. On examination, grade 3 uterovaginal prolapse and a decubitus ulcer are observed. What causes this ulcer?",
    "choices": [
      {
        "id": 1,
        "text": "Thrombosis"
      },
      {
        "id": 2,
        "text": "Venous congestion"
      },
      {
        "id": 3,
        "text": "Infection"
      },
      {
        "id": 4,
        "text": "Trauma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Decubitus ulcer seen in uterine prolapse is due to<strong>\u00a0venous congestion </strong>and<strong> local circulatory changes</strong>.</p>\n<p>Decubitus ulcer refers to the ulceration of prolapsed tissue which occurs due to the <strong>chronic dependent position</strong> causing <strong>venous congestion and stasis</strong>. <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">It has a <strong>clean edge</strong> and usually <strong>heals well</strong> with<strong> prolapse reduction </strong>and <strong>daily packing</strong> with <strong>glycerine </strong>(hygroscopic agent) and <strong>acriflavine</strong> (antiseptic). It is a benign and non-infectious disease and does not require further investigation such as biopsy or culture.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is associated with post-operative wounds?",
    "choices": [
      {
        "id": 1,
        "text": "Hunner\u2019s ulcer"
      },
      {
        "id": 2,
        "text": "Buruli ulcer"
      },
      {
        "id": 3,
        "text": "Meleney\u2019s ulcer"
      },
      {
        "id": 4,
        "text": "Marjolin's ulcer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Meleney's ulcer</strong> is associated with <strong>post-operative</strong> wounds.</p>\n<p>Meleney's ulcer, also known as <strong>post-operative synergistic bacterial gangrene</strong> is a polymicrobial infection caused by a synergistic interaction between microaerophilic <strong>nonhemolytic Streptococcus </strong>and<strong> hemolytic aerobic Staphylococcus aureus.</strong> It occurs more commonly in<strong> immunocompromised </strong>patients and in<strong> infected cases</strong> such as perforations and abscesses or where there is a pre-existing ulcer such as ulcerative colitis. The ulcer <strong>begins from the margins</strong> of the wound and <strong>spreads to the subcutaneous tissue</strong> with foul-smelling discharge and <strong>purulent granulation tissue</strong>, associated with <strong>pain</strong> and <strong>toxaemia</strong> with high morbidity. The ulcer is described to have a purple rim which is surrounded by a reddish erythematous zone.\u00a0</p>\n<p>Patients require <strong>early</strong> and <strong>aggressive critical care treatment.</strong> <strong>Hyperbaric oxygen</strong> has been shown to reduce mortality in patients with Meleney's gangrene and therefore plays a significant role in the management of this condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/9037cdefdf2a48b2a39c4cb5ca9be816.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/997040cadff5400cb58a049ff32eb013x405x421.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/199b65c31d7a48f6b1e2284f0f8fea1ex600x450.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/827b6428509c49c9a62e0ac5b03f9ddbx800x594.JPEG"
    ]
  },
  {
    "text": "A patient with an ulcer shown in the image below is admitted to the general surgery ward. A history of which of the following would you be likely to elicit in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Unprotected sexual intercourse"
      },
      {
        "id": 2,
        "text": "Exposure to UV radiation"
      },
      {
        "id": 3,
        "text": "Chronic cough and weight loss"
      },
      {
        "id": 4,
        "text": "Diabetes mellitus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows an ulcer with an\u00a0<strong>undermined\u00a0</strong>edge, which is seen in <strong>tuberculosis </strong>and could be associated with a preceding history of <strong>chronic cough and weight loss.\u00a0</strong></p>\n<p>Other options:</p>\n<p>Option A: Unprotected sexual intercourse may be a significant history pointing towards<strong>\u00a0syphilis\u00a0</strong>which causes an ulcer with <strong>punched-out</strong> edges and wash-leather slough.</p>\n<p>Option B: Exposure to UV radiation suggests the development of skin cancer. <strong>Squamous cell carcinoma\u00a0</strong>has\u00a0<strong>everted\u00a0</strong>edges and\u00a0<strong>basal cell carcinoma\u00a0</strong>has\u00a0<strong>rolled-out\u00a0</strong>edges.</p>\n<p>Option D: Diabetes mellitus causes neuropathic/trophic ulcer with <strong>punched-out\u00a0</strong>edges.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5eecc2c3f08f429fbf510b1dba8df314.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38dde48faec44cca9a7738dc6fef9b00x1280x2185.JPEG"
    ]
  },
  {
    "text": "Match the ulcers with the relevant investigations to be performed in the patient.",
    "choices": [
      {
        "id": 1,
        "text": "1-C, 2-E, 3-D, 4-B, 5-A"
      },
      {
        "id": 2,
        "text": "1-E, 2-C, 3-A, 4-D, 5-B"
      },
      {
        "id": 3,
        "text": "1-A, 2-B, 3-C, 4-D, 5-E"
      },
      {
        "id": 4,
        "text": "1-E, 2-B, 3-D, 4-A, 5-C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<table style=\"border-collapse: collapse; width: 32.0327%; height: 353px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 23.8845%; text-align: center;\">Ulcer</td>\n<td style=\"width: 30.7087%; text-align: center;\">Underlying pathology</td>\n<td style=\"width: 45.4068%; text-align: center;\">Relevant investigation</td>\n</tr>\n<tr>\n<td style=\"width: 23.8845%;\">1. Marjolin's ulcer</td>\n<td style=\"width: 30.7087%;\">Squamous cell carcinoma</td>\n<td style=\"width: 45.4068%;\">Skin biopsy</td>\n</tr>\n<tr>\n<td style=\"width: 23.8845%;\">2. Martorell's ulcer</td>\n<td style=\"width: 30.7087%;\">Hypertension</td>\n<td style=\"width: 45.4068%;\">BP measurement</td>\n</tr>\n<tr>\n<td style=\"width: 23.8845%;\">3. Curling's ulcer</td>\n<td style=\"width: 30.7087%;\">Burns</td>\n<td style=\"width: 45.4068%;\">Fluid intake/output</td>\n</tr>\n<tr>\n<td style=\"width: 23.8845%;\">4. Cushing's ulcer</td>\n<td style=\"width: 30.7087%;\">Raised intra-cranial pressure</td>\n<td style=\"width: 45.4068%;\">ICP monitoring</td>\n</tr>\n<tr>\n<td style=\"width: 23.8845%;\">5. Bairnsdale ulcer</td>\n<td style=\"width: 30.7087%;\">Mycobacterial infection</td>\n<td style=\"width: 45.4068%;\">Acid-fast staining</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the given condition.",
    "choices": [
      {
        "id": 1,
        "text": "Venous ulcer"
      },
      {
        "id": 2,
        "text": "Malignant ulcer"
      },
      {
        "id": 3,
        "text": "Arterial ulcer"
      },
      {
        "id": 4,
        "text": "Trophic ulcer"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given picture showing an ulcer with <strong>punched-out edges</strong> over a <strong>pressure point</strong> is most likely that of a <strong>trophic ulcer/</strong>neuropathic ulcer.</p>\n<p>A neuropathic ulcer is one that occurs as a result of&nbsp;<strong>peripheral neuropathy</strong>. In peripheral neuropathy, lack of sensation over the pressure points leads to cumulative microtrauma, minor wounds, or cuts that remain unnoticed but eventually develop into ulcers.</p>\n<p>Features of a neuropathic ulcer include</p>\n<ul>\n<li>Painless ulcer</li>\n<li><strong>Punched out ulcer</strong> with regular margins</li>\n<li class=\"p1\">Often located on the <strong>plantar surface</strong> of the foot</li>\n<li class=\"p1\">Ulcer margins show the presence of<strong> calluses&nbsp;</strong></li>\n</ul>\n<table style=\"height: 531px; width: 635px; float: left;\">\n<tbody>\n<tr style=\"height: 60px;\">\n<td style=\"width: 103px; height: 60px;\">&nbsp;</td>\n<td style=\"width: 207px; height: 60px;\"><strong>Ischemic/Arterial Ulcer</strong></td>\n<td style=\"width: 95px; height: 60px;\"><strong>Venous Ulcer</strong></td>\n<td style=\"width: 121px; height: 60px;\"><strong>Neuropathic Ulcer&nbsp;</strong></td>\n<td style=\"width: 115px; height: 60px;\"><strong>Tuberculous Ulcer&nbsp; &nbsp;</strong></td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 103px; height: 72px;\"><strong>Underlying condition</strong></td>\n<td style=\"width: 207px; height: 72px;\">\n<p>Peripheral vascular disease- mainly atherosclerosis, thromboangiitis obliterans, cervical rib, Raynaud's phenomenon</p>\n</td>\n<td style=\"width: 95px; height: 72px;\">Varicose veins, previous deep vein thrombosis</td>\n<td style=\"width: 121px; height: 72px;\">Diabetes, peripheral neuropathy</td>\n<td style=\"width: 115px; height: 72px;\">Tuberculosis lymph nodes, cold abscess from bone and joint tuberculosis</td>\n</tr>\n<tr style=\"height: 79px;\">\n<td style=\"width: 103px; height: 79px;\"><strong>Location</strong></td>\n<td style=\"width: 207px; height: 79px;\">Toes, feet, legs, or even upper limb digits</td>\n<td style=\"width: 95px; height: 79px;\">Lower limb, commonly on the medial side of the ankle, never above the middle third of the leg</td>\n<td style=\"width: 121px; height: 79px;\">The plantar surface of the foot, toes</td>\n<td style=\"width: 115px; height: 79px;\">Neck, axilla, and groin</td>\n</tr>\n<tr style=\"height: 126.390625px;\">\n<td style=\"width: 103px; height: 126.391px;\"><strong>Characteristics</strong></td>\n<td style=\"width: 207px; height: 126.391px;\">\n<p>Deep, penetrates the deep fascia exposing the tendons, muscles, and underlying bone.</p>\n<p>The ulcer is painful, tender, and hyperaesthetic.&nbsp;</p>\n</td>\n<td style=\"width: 95px; height: 126.390625px;\">Vertically oval, painless, the floor may have pale to no granulation tissue, induration, and tenderness at the base.</td>\n<td style=\"width: 121px; height: 126.390625px;\">Punched-out with regular calloused margins.&nbsp;</td>\n<td style=\"width: 115px; height: 126.390625px;\">\n<div class=\"page\" title=\"Page 74\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Edges are thin, reddish blue, undermined; pale granulation tissue, scanty discharge on the floor, and slight induration at the base</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 121px;\">\n<td style=\"width: 103px; height: 121px;\"><strong>Other features</strong></td>\n<td style=\"width: 207px; height: 121px;\">Features of ischemia in adjacent areas, like pallor, dry skin, brittle nails, loss of hair</td>\n<td style=\"width: 95px; height: 121px;\">Inguinal lymph nodes are enlarged, usually the vertical group, and the ulcer is recurrent; forms again after healing</td>\n<td style=\"width: 121px; height: 121px;\">Dry, cracked, insensate</td>\n<td style=\"width: 115px; height: 121px;\">Regional lymph nodes are enlarged, non-tender, matted</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ab27542be9694df6966f39881dbdcbd6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/05cd84aa9c6b4ba4b8a703203b56ca84x1280x956.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a277163d01f14377a0caac15cdb27804x648x432.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f0c315db1d94698b862516e1b06e8bfx900x1200.JPEG"
    ]
  },
  {
    "text": "A 50 year old male patient with a chronic ulcer over the lower limb has been advised to undergo a biopsy for further evaluation. From which part of the ulcer would the specimen be taken?",
    "choices": [
      {
        "id": 1,
        "text": "Margin"
      },
      {
        "id": 2,
        "text": "Base"
      },
      {
        "id": 3,
        "text": "Edge"
      },
      {
        "id": 4,
        "text": "Floor"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Biopsy </strong>of an ulcer is taken from the <strong>edge </strong>as it <strong>contains multiplying cells</strong>. The <strong>floor </strong>is not chosen as it may be<strong> inadequate </strong>due to to the <strong>presence of necrotic tissue.</strong></p>\n<p>An<strong> ulcer</strong> is defined as a <strong>break in the continuity </strong>of the <strong>epithelium or mucous membrane</strong> with <strong>molecular death</strong>.</p>\n<p>Classically an ulcer is described to have four parts which are:\u00a0</p>\n<ul>\n<li>The <strong>margin</strong> is defined as the <strong>junction</strong> between the <strong>normal epithelium</strong> and the <strong>ulcer</strong>.</li>\n<li>The <strong>edge</strong> is defined as the part <strong>between</strong> the <strong>margin</strong> and the <strong>floor</strong>.</li>\n<li>The<strong> floor</strong> is defined as the <strong>exposed surface of the ulcer</strong>. It is<strong> better seen than felt</strong>, and may contain granulation tissue, discharge or slough. Trophic ulcers have bone as the floor due to their depth.</li>\n<li>The<strong> base</strong> is defined as the <strong>structure on which the ulcer rests</strong>, eg, bone or soft tissue. It is<strong> better felt than seen.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2c04f2500e843efaa65a52f904a16edx1280x923.JPEG"
    ]
  },
  {
    "text": "A 9-month-old baby was brought with complaints of pink morbilliform rashes on the trunk as shown below. The child had a history of high fever for 3 days following which these rashes appeared. On oral examination, ulcers are present at the uvulopalatoglossal junction. Which of the following herpes viruses is most likely to be implicated in the pathogenesis of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "HHV- 7"
      },
      {
        "id": 2,
        "text": "HHV- 5"
      },
      {
        "id": 3,
        "text": "HHV- 4"
      },
      {
        "id": 4,
        "text": "HHV- 8"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 6930\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The history of <strong>fever</strong> and <strong>ulcers at the uvulopalatoglossal junction (Nagayama spots</strong>) along with the image showing <strong>pink morbilliform</strong> <strong>rashes</strong> on the trunk of an infant makes the likely diagnosis\u00a0<strong>roseola infantum.</strong> It is caused by a human Herpesvirus (HHV)-<strong>\u00a06B,</strong> and <strong>7.</strong></p>\n</div>\n</div>\n</div>\n<p><strong>Roseola infantum\u00a0</strong>is also called as\u00a0<strong>sixth disease </strong>or exanthema subitum. <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>HHV-6B </strong>is responsible for the majority of cases of roseola infantum and only a small percentage of children with roseola have a primary infection with HHV-7.</span></p>\n<div class=\"page\" title=\"Page 6928\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Primary HHV-6B infection peaks between the ages of <strong>6 and 9 months.</strong></p>\n</div>\n</div>\n</div>\n<p>Clinical features include:</p>\n<ul>\n<li>Prodrome of <strong>high-grade fever</strong></li>\n<li><strong>Non-pruritic, morbilliform rash</strong>, which appears as the fever comes down.</li>\n<li>Leucopenia and relative lymphocytosis</li>\n<li><strong>Nagayama spots</strong>: ulcers at uvulo-palatoglossal junction</li>\n</ul>\n<p>Diagnosis includes polymerase chain reaction (<strong>PCR</strong>) for detecting the viral DNA.</p>\n<p>This is a self-limiting disease and treatment is done as <strong>supportive care</strong> in the form of maintaining hydration and using antipyretics if the child has a fever.\u00a0</p>\n<div class=\"page\" title=\"Page 2855\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<table style=\"height: 403.196px; width: 663px;\">\n<tbody>\n<tr style=\"height: 44.8011px;\">\n<td style=\"width: 63.9489px; height: 44.8011px;\"><strong>Official name</strong></td>\n<td style=\"width: 213.668px; height: 44.8011px;\"><strong>Common name</strong></td>\n<td style=\"width: 343.349px; height: 44.8011px;\"><strong>Pathophysiology</strong></td>\n</tr>\n<tr style=\"height: 44.8011px;\">\n<td style=\"width: 63.9489px; height: 44.8011px;\">HHV-1</td>\n<td style=\"width: 213.668px; height: 44.8011px;\">Herpes simplex virus type 1 (HSV-1)</td>\n<td style=\"width: 343.349px; height: 44.8011px;\">Oral and/ or genital herpes (Mainly orofacial)</td>\n</tr>\n<tr style=\"height: 44.8011px;\">\n<td style=\"width: 63.9489px; height: 44.8011px;\">HHV-2</td>\n<td style=\"width: 213.668px; height: 44.8011px;\">Herpes simplex virus type 2 (HSV-2)</td>\n<td style=\"width: 343.349px; height: 44.8011px;\">Oral and/ or genital herpes (Mainly genital)</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 63.9489px; height: 22.4006px;\">HHV-3</td>\n<td style=\"width: 213.668px; height: 22.4006px;\">Varicella zoster virus (VZV)</td>\n<td style=\"width: 343.349px; height: 22.4006px;\"><strong>Chickenpox</strong> and <strong>shingles</strong></td>\n</tr>\n<tr style=\"height: 112.003px;\">\n<td style=\"width: 63.9489px; height: 112.003px;\">HHV-4</td>\n<td style=\"width: 213.668px; height: 112.003px;\">Epstein-Barr virus (EBV)</td>\n<td style=\"width: 343.349px; height: 112.003px;\"><strong>Infectious mononucleosis</strong>, Burkitt's lymphoma, Post-transplant lymphoproliferative disease, <strong>Nasopharyngeal carcinoma</strong>, CNS lymphoma in AIDS patients, and HIV-associated hairy leukoplakia</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 63.9489px; height: 22.4006px;\">HHV-5</td>\n<td style=\"width: 213.668px; height: 22.4006px;\">Cytomegalovirus (CMV)</td>\n<td style=\"width: 343.349px; height: 22.4006px;\"><strong>Infectious mononucleosis-like syndrome</strong></td>\n</tr>\n<tr style=\"height: 44.7869px;\">\n<td style=\"width: 63.9489px; height: 44.7869px;\"><strong>HHV-6</strong></td>\n<td style=\"width: 213.668px; height: 44.7869px;\">\n<div class=\"page\" title=\"Page 482\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Human Bcell lymphotropic virus</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 343.349px; height: 44.7869px;\"><strong>Roseola infantum</strong> or exanthema subitum (The majority of the cases are caused by\u00a0<strong>HHV-6</strong>)</td>\n</tr>\n<tr style=\"height: 22.4006px;\">\n<td style=\"width: 63.9489px; height: 22.4006px;\"><strong>HHV-7</strong></td>\n<td style=\"width: 213.668px; height: 22.4006px;\">\n<div class=\"page\" title=\"Page 482\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>RK virus</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 343.349px; height: 22.4006px;\"><strong>Roseola infantum</strong> or exanthema subitum</td>\n</tr>\n<tr style=\"height: 44.8011px;\">\n<td style=\"width: 63.9489px; height: 44.8011px;\"><strong>HHV-8</strong></td>\n<td style=\"width: 213.668px; height: 44.8011px;\">Human herpesvirus 8</td>\n<td style=\"width: 343.349px; height: 44.8011px;\"><strong>Kaposi's sarcoma</strong>, primary effusion lymphoma, <strong>multicentric Castleman's disease (MCD)</strong></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n</div>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4694b611293f4517b6cdd48d1d9d032d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient who had a history of an injury to the index finger a week ago presented to the OPD with the following finding of healthy appearing tissue growing beyond the margin of the ulcer. Which of the following might predispose to the finding shown?",
    "choices": [
      {
        "id": 1,
        "text": "Normal wound healing"
      },
      {
        "id": 2,
        "text": "Bleeding disorder"
      },
      {
        "id": 3,
        "text": "Retained foreign body"
      },
      {
        "id": 4,
        "text": "Malignant transformation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario and clinical findings are suggestive of\u00a0<strong>exuberant granulation tissue</strong> or <strong>proud flesh</strong>.</p>\n<p>Formation of exuberant granulation tissue may occur as a\u00a0 deviation from normal wound healing where<strong> excessive</strong> amounts of<strong> granulation tissue</strong> protrude above the level of the surrounding skin and <strong>blocks re-epithelialization. </strong>It may be associated with the presence of a retained foreign body within the ulcer bed or underlying sinus cavity. Although it represents healthy tissue, the wound should be debrided and the granulation tissue <strong>should be excised</strong> using a Volkmann's scoop or by surgical cautery before it is <strong>allowed to heal</strong> with continuity of the epithelium.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/74048e4004274ff186692c738d0a30db.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old female patient who has accompanied her grandmother for a check-up, asks you about ulcers she has developed in the oral mucosa. She has no other systemic symptoms and has no family history of chronic medical illness. What is the ideal next step?",
    "choices": [
      {
        "id": 1,
        "text": "Prescribe topical steroids"
      },
      {
        "id": 2,
        "text": "Rule out accidental bite or use of dentures/braces"
      },
      {
        "id": 3,
        "text": "Send blood for ESR and CRP"
      },
      {
        "id": 4,
        "text": "Reassure the patient that it is self-limiting"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Oral mucosal ulcers</strong> may be<strong> traumatic</strong> due to accidental biting, or the presence of dentures and braces hence the ideal next step would be to rule out the patient's use of such oral appliances.</p>\n<p>Traumatic ulcers usually <strong>heal by simply removing the irritant</strong> without any other intervention and should be considered the possible diagnosis before investigating oral ulcers as aphthous ulcers.</p>\n<p><strong>Aphthous ulcers</strong> are <strong>painful, recurrent, </strong>and<strong> non-contagious</strong> oral lesions. They are well-circumscribed, ulcerative lesions with a white necrotic base surrounded by a red halo. They heal in 10\u201314 days without scarring. Their aetiology is unclear but they are <strong>associated with systemic illnesses</strong> such as <strong>inflammatory bowel disease, gluten-sensitive enteropathy and Behcet's disease</strong> and hence the presence of a positive family history or other suggestive symptoms or sings may warrant the need for further investigation once common causes like traumatic ulcers are ruled out.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the likely diagnosis of the lesion shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Ischemic ulcer"
      },
      {
        "id": 2,
        "text": "Neuropathic ulcer"
      },
      {
        "id": 3,
        "text": "Venous ulcer"
      },
      {
        "id": 4,
        "text": "Tuberculous ulcer"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image showing a\u00a0<strong>punched-out ulcer</strong> with regular margins located on the\u00a0<strong>plantar surface</strong> of the foot points to the diagnosis of a\u00a0<strong>neuropathic ulcer.</strong></p>\n<p>In <strong>peripheral neuropathy</strong>, lack of sensation over the pressure points leads to cumulative microtrauma, minor wounds, or cuts that go unnoticed eventually developing into ulcers.</p>\n<table style=\"height: 531px; width: 721px; float: left;\">\n<tbody>\n<tr style=\"height: 60px;\">\n<td style=\"width: 101px; height: 60px;\">Type of Ulcer</td>\n<td style=\"width: 209px; height: 60px;\">Ischaemic/Arterial</td>\n<td style=\"width: 140px; height: 60px;\">Venous</td>\n<td style=\"width: 113.601px; height: 60px;\"><strong>Neuropathic</strong></td>\n<td style=\"width: 163.399px; height: 60px;\">Tuberculous\u00a0\u00a0</td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 101px; height: 72px;\">Underlying condition</td>\n<td style=\"width: 209px; height: 72px;\">\n<p>Peripheral vascular disease mainly atherosclerosis, thromboangitis obliterans, and Raynaud's phenomenon</p>\n</td>\n<td style=\"width: 140px; height: 72px;\">Varicose veins, previous deep vein thrombosis</td>\n<td style=\"width: 113.601px; height: 72px;\"><strong>Diabetes, peripheral neuropathy</strong></td>\n<td style=\"width: 163.399px; height: 72px;\">Tuberculosis lymph nodes, cold abscess from bone and joint tuberculosis</td>\n</tr>\n<tr style=\"height: 79px;\">\n<td style=\"width: 101px; height: 79px;\">Location</td>\n<td style=\"width: 209px; height: 79px;\">Toes, feet, legs, or even upper limb digits</td>\n<td style=\"width: 140px; height: 79px;\">Lower limb, commonly on the medial side of the ankle, never above the middle third of the leg</td>\n<td style=\"width: 113.601px; height: 79px;\"><strong>The plantar surface of the foot and toes</strong></td>\n<td style=\"width: 163.399px; height: 79px;\">Neck, axilla, and groin</td>\n</tr>\n<tr style=\"height: 126px;\">\n<td style=\"width: 101px; height: 126px;\">Characteristics</td>\n<td style=\"width: 209px; height: 126px;\">\n<p>Deep, penetrates the deep fascia exposing the tendons, muscles, and underlying bone. The ulcer is painful, tender, and hyperaesthetic.\u00a0</p>\n</td>\n<td style=\"width: 140px; height: 126px;\">Vertically oval, and painless. The floor may have pale to no granulation tissue, induration, and tenderness at the base.</td>\n<td style=\"width: 113.601px; height: 126px;\"><strong>Punched-out with regular calloused margins.\u00a0</strong></td>\n<td style=\"width: 163.399px; height: 126px;\">\n<div class=\"page\" title=\"Page 74\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Edges are thin, reddish blue, and undermined. Pale granulation tissue, scanty discharge on the floor, and slight induration at the base</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 137.196px;\">\n<td style=\"width: 101px; height: 137.196px;\">Other features</td>\n<td style=\"width: 209px; height: 137.196px;\">Features of ischemia in adjacent areas, like pallor, dry skin, brittle nails, loss of hair</td>\n<td style=\"width: 140px; height: 137.196px;\">Inguinal lymph nodes are enlarged usually the vertical group. The ulcer is recurrent.</td>\n<td style=\"width: 113.601px; height: 137.196px;\"><strong>Dry, cracked, insensate</strong></td>\n<td style=\"width: 163.399px; height: 137.196px;\">Regional lymph nodes are enlarged, non-tender, and matted</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3e49687ceac44291a56b738e6345185c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/370782681457420a93952f2cc2b6edddx750x563.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5c5c5422e0e4a40974986655549438dx473x612.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f2208997c3f441ada5ed8f6e9142b646x900x1200.JPEG"
    ]
  },
  {
    "text": "A 20-year-old Nigerian tourist presents with the following painless lesion. He had noticed a hard nodule over the same area two weeks ago in his home country, prior to coming to India. As he had no pain, he did not pay attention to the progression of the ulcer. What is the causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "M. avium-intracellulare"
      },
      {
        "id": 2,
        "text": "M. ulcerans"
      },
      {
        "id": 3,
        "text": "M. kansasi"
      },
      {
        "id": 4,
        "text": "M. tuberculosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is that of a <strong>Buruli ulcer, </strong>which is caused by<strong> <em>Mycobacterium ulcerans</em></strong>.</p>\n<p>It is the<strong> third most common</strong> mycobacterial skin infection in immunocompetent people. It is endemic to <strong>Africa</strong> and <strong>Australia</strong>, where it affects children and elderly people. It starts as a <strong>nodule</strong> or <strong>papule</strong> which progresses further to form an extensive, <strong>necrotic ulcer</strong>, exposing muscle and tendon. Most lesions occur on the<strong> lower extremities</strong>. Healing is slow.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf88e25ca79b4b82a329b9c9d04597f4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/935645a5d0794d08b75c9ca9bccafb28x1280x1103.9774330042312.JPEG"
    ]
  },
  {
    "text": "Collar button ulcer is a feature of _______",
    "choices": [
      {
        "id": 1,
        "text": "Ulcerative colitis"
      },
      {
        "id": 2,
        "text": "Crohn\u2019s disease"
      },
      {
        "id": 3,
        "text": "Ischemic colitis"
      },
      {
        "id": 4,
        "text": "Typhoid ulcers"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Collar button ulcer is a feature of deep lesions in ulcerative colitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a328be38a2b453a893b30c9afefb011x424x446.PNG"
    ]
  },
  {
    "text": "In the examination of an ulcer, which of the following is best assessed by palpation?",
    "choices": [
      {
        "id": 1,
        "text": "Margin"
      },
      {
        "id": 2,
        "text": "Edge"
      },
      {
        "id": 3,
        "text": "Base"
      },
      {
        "id": 4,
        "text": "Floor"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>base </strong>of an ulcer<strong> </strong>is <strong>better felt</strong> than seen and hence should be assessed by palpation.</p>\n<p>An <strong>ulcer</strong> is defined as a <strong>break in the continuity</strong> of the <strong>epithelium</strong> or <strong>mucous membrane</strong> with <strong>molecular death</strong>. Classically an ulcer is described to have <strong>four parts</strong> which are: <strong>margin, edge, floor </strong>and<strong> base</strong>.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2c04f2500e843efaa65a52f904a16edx1280x923.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3bc0f2493dcf4a9ab64364a20bb00767x1280x2185.JPEG"
    ]
  },
  {
    "text": "A patient being evaluated for epigastric pain undergoes upper GI endoscopy which reveals multiple esophageal ulcers as shown in the image below. The most likely cause of these ulcers is:",
    "choices": [
      {
        "id": 1,
        "text": "Herpes-simplex virus"
      },
      {
        "id": 2,
        "text": "Metaplasia"
      },
      {
        "id": 3,
        "text": "Candida"
      },
      {
        "id": 4,
        "text": "Peptic ulcer disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows multiple<strong> punched out ulcers,</strong>\u00a0characteristic of <em><strong>Herpes simplex </strong></em>(HSV)<strong> esophagitis.\u00a0</strong></p>\n<p>HSV esophagitis commonly occurs in <strong>immunocompromised</strong> patients. For diagnosis, the biopsy sample should be taken from the <strong>edge</strong> of the ulcer. The following microscopic findings are noted:</p>\n<ul>\n<li>Ballooning degeneration</li>\n<li>Ground-glass changes in nuclei</li>\n<li>Cowdry type A intranuclear inclusion bodies</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a09e1cee258a44f985dc35b0f4cac1a5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5dc7ceb412fe4823a9226e9dc0bf648ax1280x1135.JPEG"
    ]
  },
  {
    "text": "An 18-year-old boy presents with a history of injury to the eye caused while climbing a tree 5 days ago; the injury has caused pain, photophobia, and redness of the eye for 2 days. Slit-lamp examination reveals a lesion as shown below. Which of the following is a feature of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Reverse hypopyon"
      },
      {
        "id": 2,
        "text": "Dendritic ulcer"
      },
      {
        "id": 3,
        "text": "Ring abscess"
      },
      {
        "id": 4,
        "text": "Satellite lesion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette and the image of an <strong>ulcer</strong> with&nbsp;<strong>irregular feathery margins</strong>&nbsp;are suggestive of a&nbsp;<strong>fungal corneal ulcer. Satellite lesions</strong> are a feature of fungal ulcers.</p>\n<p>A fungal corneal ulcer is usually caused by trauma with <strong>vegetative</strong> or organic matter.&nbsp;<strong>Signs</strong> are more pronounced than symptoms. The corneal ulcer <strong>appears&nbsp;dry.</strong></p>\n<p><strong>Causative organisms</strong>:</p>\n<ul>\n<li><em>Aspergillus</em></li>\n<li><em>Fusarium</em></li>\n<li><em>Candida albicans</em></li>\n</ul>\n<p><strong>Signs of a fungal ulcer:</strong></p>\n<ul>\n<li>Irregular margins of the ulcer</li>\n<li>Presence of <strong>satellite lesions</strong> surrounding the ulcer.</li>\n<li>An immune ring (Wesseley ring) may be seen around the ulcer due to the deposition of the immune complexes.</li>\n<li>Slough is usually dry, with feathery borders surrounded by a yellow line of demarcation.</li>\n<li>Hypopyon may be present or absent. If present, it is thick, and immobile due to the direct invasion of the fungal hyphae into the anterior chamber.</li>\n</ul>\n<p><strong>Treatment</strong>:</p>\n<ul>\n<li>Topical drugs: These include topical <strong>natamycin</strong>, <strong>voriconazole,</strong> or <strong>amphotericin B</strong> drops, which are effective against <em>Aspergillus</em> and <em>Fusarium</em>. <strong>Nystatin</strong> is effective against <em>Candida</em>.</li>\n<li>Systemic drugs: Severe ulcers with hypopyon, perforation, or suspected endophthalmitis might warrant the use of oral antifungal agents such as <strong>ketoconazole</strong> or <strong>voriconazole.</strong></li>\n</ul>\n<p>Other options :</p>\n<p>Option A: <strong>Reverse hypopyon</strong>&nbsp;is the&nbsp;collection&nbsp;of&nbsp;emulsified silicone oil&nbsp;in the&nbsp;anterior chamber. Here, emulsified silicone bubbles are coalesced and seen in the upper part of the anterior chamber (AC).&nbsp;</p>\n<p>Option B: <strong>Dendritic ulcer</strong> is seen in epithelial keratitis caused by the herpes simplex virus. An image of a dendritic ulcer with fluorescein dye is shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a4348274f725436081a49dae9020ef36.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0f613ec05cc4b5a9f1535124b57481fx624x412.PNG"
    ]
  }
];
        let quizName = 'Ulcers Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>