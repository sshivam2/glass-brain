<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>31 Abscesses Of Pharynx - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / ENT
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following marked structures is the space of Gillette?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option 1 is&nbsp;<strong>Gillette&rsquo;s space</strong>.</p>\n<p><strong>Retropharyngeal</strong> <strong>space</strong> is divided into <strong>two lateral compartments </strong>(spaces of Gillette) by a median fibrous raphe.</p>\n<p>Option 2 - Danger space - between <strong>alar fascia</strong> anteriorly and <strong>prevertebral fascia </strong>posteriorly<strong>.</strong></p>\n<p>Option 3 - Prevertebral space.</p>\n<p>Option 4 - Anterior cervical space.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/44ad70a3abbf4aa98cdc19892e5ae1cd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An ENT surgeon is performing an incision and drainage for a retropharyngeal abscess due to suppurative lymphadenitis. Which among the following groups of lymph nodes is most likely to be involved?",
    "choices": [
      {
        "id": 1,
        "text": "Rouvier node"
      },
      {
        "id": 2,
        "text": "Delphian node"
      },
      {
        "id": 3,
        "text": "Virchow's node"
      },
      {
        "id": 4,
        "text": "Cloquet's node"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Rouvier Nodes</strong> or retropharyngeal lymph nodes suppurate to form <strong>retropharyngeal abscess.&nbsp;</strong></p>\n<p>Each lateral compartment of retropharyngeal space contains lymph nodes that usually <strong>disappear at 3-4 years of age</strong>. Suppuration of these lymph nodes is the most common cause of retropharyngeal space abscess in children.</p>\n<p>Option B - Delphian nodes are the pre-laryngeal lymph nodes.</p>\n<p>Option C - Virchow's node is the left supraclavicular lymph node.</p>\n<p>Option D - Cloquet&rsquo;s nodes are the deep inguinal lymph nodes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A concerned mother brought her toddler to the ER with complaints of noisy breathing and the child refusing to feed. On examination, the child has adenoid facies and there is a bulge in the posterior pharyngeal wall lateral to the midline. Which of the following is a false statement regarding the disease described above?",
    "choices": [
      {
        "id": 1,
        "text": "Suppuration of nodes of Rouvier can cause the above condition"
      },
      {
        "id": 2,
        "text": "Caries of the cervical spine is the most common cause"
      },
      {
        "id": 3,
        "text": "In adults similar condition may result from penetrating injury of the cervical esophagus"
      },
      {
        "id": 4,
        "text": "Torticollis is one of the symptoms."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical condition is suggestive of <strong>acute retropharyngeal abscess</strong> whereas <strong>caries of the cervical spine</strong> results in a <strong>chronic retropharyngeal abscess.</strong></p>\n<p>Acute retropharyngeal abscess is commonly seen in children <strong>below 3 years</strong>. It is the result of suppuration of retropharyngeal lymph nodes secondary to infection in the <strong>adenoids</strong>, nasopharynx, posterior nasal sinuses, or nasal cavity.</p>\n<p>In <strong>adults</strong>, it may result from <strong>penetrating injury</strong> of the posterior pharyngeal wall or cervical esophagus.</p>\n<p>Clinical features of a retropharyngeal abscess include</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Dysphagia</strong> and difficulty in breathing - as the abscess obstructs the air and food passages.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Stridor</strong> and croupy cough&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Torticollis</strong> - the neck becomes stiff and the head is kept extended.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">A <strong>bulge</strong> in the posterior pharyngeal wall, usually seen on <strong>one side of the midline</strong>.&nbsp;</li>\n</ul>\n<p><strong>Chronic retropharyngeal abscess</strong> is the result of</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Caries</strong> of the cervical spine</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Tuberculous infection</strong> of retropharyngeal lymph nodes secondary to tuberculosis of deep cervical nodes.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 42-year-old HIV positive man presents with an acute onset high-grade fever with chills and shortness of breath. On evaluation, he's diagnosed to have a necrotising mediastinitis secondary to rupture of a retropharyngeal abscess. What is the likely route of spread of infection to the mediastinum?",
    "choices": [
      {
        "id": 1,
        "text": "Between  buccopharyngeal fascia and alar fascia."
      },
      {
        "id": 2,
        "text": "Between alar fascia and prevertebral fascia"
      },
      {
        "id": 3,
        "text": "Between the capsule of tonsil and superior constrictor muscle"
      },
      {
        "id": 4,
        "text": "Between prevertebral fascia and vertebrae"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The likely route of spread of infection is&nbsp;between the <strong>alar fascia</strong> anteriorly and the <strong>prevertebral fascia</strong> posteriorly. It is also called the<strong>&nbsp;danger space</strong>&nbsp;or alar space.</p>\n<p>It lies just posterior to the retropharyngeal space. It extends from the skull base to the diaphragm. Infections from this space can spread to the mediastinum, and hence it is named the danger space.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Given below is an X-ray of a child who presented with stridor. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Epiglottitis"
      },
      {
        "id": 2,
        "text": "Retropharyngeal abscess"
      },
      {
        "id": 3,
        "text": "Ludwig's angina"
      },
      {
        "id": 4,
        "text": "TB spine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image is suggestive of a <strong>retropharyngeal abscess</strong>. It can be diagnosed on a lateral x-ray of the soft tissues of the neck.&nbsp; The features include :</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Widening of the prevertebral soft tissue shadow</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Loss of cervical lordosis</li>\n<li>In an acute abscess,&nbsp; air-fluid levels can be seen.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/163837a548484066a9469b21564a3392.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following options is synonymous with quinsy?",
    "choices": [
      {
        "id": 1,
        "text": "Dental abscess."
      },
      {
        "id": 2,
        "text": "Peritonsillar abscess."
      },
      {
        "id": 3,
        "text": "Prevertebral abscess."
      },
      {
        "id": 4,
        "text": "Parapharyngeal abscess"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>It is the collection of pus between the <strong>fibrous capsule of the tonsil</strong> and the <strong>superior constrictor muscles</strong> of the pharynx.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged diabetic man who had undergone a tooth extraction presents with fever and trismus. On examination, his posterior pillar is pushed medially and there is a swelling in the neck at the upper 1/3rd of the sternocleidomastoid muscle. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Retropharyngeal abscess"
      },
      {
        "id": 2,
        "text": "Parapharyngeal abscess"
      },
      {
        "id": 3,
        "text": "Ludwig\u2019s angina"
      },
      {
        "id": 4,
        "text": "Peritonsillar abscess"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario is suggestive of <strong>parapharyngeal abscess.</strong></p>\n<p>Parapharyngeal abscess presents with:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Trismus due to spasm of medial pterygoid</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Tonsils pushed medially</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Swelling in the upper part of the sternocleidomastoid (space limited to the level of hyoid bone).</li>\n</ul>\n<p>Option A - Retropharyngeal abscess presents as a bulge in the posterior pharyngeal wall on one side of the midline.</p>\n<p>Option C - In Ludwig&rsquo;s angina, tonsils are not pushed medially.</p>\n<p>Option D - Peritonsillar abscess doesn&rsquo;t produce swelling in the upper 1/3rd of the sternocleidomastoid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not synonymous with parapharyngeal abscess?",
    "choices": [
      {
        "id": 1,
        "text": "Pterygomaxillary abscess"
      },
      {
        "id": 2,
        "text": "Pharyngomaxillary abscess"
      },
      {
        "id": 3,
        "text": "Lateral pharyngeal abscess"
      },
      {
        "id": 4,
        "text": "Medial pharyngeal abscess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Parapharyngeal abscess is not synonymous with medial pharyngeal abscess.</p>\n<p><strong>Parapharyngeal abscess</strong> is synonymous with <strong>pharyngomaxillary</strong> or lateral pharyngeal or <strong>pterygomaxillary</strong> abscess.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is correct regarding a parapharyngeal abscess?",
    "choices": [
      {
        "id": 1,
        "text": "Always spreads from the retropharyngeal space"
      },
      {
        "id": 2,
        "text": "Usually self limited"
      },
      {
        "id": 3,
        "text": "It has preponderance for male gender"
      },
      {
        "id": 4,
        "text": "Oral antibiotics are used"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Parapharyngeal abscess\u00a0</strong>has a preponderance for <strong>male gender.<br /><br /></strong>Parapharyngeal abscess is an <strong>emergency</strong> condition. Infection can spread to the parapharyngeal space from any of the other deep neck spaces - peritonsillar, retropharyngeal and submandibular spaces. It commonly spreads from a <strong>dental infection</strong>,<strong>\u00a0tonsillitis </strong>or<strong> peritonsillar</strong>\u00a0<strong>abscesses</strong>. The patient is usually systemically unwell, with severe trismus and possibly airway compromise.\u00a0</p>\n<p>Initial broad-spectrum <strong>intravenous antibiotics</strong> should include cover against streptococci and anaerobic organisms.</p>\n<p><strong>Carotid sheath vessel thrombosis</strong>, necrotizing fasciitis and mediastinitis are some of the complications.</p>\n<p class=\"page\" title=\"Page 280\">Marked neck swelling, airway compromise, and male gender appear to be predictive of higher-risk cases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features will not be manifested in an infection of the post-styloid compartment of the parapharyngeal space?",
    "choices": [
      {
        "id": 1,
        "text": "Trismus"
      },
      {
        "id": 2,
        "text": "Vocal cord palsy"
      },
      {
        "id": 3,
        "text": "Parotid swelling"
      },
      {
        "id": 4,
        "text": "Horner\u2019s syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Trismus</strong> is <strong>not</strong> a feature of infection of the <strong>post-styloid</strong> compartment of the <strong>parapharyngeal</strong> space. Trismus is seen in <strong>pre-styloid</strong> abscess due to the involvement of <strong>medial pterygoid</strong> muscle.</p>\n<p>Parapharyngeal space is divided into two compartments by the styloid process and its attachments. Clinical features depend on the compartment involved.</p>\n<p>In a <strong>post-styloid abscess</strong>, there is a <strong>bulge of the pharynx</strong> behind the posterior pillar, accompanied by paralysis of cranial nerves <strong>IX</strong>, <strong>X</strong> (resulting in vocal cord paralysis), <strong>XI</strong>, <strong>XII</strong>, and the <strong>sympathetic chain</strong>, which can manifest as Horner's syndrome. <strong>Swelling</strong> in the <strong>parotid</strong> region may also be present. Notably, trismus, the inability to fully open the mouth, is usually absent in this type of abscess.</p>\n<p>A <strong>pre-styloid abscess</strong> exhibits distinct features including the <strong>prolapse</strong> of the <strong>tonsil</strong> and tonsillar fossa, along with <strong>trismus</strong> caused by the spasm of the <strong>medial pterygoid</strong> muscle. Marked <strong>odynophagia</strong> is common. Additionally, an external <strong>swelling</strong> can be observed <strong>behind the angle of the jaw</strong>.</p>\n<p>Fever, sore throat, <strong>torticollis</strong> (caused by spasm of the prevertebral muscles), and signs of systemic toxicity are common features.</p>\n<p>Diagnosis can be established using a contrast-enhanced CT scan (<strong>CECT</strong>). If there is suspicion of thrombosis of the internal jugular vein or an aneurysm of the internal carotid artery, magnetic resonance arteriography (<strong>MRA</strong>) can be useful.</p>\n<p>Patients require <strong>intravenous antibiotic</strong> therapy with amoxicillin-clavulanic acid, carbapenem antibiotics plus drugs that target anaerobic organisms, such as clindamycin or metronidazole. A parapharyngeal abscess is drained by an <strong>external horizontal incision</strong> made on the skin a few centimeters <strong>below the angle of the mandible</strong>.</p>\n<p>The image attached below shows the components of both spaces:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/65e95b72f7834a8ea6c17c6d7d26289ax1280x1473.JPEG"
    ]
  },
  {
    "text": "In which of the following clinical scenarios will you not perform an intraoral incision?",
    "choices": [
      {
        "id": 1,
        "text": "A 21-year-old woman with fever, hot potato voice and bulging of soft palate and anterior pillar above the tonsil on the right side."
      },
      {
        "id": 2,
        "text": "A 50-year-old diabetic man with fever, neck swelling over upper \u2153 rd of the left sternocleidomastoid and the tonsils on the same side pushed medially"
      },
      {
        "id": 3,
        "text": "A 3-year-old child with fever and swelling in the posterior pharyngeal wall lateral to the midline"
      },
      {
        "id": 4,
        "text": "A 50-year-old man with  fever due to penetrating injury of oral mucosa by wood splinters"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>An intraoral incision is not sufficient in the case of option B -\u00a0<strong>parapharyngeal abscess.</strong> An <strong>external neck incision</strong> must be made <strong>always</strong> to ensure complete drainage of the abscess.</p>\n<p>Option A-\u00a0 This is a case of <strong>quinsy</strong> as the child has odynophagia and a hot potato voice.</p>\n<p>Option B - This is a case of <strong>parapharyngeal abscess</strong> as the swelling is in the upper 1/3rd of the neck and the tonsil of the same side is pushed medially</p>\n<p>Option C- This is a case of <strong>retropharyngeal abscess</strong> since there is fever and swelling in the posterior pharyngeal wall lateral to the midline.</p>\n<p>Option D- This is a case of <strong>Sublingual abscess</strong> involving the sublingual space which is caused by penetrating injuries of oral mucosa due to fishbone or wood splinters.</p>\n<p>Indications for Incision and Drainage:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Sublingual abscess: Always intraoral incision</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Parapharyngeal abscess: Always external neck incision.</li>\n<li>Peritonsillar abscess: Always intraoral.</li>\n<li>Retropharyngeal abscess:\n<ul>\n<li>Intraoral - in rose position</li>\n<li>External -\u00a0<strong>Dean approach</strong></li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ludwig\u2019s angina:\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intraoral\u2014if the infection is still localized to sublingual space.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">External\u2014if the infection involves submaxillary space.\u00a0</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old boy comes with complaints of right ear pain, difficulty in opening the mouth, painful swallowing, and fever. The oral cavity examination reveals the following. The external facial examination is unremarkable. Which of the following is likely?",
    "choices": [
      {
        "id": 1,
        "text": "Pharyngitis"
      },
      {
        "id": 2,
        "text": "Parotid abscess"
      },
      {
        "id": 3,
        "text": "Bezold\u2019s Abscess"
      },
      {
        "id": 4,
        "text": "Quinsy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">The given clinical scenario describes a child with <strong>fever</strong>, <strong>otalgia</strong>, <strong>trismus</strong>, and <strong>odynophagia</strong> with a normal external facial examination. The oral cavity shows <strong>congested</strong> and <strong>edematous tonsil</strong> and tonsillar pillars with edematous <strong>uvula pushed to the opposite side</strong>. These findings are highly suggestive of <strong>q</strong><strong>uinsy (peritonsillar abscess)</strong>.&nbsp;</p>\n<p>It is the collection of pus in the<strong> peritonsillar space</strong>&nbsp;between the&nbsp;<strong>fibrous capsule of the tonsil</strong>&nbsp;and the&nbsp;<strong>superior constrictor muscles</strong>&nbsp;of the pharynx. Both <strong>aerobic</strong> and <strong>anaerobic</strong> organisms are seen.</p>\n<p>Patient presents with fever, unilateral <strong>throat pain</strong>, odynophagia, <strong>hot potato voice</strong>, <strong>torticollis</strong>,&nbsp;foul breath, referred <strong>otalgia</strong> through glossopharyngeal nerve and <strong>trismus</strong> due to spasm of pterygoid muscles.</p>\n<p>Oral cavity examination may show <strong>congested</strong> and <strong>edematous tonsils</strong>, pillars, and soft palate on the involved side. Edematous <strong>uvula</strong> <strong>pushed to the opposite side</strong>. Pus may be seen on the tonsillar region. Jugulodigastric lymph nodes may be enlarged.</p>\n</div>\n</div>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>The management of quinsy is by <strong>antibiotics</strong> and <strong>incision</strong> and <strong>drainage</strong> to drain the abscess followed by <strong>interval tonsillectomy</strong> 4 to 6 weeks later.&nbsp;</p>\n<p><strong>Rare complications</strong> seen are parapharyngeal abscess, edema of the larynx, septicemia, lung abscess, or jugular vein thrombosis.&nbsp;</p>\n<p>Other options:&nbsp;</p>\n<p>Option A: <strong>Pharyngitis</strong> presents with fever, throat pain, enlarged tonsils, and lymphoid follicles on the <strong>posterior pharyngeal wall</strong>.&nbsp;</p>\n<p>Option B: <strong>Parotid abscess</strong> occurs due to the suppuration of parotid space. It&nbsp;presents with <strong>swelling</strong>, <strong>redness</strong>, firmness, and tenderness in the <strong>parotid area</strong> and at the <strong>angle of</strong> the <strong>mandible</strong>. It is usually unilateral, but bilateral abscesses can occur. Due to the thick capsule, fluctuation is often difficult to elicit.&nbsp;</p>\n<p>Option C:&nbsp;<strong>Bezold abscess</strong> is a complication of acute <strong>otomastoiditis</strong> where the infection/pus breaks through the thin medial side of the tip of the mastoid and presents as a <strong>swelling</strong> in the <strong>upper part of the neck</strong>.&nbsp;</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6d050147219141d786ca7baf5e9058a1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about quinsy is false?",
    "choices": [
      {
        "id": 1,
        "text": "Collection of pus between the capsule of tonsil and superior constrictor"
      },
      {
        "id": 2,
        "text": "Presents with odynophagia and drooling of saliva"
      },
      {
        "id": 3,
        "text": "Doesn\u2019t involve floor of mouth"
      },
      {
        "id": 4,
        "text": "Commonly occurs bilaterally"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>It is a collection of pus in the peritonsillar space which lies between the capsule of the tonsil and the superior constrictor muscle.</p>\n<p>Usually, it is unilateral though occasionally bilateral abscesses are recorded.</p>\n<p>It presents with marked <strong>odynophagia</strong> such that the patient cannot even swallow his <strong>saliva</strong> which <strong>dribbles</strong> from the angle of his mouth. The patient is usually <strong>dehydrated.</strong></p>\n<p>Muffled and thick speech, often called <strong>hot potato voice.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old girl presented with complaints of fever, right-sided throat pain, and difficulty in swallowing. On examination, she had hot potato speech and halitosis. The right tonsil was not visualised due to oedematous pillars and the uvula was pushed to the left. How will you manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Antibiotics and analgesia"
      },
      {
        "id": 2,
        "text": "Interval tonsillectomy"
      },
      {
        "id": 3,
        "text": "Incision & drainage along with antibiotics"
      },
      {
        "id": 4,
        "text": "Hot tonsillectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Management of quinsy</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hospitalization</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intravenous fluids to combat dehydration</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Antibiotics - Suitable antibiotics in large IV doses to cover aerobes and anaerobes</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Analgesics</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Drainage by needle aspiration or incision and drainage</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Tonsillectomy when there is airway obstruction or recurrence.</li>\n</ul>\n<p><strong>Incision and drainage</strong> of the abscess: A peritonsillar abscess is opened at the point of the maximum bulge above the upper pole of the tonsil or just lateral to the point of junction of the anterior pillar with a line drawn through the base of the uvula.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with recurrent peritonsillar abscess, when is the ideal time to perform a tonsillectomy?",
    "choices": [
      {
        "id": 1,
        "text": "6 months"
      },
      {
        "id": 2,
        "text": "6 weeks"
      },
      {
        "id": 3,
        "text": "6 days"
      },
      {
        "id": 4,
        "text": "Along with incision and drainage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a patient with recurrent peritonsillar abscess (quinsy), ideally, an&nbsp;<strong>interval tonsillectomy</strong> is done <strong>4-6 weeks</strong> after the infection settles down.</p>\n<p><strong>Hot tonsillectomy</strong>: Earlier tonsillectomy was done during incision and drainage. But this is not followed now as it is dangerous and can lead to aspiration, bleeding &amp; spread of infection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with complaints of pain while swallowing since 2 days. He also gives a history of toothache since 1 week. On examination, there is a swelling and erythema as in the figure below. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Ludwig\u2019s angina"
      },
      {
        "id": 2,
        "text": "Vincent's angina"
      },
      {
        "id": 3,
        "text": "Quinsy"
      },
      {
        "id": 4,
        "text": "Parapharyngeal abscess"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical scenario is suggestive of&nbsp;<strong>Ludwig&rsquo;s angina</strong>.&nbsp;</p>\n<p>Ludwig&rsquo;s angina is an <strong>infection of the submandibular space</strong> which lies between the mucous membrane of the floor of the mouth and tongue on one side and the superficial layer of deep cervical fascia extending between the hyoid bone and mandible on the other.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6088205a4fd04f62b9851e33a165b201.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a false statement about Ludwig\u2019s angina?",
    "choices": [
      {
        "id": 1,
        "text": "It involves both sublingual and submandibular space"
      },
      {
        "id": 2,
        "text": "It is usually bilateral"
      },
      {
        "id": 3,
        "text": "Dental infections are the most common cause"
      },
      {
        "id": 4,
        "text": "H.influenza is the most common organism implicated."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Mixed infection</strong> with <strong>aerobes</strong> and <strong>anaerobes</strong> is seen in <strong>Ludwig&rsquo;s angina</strong>. Among these alpha-hemolytic streptococci, staphylococci and Bacteroides groups are common.</p>\n<p>Ludwig&rsquo;s angina is an infection of the submandibular space.</p>\n<p>The space is divided into two compartments by the mylohyoid muscle:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Sublingual compartment (above the mylohyoid).</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Submandibular and submental compartment (below the mylohyoid).</li>\n</ul>\n<p>The two compartments are continuous around the posterior border of the mylohyoid muscle. Both compartments freely communicate in the midline with the opposite side. Therefore <strong>infection rapidly becomes bilateral</strong>.</p>\n<p>The most common cause of Ludwig's angina is <strong>dental infections</strong> (accounts for 80%) of cases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old man presents to the OPD with odynophagia and swelling. He is diagnosed with Ludwig\u2019s angina. How might you describe the swelling?",
    "choices": [
      {
        "id": 1,
        "text": "Tender fluctuant swelling in the floor of mouth"
      },
      {
        "id": 2,
        "text": "Tender fluctuant swelling in the parotid region"
      },
      {
        "id": 3,
        "text": "Woody hard swelling in the floor of mouth"
      },
      {
        "id": 4,
        "text": "Woody hard swelling in the parotid region"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ludwig's angina</strong> presents as a tender&nbsp;<strong>woody hard swelling</strong> on the <strong>floor of the mouth</strong>.</p>\n<p>There can be marked difficulty in swallowing (<strong>odynophagia</strong>) with varying degrees of trismus.&nbsp;The tongue is progressively pushed upwards and backward, <strong>threatening the airway</strong>.&nbsp;<strong>Laryngeal edema</strong> may also be present.</p>\n<p>Usually, there is <strong>cellulitis of the tissues</strong> rather than frank abscess. Incision and drainage show <strong>salted pork appearance</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man with multiple comorbidities, post-op day 5 of major abdominal surgery has developed high-grade fever and swelling over the parotid area. On examination, there is tenderness, induration and pus exuding from the Stenson\u2019s duct on applying pressure over the parotids. Which of the following options is not a likely cause for the above condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dehydration"
      },
      {
        "id": 2,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 3,
        "text": "Oral infections"
      },
      {
        "id": 4,
        "text": "Excessive gland stimulation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario is suggestive of a <strong>parotid abscess</strong> and excessive gland stimulation is <strong>not</strong> a cause for its formation.</p>\n<p>Etiology of Parotid Abscess:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Dehydration</strong>, particularly in <strong>postsurgical cases</strong> (5-7 post-op days) and debilitated patients, with stasis of salivary flow is the predisposing cause.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Infection from the oral cavity</strong> travels via the Stenson&rsquo;s duct to invade the parotid gland (retrograde spread of infection). The most common organism is <strong><em>Staphylococcus aureus</em></strong> but Streptococci, anaerobic organisms, and rarely the gram negative organisms have also been cultured.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a parotid abscess is planned for incision and drainage (I & D). Which of the following practices will you avoid in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Put an incision that is similar to parotidectomy"
      },
      {
        "id": 2,
        "text": "Blunt dissection of the pus pockets"
      },
      {
        "id": 3,
        "text": "Dissection parallel to the facial nerve branches"
      },
      {
        "id": 4,
        "text": "Wait for the swelling to become fluctuant before performing I & D"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In a case of a <strong>parotid abscess</strong>, one must <strong>never wait for fluctuation</strong> or pus point to occur. This is because the superficial layer of <strong>parotidomasseteric fascia</strong> is <strong>tense</strong> and the fluctuation will be apparent only in later stages.</p>\n<p>A parotid abscess&nbsp;refers to an infection and pus formation in the parotid space. It is caused most commonly by&nbsp;<em><strong>Staphylococcus aureus</strong>.&nbsp;</em><strong>Post-surgical cases</strong>&nbsp;and&nbsp;<strong>debilitated patients</strong>&nbsp;with&nbsp;<strong>stasis</strong> of salivary flow are at risk of developing parotid abscesses.</p>\n<p>Patients typically present with <strong>unilateral swelling, redness, induration,</strong> and tenderness over the parotid gland and angle of the mandible. Dehydration and fever are also present.&nbsp;Diagnosis is by <strong>ultrasonography</strong> or a <strong>CT scan</strong>. Multiple small loculi of pus are seen in the parenchyma. Aspiration of abscess can be done to determine the culture and sensitivity of the infective agent.&nbsp;</p>\n<p>Correction of <strong>dehydration</strong>, improving oral hygiene and promoting salivary flow. Intravenous antibiotics are also used in treatment.&nbsp;</p>\n<p>Surgical drainage under local or general anesthesia is carried out by a <strong>preauricular incision</strong> as employed for <strong>parotidectomy. </strong>A&nbsp;skin flap is raised to expose the surface of the gland, and the abscess or abscesses are <strong>bluntly opened</strong> working <strong>parallel</strong> to the branches of the <strong>VIIth nerve</strong>. The skin incision is loosely approximated over a drain and allowed to heal by <strong>secondary intention</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '31 Abscesses Of Pharynx';
        let hierarchy = ["Marrow", "qBank", "ENT"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>