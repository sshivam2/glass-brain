<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interstitial Lung Diseases Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A patient presented with shortness of breath and a dry cough. His spirometry test shows a restrictive pattern. The HRCT scan is shown below. Which of the following would you expect to find in the physical examination of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Bronchial breath sounds on auscultation"
      },
      {
        "id": 2,
        "text": "Bibasilar inspiratory rales on auscultation"
      },
      {
        "id": 3,
        "text": "Barrel chest on inspection"
      },
      {
        "id": 4,
        "text": "Stony dull note note on percussion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a patient with <strong>chronic shortness of breath </strong>and<strong> dry cough</strong>,<strong> spirometry</strong> showing a <strong>restrictive defect</strong>&nbsp;points to a diagnosis of<strong> interstitial lung disease</strong>. The given <strong>HRCT</strong> shows prominent <strong>honeycombing</strong> in the <strong>lower</strong> and <strong>posterior</strong> <strong>lung zones</strong>, likely to be <strong>idiopathic pulmonary fibrosis (IPF)</strong>. The patient will have <strong>bibasilar</strong> <strong>inspiratory</strong> <strong>crackles</strong> on auscultation.</p>\n<p><strong>Interstitial lung diseases</strong> are characterized by <strong>inflammation</strong> and <strong>fibrosis</strong> involving the <strong>lung parenchyma</strong>. Although there are multiple diseases under this subset, the clinical presentation for all of them is the same. The <strong>patients</strong> are usually <strong>over 60 years of age</strong> and present with <strong>progressive exertional dyspnea</strong> and <strong>dry cough</strong>. On examination, <strong>fine</strong> <strong>inspiratory, velcro crackles</strong> may be heard. <strong>Digital</strong> <strong>clubbing</strong> and <strong>cyanosis</strong> are signs of advanced disease.</p>\n<p><strong>Pulmonary function tests (PFT)</strong> will show a <strong>restrictive deficit</strong> and <strong>reduction of TLC, FEV1, </strong>and<strong> FVC</strong>. There is also a <strong>reduction</strong> in <strong>DL<sub>CO</sub></strong> and may be the <strong>first finding</strong> seen<strong> in PFT</strong>. Other laboratory tests should be undertaken if the patient has symptoms involving other systems, to rule out any connective tissue disorder which might have led to ILD.</p>\n<p><strong>IPF </strong>is the <strong>most common interstitial lung disease</strong> occurring due to an <strong>unknown cause</strong>. <strong>HRCT</strong> shows <strong>predominant</strong> <strong>subpleural</strong> and <strong>basal</strong> <strong>involvement</strong>, in the form of <strong>reticulation</strong>, <strong>honeycombing,</strong> and <strong>traction</strong> <strong>bronchiectasis</strong>. This is known as the <strong>usual interstitial pneumonia (UIP)</strong> <strong>pattern</strong>. Note that <strong>ground glass opacities</strong> are <strong>absent</strong> in this pattern.&nbsp;</p>\n<p>The <strong>treatment</strong> of IPF is with <strong>antifibrotic therapy</strong> such as <strong>pirfenidone</strong> and <strong>nintedanib</strong>.</p>\n<p>Other options :</p>\n<p>Option A: <strong>Bronchial breath sounds</strong> are heard in patients with consolidation, such as in <strong>pneumonia</strong>. The sound from the airways is conducted to the skin better when the alveoli are consolidated. This leads to bronchial breath sounds.</p>\n<p>Option C: <strong>Barrel-shaped chest</strong> is associated with <strong>emphysema</strong>. This occurs because of the loss of the parenchymal elastic tissue in the lung, leading to hyperinflation.</p>\n<p>Option D: Stony dull note on percussion is seen in <strong>pleural effusion</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aef9fbdd5e87465fb4483273c234aff0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man presented with cough, dyspnea, fever, and fatigue. On examination, inspiratory rales are present. A high-resolution CT image is given below. The lung biopsy showed characteristic Masson bodies. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Idiopathic pulmonary fibrosis"
      },
      {
        "id": 2,
        "text": "Non specific interstitial pneumonia"
      },
      {
        "id": 3,
        "text": "Cryptogenic organizing pneumonia"
      },
      {
        "id": 4,
        "text": "Acute interstitial pneumonia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette with cough, dyspnoea, fever, HRCT image showing characteristic<strong> reversed halo sign,</strong> and biopsy showing Masson bodies points to a probable diagnosis of <strong>cryptogenic organizing pneumonia</strong>.</p>\n<p>Cryptogenic organizing pneumonia (COP) is idiopathic interstitial pneumonia that typically involves elderly patients. It usually presents as mild flu-illness with fever, cough, and dyspnoea. On auscultation, inspiratory rales are usually present.</p>\n<p>This disease can be sporadic or can also occur secondary to conditions such as connective tissue disorders (polymyositis) and malignancy.</p>\n<p><strong>High-resolution CT </strong>(HRCT) is the preferred imaging modality of choice. <strong>Patchy consolidation</strong> with a predominantly subpleural and/or peribronchial distribution is the most common finding. Some cases are associated with ground-glass opacity or crazy paving pattern. The characteristic <strong>reverse halo sign or atoll sign</strong> is highly specific but is seen in a few cases.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed029f8506cb4fd1b51f4745c207dc50.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/21f75304762d4b69a4018bd63d4ec854x273x204.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5fc768e731d34e48b7cf2c7327f3b04bx720x475.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/395d8397c3004ead9967de8e34858db5x952x632.JPEG"
    ]
  },
  {
    "text": "A patient underwent lung transplant due to idiopathic pulmonary fibrosis 2 years ago. Over the past 7 months, he has had a progressive decrease in pulmonary function on serial spirometry. A biopsy shows lymphocytic infiltrate and fibrosed airways. What is this pattern of rejection called?",
    "choices": [
      {
        "id": 1,
        "text": "Bronchiolitis obliterans"
      },
      {
        "id": 2,
        "text": "Acute cellular rejection"
      },
      {
        "id": 3,
        "text": "Vanishing airway syndrome"
      },
      {
        "id": 4,
        "text": "Graft vs host disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's history of lung transplantation with progressively <strong>worsening pulmonary function</strong> suggests chronic graft rejection. The biopsy findings of a lymphocytic infiltrate with fibrosed airways are typical of<strong> bronchiolitis obliterans syndrome(BOS).&nbsp;</strong></p>\n<p>BOS is the <strong>classic</strong> form of lung rejection and more than 50% of patients who receive a lung transplant will develop it to some extent in 5 years. It is characterised by <strong>breathlessness</strong> and <strong>cough</strong> that develops after months to years after a transplant. There should be <strong>persistence</strong> of <strong>symptoms</strong> for more than <strong>3</strong> weeks and other causes of graft dysfunction should be excluded.</p>\n<p>Diagnosis is confirmed by <strong>biopsy</strong> which shows the <strong>lymphocytic infiltrate</strong> and <strong>fibrosis</strong> of the <strong>terminal airways</strong> with alveolar sparing.&nbsp; A CT scan shows <strong>fibrosis</strong> and <strong>thickening</strong> of the bronchial walls and a <strong>mosaic pattern</strong> persists due to air trapping.&nbsp;</p>\n<p>Treatment is by <strong>augmentation</strong> of <strong>immunosuppression</strong> as the disease course is thought to be a form of <strong>organ rejection.</strong>&nbsp;</p>\n<p>Other Options:</p>\n<p>Acute cellular rejection occurs within days to weeks of a transplant. This patient has had the symptoms 2 years after the transplant.&nbsp;</p>\n<p>Vanishing airway syndrome also called vanishing <strong>bronchus</strong> syndrome presents post-transplant with <strong>necrotic</strong> <strong>changes</strong> in the walls of the bronchus. It is very rare and is unlikely to be the cause of this patient's symptoms.&nbsp;</p>\n<p><strong>Graft versus host </strong>disease rarely involves the <strong>lungs</strong> and is unlikely to be the cause of this patient's symptoms.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presenting with breathing difficulties is a known case of tuberous sclerosis. Later on, the patient is diagnosed with lymphangioleiomyomatosis. This pulmonary condition has a predilection for which epidemiological parameters?",
    "choices": [
      {
        "id": 1,
        "text": "A smoker, male patient"
      },
      {
        "id": 2,
        "text": "A non-smoker, male patient"
      },
      {
        "id": 3,
        "text": "A smoker, female patient"
      },
      {
        "id": 4,
        "text": "A non-smoker, female patient"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pulmonary lymphangioleiomyomatosis (LAM) has a predilection for&nbsp;<strong>non-smoker, female patients.</strong></p>\n<p>It is usually seen in <strong>young females</strong> with <strong>tuberous sclerosis.&nbsp;</strong>LAM can lead to <strong>pneumothorax</strong> or <strong>chylous effusions</strong>.&nbsp;</p>\n<p>Pulmonary function testing usually reveals an <strong>obstructive</strong> or <strong>mixed obstructive-restrictive</strong> pattern.&nbsp;<strong>HRCT</strong> shows thin-walled <strong>cysts</strong> surrounded by normal lung parenchyma.&nbsp;</p>\n<p><strong>Smoking-related ILDs</strong>:</p>\n<ul>\n<li>DIP - Desquamative interstitial pneumonia.</li>\n<li>RB-ILD - Respiratory bronchiolitis&ndash;associated ILD</li>\n<li>LCH - Langerhans cell histiocytosis</li>\n</ul>\n<p><strong>Sex predilection&nbsp;in ILDs</strong></p>\n<table style=\"height: 123px;\" width=\"406\">\n<tbody>\n<tr>\n<td style=\"width: 202px;\"><strong>Women</strong></td>\n<td style=\"width: 188px;\"><strong>Men</strong></td>\n</tr>\n<tr>\n<td style=\"width: 202px;\">Pulmonary LAM (associated with tuberous sclerosis)</td>\n<td style=\"width: 188px;\">Pneumoconiosis (due to occupational exposure to asbestos, beryllium, and silica)</td>\n</tr>\n<tr>\n<td style=\"width: 202px;\">ILDs associated with connective tissue disorder (CTD) (except ILD associated with rheumatoid arthritis)</td>\n<td style=\"width: 188px;\">ILD associated with rheumatoid arthritis&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 202px;\">&nbsp;</td>\n<td style=\"width: 188px;\">Idiopathic pulmonary fibrosis (IPF)</td>\n</tr>\n<tr>\n<td style=\"width: 202px;\">&nbsp;</td>\n<td style=\"width: 188px;\">Pulmonary Langerhans cell histiocytosis (LCH)</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 56-year-old man presents with fatigue, dry cough, and dyspnea on exertion. On examination, his hands showed hyperextension of the proximal interphalangeal joint and flexion of the distal interphalangeal joint. Laboratory results revealed normocytic normochromic anemia and elevated anti-CCP antibodies. What is the most common interstitial lung disease associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Usual interstitial pneumonia"
      },
      {
        "id": 2,
        "text": "Non specific interstitial pneumonia"
      },
      {
        "id": 3,
        "text": "Cryptogenic organizing pneumonia"
      },
      {
        "id": 4,
        "text": "Acute interstitial pneumonia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features and blood picture in the scenario suggest\u00a0<strong>rheumatoid arthritis.</strong> The\u00a0most common interstitial lung disease associated with this condition is\u00a0<strong>usual interstitial pneumonia\u00a0</strong>(UIP).</p>\n<p>Laboratory diagnosis of rheumatoid arthritis:</p>\n<ul>\n<li>Increase in erythrocyte sedimentation rate and C-reactive protein.</li>\n<li>Serum rheumatoid factor and anti-cyclic citrullinated peptide antibody (anti-CCP) are positive. Anti-CCP antibodies are more\u00a0<strong>specific </strong>for<strong> diagnosis\u00a0</strong>and a predictor of\u00a0<strong>poor prognosis.</strong></li>\n<li>The<strong> most common\u00a0</strong>anemia associated is\u00a0<strong>normocytic normochromic </strong>anemia<strong>.</strong></li>\n</ul>\n<p>Hyperextension of the proximal interphalangeal joint and flexion of the distal interphalangeal joint suggest\u00a0<strong>swan neck deformity</strong>\u00a0in rheumatoid arthritis. UIP has a <strong>poor prognosis</strong> and is generally refractive to treatment.</p>\n<p><strong>High-resolution computed tomography\u00a0</strong>(HRCT) is the\u00a0<strong>initial investigation </strong>of<strong> choice\u00a0</strong>for a patient with interstitial lung disease. The\u00a0<strong>most common</strong> HRCT pattern seen in a patient with ILD in rheumatoid arthritis is the\u00a0<strong>UIP</strong> pattern. Nonspecific interstitial pneumonia (NSIP)\u00a0can also be seen. The characteristic HRCT findings of UIP are -\u00a0</p>\n<ul>\n<li><strong>Bilateral, lower lobe, subpleural\u00a0</strong>reticular changes</li>\n<li><strong>Traction bronchiectasis</strong></li>\n<li><strong>Honey combing pattern</strong></li>\n</ul>\n<p>The image given below shows the CT findings of <strong>UIP</strong>:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1b4392895f4b4214afd5a34100c211b8x952x632.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ead68e0aecf4b22a529b45a9c0cad6cx273x204.JPEG"
    ]
  },
  {
    "text": "Which of the following patients will have predominantly fibrosis of upper lobes of the lung?",
    "choices": [
      {
        "id": 1,
        "text": "A 25 year old man with  bleomycin use"
      },
      {
        "id": 2,
        "text": "A 45 year old woman with scleroderma"
      },
      {
        "id": 3,
        "text": "A 55 year old man with asbestosis"
      },
      {
        "id": 4,
        "text": "A 35 year old woman with sarcoidosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A 35-year-old woman with sarcoidosis is the most likely to have fibrosis of the upper lobes of the lung.</p>\n<p>Note: Most pneumoconiosis involves the <strong>upper lobes</strong> of the lung (coal worker's pneumoconiosis (CWP), silicosis, berylliosis),<strong> except asbestosis.</strong></p>\n<p>Most connective tissue disease predominantly involves the <strong>lower lobes</strong> of the lung (RA, scleroderma, SLE), <strong>except for ankylosing spondylitis. The use</strong>&nbsp;of bleomycin also causes lower lobe fibrosis.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding non-specific interstitial pneumonia?",
    "choices": [
      {
        "id": 1,
        "text": "HRCT shows ground-glass opacities"
      },
      {
        "id": 2,
        "text": "Associated with connective tissue diseases"
      },
      {
        "id": 3,
        "text": "Does not respond to steroids"
      },
      {
        "id": 4,
        "text": "Usually affects females who have never smoked"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Non-specific interstitial pneumonia (NSIP)&nbsp;<strong>responds to steroids</strong>. Other treatment modalities include cytotoxic drugs like azathioprine or cyclophosphamide and also biologics like rituximab.</p>\n<p>It is often associated with connective tissue disease but can also be drug-induced.&nbsp;The common <strong>drugs</strong>&nbsp;implicated in NSIP are:</p>\n<ul>\n<li>Bleomycin</li>\n<li>Busulfan</li>\n<li>Cyclophosphamide</li>\n<li>Methotrexate</li>\n<li>Amiodarone</li>\n</ul>\n<p>It usually affects <strong>middle-aged females </strong>who have<strong> never smoked</strong>.&nbsp;HRCT shows homogenous involvement with symmetrical ground-glass opacities.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 81-year-old woman presented with gradually increasing shortness of breath over the past 6 months. Examination reveals finger clubbing and bibasilar fine inspiratory crackles. Pulmonary function test showed a restrictive defect with reduced lung volumes. HRCT is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute interstitial pneumonia"
      },
      {
        "id": 2,
        "text": "Respiratory bronchiolitis associated interstitial lung disease"
      },
      {
        "id": 3,
        "text": "Idiopathic pulmonary fibrosis"
      },
      {
        "id": 4,
        "text": "Desquamative interstitial pneumonia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In a patient with <strong>chronic shortness of breath</strong>, finger <strong>clubbing</strong>, and fine <strong>inspiratory</strong> <strong>crackles</strong>, spirometry showing a <strong>restrictive defect</strong> and <strong>reduced lung volumes</strong> points to a diagnosis of<strong> interstitial lung disease</strong>. In the given HRCT, there is prominent <strong>honeycombing</strong> <strong>in</strong> the <strong>lower</strong> and <strong>posterior</strong> <strong>lung zones</strong>. This is seen in <strong>idiopathic pulmonary fibrosis (IPF).</strong></p>\n<p><strong>Interstitial lung diseases</strong> are characterized by <strong>inflammation</strong> and <strong>fibrosis</strong> involving the <strong>lung parenchyma</strong>. Although there are multiple diseases under this subset, the clinical presentation for all of them is the same. The <strong>patients</strong> are usually <strong>over 60 years of age</strong> and present with <strong>progressive exertional dyspnea</strong> and <strong>dry cough</strong>. On examination, <strong>fine</strong> <strong>inspiratory, velcro crackles</strong> may be heard. <strong>Digital</strong> <strong>clubbing</strong> and <strong>cyanosis</strong> are signs of advanced disease.</p>\n<p><strong>Pulmonary function tests (PFT)</strong> will show a <strong>restrictive deficit</strong> and <strong>reduction of TLC, FEV1, </strong>and<strong> FVC</strong>. There is also a <strong>reduction</strong> in <strong>DL<sub>CO</sub></strong> and may be the <strong>first finding</strong> seen<strong> in PFT</strong>. Other laboratory tests should be undertaken if the patient has symptoms involving other systems, to rule out any connective tissue disorder which might have led to ILD.</p>\n<p><strong>IPF </strong>is the <strong>most common interstitial lung disease</strong> occurring due to an <strong>unknown cause</strong>. <strong>HRCT</strong> shows <strong>predominant</strong> <strong>subpleural</strong> and <strong>basal</strong> <strong>involvement</strong>, in the form of <strong>reticulation</strong>, <strong>honeycombing,</strong> and <strong>traction</strong> <strong>bronchiectasis</strong>. This is known as the <strong>usual interstitial pneumonia (UIP)</strong> <strong>pattern</strong>. Note that <strong>ground glass opacities</strong> are <strong>absent</strong> in this pattern.&nbsp;</p>\n<p>The <strong>treatment</strong> of IPF is with <strong>antifibrotic therapy</strong> such as <strong>pirfenidone</strong> and <strong>nintedanib</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Acute interstitial pneumonia</strong> is characterized by a <strong>sudden onset</strong> of <strong>hypoxemia</strong> and respiratory distress, following symptoms of an <strong>upper respiratory tract infection. </strong>HRCT shows patchy bilateral <strong>ground-glass opacities </strong>and<strong> consolidation </strong>of the air spaces.</p>\n<p>Options B and D: <strong>Respiratory bronchiolitis associated with ILD (RB-ILD)</strong> and <strong>desquamative interstitial pneumonia (DIP)</strong> are more commonly seen in <strong>smokers.</strong> HRCT shows prominent <strong>ground-glass opacities </strong>in both these disorders.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6e5393d94b9d47ed8737e37191e24cc5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old male patient came with complaints of difficulty in breathing,  cough, fatigue, and malaise for a few months.  His sputum was chunky, gelatinous, and PAS-positive. A histological specimen of the lung is given below.  The above condition is caused by autoantibodies against the function of _______.",
    "choices": [
      {
        "id": 1,
        "text": "Lecithin"
      },
      {
        "id": 2,
        "text": "Protein A"
      },
      {
        "id": 3,
        "text": "Protein B"
      },
      {
        "id": 4,
        "text": "GM-CSF"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical presentation of dyspnea, cough with chunky, <strong>gelatinous</strong>,<strong> PAS-positive sputum</strong>, and&nbsp;histological specimen of lung showing alveoli filled with pink, dense, homogeneous, amorphous material with the intact alveolar wall are suggestive of <strong>pulmonary alveolar proteinosis&nbsp;</strong>(PAP)which is caused by autoantibodies against the function of <strong>granulocyte- macrophage-colony stimulating factor</strong> (GM-CSF).</p>\n<p>PAP is an interstitial lung disease caused by <strong>defect</strong>&nbsp;in the function of <strong>pulmonary macrophages</strong>. This is due to reduced signaling of GM-CSF which results in the&nbsp;<strong>accumulation of surfactants</strong> in the intra-alveolar and bronchiolar spaces.&nbsp;Surfactant proteins can be demonstrated by immunohistochemical stains.&nbsp;It is predominantly seen in <strong>adults</strong>. They&nbsp;present with progressive dyspnoea, cough with sputum containing gelatinous, chunky PAS-positive material. It can be associated with <strong>clubbing</strong> and<strong> cyanosis</strong>.&nbsp;On radiological examination, <strong>asymmetric patchy opacifications</strong> mainly on the hilar regions of both lungs are seen. GM-CSF replacement therapy and whole-lung lavage are effective treatments.&nbsp;</p>\n<p>PAP is classified into 3 types:</p>\n<p><strong>Autoimmune PAP </strong>is&nbsp;due to the presence of circulating antibodies that bind and neutralize the function of GM-CSF. It primarily occurs in adults and this represents 90% of all cases. Autoimmune PAP lacks familial predisposition.&nbsp;</p>\n<p><strong>Secondary PAP&nbsp;</strong>is due to the diverse diseases that impair the GM-CSF signaled macrophage function, leading to inadequate clearance of surfactant from alveolar spaces.</p>\n<p><strong>Hereditary PAP&nbsp;</strong>is due to GM-CSF and GM-CSF receptor gene mutations. This occurs in neonates and is extremely rare.</p>\n<p>Other options:</p>\n<p>Option A<strong>. Lecithin</strong> (dipalmitoylphosphatidylcholine), Option B.&nbsp;<strong>protein A</strong>, Option C&nbsp;<strong>protein B</strong> are surfactants. The deficiency of these surfactants causes respiratory distress syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a56398752ac54a4c9d7e8c9f88995456.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man presents with a two-week history of progressive dyspnea, dry cough, and fever. Physical examination shows diffuse crackles in both lungs. Laboratory tests reveal leukocytosis and elevated CRP. Chest X-ray shows diffuse bilateral alveolar infiltrates and HRCT shows patchy ground glass opacities. There is no significant medical history or known exposures. What is the most likely diagnosis:",
    "choices": [
      {
        "id": 1,
        "text": "Idiopathic pulmonary fibrosis"
      },
      {
        "id": 2,
        "text": "Hamman-rich syndrome"
      },
      {
        "id": 3,
        "text": "Hypersensitivity pneumonitis"
      },
      {
        "id": 4,
        "text": "Pneumocystis jeroveci pneumonia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hamman-rich syndrome</strong> or <strong>acute interstitial pneumonia</strong> is the most likely diagnosis in this patient who has presented acutely with <strong>rapid onset of severe respiratory symptoms </strong>and HRCT findings of <strong>patchy ground glass opacities.</strong>\u00a0</p>\n<p>Hamman-rich syndrome is a <strong>rare</strong> and frequently <strong>fatal</strong> lung disorder marked by the sudden onset of <strong>respiratory distress </strong>and <strong>hypoxemia.</strong> It often follows a prodromal period with symptoms similar to an acute upper respiratory infection. The mortality rate within six months of diagnosis is significant, exceeding 50%, and recurrences are common. Treatment is mostly <strong>supportive</strong> and includes mechanical ventilation.</p>\n<p>Other options:</p>\n<p>Option A:<strong>\u00a0Idiopathic pulmonary fibrosis</strong>: It presents <strong>chronically</strong> over months to years and shows a UIP pattern with <strong>honeycombing</strong> on HRCT</p>\n<p>Option C: <strong>Hypersensitivity pneumonitis</strong>: It is associated with <strong>known exposures</strong> to organic antigens and often shows <strong>centrilobular nodules</strong> and upper lobe predominance on imaging</p>\n<p>Option D: <strong>Pneumocystis jeroveci pneumonia</strong> occurs in <strong>immunocompromised</strong> patients. Imaging might show ground-glass opacities but also often includes cysts or pneumothorax</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male complains of shortness of breath on exertion, associated with dry cough for the past 2 months. Examination reveals grade 3 clubbing and basal rales on auscultation. HRCT of the chest shows bilateral subpleural reticular changes, traction bronchiectasis, and honeycombing of the lung parenchyma. Which of the following flow-volume loops is expected to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The\u00a0clinical scenario is suggestive of an interstitial lung disease probably idiopathic pulmonary fibrosis (IPF). The flow-volume loop, in this case, would be similar to that of\u00a0<strong>image 4</strong> which corresponds to<strong> a restrictive pattern of the flow-volume loop.</strong></p>\n<p>Idiopathic pulmonary fibrosis is usually seen in the fifth or sixth decade of life.\u00a0Males are affected more than females.\u00a0Clinical features include <strong>progressive dyspnoea</strong> more common with exertion, dry cough, and\u00a0<strong>end-inspiratory crackles or rales</strong>\u00a0on auscultation.\u00a0Digital clubbing is seen.\u00a0The HRCT findings include bilateral subpleural reticular changes, traction bronchiectasis, and honeycombing of the lung parenchyma.</p>\n<p>The following image shows flow-volume loops in different pathological conditions-</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3b4d47d868644f44b989d46b9f41b891.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da897bbb937f4ab9bdde008e5100505cx1280x1769.JPEG"
    ]
  },
  {
    "text": "A patient is diagnosed with idiopathic pulmonary fibrosis. Which of the following pharmacologic agents are indicated for treatment?",
    "choices": [
      {
        "id": 1,
        "text": "1, 4"
      },
      {
        "id": 2,
        "text": "2, 3, 4"
      },
      {
        "id": 3,
        "text": "2, 5"
      },
      {
        "id": 4,
        "text": "1, 3, 5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Pharmacologic treatments that are <strong>currently</strong> <strong>indicated</strong> for <strong>idiopathic</strong> <strong>pulmonary</strong> <strong>fibrosis</strong>(IPF) include <strong>pirfenidone</strong> and <strong>nintedanib</strong>, which are <strong>antifibrotic</strong> <strong>agents</strong>.</p>\n<p><strong>Pirfenidone</strong> is approved by the FDA for the treatment of IPF. Pirfenidone works by <strong>inhibiting</strong> the production of <strong>transforming growth factor-beta </strong>(<strong>TGF</strong>-<strong>\u03b2</strong>), a key mediator of fibrosis. It has been shown to <strong>slow</strong> the <strong>decline</strong> <strong>in lung</strong> <strong>function</strong> and improve survival in patients with IPF.</p>\n<p><strong>Nintedanib</strong> is a <strong>tyrosine</strong> <strong>kinase</strong> <strong>inhibitor</strong> also proven to be beneficial in IPF.</p>\n<p><strong>Pulmonary function tests</strong> (PFT) will show a <strong>restrictive</strong> <strong>deficit</strong> and reduction of TLC, FEV1, and FVC. There is also a <strong>reduction</strong> <strong>in</strong> <strong>DLCO</strong> which may be the <strong>first</strong> <strong>finding</strong> seen in PFT. Other laboratory tests should be undertaken if the patient has symptoms involving other systems, to rule out any connective tissue disorder which might have led to ILD.</p>\n<p><strong>IPF</strong> is the <strong>most common</strong> interstitial lung disease occurring due to an unknown cause. <strong>HRCT</strong> shows predominant <strong>subpleural</strong> and <strong>basal</strong> <strong>involvement</strong>, in the form of <strong>reticulation</strong>, <strong>honeycombing</strong>, and <strong>traction</strong> <strong>bronchiectasis</strong>. This is known as the <strong>usual</strong> <strong>interstitial</strong> <strong>pneumonia</strong> pattern . <strong>Ground glass opacities</strong> are <strong>absent</strong> in this pattern.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Statements 1, 3, 4: <strong>Steroids</strong> and <strong>immunosuppressants</strong> are <strong>no longer indicated</strong> in the treatment of <strong>idiopathic</strong> <strong>pulmonary</strong> <strong>fibrosis</strong>, and have been associated with <strong>poorer</strong> <strong>outcomes</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pulmonary fibrosis is caused by all of the following except?",
    "choices": [
      {
        "id": 1,
        "text": "Clindamycin"
      },
      {
        "id": 2,
        "text": "Nitrofurantoin"
      },
      {
        "id": 3,
        "text": "Methysergide"
      },
      {
        "id": 4,
        "text": "Amiodarone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Drugs causing Pulmonary fibrosis include:</p>\n<ul>\n<li>Nitrofurantoin</li>\n<li>Methysergide</li>\n<li>Amiodarone</li>\n<li>Interferon</li>\n<li>Bleomycin</li>\n<li>Busulfan</li>\n<li>Mitomycin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman presents with a 3-week history of dry cough, dyspnea and chest x-ray showing the characteristic garland triad. Her pulmonary function test will most likely resemble which of the following curves?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><span style=\"color: #000000; font-family: arial, helvetica, sans-serif;\">In the above clinical scenario, the patient's symptoms of <strong>dry cough</strong> and <strong>dyspnea</strong> along with the chest x-ray showing the <strong>garland triad </strong>are characteristic of <strong>Sarcoidosis </strong>which shows a <strong><span style=\"font-family: arial, helvetica, sans-serif;\">restrictive pattern </span></strong><span style=\"font-family: arial, helvetica, sans-serif;\">on the flow-volume curve, </span>represented by <strong>curve 4. \u00a0\u00a0</strong></span></p>\n<div class=\"page\" title=\"Page 2178\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><span style=\"font-family: arial, helvetica, sans-serif;\"><span style=\"color: #000000;\"><strong>Sarcoidosis </strong></span>presents with\u00a0<strong>ventilatory restriction </strong>due to<strong> increased elastic recoil.</strong> It is characterized by a\u00a0<strong>decrease </strong>in total lung capacity and vital capacity, hence, the loop shrinks or narrows and shifts <strong>toward the right</strong> as seen in curve 4 in comparison to curve<strong>\u00a01</strong>\u00a0which represents the\u00a0<strong>normal</strong>\u00a0<strong>flow-volume curve.</strong></span></p>\n<p><span style=\"font-family: arial, helvetica, sans-serif;\">Increased flow occurs as the increased lung recoil drives greater maximal flow at any lung volume and also because airway diameters are relatively increased due to greater radially outward traction exerted on bronchi by the stiff lung parenchyma.\u00a0\u00a0</span></p>\n</div>\n</div>\n</div>\n</div>\n<p><span style=\"color: #000000; font-family: arial, helvetica, sans-serif;\">In restrictive diseases, both\u00a0<strong>FEV1</strong>\u00a0(Forced expiratory volume in the first second) and\u00a0<strong>FVC</strong>\u00a0(forced vital capacity) are\u00a0<strong>reduced</strong>\u00a0but FEV1/FVC ratio is <strong>normal</strong> or <strong>increased</strong> as FVC is reduced to a greater degree due to <strong>decreased</strong> compliance.</span></p>\n<p><span style=\"color: #000000; font-family: arial, helvetica, sans-serif;\">An\u00a0<strong>FEV1/FVC ratio &gt; 0.7</strong>\u00a0signifies\u00a0<strong>restrictive</strong>\u00a0lung disorder, whereas\u00a0<strong>&lt;0.7</strong>\u00a0is seen in\u00a0<strong>obstructive</strong>\u00a0diseases.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b72befd1ef744ffd8af13975c7874641.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/572db3805ebd4ba9b920c60a83856d51x1280x1455.JPEG",
      "https://cdn1.dailyrounds.org/uploads/7c08f3e499554daa82a94abbaa834206.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man, who was a welder for the past 10 years presents with a dry cough, easy fatiguability, weight loss, and dyspnea progressing over the past 1 year. On examination, fine end-inspiratory crackles were heard over the bilateral infra-axillary regions. His HRCT finding is shown below. What is the probable diagnosis in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Primary pulmonary hypertension"
      },
      {
        "id": 2,
        "text": "Pulmonary alveolar proteinosis"
      },
      {
        "id": 3,
        "text": "Asbestosis with metastatic malignant mesothelioma"
      },
      {
        "id": 4,
        "text": "Miliary tuberculosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The HRCT provided shows a characteristic <strong>crazy-paving</strong>&nbsp;pattern which is classical of <strong>pulmonary alveolar proteinosis</strong>.&nbsp;</p>\n<p>Pulmonary alveolar proteinosis is a lung disease involving the accumulation of surfactant within the alveoli as a result of decreased clearance. It may be congenital, secondary, or autoimmune.</p>\n<p>Etiology:</p>\n<ul>\n<li>Congenital</li>\n<li>Secondary: due to lung infections, hematologic malignancies, and inhalation of mineral dust such as silica, titanium oxide, aluminum, indium-tin-oxide, and insecticides.</li>\n<li>Autoimmune: autoantibodies against GM-CSF</li>\n</ul>\n<p>Patients may have features like a persistent dry cough (or with scant sputum production), progressive dyspnea, fatigue, weight loss, intermittent low-grade fever and/or night sweats, and pleuritic chest pain. Rarely, they may have cyanosis and hemoptysis. The physical examination will show fine <strong>end-inspiratory</strong> crackles. Clubbing&nbsp;and cyanosis may be present in a few cases.</p>\n<div class=\"page\" title=\"Page 261\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is with bronchoscopic lavage and/or biopsy, along with imaging findings. Chest X-ray shows nonspecific findings with bilateral lung opacification. A batwing appearance may be seen.</p>\n<p>The <strong>CT</strong> shows a characteristic &lsquo;<strong>crazy-paving&rsquo; pattern.</strong>&nbsp;It refers to geographical areas of ground-glass opacification with thickened inter-and intralobular septa.</p>\n<p>Treatment includes whole lung lavage and treatment of the underlying cause. GM-CSF replacement is considered if an underlying autoimmune etiology is suspected.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Other causes causing similar crazy-paving appearance:</p>\n<ul>\n<li>Lipoid pneumonia</li>\n<li>Pneumocystis jirovecii pneumonia</li>\n<li>Sarcoidosis</li>\n<li>Nonspecific interstitial pneumonia</li>\n<li>Silicosis,</li>\n<li>Cryptogenic organizing pneumonia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/909b9a00b6164f02888107d5dbcb3acd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year old chronic smoker presented with a history of dry cough, dyspnea, weight loss, and recurrent pneumothoraces over the past few months. An HRCT report showed multiple nodules and cysts. The lung biopsy appears as below. Which of the following is a characteristic electron microscopic finding for this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Rosenthal fibres"
      },
      {
        "id": 2,
        "text": "Fried egg appearance"
      },
      {
        "id": 3,
        "text": "Birbeck granules"
      },
      {
        "id": 4,
        "text": "Corps rounds"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario along with the histopathological image showing Langerhan cells with folded nuclei is suggestive of <strong>adult pulmonary Langerhans cell histiocytosis</strong>. <strong>Birbeck granules</strong> are the <strong>characteristic</strong> election microscopy finding seen in this disease.</p>\n<p><strong>Langerhans cell histiocytosis</strong> occurs due to the proliferation of a special type of immature dendritic cells, called&nbsp;<strong>Langerhans cells.&nbsp;</strong>Their&nbsp;normal function is to present antigens. The most common mutation is <strong>BRAFV600E</strong> gain-of-function mutation.</p>\n<p>It is characterized by&nbsp;<strong>single or multiple osteolytic bone lesions&nbsp;</strong>and<strong>&nbsp;</strong>can also infiltrate nearly every organ, like the skin (of the scalp), lungs, liver, spleen, bone marrow, or the central nervous system.&nbsp;</p>\n<p class=\"p1\">LCH can present as the following clinical entities:</p>\n<ul>\n<li class=\"p1\">Multifocal multisystem Langerhans cell histiocytosis&nbsp;<strong>(Letterer-Siwe disease) </strong>- mostly seen in <strong>infants</strong></li>\n<li class=\"p1\">Unifocal and multifocal unisystem Langerhans cell histiocytosis&nbsp;<strong>(eosinophilic granuloma)-</strong>&nbsp;The combination of bone defects, diabetes insipidus, and exophthalmos is called the&nbsp;<strong>Hand-Sch&uuml;ller-Christian triad </strong>- mostly seen in <strong>older children</strong>, adults</li>\n<li class=\"p1\">Pulmonary Langerhans cell histiocytosis - mostly seen in <strong>adults</strong></li>\n</ul>\n<p id=\"__p14\" class=\"p p-first\"><strong>Clinical features</strong> include:</p>\n<ul>\n<li class=\"p p-first\">Often asymptomatic</li>\n<li class=\"p p-first\">Dyspnea, cough, bone pain, an abnormal growth of soft tissue over the affected bone, rash, pruritus, increased thirst, and lymphadenopathy.</li>\n<li class=\"p p-first\">Fatigue, generalized weakness, weight loss, night sweats, nausea, and fever may also occur.</li>\n</ul>\n<p>Histopathologically,&nbsp;Langerhans cells have a single large nucleus with a characteristic folded or grooved nucleus (<strong>coffee-bean</strong>&nbsp;appearance) with small inconspicuous nucleoli.&nbsp;<strong>Birbeck granules</strong>&nbsp;are seen in the cytoplasm.&nbsp;The tumor cells specifically express&nbsp;<strong>HLA-DR, S-100, and CD1a&nbsp;</strong>and&nbsp;<strong>langerin (CD207)&nbsp;</strong>markers.</p>\n<p>The image below shows a histopathological image of Langerhan cells with folded nuclei.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68256f4a51574b299d2675d5c4ec7fd1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e2de3624e2d488bb0ceed9e750a13d0x1280x864.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aaed24736ede47e39a739d32c36e475fx720x803.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ed459141ada43a8a337fdc7be36a0b3x720x828.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/55932f304d0742d383cd567be3bd7accx510x497.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b082b4d3a85f4c8788b6d58a3bc06203x510x525.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ffc9d16423c24d26b5cd6f1a1d4f1f30x510x517.GIF"
    ]
  },
  {
    "text": "A 42-year-old male patient working in the cement manufacturing industry presents with chronic cough and dyspnea. His chest radiograph is shown below. Which of the following is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Asbestosis"
      },
      {
        "id": 2,
        "text": "Silicosis"
      },
      {
        "id": 3,
        "text": "Byssinosis"
      },
      {
        "id": 4,
        "text": "Anthracosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a patient with <strong>chronic cough</strong> and <strong>dyspnea</strong> with the chest radiograph<strong> </strong>showing<strong> eggshell calcification of</strong> <strong>the hilar lymph nodes</strong>, a diagnosis of <strong>silicosis</strong> is the most likely.</p>\n<p><strong>Silicosis</strong> is the <strong>most common occupational lung disease</strong> in the world. Occupational exposures associated with silicosis include <strong>mining</strong>, <strong>stone cutting</strong>, <strong>sandblasting</strong>, <strong>glass</strong> and <strong>cement</strong> <strong>manufacturing</strong>, and quarrying of <strong>granite</strong>. The <strong>pathogenic form</strong> of silica is<strong> crystalline quartz</strong>.&nbsp;Inhaled silica crystals are phagocytosed by macrophages and cause the release of IL-1 and IL-18. This causes the <strong>recruitment</strong> <strong>of</strong> more inflammatory cells and <strong>fibroblasts</strong> to the site, leading to <strong>collagen deposition</strong>.</p>\n<p>Silicosis can present in the following ways:</p>\n<ul>\n<li><strong>Acute</strong> <strong>silicosis</strong> occurs due to <strong>exposure to high concentrations</strong> of silica in closed spaces<strong>.</strong> Patients have clinical manifestations <strong>within a few months to years</strong> of exposure.</li>\n<li><strong>Chronic</strong> <strong>silicosis</strong> occurs<strong>&nbsp;</strong>due to <strong>long-term exposure to silica</strong>, often 10 to 30 years</li>\n<li><strong>Progressive massive fibrosis</strong> can occur following both acute and chronic silicosis. The patients present with <strong>more severe cough</strong> and <strong>dyspnea</strong> than simple silicosis, and might develop <strong>respiratory failure </strong>and cor pulmonale.&nbsp;</li>\n</ul>\n<p>Since <strong>silicosis</strong> leads to macrophage dysfunction, it <strong>increases</strong> the <strong>risk of tuberculosis</strong> in patients. Silica also has immunoadjuvant properties, and might lead to <strong>autoimmune diseases</strong> such as rheumatoid arthritis. Silica exposure is also considered to be a <strong>risk factor for lung cancer</strong>.</p>\n<p><strong>Calcification of hilar lymph nodes</strong> producing a characteristic <strong>eggshell pattern</strong> is seen in many cases of silicosis. The <strong>fibrotic areas</strong> present in the lung parenchyma can be <strong>identified on </strong>the <strong>HRCT</strong> of the lung. <strong>Acute silicosis</strong> may show <strong>diffuse ground-glass opacities</strong> with thickening of the interlobular septae, which is termed as <strong>crazy pavement appearance</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/86cd1a55404d495fbd65d13b107eec05.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A sugarcane farmer presents with dyspnea and cough for the last 3 weeks. HRCT shows bilateral ground glass opacities. Bronchoalveolar lavage is done and the CD4+/CD8+ ratio is found to be < 1. Lung biopsy shows poorly formed noncaseating granulomas. Which of the following is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Sarcoidosis"
      },
      {
        "id": 2,
        "text": "Idiopathic pulmonary fibrosis"
      },
      {
        "id": 3,
        "text": "Hypersensitivity pneumonitis"
      },
      {
        "id": 4,
        "text": "Tuberculosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In a patient with <strong>cough </strong>and <strong>dyspnea </strong>for the last<strong> 3 weeks</strong>, with<strong> ground glass opacities on HRCT</strong>,<strong> CD4+/CD8+ ratio &lt; 1</strong>, and <strong>poorly formed granulomas </strong>on lung biopsy, the most likely diagnosis is <strong>hypersensitivity pneumonitis</strong>.&nbsp;</p>\n<p>Hypersensitivity pneumonitis (<strong>HP</strong>) occurs due to<strong> inhalational exposure</strong> <strong>to </strong>a number of <strong>antigens</strong>, causing <strong>inflammation of</strong> the <strong>alveoli and </strong>the small <strong>airways</strong>. The <strong>cause </strong>of the inflammation <strong>is dysregulated Th1</strong> and <strong>Th17 </strong>immune <strong>response </strong>(<strong>type IV hypersensitivity</strong>).&nbsp;</p>\n<p><strong>HP </strong>has been <strong>divided into 3 forms</strong> depending on the clinical manifestations:</p>\n<ol>\n<li><strong>Acute HP</strong> manifests <strong>within 8 hours of exposure</strong> to the antigen. The symptoms include <strong>fever </strong>with <strong>chills</strong>, <strong>malaise, </strong>and <strong>dyspnea</strong>. There is <strong>complete resolution of the symptoms</strong> within hours to days if there is no further exposure to the antigen.&nbsp;</li>\n<li>In <strong>subacute HP</strong>, the systemic and pulmonary <strong>symptoms develop insidiously</strong> <strong>over </strong>a <strong>few weeks</strong>, like in this patient. <strong>Complete resolution of symptoms</strong> is seen here as well, but it takes a longer time.&nbsp;</li>\n<li><strong>Chronic</strong> <strong>HP </strong>presents with an<strong> even slower course</strong> &mdash; with cough, dyspnea,<strong> weight loss</strong>, and <strong>clubbing of digits</strong>. Unlike other forms, there is <strong>permanent impairment of the airways</strong> to some extent in chronic HP. This is <strong>irreversible </strong>and <strong>does not respond to the removal of inciting agents</strong> from the patient's environment.&nbsp;</li>\n</ol>\n<p>In<strong> subacute HP</strong>, <strong>HRCT </strong>shows <strong>ground glass opacities</strong> and centrilobular nodules. In <strong>chronic HP</strong>, subpleural <strong>honeycombing </strong>is seen, but unlike idiopathic pulmonary fibrosis, there is <strong>sparing of the base of the lungs</strong>. Either obstructive or restrictive patterns may be seen on pulmonary function testing. Detection of IgG antibodies against specific antigens is an adjunctive investigation in the diagnosis of HP.</p>\n<p>Bronchoscopy with<strong> bronchoalveolar lavage</strong> shows a<strong> CD4+/CD8+ lymphocyte ratio &lt; 1</strong> in most cases of HP. <strong>Lung biopsy</strong> shows the formation of <strong>noncaseating granulomas</strong>, but they are<strong> poorly defined</strong>.</p>\n<p>The mainstay of <strong>treatment </strong>of HP is<strong> avoidance of the offending antigen</strong>. However, in subacute and chronic forms of the disease, there is a <strong>role of steroids</strong> as well.&nbsp;</p>\n<p>Other options:</p>\n<p>Option A: A close differential in this case can be <strong>sarcoidosis</strong>. However, sarcoidosis is characterized by <strong>well-defined noncaseating granulomas</strong>, and<strong> CD4+/CD8+ ratio of &gt;1</strong> in BAL. Furthermore, the presence of a clear-cut risk factor in this patient makes the diagnosis more likely to be HP.</p>\n<p>Option B:<strong> Idiopathic pulmonary fibrosis</strong> will <strong>not</strong> show<strong> granulomatous inflammation</strong> on lung biopsy. Furthermore, the HRCT findings in <strong>IPF </strong>include <strong>honeycombing </strong>and traction bronchiectasis. The presence of ground glass opacities is only transient, and extensive ground glass opacities should prompt an alternative diagnosis.</p>\n<p>Option D: <strong>Tuberculosis </strong>will present as <strong>upper lobe infiltrates</strong> with <strong>cavitation </strong>on CT scan. The sputum smear microscopy will be positive for acid-fast bacilli and nucleic acid amplification test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman diagnosed with limited cutaneous systemic sclerosis (scleroderma) 14 years back presents with breathlessness for a few months. Her PFT is as follows. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary artery hypertension"
      },
      {
        "id": 2,
        "text": "Interstitial lung disease"
      },
      {
        "id": 3,
        "text": "Congestive heart failure"
      },
      {
        "id": 4,
        "text": "Bronchiectasis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient's history of <strong>limited cutaneous systemic sclerosis</strong> and the <strong>PFT </strong>showing an <strong>isolated decrease in DLCO </strong>suggest a diagnosis of <strong>pulmonary artery hypertension (PAH)</strong>.</p>\n<p>A<strong> PFT pattern </strong>showing <strong>near-normal FVC</strong>, <strong>increased FEV1,</strong> and <strong>decreased DLCO</strong> which is consistent with <strong>diffusion lung disease</strong>. The cause of diffusion lung disease can be due to both pulmonary hypertension and interstitial lung disease (ILD). But in this patient with limited cutaneous systemic sclerosis, pulmonary artery hypertension is the most likely etiologic factor.</p>\n<p><strong>Limited cutaneous systemic sclerosis</strong> is more strongly associated with the development of <strong>PAH </strong>than diffuse systemic sclerosis. However,<strong> diffuse cutaneous systemic sclerosis</strong> is associated more commonly with<strong> interstitial lung disease.</strong> In patients with <strong>ILD</strong>, <strong>FVC </strong>is usually<strong> &lt;80% of the predicted </strong>value indicating<strong> restrictive pathology.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b26d1b6c477d4652b22392a2d1290ec8.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with Idiopathic Pulmonary Fibrosis (IPF) presents for follow-up. He has a history of progressive dyspnea and dry cough for the past year. His FVC has declined by 10% from the previous year. You propose treatment with Pirfenidone. Which of the following statements regarding Pirfenidone is true?",
    "choices": [
      {
        "id": 1,
        "text": "It is a bronchodilator that helps open up the airways."
      },
      {
        "id": 2,
        "text": "It is a corticosteroid that reduces inflammation in the airways."
      },
      {
        "id": 3,
        "text": "It is an antifibrotic agent that slows down the progression of scarring."
      },
      {
        "id": 4,
        "text": "It is an antibiotic that treats bacterial infections in the airway."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Pirfenidone</strong> is approved by the FDA for the treatment of IPF. Pirfenidone works by <strong>inhibiting</strong> the production of transforming growth factor-beta (<strong>TGF-\u03b2)</strong>, a key mediator of <strong>fibrosis</strong>. It has been shown to slow the decline in <strong>lung function</strong> and <strong>improve survival </strong>in patients with IPF.</p>\n<p>IPF is characterized by inflammation and fibrosis involving the lung parenchyma. Although there are multiple diseases under this subset, the clinical presentation for all of them is the same. The patients are usually over <strong>60 years</strong> of age and present with <strong>progressive exertional dyspnea </strong>and <strong>dry cough</strong>. On examination, <strong>fine inspiratory, velcro crackles</strong> may be heard. <strong>Digital clubbing and cyanosis</strong> are signs of advanced disease.</p>\n<p>Pulmonary function tests (PFT) will show a <strong>restrictive deficit</strong> and <strong>reduction of TLC, FEV1, and FVC</strong>. There is also a <strong>reduction in DLCO</strong> and may be the first finding seen in PFT. Other laboratory tests should be undertaken if the patient has symptoms involving other systems, to rule out any connective tissue disorder which might have led to ILD.</p>\n<p>IPF is the most common interstitial lung disease occurring due to an unknown cause. <strong>HRCT </strong>shows <strong>predominant subpleural and basal </strong>involvement, in the form of <strong>reticulation, honeycombing, and traction bronchiectasis</strong>. This is known as the usual interstitial pneumonia pattern. Note that <strong>ground glass opacities</strong> are absent in this pattern.\u00a0</p>\n<p>The treatment of IPF is with antifibrotic therapy such as <strong>pirfenidone </strong>and<strong> nintedanib</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Interstitial Lung Diseases Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>