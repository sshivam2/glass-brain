<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27 Hernia - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">32</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a false statement regarding the inguinal canal?",
    "choices": [
      {
        "id": 1,
        "text": "Conjoint tendon forms a part of the posterior wall"
      },
      {
        "id": 2,
        "text": "Superficial ring is an opening in the external oblique aponeurosis"
      },
      {
        "id": 3,
        "text": "Deep ring is an opening in the transverse abdominis"
      },
      {
        "id": 4,
        "text": "Internal oblique forms both the anterior and superior walls"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>deep inguinal ring </strong>is an opening in the<strong>&nbsp;fascia transversalis,</strong> not in the transversus abdominis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are contents of inguinal canal except _______.",
    "choices": [
      {
        "id": 1,
        "text": "1,2,4 and 5"
      },
      {
        "id": 2,
        "text": "2,3 and 5"
      },
      {
        "id": 3,
        "text": "2 and 3"
      },
      {
        "id": 4,
        "text": "Only 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>femoral</strong> branch of the <strong>genitofemoral</strong> nerve is not a content of the inguinal canal.</p>\n<p>The contents of the<strong> inguinal canal&nbsp;</strong>include:</p>\n<ul>\n<li><strong>Spermatic cord</strong> in males</li>\n<li><strong>Round ligament</strong> in females</li>\n<li><strong>Ilioinguinal</strong> nerve in both the sexes.</li>\n</ul>\n<p>The contents of the<strong> spermatic cord</strong> include:</p>\n<div class=\"page\" title=\"Page 1119\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Cremaster muscle fibers</li>\n<li>Testicular artery and accompanying veins</li>\n<li><strong>Genital</strong> branch of the <strong>genitofemoral</strong> nerve</li>\n<li>Vas deferens</li>\n<li><strong>Cremasteric vessels</strong></li>\n<li>Lymphatics</li>\n<li>Processus vaginalis</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following structures does not form the boundary of Hesselbach\u2019s triangle?",
    "choices": [
      {
        "id": 1,
        "text": "Inferior epigastric artery"
      },
      {
        "id": 2,
        "text": "Vas deferens"
      },
      {
        "id": 3,
        "text": "Rectus abdominis"
      },
      {
        "id": 4,
        "text": "Inguinal ligament"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Vas deferens <strong>does not</strong> form the boundary of Hesselbach&rsquo;s triangle.</p>\n<p>Hesselbach's triangle (also called the inguinal triangle) is a region of the deep part of the&nbsp;<strong>anterior abdominal wall.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A resident while assisting a case of laparoscopic hernia repair observes the surgeon dissect certain anatomical landmarks to expose the triangle of doom. Which of the following does not form a boundary of this triangle?",
    "choices": [
      {
        "id": 1,
        "text": "Gonadal vessels"
      },
      {
        "id": 2,
        "text": "Vas deferens"
      },
      {
        "id": 3,
        "text": "Cooper\u2019s ligament"
      },
      {
        "id": 4,
        "text": "Peritoneal reflection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Cooper&rsquo;s ligament</strong> does not form the boundary of the triangle of doom.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true regarding inguinal hernia?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "1 and 4"
      },
      {
        "id": 3,
        "text": "2 and 3"
      },
      {
        "id": 4,
        "text": "2 and 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The medial border of the triangle of doom is bounded by <strong>vas deferens&nbsp;</strong>and the medial border of the myopectineal orifice is bounded by<strong>&nbsp;</strong>the<strong>&nbsp;</strong>lateral border of<strong>&nbsp;rectus abdominis.</strong></p>\n<p>The<strong> triangle of doom</strong>&nbsp;is bounded:</p>\n<ul>\n<li>Medially by the vas deferens</li>\n<li>Laterally by the vessels of the spermatic cord (gonadal vessels)</li>\n<li>Inferiorly by peritoneal reflection</li>\n</ul>\n<p>The<strong> myopectineal orifice</strong> is an osseo-myo-aponeurotic tunnel. It is through this tunnel that all groin hernias occur. It is bounded:</p>\n<ul>\n<li class=\"p1\">Medially by the lateral border of the rectus sheath.</li>\n<li class=\"p1\">Above by the arched fibers of the internal oblique and transversus abdominis muscle.</li>\n<li class=\"p1\">Laterally by the iliopsoas muscle.</li>\n<li class=\"p1\">Below by the pectin pubis and fascia covering it.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b302a7d7085e417fa1e2602bffc736a4x1280x1481.JPEG"
    ]
  },
  {
    "text": "What is the most common type of hernia in females?",
    "choices": [
      {
        "id": 1,
        "text": "Femoral hernia"
      },
      {
        "id": 2,
        "text": "Direct inguinal hernia"
      },
      {
        "id": 3,
        "text": "Indirect inguinal hernia"
      },
      {
        "id": 4,
        "text": "Umbilical hernia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\"><strong>Indirect inguinal hernias</strong> are by far the most <span class=\"s1\">common type of hernia in <strong>women</strong>. It is the most common hernia regardless of gender.\u00a0</span></p>\n<p class=\"p1\">In <strong>men</strong>, <strong>indirect</strong> hernias predominate over direct hernias at a ratio of 2:1.\u00a0<strong>Femoral</strong> hernia and <strong>umbilical</strong> hernias are more common in <strong>females</strong> compared to males at ratios of 10:1 and 2:1, respectively. Although femoral hernias occur more frequently in women than in men, inguinal hernia remains the most common hernia in women.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman presents with a history of swelling in the right groin for the past 6 months. On examination, an irreducible hernia is present in the right groin. Which of the following structures would be helpful in identifying if the hernia is inguinal or femoral in origin?",
    "choices": [
      {
        "id": 1,
        "text": "Pubic symphysis"
      },
      {
        "id": 2,
        "text": "Pubic tubercle"
      },
      {
        "id": 3,
        "text": "Femoral artery"
      },
      {
        "id": 4,
        "text": "Inferior epigastric artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Pubic tubercle</strong> is used to differentiate between inguinal and femoral hernias.</p>\n<p><strong>Inguinal hernia</strong> is <strong>above </strong>and <strong>medial</strong>&nbsp;to the pubic tubercle.</p>\n<p><strong>Femoral hernia</strong> is <strong>below </strong>and <strong>lateral</strong> to the pubic tubercle.</p>\n<p>Another structure that is useful in differentiating between inguinal and femoral hernia is inguinal ligament. An <strong>inguinal </strong>hernia leaves the abdominal cavity just <strong>above</strong> the inguinal ligament and a <strong>femora</strong>l hernia leaves just <strong>below</strong> the inguinal ligament.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly male patient is diagnosed with direct inguinal hernia. Which of the following statements is true?",
    "choices": [
      {
        "id": 1,
        "text": "The sac lies medial to the inferior epigastric artery"
      },
      {
        "id": 2,
        "text": "Cough impulse is felt on the index finger"
      },
      {
        "id": 3,
        "text": "Can descend till the bottom of scrotum"
      },
      {
        "id": 4,
        "text": "The neck is narrow and is prone for strangulation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The sac and contents of a direct hernia protrude through <strong>Hesselbach&rsquo;s triangle</strong>, i.e., <strong>medial</strong> to the inferior epigastric artery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Bubonocele is a type of _________.",
    "choices": [
      {
        "id": 1,
        "text": "Indirect inguinal hernia"
      },
      {
        "id": 2,
        "text": "Direct inguinal hernia"
      },
      {
        "id": 3,
        "text": "Femoral hernia"
      },
      {
        "id": 4,
        "text": "Umbilical hernia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Bubonocele is a type of<strong> indirect inguinal hernia</strong> where the hernia is limited to the inguinal canal.</p>\n<p><strong>Indirect inguinal hernia</strong> is more common on the <strong>right side</strong> because of the delay in atrophy of the processus vaginalis after the normal slower descent of the right testis to the scrotum during fetal development.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common serious complication expected to occur in patients with hernia?",
    "choices": [
      {
        "id": 1,
        "text": "Incarceration"
      },
      {
        "id": 2,
        "text": "Strangulation"
      },
      {
        "id": 3,
        "text": "Fistula formation"
      },
      {
        "id": 4,
        "text": "Obstruction"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Strangulation</strong> is the most common serious complication of a hernia.&nbsp;</p>\n<div class=\"page\" title=\"Page 1045\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>An <strong>incarcerated hernia</strong> is a part of the intestine or abdominal tissue that becomes trapped in the sac of a hernia.An incarcerated hernia can lead to a <strong>bowel obstruction or strangulation</strong>.&nbsp;<strong>Obstruction</strong> is characterized by colicky abdominal pain, vomiting, abdominal distension and obstipation. Features of obstruction along with <strong>vascular compromise</strong> is seen in <strong>strangluation.</strong>&nbsp;<span style=\"font-size: 14px;\">Strangulation occurs in&nbsp;</span><strong style=\"font-size: 14px;\">1% to 3% </strong><span style=\"font-size: 14px;\">of groin hernias. It is more common at the </span><strong style=\"font-size: 14px;\">extremes of life.</strong></p>\n</div>\n</div>\n</div>\n</div>\n<p>Most strangulated hernias are <strong>indirect inguinal hernias. </strong>However,&nbsp;<strong>femoral hernias</strong> have the <strong>highest rate of strangulation </strong>(15% to 20%) of all hernias,&nbsp;and it is, therefore, recommended that all femoral hernias be repaired at the time of discovery.&nbsp;<strong>Tenderness </strong>is the first sign of strangulation.</p>\n<p>The first step is the correction of hypovolemia. The treatment of choice is <strong>immediate surgery.&nbsp;</strong>The fundus is opened first during surgery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a hernia medial to the inferior epigastric artery. What is the most likely diagnosis and appropriate management for the same?",
    "choices": [
      {
        "id": 1,
        "text": "Direct hernia and Bassini repair"
      },
      {
        "id": 2,
        "text": "Direct hernia and Lichtenstein mesh repair"
      },
      {
        "id": 3,
        "text": "Indirect hernia and Bassini repair"
      },
      {
        "id": 4,
        "text": "Indirect hernia and Lichtenstein mesh repair"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other surgical methods used for the repair of an inguinal hernia are:</p>\n<ul>\n<li><strong>Bassini repair</strong> - It is done for the <strong>reconstruction</strong> of the <strong>inguinal floor</strong> in <strong>adults</strong>. In this method, a <strong>mesh is not</strong> used. It is associated with a <strong>high</strong>&nbsp;<strong>recurrence</strong>&nbsp;and is not used frequently now. It is used only in cases of hernial strangulation and peritonitis where the use of a mesh is not preferred. It is performed by <strong>suturing</strong> the transversus abdominis and internal oblique musculoaponeurotic arches/<strong>conjoined tendon</strong> to the<strong> inguinal ligament</strong>.&nbsp;</li>\n<li><strong>Shouldice repair</strong>&nbsp;- It is a&nbsp;<strong>multilayered repair,</strong>&nbsp;where the posterior wall of the inguinal canal is strengthened by <strong>continuous sutures.</strong>&nbsp;It involves <strong>double-breasting</strong> of the<strong> transversalis fascia</strong>. It is associated with a&nbsp;<strong>very low recurrence rate.</strong></li>\n<li><strong>Gilbert repair</strong> (plug and patch repair) - It&nbsp;is an <strong>extension</strong> of <strong>Lichtenstein&rsquo;s original mesh repair</strong> and has now become the <strong>most commonly</strong> performed <strong>primary anterior inguinal hernia repair</strong>. In this technique, a <strong>cone-shaped plug</strong> of<strong> polypropylene mesh</strong> is used. It is deployed like an upside-down umbrella when inserted into the internal inguinal ring to occlude the hernia</li>\n<li><strong>McVay repair </strong>(Cooper's ligament repair)<strong>&nbsp;</strong>is used for the correction of direct inguinal hernia, large indirect hernia,<strong> recurrent hernia</strong>, femoral hernias (particularly suited for <strong>strangulated femoral hernias</strong>). In this method, the&nbsp;transversus abdominis aponeurosis is approximated to Cooper's ligament.</li>\n<li><strong>Stoppa-Rives repair</strong>&nbsp;- It is used for the repair of large, recurrent, or bilateral hernias. In this method, a sub-umbilical&nbsp;<strong>midline incision </strong>is given to place a<strong> large mesh</strong> into the <strong>preperitoneal space.</strong></li>\n<li><strong>Herniotomy</strong> - It is used to treat <strong>inguinal hernia</strong> in a<strong> child </strong>which&nbsp;occurs due to the<strong> presence</strong> of a&nbsp;<strong>patent processus vaginalis</strong>. Therefore in herniotomy, the repair of the inguinal ring is not done.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0aeac8d0744e4138bc41f46999891d7cx1280x1584.JPEG"
    ]
  },
  {
    "text": "A 50-year-old obese male patient presented with bilateral, large inguinal hernias. He had been operated on for hernia twice in the past and is now posted for Stoppa's repair.  Which of the following statements regarding this procedure is false?",
    "choices": [
      {
        "id": 1,
        "text": "This procedure refers to open preperitoneal hernia repair"
      },
      {
        "id": 2,
        "text": "The mesh is placed in the retromuscular space"
      },
      {
        "id": 3,
        "text": "The mesh needs to be sutured to the posterior rectus sheath in case of small defects"
      },
      {
        "id": 4,
        "text": "This procedure is based on the principle of Pascal's law"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 1136\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>With smaller defects, the mesh <strong>does not need to be sutured</strong> in Stoppa's repair.</p>\n<p>This is based on <strong>Pascal's law.</strong> Pascal&rsquo;s law states that any additional <strong>pressure</strong> exerted on an enclosed fluid mass is <strong>transmitted equally</strong> in all directions.The abdomen is an enclosed space and intra-abdominal pressure is distributed equally over the mesh, thereby keeping the mesh in place.</p>\n<p>Stoppa's repair is an open <strong>preperitoneal</strong> mesh repair primarily indicated for large, <strong>recurrent</strong>, <strong>bilateral</strong> hernias.</p>\n<p>In Stoppa&rsquo;s mesh repair, a large piece of <strong>mesh is placed in the retro muscular space,</strong>&nbsp;over the <strong>posterior rectus sheath</strong> or peritoneum. This mesh is <strong>not sutured&nbsp;</strong>in patients with small defects because it is held in place by intra-abdominal pressure (Pascal&rsquo;s law). This allows the eventual incorporation of the mesh with the surrounding tissues. Alternatively, in <strong>larger</strong> defects, the mesh can be <strong>secured laterally</strong> with several sutures.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c739a1b7df4544c18a51fa23eabcd5d1x1280x1373.JPEG"
    ]
  },
  {
    "text": "A 2-year-old boy was brought to the clinic with a history of a reducible and painless swelling in the right groin for the past 2 months. After the clinical and radiological investigations, the diagnosis of a right-sided inguinal hernia was made. The patient is posted for hernia repair surgery. Which of the following steps will not be done in this patient during the repair?",
    "choices": [
      {
        "id": 1,
        "text": "Opening of the hernial sac"
      },
      {
        "id": 2,
        "text": "Excision of the hernial sac"
      },
      {
        "id": 3,
        "text": "Transfixation of the neck"
      },
      {
        "id": 4,
        "text": "Repair of the inguinal ring"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p class=\"p1\">Inguinal hernia in a child is treated by&nbsp;<strong>herniotomy</strong>. In this procedure,<strong> repair of the inguinal ring is not done</strong>.</p>\n<p class=\"p1\">This is because the inguinal hernia in the <strong>pediatric</strong> population is due to the presence of<strong> patent processus vaginalis</strong> and not due to the weakening of the abdominal muscles or the ligaments.</p>\n<p class=\"p1\">Herniotomy involves either <strong>reduction</strong> of the hernial sac alone, or <strong>opening</strong> of the hernial sac, <strong>reduction</strong> of the contents,<strong> transfixation of the neck</strong>, and <strong>excision</strong> of the patent processus vaginalis/ hernial sac.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most appropriate mesh for use in hernioplasty?",
    "choices": [
      {
        "id": 1,
        "text": "Heavyweight with small pores"
      },
      {
        "id": 2,
        "text": "Heavyweight mesh with large pores"
      },
      {
        "id": 3,
        "text": "Lightweight mesh with small pores"
      },
      {
        "id": 4,
        "text": "Lightweight mesh with large pores"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most appropriate mesh used in hernioplasty is a&nbsp;<strong>l</strong><strong>ightweight mesh with large pores.</strong></p>\n<p><strong>Lightweight meshes</strong> generally contain less material and induce a less-pronounced foreign body reaction and <strong>decreased inflammatory response</strong>, which results in better tissue incorporation, increased prosthesis compliance, and decreased patient discomfort and pain.</p>\n<p>Meshes with <strong>large pores</strong> exhibit<strong> less inflammatory infiltrate</strong>, connective tissue, and scar bridging, which allows <strong>increased soft tissue ingrowth.</strong>&nbsp;They have <strong>greater elasticity</strong> and flexibility and also <strong>shrink less </strong>resulting in <strong>lesser adhesions</strong>, better tissue incorporation, and decreased patient discomfort and pain. So the best mesh type among the given options is lightweight mesh with large pores.</p>\n<p>Meshes used in hernioplasty can be synthetic or biological depending on their composition.</p>\n<p><strong>Synthetic meshes</strong> are made from polypropylene, polyester, or PTFE (polytetrafluoroethylene).&nbsp;</p>\n<table style=\"width: 375.898px;\">\n<tbody>\n<tr>\n<td style=\"width: 82px;\"><strong>POLYPROPYLENE</strong></td>\n<td style=\"width: 80px;\"><strong>POLYESTER</strong></td>\n<td style=\"width: 74.8984px;\"><strong>PTFE</strong></td>\n</tr>\n<tr>\n<td style=\"width: 82px;\">monofilament</td>\n<td style=\"width: 80px;\">multifilament</td>\n<td style=\"width: 74.8984px;\">solid</td>\n</tr>\n<tr>\n<td style=\"width: 82px;\">hydrophobic</td>\n<td style=\"width: 80px;\">hydrophilic</td>\n<td style=\"width: 74.8984px;\">hydrophobic</td>\n</tr>\n<tr>\n<td style=\"width: 82px;\">rigid</td>\n<td style=\"width: 80px;\">elastic</td>\n<td style=\"width: 74.8984px;\">rigid</td>\n</tr>\n</tbody>\n</table>\n<p><strong>PTFE</strong> meshes are hydrophobic with a <strong>lower risk</strong> of <strong>adhesion.</strong></p>\n<p><strong>Biological meshes</strong> are acellular matrix materials derived from humans or animals and have <strong>lesser complications</strong>. But due to poor collagen deposition and absorption, they rapidly <strong>lose mechanical strength</strong> and hence their <strong>use</strong> is restricted to <strong>infected environments</strong>.&nbsp;</p>\n<p>Note: To promote better tissue integration, a composite mesh was developed which combines the attributes of polypropylene and PTFE by layering the two substances on top of one another.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient operated for direct inguinal hernia developed sensory loss at the root of the penis and adjacent part of the scrotum. Which of the following nerves is most likely injured?",
    "choices": [
      {
        "id": 1,
        "text": "Ilioinguinal nerve"
      },
      {
        "id": 2,
        "text": "Iliohypogastric nerve"
      },
      {
        "id": 3,
        "text": "Genital branch of genitofemoral nerve"
      },
      {
        "id": 4,
        "text": "Femoral branch of genitofemoral nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: left;\"><strong>Loss of sensation</strong> in the <strong>root of the penis and adjacent part of the scrotum</strong> is suggestive of an injury to the <strong>ilioinguinal nerve.</strong> It is most commonly injured within the inguinal canal in <strong>open hernia repair</strong> due to traction or thermal injury.</p>\n<p style=\"text-align: left;\">The <strong>iliohypogastric nerve</strong> carries the sensory supply from the <strong>suprapubic area.</strong> Injury to this nerve in the right iliac fossa rarely causes sensory disturbances, as the suprapubic area has a rich nerve supply from other sources too. If the <strong>nerve is severed</strong> above the <strong>anterior superior iliac spine,</strong> it can lead to the&nbsp;<strong>weakened posterior wall</strong> of the inguinal canal resulting in <strong>direct inguinal hernia</strong>. Iliohypogastric nerve can also get injured following <strong>appendicectomy</strong>.</p>\n<p style=\"text-align: left;\">Injury to the<strong> genital branch of the genitofemoral nerve&nbsp;</strong>results in loss of sensation in the skin of the&nbsp;<strong>scrotum</strong> of males, and loss of sensation of the <strong>mons pubis and labia majora</strong> in females.&nbsp;</p>\n<p style=\"text-align: left;\">Injury to the<strong> femoral branch of the genitofemoral nerve</strong> causes <strong>hypoesthesia</strong> over the<strong> anterior thigh</strong> below the inguinal ligament.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/849b2737a0904b7e9e75c6ddc57d37f7x1280x1662.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male patient with chronic constipation is diagnosed with Type 7 Gilbert hernia. This refers to ______",
    "choices": [
      {
        "id": 1,
        "text": "Direct inguinal hernia"
      },
      {
        "id": 2,
        "text": "Indirect inguinal hernia"
      },
      {
        "id": 3,
        "text": "Femoral hernia"
      },
      {
        "id": 4,
        "text": "Umbilical hernia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Femoral hernia</strong> is classified under<strong> type 7 Gilbert hernia.</strong></p>\n<p>As per&nbsp;<strong>Nyhus classification system</strong>, femoral hernia is classified under <strong>type 3C.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about femoral hernia is true?",
    "choices": [
      {
        "id": 1,
        "text": "It occurs exclusively in females"
      },
      {
        "id": 2,
        "text": "All femoral hernias should be repaired"
      },
      {
        "id": 3,
        "text": "It does not strangulate"
      },
      {
        "id": 4,
        "text": "Femoral vein lies medial to the sac"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>All&nbsp;<strong>femoral hernias</strong> should be <strong>repaired&nbsp;</strong>and incarcerated femoral hernias should have the hernia sac contents examined for viability.</p>\n<p>Option A: Femoral hernia occurs in both males and females, but it is <strong>more common in multiparous females.&nbsp;</strong><strong>Femoral hernia</strong> is more common on the<strong> right side</strong> because of the&nbsp;tamponading effect of the sigmoid colon on the left femoral canal.&nbsp;This effect is absent on the right side.</p>\n<p>Option C: The <strong>incidence of strangulation</strong> in femoral hernias is <strong>high</strong> because of the <strong>narrowness of the neck of the sac </strong>and<strong> r</strong><strong>igidity of the femoral ring.</strong></p>\n<p>Option D: <strong>Femoral vein</strong> is situated <strong>lateral</strong> to a femoral hernia<strong> (femoral canal).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following surgeries for femoral hernia with their indications:",
    "choices": [
      {
        "id": 1,
        "text": "1-A, 2-B, 3-C, 4-D"
      },
      {
        "id": 2,
        "text": "1-C, 2-D, 3-B, 4-A"
      },
      {
        "id": 3,
        "text": "1-B, 2-C, 3-A, 4-D"
      },
      {
        "id": 4,
        "text": "1-B, 2-A, 3-D, 4-C"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>&nbsp;The correct option is&nbsp;<strong>1-B, 2-A, 3-D, 4-C.</strong></p>\n<table style=\"height: 219px; width: 522.6875px;\">\n<tbody>\n<tr style=\"height: 25px;\">\n<td style=\"width: 221px; text-align: center; height: 25px;\"><strong>Surgery</strong></td>\n<td style=\"width: 282.6875px; text-align: center; height: 25px;\"><strong>Indication</strong></td>\n</tr>\n<tr style=\"height: 47px;\">\n<td style=\"width: 221px; height: 47px;\">1. <strong>Lockwood's</strong> surgery</td>\n<td style=\"width: 282.6875px; height: 47px;\">B. <strong>Elective</strong> repair</td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"width: 221px; height: 49px;\">2. <strong>McEvedy's</strong> surgery</td>\n<td style=\"width: 282.6875px; height: 49px;\">A. Presence of bowel <strong>infarction</strong></td>\n</tr>\n<tr style=\"height: 45px;\">\n<td style=\"width: 221px; height: 45px;\">3. <strong>Lotheissen's</strong> surgery</td>\n<td style=\"width: 282.6875px; height: 45px;\">D. <strong>Trans-inguinal</strong> approach</td>\n</tr>\n<tr style=\"height: 39px;\">\n<td style=\"width: 221px; height: 39px;\">4. <strong>McVay's</strong> surgery</td>\n<td style=\"width: 282.6875px; height: 39px;\">C. For both <strong>femoral</strong> and <strong>inguinal</strong> hernia</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3d90f2b98d9845bb87fecbcee73f2c4ax1280x1188.JPEG"
    ]
  },
  {
    "text": "In Laugier\u2019s hernia, the opening is in the _____",
    "choices": [
      {
        "id": 1,
        "text": "Lacunar ligament"
      },
      {
        "id": 2,
        "text": "Conjoint tendon"
      },
      {
        "id": 3,
        "text": "External oblique"
      },
      {
        "id": 4,
        "text": "Peritoneum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Laugier&rsquo;s hernia</strong> is an atypical femoral hernia where the sac herniates through a gap in the&nbsp;<strong>lacunar (Gimbernat&rsquo;s) ligament.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bd9b3630b754a7681d9b59ae249c29cx1280x1594.JPEG"
    ]
  },
  {
    "text": "Which of the following statements about Spigelian hernia is false?",
    "choices": [
      {
        "id": 1,
        "text": "It occurs above the level of the arcuate line"
      },
      {
        "id": 2,
        "text": "The hernia sac is posterior to the external oblique aponeurosis"
      },
      {
        "id": 3,
        "text": "Most commonly presents as a painless mass"
      },
      {
        "id": 4,
        "text": "It is detected by USG/CT"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Usually, Spigelian hernias do not present as a mass because it is beneath the intact external oblique aponeurosis.</p>\n<p>The most common presentation in Spigelian hernia is <strong>pain.</strong></p>\n<p>There is a common <strong>misconception</strong> that they protrude below the arcuate line owing to the deficiency of the posterior rectus sheath at that level; but <strong>in fact,</strong> the defect is almost <strong>always above the arcuate line.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/674d1cbf32c1415d88c79347816f2ccbx1280x1298.JPEG"
    ]
  },
  {
    "text": "While performing an elective hernia repair, the surgeon notices that the posterior wall of the hernia sac is formed by the sigmoid colon. What is this type of hernia known as?",
    "choices": [
      {
        "id": 1,
        "text": "Lumbar hernia"
      },
      {
        "id": 2,
        "text": "Sliding hernia"
      },
      {
        "id": 3,
        "text": "Spigelian hernia"
      },
      {
        "id": 4,
        "text": "Pantaloon hernia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is that of a <strong>sliding hernia.</strong></p>\n<p>Sliding hernia occurs when an <strong>internal organ </strong>composes a<strong> portion of the wall of the hernia sac. </strong></p>\n<p>The most common viscus involved are as follows:</p>\n<ul>\n<li>Left side: <strong>sigmoid colon</strong> and its mesentery</li>\n<li>Right side: <strong>cecum</strong></li>\n</ul>\n<p>It is more common on the<strong> left </strong>side<strong>.&nbsp;</strong>Most sliding hernias are <strong>variants of indirect inguinal hernias. </strong>The primary danger associated with a sliding hernia is the failure to recognize the visceral component of the hernia sac resulting in injury to the bowel or bladder.</p>\n<p>Option A: A <strong>lumbar hernia</strong> is a <strong>posterolateral body wall</strong> hernia where the bowel, omentum, or pre-peritoneal fat herniates through the <strong>lumbar triangles.</strong>&nbsp;</p>\n<p>Option C: A <strong>Spigelian hernia</strong> occurs through slit-like defects in the <strong>anterior abdominal wall</strong> adjacent to the semilunar line. Most spigelian hernias occur in the lower abdomen where the posterior sheath is deficient. It is also called &ldquo;spontaneous lateral ventral hernia&rdquo; or &ldquo;hernia of the semilunar line&rdquo;.</p>\n<p>Option D: A <strong>pantaloon hernia</strong> occurs when both a <strong>direct and an indirect hernia</strong> develop on the <strong>same side</strong> of the <strong>groin</strong>. The hernia is named pantaloon because the two hernia sacs are divided by epigastric vessels, and so they look like a pair of pants.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged male patient underwent adrenalectomy for Cushing's syndrome one year back. He now presents with a history of chronic lower back pain. On examination, a partially reducible mass that increased in size during Valsalva maneuver was noticed on his lower back. Which of the following statements regarding the patient's condition is false?",
    "choices": [
      {
        "id": 1,
        "text": "Herniation may have occured through the Grynfelt\u2019s triangle"
      },
      {
        "id": 2,
        "text": "The inferior lumbar triangle is bound by the external oblique and latismus dorsi muscle"
      },
      {
        "id": 3,
        "text": "Herniation is relatively more common on the right side"
      },
      {
        "id": 4,
        "text": "Dowd Ponka technique is  used for surgical repair"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of an iatrogenic&nbsp;<strong>lumbar hernia</strong>&nbsp;which developed due to weakening of the posterior abdominal wall due to surgery. It occurs more commonly on the <strong>left</strong> side.</p>\n<p>A lumbar hernia is a posterolateral body wall hernia where the bowel, omentum, or pre-peritoneal fat herniates through the <strong>lumbar triangles.</strong> Causes can be congenital, acquired, traumatic, or iatrogenic. It is frequently confused for lipomas, muscle strains, fibromas, abscesses, and kidney tumors.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which type of hernia is depicted in the following diagram?",
    "choices": [
      {
        "id": 1,
        "text": "Richter\u2019s hernia"
      },
      {
        "id": 2,
        "text": "Littre\u2019s hernia"
      },
      {
        "id": 3,
        "text": "Petersen hernia"
      },
      {
        "id": 4,
        "text": "Maydl hernia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The diagram shows <strong>Maydl&rsquo;s hernia/Hernia-en-W/retrograde hernia</strong>, where 2 loops of the bowel remain in the hernia sac with the connecting loop inside the abdomen.</p>\n<p>Option A: In <strong>Richter's hernia</strong>, a small portion of the <strong>antimesenteric wall of the intestine is trapped within the hernia.&nbsp;</strong>Strangulation can occur without the pres&shy;ence of intestinal obstruction. Clinically, it <strong>mimics gastroenteritis.</strong></p>\n<p>Option B: In <strong>Littre&rsquo;s hernia</strong>,<strong> Meckel&rsquo;s diverticulum </strong>is the content.&nbsp;<strong>Amyand&rsquo;s hernia</strong> is an inguinal hernia in which the hernia sac contains a normal or acutely inflamed <strong>appendix.</strong></p>\n<p>Option C: <span class=\"ILfuVd\"><span class=\"hgKElc\"><strong>Petersen hernia</strong> is caused by the herniation of <strong>intestinal loops</strong> through the <strong>defect</strong> between the <strong>small bowel limbs,</strong> the <strong>transverse mesocolon, </strong>and the <strong>retroperitoneum</strong>, after any type of <strong>gastrojejunostomy.</strong></span></span></p>\n<div id=\"WEB_ANSWERS_STANDARD_RESULT_13_pE1iYvfQIYyaseMPl7OQ6Ac__12\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/781509e53e8644519f4e4bc5a320520e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old fit athlete presents to the OPD with complaints of nausea and heartburn. On examination, a soft, pea-sized swelling could be palpated on his abdomen. What is the likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Umbilical hernia"
      },
      {
        "id": 2,
        "text": "Fatty hernia of linea alba"
      },
      {
        "id": 3,
        "text": "Incisional hernia"
      },
      {
        "id": 4,
        "text": "Paraduodenal hernia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The likely diagnosis in this patient is <strong>epigastric hernia</strong>, also known as <strong>fatty hernia of linea alba.</strong></p>\n<p>Epigastric hernia is located between the xiphoid process and umbilicus, usually in the <strong>midline.&nbsp;</strong>It occurs more commonly in <strong>males.&nbsp;</strong>A <strong>soft</strong> midline <strong>swelling</strong> can be felt more easily than seen.&nbsp;Pain occurs due to the<strong> incarceration of the preperitoneal fat </strong>and<strong>&nbsp;</strong>may <strong>simulate peptic ulcer.&nbsp;</strong>There is no overlying sac.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 83-year-old lady was brought to the OPD with a two-day history of nausea, thigh pain and obstipation. Her family reported a significant weight loss over the last year attributed to grieving over her son's death. On examination, there is no lump in her groin. But, she experiences pain along the anteromedial aspect of her thigh which is relieved by thigh flexion. Which of the following statements regarding her condition is true?",
    "choices": [
      {
        "id": 1,
        "text": "Femoral hernia is the most likely diagnosis"
      },
      {
        "id": 2,
        "text": "Howship Romberg sign can be elicited"
      },
      {
        "id": 3,
        "text": "Transinguinal approach is preferred for surgery"
      },
      {
        "id": 4,
        "text": "These hernias are almost always interparietal"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and examination findings are suggestive of&nbsp;<strong>obturator hernia</strong>. <strong>Howship-Romberg sign</strong> can be seen in patients with obturator hernia.</p>\n<p><strong>Howship-Romberg sign</strong> refers to <strong>pain in the anteromedial aspect of the thigh</strong> due to <strong>compression of the obturator nerve</strong> that is <strong>relieved by thigh flexion.</strong></p>\n<p>Obturator hernia is also&nbsp;known as <strong>skinny old lady hernia </strong>and<strong> French hernia. </strong>It occurs more commonly in<strong> thin, elderly, debilitated females.</strong></p>\n<p>Predisposing factors are:</p>\n<ul>\n<li>Women with wider pelvis and more triangular obturator canal</li>\n<li>Malnutrition</li>\n<li>Chronic constipation</li>\n<li>Chronic obstructive pulmonary disease (COPD)</li>\n<li>Multiparity</li>\n<li>Ascites</li>\n<li>Kyphoscoliosis</li>\n</ul>\n<p>Intestinal obstruction can occur.</p>\n<p>Option A:<strong>&nbsp;</strong>Femoral hernias commonly present as a <strong>small lump in the groin</strong>. They may be asymptomatic or present with strangulation in about 30% of patients.</p>\n<p>Option C:&nbsp;A <strong>posterior</strong> approach, open or laparoscopic surgery is the treatment of choice. This approach provides direct access to the hernia.</p>\n<p>Option D:&nbsp;<span style=\"font-size: 14px;\">Interparietal hernias are rare and occur when the sac lies <strong>between layers</strong> of the abdominal wall. These hernias most frequently occur in previous <strong>incisions. Spigelian</strong> hernias are almost always interparietal.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/40172e7e96ac4f4c9c4f6a97d94715dax1280x1473.JPEG"
    ]
  },
  {
    "text": "Hernia with hydrocele is known as ________.",
    "choices": [
      {
        "id": 1,
        "text": "Gibbon\u2019s hernia"
      },
      {
        "id": 2,
        "text": "Berger\u2019s hernia"
      },
      {
        "id": 3,
        "text": "Beclard\u2019s hernia"
      },
      {
        "id": 4,
        "text": "Ogilvie\u2019s hernia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Gibbon&rsquo;s hernia</strong> is a&nbsp;<strong>hernia with hydrocele.</strong></p>\n<p>Option B:<strong> Berger&rsquo;s hernia</strong> is hernia into the&nbsp;<strong>pouch of Douglas.</strong></p>\n<p>Option C: <strong>Beclard&rsquo;s hernia</strong> is <strong>femoral hernia </strong>through the opening of the <strong>saphenous vein</strong>.</p>\n<p>Option D: <strong>Ogilvie&rsquo;s hernia</strong> is hernia through a <strong>defect in conjoint tendon</strong> just lateral to where it inserts with the rectus sheath.</p>\n<p>Edward Gibbon, the author of \"The Decline and Fall of the Roman Empire,\" was greatly embarrassed by a large hydrocele. The second time that it was tapped, it became infected, and Gibbon died a few days later. The hydrocele was associated with a large scrotal hernia which had probably been punctured.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "According to the European Hernia Society classification, M3 incisional hernia refers to:",
    "choices": [
      {
        "id": 1,
        "text": "Epigastric"
      },
      {
        "id": 2,
        "text": "Infraumbilical"
      },
      {
        "id": 3,
        "text": "Umbilical"
      },
      {
        "id": 4,
        "text": "Suprapubic"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the European Hernia Society classification, M3 incisional hernia refers to <strong>umbilical hernia.</strong></p>\n<p>According to the European Hernia Society classification of incisional hernias:</p>\n<p><strong>Midline</strong> incisional hernias are classified as-</p>\n<table style=\"height: 267px; width: 283px;\">\n<tbody>\n<tr>\n<td style=\"width: 55px;\">M1</td>\n<td style=\"width: 98px;\">Subxiphoidal</td>\n</tr>\n<tr>\n<td style=\"width: 55px;\">M2</td>\n<td style=\"width: 98px;\">Epigastric</td>\n</tr>\n<tr>\n<td style=\"width: 55px;\"><strong>M3</strong></td>\n<td style=\"width: 98px;\"><strong>Umbilical</strong></td>\n</tr>\n<tr>\n<td style=\"width: 55px;\">M4</td>\n<td style=\"width: 98px;\">Infraumbilical</td>\n</tr>\n<tr>\n<td style=\"width: 55px;\">M5</td>\n<td style=\"width: 98px;\">Suprapubic</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Lateral</strong> incisional hernias are classified as-</p>\n<table style=\"height: 144px; width: 282px;\">\n<tbody>\n<tr>\n<td style=\"width: 96px;\">L1</td>\n<td style=\"width: 170px;\">\n<p>Subcostal</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">L2</td>\n<td style=\"width: 170px;\">\n<p>Flank</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">L3</td>\n<td style=\"width: 170px;\">\n<p>Iliac</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">L4</td>\n<td style=\"width: 170px;\">\n<p>Lumbar</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young female patient who had been suffering from chronic abdominal pain is rushed to the casualty due to acute exacerbation. On further investigations, she is diagnosed with intestinal obstruction secondary to a paraduodenal hernia. Which  of the following statements regarding the hernia is false?",
    "choices": [
      {
        "id": 1,
        "text": "Left-sided hernia is found in the fossa of Landzert"
      },
      {
        "id": 2,
        "text": "Right sided hernia is found in the fossa of Kolb"
      },
      {
        "id": 3,
        "text": "It is usually congenital"
      },
      {
        "id": 4,
        "text": "It is more common on the right side"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Both the fossa of Landzert and the fossa of Waldeyer/Kolb are formed due to congenital mesenteric fusion defects.</p>\n<p>Option C: Paraduodenal hernia is the <strong>most common internal hernia </strong>and they are usually<strong> congenital.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a2e39b948b64244876d807a99cb057fx1280x1840.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/751e07cc16314198bc3f7499be08c915x1280x1840.JPEG"
    ]
  },
  {
    "text": "An infant who is diagnosed with congenital hypothyroidism presents with the following hernia. Which of the following statements is false regarding the management of this child?",
    "choices": [
      {
        "id": 1,
        "text": "The hernia may spontaneously resolve by 2 years of age"
      },
      {
        "id": 2,
        "text": "Surgical repair is indicated if the hernia persists for more than 5 years of age"
      },
      {
        "id": 3,
        "text": "Strangulation is a common complication associated with this hernia in this child"
      },
      {
        "id": 4,
        "text": "Mayo\u2019s procedure or mesh repair can be done for this hernia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical history of <strong>congenital hypothyroidism</strong> and the image showing a mass protruding out of the umbilicus are indicative of an <strong>umbilical hernia. Obstruction</strong> and <strong>strangulation</strong> are <strong>uncommon</strong> below the age of 3 years.</p>\n<p><strong>Mayo\u2019s operation</strong> is done for <strong>umbilical hernia.\u00a0</strong>A small curved incision is made below the umbilicus and the neck of the <strong>sac</strong> is <strong>opened.</strong> The contents are returned to the peritoneal cavity and the redundant\u00a0sac is <strong>excised</strong> after closing it. Defect in the linea alba is closed with <strong>interrupted</strong> sutures.\u00a0Indications for surgery in umbilical hernia are:</p>\n<ul>\n<li>Defect size <strong>&gt;2cm</strong></li>\n<li>Persisting <strong>beyond 5 years</strong></li>\n<li>Progressively enlarging after 2 years of age (usually regresses spontaneously by 2 years of age)</li>\n<li>Symptomatic</li>\n<li>Strangulated</li>\n</ul>\n<p>In adults,\u00a0d<span style=\"font-size: 14px;\">efects <strong>up to 2cm</strong> in diameter may be<strong> sutured primarily</strong> with minimal tension. However, with larger defects, <strong>mesh reinforcement</strong> will be beneficial.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4b441f9d04e542c9bbfb4f54e3767bcb.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A baby was born with a congenital defect as shown below. Which of the following statements is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "It is associated with trisomy 13"
      },
      {
        "id": 2,
        "text": "It is due to failure of physiological hernia to reduce before 7 weeks"
      },
      {
        "id": 3,
        "text": "Seen in term babies"
      },
      {
        "id": 4,
        "text": "Topical application of silver nitrate is done"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The congenital defect showing herniation of the intestinal contents enclosed in a sac from the umbilicus is suggestive of&nbsp;<strong>omphalocele. </strong>It is due to<strong>&nbsp;</strong>the<strong> failure </strong>of the<strong> physiological hernia</strong> to <strong>reduce </strong>into the abdominal cavity <strong>before 10 weeks </strong>resulting in&nbsp;<strong>non-closure </strong>of the <strong>umbilical ring.&nbsp;</strong></p>\n<p>Physiological <strong>herniation</strong> of the <strong>midgut</strong> through the umbilicus occurs<strong> during the 5<sup>th</sup> week</strong> so as to accommodate the rapidly growing intestine and <strong>persists </strong>until the<strong> 10<sup>th</sup> week.</strong></p>\n<p>Omphalocele is seen in term babies and is usually associated with other congenital anomalies (e.g., <strong>trisomy 13,</strong> trisomy 18, or <strong>Beckwith-Wiedemann syndrome</strong>) and with increased levels of &alpha;-fetoprotein.</p>\n<p>An omphalocele may contain the stomach, liver, and intestines. These contents are <strong>enclosed in a sac.&nbsp;</strong></p>\n<div class=\"page\" title=\"Page 1912\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The treatment is as follows:</p>\n<ul>\n<li><strong>Preservation </strong>of the intact sac with a sterile, moistened, saline gauze or transparent bowel bag.</li>\n<li><strong>IV fluids</strong> should be started, along with <strong>gastric tube decompression</strong> and <strong>IV antibiotics. </strong></li>\n<li><strong>Topical </strong>application of <strong>povidone-iodine</strong> ointment, merbromin (mercurochrome), <strong>or</strong> <strong>silver nitrate&nbsp;</strong>allows the sac to thicken and epithelialize gradually.</li>\n<li><strong>Primary surgical closure</strong>&nbsp;is preferred for small to medium-sized defects.&nbsp;</li>\n</ul>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/95188e5d5391493291300eafcd2c9eda.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cf0500143e44d98802a4e06111d8fe6x1279x1242.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7987f64c98ee49e690d74e836400a0ccx1279x1242.JPEG"
    ]
  },
  {
    "text": "A 3-month-old child presented with umbilical discharge. Abdomen examination was normal except for the below finding. The next step of management is?",
    "choices": [
      {
        "id": 1,
        "text": "MRI Abdomen"
      },
      {
        "id": 2,
        "text": "USG Abdomen"
      },
      {
        "id": 3,
        "text": "CECT"
      },
      {
        "id": 4,
        "text": "Exploratory laparotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Patent urachus occurs due to the failure of urachus to obliterate, resulting in a connection between the bladder and the umbilicus.</p>\n<p>Urachal cyst occurs when the urachus fails to obliterate but there is no connection between the bladder and the umbilicus.</p>\n<p>The given image below shows a&nbsp;urachal cyst (UC) attached to Meckel&rsquo;s diverticulum (MD) on one side and urinary bladder (UB) on the other side with a patent tract- urachus (U).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c92c8383a16546ec8dfb533bd3ac105b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e226746e0f384863bd935402f9bf32b4x1280x2786.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36545182350748b3878f9d1aec2a5206x482x382.PNG"
    ]
  },
  {
    "text": "Which of the following is the most commonly seen tumor in the retroperitoneal space?",
    "choices": [
      {
        "id": 1,
        "text": "Liposarcoma"
      },
      {
        "id": 2,
        "text": "Rhabdomyosarcoma"
      },
      {
        "id": 3,
        "text": "Synovial sarcoma"
      },
      {
        "id": 4,
        "text": "Neurofibroma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Liposarcoma</strong> is the most commonly seen tumor in <strong>retroperitoneal space.</strong></p>\n<p>Retroperitoneal tumors can be benign or malignant.&nbsp;Malignant retroperitoneal tumors may be <span class=\"s1\">mesodermal&nbsp;</span><span class=\"s2\">(75%), </span>neuroectodermal (24%), or embryonic remnant (1%) in origin. Rarely it can be urologic or metastatic also. The <strong>order of frequency of primary retroperitoneal malignancy</strong> is as follows:</p>\n<ul>\n<li>Liposarcoma</li>\n<li>Leiomyosarcoma</li>\n<li>Rhabdomyosarcoma</li>\n<li>Fibrosarcoma</li>\n<li>Malignant nerve sheath tumors</li>\n</ul>\n<p><strong>Liposarcoma </strong>is composed of three histologic varieties (listed in order of decreasing frequency):</p>\n<ul>\n<li><strong>Well-differentiated</strong> and undifferentiated liposarcoma</li>\n<li><strong>Pleomorphic</strong> liposarcoma</li>\n<li><strong>Myxoid/round cell liposarcoma</strong>&nbsp;</li>\n</ul>\n<p class=\"p1\">Among the three subtypes, <strong>pleomorphic</strong> liposarcoma is the <strong>most malignant</strong> and often metastasizes, while the well-differentiated is the least malignant. Myxoid liposarcoma has intermediate malignant behavior.</p>\n<p class=\"p1\">Diagnosis is confirmed by contrast-enhanced CT with CT of the chest to look for metastases.&nbsp;</p>\n<p class=\"p1\">Surgery is the main modality of treatment. Wide excision with complete en bloc dissection is done. Post-operative radiotherapy and chemotherapy are used as adjuvant methods. Radiotherapy is given at a dose of 5000 cGY, it can be external beam or intra-operative radiotherapy. Chemotherapeutic agents used are <strong>mesna</strong>, <strong>adriamycin</strong>, <strong>ifosfamide</strong> and <strong>dacarbazine</strong> (MAID regimen).</p>\n<p class=\"p1\">&nbsp;</p>\n<p class=\"p1\">&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '27 Hernia';
        const quizFilename = '27-hernia-a287acbc.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>