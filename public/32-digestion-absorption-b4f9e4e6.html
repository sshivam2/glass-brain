<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>32 Digestion & Absorption - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Physiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">32</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Salivary amylase is activated by which of the following ions?",
    "choices": [
      {
        "id": 1,
        "text": "Na+"
      },
      {
        "id": 2,
        "text": "K+"
      },
      {
        "id": 3,
        "text": "HCO3-"
      },
      {
        "id": 4,
        "text": "Cl-"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Salivary amylase is activated by&nbsp;<strong>Cl<sup>-</sup>.</strong></p>\n<p>Human salivary and pancreatic amylases are activated by<strong> chloride (Cl<sup>&ndash;</sup>). </strong>They&nbsp;have optimum activities near-neutral pH (7.4). They hydrolyze internal 1:4&alpha; linkages but spare 1:6&alpha; linkages and terminal 1:4&alpha; linkages in starch.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where does the digestion of disaccharides occur?",
    "choices": [
      {
        "id": 1,
        "text": "Mouth"
      },
      {
        "id": 2,
        "text": "Stomach"
      },
      {
        "id": 3,
        "text": "Small intestine"
      },
      {
        "id": 4,
        "text": "Large intestine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Digestion</strong> of <strong>disaccharides</strong> occurs in the <strong>small intestine.</strong></p>\n<p>The enzymes maltase, sucrase, isomaltase,&nbsp;lactase, and trehalase<strong>&nbsp;</strong>are located&nbsp;in the enterocytes&nbsp;covering the intestinal microvilli brush border. The&nbsp;disaccharides are digested&nbsp;into their constituent monosaccharides&nbsp;as they come in contact with&nbsp;these enterocytes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The mechanism by which glucose is absorbed in the intestine is:",
    "choices": [
      {
        "id": 1,
        "text": "Primary active transport"
      },
      {
        "id": 2,
        "text": "Secondary active transport"
      },
      {
        "id": 3,
        "text": "Facilitated diffusion"
      },
      {
        "id": 4,
        "text": "Any of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Glucose</strong> is <strong>absorbed</strong> in the intestine by<strong>&nbsp;secondary active transport.</strong></p>\n<p>On the basolateral side, there is active transport of&nbsp;sodium ions out of the cell&nbsp;into the interstitial fluid. This&nbsp;depletes sodium inside the cell. Because&nbsp;of this Na<sup>+</sup> concentration difference, more Na<sup>+</sup> binds to&nbsp;the SGLT on the luminal side. This increases the affinity of SGLT for glucose and glucose binds to it.</p>\n<p>Then, both the Na<sup>+</sup>&nbsp;and glucose are transported together to the interior of the cell. Thus, glucose is absorbed in the intestine by&nbsp;secondary active transport. The energy for glucose transport is provided indirectly, by the active transport of Na<sup>+</sup> out of the cell. The glucose moves out of&nbsp;the cell into the blood across the basolateral membrane by facilitated diffusion mediated via GLUT.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f8e2cde667740aabed2825c4aae243ax1280x1133.JPEG"
    ]
  },
  {
    "text": "Which of the following is a true statement?",
    "choices": [
      {
        "id": 1,
        "text": "Fructose is absorbed in the intestine by secondary active transport"
      },
      {
        "id": 2,
        "text": "SGLT2 is involved in absorption of monosaccharide in intestine"
      },
      {
        "id": 3,
        "text": "GLUT2 is involved in transport of glucose from enterocyte into interstitium"
      },
      {
        "id": 4,
        "text": "GLUT4 is responsible for basal glucose uptake in many organs"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A: Fructose absorption is through facilitated diffusion from the intestinal lumen into the enterocyte by GLUT5 and out of the enterocytes into the interstitium by GLUT2.</p>\n<p>Option B: SGLT1 is involved in the absorption of glucose into the enterocyte. SGLT2 is responsible for glucose transport out of the renal tubules.</p>\n<p>Option D:&nbsp;GLUT1 is responsible for basal glucose uptake in many organs.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/da36e19b135d4238be62373aa755535ex1280x1133.JPEG"
    ]
  },
  {
    "text": "Which of the following is the main enzyme involved in the hydrolysis of 1,6\u03b1 linkage of starch?",
    "choices": [
      {
        "id": 1,
        "text": "Maltase"
      },
      {
        "id": 2,
        "text": "Isomaltase"
      },
      {
        "id": 3,
        "text": "Sucrase"
      },
      {
        "id": 4,
        "text": "Lactase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>main enzyme</strong> involved in the <strong>hydrolysis</strong> of <strong>1,6&alpha; linkage</strong> of starch is<strong>&nbsp;isomaltase.</strong></p>\n<p>Both&nbsp;salivary and the pan&shy;creatic &alpha;-amylases hydrolyze internal 1:4&alpha; linkages but spare 1:6&alpha; linkages and terminal 1:4&alpha; linkages of starch.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is chymotrypsinogen?",
    "choices": [
      {
        "id": 1,
        "text": "Zymogen"
      },
      {
        "id": 2,
        "text": "Carboxypeptidase"
      },
      {
        "id": 3,
        "text": "Transaminase"
      },
      {
        "id": 4,
        "text": "Elastase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Chymotrypsinogen</strong> is a <strong>zymogen.</strong></p>\n<p>Zymogens (proenzymes) are&nbsp;<strong>inactive precursors</strong> of the enzymes.&nbsp;Most of the peptidases (proteases) are present in the form of proenzymes.&nbsp;Trypsinogen, chymotrypsinogen, proelastase, procarboxypeptidase A, procarboxypeptidase B are zymogens.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4cadb4601b994f32b44fe8167c1130d6x1280x1277.JPEG"
    ]
  },
  {
    "text": "Which of the following processes converts trypsinogen to trypsin?",
    "choices": [
      {
        "id": 1,
        "text": "Combination of 2 molecules of trypsin"
      },
      {
        "id": 2,
        "text": "Phosphorylation"
      },
      {
        "id": 3,
        "text": "Removal of a few amino acids"
      },
      {
        "id": 4,
        "text": "Addition of alkali group"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Trypsinogen</strong> is converted <strong>to trypsin</strong> by the&nbsp;<strong>removal</strong> of a <strong>few amino acids.</strong></p>\n<p>All proenzymes are converted to their active form by selective proteolysis (removal of a few amino acids).&nbsp;</p>\n<p><strong>Enterokinase cleaves</strong> trypsinogen to yield active trypsin. It is&nbsp;located on the brush border of duodenal enterocytes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bcfdcd5def794755b4358191cc6b5bd1x214x151.JPEG"
    ]
  },
  {
    "text": "Which of the following protects the normal pancreas from autodigestion?",
    "choices": [
      {
        "id": 1,
        "text": "Secretion of bicarbonate"
      },
      {
        "id": 2,
        "text": "Protease inhibitors"
      },
      {
        "id": 3,
        "text": "Proenzymes"
      },
      {
        "id": 4,
        "text": "Resistance of pancreatic cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The synthesis and secretion of proteases as catalytically inactive<strong> proenzymes protect</strong> the normal <strong>pancreas</strong> from <strong>autodigestion.</strong>&nbsp;</p>\n<p>All the protease proenzymes present in the pancreatic juice get converted to their active form only in the&nbsp;small intestinal lumen (site of action).</p>\n<p>If proenzymes get activated in the pancreas (site of origin), they can&nbsp;digest the entire pancreas within a few hours,&nbsp;giving rise to the condition called acute pancreatitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an endopeptidase?",
    "choices": [
      {
        "id": 1,
        "text": "Trypsin"
      },
      {
        "id": 2,
        "text": "Chymotrypsin"
      },
      {
        "id": 3,
        "text": "Elastase"
      },
      {
        "id": 4,
        "text": "Carboxypeptidase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Carboxypeptidase</strong> is an <strong>exopeptidase,</strong> not&nbsp;endopeptidase.</p>\n<p><strong>Peptidases </strong>(proteases) are of two types:</p>\n<ul>\n<li><strong>Endopeptidases - </strong>they<strong>&nbsp;</strong>act at interior peptide bonds in the peptide molecules. Ex- pepsin, trypsin, chymotrypsin, elastase.</li>\n<li><strong>Exopeptidases - </strong>they&nbsp;hydrolyze the amino acids at the carboxyl ends of the polypeptides, one at a time. Ex- carboxypeptidase, aminopeptidase.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Peptide transporter 1 is involved in the absorption of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Polypeptides"
      },
      {
        "id": 2,
        "text": "Dipeptide"
      },
      {
        "id": 3,
        "text": "Amino acids"
      },
      {
        "id": 4,
        "text": "Immunoglobulin A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Peptide transporter 1 <strong>(PepT1)</strong> is involved in the <strong>absorption</strong> of the&nbsp;<strong>dipeptide.</strong></p>\n<p>The dipeptides and tripeptides are transported along with H<sup>+</sup>&nbsp;into enterocytes by a system known as&nbsp;peptide trans&shy;porter 1&nbsp;(PepT1).&nbsp;</p>\n<p>These peptides undergo intracellular hydrolysis to release amino acids. These amino acids are absorbed into the circulation from the basolateral membrane via basolateral amino acid transporter. H<sup>+</sup> moves out of the cell via Na<sup>+</sup>-H<sup>+</sup> exchanger on the luminal side.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6df2a1922f3842e09d44334e27a255fcx600x550.JPEG"
    ]
  },
  {
    "text": "Which of the following is passively absorbed in the gut?",
    "choices": [
      {
        "id": 1,
        "text": "Glucose"
      },
      {
        "id": 2,
        "text": "galactose"
      },
      {
        "id": 3,
        "text": "Lipids"
      },
      {
        "id": 4,
        "text": "Amino acids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Lipids</strong> are <strong>passively absorbed</strong> in the gut.</p>\n<p>The products of <strong>lipid digestion </strong>(monoglycerides and free fatty acids) are incorporated into micelles that are formed by bile salts and diffuse across the intestinal epithelium.&nbsp;Short and medium-chain fatty acids can directly diffuse across the intestinal epithelium.</p>\n<p>Note: Recent evidence suggests that specific carrier proteins (membrane transporters) may be involved in the transport of long-chain fatty acids.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Short-chain fatty acids produced by bacteria are maximally absorbed in which part of the intestine?",
    "choices": [
      {
        "id": 1,
        "text": "Duodenum"
      },
      {
        "id": 2,
        "text": "Jejunum"
      },
      {
        "id": 3,
        "text": "Ileum"
      },
      {
        "id": 4,
        "text": "Colon"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Short-chain fatty acids</strong> produced by bacteria are <strong>absorbed</strong> maximally in the <strong>colon</strong> by <strong>secondary active transport.</strong></p>\n<p>Almost all the <strong>iron</strong> absorption occurs in the <strong>duodenum.</strong></p>\n<p>Vitamin <strong>B12</strong> is absorbed in the <strong>ileum.</strong></p>\n<p><strong>Folate</strong> is absorbed in the upper small intestine <strong>(duodenum</strong> and <strong>jejunum).</strong></p>\n<p>Maximum <strong>water</strong> absorption takes place in the&nbsp;<strong>jejunum.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a function of short-chain fatty acids in the colon?",
    "choices": [
      {
        "id": 1,
        "text": "Trophic effect on the colonic epithelial cells"
      },
      {
        "id": 2,
        "text": "Combat inflammation"
      },
      {
        "id": 3,
        "text": "Maintain acid\u2013base equilibrium"
      },
      {
        "id": 4,
        "text": "Secretion of Na+"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Short-chain fatty acids</strong> (2&ndash;5-carbon) in the colon promote the<strong> absorption</strong> of<strong> Na<sup>+</sup></strong>, not secretion.</p>\n<p>Short-chain fatty acids (SCFA) in the colon are formed by the action of colonic bacteria on complex carbohydrates, resistant starches, and other components of the dietary fiber i.e the material that escapes digestion in the upper gastrointestinal tract and enters the colon.</p>\n<p><strong>Functions:</strong></p>\n<ul>\n<li>Exert a trophic effect on the colonic epithelial cells</li>\n<li>Combat inflam&shy;mation</li>\n<li>Helps in maintaining acid-base equilibrium</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients is most likely to have a major electrolyte imbalance?",
    "choices": [
      {
        "id": 1,
        "text": "A patient with duodenal resection due to a primary tumor"
      },
      {
        "id": 2,
        "text": "A patient who underwent jejunal resection due to an obstruction"
      },
      {
        "id": 3,
        "text": "A patient with ileal resection due to recurrent Crohn's disease"
      },
      {
        "id": 4,
        "text": "A patient with sigmoid resection due to a recurrent fistula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>resection</strong> of <strong>jejunum</strong> leads to <strong>major electrolyte imbalance</strong> because most of the <strong>fluid</strong> and <strong>electrolyte reabsorption</strong> occurs in this segment.</p>\n<p>The <strong>maximum water</strong> absorption takes place in the&nbsp;<strong>jejunum.</strong></p>\n<div class=\"page\" title=\"Page 477\">\n<p>The amount of water absorbed in the intestines follows this order: Jejunum &gt; Ileum &gt; Colon.</p>\n</div>\n<p>Almost all the <strong>iron</strong> absorption occurs in the <strong>duodenum.</strong></p>\n<p>Vitamin <strong>B12</strong> is absorbed in the <strong>ileum.</strong></p>\n<p><strong>Folate</strong> is absorbed in the upper small intestine <strong>(duodenum</strong> and <strong>jejunum).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the amount of fluid absorbed in the intestine in a day?",
    "choices": [
      {
        "id": 1,
        "text": "5L"
      },
      {
        "id": 2,
        "text": "11L"
      },
      {
        "id": 3,
        "text": "2L"
      },
      {
        "id": 4,
        "text": "8L"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The amount of <strong>fluid absorbed</strong> in the <strong>intestine</strong> in <strong>a</strong> <strong>day</strong> is around&nbsp;<strong>8L.</strong></p>\n<p>About 2L of ingested water and 7L of various secretions enter the gastrointestinal tract. Out of this, the majority&nbsp;(8800 mL) is absorbed in the small intestine and colon.&nbsp;The small remaining volume&nbsp;that is not absorbed (100&ndash;200 mL) is excreted in feces.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not absorbed in the colon?",
    "choices": [
      {
        "id": 1,
        "text": "Acetate"
      },
      {
        "id": 2,
        "text": "Cl-"
      },
      {
        "id": 3,
        "text": "Na+"
      },
      {
        "id": 4,
        "text": "K+"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>K</strong><sup><strong>+</strong>&nbsp;</sup>is not absorbed in the colon. It is&nbsp;<strong>secreted</strong> in the <strong>rectal fluid.</strong></p>\n<p>Electrolytes (Na<sup>+</sup>, Cl<sup>-</sup>), short-chain fatty acids (acetate, propionate, butyrate), and water&nbsp;are absorbed in the colon.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4531e31d468a400d86ac5176db897d96x1280x1376.JPEG"
    ]
  },
  {
    "text": "Which of the following is false about vitamin absorption?",
    "choices": [
      {
        "id": 1,
        "text": "Fat-soluble vitamin digestion needs cholesterol esterase"
      },
      {
        "id": 2,
        "text": "Vitamin B12 is absorbed in ileum"
      },
      {
        "id": 3,
        "text": "Folate is absorbed by carriers that are Na+ cotransporters"
      },
      {
        "id": 4,
        "text": "Most vitamins are absorbed in upper small intestine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Folate </strong>and <strong>vitamin B12</strong>&nbsp;absorption is <strong>Na<sup>+</sup>-independent</strong>.</p>\n<p>The remaining water-soluble vitamins&mdash;thiamin, riboflavin, niacin, pyridoxine, pantothe&shy;nate, biotin, and ascorbic acid are absorbed by carriers that are Na+ cotransporters.</p>\n<p>Option A: Fat-soluble vitamins are ingested in the form of esters. Digestion needs hydrolysis by cholesterol esterase and absorbed after incorporating into micelles.</p>\n<p>Options B and D: Most vitamins are absorbed in the upper small intestine, but vitamin B12 is absorbed in the ileum. Vitamin B12 binds to intrinsic factor, a protein secreted by the parietal cells of the stomach.&nbsp;This complex is absorbed across the ileal mucosa.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with anemia is prescribed iron tablets. The absorption of the supplement is likely to take place in which part of the intestine?",
    "choices": [
      {
        "id": 1,
        "text": "Duodenum"
      },
      {
        "id": 2,
        "text": "Jejunum"
      },
      {
        "id": 3,
        "text": "Ileum"
      },
      {
        "id": 4,
        "text": "Stomach"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Almost all the <strong>iron absorption</strong> occurs in the<strong> duodenum.</strong></p>\n<p>Most of the iron in the diet is in the <strong>ferric </strong>(Fe<sup>3+</sup>) form, whereas it is the <strong>ferrous </strong>(Fe<sup>2+</sup>)&nbsp;form that is absorbed.</p>\n<p>Note: Carbohydrates, proteins, lipids are absorbed throughout the length of the small intestine. <strong>Bile acids</strong> are present throughout the small intestine, but <strong>active absorption</strong> occurs only in the <strong>ileum, </strong>and<strong> active absorbtion </strong>of <strong>folate</strong> occurs in the <strong>upper small intestine</strong> (duodenum and jejunum).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following stimulates ferritin synthesis?",
    "choices": [
      {
        "id": 1,
        "text": "Ceruloplasmin"
      },
      {
        "id": 2,
        "text": "Hepcidin"
      },
      {
        "id": 3,
        "text": "Iron"
      },
      {
        "id": 4,
        "text": "Transferrin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Note: Ferritin sequesters Fe<sup>2+</sup>, a potentially toxic molecule.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/574b084b27a3462c870370a41603750fx1280x1098.JPEG"
    ]
  },
  {
    "text": "Which of the following is inhibited by hepcidin?",
    "choices": [
      {
        "id": 1,
        "text": "Cobalamin absorption"
      },
      {
        "id": 2,
        "text": "Iron absorption"
      },
      {
        "id": 3,
        "text": "Folic acid synthesis"
      },
      {
        "id": 4,
        "text": "Copper absorption"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hepcidin inhibits\u00a0iron absorption.\u00a0</strong></p>\n<p>It is named for its originally\u00a0described property\u00a0as a\u00a0<strong>hep</strong>atocellular protein with bacteri<strong>cid</strong>al activities.</p>\n<p>Iron metabolism is regulated by hepcidin, a protein and acute phase reactant produced by the liver.\u00a0It binds to ferroportin and degrades it.<strong>\u00a0</strong>This\u00a0inhibits the transfer of iron from the enterocyte to the plasma via ferroportin. As a result, iron becomes trapped within the duodenal cells (enterocytes) in the form of mucosal ferritin and is lost in feces when these cells are shed off.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f5d32b9235f249359232ff9facd1bbd8x1279x1098.JPEG"
    ]
  },
  {
    "text": "While prescribing iron to a patient with iron deficiency anemia, which of the following would you recommend to increase its absorption?",
    "choices": [
      {
        "id": 1,
        "text": "Milk"
      },
      {
        "id": 2,
        "text": "Ascorbic acid"
      },
      {
        "id": 3,
        "text": "Antacid"
      },
      {
        "id": 4,
        "text": "Tannins"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ascorbic acid</strong> is&nbsp;given with <strong>iron</strong> to <strong>increase</strong> its <strong>absorption.</strong></p>\n<p>Ascorbic acid (vitamin C) forms soluble complexes with iron and reduces iron from the ferric to the ferrous state, thereby enhancing iron absorption.</p>\n<p>Option A: <strong>Milk</strong> decreases iron absorption.</p>\n<p>Option C: Gastric secretions increase iron absorption by dissolving the iron and allowing it to form soluble complexes<span class=\"Apple-converted-space\">&nbsp;with ascorbic and other substances. This helps in</span>&nbsp;its reduction to the Fe2+ form.<span class=\"Apple-converted-space\">&nbsp;<strong>Antacid</strong> decreases the absorption of iron.</span></p>\n<p>Option D:<strong> Tannins</strong> (present in tea), phytates, phosphates, and oxalates form insoluble complexes with iron and lower its absorption.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following regulates intestinal absorption of iron except:",
    "choices": [
      {
        "id": 1,
        "text": "Dietary intake of iron"
      },
      {
        "id": 2,
        "text": "Daily loss of iron"
      },
      {
        "id": 3,
        "text": "State of iron stores in the body"
      },
      {
        "id": 4,
        "text": "State of erythropoiesis in bone marrow"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Intestinal absorption of iron is not regulated by&nbsp;the daily loss of iron.</p>\n<p>The <strong>intestinal absorption</strong> of iron is <strong>regulated</strong> by <strong>three factors:</strong></p>\n<ol>\n<li>Recent dietary intake of iron</li>\n<li>State of the iron stores in the body</li>\n<li>State of erythropoiesis in the bone marrow</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the end product after the action of colonic bacteria on dietary fiber?",
    "choices": [
      {
        "id": 1,
        "text": "Free radicals"
      },
      {
        "id": 2,
        "text": "Glycerol"
      },
      {
        "id": 3,
        "text": "Butyrate"
      },
      {
        "id": 4,
        "text": "Sucrose"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The action of <strong>colonic bacteria</strong> on <strong>dietary fiber</strong> would give <strong>butyrate.</strong></p>\n<p>Colonic bacteria act on complex carbohydrates, resistant starches, and dietary fiber to form short-chain fatty acids such as acetate, propionate, and butyrate.</p>\n<p>SCFAs are 2&ndash;5-carbon weak acids that have an average normal concentration of about 80 mmol/L in the lumen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where are the cell bodies of the orexinergic neurons are present in a patient?",
    "choices": [
      {
        "id": 1,
        "text": "Locus ceruleus"
      },
      {
        "id": 2,
        "text": "Dorsal raphe"
      },
      {
        "id": 3,
        "text": "Lateral hypothalamic area"
      },
      {
        "id": 4,
        "text": "Hippocampus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Cell bodies of <strong>orexigenic neurons</strong> are present in the<strong> lateral hypothalamic area. </strong>Orexin stimulates food intake.</p>\n<p>Role of <strong>hypothalamus</strong> in gastrointestinal and feeding regulation:</p>\n<ul>\n<li><strong>Hunger center -</strong>&nbsp;lateral hypothalamic area</li>\n<li><strong>Satiety center -</strong>&nbsp;ventromedial nuclei</li>\n<li><strong>Feeding reflexes </strong>such as licking the lips and swallowing<strong> - </strong>mammillary bodies<strong>.</strong></li>\n</ul>\n<p>Note: The arcuate nucleus&nbsp;contains at least two different types of neurons that when stimulated lead to either increased or decreased appetite.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient who is fasting, the stomach releases a hormone that increases food intake. Identify the hormone secreted.",
    "choices": [
      {
        "id": 1,
        "text": "Orexin"
      },
      {
        "id": 2,
        "text": "Leptin"
      },
      {
        "id": 3,
        "text": "CCK"
      },
      {
        "id": 4,
        "text": "Ghrelin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The hormone secreted by the <strong>stomach</strong> that increases <strong>food intake</strong> is<strong>\u00a0ghrelin.</strong></p>\n<p>Ghrelin, the hunger hormone\u00a0is produced by the endocrine cells in the<strong> oxyntic glands </strong>of the stomach. It <strong>increases food intake.\u00a0</strong>Its\u00a0levels increase during fasting, peaks just before the beginning of food intake, or when the person is expecting a meal.\u00a0The levels fall within 1 hour of the start of feeding.</p>\n<p>Option A:\u00a0<strong>Orexin</strong> is synthesized from <strong>lateral\u00a0hypothalamic neurons.</strong> It increases food intake.</p>\n<p>Option B:\u00a0<strong>Leptin</strong> is produced by <strong>adipocytes.</strong> It decreases food intake.</p>\n<p>Option C:\u00a0<strong>CCK</strong> is released from the <strong>small intestine.</strong> It\u00a0decreases food intake.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding ghrelin?",
    "choices": [
      {
        "id": 1,
        "text": "Increases appetite"
      },
      {
        "id": 2,
        "text": "Inhibits leptin release"
      },
      {
        "id": 3,
        "text": "Decreases gastric acid secretion"
      },
      {
        "id": 4,
        "text": "Stimulates growth hormone release"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Ghrelin<strong> increases gastric acid secretion.</strong></p>\n<p>Ghrelin is mainly produced by the endocrine cells in the oxyntic gland area of the stomach. It is also secreted by the pancreas and adrenal glands.</p>\n<p><strong>Functions:</strong></p>\n<ul>\n<li><strong>Increases appetite</strong>/food intake (orexigenic)</li>\n<li><strong>Inhibits leptin release</strong></li>\n<li><strong>Stimulates growth hormone secretion</strong> by directly acting on anterior pituitary (<strong>ghre</strong>lin-<strong>g</strong>rowth <strong>h</strong>ormone-<strong>re</strong>leasing&nbsp;peptide)</li>\n<li>Increases gastric acid secretion and gastrointestinal motility to prepare the body for food intake</li>\n<li>Regulates the distribution and rate of use of energy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What will be the trend of leptin levels in a patient with a BMI of 34 kg/m2.",
    "choices": [
      {
        "id": 1,
        "text": "High"
      },
      {
        "id": 2,
        "text": "Normal"
      },
      {
        "id": 3,
        "text": "Low"
      },
      {
        "id": 4,
        "text": "May be low or normal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A patient with a BMI of 34 kg/m2 is categorized as obese. <strong>Leptin levels</strong> are <strong>high</strong> in <strong>obesity.</strong></p>\n<p>Leptin is an <strong>appetite-suppressing hormone </strong>synthesized from adipocytes.&nbsp;The larger the fat stores, the more leptin is released into&nbsp;the blood.</p>\n<p>Leptin resistance in obese persons may be due to its failure to cross the blood-brain barrier and reach the hypothalamus&nbsp;to serve its appetite-suppressing function.</p>\n<p>Note<strong>:&nbsp;</strong>A recent study has indicated that triglycerides which are elevated in obesity, inhibit the transport of leptin across the blood-brain barrier.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a dietary fiber?",
    "choices": [
      {
        "id": 1,
        "text": "Cellulose"
      },
      {
        "id": 2,
        "text": "Inulin"
      },
      {
        "id": 3,
        "text": "Pectin"
      },
      {
        "id": 4,
        "text": "Gums"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Gum&nbsp;</strong>is&nbsp;the best answer among the given options. Even though all of the given options are dietary fibers, the <strong>consumption</strong> of <strong>gums</strong> <strong>through</strong> <strong>diet</strong> is <strong>very</strong> <strong>low</strong> and hence, it is the best answer.</p>\n<p>Dietary fibers consist of both soluble and insoluble forms and include <strong>lignin, pectin, inulin, cellulose, hemicellulose</strong>, etc.</p>\n<p><strong>Advantages</strong> of<strong> fibers:</strong></p>\n<ul>\n<li>Forms bulk of the stool and reduces stool transit time</li>\n<li>Reduces incidence of carcinoma colon, DM, CAD, diverticulitis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following have a significant role in lipid digestion except:",
    "choices": [
      {
        "id": 1,
        "text": "Pancreatic lipase"
      },
      {
        "id": 2,
        "text": "Colipase"
      },
      {
        "id": 3,
        "text": "Lingual lipase"
      },
      {
        "id": 4,
        "text": "Bile acids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Lingual lipases</strong> are of <strong>little</strong> quantitative<strong> significance</strong> for<strong> lipid digestion</strong> other than in the setting of pancreatic insufficiency.</p>\n<p>Lingual lipase is secreted by Ebner glands on the dorsal surface of the tongue in some species, and the stomach also secretes lipase.</p>\n<p><strong>Digestion</strong> of<strong> Lipids</strong></p>\n<ul>\n<li><strong>Pancreatic lipase</strong> is the most important enzyme involved in lipid digestion. The main products of its action are FFA and 2-monoglycerides (2-monoacylglycerols)</li>\n<li><strong>Colipase&nbsp;</strong>is an accessory factor secreted in the pancreatic juice that helps to stabilize pancreatic lipase in an active conformation</li>\n<li><strong>Bile acids</strong> emulsify the insoluble lipids and make them reach the surface of the mucosal cells. Bile acids also activate another pancreatic lipase called cholesterol esterase</li>\n<li><strong>Cholesterol esterase</strong> hydrolyzes cholesterol esters, esters of fat-soluble vitamins, phospholipids, and triglycerides</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Following complete ileal and partial jejunal resection, the patient is most likely to have",
    "choices": [
      {
        "id": 1,
        "text": "Folic acid deficiency"
      },
      {
        "id": 2,
        "text": "Vitamin B12 deficiency"
      },
      {
        "id": 3,
        "text": "Gastric ulcer"
      },
      {
        "id": 4,
        "text": "Constipation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>After complete<strong> ileal</strong> and partial <strong>jejunal resection,</strong> the patient is likely to have <strong>vitamin B12 deficiency.</strong></p>\n<p>Vitamin B12 is absorbed in the ileum. Vitamin B12 binds to intrinsic factor, a protein secreted by the parietal cells of the stomach, and the complex is absorbed across the ileal mucosa. Hence after ileal resection, there is impaired absorption of vitamin B12.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Transport molecule for Fe2+ into the enterocytes is",
    "choices": [
      {
        "id": 1,
        "text": "Ferroportin 1"
      },
      {
        "id": 2,
        "text": "Hephaestin"
      },
      {
        "id": 3,
        "text": "Divalent Metal Transporter 1"
      },
      {
        "id": 4,
        "text": "Divalent Metal Transporter 2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">Transport of&nbsp;<strong>Fe2+ into</strong>&nbsp;the&nbsp;<strong>enterocytes</strong>&nbsp;occurs via<strong>&nbsp;divalent metal transporter</strong>&nbsp;<strong>1 (DMT1),&nbsp;</strong>through an <strong>active transport</strong> process.</p>\n<p class=\"p1\">Protein DMT-1 (Divalent Metal Transporter-1) is expressed on the apical surface of enterocytes in the initial part of the duodenum. DMT-1 is not specific to iron &amp; transports other substances like zinc, copper, cobalt &amp; manganese.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b607d17f9fe4494390dd0d8bc8614af9x1279x1210.JPEG"
    ]
  },
  {
    "text": "Which part of the liver stores vitamin A?",
    "choices": [
      {
        "id": 1,
        "text": "Ito cells"
      },
      {
        "id": 2,
        "text": "Hepatocytes"
      },
      {
        "id": 3,
        "text": "Endothelial cells"
      },
      {
        "id": 4,
        "text": "Kupffer cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 369\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Vitamin A</strong> is stored in the liver <strong>perisinusoidal stellate (Ito) cells </strong>as<strong>&nbsp;retinyl ester (retinol palmitate).</strong></p>\n<p><strong>Kupffer cells,</strong> also known as <strong>stellate macrophages</strong> and <strong>Kupffer-Borowicz cells;&nbsp;</strong>are specialized macrophages located in the liver that form part of the mononuclear phagocyte system. These are present, lining the walls of the sinusoids, not the perisinusoidal space (Space of Disse).</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '32 Digestion & Absorption';
        const quizFilename = '32-digestion-absorption-b4f9e4e6.html';
        let hierarchy = ["Marrow", "qBank", "Physiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>