<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anatomy Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Test Series Subject / 2023
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Thyroid masses move with swallowing because the thyroid gland is enclosed by which of the following fascia?",
    "choices": [
      {
        "id": 1,
        "text": "Carotid sheath"
      },
      {
        "id": 2,
        "text": "Investing layer of the deep cervical fascia"
      },
      {
        "id": 3,
        "text": "Pre-tracheal fascia"
      },
      {
        "id": 4,
        "text": "Prevertebral fascia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Thyroid masses</strong><strong>\u00a0</strong>moves with<strong> swallowing</strong> because the thyroid gland is enclosed by the <strong>pre-tracheal fascia.</strong></p>\n<p><strong>Pre-tracheal fascia</strong> encloses the thyroid gland to form its <strong>false capsule</strong>.\u00a0Pretracheal fascia is attached to the larynx and this attachment is responsible for the\u00a0<strong>movement</strong>\u00a0of the enlarged\u00a0<strong>thyroid gland</strong>\u00a0on\u00a0<strong>deglutition.</strong></p>\n<p>The\u00a0<strong>ligament of Berry</strong>,\u00a0also called the suspensory ligament extends from the cricoid cartilage to the thyroid. It is formed by the condensation of the pre-tracheal fascia. Its attachment\u00a0<strong>prevents</strong>\u00a0the thyroid gland from\u00a0<strong>sinking</strong>\u00a0down\u00a0<strong>into</strong>\u00a0the\u00a0<strong>mediastinum.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man presents to the casualty after a stab injury to the back and the muscles marked below are injured. What is the prime action of these muscles?",
    "choices": [
      {
        "id": 1,
        "text": "Retraction of the scapula"
      },
      {
        "id": 2,
        "text": "Protraction of the scapula"
      },
      {
        "id": 3,
        "text": "Elevation of the scapula"
      },
      {
        "id": 4,
        "text": "Depression of the scapula"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The muscles marked in the above image are <strong>rhomboids minor </strong>and<strong> major.&nbsp;</strong>These muscles cause <strong>retraction of the scapula.</strong></p>\n<p><strong>Rhomboids minor </strong>and<strong> major&nbsp;</strong>are innervated by the&nbsp;<strong>dorsal scapular nerve. </strong>They are supplied by the<strong> dorsal scapular artery</strong> or the deep branch of the transverse cervical artery.</p>\n<p>Muscles involved in movements of the scapula are:</p>\n<ul>\n<li>Protraction (forward movement): Serratus anterior and pectoralis minor are prime movers. Rhomboid muscles control the rate and range of movements. The upper part of the latissimus dorsi&nbsp;acts like a strap across the inferior scapular angle in protraction.</li>\n<li><strong>Retraction</strong> (backward movement): Middle trapezius and <strong>rhomboids</strong>.</li>\n<li>Elevation: Trapezius, Levator scapulae.</li>\n<li>Depression: Usually gravity alone is sufficient for the depression of the scapula. When required, a part of the serratus anterior, pectoralis minor, and trapezius are used.\n<div class=\"page\" title=\"Page 1113\">&nbsp;</div>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/de262fdb7131424894d227b46dbbf5bb.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1cc7962a39374d419793ce26976b0c05x1280x1652.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58f389b94a1446b98f4aee71a0e048c8x800x509.PNG"
    ]
  },
  {
    "text": "All of the following are true about the phrenic nerve except that :",
    "choices": [
      {
        "id": 1,
        "text": "It is a purely motor nerve"
      },
      {
        "id": 2,
        "text": "It arises mainly from C4 spinal nerve"
      },
      {
        "id": 3,
        "text": "It is formed at the lateral border of scalenus anterior"
      },
      {
        "id": 4,
        "text": "The\u00a0right phrenic nerve\u00a0passes through the\u00a0vena caval opening"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>All of the following are true about the phrenic nerve except option A as it is a <strong>mixed nerve</strong> (sensory and motor nerve).</p>\n<p>Each phrenic nerve provides the sole<strong>\u00a0motor supply </strong>to its <strong>hemidiaphragm</strong>.\u00a0In its thoracic course, each phrenic nerve supplies\u00a0<strong>sensory</strong>\u00a0branches to the\u00a0<strong>mediastinal pleura, fibrous pericardium, </strong>and<strong> parietal serous pericardium</strong>.</p>\n<p>The phrenic nerve is a\u00a0mixed nerve derived mostly from the\u00a0<strong>C4 ramus</strong>\u00a0and also receives contributions from the\u00a0<strong>C3 and C5\u00a0</strong>ventral rami.</p>\n<p>It is formed at the lateral border of the <strong>scalenus anterior</strong>. At the root of the neck, the right phrenic nerve runs anterior to the second part of the\u00a0<strong>right subclavian artery</strong>\u00a0from which it is separated by\u00a0<strong>scalenus anterior</strong>\u00a0muscle. The phrenic nerve lies posterior to the right\u00a0<strong>subclavian vein</strong>.</p>\n<p>The right phrenic nerve is<strong>\u00a0shorter</strong>\u00a0and more vertical than the left. The\u00a0<strong>right phrenic nerve</strong>\u00a0passes through the\u00a0<strong>vena caval opening.</strong>\u00a0The\u00a0<strong>left phrenic nerve</strong>\u00a0passes\u00a0through the\u00a0<strong>muscular part\u00a0</strong>of the diaphragm just<strong>\u00a0anterior to\u00a0</strong>the\u00a0<strong>central tendon.</strong></p>\n<p>The phrenic nerve is responsible for the\u00a0<strong>referred pain\u00a0</strong>which\u00a0usually occurs when there is <strong>inflammation</strong> of the <strong>diaphragmatic pleura</strong>, e.g. in basal pneumonia, pleural effusions, or with irritation of the peritoneal pleura, as with a subphrenic abscess. It\u00a0is frequently felt at the\u00a0<strong>tip</strong>\u00a0of the\u00a0<strong>shoulder</strong>\u00a0due to the common root of origin of the phrenic nerve and the nerves supplying the shoulder.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6bf266f056ac49c4b58cf374045c07a4x1280x1994.JPEG"
    ]
  },
  {
    "text": "During routine dissection classes, you and your friend are discussing the cadaveric specimen of the inferior surface of the liver. Which of the following lobe is referred to as segment I?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The lobe marked as <strong>'3'</strong>\u00a0in the above image represents the\u00a0<strong>caudate lobe</strong> which is referred to as<strong>\u00a0segment I</strong>.</p>\n<p><strong>Couinaud's segmental</strong> division of the liver is the functional division based on the <strong>portal venous branches</strong> in the parenchyma. They are divided into 8 functional segments. The <strong>caudate lobe</strong> corresponds to\u00a0<strong>segment I</strong>\u00a0of Couinaud's segments.</p>\n<p>The <strong>caudate lobe</strong> of the liver has a portal blood supply and hepatic vein drainage independent of the remainder of the liver and also forms the superior boundary of the epiploic foramen.\u00a0</p>\n<p>The caudate lobe is visible as prominent on the inferior and posterior surfaces of the liver. It lies posterior to the porta hepatis and to its right is the groove for the inferior vena cava.</p>\n<p>Other markings:</p>\n<p>1-Quadrate lobe</p>\n<p>2-Right lobe</p>\n<p>4-Left Lobe</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bc703dadd9854b2084a9aaac97c40b28.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3158fbf2a10e4cc29e42f712d029e90ex960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/437f15c9e0b04e1591436d4748ee2b92x1279x1132.JPEG"
    ]
  },
  {
    "text": "A 30-year-old man with a history of blunt trauma to the pelvis was diagnosed with urethral rupture. Imaging revealed extravasation of the urine into the superficial perineal pouch. The attachment of which \u200bof the following fascia prevents extravasation into the thigh and anal triangle?",
    "choices": [
      {
        "id": 1,
        "text": "Fatty layer of Camper"
      },
      {
        "id": 2,
        "text": "Membranous layer of Scarpa"
      },
      {
        "id": 3,
        "text": "Buck's fascia"
      },
      {
        "id": 4,
        "text": "Colle's fascia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Colle's&nbsp;</strong><strong>fascia</strong>&nbsp;prevents the extravasation of the urine from spreading into the thigh and anal triangle.&nbsp;</p>\n<p>Scarpa's fascia is continuous with the <strong>superficial fascia</strong> of the <strong>scrotum&nbsp;</strong>and becomes&nbsp;the Colles' fascia. In women, it continues into the labia majora and is <strong>continuous</strong> with the <strong>fascia</strong> of the <strong>perineum.&nbsp;</strong>Colle's fascia has the following <strong>attachments</strong>:</p>\n<ul>\n<li>Posterior -&nbsp;<strong>perineal membrane.</strong>&nbsp;It prevents the extravasation of fluids such as blood, pus, or urine into the anal triangle.&nbsp;</li>\n<li>Lateral -&nbsp;<strong>ischiopubic</strong> <strong>rami</strong>&nbsp;and<strong> fascia lata</strong>&nbsp;along&nbsp;<strong>Holden's line. </strong>This line extends from the pubic tubercle laterally for 8 cm. It prevents the extravasation of fluids into the thigh.&nbsp;</li>\n</ul>\n<p>Option A: Camper's fascia is the superficial fatty layer of the superficial fascia of the abdomen.</p>\n<p>Option B: Scarpa's fascia is the deep membranous layer of the superficial fascia of the abdomen.</p>\n<p>Option C: Buck's fascia is the deep fascia of the penis&nbsp;</p>\n<p><strong>Clinical significance:</strong></p>\n<p>When a urethral injury occurs, urine can extravasate into the superficial perineal pouch, penis, scrotum, labia majora and the anterior abdominal wall.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a89e957c868f466f97b3198f1ab132fcx1280x1244.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0624861ecd0e41df8f38903183694536x600x759.JPEG"
    ]
  },
  {
    "text": "A patient is not able to perform the test shown in the image given below. Which of the following nerves could be injured?",
    "choices": [
      {
        "id": 1,
        "text": "Median nerve"
      },
      {
        "id": 2,
        "text": "Ulnar nerve"
      },
      {
        "id": 3,
        "text": "Radial nerve"
      },
      {
        "id": 4,
        "text": "Axillary nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The picture shows the&nbsp;<strong>card test</strong>,<strong>&nbsp;</strong>which tests&nbsp;<strong>adduction</strong> by <strong>palmar interossei</strong>. The <strong>ulnar nerve&nbsp;</strong>could be injured in this patient who is not able to perform the test.</p>\n<p>In the card test,&nbsp;Examiner inserts a card between two extended fingers of the patient. He asks to hold it tightly as possible while he tries to pull the card back. Due to loss of adduction by&nbsp;<strong>palmar interossei</strong>&nbsp;muscles patient is unable to hold a card between the fingers.&nbsp;This test is used for detecting ulnar nerve injury.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d77e47326a9a4328beaf1e6a57d337cd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/32eba128b32647d2bdd0d65eb986793ex1280x1335.JPEG"
    ]
  },
  {
    "text": "What condition is depicted by the subcutaneous venous circulation shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Superior vena caval obstruction"
      },
      {
        "id": 2,
        "text": "Inferior vena caval obstruction"
      },
      {
        "id": 3,
        "text": "Portal hypertension"
      },
      {
        "id": 4,
        "text": "Splenic vein thrombosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with the <strong>upward</strong> flow of subcutaneous venous circulation can be seen in <strong>inferior vena cava obstruction</strong>.</p>\n<p>The level of the umbilicus is a watershed area for venous and lymphatic circulation. The systemic veins anastomose with tributaries of portal veins at the umbilicus.\u00a0Normally, venous blood and lymphatics flow upwards above the plane of the umbilicus\u00a0and downwards below this plane.\u00a0</p>\n<ul>\n<li>In <strong>inferior vena cava obstruction</strong>, the blood flow in the veins of the anterior abdominal wall is completely <strong>upward</strong>.</li>\n<li>In <strong>superior vena cava obstruction</strong>, the blood flow in the veins of the anterior abdominal veins is completely <strong>downward</strong>.</li>\n<li>In <strong>portal hypertension</strong> with dilated abdominal veins, the blood flow is away from the umbilicus, <strong>radiating</strong> like a star from the umbilicus (<strong>caput-medusae</strong>).</li>\n</ul>\n<p>Causes of superior and inferior vena caval obstruction:</p>\n<table style=\"height: 365px; width: 299px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 126.195px; height: 36px;\"><strong>Causes of SVC obstruction</strong></td>\n<td style=\"width: 156.805px; height: 36px;\"><strong>Causes of IVC obstruction\u00a0</strong></td>\n</tr>\n<tr style=\"height: 286.125px;\">\n<td style=\"width: 126.195px; height: 286.125px;\">\n<p>\u00a0</p>\n<p>1. Mediastinal malignancy</p>\n<p>2. Mediastinal fibrosis</p>\n<p>3. Retrosternal thyroid</p>\n<p>4. Aortic aneurysm</p>\n<p>5. Radiation fibrosis</p>\n<p>6. Iatrogenic</p>\n</td>\n<td style=\"width: 156.805px; height: 286.125px;\">\n<ol>\n<li>\u00a0Thrombosis extension</li>\n<li>\u00a0Tumor invasion</li>\n<li>\u00a0Extrinsic compression (Eg: Pregnancy, abdominal mass)</li>\n<li>Coagulopathy</li>\n<li>Sepsis, dehydration, immobility</li>\n<li>Iatrogenic</li>\n</ol>\n</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 2670\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Splenic vein thrombosis</strong>\u00a0is one of the prehepatic causes of <strong>portal hypertension</strong>, in which the portal venous system is affected before it enters the liver.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b99748576f98423fa1f51f0c59e4958d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e461e30ebc8942458847f1e52080ee30x1280x4833.JPEG"
    ]
  },
  {
    "text": "A patient presents with complaints of severe pain in her buttocks. The muscle marked in the image below is suspected to be inflamed. Which of the following nerves is likely to be involved due to its inflammation?",
    "choices": [
      {
        "id": 1,
        "text": "Obturator nerve"
      },
      {
        "id": 2,
        "text": "Sciatic nerve"
      },
      {
        "id": 3,
        "text": "Superior gluteal nerve"
      },
      {
        "id": 4,
        "text": "Inferior gluteal nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The muscle marked in the image is the <strong>piriformis</strong> and the clinical features are suggestive of <strong>piriformis syndrome. </strong>This occurs due to the entrapment of the <strong>sciatic nerve.</strong></p>\n<p><strong>Piriformis syndrome\u00a0</strong>is a clinical condition characterized by the\u00a0<strong>compression </strong>of the <strong>sciatic nerve</strong>\u00a0by the piriformis muscle. This can occur due to inflammation of the piriformis muscle. The patient will present with\u00a0<strong>pain along the distribution</strong>\u00a0of the sciatic nerve which is also known as\u00a0<strong>sciatica</strong>. It is triggered by sitting for a long time or running, climbing stairs, or applying firm pressure directly over the <strong>piriformis muscle. </strong></p>\n<p>Early signs include <strong>pain, tingling,</strong> or <strong>numbness</strong> in the <strong>buttocks.</strong> Later it may lead to severe pain extending down the length of the sciatic nerve.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8344257823f8414db1bae204dc2a154e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ac21c8967e7c4dab8e85784c415b71e0x258x400.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6dde33bcb25d4d0c9d4e37bb7b555270x960x720.JPEG"
    ]
  },
  {
    "text": "A 12-year-old presented with fever and difficulty swallowing. He had swelling in the marked region and was advised to undergo surgery. Post-surgery the gauze continued to soak with blood. Which of the following vessels must have been injured?",
    "choices": [
      {
        "id": 1,
        "text": "Tonsillar branch of facial artery"
      },
      {
        "id": 2,
        "text": "Ascending pharyngeal artery"
      },
      {
        "id": 3,
        "text": "Paratonsillar vein"
      },
      {
        "id": 4,
        "text": "Retromandibular vein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image is a cadaveric specimen with the arrow pointing towards, <strong>the tonsillar fossa,&nbsp;</strong>and the&nbsp;given clinical vignette is suggestive of&nbsp;<strong>tonsillitis. Post tonsillectomy hemorrhage </strong>is&nbsp;commonly venous in origin, from the<strong> paratonsillar/ external palatine vein.&nbsp;</strong></p>\n<p><strong>Torrential hemorrhage</strong>&nbsp;can be due&nbsp;<strong>to injury to an aberrantly large or aberrantly placed tonsillar arterial branch of the facial artery.</strong></p>\n<p>Blood supply of the tonsils:&nbsp;</p>\n<p><strong>Arterial supply:</strong></p>\n<ul>\n<li>The tonsillar branch of the facial artery is the main supply.</li>\n<li>Ascending palatine branch of the facial artery.</li>\n<li>Ascending pharyngeal branch of the external carotid artery.</li>\n<li>Dorsal lingual branches of the lingual artery.</li>\n<li>Descending palatine branches of the maxillary artery.</li>\n</ul>\n<p><strong>Venous supply:</strong></p>\n<ul>\n<li>Veins from the tonsils drain into&nbsp;paratonsillar&nbsp;vein which joins the common facial vein and pharyngeal venous plexus.</li>\n</ul>\n<p>Types of Hemorrhage seen during/post tonsillectomy:</p>\n<ul>\n<li><strong>Primary</strong>&nbsp;hemorrhage:\n<ul>\n<li>Occurs&nbsp;<strong>during surgery</strong>&nbsp;due to injury to blood vessels.</li>\n<li>Can be controlled by&nbsp;<strong>pressure, ligation, or electrocoagulation of the bleeding vessels</strong>.</li>\n</ul>\n</li>\n<li><strong>Reactionary</strong>&nbsp;hemorrhage:\n<ul>\n<li>It occurs&nbsp;<strong>within 24 hours of surgery</strong>.</li>\n<li>It may be due to&nbsp;<strong>dislodgement of the clot, slippage of ligature, or return of blood pressure to normal</strong>.</li>\n<li>It is managed by&nbsp;<strong>removal of clot and application of pressure or vasoconstrictor</strong>.</li>\n<li>If not controlled the patient is<strong>&nbsp;anesthetized</strong>&nbsp;and hemorrhage is&nbsp;<strong>managed by re-exploration</strong>.</li>\n</ul>\n</li>\n<li><strong>Secondary</strong>&nbsp;hemorrhage:\n<ul>\n<li>It occurs between&nbsp;<strong>24 hours to 10 days</strong>&nbsp;(most common between&nbsp;<strong>5<sup>th</sup>&nbsp;to 8<sup>th</sup>&nbsp;postoperative days</strong>).</li>\n<li>It is due to&nbsp;<strong>sepsis and premature separation</strong>&nbsp;of the membrane.</li>\n<li>The patient is started on&nbsp;<strong>IV antibiotics</strong>&nbsp;and if not controlled, general&nbsp;anesthesia&nbsp;is given and the bleeding vessel is&nbsp;electrocoagulated&nbsp;or&nbsp;ligated.</li>\n</ul>\n</li>\n</ul>\n<p>The images below summarize the blood supply to the tonsils and the relations of the tonsillar bed respectively.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ef7fbd05fa6d47c7b3bee856e68fa828.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd7ab43678bb417a97aea5649ecc2d24x1279x1290.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b4f1127bac0a459d94ff04e87868780bx1279x1929.JPEG"
    ]
  },
  {
    "text": "Which of the following structures does not pass through the foramen marked with the black arrow in the image given below?",
    "choices": [
      {
        "id": 1,
        "text": "Emissary veins"
      },
      {
        "id": 2,
        "text": "Middle meningeal artery"
      },
      {
        "id": 3,
        "text": "Lesser petrosal nerve"
      },
      {
        "id": 4,
        "text": "Accessory meningeal artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The foramen marked in the image is the <strong>foramen</strong> <strong>ovale</strong>. The <strong>middle meningeal artery</strong> does not pass through the foramen ovale. It passes through the <strong>foramen spinosum</strong>.</p>\n<p>The structures passing through the foramen ovale are:</p>\n<ul>\n<li><strong>Mandibular division </strong>of the<strong> trigeminal nerve</strong>&nbsp;</li>\n<li><strong>A</strong>ccessory meningeal artery</li>\n<li><strong>L</strong>esser petrosal nerve</li>\n<li><strong>E</strong>missary veins&nbsp;</li>\n</ul>\n<p>These structures can be remembered using the mnemonic 'MALE'. &nbsp;&nbsp;</p>\n<p>The structures passing through the<strong> foramen spinosum</strong> are:</p>\n<ul>\n<li>Middle meningeal artery</li>\n<li>Nervus spinosus (meningeal branch of mandibular nerve)</li>\n<li>Middle meningeal vein</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/095d9eb710234fd58486755251067462.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2b7083ef012475d9aebef2d54f11f8cx1280x1198.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17218674842e4fa39be51de087788127x1279x1439.JPEG"
    ]
  },
  {
    "text": "The papillae which lie bilaterally at the sides of the tongue near the sulcus terminalis are:",
    "choices": [
      {
        "id": 1,
        "text": "Filiform papillae"
      },
      {
        "id": 2,
        "text": "Fungiform papillae"
      },
      {
        "id": 3,
        "text": "Foliate papillae"
      },
      {
        "id": 4,
        "text": "Circumvallate papillae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The papillae which lie bilaterally at the sides of the tongue near the sulcus terminalis are <strong>foliate papillae</strong>.</p>\n<p>Location of papillae in the tongue:</p>\n<ul>\n<li><strong>Filiform papillae</strong>: They are minute cylindrical or conical projections that are mainly present on the <strong>dorsal part of anterior 2/3rd</strong> of the tongue.</li>\n<li><strong>Fungiform papillae</strong>: They are large, rounded and red in colour and are mainly present on the <strong>lingual margins</strong> and also on the dorsal surface of the tongue.</li>\n<li><strong>Foliate papillae</strong>: They red, <strong>leaf-like</strong> mucosal ridges which are present bilaterally in two zones at the <strong>sides of the tongue&nbsp;</strong>near the sulcus terminalis.</li>\n<li><strong>Circumvallate papillae</strong>: They are large cylindrical structures which are around 8-12 in number. They are arranged in <strong>V-shaped</strong> row immediately <strong>in front of the sulcus terminalis</strong> ( not on the sides of the tongue )<strong>.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7e1a4921c63948bd88f951853df6b0c9x1280x1471.JPEG"
    ]
  },
  {
    "text": "Which of the following are branches of the anterior division of the internal iliac artery?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 5"
      },
      {
        "id": 2,
        "text": "2, 3, 4, 6"
      },
      {
        "id": 3,
        "text": "2, 3, 4, 5, 6"
      },
      {
        "id": 4,
        "text": "1, 4, 5, 6"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The branches from the anterior division include <strong>2, 3, 4, 5, 6.\u00a0</strong></p>\n<p>The internal iliac artery is the major artery of the pelvis. At the superior border of the greater sciatic foramen in the pelvis, it divides into anterior and posterior trunks.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/904913e2f83e4e95be719092e4a79a0dx795x599.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2dbdc4d411e54e38a8a7663dc7c93698x1280x1051.JPEG"
    ]
  },
  {
    "text": "A 35-year-old woman with immune thrombocytopenic purpura is undergoing elective splenectomy. During the procedure, injury to which of the following ligaments can lead to a complication of pancreatitis?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrosplenic ligament"
      },
      {
        "id": 2,
        "text": "Splenocolic ligament"
      },
      {
        "id": 3,
        "text": "Splenorenal ligament"
      },
      {
        "id": 4,
        "text": "Splenophrenic ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Injury to the <strong>splenorenal ligament\u00a0</strong>during splenectomy can lead to pancreatitis as it contains the <strong>tail of pancreas. </strong>Other complications include <strong>bleeding</strong> and <strong>pancreatic fistula</strong> formation<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a57d6a911974d4fa1af0f5d46b80d39x1280x1550.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/837fd93282b149eca5d99c5d23bbed47x1280x1609.JPEG"
    ]
  },
  {
    "text": "A 62-year-old woman presents with sudden onset dysarthria and impaired sensation over the right side of her face. Further examination shows loss of pain and temperature on the left side of the body. When asked to walk in a straight line, she sways to the right side. Which of the following marked vessels is most likely to be involved?",
    "choices": [
      {
        "id": 1,
        "text": "2"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>lateral medullary syndrome/</strong><strong>Wallenberg syndrome.\u00a0</strong>This may result from a stroke affecting the ipsilateral (right-sided, in this case)\u00a0<strong>vertebral artery\u00a0</strong>marked as\u00a0<strong>'4'</strong> in the image above.</p>\n<p><strong>Lateral medullary syndrome</strong>: The clinical findings<strong>\u00a0</strong>correspond to the neuroanatomical structures affected in the lateral portion of the medulla:</p>\n<ul>\n<li><strong>Descending tract and nucleus of CN V (trigeminal)</strong>- loss of pain and sensation over the ipsilateral half of face.</li>\n<li><strong>Inferior cerebellar peduncle</strong> \u2013 ipsilateral ataxia (gait and limb)</li>\n<li><strong>Lateral spinothalamic tract</strong> \u2013 loss of pain and temperature sensation over the contralateral half of the body.\u00a0</li>\n<li><strong>IX and X CN</strong> - ipsilateral paralysis of palate, vocal cord, diminished gag reflex giving rise to\u00a0<strong>dysphagia, dysarthria.</strong></li>\n<li>Vestibular nucleus<strong> - </strong>Nystagmus, diplopia, vertigo, nausea</li>\n<li>Descending sympathetic tract\u00a0\u2013 ipsilateral Horner\u2019s syndrome (miosis, ptosis, and anhidrosis).</li>\n</ul>\n<p>The lateral medullary syndrome may also occur as a consequence of the posterior inferior cerebellar artery (PICA) stroke. PICA is a branch of the vertebral artery.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/14e05e88d8f947a1b56814096919a66c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fffffee58ae8410e9bea807bf29b9dd6x1280x1657.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8d8733d66c3445b8585b20089f0add3x1280x1930.JPEG"
    ]
  },
  {
    "text": "The diaphragmatic surface of the heart is shown below. Identify the structures marked X and Y.",
    "choices": [
      {
        "id": 1,
        "text": "Posterior interventricular artery and middle cardiac vein"
      },
      {
        "id": 2,
        "text": "Posterior interventricular artery and small cardiac vein"
      },
      {
        "id": 3,
        "text": "Right coronary artery and middle cardiac vein"
      },
      {
        "id": 4,
        "text": "Left coronary artery and small cardiac vein"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The structure marked X is the <strong>posterior interventricular artery</strong> and the structure marked Y is the <strong>middle cardiac vein </strong>which can be identified as it drains into the<strong> coronary sinus</strong>. Both these structures lie in the <strong>posterior interventricular sulcus</strong>.</p>\n<p><strong>Tributaries of coronary sinus</strong>&nbsp;include the following:</p>\n<ul>\n<li>Great cardiac vein</li>\n<li>Middle cardiac vein</li>\n<li>Small cardiac vein</li>\n<li>Posterior vein of the left ventricle</li>\n<li>Oblique vein(of&nbsp;<strong>Marshall</strong>) of the left atrium&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d5e7752e18f84028a1e1d3093e7a0cae.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a0ac0b67cc12415d8a6d323efd2e8dadx1280x2059.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a3503dc08ab4538a6eacf108e8d71f2x1280x1750.JPEG"
    ]
  },
  {
    "text": "A specimen of the posterior surface of the larynx is kept in an anatomy practical exam and a structure is marked with red. What would be the action of the structure?",
    "choices": [
      {
        "id": 1,
        "text": "Adducts the vocal cords"
      },
      {
        "id": 2,
        "text": "Abducts the vocal cords"
      },
      {
        "id": 3,
        "text": "Tenses the vocal cords"
      },
      {
        "id": 4,
        "text": "Relaxes the vocal cords"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows the posterior view of the larynx and the marked muscle is&nbsp;the <strong>posterior cricoarytenoid</strong>.&nbsp;Its action is to <strong>abduct the vocal cords</strong> and <strong>open</strong> the glottis. The <strong>posterior cricoarytenoid muscle </strong>is identified by<strong>&nbsp;</strong>its origin from the <strong>posterior surface</strong> of the cricoid<strong>.</strong>&nbsp;</p>\n<p>The posterior cricoarytenoid muscle <strong>arises </strong>from the <strong>posterior surface of the cricoid lamina</strong> and is attached to the upper and posterior surfaces of the muscular processes of the ipsilateral arytenoids. It is innervated by a branch of the<strong> recurrent laryngeal nerve</strong>. They are <strong>active </strong>in the production of <strong>unvoiced sounds.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/240eb50360b84fceba5b7c2ff5a5b7dc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/648d8cf164504713b8fb9a45b04b96b1x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/887d5473925944c8b2515b313b2a572cx363x500.PNG"
    ]
  },
  {
    "text": "An elderly man with atherosclerosis presented with abdominal pain and blood-stained stools.  CECT abdomen is suggestive of ischemic colitis at the splenic flexure involving the marginal artery of Drummond. What are the arteries contributing to the formation of this structure?",
    "choices": [
      {
        "id": 1,
        "text": "Right colic and left colic arteries"
      },
      {
        "id": 2,
        "text": "Ileocolic and left colic arteries"
      },
      {
        "id": 3,
        "text": "Left colic and middle colic arteries"
      },
      {
        "id": 4,
        "text": "Left colic and sigmoid arteries"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> middle </strong>and<strong> left colic arteries</strong>\u00a0contribute to the formation of the <strong>marginal artery </strong>of<strong> Drummond </strong>at the splenic flexure.\u00a0The<strong> splenic flexure (Griffith's point) </strong>is a<strong> watershed area </strong>of the colon which is more prone to<strong> ischemia.\u00a0</strong></p>\n<p>The anastomotic vessel that runs in the mesentery along the inner margin of the colon is called the marginal artery of Drummond. From this artery, numerous small branches are given to the large bowel. It is formed by:</p>\n<ul>\n<li>Branches of <strong>superior mesenteric artery - </strong>middle colic, right colic, and ileocolic arteries</li>\n<li>Branches of <strong>inferior mesenteric artery - </strong>left colic, sigmoid, and superior rectal arteries</li>\n</ul>\n<p>When ischemia occurs at Griffith's point, the blood supply in this region is augmented by another arterial loop called the <strong>inner arterial arc (of Riolan).</strong> This arc connects the main trunk of the <strong>middle colic artery</strong> with the ascending branch of the<strong> left colic artery</strong>.</p>\n<p>Note: <strong>Sudeck's point</strong> is another watershed area present at the <strong>rectosigmoid junction</strong>. The <strong>sigmoid artery</strong> anastomoses with the <strong>superior rectal artery</strong> at this site.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e0e97a8c8aa3448a8c69bff4f49e06fex600x771.JPEG"
    ]
  },
  {
    "text": "Arrange the following events of embryonal development during the second to the fourth week in the sequence in which they occur:",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 4, 5, 2"
      },
      {
        "id": 2,
        "text": "2, 1, 4, 3, 5"
      },
      {
        "id": 3,
        "text": "3, 2, 1, 5, 4"
      },
      {
        "id": 4,
        "text": "1, 3, 5, 2, 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct sequence in which the above events occur is <strong>3</strong>, <strong>2</strong>, <strong>1</strong>, <strong>5,</strong>&nbsp;<strong>4:</strong>&nbsp;Formation of the primitive streak, notochordal process, neural plate, notochordal plate, and finally, the notochordal plate separates from the endoderm to form the true notochord.</p>\n<p>The <strong>primitive streak</strong> is formed around day 15. This is followed by the formation of definitive endoderm and the formation of mesoderm.</p>\n<p>This mesoderm extends cranially to form the <strong>notochordal process</strong>&nbsp;around day 17<strong>.</strong>&nbsp;Meanwhile, the mesoderm present lateral to midline gets divided into paraxial, intermediate, and lateral plate mesoderm. The lateral plate mesoderm splits into two layers- somatic mesoderm and splanchnic mesoderm, separated by the intraembryonic coelom.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58d59b0162bb4080ab3209fa8a92b142x600x671.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a76dd42670254f2a9c0e5df150a36225x600x726.JPEG"
    ]
  },
  {
    "text": "A 42-year-old man presented with severe pain in the lower back radiating to the pubic symphysis. Ultrasonography revealed a stone in the left ureter, measuring 3 mm in size. The stone is most likely to be lodged in which of the following sites?",
    "choices": [
      {
        "id": 1,
        "text": "Pelvi-ureteric junction"
      },
      {
        "id": 2,
        "text": "At pelvic brim"
      },
      {
        "id": 3,
        "text": "Vesicoureteric junction"
      },
      {
        "id": 4,
        "text": "At vas deferens"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vesicoureteric junction</strong> is the <strong>narrowest</strong> part of the ureter.</p>\n<p>This is the reason why stones as small as 2 to 3 mm get arrested in the vesicoureteric junction.</p>\n<p>The ureter is<strong> constricted at 5 places:</strong></p>\n<ol>\n<li>At the pelvi-ureteric junction</li>\n<li>At the brim of the lesser pelvis (as it crosses the common iliac artery)</li>\n<li>At the site of crossing of the ureter by ductus deferens or broad ligament of the uterus.</li>\n<li>Vesico-ureteric junction</li>\n<li>At its opening in the lateral angle of the trigone</li>\n</ol>\n<p>These are regarded as <strong>surgical constrictions</strong> of the ureter. However, the <strong>anatomical constrictions</strong> are only three of them <strong>(1, 2, and 4).</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d874fe7b4e9b4f3494a1f18bc13f2b9fx1280x1761.JPEG"
    ]
  },
  {
    "text": "Sequence of structures at the right hilum from superior to inferior is:",
    "choices": [
      {
        "id": 1,
        "text": "Hyparterial bronchus, Pulmonary artery, Principal bronchus, Inferior pulmonary vein"
      },
      {
        "id": 2,
        "text": "Principal bronchus, Pulmonary artery, Hyparterial bronchus, Inferior pulmonary vein"
      },
      {
        "id": 3,
        "text": "Principal bronchus, Pulmonary artery, Eparterial bronchus, Inferior pulmonary vein"
      },
      {
        "id": 4,
        "text": "Eparterial bronchus, Pulmonary artery, Principal bronchus, Inferior pulmonary vein"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The sequence of structures at the<strong> right hilum from superior to inferior</strong> is:</p>\n<ul>\n<li>Superior lobar (Eparterial)<strong> b</strong>ronchus</li>\n<li>Pulmonary<strong> a</strong>rtery</li>\n<li>Principal (Hyparterial)<strong> b</strong>ronchus</li>\n<li>Inferior pulmonary <strong>v</strong>ein</li>\n</ul>\n<p>Mnemonic: <strong>BABV</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/10d68c9cbd58458b90c265cf77b4bbcbx1280x1541.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/345f5577fc52416c95ac0af31679093dx1280x1540.JPEG"
    ]
  },
  {
    "text": "During a neck dissection, a surgeon accidentally damages the hypoglossal nerve. Which neck triangle is likely being dissected?",
    "choices": [
      {
        "id": 1,
        "text": "Muscular triangle"
      },
      {
        "id": 2,
        "text": "Carotid triangle"
      },
      {
        "id": 3,
        "text": "Posterior triangle"
      },
      {
        "id": 4,
        "text": "Submental triangle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The surgeon has accidentally injured the hypoglossal nerve, which has its major course in the <strong>carotid triangle.</strong></p>\n<p>The hypoglossal nerve leaves the skull through the hypoglossal canal. It then descends to the carotid triangle. Here, in the carotid triangle, the nerve makes a loop lateral to the internal and external carotid arteries. The nerve then ascends to the digastric triangle, reaches further up supplying the muscles of the tongue.</p>\n<p>Contents of the carotid triangle:</p>\n<ul>\n<li>Common carotid artery, internal and external carotid artery</li>\n<li>Branches of external carotid \u2013 superior thyroid, lingual, facial, ascending pharyngeal, and occipital artery</li>\n<li>Internal jugular vein</li>\n<li>Vagus nerve</li>\n<li>Hypoglossal nerve</li>\n<li>Spinal part of the accessory</li>\n<li>Sympathetic chain</li>\n<li>Ansa cervicalis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/389d40d36a1343419b112c71176642c0x1280x1274.JPEG"
    ]
  },
  {
    "text": "Identify the labelled structure",
    "choices": [
      {
        "id": 1,
        "text": "Globus pallidus"
      },
      {
        "id": 2,
        "text": "Internal capsule"
      },
      {
        "id": 3,
        "text": "Caudate nucleus"
      },
      {
        "id": 4,
        "text": "Thalamus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The labelled structure is the <strong>Internal capsule</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a62a211fc8284315a89c0b460dd29c64.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f67e2ff2a6c4714bd2e6569240e8a33x1279x1007.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a52fc7ff3d3d4aaf992a6ebdb58091abx1280x1625.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/996b630fb67e4378a0d6e58f6d128fa3x600x525.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cd4b94d17e914b21ba67dd0ce02f8c6dx567x424.JPEG"
    ]
  },
  {
    "text": "The talocalcaneonavicular joint is a ________type of joint.",
    "choices": [
      {
        "id": 1,
        "text": "Ball and Socket"
      },
      {
        "id": 2,
        "text": "Saddle type"
      },
      {
        "id": 3,
        "text": "Plane"
      },
      {
        "id": 4,
        "text": "Ellipsoid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The talocalcaneonavicular joint is a <strong>ball and socket joint</strong>.</p>\n<p>In ball and socket type of joints, the articular surfaces include a&nbsp;<strong>globular head</strong>&nbsp;fitting into a&nbsp;<strong>cup-shaped socket</strong>. These joints are&nbsp;<strong>multi-axial</strong>&nbsp;and movements occur around a number of axes. Flexion, extension, abduction, adduction, medial rotation, lateral rotation, and circumduction, all occur quite freely. E.g.,&nbsp;<strong>shoulder joint</strong>,&nbsp;<strong>hip joint</strong>,&nbsp;<strong>talocalcaneonavicular joint</strong>, and incudostapedial joint.</p>\n<p>In the talocalcaneonavicular joint, the&nbsp;<strong>ball</strong> part is formed by the&nbsp;<strong>rounded head </strong>of the <strong>talus</strong>. The <strong>socket</strong> is formed by 3 structures, the&nbsp;posterior surface of the <strong>navicular</strong>, the anterior articular surface of the<strong> calcaneus</strong>, and the upper surface of the<strong> plantar calcaneonavicular ligament (spring ligament)</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c619bb692f7f4fbfbb290efb5ad4c2a4x1280x848.JPEG"
    ]
  },
  {
    "text": "All of the following structures arise from Wolffian duct except:",
    "choices": [
      {
        "id": 1,
        "text": "Proximal part of prostatic urethra in males"
      },
      {
        "id": 2,
        "text": "Prostatic utricle in males"
      },
      {
        "id": 3,
        "text": "Posterior wall of urethra in females"
      },
      {
        "id": 4,
        "text": "Gartners duct in females"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Prostatic utricle</strong> in males arises from <strong>paramesonephric duct </strong>(or<strong>&nbsp;mullerian duct</strong>) and not from Wolffian duct.</p>\n<p>In males, under the influence of the anti-Mullerian hormone (AMH) produced by the&nbsp;Sertoli cells, the paramesonephric ducts degenerate and only&nbsp;<strong>two structures</strong>&nbsp;are derived from it:</p>\n<ul>\n<li><strong>Appendix of the testis</strong>&nbsp;</li>\n<li><strong>Prostatic utricle&nbsp;</strong></li>\n</ul>\n<p>Structures arising from mesonephric/Wolffian duct are:</p>\n<table style=\"height: 219px;\" border=\"1\" width=\"424\">\n<tbody>\n<tr>\n<td style=\"width: 226.648px;\">Males</td>\n<td style=\"width: 181.352px;\">Females</td>\n</tr>\n<tr>\n<td style=\"width: 226.648px;\">Ureteric bud and its derivatives</td>\n<td style=\"width: 181.352px;\">Ureteric bud and its derivatives</td>\n</tr>\n<tr>\n<td style=\"width: 226.648px;\">Trigone of bladder</td>\n<td style=\"width: 181.352px;\">Trigone of bladder</td>\n</tr>\n<tr>\n<td style=\"width: 226.648px;\"><strong>The proximal part of the prostatic urethra</strong></td>\n<td style=\"width: 181.352px;\"><strong>The posterior wall of the urethra</strong></td>\n</tr>\n<tr>\n<td style=\"width: 226.648px;\">Spermatic pathway</td>\n<td style=\"width: 181.352px;\"><strong>Gartner's duct</strong></td>\n</tr>\n<tr>\n<td style=\"width: 226.648px;\">Appendix of epididymis</td>\n<td style=\"width: 181.352px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/edaf9b8f53db443d99ebd81200690467x1280x1676.JPEG"
    ]
  },
  {
    "text": "A first-year medical student is doing a meticulous dissection of the thoracic cage in a human cadaver. During dissection, he sees an osseo-aponeurotic opening in the diaphragm transmitting a large vessel. Which among the following other structures can be seen passing through the same opening?",
    "choices": [
      {
        "id": 1,
        "text": "Left vagus nerve and thoracic duct"
      },
      {
        "id": 2,
        "text": "Right and left vagus nerve"
      },
      {
        "id": 3,
        "text": "Azygous vein and thoracic duct"
      },
      {
        "id": 4,
        "text": "Right vagus nerve and thoracic duct"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>osseo-aponeurotic</strong> opening in the diaphragm transmits the <strong>aorta</strong>. The other structures which pass through the same opening are the <strong>azygous vein</strong> and the <strong>thoracic duct.</strong>\u00a0</p>\n<p>It is the <strong>most posteroinferior</strong> of the three larger openings in the diaphragm and lies at the level of the\u00a0<strong>T12 vertebra</strong>. It is bounded laterally by the two diaphragmatic crura, the vertebral column posteriorly, and anteriorly by the median arcuate ligament.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/038aa315413f4368a8d011894711bda6x600x610.JPEG"
    ]
  },
  {
    "text": "You observe your senior perform the following reflex on a patient. What would be the root values of this reflex?",
    "choices": [
      {
        "id": 1,
        "text": "C5, C6"
      },
      {
        "id": 2,
        "text": "C6, C7"
      },
      {
        "id": 3,
        "text": "C8, T1"
      },
      {
        "id": 4,
        "text": "C8 only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The shown reflex is a <strong>biceps reflex,</strong>&nbsp;it<strong>&nbsp;</strong>is mediated <strong>by C5 and C6.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/97377619394e4de58ce53c080a72cacf.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A radiologist is performing an ultrasound of the parotid gland in a case of parotid abscess. Which of the following structures will he not visualize within the gland?",
    "choices": [
      {
        "id": 1,
        "text": "External carotid artery"
      },
      {
        "id": 2,
        "text": "Facial artery"
      },
      {
        "id": 3,
        "text": "Transverse facial artery"
      },
      {
        "id": 4,
        "text": "Retromandibular vein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>facial artery</strong> is <strong>not present</strong> within the parotid gland\u00a0</p>\n<p>The parotid gland contains:</p>\n<p><strong>Arteries:</strong></p>\n<ul>\n<li><strong>External carotid artery </strong>(Option A), which terminates into the maxillary artery and superficial temporal artery.</li>\n<li>The <strong>transverse facial artery </strong>(Option C)<strong>,</strong> which is a branch of the superficial temporal artery.</li>\n</ul>\n<p>Sometimes the external carotid artery may also give posterior auricular artery within the gland.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6e824f363e814025870f1ff827840f33x1280x1452.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe71f61a744a422099fd9a77be276d7fx1280x1452.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d4ffcb5845ea43c7a6f63cf5256a75c0x600x624.JPEG"
    ]
  },
  {
    "text": "Match the embryological origin with their derivatives.",
    "choices": [
      {
        "id": 1,
        "text": "a-3, b-2, c-5, d-4, e-1"
      },
      {
        "id": 2,
        "text": "a-1, b-2, c-3, d-4, e-5"
      },
      {
        "id": 3,
        "text": "a-3, b-2, c-5, d-1, e-4"
      },
      {
        "id": 4,
        "text": "a-3, b-5, c-2, d-1, e-4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>All the above structures are the embryological of the digestive system. The <strong>liver bud, ventral pancreatic bud</strong> and <strong>dorsal pancreatic bud</strong> arise from the <strong>foregut,</strong> <strong>ventral mesogastrium</strong> arises from the <strong>septum transversum</strong> and <strong>dorsal mesogastrium</strong> arises from the <strong>lateral plate mesoderm</strong>.&nbsp;</p>\n<p>Ventral and dorsal mesogastrium develop into the peritoneal connections in the abdomen which are together called <strong>ventral </strong>and<strong> dorsal mesentery.</strong>&nbsp;</p>\n<p>Liver is developed by the <strong>septum transversum</strong> and the <strong>hepatic bud</strong>.</p>\n<p>Ventral and dorsal pancreatic buds give rise to the pancreas and the pancreatic ducts. When the duodenum rotates to the right to form a &ldquo;C&rdquo; shape, the ventral pancreatic bud moves dorsally. It moves such that it comes to lie immediately below and behind the dorsal pancreatic bud. Later the parenchyma and the ducts of both the buds fuse. Development of pancreas is as shown in the below image.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e06758845b604602b1e7d782253e3ae0x1267x3635.JPEG"
    ]
  },
  {
    "text": "The type of cartilage shown in the image is found in:",
    "choices": [
      {
        "id": 1,
        "text": "2, 3, and 4 only"
      },
      {
        "id": 2,
        "text": "3, 4 and 5 only"
      },
      {
        "id": 3,
        "text": "1, 2, and 5 only"
      },
      {
        "id": 4,
        "text": "3 and 5 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct answer is&nbsp;<strong>3, 4 and 5 only.</strong></p>\n<p>The above image shows&nbsp;<strong>elastic</strong> <strong>cartilage</strong>. It is seen in corniculate&nbsp;cartilage, cuneiform&nbsp;cartilage and apices of arytenoids. The given section is stained by <strong>Verhoeff&rsquo;s</strong> method in which elastic fibres are stained <strong>bluish-black.</strong></p>\n<p>The elastic cartilage, like the hyaline cartilage, contains individual or small groups of chondrocytes that are surrounded by type II collagen fibrils. However, it differs from hyaline cartilage in that, much of the interterritorial <strong>matrix&nbsp;</strong>consists of <strong>fine yellow elastic fibres</strong>&nbsp;containing&nbsp;elastin protein and the surface of elastic cartilage is covered by <strong>perichondrium</strong>.</p>\n<p>On microscopy, elastic cartilage consists of:</p>\n<ul>\n<li><strong>Chondrocytes </strong>within lacunae</li>\n<li><strong>Elastic fibres</strong> in the matrix</li>\n<li><strong>Perichondrium</strong> with outer fibrous layer and the inner cellular layer</li>\n</ul>\n<p>Elastic cartilage is found in:</p>\n<ul>\n<li>External ear</li>\n<li>External auditory meatus</li>\n<li>Auditory tube</li>\n<li><strong>Corniculate cartilage</strong></li>\n<li><strong>Cuneiform&nbsp;cartilage</strong></li>\n<li>Epiglottis</li>\n<li><strong>Apices of arytenoids</strong></li>\n</ul>\n<p><strong>Thyroid cartilage</strong> and <strong>cricoid cartilage</strong> are composed of <strong>hyaline cartilage</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2354470d25c240de920f7e905f53599e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5464951e2e974727b1b3c0fecd60aa41x1200x2348.JPEG"
    ]
  },
  {
    "text": "An infant has a noticeable small mandible and cleft palate. A CT scan reveals hypoplasia of the mandible and a defect in the \u200bmiddle ear cavity and tympanic membrane. A developmental defect of which pharyngeal arch will result in these defects?",
    "choices": [
      {
        "id": 1,
        "text": "First pharyngeal arch"
      },
      {
        "id": 2,
        "text": "Second pharyngeal arch"
      },
      {
        "id": 3,
        "text": "Third pharyngeal arch"
      },
      {
        "id": 4,
        "text": "Fourth pharyngeal arch"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Agenesis of the first pharyngeal arch results in <strong>hypoplasia </strong>of the<strong> mandible</strong> and the <strong>middle ear ossicles</strong> (<strong>malleus and incus</strong>) causing conduction deafness.\u00a0</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Structures of the ear</strong></td>\n<td><strong>Embryological origin</strong></td>\n</tr>\n<tr>\n<td>Auricle/Pinna</td>\n<td>1st and 2nd pharyngeal arch</td>\n</tr>\n<tr>\n<td>External Auditory Canal</td>\n<td>1st pharyngeal cleft</td>\n</tr>\n<tr>\n<td>Tympanic membrane</td>\n<td>All 3 germ layers</td>\n</tr>\n<tr>\n<td>Malleus and incus</td>\n<td>1st pharyngeal arch</td>\n</tr>\n<tr>\n<td>Stapes suprastructure</td>\n<td>2nd pharyngeal arch</td>\n</tr>\n<tr>\n<td>Stapes footplate and annular ligament</td>\n<td>Otic capsule</td>\n</tr>\n<tr>\n<td>Tympanic cavity</td>\n<td>1st pharyngeal pouch</td>\n</tr>\n<tr>\n<td>Eustachian tube</td>\n<td>1st pharyngeal pouch</td>\n</tr>\n<tr>\n<td>Membranous labyrinth</td>\n<td>Otic vesicle</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Anatomy Test';
        const quizFilename = 'anatomy-test-4f2bdedd.html';
        let hierarchy = ["Marrow", "FMGE Test Series Subject", "2023"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>