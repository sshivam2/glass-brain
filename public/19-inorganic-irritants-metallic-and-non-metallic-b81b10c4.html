<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>19 Inorganic Irritants - Metallic And Non-Metallic - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Forensic Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following poison can be found even in skeletonized remains of the body?",
    "choices": [
      {
        "id": 1,
        "text": "Arsenic"
      },
      {
        "id": 2,
        "text": "Mercury"
      },
      {
        "id": 3,
        "text": "Thallium"
      },
      {
        "id": 4,
        "text": "Lead"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Arsenic</strong>\u00a0can be found even in <strong>skeletonized remains</strong> of the body. It\u00a0<strong>delays putrefaction</strong> and\u00a0can be found in bones, hair, and nails for several years.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">It becomes\u00a0<strong>fixed</strong>\u00a0in the cancellous tissues of the long\u00a0<strong>bones</strong>\u00a0by the\u00a0<strong>conversion</strong>\u00a0of\u00a0<strong>phosphates</strong>\u00a0to\u00a0<strong>arsenates</strong>.<strong>\u00a0</strong>The elimination of arsenic in this form is much slower and can be detected in the bones for several years after death.</p>\n<p><strong>Heavy metals</strong>\u00a0such as\u00a0<strong>lead</strong>,\u00a0<strong>copper</strong>,\u00a0<strong>mercury</strong>, including metalloids like\u00a0<strong>arsenic\u00a0</strong>and<strong>\u00a0antimony</strong>, may be found in bones for a prolonged period in cases of <strong>chronic poisoning</strong>. They are also deposited in hair, nails, etc. For these reasons, when heavy metal poisoning is suspected, these specimens are collected in addition to the routine viscera and body fluids.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most toxic form of arsenic?",
    "choices": [
      {
        "id": 1,
        "text": "Aceto arsenate"
      },
      {
        "id": 2,
        "text": "Arsine"
      },
      {
        "id": 3,
        "text": "Arsenite"
      },
      {
        "id": 4,
        "text": "Arsenic oxide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Arsine</strong> gas is the <strong>most toxic</strong> form of arsenic (acute exposure).</p>\n<p>The toxicity of arsenic compounds can vary greatly. In general, arsenic compounds can be ranked from highest to lowest toxicity:</p>\n<ul>\n<li><strong>Inorganic trivalent</strong> (+3) compounds</li>\n<li>Organic trivalent&nbsp;(+3) compounds</li>\n<li>Inorganic pentavalent&nbsp;(+5) compounds</li>\n<li>Organic pentavalent&nbsp;(+5) compounds</li>\n<li><strong>Elemental arsenic</strong></li>\n</ul>\n<p><strong>Inorganic</strong> arsenic is generally <strong>more toxic</strong> than organic arsenic. Forms of arsenic that are more rapidly absorbed are more toxic, while those most rapidly eliminated tend to be less toxic. Arsenite and arsenate forms are highly soluble in water.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A person presents to the emergency department with suspected poisoning due to ingestion of arsenic-containing pesticides 6 hours ago. Which of the following would you not expect to find?",
    "choices": [
      {
        "id": 1,
        "text": "Mees lines on nails"
      },
      {
        "id": 2,
        "text": "Cholera like gastroenteritis"
      },
      {
        "id": 3,
        "text": "Garlic odour of the breath"
      },
      {
        "id": 4,
        "text": "Acute tubular necrosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is indicative of <strong>acute arsenic poisoning</strong>. Mees lines are unlikely to be found in a patient with arsenic ingestion 6 hours ago. It is seen in chronic poisoning.&nbsp;</p>\n<p>Features of acute arsenic poisoning:</p>\n<ul>\n<li><strong>Severe watery diarrhea</strong> (like cholera)</li>\n<li><strong>QTc prolongation</strong> and cardiac arrhythmias</li>\n<li>Acute<strong> encephalopathy</strong></li>\n<li>Renal injury with <strong>acute tubular necrosis</strong></li>\n<li><strong>Garlic odor&nbsp;</strong>of breath and stools</li>\n</ul>\n<p><strong>Mees lines</strong>&nbsp;are horizontal 1 to 2 mm <strong>white lines</strong> on the nails, also called transverse leukonychia. They occur due to a disturbance in the nail matrix keratinization. It may be seen <strong>4 to 6 weeks</strong> after acute<strong> arsenic ingestion</strong>. These can also be seen in <strong>thallium poisoning.</strong></p>\n<p>The image given below shows Mees lines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f2c8fad32fa40dbb55d2faa6b616765x1158x990.JPEG"
    ]
  },
  {
    "text": "A woman was slowly poisoning her husband by adding arsenic to his food daily. Which of the following is unlikely to be seen in him?",
    "choices": [
      {
        "id": 1,
        "text": "Acrodynia"
      },
      {
        "id": 2,
        "text": "Hyperkeratosis of palms and soles"
      },
      {
        "id": 3,
        "text": "Blackfoot disease"
      },
      {
        "id": 4,
        "text": "Bowen disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Acrodynia</strong> (pink disease)<strong>&nbsp;</strong>is a feature of<strong> mercury poisoning</strong>, not arsenic poisoning.</p>\n<p>Features of <strong>chronic arsenic exposure</strong>:</p>\n<ul>\n<li>Skin lesions-\n<ul>\n<li>Hyperpigmentation (<strong>raindrop</strong> pigmentation resembling measles) or hypopigmentation</li>\n<li><strong>Hyperkeratosis </strong>of<strong> palms </strong>and <strong>soles</strong>.</li>\n<li>Nail changes (Mees lines)</li>\n<li>Skin carcinomas and <strong>Bowen disease</strong></li>\n<li>Peripheral vascular disease leading to&nbsp;<strong>Blackfoot disease </strong>(gangrene)</li>\n</ul>\n</li>\n<li>Neurologic manifestations -\n<ul>\n<li>Polyneuropathy</li>\n<li class=\"p1\">Painful paraesthesia of hands and feet</li>\n</ul>\n</li>\n<li>Cardiovascular - coronary heart disease and stroke</li>\n<li>Endocrine - Diabetes Mellitus type 2</li>\n</ul>\n<p>Note:&nbsp;Some people take arsenic daily as a tonic or as an aphrodisiac and they acquire tolerance to 250&ndash;300 mg or more in one dose. Such people are known as&nbsp;<strong>arsenophagists</strong>.</p>\n<p>The image below shows hyperkeratosis of palms.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2674f2e9124944efbf0af76f080a7e2cx320x261.JPEG"
    ]
  },
  {
    "text": "Arsenic poisoning can mimic all of the following except?",
    "choices": [
      {
        "id": 1,
        "text": "Addison's disease"
      },
      {
        "id": 2,
        "text": "Guillain-Barre syndrome"
      },
      {
        "id": 3,
        "text": "Diabetes insipidus"
      },
      {
        "id": 4,
        "text": "Korsakoff's syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Chronic</strong> low-dose <strong>arsenic exposure</strong> can <strong>mimic diabetes mellitus&nbsp;</strong>type 2 and not diabetes insipidus.</p>\n<p>Clinical features of chronic arsenic poisoning can resemble the following:</p>\n<ul>\n<li><strong>Addison's disease </strong>- due to hyperpigmentation on chronic exposure</li>\n<li><strong>Guillain-Barr&eacute; syndrome </strong>- sensorimotor peripheral neuropathy one to three weeks after the exposure</li>\n<li><strong>Korsakoff&rsquo;s syndrome</strong> - chronic encephalopathy with delirium, hallucinations, disorientation, agitation, and confabulation can occur in chronic exposure</li>\n<li><strong>Cholera like gastroenteritis </strong>- occurs in acute poisoning</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old man presented to the ER with severe dehydration and weakness. History was suggestive of multiple episodes of watery diarrhea and non-bilious vomiting since morning. His breath reeked of garlic odor. ECG showed QT prolongation.  Which of the following samples must be collected for a definitive diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "24 hour urine sample"
      },
      {
        "id": 2,
        "text": "Blood sample"
      },
      {
        "id": 3,
        "text": "Hair sample"
      },
      {
        "id": 4,
        "text": "Fingernail sample"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario points towards the diagnosis of <strong>acute arsenic poisoning. </strong>For a definitive diagnosis, the arsenic levels are measured in <strong>24-hour urine</strong> samples.</p>\n<p>If the baseline <strong>urinary</strong> level is within <strong>normal</strong> limits and arsenic intoxication is still suspected, <strong>hair</strong> and <strong>nail clippings</strong> should be harvested for laboratory analysis. Due to the rapid distribution of arsenic in tissues, <strong>blood arsenic </strong>levels are<strong> unreliable</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 43-year-old man working in the mining industry presents with painful paraesthesias of his hands and feet. Examination of the limbs reveals the following findings. Which of the following is the drug of choice for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Penicillamine"
      },
      {
        "id": 2,
        "text": "Succimer"
      },
      {
        "id": 3,
        "text": "Calcium disodium EDTA"
      },
      {
        "id": 4,
        "text": "Dimercaptopropane sulfonate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Note: Arsenic is used industrially as an alloying agent and in the processing of glass, pigments, textiles, paper, metal adhesives, wood preservatives and ammunition. Arsenic is also used in the hide tanning process and, to a limited extent, in pesticides, feed additives, and pharmaceuticals.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/000182ad1e0d4063830a5f2411385033.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/236c68077d024b1b92d7e04d3ab28a03x1280x1150.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e3a6fd2be94743f3af0f169e10683115x720x616.JPEG"
    ]
  },
  {
    "text": "A 23-year-old woman presents with complaints of tremors and ataxia. History is significant for regular exotic seafood intake. On examination, the following finding is noted. You are suspecting heavy metal poisoning. Which of the following explains the mechanism of the suspected poison?",
    "choices": [
      {
        "id": 1,
        "text": "Binding to sulfhydryl groups on enzymes"
      },
      {
        "id": 2,
        "text": "Inhibition of acetylcholinesterase"
      },
      {
        "id": 3,
        "text": "Facilitation of glutamatergic synapses"
      },
      {
        "id": 4,
        "text": "Inhibition of GABA-ergic synapses"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image <strong>(acrodynia)</strong> and the clinical features point towards a diagnosis of <strong>chronic organic mercury poisoning</strong> (methyl mercury). Mercury acts as a poison by binding to <strong>sulfhydryl</strong> groups on <strong>enzymes.</strong></p>\n<p>Mechanisms of toxicity of mercury:</p>\n<ul>\n<li>High-affinity binding of divalent<strong> mercury</strong> to sulfhydryl groups of <strong>proteins</strong> in the cells is an important mechanism for producing nonspecific cell injury or even cell death.</li>\n<li class=\"p1\">Both inorganic and methylmercury <strong>damage mitochondria</strong> and disrupt intracellular calcium homeostasis</li>\n<li class=\"p1\">Methylmercury also <strong>affects</strong> the <strong>MAPK</strong> signaling <strong>pathway</strong></li>\n<li class=\"p1\">Methylmercury has also been shown to <strong>disrupt microtubules</strong> in neurites</li>\n</ul>\n<p><strong>Orofacial paresthesias</strong> is the <strong>initial</strong> common <strong>symptom</strong> of chronic mercury poisoning followed by headache, tremor, and fatigue. Other features include mild GI, renal, and pulmonary abnormalities.</p>\n<p>In severe cases, the following features are seen:</p>\n<ul>\n<li>Ataxia</li>\n<li>Muscle rigidity and spasticity</li>\n<li>Blindness</li>\n<li>Hearing deficits</li>\n<li>Dementia (neurotoxicity)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1b6c04e5c31a4350a2e09d528a0b386c.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of patients with hydrargyrism?",
    "choices": [
      {
        "id": 1,
        "text": "Coarse intentional tremors"
      },
      {
        "id": 2,
        "text": "Erythema of palms and soles"
      },
      {
        "id": 3,
        "text": "Shyness and memory loss"
      },
      {
        "id": 4,
        "text": "Bowen's disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Hydrargyrism</strong> means <strong>mercury</strong> poisoning. <strong>Bowen's disease</strong>&nbsp;is associated with chronic low-level exposure to <strong>arsenic,</strong> not mercury.</p>\n<p>Features of chronic mercury poisoning:</p>\n<ul>\n<li><strong>Tremors</strong> - most consistent manifestation. They are:\n<ul>\n<li><strong>Danbury tremors</strong> - fine muscle fasciculations punctuated every few minutes by coarse shaking or jerky movements, intentional type. Progression of tremors is hands &rarr;lips&rarr;tongue&rarr;arms and legs.</li>\n<li><strong>Hatter's shakes</strong> -&nbsp;Severe impairment of daily activities involving delicate movements like shaving, writing, holding a tumbler or spoon.</li>\n<li><strong>Concussio&nbsp;mercurialis</strong> -&nbsp;most severe form,&nbsp;literally no activity is possible.</li>\n</ul>\n</li>\n<li><strong>Erethism mercurialis</strong> - Shyness, memory loss, and change in personality</li>\n<li>Nephrotic syndrome and renal tubular anomalies</li>\n<li><strong>Acrodynia (pink disease)</strong> - Seen in small children and characterized by&nbsp;a generalized rash; edema and erythema of the palms, soles, and face.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old man is brought to the emergency department with a history of having swallowed mercury from a thermometer. History is suggestive of intellectual disability since childhood. What is your next step of action?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric lavage and activated charcoal administration"
      },
      {
        "id": 2,
        "text": "Whole bowel irrigation"
      },
      {
        "id": 3,
        "text": "No treatment is required"
      },
      {
        "id": 4,
        "text": "Chelation with oral succimer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The mercury found in a glass thermometer is\u00a0<strong>elemental</strong> mercury. The <strong>absorption</strong> of elemental mercury by the GI tract is usually <strong>negligible, </strong>unless the mucosa is damaged. Hence, no treatment is required.</p>\n<p class=\"p1\">For ingestion of <strong>inorganic </strong>and<strong> organic mercury </strong>salts, the following steps are followed:</p>\n<ul>\n<li class=\"p1\"><strong>Aggressive</strong> IV <strong>hydration</strong></li>\n<li class=\"p1\">GI decontamination, including <strong>gastric lavage</strong>\u00a0</li>\n<li class=\"p1\"><strong>Activated charcoal</strong></li>\n</ul>\n<p class=\"p1\"><strong>Dimercaprol</strong> and<strong> succimer</strong> are the preferred <strong>chelators</strong> for mercury poisoning.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man has come with complaints of insomnia, memory loss, and orofacial numbness. On examination, the patient has coarse tremors in his hands and lips. History is suggestive of an intake of bluefin tuna on a regular basis. You suspect an intoxication of a particular poison. Which of the following will be an effective treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Dimercaprol"
      },
      {
        "id": 2,
        "text": "Succimer"
      },
      {
        "id": 3,
        "text": "DMPS"
      },
      {
        "id": 4,
        "text": "Supportive care"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>encephalopathy</strong> and <strong>peripheral neuropathy</strong> related to chronic <strong>mercury poisoning </strong>(Minamata disease).\u00a0There is\u00a0<strong>no</strong>\u00a0effective\u00a0<strong>treatment</strong>\u00a0for patients with toxic <strong>chronic exposure</strong> to organic mercury, and hence only\u00a0<strong>supportive care\u00a0</strong>is provided</p>\n<p>This is most commonly associated with the consumption of<strong data-stringify-type=\"bold\">\u00a0mercury-rich fish</strong> (such as shark, swordfish, bonito, mackerel, marlin, and bluefin tuna).</p>\n<p>Symptoms are generally resistant to treatment with chelators. <strong>Dimercaprol (BAL) </strong>should<strong>\u00a0not be used, </strong>because it <strong>increases</strong> the<strong> mobilization </strong>of<strong> mercury</strong> to the<strong> brain</strong>. Treatment with oral <strong>DMSA</strong> is <strong>unlikely</strong> to <strong>reverse</strong> the <strong>neurologic</strong> damage. Hence, there is no effective treatment for Minamata disease.</p>\n<p>For patients with toxic exposure to <strong>elemental</strong> mercury or <strong>inorganic mercury,</strong> the following are effective:</p>\n<ul>\n<li>DMSA (succimer)</li>\n<li>DMPS</li>\n<li>BAL (dimercaprol)</li>\n</ul>\n<p>For<strong> severe acute organic </strong>mercury poisoning, <strong>succimer</strong> is used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 33-year-old patient is being evaluated for longstanding anemia. On clinical examination, you notice the given finding. Which of the following metal poisoning is associated with this characteristic finding?",
    "choices": [
      {
        "id": 1,
        "text": "Thallium"
      },
      {
        "id": 2,
        "text": "Arsenic"
      },
      {
        "id": 3,
        "text": "Lead"
      },
      {
        "id": 4,
        "text": "Beryllium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image is showing characteristic&nbsp;<strong>Burtonian lines,&nbsp;</strong>which are seen in&nbsp;<strong>lead poisoning</strong>&nbsp;and mercury poisoning.</p>\n<p>These are&nbsp;<strong>bluish-grey gingival</strong> lead <strong>lines</strong> that occur with <strong>chronic</strong> exposure to <strong>lead</strong> poisoning.</p>\n<p>The image given below shows&nbsp;Burtonian lines on the gums.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0bd671a3cc524d59a27847e65eeff573.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/219b2049ea9c4f4f8f22fa7f092db149x720x458.JPEG"
    ]
  },
  {
    "text": "A 5-year-old girl is brought by her mother with complaints of abdominal pain and frequent tripping. She lives with her grandparents in a seventy-year-old house and has a history of eating paint from the wall. Which of the following enzyme defect is the likely cause of her condition?",
    "choices": [
      {
        "id": 1,
        "text": "ALA synthase"
      },
      {
        "id": 2,
        "text": "ALA dehydratase"
      },
      {
        "id": 3,
        "text": "Heme synthase"
      },
      {
        "id": 4,
        "text": "Coproporphyrinogen oxidase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This given clinical scenario is suggestive of <strong>lead intoxication.</strong> The enzyme defective in this condition is <strong>ALA dehydratase</strong>.</p>\n<p>The most common cause of lead poisoning in children is seen due to lead paint which was used in the older times.</p>\n<p>It is toxic because it can <strong>substitute</strong> for <strong>calcium</strong> in many fundamental cellular processes. It<strong>&nbsp;</strong>crosses red blood cell membranes as well as the blood-brain barrier&nbsp;and enters the neuroglia cells which support brain function.</p>\n<p>The <strong>fatal dose</strong>&nbsp;of lead acetate is&nbsp;<strong>20 g.</strong> The <strong>fatal period </strong>is<strong>&nbsp;</strong><strong>1</strong>-<strong>2 days</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5950be773ad14b8e8aad41cbf4d53ef5x600x597.JPEG"
    ]
  },
  {
    "text": "The peripheral smear of a patient with suspected heavy metal poisoning is as shown below. What is the mechanism responsible for this?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibition of ALA synthase"
      },
      {
        "id": 2,
        "text": "Inhibition of ferrochelatase"
      },
      {
        "id": 3,
        "text": "Inhibition of ALA dehydratase"
      },
      {
        "id": 4,
        "text": "Inhibition of pyrimidine 5' nucleotidase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows\u00a0<strong>basophilic stippling</strong>, which occurs due to <strong>inhibition</strong> of<strong> pyrimidine 5' nucleotidase</strong>.</p>\n<p class=\"p1\">Basophilic stippling in red blood cells occurs due to <strong>impaired clearing</strong> of cellular<strong> RNA degradation products </strong>(due to inhibition of pyrimidine 5' nucleotidase).</p>\n<p class=\"p1\">This finding is seen in the following:</p>\n<ul>\n<li class=\"p1\">Lead toxicity</li>\n<li class=\"p1\">Arsenic toxicity</li>\n<li class=\"p1\">Sideroblastic anemia</li>\n<li class=\"p1\">Thalassemias</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2572fb14d0f44c289419a533bfa043a0.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 53-year-old man working in the paint industry is being evaluated for foot drop. Lead poisoning is suspected. Which of the following is the key test to diagnose this condition?",
    "choices": [
      {
        "id": 1,
        "text": "24-hour urinary lead"
      },
      {
        "id": 2,
        "text": "Venous blood lead levels"
      },
      {
        "id": 3,
        "text": "Serum zinc protoporphyrin"
      },
      {
        "id": 4,
        "text": "Serum free erythrocyte protoporphyrin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>blood lead levels</strong> are the <strong>best</strong> single <strong>test</strong> for evaluating <strong>lead toxicity.</strong></p>\n<p>Levels at or &gt;5 micrograms/dL (0.24 micromol/L) are considered elevated in children.</p>\n<p>The edetate calcium disodium provocation test and testing for erythrocyte protoporphyrin (e.g., free erythrocyte protoporphyrin, zinc protoporphyrin) and urinary lead levels are no longer recommended.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Saturnine gout is seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Lead poisoning"
      },
      {
        "id": 2,
        "text": "Cadmium poisoning"
      },
      {
        "id": 3,
        "text": "Beryllium poisoning"
      },
      {
        "id": 4,
        "text": "Mercury poisoning"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Saturnine gout</strong>&nbsp;is seen in&nbsp;<strong>chronic lead</strong> intoxication or<strong> poisoning</strong>.</p>\n<p>The features of saturnine gout are the same as primary gout but it affects the&nbsp;<strong>knee </strong>more than the first metatarsophalangeal joint&nbsp;and&nbsp;<strong>tophi rarely develop</strong>. Lead exposure should be suspected if a patient presents with the triad of:</p>\n<ul>\n<li>Saturnine gout</li>\n<li>Hypertension</li>\n<li>Renal insufficiency&nbsp;(renal failure and interstitial fibrosis)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to you with a history of anemia, foot drop, and behavioral changes. On examination, there are bluish-gray lines on the gum. The image shows the radiograph of the knee of the patient. Deposition of which substance is responsible for this finding in the X-ray?",
    "choices": [
      {
        "id": 1,
        "text": "Mercury"
      },
      {
        "id": 2,
        "text": "Phosphorus"
      },
      {
        "id": 3,
        "text": "Lead"
      },
      {
        "id": 4,
        "text": "Calcium"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The X-ray is suggestive of&nbsp;<strong>lead lines </strong>seen in<strong>&nbsp;</strong><strong>lead toxicity&nbsp;</strong>which&nbsp;are due to the <strong>deposition </strong>of<strong> calcium</strong> at the growth plates.</p>\n<p>The <strong>radiodensity</strong> of the lead line is due to persistent<strong> mineralized</strong> metaphyseal <strong>cartilage</strong> and <strong>not</strong> to a primary osseous change or <strong>lead</strong> itself. It is the result of a lead-induced inability of cartilage-resorbing cells to degrade the mineralized matrix. This impairs the resorption of metaphyseal cartilage.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2632501907494ec398794e9a7499ae83.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with altered mental status, after a thorough evaluation, is diagnosed with lead toxicity-induced encephalopathy. Which of the following is not true regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Worsened with the use of dimercaprol"
      },
      {
        "id": 2,
        "text": "Chelation therapy should be started based on clinical suspicion itself"
      },
      {
        "id": 3,
        "text": "Most commonly seen in toddlers"
      },
      {
        "id": 4,
        "text": "Occurs at blood lead levels > 100 mcg/dl"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Dimercaprol</strong> (BAL) must be <strong>administered</strong> in <strong>lead toxicity-induced</strong>&nbsp;<strong>encephalopathy.</strong>&nbsp;</p>\n<p>Lead encephalopathy is suspected when a patient presents with:</p>\n<ul>\n<li>Acute onset of persistent vomiting</li>\n<li>Alteration of mental status&nbsp;<span class=\"nowrap\">and/or&nbsp;</span>seizures</li>\n</ul>\n<p><strong>Emergency</strong> initiation of <strong>chelation therapy</strong> must be done if it is suspected clinically.</p>\n<p><strong>Encephalopathy</strong> due to <strong>lead</strong> poisoning typically occurs in<strong> toddlers</strong> age 15 to 30 months old, with blood <strong>lead</strong> levels<strong> &gt;100 microgram/dl</strong>. Children with lead encephalopathy should receive <strong>combined chelation</strong> therapy with<strong>&nbsp;dimercaprol</strong>&nbsp;and calcium disodium edetate (<strong>CaNa<sub>2</sub>EDTA</strong>).</p>\n<p>Note:&nbsp;Administration <strong>BAL worsens</strong> symptoms in <strong>methyl&nbsp;mercury&nbsp;poisoning,</strong> not in lead poisoning.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Metal fume fever is commonly associated with which of the following poisoning?",
    "choices": [
      {
        "id": 1,
        "text": "Lead"
      },
      {
        "id": 2,
        "text": "Arsenic"
      },
      {
        "id": 3,
        "text": "Zinc"
      },
      {
        "id": 4,
        "text": "Thallium"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span class=\"topic-highlight\">Metal fume fever is most commonly associated with&nbsp;<strong>zinc oxide.&nbsp;</strong></span></p>\n<p>It is an <strong>influenza-like</strong> syndrome with fever, myalgias, profuse sweating, and other symptoms that usually occur 3&ndash;10 hours after heavy exposure to a variety of metal oxides. It is also known as&nbsp;<strong>Smelter's shakes</strong> or<strong> metal shakes.</strong></p>\n<p>It can also be associated with&nbsp;<strong>copper&nbsp;</strong>and&nbsp;<strong>magnesium.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The ouch-ouch disease is due to the toxicity of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Thallium"
      },
      {
        "id": 2,
        "text": "Cadmium"
      },
      {
        "id": 3,
        "text": "Chromium"
      },
      {
        "id": 4,
        "text": "Zinc"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Itai-Itai disease (Japan), also called <strong>ouch-ouch</strong> disease is due to bone pain&nbsp;caused by&nbsp;<strong>cadmium.&nbsp;</strong></p>\n<p>Cadmium causes <strong>nephrotoxicity</strong> leading to <strong>hypercalciuria.</strong> This subsequently causes&nbsp;<strong>osteomalacia</strong>&nbsp;leading to bone pain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Luminescent stools are associated with which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Mercury"
      },
      {
        "id": 2,
        "text": "Cadmium"
      },
      {
        "id": 3,
        "text": "Phosphorus"
      },
      {
        "id": 4,
        "text": "Oxalic acid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Luminescent stools</strong> are seen in <strong>acute</strong>&nbsp;<strong>phosphorus poisoning</strong><strong>.</strong>&nbsp;The vomitus and stools will be luminous in the dark.</p>\n<p>The stools may give rise to faint fumes, constituting the&nbsp;<strong>smoky stool syndrome.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Alkali disease of livestock is caused by an excess of which of the following minerals?",
    "choices": [
      {
        "id": 1,
        "text": "Selenium"
      },
      {
        "id": 2,
        "text": "Manganese"
      },
      {
        "id": 3,
        "text": "Molybdenum"
      },
      {
        "id": 4,
        "text": "Chromium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Excess</strong> of <strong>selenium</strong> causes <strong>alkali disease</strong> in <strong>livestock.</strong></p>\n<p>Clinical types of selenium intoxication:&nbsp;</p>\n<ul>\n<li>Acute selenosis</li>\n<li>Subacute selenosis (i.e., blind staggers type)</li>\n<li>Chronic selenosis (i.e., alkali disease type)</li>\n</ul>\n<p>Alkali disease occurs when animals consume moderate levels of selenium for a period of weeks to months.</p>\n<p>The usual <strong>clinical signs</strong> of chronic selenosis in horses, cattle, and swine are <strong>loss of hair</strong> (horses and cattle lose long hair from the mane and tails), <strong>emaciation, hoof lesions, weight reduction,</strong> and<strong> lameness.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Arrange the following in the correct order of symptomatology seen in iron toxicity:",
    "choices": [
      {
        "id": 1,
        "text": "2 -> 3 -> 1 -> 4"
      },
      {
        "id": 2,
        "text": "2 -> 3 -> 4 -> 1"
      },
      {
        "id": 3,
        "text": "3 -> 2 -> 4 -> 1"
      },
      {
        "id": 4,
        "text": "3 -> 4 -> 1 -> 2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct order of symptomatology in iron toxicity is 3 -&gt; 2 -&gt; 4 -&gt;1.</p>\n<p>Symptoms of iron toxicity are divided into <strong>4 stages</strong>:</p>\n<ul>\n<li><strong>Stage 1</strong> (few hours after ingestion): vomiting, abdominal pain, <strong>gastrointestinal bleeding,</strong> shock, acidosis, and coma</li>\n<li><strong>Stage 2</strong> (6-24 hours): <strong>Asymptomatic</strong> phase</li>\n<li><strong>Stage 3</strong> (24-48 hours): Metabolic acidosis, jaundice, <strong>hypoglycemia,</strong> shock, coma with <strong>hepatic and renal failure.</strong></li>\n<li><strong>Stage 4</strong> (1-2 weeks): Late complications such as <strong>gastric stricture</strong> and <strong>pyloric stenosis.</strong></li>\n</ul>\n<p>Iron exerts its toxic effects by <strong>increasing capillary permeability</strong>, release of hydrogen ions, inhibition of mitochondrial function, and <strong>direct corrosive action</strong> on the gastric mucosa. Ingestion of<strong> 20 to</strong> <strong>30 grams</strong> is considered to be<strong> fatal</strong> and the fatal period is around <strong>24-30 hours</strong>. <strong>Desferrioxamine</strong> is the mainstay of treatment with supportive gastric lavage, administration of egg and milk to form iron-protein complexes, oral MgOH solution, and hemodialysis in severe cases.&nbsp;</p>\n<p><strong>Postmortem changes</strong> in iron toxicity include:</p>\n<ul>\n<li>Hemorrhagic necrosis of gastric mucosa with perforation of gastric or jejunal wall</li>\n<li>Acute hepatic necrosis</li>\n<li>Degenerative renal tubular changes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '19 Inorganic Irritants - Metallic And Non-Metallic';
        let hierarchy = ["Marrow", "qBank", "Forensic Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>