<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 Facets Of Growth And Development - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">17</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following fetal hormones does not play any role in fetal growth?",
    "choices": [
      {
        "id": 1,
        "text": "Insulin"
      },
      {
        "id": 2,
        "text": "Glucocorticoid"
      },
      {
        "id": 3,
        "text": "Thyroxine"
      },
      {
        "id": 4,
        "text": "Growth hormone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Growth hormone</strong> does not play any role in fetal growth, although it is present in high levels during the fetal period. However, it does have a role in the&nbsp;<strong>postnatal period</strong>.&nbsp;</p>\n<p><strong>Insulin</strong> and <strong>thyroxine</strong> hormones are required for normal growth and development during late gestation. <strong>Glucocorticoid</strong> has a role in the prepartum maturation of organs such as liver, lungs, and gastrointestinal tract.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is brought to the pediatrician for vaccination. The child is able to speak in\t2-3 word sentences and is able to make a tower of 6 cubes. What is the expected weight of the child, if his development is normal and birth weight was 3 Kgs?",
    "choices": [
      {
        "id": 1,
        "text": "12 kgs"
      },
      {
        "id": 2,
        "text": "4 kgs"
      },
      {
        "id": 3,
        "text": "8 kgs"
      },
      {
        "id": 4,
        "text": "10 kgs"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The child is able to make a tower of 6 cubes and speaks in 2-3 word sentences which indicates the child is of&nbsp;<strong>2 years</strong> of age.&nbsp;<strong>Birth</strong> <strong>weight</strong> <strong>quadruples</strong> by the age of <strong>2 years</strong>. Hence the child's weight should be 3 kgs x 4= 12 Kgs.</p>\n<p>Infants may <strong>lose up to 10%</strong> of their birth weight in the 1<sup>st</sup> week of life and regain it by their 2<sup>nd</sup> week.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "Head circumference should be measured within 24 hours after birth"
      },
      {
        "id": 2,
        "text": "Head circumference equals chest circumference at 1 year of age"
      },
      {
        "id": 3,
        "text": "A boys height at 2 and half years is half of his adult height"
      },
      {
        "id": 4,
        "text": "A girls height at 2 years is half of her adult height"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Head circumference <strong>should not be measured within 24 hours</strong> because the head is subjected to molding during delivery, which makes the measurements unreliable.</p>\n<p>The maximum circumference of the head from the <strong>occipital protuberance</strong> to the <strong>supraorbital ridges</strong> on the forehead is recorded using the&nbsp;cross-tape method.</p>\n<table border=\"1\">\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Age</strong></td>\n<td style=\"text-align: center;\"><strong>Head circumference</strong></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">At birth</td>\n<td style=\"text-align: center;\">33 to 35cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">3 m</td>\n<td style=\"text-align: center;\">40 cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">6 m</td>\n<td style=\"text-align: center;\">43 cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">1 year</td>\n<td style=\"text-align: center;\">46 cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">2 years</td>\n<td style=\"text-align: center;\">48 cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">3 years</td>\n<td style=\"text-align: center;\">49 cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">4 years</td>\n<td style=\"text-align: center;\">50 cm</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">12 years</td>\n<td style=\"text-align: center;\">52 cm (adult size)</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Head circumference increases by the following:\n<ul>\n<li>2 cm/month in first 3 months</li>\n<li>1 cm/month in next 3 months</li>\n<li>0.5 cm/month in next 6 months</li>\n</ul>\n</li>\n</ul>\n<p>Head circumference is more than chest circumference by 2.5 cm at birth.</p>\n<ul>\n<li>At birth: <strong>Head circumference</strong> <strong>&gt;</strong> <strong>Chest circumference</strong></li>\n<li>At 9-12 months:&nbsp;<strong>Head circumference = Chest circumference</strong></li>\n<li>After 1 year: Head circumference <strong>&lt;</strong> <strong>Chest circumference</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding the eruption of teeth is false?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "2 and 4"
      },
      {
        "id": 3,
        "text": "2, 4 and 5"
      },
      {
        "id": 4,
        "text": "5 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>first secondary tooth</strong> to erupt is the <strong>first molar</strong> (maxillary or mandibular), at <strong>6-7 years,</strong> followed by the lower central incisor.</p>\n<p><strong>Causes of delayed eruption</strong>:</p>\n<ul>\n<li><strong>Idiopathic:</strong>\u00a0Most common</li>\n<li>Hypothyroidism</li>\n<li>Hypoparathyroidism</li>\n<li>Familial</li>\n<li>Mechanical blockage of individual teeth</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9470b9aeec8d452fbf5f944196d7536cx460x599.JPEG"
    ]
  },
  {
    "text": "A 3-year-old boy presented to the clinic for a missed vaccination. His routine anthropometric measurements were noted. He was found to be 90 cm tall with a lower segment of 45 cm. Which among the following is the most likely diagnosis in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Congenital hypothyroidism"
      },
      {
        "id": 2,
        "text": "Achondroplasia"
      },
      {
        "id": 3,
        "text": "Rickets"
      },
      {
        "id": 4,
        "text": "Spondyloepiphyseal dysplasia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Arm span:</strong></p>\n<ul>\n<li>Length between the tips of the middle finger of the outstretched hands is the arm span.</li>\n<li>It is shorter than the\u00a0length by 2.5 cm at birth; it equals height at 11 y and thereafter is slightly greater than height (usually&lt;1 cm).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ff4b272b8f7744ad8515e1f3a41a04c2x1280x1269.JPEG"
    ]
  },
  {
    "text": "A team participating in an Under-14 national athletics sports tournament suspects foul play by, a rival team member. He claims to fit the criteria for the age requirements for the tournament, but the opposing team does not agree. Which of the following X-ray would be most useful to verify the claims of the player?",
    "choices": [
      {
        "id": 1,
        "text": "X-ray of the hip"
      },
      {
        "id": 2,
        "text": "X-ray of the hands and wrist"
      },
      {
        "id": 3,
        "text": "X-ray of the shoulder"
      },
      {
        "id": 4,
        "text": "X-ray of the elbow and hip"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The X-ray of choice to determine the skeletal age of a 14-year-old boy is X-ray of the elbow and hip.</p>\n<p>The bone age of a child indicates his/her level of biological and structural maturity. Methods used for bone age estimation are <strong>Gruelisch&ndash;Pyle</strong> <strong>atlas</strong> (more common) and<strong>&nbsp;Tanner&ndash;Whitehouse</strong> method.</p>\n<table border=\"1\"><caption><span style=\"font-size: 14pt;\">Bone age estimation</span></caption>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Age</strong></td>\n<td style=\"text-align: center;\"><strong>X-ray of choice</strong></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">3 to 9 months</td>\n<td style=\"text-align: center;\">X-ray shoulder</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">1 to 13 years</td>\n<td style=\"text-align: center;\">Single film of X-ray hands and wrist</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">12 to 14 years</td>\n<td style=\"text-align: center;\">X-ray elbow and hip</td>\n</tr>\n</tbody>\n</table>\n<p>Note: There is overlap in the age ranges for X-ray of choice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true?",
    "choices": [
      {
        "id": 1,
        "text": "Head reaches 90% of adult size at 1 year"
      },
      {
        "id": 2,
        "text": "Lymphoid growth follows a sigmoid-shaped pattern"
      },
      {
        "id": 3,
        "text": "Perinatal period is between 28 weeks of gestation to 7 days after birth"
      },
      {
        "id": 4,
        "text": "Growth of child is cephalocaudal and distal to proximal"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<ul>\n<li><strong>Brain growth</strong>: At age of 1 month, the head size is about<strong> 36%</strong> of the expected head size in adults. It <strong>doubles</strong> in the <strong>first year</strong> of life to <strong>72%</strong> and becomes <strong>83%</strong> of adult size at <strong>2 years</strong>.</li>\n<li><strong>Lymphoid growth</strong>: It is prominent in mid-childhood. It peaks at 4&ndash;8 years and regresses subsequently.</li>\n<li><strong>Gonadal growth</strong>: It stays dormant during childhood and shows a rise with the onset of puberty.</li>\n<li><strong>Somatic growth</strong>: General body growth shows an <strong>S-shaped curve.</strong> It is rapid during the&nbsp;fetal period and the first 3&ndash;4 years. It is steady in the following period, followed by a growth spurt during puberty. Later, it slows down considerably.</li>\n</ul>\n<p><strong>Note:&nbsp;</strong>WHO defines the <strong>perinatal period</strong> from <strong>22 weeks of gestation</strong> (or &ge;500 g) up to <strong>7 days after birth</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d73fb7ba5a414105bdc34404b50bee16x1280x1011.JPEG"
    ]
  },
  {
    "text": "A young boy is brought to the clinician by his parents with complaints of impulsive behavior and decreased levels of attention at school and everyday activities. The clinician is suspecting a case of ADHD. Which of the following is not included in the criteria for diagnosis of ADHD?",
    "choices": [
      {
        "id": 1,
        "text": "Symptoms begin before 7 years of age"
      },
      {
        "id": 2,
        "text": "Symptoms should be present for at least 6 months"
      },
      {
        "id": 3,
        "text": "Should be reported by independent observers"
      },
      {
        "id": 4,
        "text": "Behaviour must be developmentally inappropriate  in two or more settings"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">Attention-deficit hyperactive disorder (ADHD) must begin before <strong>12 years</strong> of age, according to DSM-5 criteria. It was 7 years as per the previous DSM-4 criteria.</p>\n<table style=\"height: 126px;\" width=\"922\">\n<tbody>\n<tr>\n<td style=\"width: 912.386px;\"><strong>DSM-5 Diagnostic Criteria for attention-deficit/Hyperactivity Disorder (ADHD)-</strong></td>\n</tr>\n<tr>\n<td style=\"width: 912.386px;\">1. A persistent pattern of <strong>inattention</strong> and/or <strong>hyperactivity/impulsivity</strong> present for <strong>at least 6 months</strong>, that interferes with functioning or development.</td>\n</tr>\n<tr>\n<td style=\"width: 912.386px;\">2. Several inattentive or hyperactive/impulsive symptoms were present <strong>before 12 years of age</strong>.</td>\n</tr>\n<tr>\n<td style=\"width: 912.386px;\">3. Several inattentive or hyperactive/impulsive <strong>symptoms are present in 2 or more settings</strong> (e.g., at school [or work] or at home) and is documented independently.</td>\n</tr>\n<tr>\n<td style=\"width: 912.386px;\">4. There is clear evidence of <strong>clinically significant impairment in social, academic, or occupational functioning.</strong></td>\n</tr>\n<tr>\n<td style=\"width: 912.386px;\">&nbsp;5. Symptoms do not occur exclusively during the course of schizophrenia, or another psychotic disorder, and are <strong>not better accounted for by another mental disorder</strong> (e.g., mood disorder, anxiety disorder, dissociative disorder, personality disorder, substance intoxication or withdrawal).</td>\n</tr>\n</tbody>\n</table>\n<p style=\"text-align: justify;\">&nbsp;</p>\n<p style=\"text-align: justify;\">Treatment: Presynaptic <strong>dopaminergic agonists</strong>, commonly called <strong>psychostimulant medications</strong>, including <strong>methylphenidate, dexmethylphenidate</strong>, amphetamine, and various amphetamine and dextroamphetamine preparations are used.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the image given below, the weight and height of a child are plotted against his age in years. Identify the correct statement.",
    "choices": [
      {
        "id": 1,
        "text": "WHO growth charts used now are developed by National Center for Health Statistics (NCHS)."
      },
      {
        "id": 2,
        "text": "Short stature is defined as a height below 5th percentile."
      },
      {
        "id": 3,
        "text": "Puberty in this child will be normal."
      },
      {
        "id": 4,
        "text": "Bone age of this child is less than chronological age."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Bone age of this child is less than chronological age, as seen in cases of&nbsp;constitutional delay.</p>\n<p>As seen in the graph, the child was short initially, but the final height is within normal range. Hence, this child has&nbsp;constitutional delay.</p>\n<p><strong>Other options:</strong></p>\n<ul>\n<li>The&nbsp;WHO growth charts are based on <strong>Multicentre Growth Reference Study</strong> (MGRS). National Center for Health Statistics (NCHS) developed growth charts that were used in the past.</li>\n<li>Short stature is defined as a height <strong>below the&nbsp;third percentile</strong> or more than 2 standard deviations below the median height for age and gender (&lt;-2 SD) according to the population standard.</li>\n<li>Puberty will be delayed in this child.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6485b97d846240f6a1d9eb5f6ae65e7f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the correct statement from the following.",
    "choices": [
      {
        "id": 1,
        "text": "Children with pica are at increased risk of megaloblastic anemia"
      },
      {
        "id": 2,
        "text": "Breath-holding spells are associated with hypertonia"
      },
      {
        "id": 3,
        "text": "Thumbsucking in a child is a way of discharging tension"
      },
      {
        "id": 4,
        "text": "Bedwetting after a period of 3 months of dryness at night is called secondary enuresis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Thumbsucking in a child is a way of discharging tension. It is a self-limiting habit disorder, usually seen between 6 months to 2 years.</p>\n<p>Option A:<strong>&nbsp;Pica</strong> is persistent ingestion of non-nutritive substances for at least 1 month. It hampers the&nbsp;development of the&nbsp;child and requires clinical attention. Children with pica are at an increased risk of lead poisoning, <strong>iron-deficiency anemia,</strong> and parasitic infections.</p>\n<p>Option B:&nbsp;<strong>Breath-holding spells:</strong>&nbsp;It is preceded by a provocative event such as anger. Crying stops at full expiration. Child may have apnoea, cyanosis, pallor, <strong>hypotonia,&nbsp;</strong>or even&nbsp;loss of consciousness,&nbsp;and generalized tonic&ndash;clonic seizure (GTCS). Subtypes include cyanotic, pallid, and mixed episodes. Seizures and cardiac causes should be ruled out. Parents should be reassured that&nbsp;breath-holding spells are self-limiting.</p>\n<p>Option D:<strong>&nbsp;Enuresis</strong>:</p>\n<ul>\n<li>When the child has never been dry, it is called <strong>primary enuresis.</strong></li>\n<li>When the bedwetting starts after a minimum period of<strong> six months</strong> of dryness at night, it is termed as<strong> secondary enuresis</strong>.</li>\n<li>Nocturnal enuresis is caused due to maturational delay. In a normal individual, antidiuretic hormone (ADH) levels usually peak between 4 am and 8 am. This circadian rhythm is impaired in nocturnal enuresis, leading to bedwetting.</li>\n<li>Treatment -&nbsp;<strong>Behavioural therapy</strong> with positive reinforcement, <strong>bladder alarms,</strong> and <strong>desmopressin</strong> reserved for cases resistant to behavioural therapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As part of the annual school health check-up camp, the visual acuity of a 6-year-old girl is being tested by the optometrist. What is the expected visual acuity in this age?",
    "choices": [
      {
        "id": 1,
        "text": "20/30"
      },
      {
        "id": 2,
        "text": "20/40"
      },
      {
        "id": 3,
        "text": "20/20"
      },
      {
        "id": 4,
        "text": "20/50"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to Parson's diseases of the eye, visual acuity of 20/20 is attained by the age of&nbsp;<strong>6&nbsp;years.</strong>&nbsp;Nelson's Textbook of Paediatrics mentions that by the age of 5 or 6 years most children attain 20/20 vision.</p>\n<p>Generally accepted visual acuity according to age:</p>\n<ul>\n<li>Visual acuity of 20/40 at 3 years of age</li>\n<li>Visual acuity of 20/30 at 4 years of age</li>\n<li>Visual acuity of 20/20 at 5 or 6 years of age</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old boy was brought to the clinic by his mother who complains that for the past few months he has developed body-rocking movements and repeats words he hears on the television. He doesn\u2019t respond immediately on calling his name and also makes limited eye contact during interactions. Based on clinical examination you suspect autism in the child. Which of the following screening tools can be used to detect the boy\u2019s condition?",
    "choices": [
      {
        "id": 1,
        "text": "Conner rating scale"
      },
      {
        "id": 2,
        "text": "MCHAT"
      },
      {
        "id": 3,
        "text": "CRAFFT"
      },
      {
        "id": 4,
        "text": "EPDS"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The symptoms are suggestive of<strong> Autism -</strong> which is a pervasive developmental disorder characterized by:</p>\n<ul>\n<li>Impairment in quality of social interaction</li>\n<li>Impairment in quality of communication</li>\n<li>Restricted, repetitive, and stereotyped patterns of behaviors and interests&nbsp;&nbsp;</li>\n</ul>\n<p>Common symptoms of Autism Spectrum Disorder -</p>\n<ul>\n<li>Repetition of set words and phrases (echolalia)</li>\n<li>Absent or delayed response to name being called, despite normal hearing</li>\n<li>Reduced or absent responsive social smiling</li>\n<li>Reduced or absent social use of eye contact&nbsp;</li>\n<li>Reduced social interactions&nbsp;</li>\n<li>Lacking the ability to initiate or sustain an interaction with peers or adults</li>\n<li>Stereotypic movements and repetitive behaviors may include hand flapping, finger movements, body rocking, and lunging</li>\n<li>Overly sensitive to noise, smells, or texture and may scream when they hear a siren or vacuum&nbsp;</li>\n</ul>\n<p>Modified Checklist for Autism in Toddlers (<strong>MCHAT</strong>) is a screening tool for the detection of <strong>autism.</strong></p>\n<table style=\"width: 454px;\" border=\"1\"><caption><span style=\"font-size: 14pt;\">Screening Tests</span></caption>\n<tbody>\n<tr style=\"height: 49px;\">\n<td style=\"text-align: center; height: 49px; width: 310px;\">\n<p><strong>Test</strong></p>\n</td>\n<td style=\"text-align: center; height: 49px; width: 130px;\"><strong>Disorder</strong></td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"text-align: center; height: 49px; width: 310px;\">\n<p><strong>&nbsp;</strong>Modified Checklist for Autism in Toddlers (<strong>MCHAT</strong>)</p>\n</td>\n<td style=\"text-align: center; height: 49px; width: 130px;\">Autism</td>\n</tr>\n<tr style=\"height: 30px;\">\n<td style=\"text-align: center; height: 30px; width: 310px;\">Conner Rating Scale</td>\n<td style=\"text-align: center; height: 30px; width: 130px;\">Attention-deficit/hyperactivity disorder (ADHD)</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; height: 18px; width: 310px;\">\n<p>CRAFFT</p>\n<p>(Car, Relax, Alone, Forget, Friends, Trouble)</p>\n</td>\n<td style=\"text-align: center; height: 18px; width: 130px;\">\n<p>Substance abuse</p>\n<p>in adolescents</p>\n</td>\n</tr>\n<tr style=\"height: 30px;\">\n<td style=\"text-align: center; height: 30px; width: 310px;\">\n<p>Edinburgh Postnatal Depression Scale (EPDS)</p>\n</td>\n<td style=\"text-align: center; height: 30px; width: 130px;\">\n<p>Postpartum</p>\n<p>depression</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 17-year-old girl presented with primary amenorrhoea. On physical examination, her breast and areola are enlarged without separation of their contours. What is the sexual maturity rating in this girl?",
    "choices": [
      {
        "id": 1,
        "text": "SMR stage 1"
      },
      {
        "id": 2,
        "text": "SMR stage 2"
      },
      {
        "id": 3,
        "text": "SMR stage 3"
      },
      {
        "id": 4,
        "text": "SMR stage 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Breast and areola enlargement without the separation of the&nbsp;contour is seen in sexual&nbsp;maturity rating (<strong>SMR</strong>)<strong> stage 3</strong>.</p>\n<table style=\"height: 669px;\" border=\"1\" width=\"530\"><caption><span style=\"font-size: 14pt;\">Sexual Maturity Rating Stages in Females</span></caption>\n<tbody>\n<tr style=\"height: 35px;\">\n<td style=\"text-align: center; height: 35px; width: 63.0312px;\">SMR Stage</td>\n<td style=\"text-align: center; height: 35px; width: 204.047px;\">PUBIC HAIR</td>\n<td style=\"text-align: center; height: 35px; width: 240.922px;\">BREASTS</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"text-align: center; height: 34px; width: 63.0312px;\">1</td>\n<td style=\"text-align: center; height: 34px; width: 204.047px;\">Preadolescent</td>\n<td style=\"text-align: center; height: 34px; width: 240.922px;\">Preadolescent</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px; width: 63.0312px;\">2</td>\n<td style=\"text-align: center; height: 78px; width: 204.047px;\">\n<p>sparse, lightly pigmented, straight,</p>\n<p>medial border of labia</p>\n</td>\n<td style=\"text-align: center; height: 78px; width: 240.922px;\">\n<p>Breast and papilla elevated as a&nbsp;small mound;</p>\n<p>diameter of areola increased</p>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px; width: 63.0312px;\">3</td>\n<td style=\"text-align: center; height: 78px; width: 204.047px;\">\n<p>Darker, beginning to curl,</p>\n<p>increased amount</p>\n</td>\n<td style=\"text-align: center; height: 78px; width: 240.922px;\">\n<p>Breast and areola enlarged;</p>\n<p>no contour separation</p>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px; width: 63.0312px;\">4</td>\n<td style=\"text-align: center; height: 78px; width: 204.047px;\">\n<p>Coarse, curly, abundant,</p>\n<p>but less than that&nbsp;in adults</p>\n</td>\n<td style=\"text-align: center; height: 78px; width: 240.922px;\">Areola and papilla form a&nbsp;<strong>secondary mound</strong></td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px; width: 63.0312px;\">5</td>\n<td style=\"text-align: center; height: 78px; width: 204.047px;\">\n<p>Adult feminine triangle,</p>\n<p>spread to the&nbsp;medial surface of thighs</p>\n</td>\n<td style=\"text-align: center; height: 78px; width: 240.922px;\">\n<p>Mature, nipple projects,</p>\n<p>areola part of a general breast contour</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<table style=\"height: 771px;\" border=\"1\" width=\"338\"><caption><span style=\"font-size: 14pt;\">Sexual Maturity Rating Stages in Males</span></caption>\n<tbody>\n<tr style=\"height: 41px;\">\n<td style=\"text-align: center; height: 41px; width: 47.4844px;\">SMR STAGE</td>\n<td style=\"text-align: center; height: 41px; width: 84.5938px;\">&nbsp;PUBIC HAIR</td>\n<td style=\"text-align: center; height: 41px; width: 145.672px;\">PENIS</td>\n<td style=\"text-align: center; height: 41px; width: 97.875px;\">TESTES</td>\n</tr>\n<tr style=\"height: 44px;\">\n<td style=\"text-align: center; height: 44px; width: 47.4844px;\">1</td>\n<td style=\"text-align: center; height: 44px; width: 84.5938px;\">None</td>\n<td style=\"text-align: center; height: 44px; width: 145.672px;\">Preadolescent</td>\n<td style=\"text-align: center; height: 44px; width: 97.875px;\">Preadolescent</td>\n</tr>\n<tr style=\"height: 69px;\">\n<td style=\"text-align: center; height: 69px; width: 47.4844px;\">2</td>\n<td style=\"text-align: center; height: 69px; width: 84.5938px;\">\n<p>Scanty, long,</p>\n<p>slightly pigmented</p>\n</td>\n<td style=\"text-align: center; height: 69px; width: 145.672px;\">Minimal change/enlargement</td>\n<td style=\"text-align: center; height: 69px; width: 97.875px;\">\n<p>Enlarged scrotum,</p>\n<p>pink, texture altered</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"text-align: center; height: 64px; width: 47.4844px;\">3</td>\n<td style=\"text-align: center; height: 64px; width: 84.5938px;\">\n<p>Darker, starting to curl,</p>\n<p>small amount</p>\n</td>\n<td style=\"text-align: center; height: 64px; width: 145.672px;\">Lengthens</td>\n<td style=\"text-align: center; height: 64px; width: 97.875px;\">Larger</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px; width: 47.4844px;\">4</td>\n<td style=\"text-align: center; height: 78px; width: 84.5938px;\">\n<p>Resembles adult-type but less quantity,</p>\n<p>coarse, curly</p>\n</td>\n<td style=\"text-align: center; height: 78px; width: 145.672px;\">\n<p>Larger;</p>\n<p>glans and breadth increase in size</p>\n</td>\n<td style=\"text-align: center; height: 78px; width: 97.875px;\">\n<p>Larger,</p>\n<p>scrotum dark</p>\n</td>\n</tr>\n<tr style=\"height: 70px;\">\n<td style=\"text-align: center; height: 70px; width: 47.4844px;\">5</td>\n<td style=\"text-align: center; height: 70px; width: 84.5938px;\">\n<p>Adult distribution,</p>\n<p>spread to the&nbsp;medial surface of thighs</p>\n</td>\n<td style=\"text-align: center; height: 70px; width: 145.672px;\">Adult size</td>\n<td style=\"text-align: center; height: 70px; width: 97.875px;\">Adult size&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy is concerned about the change in colour of his scrotum since the last few weeks. On examination, the boy has a dark scrotum with normal-sized testis,  with coarse and curly pubic hair. What is the sexual maturity rating of this boy?",
    "choices": [
      {
        "id": 1,
        "text": "Stage 2"
      },
      {
        "id": 2,
        "text": "Stage 4"
      },
      {
        "id": 3,
        "text": "Stage 3"
      },
      {
        "id": 4,
        "text": "Stage 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The stage at which the pubic hair is coarse, curly and scrotum become dark is SMR stage 4.</p>\n<p>The first visible sign of puberty in males is<strong> testicular enlargement</strong> at 9.5 years, which is a hallmark of SMR stage 2.\u00a0<span class=\"fontstyle0\">This is followed by penile growth during SMR 3.</span></p>\n<table border=\"1\"><caption><span style=\"font-size: 14pt;\">Sexual Maturity Rating Stages in Males</span></caption>\n<tbody>\n<tr style=\"height: 30px;\">\n<td style=\"text-align: center; height: 30px;\">SMR STAGE</td>\n<td style=\"text-align: center; height: 30px;\">\u00a0PUBIC HAIR</td>\n<td style=\"text-align: center; height: 30px;\">PENIS</td>\n<td style=\"text-align: center; height: 30px;\">\u00a0 TESTES</td>\n</tr>\n<tr style=\"height: 51px;\">\n<td style=\"text-align: center; height: 51px;\">1</td>\n<td style=\"text-align: center; height: 51px;\">None</td>\n<td style=\"text-align: center; height: 51px;\">Preadolescent</td>\n<td style=\"text-align: center; height: 51px;\">Preadolescent</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">2</td>\n<td style=\"text-align: center; height: 78px;\">\n<p>Scanty, long,</p>\n<p>slightly pigmented</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">Minimal change/enlargement</td>\n<td style=\"text-align: center; height: 78px;\">\n<p>Enlarged scrotum,</p>\n<p>pink, texture altered</p>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">3</td>\n<td style=\"text-align: center; height: 78px;\">\n<p>Darker, starting to curl,</p>\n<p>small amount</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">Lengthens</td>\n<td style=\"text-align: center; height: 78px;\">Larger</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">4</td>\n<td style=\"text-align: center; height: 78px;\">\n<p>Resembles adult type, but less quantity;</p>\n<p>coarse, curly</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">\n<p>Larger;</p>\n<p>glans and breadth increase in size</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">Larger, scrotum dark</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"text-align: center; height: 78px;\">5</td>\n<td style=\"text-align: center; height: 78px;\">\n<p>Adult distribution;</p>\n<p>spread to the\u00a0medial surface of thighs</p>\n</td>\n<td style=\"text-align: center; height: 78px;\">Adult size</td>\n<td style=\"text-align: center; height: 78px;\">Adult size\u00a0</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the correct statement.",
    "choices": [
      {
        "id": 1,
        "text": "Macrocephaly is defined as an occipitofrontal circumference greater than 3 SD above the mean for age and sex"
      },
      {
        "id": 2,
        "text": "Monosomy 1p36 is associated with macrocephaly"
      },
      {
        "id": 3,
        "text": "Microcephaly is defined as an occipitofrontal circumference more than 2 SD below the mean for age and sex"
      },
      {
        "id": 4,
        "text": "Infants with benign familial megalencephaly have normal head circumference at birth"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Microcephaly</strong> is defined as an occipitofrontal circumference <strong>more than 2 SD below the mean for age and sex</strong>.</p>\n<p><strong>Macrocephaly</strong> is defined as an occipitofrontal circumference <strong>more than\u00a02 SD\u00a0above\u00a0the mean for age and sex.</strong></p>\n<p><strong>Monosomy 1p36</strong> is associated with <strong>microcephaly</strong>.</p>\n<p>Infants with benign familial megalencephaly have increased head circumference at birth.</p>\n<p><strong>Important causes of macrocephaly:</strong></p>\n<ul>\n<li><strong>Megalencephaly</strong> (enlargement of the brain parenchyma)\n<ul>\n<li>Benign familial</li>\n<li>Neurocutaneous syndromes such as neurofibromatosis, tuberous sclerosis</li>\n<li>Lysosomal storage diseases: Tay\u2013Sachs, mucopolysaccharidosis, gangliosidosis</li>\n</ul>\n</li>\n<li>Increased cerebrospinal fluid\n<ul>\n<li>Hydrocephalus</li>\n<li>Benign enlargement of subarachnoid space</li>\n<li>Hydranencephaly (absence of cerebral hemispheres; the cranial cavity is filled with cerebrospinal fluid [CSF])</li>\n</ul>\n</li>\n<li>Enlarged vascular compartment\n<ul>\n<li>Arteriovenous malformation</li>\n<li>Subdural, epidural, subarachnoid, or intraventricular hemorrhage</li>\n</ul>\n</li>\n<li>Increase in the bony compartment\n<ul>\n<li>Bone disease: Achondroplasia, osteogenesis imperfecta</li>\n<li>Bone marrow expansion: Thalassemia major</li>\n</ul>\n</li>\n<li>Miscellaneous causes\n<ul>\n<li>Intracranial mass lesions: Cyst, abscess, or tumor</li>\n<li>Raised intracranial pressure: Idiopathic pseudotumor cerebri</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother brings her baby of 14 months to the clinic after being concerned about the shape of the baby\u2019s head. You are suspecting a case of craniosynostosis. The premature fusion of which of the following suture is seen in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Metopic suture"
      },
      {
        "id": 2,
        "text": "Both coronal sutures"
      },
      {
        "id": 3,
        "text": "Lambdoid suture"
      },
      {
        "id": 4,
        "text": "Sagittal suture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The picture is suggestive of a child with left<strong> posterior plagiocephaly</strong> (as the left side of the head is flattened) which involves the premature fusion of the left<strong>\u00a0lambdoid</strong> suture.</p>\n<p>In the case of a\u00a0<strong>left anterior plagiocephaly,</strong>\u00a0the premature fusion of the left <strong>coronal</strong> suture is seen.</p>\n<p>Other deformities of the skull:</p>\n<table style=\"height: 499px;\" width=\"347\">\n<tbody>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\"><span style=\"font-size: 12pt;\"><strong>Deformity</strong></span></td>\n<td style=\"width: 154.516px; text-align: center;\"><strong><span style=\"font-size: 12pt;\">Suture involved</span></strong></td>\n</tr>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\">Anterior Plagiocephaly</td>\n<td style=\"width: 154.516px; text-align: center;\">Respective side coronal suture</td>\n</tr>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\">Posterior Plagiocephaly</td>\n<td style=\"width: 154.516px; text-align: center;\">Respective side lambdoid suture</td>\n</tr>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\">Deformation Plagiocephaly</td>\n<td style=\"width: 154.516px; text-align: center;\">Positional skull flattening (without suture fusion)</td>\n</tr>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\">Brachycephaly</td>\n<td style=\"width: 154.516px; text-align: center;\">Bilateral Coronal suture</td>\n</tr>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\">Trigonocephaly</td>\n<td style=\"width: 154.516px; text-align: center;\">Metopic suture</td>\n</tr>\n<tr>\n<td style=\"width: 176.484px; text-align: center;\">Scaphocephaly</td>\n<td style=\"width: 154.516px; text-align: center;\">Saggital suture</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p><strong>Craniosynostosis</strong> consists of premature fusion of one or more cranial sutures, resulting in an abnormal head shape.</p>\n<ul>\n<li>Primary craniosynostosis: It results from a primary defect of ossification.</li>\n<li>Secondary craniosynostosis: It results from the\u00a0failure of brain growth.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/388d215011e040fc8a5a62c85551d70c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ceb596a275254eb0ae98614636e5986fx1280x2288.JPEG"
    ]
  },
  {
    "text": "A 7-year-old boy was found to have a height for age 2 standard deviations below the median. Furthermore, his bone age was found to be equal to chronological age. Which of the following is most likely?",
    "choices": [
      {
        "id": 1,
        "text": "Familial short stature"
      },
      {
        "id": 2,
        "text": "Constitutional delay"
      },
      {
        "id": 3,
        "text": "Undernutrition"
      },
      {
        "id": 4,
        "text": "Growth hormone deficiency"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Familial short stature</strong>&nbsp;is most likely as<strong>&nbsp;</strong>bone age is equal to chronological age.</p>\n<p>Bone age is more than chronological age&nbsp;in precocious puberty.</p>\n<p>Bone age is less than chronological age in all other causes of short stature such as constitutional delay, undernutrition, genetic diseases,&nbsp;and endocrine causes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '06 Facets Of Growth And Development';
        const quizFilename = '06-facets-of-growth-and-development-831392df.html';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>