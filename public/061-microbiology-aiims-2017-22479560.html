<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>061 Microbiology Aiims 2017 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">28</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 28 year old male admitted with history of altered sensorium and hydrophobia. A suspicion of  rabies was made and you want to diagnose the condition. You have taken corneal scrapings from the patient and which of the following tests will you do to confirm your diagnosis",
    "choices": [
      {
        "id": 1,
        "text": "Indirect immunofluorescence"
      },
      {
        "id": 2,
        "text": "Seller stain for negri bodies"
      },
      {
        "id": 3,
        "text": "Viral culture"
      },
      {
        "id": 4,
        "text": "Real time PCR"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Viral culture</strong> from corneal scrapings is used to confirm diagnosis.</p>\n<p>Multiple tests in succession/simultaneously are the best.&nbsp;Usually <strong>Direct Fluorescent Antibody test</strong> followed by <strong>virus isolation/culture</strong> is useful.</p>\n<p><strong>Virus isolation through culture</strong>:&nbsp;Best specimens are <strong>brain </strong>and<strong> saliva. CSF, corneal smears </strong>and <strong>centrifuged</strong> <strong>urine</strong> can also be used.</p>\n<p>Option A: Serological tests like indirect immunofluorescence are insensitive.</p>\n<p>Option B<strong>:</strong> Negri bodies can only be demonstrated in brain (pyramidal cells of Ammon&rsquo;s horn, and the Purkinje cells of the cerebellum are the most common site).</p>\n<p>Option D:&nbsp;Real time-PCR Amplification Detection of rabies virus RNA is highly sensitive and specific. This technique can detect virus in freshsaliva samples, skin, CSF, and brain tissues. However it is <strong>not confirmatory</strong> test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the parasite from the given life cycle.",
    "choices": [
      {
        "id": 1,
        "text": "Fasciola hepatica"
      },
      {
        "id": 2,
        "text": "Fasciolopsis buski"
      },
      {
        "id": 3,
        "text": "Pargaonimus westermani"
      },
      {
        "id": 4,
        "text": "Clonorchis sinensus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given life cycle belongs to\u00a0<em><strong>Fasciola hepatica</strong></em>.</p>\n<p><em>Fasciola hepatica</em> (<strong>sheep liver fluke</strong>) causes disease primarily in sheep and other domestic animals.\u00a0<strong>Humans</strong> are infected by eating watercress (or other aquatic plants) contaminated by <strong>larvae (metacercariae)</strong> that excyst in the duodenum, penetrate the gut wall, and reach the liver, where they mature into adults.</p>\n<p>The <strong>adult flukes</strong>\u00a0in the <strong>bile ducts</strong> produce eggs, which are excreted in the feces. The eggs hatch in freshwater and miracidia enter the snails. Miracidia develop into cercariae, which then encyst on aquatic vegetation. Sheep and humans eat the plants, thus completing the life cycle. Most infections are asymptomatic. <strong>Halzoun</strong> is a\u00a0<strong>painful pharyngitis</strong> caused by the presence of adult flukes on the posterior pharyngeal wall after eating raw sheep liver. <strong>Obstructive jaundice</strong> can occur months or years later.</p>\n<p><strong>Diagnosis</strong> is made by identification of the\u00a0<strong>eggs</strong> in the <strong>feces.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/426c9d1aabbb498696dbedc8cad78fe1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The life cycle given below is of which of the following:",
    "choices": [
      {
        "id": 1,
        "text": "Entamoeba vermicularis"
      },
      {
        "id": 2,
        "text": "Ancylostoma duodenal"
      },
      {
        "id": 3,
        "text": "Balantidium coli"
      },
      {
        "id": 4,
        "text": "Entamoeba histolytica"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given life cycle is of<em><strong> Entamoeba histolytica. </strong></em></p>\n<p>Its life cycle includes 2 stages - the motile <strong>trophozoite</strong> and the non-motile <strong>cyst</strong>, both of which are seen in the image shown above.\u00a0The transmission is primarily by the <strong>fecal-oral</strong> route. There is no animal reservoir. The most frequent site of systemic disease is the <strong>liver.</strong></p>\n<p>The ingested cysts differentiate into trophozoites in the ileum which invade the colonic epithelium. The trophozoites penetrate the submucosal layer and form abscesses which break down to form <strong>flask-shaped ulcers</strong>.</p>\n<p>The trophozoites multiply by binary fission and produce cysts, and both stages are passed in the feces. Trophozoites are rapidly destroyed outside the body. Cysts survive in the external environment and are responsible for transmission.</p>\n<p>Note:\u00a0The genus Entamoeba has four morphologically identical species - <em>E. histolytica, E. dispar, E. bangladeshi</em>, and <em>E. moshkovskii.\u00a0E. moshkovskii</em> which was initially thought to be non-pathogenic has recently been shown to be a causative agent of non-invasive diarrhea.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/645b9ab467d14b6ab24061114030ef3d.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25 year old male with history of fever and enlarged lymph nodes and sore throat was suspected to have infectious mono-nucleosis and was ordered a Paul Bunnel test. Which of the following is the principle of the test?",
    "choices": [
      {
        "id": 1,
        "text": "Complement mediated cell damage"
      },
      {
        "id": 2,
        "text": "Agglutination reaction"
      },
      {
        "id": 3,
        "text": "Heterophile antibody test"
      },
      {
        "id": 4,
        "text": "Neutralisation reaction"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<table style=\"height: 491px; width: 476px;\">\n<tbody>\n<tr>\n<td style=\"width: 139px;\"><strong>Type of test</strong></td>\n<td style=\"width: 152px;\"><strong>Name of the test</strong></td>\n<td style=\"width: 167px;\"><strong>Test used for</strong></td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Tube agglutination</td>\n<td style=\"width: 152px;\">Widal</td>\n<td style=\"width: 167px;\">Typhoid</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Standard agglutination test</td>\n<td style=\"width: 167px;\">Brucellosis</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Microscopic agglutination test</td>\n<td style=\"width: 167px;\">Leptospirosis</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Paul-Bunnell test</td>\n<td style=\"width: 167px;\">Infectious mononucleosis</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Weil-felix test</td>\n<td style=\"width: 167px;\">Rickettsial infection</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Streptococcal MG agglutination test</td>\n<td style=\"width: 167px;\">Primary atypical pneumonia</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Antiglobulin test</td>\n<td style=\"width: 152px;\">Direct coomb's test</td>\n<td style=\"width: 167px;\">Detecting fetal RH Antibody</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Indirect Coomb's test</td>\n<td style=\"width: 167px;\">Detecting maternal Rh antibody</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">Passive agglutination test</td>\n<td style=\"width: 152px;\">Hemagglutination</td>\n<td style=\"width: 167px;\">Rose Waaler test</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Latex agglutination test</td>\n<td style=\"width: 167px;\">Detection of ASO, CRP, RA factor, HCG</td>\n</tr>\n<tr>\n<td style=\"width: 139px;\">&nbsp;</td>\n<td style=\"width: 152px;\">Coagglutination test</td>\n<td style=\"width: 167px;\">Diagnosis of legionellosis, Gonorrhea</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A blood spill in the operation theatre must be cleaned with _____.",
    "choices": [
      {
        "id": 1,
        "text": "Chlorine compound"
      },
      {
        "id": 2,
        "text": "Phenolic compound"
      },
      {
        "id": 3,
        "text": "Quarternary ammonium compounds"
      },
      {
        "id": 4,
        "text": "Alcoholic compounds"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Sodium hypochlorite, a compound of chlorine,</strong> is the best disinfectant for<strong> surface blood spills.</strong>&nbsp;It is used with a concentration of <strong>0.5-5%.</strong></p>\n<p>If the spill contains large amounts of blood or body fluids, clean the visible matter with disposable absorbent material and discard the contaminated materials in appropriate, labelled containment.&nbsp;</p>\n<p>A 1:10&ndash;1:100 dilution of 5.25%&ndash;6.15%&nbsp;sodium hypochlorite (i.e., household bleach) or an EPA-registered tuberculocidal disinfectant has been recommended for decontaminating blood spills.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Urine LAM is used for the diagnosis of ___________",
    "choices": [
      {
        "id": 1,
        "text": "M. tuberculosis"
      },
      {
        "id": 2,
        "text": "M. leprae"
      },
      {
        "id": 3,
        "text": "Mycoplasma"
      },
      {
        "id": 4,
        "text": "Listeria monocyogenes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Urine lipoarabinomannan</strong> (LAM) assay is used for the diagnosis of<strong> tuberculosis</strong>.</p>\n<p>Lipoarabinomannan (LAM) antigen is a lipopolysaccharide present in mycobacterial cell wall. It is released from metabolically active cells or degenerating cells of patients having tuberculosis. Urine LAM testing is especially useful in diagnosing TB in <strong>patients with HIV</strong> and low CD 4 counts.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the organism in the given slide stained with Gomori methenamine silver stain.",
    "choices": [
      {
        "id": 1,
        "text": "Obtuse angled mucor"
      },
      {
        "id": 2,
        "text": "Acute angled penicillium"
      },
      {
        "id": 3,
        "text": "Acute angled branching aspergillus"
      },
      {
        "id": 4,
        "text": "Obtuse angled rhizopus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A: <em><strong>Mucor</strong></em> produces\u00a0<strong>nonseptate, broad hyphae</strong> with aerial sporangiophores which end in a sporangium.</p>\n<p>Option B: <em><strong>Penicillium</strong></em> produces <strong>septate hyphae</strong> with branched, <strong>septate</strong> and <strong>brush-like conidiophores</strong>.</p>\n<p>Option D: <strong><em>Rhizopus</em></strong> appears similar to <em>Mucor</em> but it has\u00a0<strong>rhizoids</strong> with sporangiophores arising in groups directly above the rhizoids.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/98b03b33d5754140b261f3fa6e67c329.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b56b0fefcc8a4f61959ee5a6680bcaf0x567x425.JPEG"
    ]
  },
  {
    "text": "A confirmed case of which of the following viral haemorrhagic fevers was found in India?",
    "choices": [
      {
        "id": 1,
        "text": "Ebola hemorrhagic fever"
      },
      {
        "id": 2,
        "text": "Yellow fever"
      },
      {
        "id": 3,
        "text": "Crimean congo hemorrhagic fever"
      },
      {
        "id": 4,
        "text": "Marburg hemorrhagic fever"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Crimean Congo hemorrhagic fever </strong>has been found in <strong>India. </strong></p>\n<p>Four cases were first described in India in <strong>2011</strong> <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">in the state of </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Gujarat. </strong>It is a <strong>severe</strong> form of viral hemorrhagic fever caused by negative sense ssRNA <strong>Nairovirus</strong> species. It is <strong>zoonotic</strong> in origin with <strong>Ixodes ticks</strong> as vectors with livestock as primary reservoirs. The outbreak was caused due to <strong>person-to-person</strong> transmission in a tertiary care hospital where the index patient (first identified case) was admitted.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The given life cycle is suggestive of which of the following viruses?",
    "choices": [
      {
        "id": 1,
        "text": "HIV"
      },
      {
        "id": 2,
        "text": "Hepatitis B"
      },
      {
        "id": 3,
        "text": "Influenza"
      },
      {
        "id": 4,
        "text": "Herpes simplex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given life cycle is of the&nbsp;<strong>hepatitis B virus.&nbsp;</strong></p>\n<p>Steps:&nbsp;</p>\n<ul>\n<li>The infectious virion <strong>attaches</strong> to cells and <strong>uncoating</strong> occurs.</li>\n<li>Cell enzymes in the hepatocytes convert dsDNA to&nbsp;covalently closed circular double-stranded DNA (c<strong>ccDNA)</strong></li>\n<li><strong>HBV mRNA</strong> and <strong>pre-genome RNA</strong> is synthesized using cccDNA as a <strong>template</strong>.</li>\n<li>pre-genome RNA is&nbsp;encapsidated by packaging signal into new core particles.</li>\n<li>These new core particles are templates for HBV reverse transcriptase.</li>\n<li><strong>Negative-strand DNA</strong> is synthesized by viral <strong>polymerase&nbsp;</strong>by reverse transcription.&nbsp;</li>\n<li>The cores bud from the pre-Golgi membranes, acquiring <strong>HBsAg-containing envelopes.</strong></li>\n<li>Once viral particles are assembled, they either <strong>exit</strong> the cell or cause <strong>reinfection of the same cell</strong>.&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/af929726175f4dd5bd97d0a13eed1fc5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "1,3 beta D- glucan is helpful for identification of?",
    "choices": [
      {
        "id": 1,
        "text": "Invasive candidiasis"
      },
      {
        "id": 2,
        "text": "Rhizopus"
      },
      {
        "id": 3,
        "text": "Cryptococcus"
      },
      {
        "id": 4,
        "text": "Mucormycosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>1,3 beta D- glucan is helpful for the identification of&nbsp;<strong>Invasive candidiasis </strong>(invasive fungal infections).</p>\n<p><strong>1-3 beta D-glucan assay test</strong> detects the presence of (1-3)-&beta;-<span class=\"small-caps\">d</span>-glucan (BDG) which is an abundant cell wall polysaccharide found in most fungi <strong>except</strong></p>\n<ul>\n<li>Cryptococci</li>\n<li>Zygomycetes</li>\n<li class=\"p1\">Blastomyces dermatitidis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Relapse is seen in ?",
    "choices": [
      {
        "id": 1,
        "text": "Plasmodium vivax and falciparum"
      },
      {
        "id": 2,
        "text": "Plasmodium ovale and falciparum"
      },
      {
        "id": 3,
        "text": "Plasmodium vivax  and ovale"
      },
      {
        "id": 4,
        "text": "Plasmodium vivax and malariae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Relapse is seen in cases of<strong> Plasmodium vivax and ovale.</strong></p>\n<p><strong>Malaria relapse :</strong></p>\n<p>In case of <strong>Plasmodium vivax and ovale</strong> two kinds of sporozoites are seen, some of which multiply inside hepatic cells to form schizonts and&nbsp;others persist and remain dormant as&nbsp;hypnozoites.</p>\n<p>True relapse is caused due to hypnozoites (resting forms). Some get activated to become schizonts and release merozoites,&nbsp;which go on infecting RBCs producing clinical relapse.</p>\n<p>In case of <strong>Plasmodium falciparum and malariae</strong>, the initial tissue phase disappears completely and no hypnozoites are found, hence relapse is not seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the organism.",
    "choices": [
      {
        "id": 1,
        "text": "Balantidium coli"
      },
      {
        "id": 2,
        "text": "Entamoeba dispar"
      },
      {
        "id": 3,
        "text": "Cryptosporidium"
      },
      {
        "id": 4,
        "text": "Giardia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image is the trophozoite form of the&nbsp;<strong>Balantidium coli</strong>.&nbsp;</p>\n<p>Balantidium coli occurs in two stages</p>\n<ul>\n<li><strong>Trophozoites</strong> are&nbsp;oval in shape and contain two nuclei. There is the presence of&nbsp;<strong>cilia</strong> over the entire surface and are larger around the mouth. Its anterior end is narrow and the posterior end is broad. &nbsp;At the anterior end, there is a groove leading&nbsp;to the mouth&nbsp;(cytostome).&nbsp;Posteriorly, there is a small anal pore (cytopyge).</li>\n<li><strong>Cysts</strong> are smaller, round with a micronucleus, a macronucleus and many contractile vacuoles.</li>\n</ul>\n<p>Living trophozoites/cysts are yellowish or greenish in color on wet mount.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f3f1efcb52e74c2a82c5508226c37e4d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A female from Himachal Pradesh presented with H/O thorn prick, a year back has a verrucous lesion in the skin with the following microscopic findings. Identify the agent?",
    "choices": [
      {
        "id": 1,
        "text": "Blastomycosis"
      },
      {
        "id": 2,
        "text": "Pheohyphomycosis"
      },
      {
        "id": 3,
        "text": "Chromoblastomycosis"
      },
      {
        "id": 4,
        "text": "Sporotrichosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical history and histopathological image are suggestive of <strong>Chromoblastomycosis</strong></p>\n<p>Chromoblastomycosis (chromomycosis) is a <strong>subcutaneous</strong> <strong>mycotic</strong> <strong>infection</strong> that is usually caused by <strong>traumatic</strong> <strong>inoculation.</strong></p>\n<p>Over months to years, the primary lesion<strong> becomes verrucous and wart-like </strong>with extension along the draining lymphatics.</p>\n<p>Histologically, the lesions are <strong>granulomatous</strong> and the dark sclerotic bodies may be seen within leukocytes or giant cells (<strong>medlar/copper penny bodies</strong>)</p>\n<p>The following are the various dematiaceous species of fungi</p>\n<ul>\n<li><em>Phialophora verrucosa</em></li>\n<li><em>Fonsecaea pedrosoi</em></li>\n<li><em>Fonsecaea compacta</em></li>\n<li><em>Rhinocladiella aquaspersa</em></li>\n<li><em>Cladophialophora carrionii</em></li>\n</ul>\n<p>Treatment: Surgical excision with wide margins is the treatment of choice for small lesions. Chemotherapy with flucytosine or itraconazole may be efficacious for larger lesions.&nbsp;The application of local heat is also beneficial.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf5f207a979f4f48865c737ca3ad02ad.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following slide is given as a spotter in your microbiology practical examination. Identify the following organism.",
    "choices": [
      {
        "id": 1,
        "text": "Mycobacteria"
      },
      {
        "id": 2,
        "text": "Nocardia"
      },
      {
        "id": 3,
        "text": "Actinomyces"
      },
      {
        "id": 4,
        "text": "Corynebacterium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>\u00a0</p>\n<p>Option D: The images below show the staining characteristics of<em> Corynebacterium diphtheriae.</em> It is stained with Albert's stain which shows the needle appearance.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/36a8ddd4a8b4470887ee5a0e96ad88ad.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1afc227efd4c4caab4c862cd30d6d737x720x501.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04f6afcd0f024dbbad620fb7f59e820ax305x235.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dfdfa4e8cbe2459eb59843248b4de506x1280x2413.JPEG"
    ]
  },
  {
    "text": "Identify the organism from the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Vibrio"
      },
      {
        "id": 2,
        "text": "Leptospira"
      },
      {
        "id": 3,
        "text": "Helicobacter"
      },
      {
        "id": 4,
        "text": "Salmonella"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The organisms in the image are leptospira.</p>\n<p>In spirochetes, the presence of <strong>two axial filaments (periplasmic flagella) with polar insertions are located in periplasmic space called as endoflagella.</strong></p>\n<p>Endoflagella are seen in :</p>\n<ul>\n<li>Treponema</li>\n<li>Borrelia</li>\n<li>Leptospira</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a6de4a01fc3e4296a0cdfcecab20ab29.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following organisms causes the following disease?",
    "choices": [
      {
        "id": 1,
        "text": "Coxsackievirus"
      },
      {
        "id": 2,
        "text": "Human herpes virus 7"
      },
      {
        "id": 3,
        "text": "Pox virus"
      },
      {
        "id": 4,
        "text": "Molluscum contagiosum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows vesicles on the palms, soles, and oral mucosa, consistent with <strong>hand-foot-and-mouth</strong> disease. It is caused by<strong> coxsackievirus.</strong></p>\n<p>Hand-foot-and-mouth disease (HFMD)<strong>\u00a0</strong>is an exanthematous fever affecting mainly young children, characterized by\u00a0<strong>oral</strong> and<strong> pharyngeal ulcerations</strong> and a <strong>vesicular rash\u00a0</strong>of the<strong> palms and soles</strong> that may spread to the arms and legs.\u00a0Vesicles<strong> heal without crusting</strong>, which clinically differentiates them from the vesicles of herpesviruses and poxviruses.\u00a0It is usually a benign illness resolving in 1-2 weeks.</p>\n<div class=\"page\" title=\"Page 506\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Coxsackie A16, A9, and B 1-3 are common causative agents.</p>\n<p>Other diseases caused by Coxsackie A virus:</p>\n<ul>\n<li>Aseptic meningitis is associated with a maculopapular rash.</li>\n<li>Herpangina</li>\n<li>Minor respiratory infections</li>\n</ul>\n<p>Note: Conditions associated with the rash on palms and soles: Secondary syphilis, Hand foot, and mouth disease, Rickettsial feature caused by Rickettsia rickettsiae</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/28814a1e8f5b4c08ba29d067e9bcc13c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a dimorphic fungus?",
    "choices": [
      {
        "id": 1,
        "text": "Blastomyces dermatidis"
      },
      {
        "id": 2,
        "text": "Histoplasma capsulatum"
      },
      {
        "id": 3,
        "text": "Pneumocystis jirovecii"
      },
      {
        "id": 4,
        "text": "Penicillium marneffi"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Pneumocystis jiroveci is not a dimorphic fungi</strong>, it is a <strong>yeast like organism.</strong></p>\n<p><strong>Dimorphic fungi :</strong></p>\n<ul>\n<li>Blastomyces dermatitidis</li>\n<li>Histoplasma capsulatum</li>\n<li>Paracoccidioides brasiliensis</li>\n<li>Penicillium marneffei</li>\n<li>Sporothrix schenckii</li>\n<li>Coccidioides immitis</li>\n<li>Coccidioides posadasii</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "There are 3 to 5% healthy hepatitis B carriers in India who are asymptomatic. They are at the risk of developing hepatocellular carcinoma in the future because _________",
    "choices": [
      {
        "id": 1,
        "text": "They are unable to mount inflammation against the virus"
      },
      {
        "id": 2,
        "text": "Virus can integrate with host DNA and form complementary DNA"
      },
      {
        "id": 3,
        "text": "There is a risk of elevation of transaminases"
      },
      {
        "id": 4,
        "text": "Liver parenchymal cells are in a state of high proliferation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In most tumors,<strong> HBV DNA </strong>is<strong> integrated </strong>into the<strong> cell genome</strong>, and in most cases, the virus DNA has undergone rearrangements, including deletions. After integration, it promotes the overexpression of cell genes that can also contribute to oncogenesis.</p>\n<p>The only <strong>viral gene</strong> product that is consistently present in the <strong>tumor cells</strong> is the <strong>X protein</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the following?",
    "choices": [
      {
        "id": 1,
        "text": "Entamoeba dispar"
      },
      {
        "id": 2,
        "text": "Giardia lamblia"
      },
      {
        "id": 3,
        "text": "Balantidium coli"
      },
      {
        "id": 4,
        "text": "Entamoeba histolytica"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows giardia lamblia.&nbsp;</p>\n<p>Cysts are resistant forms and are responsible for transmission of giardiasis. Both <strong>cysts and trophozoites can be found in the feces</strong> (diagnostic stages). The cysts are hardy and can survive several months in cold water.</p>\n<p>Infection occurs by the <strong>ingestion of cysts</strong> in contaminated water, food, or by the fecal-oral route (hands or fomites).</p>\n<p>In the small intestine, excystation releases trophozoites (each cyst produces two trophozoites).</p>\n<p>Trophozoites multiply by longitudinal binary fission, remaining in the lumen of the proximal small bowel where they can be free or attached to the mucosa by a ventral sucking disk.</p>\n<p>Encystation occurs as the parasites transit toward the colon. The cyst is the stage found most commonly in nondiarrheal feces.&nbsp; Because the cysts are infectious when passed in the stool or shortly afterward, <strong>person-to-person transmission</strong> is possible.&nbsp;</p>\n<p>Giardia lamblia exists in :</p>\n<ul>\n<li><strong>Infective form</strong> &ndash; <strong>Quadrinucleate</strong> cyst</li>\n<li><strong>Tennis racket shaped</strong> trophozoite is actively motile with <strong>central axostyle</strong> with pair of nuclei</li>\n<li><strong>Oval shaped</strong> cyst denoted with <strong>cyst wall</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6faccf5c3c43457a82d9a5b5e3f00143.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Best method of diagnosis for Clostridium difficile?",
    "choices": [
      {
        "id": 1,
        "text": "Pure strain isolation from culture"
      },
      {
        "id": 2,
        "text": "Immunoflourescence"
      },
      {
        "id": 3,
        "text": "Toxin gene detection by PCR"
      },
      {
        "id": 4,
        "text": "Toxin Detection by ELISA"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Nucleic acid amplification tests, including PCR assays, for C. difficile toxin A or B gene in stool</strong> have been approved for diagnostic purposes of Clostridium difficile infection due to high sensitivity, specificity and rapid turnaround time.</p>\n<p>The diagnosis of CDI is based on a combination of clinical criteria:</p>\n<p>(1) diarrhea (&ge;3 unformed stools per 24 h for &ge;2 days) with no other recognized cause plus</p>\n<p>(2) toxin A or B detected in the stool, toxin- producing C. difficile detected in the stool by PCR or culture, or pseudomembranes seen in the colon.</p>\n<p><strong>Other diagnostic methods include :</strong></p>\n<ul>\n<li>Stool Culture in selective media</li>\n<li>Demonstrating Toxin by Hep-2 cell cultures</li>\n<li>Toxin gene identification by Enzyme immunoassay</li>\n<li>Colonscopy or sigmoidoscopy</li>\n</ul>\n<p>Despite the array of tests available for C. difficile and its toxins, no single traditional test has high sensitivity, high specificity, and rapid turnaround.</p>\n<p>Most laboratory tests for toxins, including enzyme immunoassays, lack sensitivity.</p>\n<p>Nucleic acid amplification tests, including PCR assays, for C. difficile toxin A or B gene in stool have now been approved for diagnostic purposes and appear to be both rapid and sensitive while retaining high specificity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with HIV develops diarrhoea and faecal examination shows Isospora belli. He was treated with cotrimoxazole. Diarrhoea subsided but fever persisted. Bone marrow examination of this patient is shown in the given image. Which of the following statement is false?",
    "choices": [
      {
        "id": 1,
        "text": "It cannot be grown in sabouraud dextrose agar"
      },
      {
        "id": 2,
        "text": "Spores are infective form"
      },
      {
        "id": 3,
        "text": "It is intracellular budding yeast"
      },
      {
        "id": 4,
        "text": "It can cause systemic disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical findings and bone marrow examination is suggestive of&nbsp;<strong>Histoplasma capsulatum.&nbsp;</strong></p>\n<p>It can be grown in sabouraud dextrose agar&nbsp;and&nbsp;blood agar.</p>\n<p>In SDA &ndash; white cottony mycelia growth can be seen.</p>\n<p>Mode of infection &ndash; <strong>Inhalation</strong> of spores</p>\n<p>Yeast cells occur within budding yeasts as <strong>intracellular fungi</strong></p>\n<p><strong>Disseminated infection&nbsp;</strong>can occur in immunocompromised patients with reticuloendothelial system being affected the most.</p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/2e437e6966bf4e789ac10bf9b1222e76.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Bio-film confer resistance to antibiotics by all except _______",
    "choices": [
      {
        "id": 1,
        "text": "Mechanical barrier"
      },
      {
        "id": 2,
        "text": "Increased excretion of antibiotics"
      },
      {
        "id": 3,
        "text": "Slow metabolism"
      },
      {
        "id": 4,
        "text": "Adherence"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Adherence</strong> is a mechanism of bacteria to <strong>attach to host cell</strong> for penetration. It is <strong>not a mechanism of resistance.</strong></p>\n<p><strong>Mechanisms of biofilm-mediated resistance</strong> to antibiotics:</p>\n<ul>\n<li><strong>Mechanical barrier</strong>: The lipopolysaccharide biofilms prevent entry of water-soluble drugs.&nbsp; &nbsp; &nbsp;</li>\n<li><strong>Efflux pumps</strong>: These pumps on the biofilms actively excrete drug out.</li>\n<li><strong>Slow metabolism</strong>: Decreased oxygen and nutrients passage through the biofilms slows down the metabolism of bacteria.</li>\n<li><strong>Anaerobic pathway</strong>: Because of the above reason bacteria follow anaerobic metabolism.</li>\n<li><strong>Persisters:</strong> Some bacteria undergo phenotypic modification into dormant, spore-like structure and survive antibiotic insult. These are called as persisters which are activated later.</li>\n<li><strong>Enzymatic inactivation</strong> of drugs by biofilms</li>\n<li><strong>Genetic adaptation</strong> to antibiotic insults</li>\n<li><strong>Quorum sensing</strong>: It is cell to cell signaling among the bacteria to coordinate among themselves for contribution in biofilm synthesis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the egg in the picture given below:",
    "choices": [
      {
        "id": 1,
        "text": "A. lumbricoides"
      },
      {
        "id": 2,
        "text": "Strongyloides stercoralis"
      },
      {
        "id": 3,
        "text": "E. vermicularis"
      },
      {
        "id": 4,
        "text": "Ancylostoma duodenale"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The egg in the given picture is that of a&nbsp;<strong>hookworm</strong>. Eggs of both <strong>Ancylostoma Duodenale</strong> (old world hookworm) and <strong>Necator Americanus</strong> (new world hookworm) are<strong> identical</strong>.</p>\n<p>The eggs of hookworm are :</p>\n<ul>\n<li>Oval or elliptical</li>\n<li>Colorless</li>\n<li>Not bile stained</li>\n<li>With a<strong> thin</strong> transparent hyaline shell membrane</li>\n<li><strong>Thin</strong> shell</li>\n<li><strong>Segmented</strong> ovum - 4 to 8 blastomeres</li>\n<li>There is clear space between segmented ovum and egg shell.</li>\n<li>Eggs float in saturated salt solution.</li>\n</ul>\n<p>Humans are infected when<strong> filariform larvae </strong>in moist soil<strong> penetrate the skin.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9aab4b04e34b48878649a0d99c0ab353.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the organism from the given staining technique.",
    "choices": [
      {
        "id": 1,
        "text": "Mycobacterium leprae"
      },
      {
        "id": 2,
        "text": "Mycobacterium tuberculosis"
      },
      {
        "id": 3,
        "text": "Actinomyces israelli"
      },
      {
        "id": 4,
        "text": "Nocardia asteroids"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The organism shown above is the <em>Nocardia</em> species.&nbsp;The above image shows <strong>acid-fast staining,</strong> where the organisms are shown appear as <strong>acid-fast&nbsp;</strong>(stained with fuschia) and branching rods or filaments. They&nbsp;are aerobes found particularly in the soil and are found to produce lung infections in the immunocompromised.</p>\n<p>Options A, B: Mycobacteria species are acid-fast but do not have branching filaments.</p>\n<p>Option C: Actinomyces species is gram-positive but not acid-fast.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5decc3986fd14b8ba0c8c3c70fc93944.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following staphylococcal infections is not toxin mediated?",
    "choices": [
      {
        "id": 1,
        "text": "Food poisoning"
      },
      {
        "id": 2,
        "text": "Toxic shock syndrome"
      },
      {
        "id": 3,
        "text": "Septicemia"
      },
      {
        "id": 4,
        "text": "Staphylococcal scalded skin syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Staphylococcal septicemia </strong>is not toxin mediated.</p>\n<p>Septicemia occurs due to the <strong>invasion </strong>of <strong>bacterial organisms</strong> into the bloodstream. This causes an inflammatory response to bacterial products, leading to various manifestations seen in sepsis - fever, hypotension, alkalosis.\u00a0</p>\n<p><strong>Toxin mediated</strong> staphylococcal infections include food poisoning caused by <strong>enterotoxin</strong>, toxic shock syndrome caused by <strong>toxic shock syndrome toxin </strong>and staphylococcal scalded skin syndrome caused by <strong>exfoliative/epidermolytic toxin.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All are features of Zika Fever except",
    "choices": [
      {
        "id": 1,
        "text": "Petechial rash"
      },
      {
        "id": 2,
        "text": "Guillan barre syndrome"
      },
      {
        "id": 3,
        "text": "Fever with arthritis"
      },
      {
        "id": 4,
        "text": "Conjunctivitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Petechial rash is <strong>not</strong> a feature of Zika Virus. Though petechiae may rarely appear in Zika virus disease it is however <span style=\"color: #000000;\">not included </span><span style=\"text-decoration: underline;\">i</span>n the CDC case definition of Zika virus disease. Petechial rash points towards a diagnosis of Dengue fever while a maculopapular rash suggests a Zika virus disease.</p>\n<p>Zika virus infection is characterised by influenza-like clinical signs including fever, headache and malaise. A maculopapular rash, conjunctivitis, myalgia and arthralgia usually accompany or follow those manifestations.</p>\n<p>The <strong>complications</strong> of Zika virus are:</p>\n<ul>\n<li>Gullian Barre Syndrome</li>\n<li>Fetal microcephaly in pregnant women.<br /> </li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "(1\u20133)-\u03b2-D glucan assay can not be used in",
    "choices": [
      {
        "id": 1,
        "text": "Invasive cryptococcosis"
      },
      {
        "id": 2,
        "text": "Invasive aspergillosis"
      },
      {
        "id": 3,
        "text": "Pneumocystis jiroveci pneumonia"
      },
      {
        "id": 4,
        "text": "Invasive candidiasis and candidemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>(1-3) - &beta; - D glucan assay is used for diagnosis of <strong>candida infections, invasive aspergillosis </strong>and<strong> <em>Pneumocystis jirovecii</em> pneumonia. </strong></p>\n<p>It is not useful in case of invasive cryptococcosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was sputum negative for tuberculosis, but chest X-ray was suggestive of tuberculosis. Which is the next step according to RNTCP ?",
    "choices": [
      {
        "id": 1,
        "text": "Line probe assay"
      },
      {
        "id": 2,
        "text": "CB - NAAT"
      },
      {
        "id": 3,
        "text": "Liquid culture"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>CB-NAAT and Line probe assay</strong> are <strong>rapid molecular diagnostic techniques used for diagnosis of tuberculosis</strong> and also to <strong>assess resistance to isoniazid and rifampicin.</strong></li>\n<li><strong>CB NAAT (Cartridge Based Nucleic Acid Amplification Test)</strong> provides <strong>rapid and accurate diagnosis of TB </strong>by <strong>detecting Mycobacterium tuberculosis and mutations responsible for rifampicin resistance</strong>.</li>\n<li>It can be used for <strong>sputum samples as well as samples from extrapulmonary sites.</strong></li>\n<li><strong>It is mainly used for </strong>diagnosis of DR-TB in presumptive DR-TB patients and TB in key populations such as pediatric population, PLHIV and extrapulmonary TB.</li>\n<li><strong>It is done when smear is negative for TB but chest X-ray is suggestive of tuberculosis and also in cases smear is negative and chest X-ray is not suggestive of TB but there is high index of clinical suspicion.</strong><strong>&nbsp;</strong></li>\n</ul>\n<p>Diagnostic algorithm for pulmonary TB:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9548a5fd9b44d8588dac914878c69f5x795x446.PNG"
    ]
  }
];
        let quizName = '061 Microbiology Aiims 2017';
        let hierarchy = ["Marrow", "PYQs", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>