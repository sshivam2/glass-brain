<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slides Test Ii - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2018-19
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The tumor cells as shown in the image are seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Mantle cell lymphoma"
      },
      {
        "id": 2,
        "text": "Peripheral T cell lymphoma"
      },
      {
        "id": 3,
        "text": "Anaplastic large cell lymphoma"
      },
      {
        "id": 4,
        "text": "Adult T cell leukemia/lymphoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The cells shown in the slide are <strong>cloverleaf or flower cells</strong>\u00a0with\u00a0<strong>multilobulated nuclei </strong>that<strong>\u00a0</strong>are frequently observed in <strong>adult T-cell leukemia/lymphoma.</strong></p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Adult T-cell leukemia/ lymphoma</strong>\u00a0occurs in adults infected by human T-cell leukemia retrovirus type 1 (<strong>HTLV-1</strong>). It is a neoplasm of CD4+ cells and is a\u00a0<strong>rapidly progressive</strong>\u00a0disease that is fatal within months to 1 year.</p>\n<p>Common findings include skin lesions, generalized lymphadenopathy, hepatosplenomegaly and hypercalcemia.</p>\n<p>Peripheral smear blood shows characteristic\u00a0<strong>cloverleaf cells</strong>\u00a0or\u00a0<strong>flower cells\u00a0</strong>which\u00a0are tumour cells with\u00a0<strong>multilobulated nuclei</strong>. Lymphocytosis is also observed.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b6e5d4e871274d8e8db5e131e0e41331.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/415b63b971544091bffd42206ad10f4ex720x540.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9bdff1d318f645d5afaeb6052050d6fcx1280x1024.JPEG"
    ]
  },
  {
    "text": "Seen below is the microscopic appearance of a liver biopsy section. Which of the following is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Complete penetrance"
      },
      {
        "id": 2,
        "text": "Autosomal recessive"
      },
      {
        "id": 3,
        "text": "Phlebotomy leads to cure"
      },
      {
        "id": 4,
        "text": "More common in females"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above slide is of <strong>hereditary hemochromatosis</strong> which is an <strong>autosomal recessive</strong> condition.</p>\n<p>The liver biopsy section stained with&nbsp;Perl's Prussian Blue shows blue stained hepatocyte iron accumulation.</p>\n<p><strong>Hemochromatosis</strong> is caused by excessive iron absorption, most of which is deposited in parenchymal organs such as the liver and pancreas, followed by heart, joints, and&nbsp;endocrine organs.</p>\n<ul>\n<li>When hemochromatosis results from an inherited disorder, it is referred to as <strong>hereditary hemochromatosis.</strong></li>\n<li>When accumulation occurs as a consequence of parenteral administration of iron-<strong> secondary hemochromatosis.</strong></li>\n<li>Total body iron pool ranges from 2 to 6 gm in normal adults; about 0.5 gm is stored in the liver, 98% of which is in hepatocytes.</li>\n<li>The following features characterize severe iron overload in the body:\n<ul>\n<li>Micronodular cirrhosis</li>\n<li>Diabetes mellitus</li>\n<li>Abnormal skin pigmentation</li>\n</ul>\n</li>\n<li>Iron accumulation in hereditary forms is lifelong but the injury caused by excessive iron is slow and progressive; hence symptoms usually first appear in the fourth to fifth decades of life in men and later in women</li>\n<li>In hereditary hemochromatosis, regulation of intestinal absorption of dietary iron is abnormal, leading to net iron accumulation of 0.5 to 1 gm/year.</li>\n<li><strong>The main regulator of iron absorption is the protein hepcidin, encoded by the HAMP gene and secreted by the liver</strong></li>\n<li>Other proteins involved in iron metabolism, do so by regulating hepcidin levels. These include\n<ul>\n<li>Hemojuvelin (HJV)</li>\n<li>Transferrin receptor 2 (TFR2)</li>\n<li>HFE, the product of the hemochromatosis gene.</li>\n</ul>\n</li>\n<li><strong>Decreased hepcidin synthesis</strong><strong> has a central role in the pathogenesis of hemochromatosis.</strong></li>\n<li>The adult form of hemochromatosis is almost always caused by mutations of HFE; mutation of TFR2 is far less common.</li>\n<li>Mutations in HAMP and HJV cause severe juvenile hemochromatosis</li>\n<li>Manifestations\n<ul>\n<li><strong>Deposition of hemosiderin </strong>in the following organs (in decreasing order of severity) the liver, pancreas, myocardium, pituitary gland, adrenal gland, thyroid and parathyroid glands, joints, and skin;</li>\n<li>Cirrhosis; and</li>\n<li>Pancreatic fibrosis.</li>\n</ul>\n</li>\n<li>Liver -Golden-yellow hemosiderin granules in the cytoplasm of periportal hepatocytes that stain with Prussian blue small, shrunken liver with a micronodular pattern of cirrhosis.</li>\n<li>Biochemical determination of hepatic tissue iron concentration has been the gold standard for quantitating hepatic iron</li>\n<li>The therapy of hemochromatosis involves removal of the excess body iron, best accomplished by weekly or twice-weekly phlebotomy of 500 mL (200&ndash;250 mg of iron).</li>\n<li>Chelating agents such as desferoxamine, when given parenterally, remove 10&ndash;20 mg of iron per day, which is much less than that<br />mobilized by once-weekly phlebotomy.</li>\n<li>Death may result from cirrhosis or cardiac disease.</li>\n<li>A significant cause of death is hepatocellular carcinomas.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/bbec9a4174f84c52a7c76e06d26ec169.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents with complaints of fatigue, weight loss, and heaviness in the left hypochondrium for 6 months. His hemogram and peripheral smear are given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic lymphocytic leukemia"
      },
      {
        "id": 2,
        "text": "Chronic myeloid leukemia"
      },
      {
        "id": 3,
        "text": "Acute lymphoblastic leukemia"
      },
      {
        "id": 4,
        "text": "Acute myeloid leukemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>chronic myelogenous leukemia </strong>(CML).&nbsp;</p>\n<p>In this condition, the&nbsp;<strong>peripheral smear</strong>&nbsp;contains&nbsp;<strong>neutrophils</strong>&nbsp;and their&nbsp;<strong>precursors</strong>&nbsp;of&nbsp;<strong>various sizes</strong>&nbsp;and configurations like band cells, myelocytes, metamyelocytes,&nbsp;and blasts. Hence, the histological picture is described to have <strong>garden party </strong>or<strong>&nbsp;college girl</strong> appearance.<strong>&nbsp;</strong></p>\n<p>The image given below shows the peripheral smear in CML showing garden party or college girl appearance.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8d5eaf70693448a29859e5222aafaa7a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a1e04758334842edbcaa3e45942ffc6dx1280x1117.JPEG"
    ]
  },
  {
    "text": "The images below display the gross and microscopic features of a brain tumour in a child. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medulloblastoma"
      },
      {
        "id": 2,
        "text": "Neuroblastoma"
      },
      {
        "id": 3,
        "text": "Ganglioglioma"
      },
      {
        "id": 4,
        "text": "Pilocytic astrocytoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Gross features (<strong>cystic tumor</strong>) and microscopy (<strong>microcystic and fibrillary areas</strong>) suggest <strong>pilocytic astrocytoma</strong>.</p>\n<p><strong>Pilocytic astrocytomas </strong>typically occur in children and young adults. It is located in the <strong>cerebellum, </strong>floor, and walls of the third<strong> ventricle, </strong>the optic nerves, and cerebral hemispheres. It is often <strong>cystic. </strong>Tumors are often biphasic, with both loose <strong>microcystic </strong>and <strong>fibrillary areas. </strong>Bipolar cells with long, thin \u201chairlike\u201d processes that are <strong>GFAP-positive</strong> and form dense fibrillary meshwork are seen.</p>\n<p><strong>Rosenthal fibers </strong>and <strong>eosinophilic granular bodies </strong>are characteristic findings. Necrosis and brisk mitotic activity are uncommon.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/005ccbd6cc7849a88f37b29361bddb9d.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy presents with weight loss, fever, and a painless swelling in the area of his jaw. CBC reveals anaemia and lymphocytosis. Biopsy findings from the swelling are shown in the image below. Which of the following is not true about this patient\u2019s condition?",
    "choices": [
      {
        "id": 1,
        "text": "All forms of this tumour are associated with translocations of the MYC gene"
      },
      {
        "id": 2,
        "text": "Endemic  forms are latently infected with EBV"
      },
      {
        "id": 3,
        "text": "Tumor exhibits a high mitotic index"
      },
      {
        "id": 4,
        "text": "Neoplastic cells are usually BCL2 positive"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical presentation and biopsy findings point to a diagnosis of <strong>Burkitt's lymphoma.</strong> Neoplastic cells in Burkitt's lymphoma are usually <strong>BCL2 negative.</strong></p>\n<p>The<strong>&nbsp;</strong>biopsy image shows the <strong>classical finding</strong> of <strong>Burkitt's lymphoma</strong> called the <strong>starry sky appearance.</strong></p>\n<p>Tumour cells show multiple<strong>&nbsp;small nucleoli,&nbsp;</strong>minimal cytoplasm and<strong>&nbsp;a high mitotic index</strong>. They are closely apposed to each other forming a dark blue background (sky).</p>\n<p>The macrophages get stuffed in between along with cellular debris. They are called&nbsp;<strong>tingible body macrophages.</strong>&nbsp;Upon fixation, the cytoplasm of these phagocytes washes away leaving behind white spaces filled with debris (the stars)<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/a70c80ec6f5347409527c57dcd102ed0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/621f51b06c25459e989f496e5de2b48bx1280x613.JPEG"
    ]
  },
  {
    "text": "A 40-year-old female presents with a worsening headache for 8 months. A left sub frontal mass is resected. Microscopy is as seen below and tumor cells express progesterone receptors.  What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Low grade glioma"
      },
      {
        "id": 2,
        "text": "Craniopharyngioma"
      },
      {
        "id": 3,
        "text": "Meningioma"
      },
      {
        "id": 4,
        "text": "Metastasis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Microscopy shows a tumor with meningothelial whorls, syncytial cells with indistinct cell membranes and psammoma bodies. Most likely diagnosis is a meningioma.</p>\n<p><strong>Meningioma: They are predominantly benign tumors of adults, usually attached to the dura, that arise from the meningothelial cells of the arachnoid. </strong></p>\n<ul>\n<li>Meningiomas may be found along any of the external surfaces of the brain as well as within the ventricular system, where they arise from the stromal arachnoid cells of the choroid plexus.</li>\n<li>Prior radiation therapy to the head and neck, typically is a risk factor.</li>\n<li><strong>The most common cytogenetic abnormality is loss of chromosome 22, </strong>especially the long arm (22q).</li>\n<li>Meningiomas are a common lesion in the setting of NF2 (multiple sites, especially in association with acoustic neuromas or glial tumors.</li>\n<li>The surface of the mass is usually encapsulated.</li>\n<li>They may also grow <strong>en plaque</strong>, in which the tumor spreads in a sheetlike fashion along the surface of the dura. This form is commonly associated with <strong>hyperostotic reactive changes in the adjacent bone.</strong></li>\n<li>The lesions may contain <strong>numerous calcified psammoma bodies. </strong></li>\n</ul>\n<p>Histological subtypes:</p>\n<ul>\n<li>WHO Grade I \u2013 Menigothelial, fibroblastic, transitional, psammomatous, secretory, microcystic</li>\n<li>WHO Grade II- Clear cell, chordoid, atypical</li>\n<li>Grade III \u2013 Papillary, rhabdoid, anaplastic</li>\n<li><strong>Atypical meningiomas </strong>(WHO grade II/IV) - a higher rate of recurrence and more aggressive local growth</li>\n<li><strong>Anaplastic (malignant) meningioma </strong>(WHO grade III/IV) - highly aggressive tumor with the appearance of a high-grade sarcoma</li>\n<li><strong>Immunoreactive for epithelial membrane antigen</strong></li>\n<li>Keratin is restricted to lesions with the secretory pattern, and these tumors are also positive for carcinoembryonic antigen</li>\n<li>Moderate (3: 2) female predominance, usually solitary, but <strong>when present at multiple sites,\u00a0the possibility of neurofibromatosis type 2 should be considered.</strong></li>\n<li><strong>Meningiomas often express progesterone receptors</strong> and may grow more rapidly during pregnancy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/195ec458bb144d3bb61ebd95b100dade.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "During the autopsy of a 90-year-old woman, a normal-looking liver was noted. The following microscopic appearance of hepatocytes was noted. Which of the following cellular mechanisms is likely responsible for this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Nuclear pyknosis"
      },
      {
        "id": 2,
        "text": "Hypertrophy"
      },
      {
        "id": 3,
        "text": "Coagulative necrosis"
      },
      {
        "id": 4,
        "text": "Autophagocytosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows brownish&nbsp;<strong>lipofuscin granules </strong>within the liver cells. It is composed of lipid-containing residues of lysosomal digestion that are formed due to <strong>autophagocytosis.</strong></p>\n<p>Lipofuscin is a wear-and-tear pigment that is due to <strong>free radical injury</strong> to the tissue. It is prominent in the liver and heart of <strong>aging</strong> patients or patients with severe <strong>malnutrition</strong> and cancer <strong>cachexia</strong>.</p>\n<p><strong>Autophagy</strong> is a process by which the cell <strong>consumes itself.</strong>&nbsp;It involves the sequestration of cellular organelles into cytoplasmic autophagic vacuoles (<strong>autophagosomes</strong>) that fuse with lysosomes, resulting in the digestion of the enclosed material. It occurs in the following conditions:</p>\n<ul>\n<li>As a survival mechanism during nutrient deprivation and stress conditions</li>\n<li>Cancers, inflammatory bowel diseases, neurodegenerative disorders - due to dysregulation&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da0f5b808d1445af8bf47533f856d8a4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The finding of the immunohistochemistry studies of a patient with a neurodegenerative disease is given below. Identify the structure marked in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Pick body"
      },
      {
        "id": 2,
        "text": "Negri body"
      },
      {
        "id": 3,
        "text": "Lewy body"
      },
      {
        "id": 4,
        "text": "Lafora body"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image is the histological sample of the substantia nigra&nbsp;showing neurons with a <strong>Lewy body,</strong> extracellular neuromelanin, and pigment-laden macrophages&nbsp;n <strong>Parkinson's disease.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/9d5e644d004d42f5bcdc266ea03355cd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3878a090597d4761a4f3e7501bf8f292x600x525.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/596daeb07779434bbc98ac1c45dc247ax720x509.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f9bcaf689464b7cb4b4e8b289b96fcfx720x478.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/961b12dfcd564b109997145d77ad366dx1023x761.PNG"
    ]
  },
  {
    "text": "A patient was diagnosed with lymphoma. The microscopic picture is as given below. The cells seen in the image should be _______",
    "choices": [
      {
        "id": 1,
        "text": "CD 15 +"
      },
      {
        "id": 2,
        "text": "CD 20 +"
      },
      {
        "id": 3,
        "text": "CD 30 +"
      },
      {
        "id": 4,
        "text": "Bcl-6 -"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Following image shows\u00a0<strong>Reed-Sternberg cell, lymphohistiocytic variant</strong> (multiple infolded nuclear membranes, small nucleoli, fine chromatin, and abundant pale cytoplasm). It is seen in <strong>lymphocyte predominant Hodgkin\u2019s lymphoma</strong> which is <strong>CD20+ and BCL-6+</strong>.</p>\n<div class=\"page\" title=\"Page 615\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The WHO classification recognizes five subtypes of HL:</p>\n<p>1. Nodular sclerosis<br />2. Mixed cellularity<br />3. Lymphocyte-rich<br />4. Lymphocyte depletion<br />5. Lymphocyte predominance</p>\n<p>In the first four subtypes\u2014nodular sclerosis, mixed cellularity, lymphocyte-rich, and lymphocyte depletion\u2014the Reed-Sternberg cells have a similar immunophenotype (<strong>CD15+ and CD30+)</strong>. These subtypes are often lumped together as <strong>classical forms</strong> of HL.</p>\n<p>In <strong>lymphocyte predominance</strong> subtype, the Reed-Sternberg cells have a distinctive B-cell immunophenotype (<strong>CD20+ and BCL-6+</strong>\u00a0and are negative for CD15 and CD30).\u00a0Hence it is called <strong>non classical hodgkin\u2019s lymphoma.</strong></p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0e363bc63f014ede8f221a51270ee5e6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The given image is suggestive of:",
    "choices": [
      {
        "id": 1,
        "text": "Hereditary spherocytosis"
      },
      {
        "id": 2,
        "text": "Sickle cell anemia"
      },
      {
        "id": 3,
        "text": "Megaloblastic anemia"
      },
      {
        "id": 4,
        "text": "G6PD deficiency"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows the presence of <strong>Heinz bodies and bite cells </strong>suggestive of<strong>&nbsp;</strong>Glucose-6-phosphate dehydrogenase deficiency.</p>\n<p>In Glucose-6-phosphate dehydrogenase deficiency, after oxidant drug exposure, the peripheral blood smear shows red cells with <strong>precipitates of denatured globin&nbsp;</strong>which are known as <strong>Heinz bodies</strong>.&nbsp;</p>\n<p>As the <strong>splenic macrophages pluck </strong>out these inclusions, <strong>bite cells&nbsp;</strong>similar to the one in this smear are produced.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6f1e6c5c69f543ed95b1c2975adff535.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A diabetic patient presents with bloody nasal discharge, orbital swelling, and pain. The culture of Periorbital pus showed the following appearance. The most probable organism is",
    "choices": [
      {
        "id": 1,
        "text": "Rhizopus"
      },
      {
        "id": 2,
        "text": "Mucor"
      },
      {
        "id": 3,
        "text": "Absidia"
      },
      {
        "id": 4,
        "text": "Aspergillus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows septate hyphae showing&nbsp;<strong>dichotomous branching with typical conidiophore seen in microscopy&nbsp;</strong>which is characteristic of <strong>aspergillus infection.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cfc5c597bf23423d8a86d3d2d25e5a97.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The given egg is of:",
    "choices": [
      {
        "id": 1,
        "text": "Schistosoma haematobium"
      },
      {
        "id": 2,
        "text": "Schistosoma mansoni"
      },
      {
        "id": 3,
        "text": "Schistosoma japonicum"
      },
      {
        "id": 4,
        "text": "Schistosoma intercalatum"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Given egg is <strong>elongated with lateral spine.</strong> Hence it is an <strong>egg of Schistosoma mansoni</strong>.</p>\n<p>Species differentiation of Schistosoma can be done based on the location of spine as follows.</p>\n<ul>\n<li><strong>Terminal spine</strong>: Schistosoma hematobium</li>\n<li><strong>Lateral spine</strong>: Schistosoma mansoni</li>\n<li><strong>Round with small lateral knob</strong> or&nbsp;<strong>Rudimentary spine</strong>: Schistosoma japonicum.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f9e9f0d6d33f414e89e7e987c0f342a6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female patient presents with dry eyes,  dry mouth, and difficulty swallowing solid food. Examination reveals enlargement of parotid glands and dryness of buccal mucosa. Laboratory examination shows the presence of both SS-A and SS-B antibodies. The histopathological image of the salivary gland is given below. All are true about this condition, except ______.",
    "choices": [
      {
        "id": 1,
        "text": "About 75% of patients have rheumatoid factor"
      },
      {
        "id": 2,
        "text": "Patients are at high risk for development of B-cell lymphomas"
      },
      {
        "id": 3,
        "text": "Glomerular lesions are common"
      },
      {
        "id": 4,
        "text": "Lacrimal and salivary glands are mainly involved"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most likely diagnosis is a 55-year-old female patient with <strong>dry eyes, dry mouth</strong>, difficulty swallowing solid food, and the findings such as enlarged parotid gland, dry buccal mucosa, and antibodies <strong>positive</strong> for <strong>SS-A</strong> and<strong> SS-B</strong> is&nbsp;<strong>Sjogren's syndrome.&nbsp; </strong>The histopathology shows the<strong>&nbsp;focal lymphoplasmacytic infiltration </strong>in the minor salivary gland. <strong>Glomerular lesions </strong>are <strong>extremely rare </strong>in Sj&ouml;gren syndrome.</p>\n<p><strong>Sj&ouml;gren's syndrome</strong>&nbsp;is a chronic disease wherein the lacrimal and salivary glands undergo immunologically-mediated destruction. This leads to the characteristic features of dry eyes (keratoconjunctivitis sicca) and dry mouth (xerostomia). It can manifest as primary or secondary. Primary is an isolated form known as sicca syndrome. It is characterized by decreased tears and saliva. The salivary glands and lacrimal glands get infiltrated with lymphocytes and undergo fibrosis. The secondary form is associated with other autoimmune disorders.&nbsp;</p>\n<p>Clinically, it is more common in<strong> women</strong> between <strong>50-60 years</strong>. They present with a blurring of vision, burning, itching of the eyes, <strong>difficulty swallowing solid foods,</strong> dryness of the buccal mucosa, and <strong>parotid gland enlargement.</strong>&nbsp;</p>\n<p>Antibodies directed against two ribonucleoprotein antigens-&nbsp;<strong>SS-A (Ro) and SS-B (La) </strong>are detected in almost all patients with Sjogren's syndrome.&nbsp;<strong>Rheumatoid factor</strong> is seen in about <strong>75%</strong> of the patients.&nbsp;<strong>ANA&nbsp;</strong>is also often detected on immunofluorescence assay. A<strong> labial&nbsp;biopsy</strong> is useful and histology of salivary glands shows<strong> lymphocytic infiltration.&nbsp;</strong></p>\n<p>Patients are at high risk for the development of<strong> B-cell lymphomas.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4c3527d81e7949d78d528eb379c512cd.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents with abdominal pain and diarrhea. The given trophozoite stage is found in the stool sample. What is the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Entamoeba histolytica"
      },
      {
        "id": 2,
        "text": "Cyclospora"
      },
      {
        "id": 3,
        "text": "Balantidium coli"
      },
      {
        "id": 4,
        "text": "Isospora belli"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows the trophozoite stage of <em><strong>Balantidium coli</strong></em>. It is the <strong>only ciliated pathogenic protozoa</strong> infecting humans and is present in the <strong>large intestine</strong> as a<strong> commensal</strong>.<strong> </strong>It is the<strong> largest </strong>protozoan parasite of humans.</p>\n<p><strong>Trophozoite:</strong></p>\n<ul>\n<li>Large <strong>ovoid </strong>cell enclosed within a delicate pellicle showing longitudinal striations.</li>\n<li>Has a narrow anterior end and a broad posterior end.</li>\n<li>The cell has 2 nuclei&mdash;a large kidney-shaped <strong>macronucleus </strong>and a small <strong>micronucleus </strong>lying in its concavity.</li>\n<li>1 or 2<strong> contractile vacuoles </strong>and<strong> </strong>several<strong> food vacuoles&nbsp;</strong>are present in the cytoplasm</li>\n<li>There is a groove (<strong>peristome</strong>) at the anterior end that leads to the mouth (<strong>cytostome</strong>), and a short funnelshaped gullet (<strong>cytopharynx</strong>).</li>\n<li>A small anal pore (<strong>cytopyge</strong>) is present posteriorly.</li>\n<li>The cilia around the mouth are larger (<strong>adoral cilia</strong>)</li>\n<li>Lives in the <strong>large intestine </strong>and feeds on cell debris, bacteria, starch grains, and other particles.</li>\n<li>The trophozoite is <strong>actively motile</strong> due to the presence of short delicate <strong>cilia</strong> over the entire surface of the body. The <strong>invasive stage</strong> of the parasite is found in dysenteric stool.</li>\n</ul>\n<p><strong>Cyst:</strong></p>\n<ul>\n<li>It is <strong>spherical </strong>and measures 40&ndash;60 &mu;m in diameter</li>\n<li>A thick and transparent<strong> double-layered wall surrounds it</strong></li>\n<li>The cytoplasm is granular and has the <strong>macronucleus, micronucleus, </strong>and<strong> vacuoles</strong> present.</li>\n<li>The cyst is the <strong>infective stage </strong>of B. coli and is found in chronic cases and carriers.</li>\n</ul>\n<p><strong>Balantidiasis</strong> is a zoonosis that is mostly asymptomatic. <strong>Pigs</strong> are the definitive hosts and man is an accidental host. Symptomatic disease presents with diarrhea or dysentery. The presence of intestinal ulcers and submucosal abscesses resembles amoebiasis.</p>\n<p>The following image shows the trophozoite form of the Balantidum coli.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c05e8111776e488ab4c7c30f14f46c2f.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/6e8a76673cae4667938f9ff64baede8ax263x285.PNG"
    ]
  },
  {
    "text": "A young man presented with hypertensive episodes, bloody stools and cutaneous nodules. He has a past history of hepatitis B infection. Vasculitis was suspected and a biopsy of the vessel was done. The histopathology of the tissue from the vessel is shown below. Identify the type of necrosis.",
    "choices": [
      {
        "id": 1,
        "text": "Fibrinoid necrosis"
      },
      {
        "id": 2,
        "text": "Gangrenous necrosis"
      },
      {
        "id": 3,
        "text": "Fat necrosis"
      },
      {
        "id": 4,
        "text": "Caseous necrosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>polyarteritis nodosa</strong> and the above image depicts <strong>fibrinoid necrosis. </strong>It is seen in vasculitis like polyarteritis nodosa&nbsp;<strong>(PAN)</strong> in which the small and medium-sized blood vessels are affected as a result of<strong> immune complex deposition.</strong></p>\n<p><strong>Polyarteritis nodosa</strong> is a <strong>medium</strong> and<strong> small-sized </strong>vessel vasculitis typically affecting the<strong> renal </strong>and<strong> visceral arteries, sparing pulmonary </strong>vessels.&nbsp;Patients present with variable symptoms including&nbsp;accelerated<strong> hypertension</strong>, abdominal pain,<strong> gastrointestinal bleeding</strong>, myalgias and cutaneous nodules. It is often associated with <strong>chronic hepatitis B infection,</strong> which causes the HBsAg-HbsAb complexes to deposit in affected vessels. Clinical manifestations are a result of ischemia and infarction of organs and tissues that are affected.</p>\n<p>The&nbsp;<strong>diagnosis</strong>&nbsp;is based on the histopathological findings seen on a&nbsp;<strong>biopsy</strong>&nbsp;of the involved organs. Diagnosis can also be made by the&nbsp;<strong>demonstration of aneurysms</strong>&nbsp;of small and medium-sized arteries in the renal, hepatic, and visceral vasculature.&nbsp;</p>\n<p><strong>Fibrinoid necrosis</strong>&nbsp;occurs in<strong>&nbsp;blood vessels&nbsp;</strong>in which&nbsp;the antigen-antibody<strong>&nbsp;complexes</strong>&nbsp;get deposited in the blood vessel walls. These&nbsp;complexes elicit an&nbsp;<strong>immune reaction</strong>&nbsp;leading to cell injury and leakage of&nbsp;<strong>fibrin</strong>&nbsp;and plasma proteins around the blood vessel and giving a<strong>&nbsp;circumferential&nbsp;</strong>pinkish appearance of&nbsp;<strong>necrosis.&nbsp;</strong></p>\n<p>It is treated with <strong>immunosuppressive agents</strong> and has a high risk of mortality if left untreated.</p>\n<p>The image below shows<strong>&nbsp;fibrinoid necrosis&nbsp;</strong>with intraluminal thrombosis in an artery of a patient with polyarteritis nodosa.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c360aaef344a4df68001ca5eb84b3dc6.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f86d7359c3454a7ab56cf5791f91fba7x720x494.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8001577b3fc448f98708be771d6fb3f5x779x473.PNG",
      "https://cdn1.dailyrounds.org/uploads/f72f71c7599547039b3dffd7e8a169a8x360x466.PNG",
      "https://cdn1.dailyrounds.org/uploads/f6157eca63c8456097f708897baab6fex401x334.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f4712b5bb971467ca088383212494cbdx1280x963.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/01c0b7c23c204b8d94c40efd41100e01x463x322.PNG"
    ]
  },
  {
    "text": "Histopathology of a patient who had pulmonary edema shows the following. The cells seen within the alveolar spaces are:",
    "choices": [
      {
        "id": 1,
        "text": "Stem cells"
      },
      {
        "id": 2,
        "text": "Macrophages"
      },
      {
        "id": 3,
        "text": "Type II pneumocytes"
      },
      {
        "id": 4,
        "text": "Lymphocytes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li><strong>Heart failure cells</strong>&nbsp;are hemosiderin-laden<strong> macrophages</strong>.</li>\n<li>In cardiac failure, red cells and plasma proteins extravasate into the edema fluid within the alveolar spaces, where they are phagocytosed and digested by macrophages, which store the iron recovered from hemoglobin in the form of hemosiderin.</li>\n<li><strong>These hemosiderin-laden macrophages (also known as</strong>&nbsp;<strong>heart failure cells</strong>) are telltale signs of previous episodes of pulmonary edema.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8924b99965a14199a3c0b674457761ac.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Following copper penny bodies are feature of",
    "choices": [
      {
        "id": 1,
        "text": "Chromomycosis"
      },
      {
        "id": 2,
        "text": "Fonseca\u2019s disease"
      },
      {
        "id": 3,
        "text": "Pedroso\u2019s disease"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sclerotic bodies (Copper penny/Medler bodies)</strong> are features of <strong>Chromoblastomycosis also known as Fonseca&rsquo;s disease or Pedroso&rsquo;s disease or verrucous dermatitis.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d43d09a527dd4916b37c23cbeee0637a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the condition where the cells marked in the image is seen:",
    "choices": [
      {
        "id": 1,
        "text": "Acute rheumatic fever"
      },
      {
        "id": 2,
        "text": "Rhabdomyoma"
      },
      {
        "id": 3,
        "text": "Infective endocarditis"
      },
      {
        "id": 4,
        "text": "Myxoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The slide shows<strong>&nbsp;Anitschkow cells or caterpillar cells </strong>which are<strong>&nbsp;pathognomic for RF</strong>.</p>\n<ul>\n<li>During acute rheumatic fever, focal inflammatory lesions are found in various tissues.</li>\n<li>Distinctive lesions in the heart -&nbsp;<strong>Aschoff bodies</strong>, consisting of foci of T lymphocytes, occasional plasma cells, and plump activated macrophages called&nbsp;<strong>Anitschkow cells&nbsp;</strong>(pathognomonic for RF)</li>\n<li>These Anitschkow cells have abundant cytoplasm and central round-to-ovoid nuclei (occasionally binucleate) in which the <strong>chromatin</strong> condenses into a <strong>central, slender, wavy ribbon </strong>(hence the designation <strong>&ldquo;caterpillar cells&rdquo;</strong>)</li>\n</ul>\n<p>&nbsp;</p>\n<p>Histology showing Aschoff bodies with Anitschkow cells in Rheumatic heart disease.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3adab836bb4e4ea693d4ed91b92f4161.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/32a49c7282344974b87c3e78b1301cb1x801x537.PNG"
    ]
  },
  {
    "text": "A 30-year-old man comes with multiple circular, dry, scaly, itchy lesions on the scalp.  On further examination, it is seen that hair is involved but nails are spared. Scrapings from the lesion are inoculated and examined microscopically. Identify the dermatophyte based on the macroconidia seen in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Trichophyton"
      },
      {
        "id": 2,
        "text": "Microsporum"
      },
      {
        "id": 3,
        "text": "Epidermophyton"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario points to the diagnosis of <strong>tinea capitis</strong> and the image showing <strong>large</strong>&nbsp;<strong>spindle-shaped macroconidia</strong>&nbsp;is a feature of&nbsp;<strong>Microsporum</strong>.</p>\n<div class=\"page\" title=\"Page 609\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Dermatophytosis</strong> (commonly called tinea or ringworm) refers to infection of keratinized structures (the skin, hair, and nails) caused by a group of keratinophilic fungi, called the <strong>dermatophytes</strong>.</p>\n<p>Dermatophytes are classified into 3 types:</p>\n<ul>\n<li><strong>Trichophyton</strong>&nbsp;infects <strong>skin, hair,</strong> and<strong> nails</strong>. The species include T. rubrum, T. mentagrophytes, T. tonsurans, T. schoenleinii, T. violaceum, etc. Microconidia &gt; Macroconidia</li>\n<li><strong>Microsporum</strong>&nbsp;infects <strong>only hair</strong> and<strong> skin</strong> but, not the nails. The species include M. gypseum, M. canis, and M. nanum. <strong>Macroconidia&gt; Microconidia.</strong></li>\n<li><strong>Epidermophyton</strong>&nbsp;infects <strong>only skin</strong> and<strong> nails</strong>,&nbsp;not hair.&nbsp;Floccosum is the only species in this genus. Only Macroconidia.</li>\n</ul>\n<p>Clinical features of infection by Microsporum include:</p>\n<ul>\n<li><strong>Skin lesions</strong> in the skin tend to be <strong>circular, dry, erythematous, scaly,</strong> and <strong>itchy</strong>.</li>\n<li>Hair lesions include kerion, scarring, and alopecia.</li>\n</ul>\n<div class=\"page\" title=\"Page 610\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is established by clinical features, the use of <strong>Wood's lamp</strong>, and laboratory investigations such as <strong>microscopic examination </strong>and<strong> culture characteristics</strong>.</p>\n<div class=\"page\" title=\"Page 611\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 611\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Microscopic examination</strong> of material teased out from the fungal colony (culture mount) or material taken on cellotape (cellotape mount) is observed for identification of the species. It is observed for the presence and type of<strong> hyphae and conidia</strong>. Conidia (asexual spores) are of two types: small unicellular <strong>microconidia</strong> and larger septate <strong>macroconidia</strong>.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/194b8160d2ac40118c802e01dce4b5f7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman presented to the gynecology OPD with a history of abdominal pain and distension of abdomen. Ultrasound imaging revealed tumor in the right ovary. Serum level of inhibin was raised. The histopathology of the tumor is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Granulosa cell tumor"
      },
      {
        "id": 2,
        "text": "Sertoli cell tumor"
      },
      {
        "id": 3,
        "text": "Brenner's tumor"
      },
      {
        "id": 4,
        "text": "Embryonal carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and histopathology showing <strong>Call-Exner bodies</strong> are suggestive of <strong>granulosa cell tumor</strong>.</p>\n<p>Call-Exner bodies are\u00a0small, distinctive, <strong>glandlike </strong>structures filled with an <strong>acidophilic material</strong> resembling\u00a0immature follicles. Additionally, small, cuboidal to polygonal cells are seen which may grow in anastomosing cords, sheets, or strands.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5d6ce021173f4b8d9d8a71df4f9e7dcd.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d1825a13f1974055a04ee6ed705c0ee9x1280x1145.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b130d296dc5845378c6152943af51a51x1280x1145.JPEG"
    ]
  },
  {
    "text": "The below given image shows result of hair perforation test. The organism likely to show below given appearance is",
    "choices": [
      {
        "id": 1,
        "text": "Trichophyton rubrum"
      },
      {
        "id": 2,
        "text": "Trichophyton violaceum"
      },
      {
        "id": 3,
        "text": "Trichophyton schoenleinii"
      },
      {
        "id": 4,
        "text": "Trichophyton mentagrophytes"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Image shows <strong>surface erosion</strong> of <strong>shaft</strong> caused by <strong>Trichophyton mentagrophytes.</strong></p>\n<p><strong>Hair perforation test:</strong></p>\n<ul>\n<li>Done to <strong>differentiate Trichophyton rubrum</strong> from <strong>mentagrophytes.</strong></li>\n<li>A few strands of human hair are placed in a Petri dish with 20 ml of distilled water and autoclaved.</li>\n<li>A few drops of sterile 10% yeast extract and a few fragments of the test fungus are added to the hair strands.</li>\n<li>Incubated at 25<sup>0</sup>C for 2-3 weeks.</li>\n<li>Hair is removed and examined microscopically in a lactophenol cotton blue stained wet preparation.</li>\n<li><strong>T.mentagrophytes</strong> causes <strong>surface erosion</strong> of the <strong>shaft</strong> resulting in <strong>wedge shaped</strong> appearance of the <strong>shaft.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b375aa6d1a3a41589f07eb3a163c2076.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "10 year old child presents with bilateral cervical lymphadenopathy. Lymph node biopsy was performed, which shows cells as in the given figure. Which of the following is true regarding the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Hodgkin lymphoma; EBV and embryo cell"
      },
      {
        "id": 2,
        "text": "Non-Hodgkin lymphoma; HIV and giant B cell"
      },
      {
        "id": 3,
        "text": "Tb; Mycobacteria and granuloma"
      },
      {
        "id": 4,
        "text": "Hodgkin lymphoma; EBV and Reed Sternberg cell"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The sine qua non (an essential condition) of Hodgkin lymphoma is the <strong>Reed-Sternberg (RS) cell, </strong>a very large cell (15 to 45 &mu;m in diameter) with an enormous multilobate nucleus, exceptionally prominent nucleoli, and abundant, usually slightly <strong>eosinophilic, cytoplasm</strong>. Particularly characteristic are cells with <strong>two mirror image nuclei or nuclear lobes, each containing a large (inclusion-like) acidophilic nucleolus surrounded by a clear zone</strong>, features that impart an <strong>owl-eye appearance.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/90a5069eea2044a591b00fece16b837f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "False statement about the organism shown in the image given below is",
    "choices": [
      {
        "id": 1,
        "text": "Sexual transmission present"
      },
      {
        "id": 2,
        "text": "Cysts are infective form"
      },
      {
        "id": 3,
        "text": "Chicken like epithelium is characteristic"
      },
      {
        "id": 4,
        "text": "Jerky or twitching motility"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows <strong>Trichomonas</strong>. It has <strong>no cystic stage. </strong></p>\n<p><strong>Identification features of Trichomonas vaginalis:</strong></p>\n<ul>\n<li>Pear-shaped or ovoid</li>\n<li>Short undulating membrane reaching upto the middle of the body</li>\n<li>It has <strong>four anterior flagella</strong> and fifth running along the outer margin of the undulating membrane, which is supported at its base by <strong>a flexible rod, costa</strong></li>\n<li>A prominent <strong>axostyle</strong> runs throughout the length of the body and <strong>projects posteriorly like a tail</strong></li>\n<li>The cytoplasm shows prominent <strong>siderophillic granules</strong>, which are most numerous alongside the axostyle and costa</li>\n<li><strong>Jerky or twitching type of mobility</strong></li>\n</ul>\n<p><strong>The below image shows: </strong>1-anterior flagella, 2-kinetosomes, 3-parabasal body, 4-costa, 5-parabasal fibers, 6-undulating membrane, 7-posterior flagellum, 8-hydrogenosomes, 9-axostyle, 10-nucleus, 11-pelta.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/731857f9357940c6b6a7b031c45d9099.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/92dc7510868d4bd795867f82173c1baax387x225.PNG"
    ]
  },
  {
    "text": "The appearance of fibers in the histological image below is commonly seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Meningioma"
      },
      {
        "id": 2,
        "text": "Pilocytic astrocytoma"
      },
      {
        "id": 3,
        "text": "Medulloblastoma"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows <strong>Rosenthal fibers,</strong> which are commonly associated with <strong>pilocytic astrocytoma</strong>.</p>\n<p>A <strong>Rosenthal fiber</strong> is a thick, elongated, worm-like, or <strong>\"corkscrew\" eosinophilic</strong> bundle that is found on <strong>H&amp;E staining </strong>of the <strong>brain</strong> in the presence of <strong>long-standing</strong> <strong>gliosis</strong>, occasional <strong>tumors</strong>, and some <strong>metabolic disorders</strong>. It is usually associated with<strong> pilocytic astrocytoma</strong> (more common) or&nbsp;<strong>Alexander's</strong> <strong>disease</strong> (a rare leukodystrophy).</p>\n<p><strong>Pilocytic astrocytoma:</strong></p>\n<ul>\n<li><strong>Pilocytic astrocytoma</strong> or <strong>juvenile pilocytic astrocytoma</strong> or <strong>cystic cerebellar astrocytoma</strong> is a brain tumor that occurs more often in <strong>children</strong> and <strong>young adults</strong> (in the first 20 years of life).</li>\n<li>These tumors are usually <strong>slow-growing and benign</strong>. The neoplasms are associated with the formation of <strong>a single (or multiple) cyst(s)</strong>&nbsp;and can become very large.</li>\n<li>Diagnosis can be made on the basis of <strong>brain</strong>&nbsp;<strong>MRI</strong> findings.&nbsp;<strong>Surgery</strong> is usually the treatment of choice. <strong>Total resection</strong> is often possible.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/697705b4b03c4d8abcd837b7e9d4aa9f.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The following image shows:",
    "choices": [
      {
        "id": 1,
        "text": "Wuchereria bancrofti"
      },
      {
        "id": 2,
        "text": "Brugia malayi"
      },
      {
        "id": 3,
        "text": "Loa loa"
      },
      {
        "id": 4,
        "text": "Onchocerca volvulus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows a <strong>sheathed microfilaria with 2 nuclei at the tail</strong>&nbsp;which is characteristic of <em><strong>Brugia malayi.</strong></em></p>\n<p><em><strong>Brugia malayi </strong></em>is<strong> endemic</strong> to<strong> Kerala (most common)</strong>, Assam, Orissa, Madhya Pradesh and West Bengal.</p>\n<p><em>Brugia malayi</em> are <strong>smaller</strong> in <strong>size</strong> compared to <strong>microfilaria</strong> of <em>W. bancrofti.&nbsp;</em>It shows <strong>kinks</strong> and <strong>secondary curves</strong>. Cephalic space is longer and carries double stylets at the anterior end. The <strong>nuclear column</strong> appears <strong>blurred</strong> in <strong>Giemsa-stained films</strong>. The tip of the tail carries <strong>2 distinct nuclei, one terminal</strong> and the <strong>other subterminal</strong>.</p>\n<p>The below image shows the microfilaria of <em>Brugia malayi.</em></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7be86431dad74aa0be707db5970195e8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20a47d9263a748a991fc73c3dd63d65bx600x688.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2ef67265f59847469de05e2d636b55d7x1280x3830.JPEG"
    ]
  }
];
        let quizName = 'Slides Test Ii';
        const quizFilename = 'slides-test-ii-24445208.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2018-19"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>