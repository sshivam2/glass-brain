<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Antihypertensive Drugs - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pharmacology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the most appropriate first-line medication for an elderly patient with hypertension?",
    "choices": [
      {
        "id": 1,
        "text": "Hydrochlorothiazide"
      },
      {
        "id": 2,
        "text": "Furosemide"
      },
      {
        "id": 3,
        "text": "Chlorthalidone"
      },
      {
        "id": 4,
        "text": "Spironolactone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most appropriate first-line antihypertensive among the given drugs is <strong>chlorthalidone</strong>.</p>\n<p>Thiazide diuretics are recommended as one of the first-line antihypertensive drugs for elderly patients without any comorbidities. Among them, guidelines recommend chlorthalidone over hydrochlorothiazide<strong>&nbsp;</strong>because of its <strong>longer duration of action</strong>.&nbsp;</p>\n<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>First-choice drugs </strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">used in the treatment of hypertension in patients without any comorbidities include:</span></div>\n<ul class=\"listtype-bullet listindent1 list-bullet1\">\n<li><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>ACE inhibitors or ARBs: </strong></span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">No evidence of superiority of one class over the other. However, ACE inhibitors have a higher risk of side effects like dry cough and angioedema.</span></li>\n<li>\n<div><strong>Calcium channel blockers</strong><strong>:</strong> Extended-release, long-acting dihydropyridines are<span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"> preferred.</span>&nbsp;</div>\n</li>\n<li>\n<div><strong>Thiazide diuretics</strong><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>:</strong> Chlorthalidone is usually preferred to hydrochlorothiazide.</span></div>\n</li>\n</ul>\n<div>\n<p><strong>Loop diuretics&nbsp;</strong>like furosemide and torsemide are <strong>less effective</strong> antihypertensives than thiazides. They are not indicated for the routine management of hypertension.</p>\n</div>\n<div><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">In the presence of any associated conditions or comorbidities, the first choice drugs for the treatment of hypertension would be as follows:</span></div>\n<div>&nbsp;</div>\n<div>\n<table class=\"table-top-header\" style=\"height: 279px;\" width=\"646\">\n<tbody>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\"ace-all-bold-hthree\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>Comorbidities</strong></span></span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\"ace-all-bold-hthree\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\"><strong>First choice drugs for hypertension</strong></span></span></div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Diabetes</span></div>\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Chronic kidney disease with proteinuria</span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">ACE inhibitors or ARBs</span></div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Angina</span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Beta-blockers or calcium channel blockers</span></div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Heart failure</span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">ACE inhibitors and alpha+beta blockers (e.g., carvedilol)</span></div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Benign prostatic hyperplasia</span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">&alpha;</span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">1 b</span><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">lockers</span></div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Pregnancy</span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Labetalol</span></div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 261.765625px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Atrial fibrillation</span></div>\n</td>\n<td style=\"width: 368.25px;\">\n<div class=\"ace-line gutter-author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z ace-ltr\" dir=\"auto\"><span class=\" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxwyy7z90zx1z73zz86z8z72z3z70zvjbz81zz122znz90zz74z1z78zz67zz66zz122zz83zjz73ziz69z\">Diltiazem or verapamil</span></div>\n</td>\n</tr>\n</tbody>\n</table>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Chlorthalidone is being prescribed to an elderly patient for the management of hypertension. Which of the following side effects would not be expected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperuricemia"
      },
      {
        "id": 2,
        "text": "Hypercalcemia"
      },
      {
        "id": 3,
        "text": "Hyperkalemia"
      },
      {
        "id": 4,
        "text": "Hyperglycemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Thiazide</strong> diuretics&nbsp;cause<strong> hypokalemia</strong>.</p>\n<p>Other side effects of thiazide diuretics include <strong>hyperuricemia</strong>, <strong>hypercalcemia</strong>, <strong>hyperglycemia</strong> and&nbsp;erectile dysfunction. All thiazide diuretics cross the placenta and therefore should be <strong>avoided in pregnancy</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient on lithium therapy developed hypertension. He was started on thiazides for hypertension. After few days, he developed coarse tremors and other symptoms suggestive of lithium toxicity. Explain the likely mechanism of this interaction.",
    "choices": [
      {
        "id": 1,
        "text": "Thiazide inhibits the metabolism of lithium"
      },
      {
        "id": 2,
        "text": "Thiazides act as an add on drug to lithium"
      },
      {
        "id": 3,
        "text": "Thiazides increase the tubular reabsorption of lithium"
      },
      {
        "id": 4,
        "text": "Thiazides cause water loss therby increase lithium levels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Thiazides </strong>act by<strong> increasing</strong> the<strong> tubular rabesorption of lithium.</strong></p>\n<p>Thiazide use is accompanied by <strong>sodium loss</strong> which is <strong>compensated</strong> in a few days by increased <strong>reabsorption of Na<sup>+</sup></strong> in the proximal tubule.</p>\n<p>The kidney handles both lithium and\u00a0Na<sup>+ </sup>in the same way. Thus, along with\u00a0Na<sup>+ </sup>reabsorption, there will be an\u00a0increase in the <strong>reabsorption of\u00a0lithium</strong> also, resulting in decreased excretion of lithium.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A hypertensive patient on losartan requires an add on drug to achieve his blood pressure goal. Which of the following drugs will not increase the risk of hyperkalemia when added to his current medication?",
    "choices": [
      {
        "id": 1,
        "text": "Atenolol"
      },
      {
        "id": 2,
        "text": "Amiloride"
      },
      {
        "id": 3,
        "text": "Indapamide"
      },
      {
        "id": 4,
        "text": "Aliskiren"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Indapamide</strong> is a<strong> thiazide </strong>diuretic that<strong> increases K<sup>+</sup> excretion</strong>&nbsp;decreases the risk of hyperkalemia associated with ACE inhibitors or ARBs such as losartan.&nbsp;</p>\n<p>Option A: <strong>Beta-blockers</strong> can contribute to K<sup>+</sup> retention by <strong>decreasing renin</strong> release and further <strong>reducing aldosterone</strong> secretion. Non-selective beta-blockers may also interfere with the cellular uptake of K<sup>+</sup> ions.</p>\n<p>Option B: <strong>K<sup>+</sup> sparing diuretics</strong> like amiloride cause a decrease in K<sup>+</sup> excretion and increase the risk of <strong>hyperkalemia.</strong></p>\n<p>Option D: Aliskiren is a<strong> direct renin inhibitor</strong> and increases the risk of hyperkalemia when combined with losartan.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Long term reduction of blood pressure by thiazide diuretics is mainly by which of the following mechanisms?",
    "choices": [
      {
        "id": 1,
        "text": "Reduction in extracellular volume"
      },
      {
        "id": 2,
        "text": "Reduction in sympathetic activity"
      },
      {
        "id": 3,
        "text": "Reduction in peripheral vascular resistance"
      },
      {
        "id": 4,
        "text": "Increase in extracellular volume"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Long term</strong> reduction of blood pressure by <strong>thiazide</strong> diuretics is mainly due to a <strong>reduction in peripheral vascular resistance.</strong></p>\n<p>Thiazide diuretics <strong>initially decrease extracellular volume</strong> by their action on NaCl transporter in distal convoluted tubules in the nephrons. However, the <strong>compensatory response</strong> from activation of RAAS <strong>raises the extracellular volume</strong> returns almost to pre-treatment levels after a few weeks.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A diabetic patient is diagnosed with hypertension during his annual health check-up. What is the treatment of choice for him?",
    "choices": [
      {
        "id": 1,
        "text": "Chlorthalidone"
      },
      {
        "id": 2,
        "text": "Carvedilol"
      },
      {
        "id": 3,
        "text": "Captopril"
      },
      {
        "id": 4,
        "text": "Nifedipine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>ACE inhibitors </strong>such as captopril<strong>&nbsp;or ARBs</strong> can be considered as a <strong>treatment of choice</strong> in<strong> hypertensive patients with diabetes </strong>because of the renoprotective action. It benefits diabetic patients by <strong>reducing</strong> the <strong>risk</strong> of occurrence and progression of diabetic <strong>nephropathy</strong>.&nbsp;</p>\n<p>They are also recommended in patients with CKD irrespective of diabetes status as they can delay the progression of nephropathy.</p>\n<p>Option A: <strong>Thiazide</strong> diuretics <strong>worsen</strong> glycemic control and are not preferred in diabetic patients.</p>\n<p>Option B: <strong>Beta-blockers,</strong> especially non-selective blockers, <strong>worsen</strong> glycemic control.</p>\n<p>Option D: <strong>Calcium channel blockers</strong> have a <strong>neutral</strong> effect on glycemic control and can be used in diabetes if ACE inhibitors or ARBs cannot be given.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is diagnosed with hypertension during routine health evaluation. Which of the following is not recommended as first-line therapy for him?",
    "choices": [
      {
        "id": 1,
        "text": "Verapamil"
      },
      {
        "id": 2,
        "text": "Doxazosin"
      },
      {
        "id": 3,
        "text": "Metolazone"
      },
      {
        "id": 4,
        "text": "Quinapril"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Alpha blockers like doxazosin are not recommended as first-line therapy for uncomplicated essential hypertension.</p>\n<p>As per the European Society of Cardiology 2018 guidelines for <strong>hypertension</strong>, the classes of drugs recommended as <strong>first line therapy</strong> are:</p>\n<ul>\n<li>ACE inhibitors</li>\n<li>Angiotensin receptor blockers</li>\n<li>Calcium channel blockers</li>\n<li>Thiazide diuretics</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which class of antihypertensive drugs has a favourable effect on lipid profile?",
    "choices": [
      {
        "id": 1,
        "text": "Thiazide diuretics"
      },
      {
        "id": 2,
        "text": "Beta blockers"
      },
      {
        "id": 3,
        "text": "Alpha 1 selective blockers"
      },
      {
        "id": 4,
        "text": "Calcium channel blockers"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Alpha 1 selective blockers </strong>have a favourable effect on lipid profile. They <strong>decrease</strong> plasma concentrations of <strong>triglycerides</strong>, total <strong>LDL</strong>-cholesterol and <strong>increase HDL</strong> cholesterol.</p>\n<p>Option A: Thiazides increase plasma concentrations of triglycerides, LDL-cholesterol and total cholesterol. HDL may decrease or remain unchanged.</p>\n<p>Option B: Non-selective beta-blockers increase triglycerides and decrease HDL levels. However, total cholesterol remains unchanged.</p>\n<p>Option D: Calcium channel blockers&nbsp;have a neutral effect on the lipid profile.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Methyldopa is primarily used for which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Hypertension in pregnancy"
      },
      {
        "id": 2,
        "text": "Renovascular hypertension"
      },
      {
        "id": 3,
        "text": "Hypertension with gout"
      },
      {
        "id": 4,
        "text": "Refractory hypertension"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Methyldopa</strong> is preferred for <strong>chronic hypertension in pregnancy</strong> based on its safety and efficacy data for both mother and fetus.</p>\n<p>Antihypertensives found <strong>safe</strong>&nbsp;<strong>in pregnancy</strong>:</p>\n<ul>\n<li>Hydralazine</li>\n<li>Methyldopa</li>\n<li>Dihydropyridine CCBs like nifedipine, amlodipine - however, they should be stopped before labor as they weaken the uterine contractions</li>\n<li>Cardioselective beta-blockers and those with intrinsic sympathomimetic activity</li>\n</ul>\n<p>Antihypertensives to be <strong>avoided</strong> <strong>in pregnancy</strong>:</p>\n<ul>\n<li>ACE inhibitors, Angiotensin II receptor blockers (ARB)</li>\n<li>Diuretics</li>\n<li>Nonselective beta-blockers</li>\n<li>Nitroprusside&nbsp;</li>\n</ul>\n<p><strong>Labetalol</strong> is considered the <strong>first-line </strong>agent for&nbsp;<strong>hypertensive emergency </strong>in pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman with hypertension, on treatment with methyldopa, comes for routine evaluation. She is found to have a positive Coombs test but is asymptomatic. What is the next course of action for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Immediately stop methyldopa"
      },
      {
        "id": 2,
        "text": "Taper the dose of methyldopa"
      },
      {
        "id": 3,
        "text": "Monitor for signs of hemolysis"
      },
      {
        "id": 4,
        "text": "Switch to labetalol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The best course of action for the patient is <strong>close monitoring</strong> for any signs or symptoms of <strong>hemolysis</strong>.</p>\n<p>Coombs test is done to test the presence of antibodies against Rh antigens on the red blood cells, which result in hemolysis. Positive Coombs test&nbsp;is seen in&nbsp;20% of patients who receive methyldopa.</p>\n<p>However, only&nbsp;1-5% of such patients develop hemolytic anemia and hence, a positive Coombs test is not a necessary indication for stopping methyldopa treatment.&nbsp;They must be monitored closely and any <strong>signs </strong>that indicate<strong>&nbsp;hemolytic anemia</strong> needs prompt <strong>discontinuation of the drug.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about clonidine?",
    "choices": [
      {
        "id": 1,
        "text": "Reduction in central sympathetic flow"
      },
      {
        "id": 2,
        "text": "Prazosin completely antagonizes its action"
      },
      {
        "id": 3,
        "text": "Sedation and xerostomia are common side effects"
      },
      {
        "id": 4,
        "text": "It can be combined with vasodilators"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Prazosin does not antagonize the effect of clonidine. <strong>Prazosin</strong> is a selective<strong>&nbsp;&alpha;1 receptor antagonist </strong>whereas<strong>&nbsp;clonidine</strong> is an <strong>alpha 2 receptor partial agonist. </strong></p>\n<p>On <strong>oral</strong> administration, clonidine stimulates <strong>alpha 2A receptors</strong> in CNS and results in decreased central sympathetic flow. This causes a&nbsp;<strong>decrease in BP</strong>.</p>\n<p>However, on<strong> IV</strong> administration <strong>postsynaptic alpha 2B receptors</strong> are activated at higher doses which cause a<strong>&nbsp;transient rise in blood pressure. </strong>It also causes significant reductions in HDL lipids, apolipoproteins AI and AII.</p>\n<p>It can be combined with vasodilators but has to be used with caution as potentiation of each other's actions can occur.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with complaints of multiple episodes of intermittent palpitations, throbbing headache, and sweating. Blood pressure measured during one of these episodes is 210/120 mm Hg. The results of 24-hour urinary metanephrines were inconclusive. Which of the following could be used for diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Phentolamine"
      },
      {
        "id": 2,
        "text": "Phenoxybenzamine"
      },
      {
        "id": 3,
        "text": "Clonidine"
      },
      {
        "id": 4,
        "text": "Prazosin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette<strong>&nbsp;</strong>is suggestive of&nbsp;<strong>pheochromocytoma</strong>. When first-line investigations like measurement of 24-hour urinary metanephrines are inconclusive, <strong>clonidine suppression test </strong>is used in the diagnosis of pheochromocytoma.</p>\n<p>An <strong>oral</strong> dose of <strong>0.3 mg</strong>&nbsp;clonidine is given, followed by the measurement of norepinephrine (NE) concentration at 3 hours. A concentration of &gt;500 pg/mL of NE indicates a positive test.</p>\n<p>Option A: Phentolamine test is not recommended due to its low sensitivity and specificity.</p>\n<p>Options B and D: <strong>Phenoxybenzamine</strong> and <strong>prazosin</strong> are used in the <strong>treatment</strong> of pheochromocytoma but have no role in its diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a selective imidazoline receptor agonist?",
    "choices": [
      {
        "id": 1,
        "text": "Clonidine"
      },
      {
        "id": 2,
        "text": "Methyldopa"
      },
      {
        "id": 3,
        "text": "Moxonidine"
      },
      {
        "id": 4,
        "text": "Brimonidine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Moxonidine </strong>is a selective<strong> imidazoline </strong>(I<sub>1</sub>) receptor<strong> agonist.</strong></p>\n<p>It&nbsp;is indicated as a second line agent in the long-term management of <strong>hypertension</strong>. It also has weak alpha 2 agonist action.</p>\n<p><strong>Rilmenidine</strong> is another selective imidazoline receptor agonist.</p>\n<p>Option&nbsp;A: <strong>Clonidine</strong> is an alpha 2 receptor partial agonist and has additional imidazoline (I<sub>1</sub>) receptor agonist action. But the <strong>main</strong> mode of <strong>action</strong> is through <strong>alpha 2 agonism</strong>.</p>\n<p>Option B: Methyldopa does not have any action on imidazoline receptors</p>\n<p>Option D: Brimonidine is a congener of clonidine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antihypertensives are not used in pregnancy?",
    "choices": [
      {
        "id": 1,
        "text": "Alpha methyldopa"
      },
      {
        "id": 2,
        "text": "Hydralazine"
      },
      {
        "id": 3,
        "text": "Propranolol"
      },
      {
        "id": 4,
        "text": "Labetalol"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Propranolol is a non-selective beta-blocker and is not safe for use during pregnancy.</p>\n<p>Antihypertensives to be <strong>avoided</strong> in pregnancy:</p>\n<ul>\n<li>ACE inhibitors, ARBS</li>\n<li>Diuretics</li>\n<li>Nonselective beta-blockers</li>\n<li>Nitroprusside</li>\n</ul>\n<p>Antihypertensives found to be <strong>safe</strong> in pregnancy:</p>\n<ul>\n<li>Hydralazine</li>\n<li>Methyldopa</li>\n<li>Dihydropyridine CCBs: should be stopped before labor as they weaken the uterine contractions</li>\n<li>Cardioselective beta-blockers and those with intrinsic sympathomimetic activity: may be used as a&nbsp;last choice</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs reduces blood pressure primarily by directly decreasing the heart rate?",
    "choices": [
      {
        "id": 1,
        "text": "Propranolol"
      },
      {
        "id": 2,
        "text": "Prazosin"
      },
      {
        "id": 3,
        "text": "Alpha methyl dopa"
      },
      {
        "id": 4,
        "text": "Nitroprusside sodium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Propranolol</strong>&nbsp;reduces blood pressure by <strong>directly decreasing</strong> the<strong> heart rate</strong>. It is a <strong>nonselective beta-blocker</strong> and blocks the beta 1 receptor of the heart (SA node) thus reducing the heart rate and blood pressure.</p>\n<p>It also <strong>reduces renin secretion</strong> by blocking beta 1 receptors in JG cells. Reduction in renin release also contributes to blood pressure reduction.</p>\n<p>Option B: <strong>Prazosin </strong>is a <strong>selective alpha 1&nbsp;blocker</strong> and dilates both arteries and veins and may cause reflex tachycardia.</p>\n<p>Option C: <strong>Alpha methyldopa</strong> is a selective <strong>alpha 2 receptor</strong> agonist. Alpha 2 receptors are autoreceptors present on the presynaptic membrane. On stimulation, central sympathetic discharge is reduced. Alpha methyldopa can indirectly reduce heart rate.</p>\n<p>Option D: Nitroprusside is a vasodilator and may cause reflex tachycardia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The blood pressure of a patient undergoing a coronary artery bypass surgery suddenly rises to 170/110mm Hg. Which of the following can you administer intravenously for immediate management?",
    "choices": [
      {
        "id": 1,
        "text": "Nifedipine"
      },
      {
        "id": 2,
        "text": "Amlodipine"
      },
      {
        "id": 3,
        "text": "Clevidipine"
      },
      {
        "id": 4,
        "text": "Felodipine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Clevidipine </strong>is a dihydropyridine available for<strong> intravenous administration&nbsp;</strong>and is indicated in the acute management of hypertension. It has a short half-life (1-2 minutes) and a rapid onset of action.</p>\n<p>Option A: Nifedipine is a short-acting dihydropyridine that is no longer indicated in the management of hypertension. The rapid reduction in blood pressure and concurrent surges in sympathetic activity are not desirable.&nbsp;</p>\n<p>Options B and D: Amlodipine and felodipine are longer-acting dihydropyridines that are available in tablet forms. They are used for long-term treatment of hypertension.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly hypertensive patient is diagnosed with bilateral renal artery stenosis. He is also on treatment for diabetes mellitus. Which among the following drugs would be the most appropriate for him?",
    "choices": [
      {
        "id": 1,
        "text": "Enalapril"
      },
      {
        "id": 2,
        "text": "Verapamil"
      },
      {
        "id": 3,
        "text": "Metoprolol"
      },
      {
        "id": 4,
        "text": "Metolazone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, <strong>verapamil</strong> would be the most appropriate drug for the management of hypertension in the patient as it has<strong> no</strong>&nbsp;<strong>adverse effect</strong> on <strong>glycemic</strong> <strong>control</strong>.</p>\n<p>Option A:<strong>&nbsp;</strong>Efferent arteriolar constriction maintains the glomerular filtration pressure in&nbsp;bilateral renal artery stenosis. <strong>ACE inhibitors</strong> are <strong>contraindicated</strong> in bilateral renal stenosis as it can precipitate acute renal failure due to dilation of efferent arterioles and fall in glomerular filtration pressure.</p>\n<p>Options C and D:&nbsp;<strong>Beta-blockers and thiazides</strong> can <strong>worsen glycemic control</strong> and are not suitable in the given scenario.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a direct renin inhibitor?",
    "choices": [
      {
        "id": 1,
        "text": "Captopril"
      },
      {
        "id": 2,
        "text": "Sacubitril"
      },
      {
        "id": 3,
        "text": "Aliskiren"
      },
      {
        "id": 4,
        "text": "Losartan"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Aliskiren </strong>is a direct renin inhibitor. Though its efficacy as an antihypertensive is comparable to that of ACE inhibitors, it is not considered a first-line agent due to higher incidence of side effects.</p>\n<p>Option A: Captopril is an angiotensin-converting enzyme inhibitor.</p>\n<p>Option B: Sacubitril is a neprilysin inhibitor indicated in combination with valsartan in chronic heart failure patients.</p>\n<p>Option D: Losartan is an angiotensin receptor blocker.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is incorrect about diazoxide?",
    "choices": [
      {
        "id": 1,
        "text": "It acts by causing prolonged opening of ATP dependent K+ channels in beta cells"
      },
      {
        "id": 2,
        "text": "It can cause severe hypoglycaemia"
      },
      {
        "id": 3,
        "text": "It can be used to treat patients with insulinoma"
      },
      {
        "id": 4,
        "text": "It is used as an antihypertensive agent"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Diazoxide&nbsp;causes <strong>hyperglycemia</strong>, not hypoglycemia.</p>\n<p>Diazoxide is a <strong>potent K<sup>+</sup> channel opener</strong> and opens up the ATP-sensitive K<sup>+</sup> channel and thus <strong>prevents depolarization</strong>&nbsp;of pancreatic beta cells and subsequent <strong>insulin release.&nbsp;</strong>It is used in some cases of insulinoma to reduce insulin secretion and prevent hypoglycemia.</p>\n<p>It was earlier used as an intravenous agent for hypertensive emergencies due to its strong vasodilatory action.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman with preeclampsia and is started on hydralazine. Which of the following statements is incorrect about the drug?",
    "choices": [
      {
        "id": 1,
        "text": "It decreases cerebral vascular resistance"
      },
      {
        "id": 2,
        "text": "It causes equal dilatation of both arteries and veins"
      },
      {
        "id": 3,
        "text": "Postural hypotension is not a common problem"
      },
      {
        "id": 4,
        "text": "It increases plasma renin activity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hydralazine </strong>causes<strong> preferential dilatation of arteries</strong> over veins.</p>\n<p>Hydralazine acts directly on vascular smooth muscles. The precise mechanism is unknown but involves a <strong>decrease</strong> in <strong>intracellular Ca<sup>2+</sup></strong> concentrations.</p>\n<p>Option A: It causes a selective decrease in vascular resistance in coronary, cerebral and renal circulation, with a smaller effect in skin and muscle.&nbsp;</p>\n<p>Option C: Because of preferential dilatation of arterioles over veins, postural hypotension is not a common problem.</p>\n<p>Option D: Hydralazine-induced vasodilation causes reflex activation of the <strong>sympathetic</strong> system through <strong>baroreceptor-mediated</strong> reflexes resulting in <strong>increased plasma renin </strong>activity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The efficacy of an antihypertensive agent is being studied in a clinical trial. During the course of the trial, the researchers observed hair regrowth and generalized hypertrichosis in balding patients. What is the mechanism of action of the drug being studied?",
    "choices": [
      {
        "id": 1,
        "text": "Closes K+ channels in vascular smooth muscle"
      },
      {
        "id": 2,
        "text": "Activates K+ channels in vascular smooth muscle"
      },
      {
        "id": 3,
        "text": "Activates Ca2+ channels in vascular smooth muscle"
      },
      {
        "id": 4,
        "text": "Closes  Ca2+  channels in vascular smooth muscle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The antihypertensive drug with the side effect of excess hair growth is <strong>minoxidil</strong> and it acts by<strong> activating ATP-sensitive K<sup>+</sup> channels </strong>in smooth muscles. This&nbsp;causes <strong>hyperpolarization</strong> that results in the <strong>relaxation </strong>of <strong>smooth muscles of</strong> <strong>arterioles.</strong></p>\n<p><strong>Topical minoxidil</strong> is also used for the treatment of <strong>androgenetic alopecia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented to the ER with severe headache and vomiting. On examination, the blood pressure was found to be 220/130 mm Hg and papilledema was also seen. What is the mechanism of the drug of choice for the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Increased cAMP"
      },
      {
        "id": 2,
        "text": "Calcium channel blockage"
      },
      {
        "id": 3,
        "text": "Stimulation of guanylyl cyclase"
      },
      {
        "id": 4,
        "text": "K+ channel opener"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario of <strong>severe hypertension</strong> (blood pressure&nbsp;<span class=\"nowrap\">&ge;180/&ge;120</span>&nbsp;mmHg) with fundoscopic changes (flame haemorrhages and/or <strong>papilloedema</strong>)&nbsp;is suggestive of <strong>malignant hypertension.</strong>&nbsp;The drug of choice is <strong>IV nicardipine</strong>&nbsp;which acts by <strong>calcium channel blockage.&nbsp;</strong></p>\n<p>Nicardipine blocks the influx of extracellular calcium across the vascular and myocardial smooth muscle cell membranes by blocking the voltage-sensitive calcium channels during depolarization. The decrease in intracellular calcium causes dilation of the coronary and systemic arteries.&nbsp;</p>\n<p>Other preferred agents for malignant hypertension are <strong>clevidipine</strong> with <strong>labetalol </strong>or<strong> esmolol.</strong></p>\n<p><strong>Note</strong>: Sodium nitroprusside is no longer the treatment of choice for acute hypertensive problems</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with malignant hypertension is being managed with sodium nitroprusside infusion. He is at risk of developing all of the following adverse effects except?",
    "choices": [
      {
        "id": 1,
        "text": "Methhemoglobinemia"
      },
      {
        "id": 2,
        "text": "Cyanide toxicity"
      },
      {
        "id": 3,
        "text": "Drug-induced lupus syndrome"
      },
      {
        "id": 4,
        "text": "Thiocyanate toxicity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Drug-induced lupus is not an adverse effect of sodium nitroprusside infusion.</p>\n<p>When <strong>nitroprusside</strong> is administered at a high rate, it can result in the <strong>production</strong> of <strong>methemoglobin</strong> and <strong>cyanide</strong>.&nbsp;Cyanide is further metabolized to <strong>thiocyanate</strong>.&nbsp;On prolonged infusion, thiocyanate toxicity can also occur especially in patients with renal failure.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  patient with gout develops hypertension.  The uric acid level was found to be elevated. Which of the following is not administered?",
    "choices": [
      {
        "id": 1,
        "text": "Hydrochlorothiazide"
      },
      {
        "id": 2,
        "text": "Atenolol"
      },
      {
        "id": 3,
        "text": "Enalapril"
      },
      {
        "id": 4,
        "text": "Prazosin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hydrochlorothiazides</strong> are not given to this patient.</p>\n<p>Gout is a metabolic disease associated with hyperuricemia.Thiazides&nbsp;increase direct urate reabsorption in the proximal renal tubules and are associated with elevated serum uric acid levels and may precipitate gout. Hence, hydrochlorothiazides are not used to treat hypertension in gout patients.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You will counsel patients regarding first-dose phenomenon while prescribing which of the following drugs?",
    "choices": [
      {
        "id": 1,
        "text": "Propranolol"
      },
      {
        "id": 2,
        "text": "Prazosin"
      },
      {
        "id": 3,
        "text": "Metoprolol"
      },
      {
        "id": 4,
        "text": "Hydralazine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>First-dose phenomenon </strong>is characteristic of <strong>prazosin </strong>and patients must be counselled regarding the effects.</p>\n<p>Within 30-90 minutes of the initial dose of prazosin or when the dosage is increased, there is marked <strong>orthostatic hypotension</strong> or syncope. This is known as the first-dose phenomenon. After a few initial doses, <strong>tolerance</strong> develops to this side effect. Initiating low doses at bedtime is recommended to minimize this phenomenon.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs can be given safely in a patient with chronic renal failure?",
    "choices": [
      {
        "id": 1,
        "text": "Aluminium hydroxide"
      },
      {
        "id": 2,
        "text": "Candesartan"
      },
      {
        "id": 3,
        "text": "Telmisartan"
      },
      {
        "id": 4,
        "text": "Sucralfate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Telmisartan</strong> can be given <strong>safe</strong>ly in a patient with chronic <strong>renal failure</strong> (CRF) because it is mainly cleared from circulation by <strong>biliary excretion</strong>.</p>\n<p>Options A and D: Sucralfate is a basic aluminum salt of sucrose sulfate. Sucralfate, aluminum hydroxide, and magnesium hydroxide in CRF patients can cause the accumulation of Al<sup>3+</sup> and Mg<sup>2+</sup> ions as they are preferentially excreted via the kidney after systemic absorption. Absorbed Al<sup>3+</sup> can contribute to osteoporosis, encephalopathy and proximal myopathy in CRF patients.</p>\n<p>Option B: Candesartan is cleared from circulation by renal and biliary excretion. Hence, plasma clearance is affected by renal insufficiency.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '12 Antihypertensive Drugs';
        let hierarchy = ["Marrow", "qBank", "Pharmacology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>