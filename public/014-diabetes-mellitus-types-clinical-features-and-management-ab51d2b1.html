<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>014 Diabetes Mellitus  Types, Clinical Features And Management - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not a clinical feature of diabetes mellitus?",
    "choices": [
      {
        "id": 1,
        "text": "Weight loss"
      },
      {
        "id": 2,
        "text": "Osmotic diuresis"
      },
      {
        "id": 3,
        "text": "Weight gain"
      },
      {
        "id": 4,
        "text": "Hypovolemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Weight loss</strong> is a clinical feature of <strong>diabetes mellitus</strong>, not weight gain.</p>\n<p><strong>Diabetes mellitus</strong>&nbsp;refers to a group of common metabolic disorders that result in&nbsp;<strong>hyperglycemia</strong>. It causes the following&nbsp;<strong>classical triad</strong> of symptoms:</p>\n<ul>\n<li><strong>Polyuria</strong> - due to osmotic diuresis</li>\n<li><strong>Polydipsia</strong> - triggered by the resulting hypovolemia</li>\n<li><strong>Weight loss</strong> - due to catabolic state</li>\n</ul>\n<p>Note: <strong>Obesity</strong> is a<strong> risk factor, not a symptom&nbsp;</strong>of&nbsp;type 2 diabetes mellitus and plays a role in its pathogenesis. Increase in the adipocyte mass leads to an increase in the level of circulating free fatty acids. Free fatty acids impair glucose utilization in skeletal muscles, promote glucose production by the liver, and impair beta-cell function.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old boy is brought to the OPD by his worried mother as he urinates more than ten times a day and is always drinking water. She also reports that despite eating more than his brother did at that age, he is not gaining any weight. Random blood glucose is 252 mg/dl. Which of the following statements is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Antibodies against zinc transporters may be present"
      },
      {
        "id": 2,
        "text": "It is non-insulin dependent"
      },
      {
        "id": 3,
        "text": "It is associated with a strong family history"
      },
      {
        "id": 4,
        "text": "Insulin-resistance is the hallmark for pathogenesis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario is suggestive of<strong> type 1 diabetes&nbsp;</strong>mellitus. It is an <strong>autoimmune disease </strong>associated&nbsp;with the following immunologic markers:</p>\n<ul>\n<li><strong>Antibodies against zinc transporter</strong>&nbsp;(ZnT-8)</li>\n<li>Islet cells antibodies (ICA)</li>\n<li>Anti-glutamic acid decarboxylase antibodies (GAD)</li>\n<li>Insulin autoantibodies (IAA)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which chromosome contains the major susceptible gene for type 1 diabetes mellitus?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "6"
      },
      {
        "id": 4,
        "text": "12"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The major susceptibility gene for <strong>type 1 diabetes&nbsp;</strong>mellitus&nbsp;is located in the HLA region of&nbsp;<strong>chromosome 6</strong>.</p>\n<p>Type I diabetes mellitus occurs in <strong>genetically susceptible</strong> individuals and is usually <strong>triggered</strong> by <strong>infections</strong>. The HLA complex is most commonly involved. The common HLA associations include:</p>\n<ul>\n<li><strong>Causative -</strong>&nbsp;HLA-DQA1*0501 and DQB*0201</li>\n<li><strong>Protective</strong> - HLA-DQA1*0102,&nbsp;DQB1*0602, DRB1*1501</li>\n</ul>\n<p>Other genomic associations of type I diabetes mellitus include the&nbsp;<strong>CTLA-4 gene </strong>and<strong> IL-2 receptor.</strong></p>\n<p>Type 2 diabetes mellitus&nbsp;is associated with mutations in the calpain-10 gene on chromosome 2. It results in insulin resistance.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following mechanisms is predominantly responsible for an increase in the fasting plasma glucose level of patients with type 2 diabetes mellitus?",
    "choices": [
      {
        "id": 1,
        "text": "Increased hepatic gluconeogenesis"
      },
      {
        "id": 2,
        "text": "Decreased peripheral uptake of glucose"
      },
      {
        "id": 3,
        "text": "Decreased glycogenesis in muscles"
      },
      {
        "id": 4,
        "text": "Decreased hepatic glycogenesis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In type 2 diabetes mellitus increased <strong>fasting blood sugar</strong> is predominantly due to increased <strong>hepatic gluconeogenesis.</strong></p>\n<p>In the postprandial period, there is a rise in peripheral blood glucose levels. Due to <strong>insulin resistance</strong> in type 2 diabetes mellitus, there is <strong>reduced</strong> <strong>peripheral uptake</strong> of glucose by insulin-sensitive tissues like the liver and skeletal muscles. This results in <strong>reduced glucose utilization</strong> by skeletal muscles as well as <strong>reduced glycogenesis</strong> in the liver and skeletal muscles. This results in\u00a0<strong>increased postprandial</strong> <strong>plasma glucose</strong> levels.<br />Increased hepatic glucose output predominantly accounts for increased FPG levels, whereas decreased peripheral glucose utilization results in postprandial hyperglycemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old woman presents with fatigue and weight loss for the past 6 months. She tells you that her father is also a diabetic. Further evaluation reveals the following. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Type 2 diabetes mellitus"
      },
      {
        "id": 2,
        "text": "Maturity-onset diabetes of the young"
      },
      {
        "id": 3,
        "text": "Type I diabetes mellitus"
      },
      {
        "id": 4,
        "text": "Latent autoimmune diabetes in adults"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This clinical scenario is suggestive of maturity-onset diabetes of the young (<strong>MODY</strong>).\u00a0</p>\n<p>MODY is a <strong>monogenic</strong>\u00a0form of<strong>\u00a0diabetes</strong> <strong>mellitus</strong> that is transmitted in an\u00a0<strong>autosomal dominant</strong> fashion. It\u00a0affects young adults<strong> &lt; 25 years\u00a0</strong>of age. It occurs due to reduced insulin secretion. Etiological factors of type 1 and 2 diabetes such as insulin resistance, obesity, and antibodies are not associated with this condition.</p>\n<p><strong>Stable hyperglycemia</strong> is usually seen, hence complications like diabetic ketoacidosis are uncommon. Macrovascular complications like hyperlipidemia or hypertension are not seen. It is treated with\u00a0<strong>sulfonylureas.</strong></p>\n<p>Latent autoimmune diabetes in adults\u00a0(LADA) is a form of type 1 diabetes that occurs between 30-50 years of age.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are true about maturity-onset diabetes of the young (MODY) except:",
    "choices": [
      {
        "id": 1,
        "text": "It is an autosomal-dominant trait"
      },
      {
        "id": 2,
        "text": "MODY 4 is the most common form"
      },
      {
        "id": 3,
        "text": "Diabetic ketoacidosis is uncommon"
      },
      {
        "id": 4,
        "text": "Insulinopenia is present"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>MODY 3</strong> is the <strong>most common</strong> form of maturity-onset diabetes of the young (MODY), accounting for two-thirds of all the cases.</p>\n<p>MODY is a <strong>monogenic</strong>&nbsp;form of <strong>diabetes mellitus</strong> that is transmitted in an&nbsp;<strong>autosomal dominant</strong> fashion. It&nbsp;affects young adults<strong> &lt;25 years&nbsp;</strong>of age. There are a total of 11 types of MODY based on mutations involves. Some of the affected genes include:</p>\n<ul>\n<li>Types 1,3,5:&nbsp;<strong>HNF</strong>&nbsp;(Hepatocyte nuclear transcription factor) mutation</li>\n<li>Type 2: <strong>Glucokinase</strong> mutation</li>\n<li>Type 4: <strong>IPF 1</strong>&nbsp;(Insulin Promotor Factor-1) mutation</li>\n</ul>\n<p>These mutations result in <strong>impaired</strong> glucose-induced <strong>insulin secretion&nbsp;</strong>resulting in <strong>insulinopenia</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following would cause type 1 diabetes in an adult patient?",
    "choices": [
      {
        "id": 1,
        "text": "Latent diabetes"
      },
      {
        "id": 2,
        "text": "Maturity-onset diabetes of the young"
      },
      {
        "id": 3,
        "text": "Brittle diabetes"
      },
      {
        "id": 4,
        "text": "Latent autoimmune diabetes in adults"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Type 1 diabetes</strong> mellitus in an&nbsp;<strong>adult</strong>&nbsp;is suggestive of latent autoimmune diabetes in adults (<strong>LADA</strong>).&nbsp;</p>\n<p>LADA is common in <strong>thin-built</strong> adults between<strong>&nbsp;30-50 years</strong> and is associated with <strong>autoantibodies</strong>. As the progression of the disease is less rapid than in children, clinical features may mimic type 2 diabetes. However, patients usually require <strong>insulin</strong> treatment <strong>within 5 years</strong>.</p>\n<p>Option A: Patients with latent diabetes&nbsp;become diabetic under stressful&nbsp;conditions. However, upon <strong>removal of stress</strong>, they become <strong>non-diabetic</strong>.</p>\n<p>Option B: <strong>MODY</strong> or maturity-onset diabetes of the young is a monogenic form of diabetes that occurs <strong>&lt; 25 years</strong>. There is impaired insulin secretion, but <strong>no antibodies</strong>.</p>\n<p>Option C: Brittle diabetes is seen in <strong>children</strong> with<strong> type 1 DM</strong>. It presents with <strong>wide fluctuation</strong> in blood sugar levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with all of the following conditions can develop diabetes mellitus except:",
    "choices": [
      {
        "id": 1,
        "text": "Hemochromatosis"
      },
      {
        "id": 2,
        "text": "Prader-Willi syndrome"
      },
      {
        "id": 3,
        "text": "Fragile X syndrome"
      },
      {
        "id": 4,
        "text": "Friedrich\u2019s ataxia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fragile X syndrome is not associated with <strong>diabetes mellitus</strong>.</p>\n<p>Genetic syndromes associated with diabetes include:</p>\n<ul>\n<li><strong>Prader-Willi syndrome</strong></li>\n<li><strong>Friedreich&rsquo;s ataxia</strong></li>\n<li>Wolfram&rsquo;s syndrome</li>\n<li>Down&rsquo;s syndrome</li>\n<li>Klinefelter&rsquo;s and Turner&rsquo;s syndrome</li>\n<li>Huntington&rsquo;s chorea</li>\n<li>Laurence-Moon-Biedl syndrome</li>\n<li>Myotonic dystrophy</li>\n<li>Porphyria</li>\n</ul>\n<p>Diseases of the exocrine pancreas causing diabetes:</p>\n<ul>\n<li><strong>Hemochromatosis</strong></li>\n<li>Pancreatitis</li>\n<li>Neoplasia</li>\n<li>Cystic fibrosis</li>\n</ul>\n<p>Endocrinopathies causing diabetes:</p>\n<ul>\n<li>Acromegaly</li>\n<li>Cushing&rsquo;s syndrome</li>\n<li>Glucagonoma</li>\n<li>Pheochromocytoma</li>\n<li>Hyperthyroidism</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients can be diagnosed with diabetes mellitus?",
    "choices": [
      {
        "id": 1,
        "text": "A patient with RBS of 210 mg/dl"
      },
      {
        "id": 2,
        "text": "A patient with FBS of 125 mg/dl and 2-hour PPBS of 199 mg/dl"
      },
      {
        "id": 3,
        "text": "A patient with symptoms of diabetes and RBS of 192 mg/dl"
      },
      {
        "id": 4,
        "text": "A patient with HbA1c \u2265 6.5 %"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient with<strong>&nbsp;HbA1c &ge; 6.5 % </strong>can be diagnosed with diabetes mellitus as this is an independent criterion for diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 46-year-old man presents to his physician for a routine health evaluation. He is concerned that he might have diabetes as his three brothers have all been diagnosed with diabetes. He does not have any complaints. Which of the following tests can be employed in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 4"
      },
      {
        "id": 2,
        "text": "1, 4"
      },
      {
        "id": 3,
        "text": "2, 3, 5"
      },
      {
        "id": 4,
        "text": "4, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>HbA1c and fasting blood glucose are used for <strong>screening</strong> <strong>diabetes</strong> mellitus in <strong>asymptomatic</strong> individuals.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>HbA1c</strong> refers to glycated hemoglobin and it serves as a <strong>long-term indicator</strong>&nbsp;for blood glucose levels (8 to 12 weeks).</p>\n<ul>\n<li>Normal&nbsp;<strong>&lt; 5.7 %</strong></li>\n<li>Abnormal glucose homeostasis: <strong>5.</strong><strong>7 to 6.4 %</strong></li>\n<li>Diabetes mellitus:&nbsp;<strong>&ge; 6.5%</strong></li>\n</ul>\n<p>HbA1c also serves as a <strong>prognostic indicator</strong>&nbsp;for glycemic control.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can be termed impaired glucose tolerance?",
    "choices": [
      {
        "id": 1,
        "text": "Fasting blood glucose levels between 100 and 125 mg/dL"
      },
      {
        "id": 2,
        "text": "Random blood glucose levels between 140 and 199 mg/dL"
      },
      {
        "id": 3,
        "text": "Blood glucose levels between 140 and 199 mg/dL following oral glucose tolerance test"
      },
      {
        "id": 4,
        "text": "Fasting blood glucose levels between 100 and 199 mg/dL"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Impaired glucose tolerance </strong>is defined as blood glucose levels between <strong>140-199 mg/dL </strong>following an\u00a0oral glucose tolerance test (<strong>OGTT</strong>)<strong>.</strong></p>\n<p>Impaired fasting glucose is when the fasting<strong>\u00a0</strong>blood glucose is between 100 to 125\u00a0<span class=\"nowrap\">mg/dL.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are counselling an asymptomatic middle-aged woman regarding screening for diabetes mellitus. Based on the ADA recommendations, what will you tell her?",
    "choices": [
      {
        "id": 1,
        "text": "All individuals > 35 years must undergo screening every 3 years"
      },
      {
        "id": 2,
        "text": "All individuals > 50 years must undergo screening every 5 years"
      },
      {
        "id": 3,
        "text": "Oral glucose tolerance test would be performed"
      },
      {
        "id": 4,
        "text": "Random blood glucose levels would be checked"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ADA recommends <strong>screening</strong> for <strong>type 2 diabetes</strong> mellitus in all asymptomatic individuals <strong>&gt; 35 years</strong>\u00a0every <strong>3 years</strong>.</p>\n<p>The tests used for screening are:</p>\n<ul>\n<li><strong>HbA1c</strong> levels</li>\n<li><strong>Fasting</strong> blood glucose levels</li>\n</ul>\n<p>Individuals can be screened earlier if they are overweight with <strong>BMI &gt;25</strong> kg/m2\u00a0<strong>and</strong> have one of the following <strong>risk factors</strong>:</p>\n<ul>\n<li>Family history of diabetes</li>\n<li>History of cardiovascular diseases</li>\n<li>History of gestational diabetes mellitus or delivery of a baby &gt; 4 kg</li>\n<li>Obesity (BMI \u226525 kg/m<sup>2</sup>)</li>\n<li>Physical inactivity</li>\n<li>Hypertension (\u2265140/90 mm Hg)</li>\n<li>HDL cholesterol &lt; 35 mg/dL</li>\n<li>Triglycerides &gt;250 mg/dL</li>\n<li>Polycystic ovarian syndrome or acanthosis nigricans</li>\n</ul>\n<p>Note- If an individual has a test result near the margins of the diagnostic threshold, a close follow-up should be done and repeat the test in <strong>3\u20136</strong> months.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman has been diagnosed with type 2 diabetes mellitus. Her HbA1c level is 11.1%. What is the initial drug of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Insulin"
      },
      {
        "id": 2,
        "text": "Glimepiride"
      },
      {
        "id": 3,
        "text": "Metformin"
      },
      {
        "id": 4,
        "text": "Sitagliptin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Insulin</strong>&nbsp;is the best<strong> initial drug</strong>&nbsp;of choice when <strong>HbA1c is &gt; 9%</strong> at diagnosis<strong>.&nbsp;</strong></p>\n<p>Insulin is used in the treatment of type 2 diabetes in the following cases:</p>\n<ul>\n<li>Inadequate glycemic control with 2 or more oral agents</li>\n<li>HbA1c &gt; 9% at diagnosis</li>\n</ul>\n<p>In patients with <strong>HbA1c &lt; 9%</strong>, <strong>metformin</strong> is the drug of choice.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/321a1fd668314bf094066c62c1954768x1280x2077.JPEG"
    ]
  },
  {
    "text": "A 45-year-old woman was brought to the emergency department by her relatives after she suffered a brief, seizure-like episode. They tell you that she is taking an oral medication for diabetes. On examination, the patient was disoriented, and CBG was 45 mg/dl. Which of the following drugs most likely played a role in the patient\u2019s current presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Metformin"
      },
      {
        "id": 2,
        "text": "Pioglitazone"
      },
      {
        "id": 3,
        "text": "Sitagliptin"
      },
      {
        "id": 4,
        "text": "Repaglinide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Repaglinide</strong> is an <strong>insulin secretagogue</strong> and hence poses the risk of causing&nbsp;<strong>hypoglycemia</strong>.</p>\n<p>Drugs that can cause hypoglycemia (insulin secretagogues):</p>\n<ul>\n<li>Sulfonylureas</li>\n<li>Meglitinides: Nateglinide, Repaglinide</li>\n</ul>\n<p>The following drugs are not directly responsible for stimulating insulin secretion and hence do not cause&nbsp;hypoglycemia:</p>\n<ul>\n<li>Metformin</li>\n<li>Alpha-glucosidase inhibitor</li>\n<li>Pioglitazone</li>\n<li>DPP-4 inhibitor: Sitagliptin</li>\n</ul>\n<table style=\"width: 482px;\">\n<tbody>\n<tr style=\"height: 24px;\">\n<td style=\"width: 49px; text-align: center; height: 24px;\" colspan=\"3\"><strong>Management of diabetes mellitus</strong></td>\n</tr>\n<tr style=\"height: 31px;\">\n<td style=\"width: 49px; height: 31px;\"><strong>Intervention</strong></td>\n<td style=\"width: 319.25px; height: 31px;\"><strong>Advantages</strong></td>\n<td style=\"width: 306.75px; height: 31px;\"><strong>Disadvantages</strong></td>\n</tr>\n<tr style=\"height: 58px;\">\n<td style=\"width: 49px; height: 58px;\">Lifestyle changes</td>\n<td style=\"width: 319.25px; height: 58px;\">Reduced complications and mortality</td>\n<td style=\"width: 306.75px; height: 58px;\">Insufficient for most patients within 1st year</td>\n</tr>\n<tr style=\"height: 96px;\">\n<td style=\"width: 49px; height: 96px;\">Metformin</td>\n<td style=\"width: 319.25px; height: 96px;\">Weight neutral</td>\n<td style=\"width: 306.75px; height: 96px;\">\n<p>GI side effects</p>\n<p>Contraindicated when GFR &lt; 45 ml/min</p>\n</td>\n</tr>\n<tr style=\"height: 114px;\">\n<td style=\"width: 49px; height: 114px;\">Insulin</td>\n<td style=\"width: 319.25px; height: 114px;\">\n<p>Rapidly effective</p>\n<p>Lowers HbA1c more than other drugs (by 1.5-3%)</p>\n</td>\n<td style=\"width: 306.75px; height: 114px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr style=\"height: 114px;\">\n<td style=\"width: 49px; height: 114px;\">GLP-1 agonists</td>\n<td style=\"width: 319.25px; height: 114px;\">\n<p>Weight loss</p>\n<p>Reduces cardiovascular complications</p>\n</td>\n<td style=\"width: 306.75px; height: 114px;\">GI side effects</td>\n</tr>\n<tr style=\"height: 96px;\">\n<td style=\"width: 49px; height: 96px;\">Pramlintide</td>\n<td style=\"width: 319.25px; height: 96px;\">\n<p>Weight loss</p>\n<p>Lowers postprandial glucose</p>\n</td>\n<td style=\"width: 306.75px; height: 96px;\">\n<p>GI side effects</p>\n<p>Hypoglycemia when used with insulin</p>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 49px; height: 78px;\">Sulfonylureas</td>\n<td style=\"width: 319.25px; height: 78px;\">Rapidly effective</td>\n<td style=\"width: 306.75px; height: 78px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 49px; height: 64px;\">Thiazolidinediones</td>\n<td style=\"width: 319.25px; height: 64px;\">Lowers insulin requirements</td>\n<td style=\"width: 306.75px; height: 64px;\">\n<p>Weight gain, edema,&nbsp;CHF, fractures</p>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 49px; height: 78px;\">Meglitinides</td>\n<td style=\"width: 319.25px; height: 78px;\">Rapidly effective</td>\n<td style=\"width: 306.75px; height: 78px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr style=\"height: 110px;\">\n<td style=\"width: 49px; height: 110px;\">SGLT-2 inhibitors</td>\n<td style=\"width: 319.25px; height: 110px;\">\n<p>Weight loss</p>\n<p>Better cardiovascular and renal outcomes</p>\n</td>\n<td style=\"width: 306.75px; height: 110px;\">\n<p>UTI, vulval candidiasis</p>\n<p>Dehydration</p>\n<p>Euglycemic DKA</p>\n</td>\n</tr>\n<tr style=\"height: 44px;\">\n<td style=\"width: 49px; height: 44px;\">DPP-4 inhibitors</td>\n<td style=\"width: 319.25px; height: 44px;\">Weight neutral</td>\n<td style=\"width: 306.75px; height: 44px;\">Angioedema, urticaria</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 49px; height: 78px;\">Alpha-glucosidase inhibitors</td>\n<td style=\"width: 319.25px; height: 78px;\">Weight neutral</td>\n<td style=\"width: 306.75px; height: 78px;\">\n<p>GI flatulence</p>\n<p>Rise in LFT</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following drugs can be used in the treatment of patients with type 1 diabetes except:",
    "choices": [
      {
        "id": 1,
        "text": "Acarbose"
      },
      {
        "id": 2,
        "text": "Pramlintide"
      },
      {
        "id": 3,
        "text": "Metformin"
      },
      {
        "id": 4,
        "text": "Insulin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Metformin</strong> can <strong>only</strong> be used in the treatment of&nbsp;<strong>type 2 </strong>diabetes mellitus.</p>\n<p>Drugs that can be used for treating<strong> both type 1 </strong>and type<strong>&nbsp;2 </strong>diabetes mellitus include the following<strong>:</strong></p>\n<ul>\n<li><strong>Acarbose</strong> - reduces the breakdown of starch into sugar in the GI tract and <strong>lowers</strong> the <strong>postprandial</strong> glucose rise in both types.</li>\n<li><strong>Pramlintide</strong> - an <strong>injectable</strong> drug that enhances<strong> amylin secretion</strong> leading to <strong>reduced glucagon</strong> levels</li>\n<li>Insulin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male patient with type 2 diabetes mellitus is now diagnosed with hypertension. Which of the following antihypertensive drugs will you not prefer in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hydrochlorthiazide"
      },
      {
        "id": 2,
        "text": "Losartan"
      },
      {
        "id": 3,
        "text": "Lisinopril"
      },
      {
        "id": 4,
        "text": "Furosemide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hydrochlorthiazide</strong> belongs to the <strong>thiazide</strong> group of diuretics, that can cause <strong>dyslipidemia</strong> and <strong>hyperglycemia.</strong> Hence they<strong>&nbsp;</strong>are<strong> not</strong>&nbsp;<strong>preferred</strong>&nbsp;for use in <strong>diabetic hypertensives</strong>.</p>\n<p>The antihypertensive <strong>drug</strong> <strong>of</strong> <strong>choice</strong> in diabetes mellitus include angiotensin-converting enzyme inhibitors (<strong>ACE-I</strong>) or angiotensin II receptor blockers (<strong>ARBs</strong>).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A type 2 diabetic patient who was recently started on treatment complains of frequent urination, fever, and burning micturition. Which of the following drugs is most likely responsible for these symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Dapagliflozin"
      },
      {
        "id": 2,
        "text": "Metformin"
      },
      {
        "id": 3,
        "text": "Glipizide"
      },
      {
        "id": 4,
        "text": "Exenatide"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario is suggestive of a urinary tract infection (<strong>UTI</strong>). This adverse effect occurs as a result of&nbsp;<strong>dapagliflozin&nbsp;</strong>use.</p>\n<p>The group of sodium-glucose co-transporter-2 or <strong>SGLT-2&nbsp;inhibitors&nbsp;</strong>includes drugs like dapagliflozin and canagliflozin. These drugs&nbsp;prevent glucose reabsorption in the renal tubules and cause loss of sodium and glucose.&nbsp;</p>\n<ul>\n<li>UTI - due to <strong>glucosuria</strong></li>\n<li>Dehydration<strong>&nbsp;-&nbsp;</strong>due to <strong>natriuresis</strong> and volume loss</li>\n<li><strong>Euglycemic diabetic ketoacidosis</strong> - low blood glucose levels due to glucosuria can reduce insulin release</li>\n</ul>\n<p>SGLT-2 inhibitors must be temporarily discontinued for 3-4 days before any scheduled surgery to avoid potential risk for diabetic ketoacidosis.</p>\n<table style=\"width: 482px;\">\n<tbody>\n<tr>\n<td style=\"width: 49px; text-align: center;\" colspan=\"3\"><strong>Management of diabetes mellitus</strong></td>\n</tr>\n<tr>\n<td style=\"width: 49px;\"><strong>Intervention</strong></td>\n<td style=\"width: 319.25px;\"><strong>Advantages</strong></td>\n<td style=\"width: 306.75px;\"><strong>Disadvantages</strong></td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Lifestyle changes</td>\n<td style=\"width: 319.25px;\">Reduced complications and mortality</td>\n<td style=\"width: 306.75px;\">Insufficient for most patients within 1st year</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Metformin</td>\n<td style=\"width: 319.25px;\">Weight neutral</td>\n<td style=\"width: 306.75px;\">\n<p>GI side effects</p>\n<p>Contraindicated when GFR &lt; 45 ml/min</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Insulin</td>\n<td style=\"width: 319.25px;\">\n<p>Rapidly effective</p>\n<p>Lowers HbA1c more than other drugs (by 1.5-3%)</p>\n</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">GLP-1 agonists</td>\n<td style=\"width: 319.25px;\">\n<p>Weight loss</p>\n<p>Reduces cardiovascular complications</p>\n</td>\n<td style=\"width: 306.75px;\">GI side effects</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Pramlintide</td>\n<td style=\"width: 319.25px;\">\n<p>Weight loss</p>\n<p>Lowers postprandial glucose</p>\n</td>\n<td style=\"width: 306.75px;\">\n<p>GI side effects</p>\n<p>Hypoglycemia when used with insulin</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Sulfonylureas</td>\n<td style=\"width: 319.25px;\">Rapidly effective</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Thiazolidinediones</td>\n<td style=\"width: 319.25px;\">Lowers insulin requirements</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain, edema,&nbsp;CHF, fractures</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Meglitinides</td>\n<td style=\"width: 319.25px;\">Rapidly effective</td>\n<td style=\"width: 306.75px;\">\n<p>Weight gain</p>\n<p>Hypoglycemia</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">SGLT-2 inhibitors</td>\n<td style=\"width: 319.25px;\">\n<p>Weight loss</p>\n<p>Better cardiovascular and renal outcomes</p>\n</td>\n<td style=\"width: 306.75px;\">\n<p>UTI, vulval candidiasis</p>\n<p>Dehydration</p>\n<p>Euglycemic DKA</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">DPP-4 inhibitors</td>\n<td style=\"width: 319.25px;\">Weight neutral</td>\n<td style=\"width: 306.75px;\">Angioedema, urticaria</td>\n</tr>\n<tr>\n<td style=\"width: 49px;\">Alpha-glucosidase inhibitors</td>\n<td style=\"width: 319.25px;\">Weight neutral</td>\n<td style=\"width: 306.75px;\">\n<p>GI flatulence</p>\n<p>Rise in LFT</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man is hospitalized with pneumonia. He is a known patient of type 2 diabetes. During the hospital stay, his appetite is poor and his oral intake is irregular. The physician decides to administer rapid-acting insulin based on high blood sugar values. Which of the following would he use?",
    "choices": [
      {
        "id": 1,
        "text": "Lente"
      },
      {
        "id": 2,
        "text": "Detemir"
      },
      {
        "id": 3,
        "text": "Glargine"
      },
      {
        "id": 4,
        "text": "Glulisine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical scenario describes the <strong>sliding scale</strong> method. <strong>Rapid-acting</strong> insulins such as <strong>glulisine</strong>&nbsp;are used.</p>\n<p>Sliding scale refers to the administration of insulin as a <strong>bolus</strong> dose based on the&nbsp;blood sugar level before the meal.&nbsp;Using this principle, the insulin dose is <strong>titrated</strong> every time according to <strong>pre-meal</strong>&nbsp;<strong>glucose</strong> levels to determine insulin requirement. Hence, <strong>rapid-acting</strong> insulin is preferred.</p>\n<p>This method requires a <strong>fixed carbohydrate</strong> intake at every meal. It is used for the <strong>short-term</strong> management of <strong>hospitalized</strong> patients, especially when the frequency or quantity of food intake is very variable.</p>\n<p>It does not deliver insulin in a physiological manner, hence is not a preferred long-term strategy for glycemic control.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect about Afrezza?",
    "choices": [
      {
        "id": 1,
        "text": "It is available as a powder for inhalation"
      },
      {
        "id": 2,
        "text": "It can cause bronchospasm"
      },
      {
        "id": 3,
        "text": "It does not cause hypoglycemia"
      },
      {
        "id": 4,
        "text": "It is a rapid-acting form"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"sect1 \">\n<p><strong>Afrezza</strong>&nbsp;is an <strong>inhalational</strong> form of insulin that can cause <strong>hypoglycemia</strong>.</p>\n<p>It is a&nbsp;<strong>rapid-acting</strong>&nbsp;form of insulin that&nbsp;is administered at the beginning of each meal. Peak levels are achieved <strong>12-15 minutes</strong> later.</p>\n<p>Adverse effects include<strong>&nbsp;</strong>hypoglycemia, cough,&nbsp;throat pain, or irritation. It may cause&nbsp;<strong>acute bronchospasm</strong>&nbsp;in patients with&nbsp;<strong>asthma</strong>,&nbsp;<strong>COPD</strong>, as well as&nbsp;<strong>active smokers</strong>. Hence, it is contraindicated in these condition.</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presents to the casualty with confusion, vomiting, and abdominal pain. His blood sugar levels are 421 mg/dl and urine ketones are 3+. He is started on IV normal saline and insulin infusion. Which of the following should he be monitored for?",
    "choices": [
      {
        "id": 1,
        "text": "Hypernatremia"
      },
      {
        "id": 2,
        "text": "Hyperkalemia"
      },
      {
        "id": 3,
        "text": "Hypokalemia"
      },
      {
        "id": 4,
        "text": "Hyponatremia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This clinical scenario is suggestive of <strong>diabetic ketoacidosis</strong>, which is treated with insulin infusion. <strong>Insulin </strong>causes&nbsp;an&nbsp;<strong>intracellular shift</strong>&nbsp;of&nbsp;K<sup>+</sup>&nbsp;ions resulting in a decreased extracellular K<sup>+</sup>&nbsp;ion concentration. This results in <strong>hypokalemia.</strong></p>\n<p>Non-diabetic clinical applications of insulin include:</p>\n<ul>\n<li>Treatment of hyperkalemia</li>\n<li>To determine the functions of the anterior pituitary&nbsp;</li>\n<li>To examine the completion of truncal vagotomy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Dawn phenomenon is clinically suspected when a patient shows which of the following findings?",
    "choices": [
      {
        "id": 1,
        "text": "Early morning hyperglycemia with hypoglycemia at 3 am"
      },
      {
        "id": 2,
        "text": "Early morning hypoglycemia with normal blood glucose levels at 3 am"
      },
      {
        "id": 3,
        "text": "Early morning hyperglycemia with normal blood glucose levels at 3 am"
      },
      {
        "id": 4,
        "text": "Early morning hypoglycemia with hyperglycemia at 3 am"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Dawn</strong>&nbsp;<strong>phenomenon</strong> refers to&nbsp;normal blood glucose levels at 3 am followed by<strong>&nbsp;early morning hyperglycemia. </strong></p>\n<p>This occurs due to an early morning <strong>surge</strong> in plasma <strong>growth hormone</strong>&nbsp;and <strong>cortisol</strong> levels, which have an <strong>insulin-antagonistic</strong> action. In normal individuals, this is countered by increased early morning insulin secretion. However, in diabetic patients, insulin secretion is disrupted which results in the unopposed action of growth hormone. Hence, there will be resulting hyperglycemia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is said to have developed insulin resistance when the required insulin dosage is which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "> 200 units per day"
      },
      {
        "id": 2,
        "text": "> 100 units per day"
      },
      {
        "id": 3,
        "text": "> 150 units per day"
      },
      {
        "id": 4,
        "text": "> 250 units per day"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>When a patient needs <strong>&gt; 200 units</strong> of insulin per day, they are said to have developed <strong>insulin resistance.</strong></p>\n<p>Some causes of insulin resistance are as follows:</p>\n<ul>\n<li>Werner syndrome</li>\n<li>Lipodystrophy syndrome</li>\n<li>Ataxia-telangiectasia</li>\n<li>Polycystic ovarian disease</li>\n</ul>\n<p>Insulin resistance can present as non-alcoholic fatty liver disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old child who is known to have type 1 diabetes mellitus presents with confusion and drowsiness. Her mother says that she seems to be breathing very fast. On examination, mucous membranes are dry and blood pressure is 70/50 mm Hg. Random blood glucose is 415 mg/dl and urine ketones are 4+. What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "2-3 L of normal saline over 1-3 hours"
      },
      {
        "id": 2,
        "text": "Insulin infusion at 0.1 units/kg/hour"
      },
      {
        "id": 3,
        "text": "Arterial blood gas"
      },
      {
        "id": 4,
        "text": "Insulin bolus of 0.1 units/kg given IV"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>diabetic ketoacidosis (DKA) </strong>and the first step is to assess the<strong> arterial blood gas</strong> (ABG) levels. This precedes correction of <strong>fluid balance</strong>, as assessment of the current status of the patient is necessary before beginning treatment. A <strong>baseline pH </strong>and <strong>electrolyte</strong> level must be obtained.</p>\n<p>Diabetic ketoacidosis is the most serious complication of <strong>type 1 diabetes mellitus.</strong> The symptoms include dehydration, nausea, vomiting, confusion, drowsiness, and coma in severe cases.</p>\n<p>In DKA, the<strong> insulin-to-glucagon ratio</strong> is <strong>decreased</strong> which promotes gluconeogenesis, glycogenolysis, and ketone body formation in the liver. Ketone bodies exist as ketoacids at physiological pH which are neutralized by bicarbonate. As bicarbonate stores are depleted, metabolic acidosis ensues. Increased lactic acid production also contributes to the acidosis.</p>\n<p>The <strong>diagnostic biochemical criteria </strong>for DKA includes:</p>\n<ul>\n<li>Hyperglycemia (&gt;250 mg/dL)</li>\n<li>Venous pH &lt;7.3</li>\n<li>Plasma/serum bicarbonate &lt;15-18 mmol/L</li>\n<li>Increased anion gap</li>\n<li>Ketonemia (beta-hydroxybutyrate [BOHB] &gt;3 mmol/L) and ketonuria</li>\n</ul>\n<p><strong>Signs</strong> of ketoacidosis:&nbsp;</p>\n<ul>\n<li>Kussmaul breathing (deep, heavy, non-labored rapid breathing)</li>\n<li>Fruity breath odor (acetone)</li>\n<li>Prolonged Q-T interval</li>\n<li>Diminished neurocognitive function</li>\n<li>Coma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/18a61ed32ad34a81b485e17189c69f25x1280x2461.JPEG"
    ]
  },
  {
    "text": "Which of the following is responsible for the elevated levels of TG and VLDL in diabetes mellitus?",
    "choices": [
      {
        "id": 1,
        "text": "Increased activity of lipoprotein lipase and decreased activity of hormone sensitive lipase"
      },
      {
        "id": 2,
        "text": "Increased activity of hormone sensitive lipase and decreased lipoprotein lipase activity"
      },
      {
        "id": 3,
        "text": "Increase in peripheral function of LDL receptors"
      },
      {
        "id": 4,
        "text": "Increased in activity of hepatic lipase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>The <strong>elevated</strong> levels of <strong>triglycerides</strong> (TG) and <strong>very low-density lipoproteins</strong> (VLDL) in <strong>diabetes mellitus</strong> (DM) are due to <strong>decreased activity</strong> of <strong>lipoprotein lipase</strong> (LpL) and <strong>increased activity</strong> of <strong>hormone-sensitive lipase</strong> (HSL).</p>\n<p><strong>Insulin</strong> <strong>normally</strong> has an <strong>inhibitory</strong> action on <strong>HSL</strong> and <strong>induces LpL</strong>\u00a0on capillary walls. There is an absolute or relative deficiency of insulin in DM. In <strong>DM</strong>, the <strong>activity</strong> of <strong>LpL</strong> is <strong>decreased</strong> and <strong>HSL</strong> is <strong>increased</strong>.</p>\n<p>The increased activity of <strong>HSL</strong> results in <strong>increased mobilisation</strong> of <strong>fat stores</strong> towards <strong>lipolysis</strong> releasing fatty acids. These fatty acids are <strong>partly cleared</strong> <strong>by </strong>the<strong> liver</strong>, resulting in <strong>increased synthesis</strong> of <strong>VLDL</strong> and <strong>TG</strong>, resulting in <strong>dyslipidemia</strong>. They can <strong>accumulate</strong> in the liver, resulting in <strong>steatosis</strong> (non-alcoholic fatty liver disease).</p>\n<p>The reduced activity of LpL prevents the clearing of TG and VLDL in the bloodstream and their levels remain elevated.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/930c5ce53b9a48df908e15bf24113255x800x552.JPEG"
    ]
  },
  {
    "text": "In a PHC, which of the following initial screening tests are used to diagnose diabetes?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 2"
      },
      {
        "id": 2,
        "text": "2 and 3"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "1, 2 and 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Fasting blood sugar<strong> &gt;126 mg/dL</strong> and 2-hour postprandial blood sugar<strong> &gt;200 mg/dl</strong> can be used as screening tests for diabetes in a primary health center (PHC).</p>\n<p><strong>HbA1c</strong> estimation is usually unavailable for screening at many PHCs due to low resources. In India, facilities for HbA1c estimation are usually available only at <strong>tertiary centers.</strong></p>\n<p>Random blood sugar <strong>&gt;200 mg/dL</strong> can be used for diagnosis only if the patient presents with symptoms of diabetes, hence it is <strong>not a useful screening test.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '014 Diabetes Mellitus  Types, Clinical Features And Management';
        const quizFilename = '014-diabetes-mellitus-types-clinical-features-and-management-ab51d2b1.html';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>