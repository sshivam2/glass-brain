<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet Mini - 14 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Your friend is planning on setting up a granite factory consisting of 25 female and 275 male employees.  He asks for your advice on health, safety, and welfare. Which of the following will be required?",
    "choices": [
      {
        "id": 1,
        "text": "2,3,4"
      },
      {
        "id": 2,
        "text": "2,3"
      },
      {
        "id": 3,
        "text": "1,4"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Based on the number of employees, a <strong>canteen and a&nbsp;cr&egrave;che</strong> will be required.</p>\n<p>According to The Factories act, 1948, for a total number of <strong>300</strong> employees, a canteen is an adequate welfare measure. And according to the Indian Maternity Benefit (Amendment) Act, a creche will also be required when there are&nbsp;<strong>50 or more</strong> employees (inclusive of males and females).</p>\n<p>The employment of a safety officer is unwarranted when the number of employees does not exceed 1000. The employment of a welfare officer is required when the number of workers exceed 500.</p>\n<p>The <strong>Factories Act, 1948</strong> states the following in the matters of&nbsp;Safety and Welfare measures:</p>\n<ul>\n<li>&gt; 1000 Workers in a factory &ndash; the appointment of 'Safety Officers'</li>\n<li>&gt; 500 Workers &ndash; there should be a Welfare Officer</li>\n<li>&gt; 250 Workers &ndash; a canteen shall be provided</li>\n<li>&gt; 30 female workers- Cr&egrave;che</li>\n</ul>\n<p>According to <strong>Indian Maternity Benefit (Amendment) Act, 2017</strong>: Effective as of the 1st of July 2017, mandatory <strong>cr&egrave;che</strong> (daycare) facilities for every establishment employing <strong>50 or more employees (inclusive of males and females).</strong>&nbsp;As this act is more recent, it supersedes the Factory Act, 1948 with regards to the requirement for a cr&egrave;che.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy developed on and off fever which was not medically treated. After a week he presented with jaundice, malaise, neck stiffness, and photophobia. They give a history of rescuing a stray dog about two weeks back. On work-up, he was found to have deranged hepatic parameters as given below. A spinal tap was performed and the CSF showed the following organism on microscopy. Which serogroup of the causative organism is most likely commonly responsible for causing this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Canicola"
      },
      {
        "id": 2,
        "text": "Pomona"
      },
      {
        "id": 3,
        "text": "Pyrogenes"
      },
      {
        "id": 4,
        "text": "Icterohemorrhagiae"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette showing influenza-like symptoms, jaundice, and features of<strong> aseptic meningitis </strong>and history of rescuing a stray<strong> dog, </strong>along with an electron microscopy image of a<strong> spirochete </strong>is suggestive of<strong>&nbsp;leptospirosis.</strong> The most common serovar causing aseptic meningitis is<strong> canicola.</strong></p>\n<p><span data-preserver-spaces=\"true\">Leptospirosis is caused by contact with the&nbsp;</span><strong><span data-preserver-spaces=\"true\">blood or urine&nbsp;</span></strong>of an<strong><span data-preserver-spaces=\"true\">&nbsp;infected organism</span></strong><span data-preserver-spaces=\"true\">&nbsp;in a contaminated water body. It is a type of zoonosis and can affect all mammalian species, rats are well-known reservoirs.&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">The clinical picture varies from mild disease to fatal disease&nbsp;</span><strong><span data-preserver-spaces=\"true\">(Weil's disease).&nbsp;</span></strong><span data-preserver-spaces=\"true\">Signs and symptoms of leptospirosis include fever, jaundice, meningismus, hemorrhage, and acute kidney injury (hematuria and&nbsp;<strong>elevated BUN</strong>).&nbsp;</span><span data-preserver-spaces=\"true\">Anemia in leptospirosis is due to blood loss.</span></p>\n<p>A<strong><span data-preserver-spaces=\"true\"> microscopic agglutination test</span></strong><span data-preserver-spaces=\"true\">&nbsp;is used for diagnosis of Leptospirosis after 1 week.</span></p>\n<p><span data-preserver-spaces=\"true\">In the acute phase of the disease, leptospires can be seen in blood in the first week of infection.</span></p>\n<p><span data-preserver-spaces=\"true\">Leptospires are sensitive to <strong>p</strong></span><strong>enicillin<span data-preserver-spaces=\"true\"> and tetracyclines</span></strong><span data-preserver-spaces=\"true\">&nbsp;and the treatment should be started early in the course of the disease.</span></p>\n<p><span data-preserver-spaces=\"true\">Serious cases of leptospirosis are most often caused by serotype <strong>icterohemorrhagiae&nbsp;(Weil's disease)</strong> where<strong>&nbsp;</strong>rats are the common animal reservoir. They may also be due to <strong>copenhageni</strong> and less often due to <strong>bataviae, grippotyphosa</strong>&nbsp;(field mice are the common animal reservoir)<strong>&nbsp;</strong>and <strong>pyrogenes </strong>(pigs are the common animal reservoir).&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">Aseptic meningitis is common in <strong>canicola</strong> infection and abdominal symptoms in <strong>grippotyphosa</strong> infections.</span></p>\n<p><span data-preserver-spaces=\"true\"><em><strong>L.pomona</strong></em> causes Swineherd's disease where pigs are the major animal reservoir.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/375d51bee9f74b06abb2b484e57428c0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young woman presented with mood disturbance, tearfulness, and a lack of energy on the 5th day of postpartum. She was counseled and educated about postpartum blues. She should be evaluated for postpartum depression if her symptoms last longer than:",
    "choices": [
      {
        "id": 1,
        "text": "1 week"
      },
      {
        "id": 2,
        "text": "2 months"
      },
      {
        "id": 3,
        "text": "1 month"
      },
      {
        "id": 4,
        "text": "2 weeks"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient should be evaluated for postpartum depression if her symptoms <strong>last &gt;2 weeks</strong>.</p>\n<p><strong>Postpartum blues</strong> is common in mothers in the puerperal period. It is characterized by <strong>transient</strong> mood disturbances like a <strong>labile mood&nbsp;</strong>and sadness. It<strong>&nbsp;</strong>typically develops&nbsp;<strong>within one week&nbsp;</strong>of&nbsp;<strong>delivery.&nbsp;</strong>It is thought to be due to changes in hormone levels, the stress of childbirth, and anxiety about the responsibilities of motherhood.&nbsp;Treatment is nothing more than <strong>education </strong>and <strong>support, </strong>however,<strong> symptoms lasting longer</strong> than <strong>2 weeks</strong> should be <strong>evaluated</strong> for <strong>postpartum depression</strong>.</p>\n<p><strong>Postpartum depression</strong> is characterized by a&nbsp;<strong>minimum</strong>&nbsp;of&nbsp;<strong>5 symptoms</strong>&nbsp;of major depressive disorder i.e. impaired sleep, interest, guilt, energy, concentration, appetite, psychomotor activity, and suicidal ideation lasting for &gt;2 weeks.&nbsp;It is usually seen within the <strong>4-6 weeks</strong>. There may be associated thoughts of suicide or of <strong>harming</strong> the<strong> baby</strong>.&nbsp;</p>\n<p><strong>Postpartum psychosis</strong>&nbsp;or puerperal psychosis is a psychotic disorder characterized by&nbsp;<strong>hallucinations</strong>,&nbsp;<strong>delusions</strong>,&nbsp;<strong>suicidal</strong>&nbsp;<strong>thoughts</strong>, and<strong>&nbsp;thoughts</strong>&nbsp;of&nbsp;<strong>harming&nbsp;</strong>the&nbsp;<strong>baby</strong>. It is a <strong>psychiatric emergency</strong> and usually has a mean time of onset of&nbsp;<strong>2-3</strong>&nbsp;<strong>weeks postpartum&nbsp;</strong>although it can occur in the first few days.&nbsp;The onset of psychotic symptoms is usually preceded by insomnia, restlessness, agitation, lability of mood, and mild cognitive deficits. The treatment of choice involves <strong>antipsychotics</strong> and<strong> lithium</strong>, with an <strong>antidepressant</strong>.&nbsp;</p>\n<p><strong>Postpartum delirium</strong> is characterized by&nbsp;<strong>fluctuating</strong>&nbsp;<strong>levels</strong>&nbsp;of&nbsp;<strong>awareness </strong>or <strong>attention</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following clinical tests is not useful to evaluate a patient with suspected rotator cuff disruption?",
    "choices": [
      {
        "id": 1,
        "text": "Roo's test"
      },
      {
        "id": 2,
        "text": "Neer's test"
      },
      {
        "id": 3,
        "text": "Hawkins-Kennedy test"
      },
      {
        "id": 4,
        "text": "Jobe's test"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>Roo's test</strong> is used to reproduce the symptoms of <strong>thoracic outlet syndrome.</strong></p>\n<p class=\"p1\">Usually, following a <strong>trauma</strong> to the rotator cuff, there is a <strong>vascular reaction</strong> that causes <strong>swelling</strong> and subsequent <strong>rotator cuff impingement.</strong></p>\n<p class=\"p1\"><strong>Rotator cuff disruption</strong> is an <strong>advanced stage</strong> of <strong>impingement.</strong> There is progressive <strong>fibrosis</strong> and disruption of the rotator cuff, leading to a <strong>partial</strong> or <strong>full-thickness tear.</strong> The patient is usually more than 45 years of age and has a history of refractory shoulder pain with weakness and stiffness.</p>\n<p class=\"p1\">The muscles forming the rotator cuff are shown below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d254cbbc18ce4b6780012a9f0f577806x1280x1706.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/483efbd7c2b24000ac169f265beddf4dx1280x2046.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61ab13214fc34093b569d8bbca03b9a6x1280x1992.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e138373ec1044daa6b31014ad6231d8x1280x1319.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8a05ebbece8f4aff9ce81a702fddb41bx720x406.GIF"
    ]
  },
  {
    "text": "A baby having a continuous murmur was sent for cardiac evaluation.  2-D echocardiography showed a connection from the aorta to the main pulmonary artery and color doppler imaging revealed left to right shunting from the aorta into the main pulmonary artery. Which among the following syndromes is not likely to be associated with this cardiac condition?",
    "choices": [
      {
        "id": 1,
        "text": "Edward's syndrome"
      },
      {
        "id": 2,
        "text": "Cri du chat"
      },
      {
        "id": 3,
        "text": "Marfan syndrome"
      },
      {
        "id": 4,
        "text": "Patau syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Patent ductus arteriosus (PDA), </strong>the most likely<strong> diagnosis </strong>in this scenario\u00a0is not usually associated with Marfan's Syndrome. Marfan's syndrome is associated with aortic aneurysms and mitral valve disease.</p>\n<p>Conditions commonly associated with a patent ductus arteriosus are:</p>\n<ul>\n<li><strong>Edward's</strong> syndrome (Trisomy 18- Atrial septal defect, ventricular septal defect, valve abnormalities)</li>\n<li><strong>Patau's</strong> syndrome (Trisomy 13-\u00a0Atrial septal defect, ventricular septal defect, valve abnormalities)</li>\n<li><strong>Cri du chat</strong> (deletion of chromosome 5p15.2- Atrial septal defect, ventricular septal defect, Tetrology of Fallot)</li>\n<li><strong>Noonan's</strong> syndrome (Pulmonic stenosis, atrial septal defect, hypertrophic cardiomyopathy)</li>\n<li><strong>Char</strong> syndrome (craniofacial, limb defects, PDA)</li>\n<li><strong>Congenital Rubella</strong> syndrome</li>\n</ul>\n<div class=\"page\" title=\"Page 420\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>PDA is an <strong>abnormal communication</strong> between the <strong>pulmonary artery </strong>and the <strong>aorta.</strong> The <strong>ductus arteriosus</strong> attaches to the aorta just distal to the left subclavian artery. It closes functionally and anatomically soon after birth. Its <strong>persistence</strong> causes <strong>left to right shunt</strong> and is known is called PDA.\u00a0</p>\n<p>On examination, there are prominent carotid pulsations, hyperkinetic cardiac impulse, palpable systolic or a continuous thrill at the second left intercostal space with continuous <strong>machinery murmur.</strong></p>\n<p>On <strong>chest x-ray</strong>, patients with a large PDA show a prominent pulmonary artery with <strong>increased pulmonary vascular markings</strong>. On an echocardiogram, the ductus can be visualized directly and its size can be estimated. Color and pulsed Doppler examinations demonstrate rleft to right or bidrectional shunting.\u00a0</p>\n<p><strong>Treatment</strong> is by <strong>medical closure</strong> with <strong>indomethacin or</strong> by <strong>surgical closure</strong> of the ductus.\u00a0</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/55df219b8c9c4ba38f0c7cc480b90493x1280x1359.JPEG"
    ]
  },
  {
    "text": "A 24-year-old woman presents to you with dull persistent ear pain. On examination, a palpable mass with a bulge is noted in the tonsillar fossa. X-ray reveals the following finding marked with the red arrow as shown in the image attached below. Pick out the incorrect statement regarding the condition, the patient is most likely to be suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "Pain occurs due to direct irritation of the glossopharyngeal nerve"
      },
      {
        "id": 2,
        "text": "Classically seen in female patients following tonsillectomy"
      },
      {
        "id": 3,
        "text": "External transcervical approach is the most preferred technique"
      },
      {
        "id": 4,
        "text": "Diagnosis can be made if pain subsides on local infiltration with local anesthetics"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette in a woman&nbsp;with referred<strong>&nbsp;</strong>pain to the ear&nbsp;and <strong>bulge</strong> over the<strong> tonsillar fossa,&nbsp;</strong>along with the X-ray showing elongated and calcified&nbsp;<strong>styloid process&nbsp;</strong>is suggestive of&nbsp;<strong>Eagle's&nbsp;</strong><strong class=\"ng-binding\">syndrome (styalgia).&nbsp;</strong>&nbsp;The <strong>transoral approach</strong> through the <strong>tonsillar fossa</strong> is generally <strong>favoured</strong> over the external transcervical approach because of the <strong>lower morbidity</strong>.</p>\n<p><strong>Other options:</strong></p>\n<ul>\n<li>The normal styloid process is 20-30 mm long in adults and is generally accepted to be elongated if exceeding 30 mm. Pain occurs due to direct irritation of the<strong> glossopharyngeal </strong>nerve by the elongated styloid process&nbsp;and ossified stylohyoid ligament.<strong>&nbsp;</strong>(Option-A)</li>\n<li>Usually, this condition is seen&nbsp;<strong>post-tonsillectomy</strong>&nbsp;or&nbsp;<strong>post pharyngeal trauma.</strong>&nbsp;It is more common in females (3:1). (Option-B)</li>\n<li>Palpation should elicit the same pain and discomfort that the patient reports and are pathognomonic of Eagle&rsquo;s syndrome. In contrast, infiltration of a local anaesthetic around the tonsillar fossa should resolve the pain and can be useful diagnostically (Option-D)</li>\n</ul>\n<div class=\"panel-body ng-scope\">&nbsp;</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d8989db3548649cc9a8786690582bfb1.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old woman from a rural area presents with a gritty sensation in her eyes and a past history of salivary gland swelling. She is on oral pilocarpine and steroids. Rose Bengal staining is positive as shown below, especially in the interpalpebral areas. Schirmer's test shows 7mm of wetting in 5 minutes. Which of the following layers of tear film is deficient in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Aqueous layer"
      },
      {
        "id": 2,
        "text": "Lipid layer"
      },
      {
        "id": 3,
        "text": "Mucin layer"
      },
      {
        "id": 4,
        "text": "Glycocalyx layer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario along with the the findings of <strong>interpalpebral conjunctival involvement </strong>on rose bengal stain and\u00a0<strong>dry eye </strong>on Schirmer's test (&lt; 10 mm in 5 minutes) indicate<strong> keratoconjunctivitis sicca. </strong>It occurs due to a deficiency of the <strong>aqueous layer </strong>of tear film.</p>\n<p>She also has a history of<strong> parotid swelling</strong> and <strong>dry eyes</strong>, both of which are characteristic of <strong>Sjogren\u2019s syndrome</strong>, which is a common cause of<strong> keratoconjunctivitis sicca</strong>. Her use of oral pilocarpine to stimulate salivary gland secretion and steroids for immunosuppression further supports the diagnosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/59ef95c33f8446f88779bed485ddfa0e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man presented to the dermatology clinic with the condition shown in the image below. The discoloration started as a streak in the nail which progressed proximally to involve the entire nail. Which among the following drugs is available as a nail lacquer for the treatment of a mild version of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Amorolfine"
      },
      {
        "id": 2,
        "text": "Oxiconazole"
      },
      {
        "id": 3,
        "text": "Griseofulvin"
      },
      {
        "id": 4,
        "text": "Tioconazole"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical stem is suggestive of<strong> onychomycosis </strong>for which<strong>\u00a0amorolfine</strong>, is available as a <strong>nail lacquer</strong> for the treatment. Oxiconazole, griseofulvin, and tioconazole are not available as nail lacquers.</p>\n<p>Onychomycosis or tinea\u00a0unguium refers to the invasion of the nail plate by dermatophytes, or other fungi like\u00a0<em>Neoscytalidium</em>, non\u2010 dermatophyte molds, and Candida.\u00a0</p>\n<p><strong>Distal </strong>and <strong>lateral subungual onychomycosis</strong> (DLSO) is the <strong>most common</strong> and usually presents as a streak or a patch of yellow or white discoloration at the free edge of the nail plate. It then spreads towards the base of the nail and may become dark brown or black. There is an accumulation of soft subungual hyperkeratosis, thickening of the nail plate, and the nail may eventually crack.</p>\n<div class=\"page\" title=\"Page 967\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Further invasion can lead to massive destruction of the nail plate,\u00a0 known as total dystrophic onychomycosis. It can spread to other digits as well.</p>\n<p>Treatment:</p>\n<p>First-line drugs- <strong>Oral terbinafine</strong> for 6 weeks for fingernails and for 3 months for toenails. <strong>Itraconazole</strong> is given for 2-3 months for fingernails and 3-4 months for toenails.</p>\n<p>Topical treatment can be used for\u00a0mild infections affecting the distal nail plate only or\u00a0non\u2010linear superficial onychomycosis.\u00a0<strong>Amorolfine</strong> is available for\u00a0<strong>nail lacquer</strong> that can be painted on the nail. It is applied after abrading the nail once or twice weekly. It is more effective when used with terbinafine or itraconazole\u00a0as a combination therapy for onychomycosis.</p>\n</div>\n</div>\n</div>\n</div>\n<p>Other options:</p>\n<p>Option B: Oxiconazole is administered as a 1% cream or lotion for topical use.</p>\n<p>Option C: Griseofulvin is administered orally.</p>\n<p>Option D: Tioconazole is administered as a nail solution, ointment, or cream but not as a nail lacquer.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c8e225aeb40545abb008d30bd7dee969.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An infant was brought to the emergency with an incessant cry, abdominal distension, and passing blood-stained stools.  A donut-shaped mass was visualized in the right hypochondrium on ultrasonography. On performing barium studies, which sign would be consistent with the diagnosis of this case?",
    "choices": [
      {
        "id": 1,
        "text": "Pseudo kidney sign"
      },
      {
        "id": 2,
        "text": "Corkscrew pattern"
      },
      {
        "id": 3,
        "text": "Coiled spring appearance"
      },
      {
        "id": 4,
        "text": "Target sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical vignette of an infant with incessant crying, abdominal distension, and blood-stained stools with a doughnut sign&nbsp;on ultrasonography is suggestive of <strong>intussusception</strong>. On performing barium studies,&nbsp;<strong>coiled spring appearance&nbsp;</strong>is consistent with the diagnosis of this condition.&nbsp;</p>\n<p>Intussusception occurs when a portion of the alimentary tract is<strong>&nbsp;telescoped</strong>&nbsp;into an adjacent segment. The most common location of intussusception is&nbsp;<strong>ileocolic</strong>.&nbsp;</p>\n<p>Causes of intussusception are:</p>\n<ul>\n<li>Idiopathic - most common cause in children</li>\n<li>Pathological&nbsp;<strong>lead points</strong>&nbsp;such as&nbsp;<strong>en</strong><strong>larged&nbsp;</strong>submucosal<strong>&nbsp;Peyer's patch,&nbsp;</strong>lymphoma, intestinal polyp, leiomyomas, etc.</li>\n<li><strong>Meckel's diverticulum</strong></li>\n<li>A recent upper GI or&nbsp;<strong>respiratory infection</strong>,&nbsp;<strong>rotavirus vaccination</strong>&nbsp;has also shown some association with intussusception in children.</li>\n</ul>\n<p>The characteristic clinical triad includes:</p>\n<ul>\n<li>Pain</li>\n<li>Palpable sausage-shaped mass</li>\n<li><strong>Red currant jelly stools</strong></li>\n</ul>\n<p>USG findings in intussusception include:</p>\n<ul>\n<li><strong>Target sign/&nbsp;</strong>doughnut sign/ bull's eye sign - This is seen in axial view/transverse plane on ultrasonography. The appearance is generated by concentric alternating&nbsp;<strong>echogenic</strong>&nbsp;(mucosa and muscularis) with&nbsp;<strong>hypoechogenic bands</strong>&nbsp;(submucosa).</li>\n<li><strong>Pseudo kidney sign</strong>: this is seen in the longitudinal section of the bowel:\n<ul>\n<li>Edematous bowel resembles renal parenchyma&nbsp;</li>\n<li>Mesentery which is dragged into the intussusception resembles renal hilum.</li>\n</ul>\n</li>\n<li>Crescent in a doughnut sign.</li>\n</ul>\n<p>Barium contrast shows a&nbsp;<strong>coiled spring appearance</strong> with barium in the lumen of the intussusceptum and in the intraluminal space. Plain radiograph may show a <strong>meniscus sign</strong> i.e. soft tissue mass contrasting the bowel that is air-filled.&nbsp;</p>\n<p>Treatment:&nbsp;<strong>Reduction</strong>&nbsp;of intussusception should be<strong> done immediately</strong> after the diagnosis. Radiologic&nbsp;<strong>hydrostatic reduction</strong>&nbsp;has a high success rate in ileocolic intussusception. Surgical reduction is only done in the presence of refractory shock, suspected bowel necrosis or perforation, peritonitis, and multiple recurrences.</p>\n<p>Other options:</p>\n<p>Options A and D: <strong>Pseudo kidney sign</strong> and <strong>target sign</strong> are ultrasonographic findings of instussuception.&nbsp;</p>\n<p>The ultrasonography image below shows pseudo kidney sign and target sign:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/89746c6979ea4fb7aa9c2390a0b29132x630x510.JPEG"
    ]
  },
  {
    "text": "You are a pathologist and you receive a renal biopsy sample for which immunofluorescence has to be done. On observation, you notice the following pattern. Which of the following diseases are ruled out according to the pattern observed?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,6,7"
      },
      {
        "id": 2,
        "text": "1,3,4,6"
      },
      {
        "id": 3,
        "text": "3,4,5,7"
      },
      {
        "id": 4,
        "text": "2,5,7"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given pattern of immunofluorescence microscopy is the \"<strong>granular pattern</strong>\" which is not seen in 2, 5, and 7.</p>\n<p>Granular pattern in immunofluorescence microscopy is characteristic of circulating and in situ immune complex nephritis.</p>\n<p>In RPGN Type I and Goodpasture syndrome, a characteristic <strong>linear pattern</strong> is observed on immunofluorescence which is classic anti-GBM disease.</p>\n<p>In minimal change disease, immunofluorescence is <strong>negative</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/82949346508345d5aa11a36292d667b1.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Match the gastrointestinal hormones in column A to the cells producing them in column B.",
    "choices": [
      {
        "id": 1,
        "text": "1-e, 2-d, 3-c, 4-a"
      },
      {
        "id": 2,
        "text": "1-c, 2-d, 3- a, 4- b"
      },
      {
        "id": 3,
        "text": "1-d, 2-e, 3-a, 4-b"
      },
      {
        "id": 4,
        "text": "1-c, 2-e, 3-a, 4-d"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct match is&nbsp;<strong>1-d, 2-e, 3-a, 4-b.</strong></p>\n<p>Gastrointestinal hormones- site of secretion and their actions</p>\n<table style=\"width: 640.375px;\">\n<tbody>\n<tr>\n<td style=\"width: 140px;\"><strong>Hormones</strong></td>\n<td style=\"width: 193px;\"><strong>Site of secretion</strong></td>\n<td style=\"width: 282.375px;\"><strong>Action</strong></td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Gastrin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">G cells of the antrum, duodenum, and jejunum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates gastric acid secretion and mucosal growth</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Cholecystokinin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">I cells of the duodenum, jejunum, and ileum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p>Stimulates</p>\n<ul>\n<li>Pancreatic enzyme secretion</li>\n<li class=\"p1\">Pancreatic bicarbonate secretion</li>\n<li class=\"p1\">Gallbladder contraction</li>\n<li class=\"p1\">Growth of exocrine pancreas</li>\n</ul>\n<p class=\"p1\">Inhibits gastric emptying</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Secretin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">S cells of the duodenum, jejunum, and ileum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates</p>\n<ul>\n<li class=\"p1\">Pepsin secretion</li>\n<li class=\"p1\">Pancreatic bicarbonate secretion</li>\n<li class=\"p1\">Biliary bicarbonate secretion</li>\n<li class=\"p1\">Growth of exocrine pancreas</li>\n</ul>\n<p class=\"p1\">Inhibits gastrin release and gastric acid secretion</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Glucose-dependent insulinotropic peptide (also called&nbsp;<strong>gastric inhibitory peptide- GIP</strong>)</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">K cells of the duodenum and jejunum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates insulin release</p>\n<p class=\"p1\">Inhibits gastric acid secretion</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">\n<p class=\"p1\">Motilin</p>\n</td>\n<td style=\"width: 193px;\">\n<p class=\"p1\">M cells of the duodenum and jejunum</p>\n</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Stimulates</p>\n<ul>\n<li class=\"p1\">Gastric motility</li>\n<li class=\"p1\">Intestinal motility</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 140px;\">Somatostatin</td>\n<td style=\"width: 193px;\">D cells of pancreas</td>\n<td style=\"width: 282.375px;\">\n<p class=\"p1\">Inhibits the secretion of various gastrointestinal hormones, gastrointestinal motility, and absorption of glucose, amino acids, and triglycerides.</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old hypertensive man presents with acute pain in the chest which radiates to the interscapular region of the back. He is diagnosed to have aortic dissection. Which of the following statements is incorrect about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Involvement of only the descending aorta requires emergency surgical repair"
      },
      {
        "id": 2,
        "text": "Can be associated with Marfan syndrome"
      },
      {
        "id": 3,
        "text": "Distal extension can cause paraplegia"
      },
      {
        "id": 4,
        "text": "Can lead to cardiac tamponade"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The management of <strong>aortic dissection that involves only the descending aorta</strong> (Stanford type B) is <strong>antihypertensive drugs</strong>, not emergency surgery.</p>\n<p><strong>Aortic dissection</strong> occurs due to the <strong>formation of a defect in the intima </strong>of the aorta, leading to the <strong>tracking of the blood through the layers</strong> of the aorta, splitting the medial layer, and thus<strong> forming a false lumen.</strong> The predisposing factors to aortic dissection include:</p>\n<ul>\n<li><strong>Hypertension</strong></li>\n<li><strong>Marfan syndrome </strong>and other disorders of connective tissue that can cause degeneration of the tunica media of the aorta, like Ehlers\u2013Danlos syndrome and giant cell arteritis.</li>\n<li><strong>Pregnancy</strong></li>\n</ul>\n<p>The patients present with a<strong> sudden onset, tearing interscapular pain</strong> with dyspnea. General physical examination may show <strong>hypotension</strong> or <strong>hypertension</strong> and <strong>loss of pulses</strong>. Extension of the dissection in either direction can lead to symptoms related to the organ with compromised perfusion, as given below:</p>\n<ul>\n<li><strong>Proximal extension</strong> can involve head and neck vessels (causing <strong>stroke</strong> or <strong>transient ischemic attack</strong>), coronary vessels (causing <strong>myocardial infarction</strong>) and the root of the aorta (causing <strong>aortic regurgitation</strong>).</li>\n<li><strong>Distal extension</strong> can involve renal arteries (<strong>acute kidney injury</strong>), mesenteric arteries (<strong>mesenteric ischemia</strong>), spinal arteries (<strong>paraplegia</strong>) and iliac arteries (<strong>acute limb ischemia</strong>).</li>\n<li>The dissection may also result in aortic wall rupture into the pericardium (<strong>cardiac tamponade</strong>) or mediastinum (l<strong>eft haemothorax</strong>).</li>\n</ul>\n<p><strong>Transesophageal echocardiography</strong> can be done at the bedside in <strong>patients who are too unstable</strong> for transportation. In <strong>otherwise stable patients</strong>, the <strong>diagnosis is established by a CT scan</strong>. Depending on the part of the aorta involved, aortic dissections are classified as shown in the image below.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e738448b5a8c4a3a978cff9b49e9c5ecx1280x1241.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0ae4e7acacbe4b42a8b0d997d7adbf17x1280x3028.JPEG"
    ]
  },
  {
    "text": "Given below is a histological section of the thyroid gland. Identify the structure marked X in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Follicular cells"
      },
      {
        "id": 2,
        "text": "C-cells"
      },
      {
        "id": 3,
        "text": "Colloid"
      },
      {
        "id": 4,
        "text": "H\u00fcrthle cells"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The structure marked X is the <strong>C-cells</strong> or the <strong>parafollicular cells</strong> of the thyroid gland.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/396953bc7ba947678426c14a4fbe921d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bee7488f76f64daebe923ead0a017ff5x562x470.JPEG"
    ]
  },
  {
    "text": "A man complains of fatigue and numbness in his hands and feet. On examination, he looked pale and his reflexes were poor. The peripheral smear showed a megaloblastic picture. Which of the following tests can differentiate between megaloblastic anemia\u00a0due to folate and vitamin B12 deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "Methylmalonic acid excretion in the urine"
      },
      {
        "id": 2,
        "text": "Serum homocysteine levels"
      },
      {
        "id": 3,
        "text": "Hypersegmented neutrophils in peripheral blood smear"
      },
      {
        "id": 4,
        "text": "Bone marrow biopsy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Measurement of <strong>methylmalonic acid (MMA)</strong> excretion in <strong>urine</strong> can be\u00a0used to differentiate between megaloblastic anemia\u00a0due to folate and vitamin B12\u00a0deficiency.\u00a0</p>\n<p><strong>Methylmalonyl-CoA mutase</strong> is a vitamin <strong>B12\u2013dependent</strong>\u00a0enzyme. The <strong>activity</strong> of <strong>methylmalonyl-CoA mutase</strong> is greatly <strong>reduced</strong> in vitamin <strong>B12 deficiency</strong>, leading to the\u00a0<strong>accumulation</strong> of<strong> methylmalonic acid </strong>in serum\u00a0and its excretion in urine.</p>\n<p>The test for MMA excretion is also used to<strong> assess</strong> the <strong>nutritional status </strong>of<strong> vitamin B12.</strong></p>\n<p>There are two vitamin <span style=\"font-size: 10pt;\">B</span><span style=\"font-size: 11.6667px;\"><span style=\"font-size: 10pt;\">12</span>\u2013</span>dependent enzymes:</p>\n<ul>\n<li><strong>Methionine synthase (homocysteine methyltransferase</strong>): This enzyme catalyzes the conversion of <strong>homocysteine</strong> to <strong>methionine</strong>. This requires both vitamin B12 and folate.</li>\n<li><strong>Methylmalonyl CoA mutase</strong>: Methylmalonyl-CoA, formed as an intermediate in the catabolism of valine, isoleucine, and propionyl CoA, is converted to succinyl CoA.</li>\n</ul>\n<p><strong>Homocysteine\u00a0</strong>will be elevated in both vitamin B12 deficiency and folate deficiency.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d13c3a5f27f9404b84be7a251e9bd1a6x1280x1774.JPEG"
    ]
  },
  {
    "text": "Which of the following drugs acts by inhibiting the late sodium current in the heart?",
    "choices": [
      {
        "id": 1,
        "text": "Ivabradine"
      },
      {
        "id": 2,
        "text": "Ranolazine"
      },
      {
        "id": 3,
        "text": "Trimetazidine"
      },
      {
        "id": 4,
        "text": "Fasudil"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ranolazine</strong> acts by inhibiting the <strong>late sodium current</strong> in the heart.</p>\n<p>Late sodium current (I<sub>Na</sub>) facilitates entry of calcium via the sodium-calcium exchanger. <strong>Inhibition</strong> of&nbsp;<strong>I<sub>Na</sub>,</strong> therefore, reduces the intracellular calcium concentration which in turn reduces the diastolic tension, cardiac contractility and work.</p>\n<p>At higher doses, it may also modify the fatty acid oxidation, which improves the efficiency of cardiac oxygen utilization.</p>\n<p>It is used in the prophylaxis of <strong>angina.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 75-kg woman has a preoperative hematocrit of 35%. How much blood loss can be allowed before transfusion needs to be considered? (Consider transfusion cut off of Hematocrit as 30%)",
    "choices": [
      {
        "id": 1,
        "text": "500 ml"
      },
      {
        "id": 2,
        "text": "600 ml"
      },
      {
        "id": 3,
        "text": "750 ml"
      },
      {
        "id": 4,
        "text": "1000 ml"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>750 ml blood loss can be allowed before transfusion needs to be considered</p>\n<p>The <strong>transfusion point</strong> can be <strong>determined preoperatively from the hematocrit</strong> and by estimating blood volume. Patients with a normal hematocrit should generally be transfused only after losses greater than 10&ndash;20% of their blood volume. The exact point is based on the patient&rsquo;s medical condition and the surgical procedure. The amount of blood loss necessary for the hematocrit to fall to 30% can be calculated as follows:</p>\n<ol>\n<li>Estimate blood volume</li>\n<li>Estimate the red blood cell volume (RBCV) at the preoperative hematocrit (RBCV preop).</li>\n<li>Estimate RBCV at a hematocrit of 30% (RBCV 30%), assuming normal blood volume is maintained.</li>\n<li>Calculate the RBCV lost when the hematocrit is 30%; RBCV lost = RBCV preop &ndash; RBCV 30%</li>\n<li>Allowable blood loss = RBCV lost x3.</li>\n</ol>\n<p><strong>Blood Volume</strong></p>\n<p>Neonates:</p>\n<ul>\n<li>Premature 95 mL/kg</li>\n<li>Full-term 85 mL/kg</li>\n<li>Infants 80 mL/kg</li>\n</ul>\n<p>Adults:</p>\n<ul>\n<li>Men 75 mL/kg</li>\n<li>Women 65 mL/kg</li>\n</ul>\n<p>Estimated blood volume = 65 mL/kg x 75 kg = 4875 mL.</p>\n<p>RBCV 35% = 4875 x 35% = 1706 mL.</p>\n<p>RBCV 30% = 4875 x 30% = 1462 mL.</p>\n<p>Red cell loss at 30% = 1706-1462 = 244 mL.</p>\n<p>Allowable blood loss = 3 x 244 mL = 732 ~ 750ml</p>\n<p>Therefore, transfusion should be considered only when this patient&rsquo;s blood loss exceeds 750 ml.</p>\n<p>Increasingly, transfusions are not recommended until the hematocrit decreases to 24% or lower (hemoglobin &lt;8.0 g/dL), but it is necessary to take into account the rate of blood loss and comorbid conditions.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old girl has deliberately drunk phenol in an attempt to commit suicide. She complains of hot burning sensation extending from mouth to stomach. Which of the following statement is false regarding this?",
    "choices": [
      {
        "id": 1,
        "text": "Gastric lavage is contraindicated"
      },
      {
        "id": 2,
        "text": "Methaemoglobinaemia is an associated feature in severe cases"
      },
      {
        "id": 3,
        "text": "It causes numbness by damaging the nerve endings"
      },
      {
        "id": 4,
        "text": "It is excreted in urine as hydroquinone and pyrocatechol"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Carbolic acid/Phenol</strong> is a corrosive acid, however, it hardens the GI mucosa producing a\u00a0<strong>leather bottle stomach</strong>\u00a0and <strong>anesthetizes the nerve endings</strong>. <strong>Gastric lavage is not contraindicated in phenol poisoning.</strong></p>\n<p>Poisoning by carbolic acid is called<strong> carbolism.</strong></p>\n<p>Signs and symptoms:</p>\n<ul>\n<li>Local skin effects: Burning, tingling followed by anesthesia and greyish white sloughing\u00a0</li>\n<li>Headache, giddiness, tinnitus</li>\n<li>Vomiting, diarrhea, pain abdomen</li>\n<li>Muscular spasms, convulsions</li>\n<li>Collapse</li>\n<li>A clammy, cold sweating body</li>\n<li>Pupils contracted</li>\n</ul>\n<p>In severe cases, hemolysis and <strong>methemoglobinemia</strong> are a characteristic feature.</p>\n<p>In carbolic acid poisoning if the patient\u00a0survives for 48 hrs there will be carboluria followed by anuria.\u00a0The victim will pass dark,\u00a0smoky urine\u00a0which soon turns\u00a0olive green\u00a0on standing due to oxidation of <strong>hydroquinone and pyrocatechol</strong>.\u00a0</p>\n<p>In patients with acute poisoning, the stomach should be washed repeatedly. Initially with plenty of lukewarm water containing activated charcoal, olive oil, castor oil, magnesium or sodium sulphate, or saccharated lime with which phenol combines and forms harmless products. A soap solution or 10% glycerine may be used and the washing continued until the washings are clear and odorless. <br /><br />Once the above is done, the administration of olive oil or vegetable oil is done to remove surface phenol and prevent deep penetration. When lavage is completed, 30 g. of magnesium sulfate or a quantity of medicinal liquid paraffin should be left in the stomach.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 21-year-old woman who is in her 8th week of gestation presents with an increased frequency of vomiting which is associated with retching. She shows signs of dehydration and has developed oliguria. Investigations reveal associated ketoacidosis. All of the following are associated with the condition that this patient has, except ____",
    "choices": [
      {
        "id": 1,
        "text": "Multiple pregnancy"
      },
      {
        "id": 2,
        "text": "Positive family history"
      },
      {
        "id": 3,
        "text": "High body mass index"
      },
      {
        "id": 4,
        "text": "History of migraine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario suggests<strong> hyperemesis gravidarum.</strong>&nbsp;Low body mass is a risk factor associated with it(not high).</p>\n<p>Hyperemesis gravidarum is more common in women with low BMI. Unrelenting nausea and vomiting that is severe enough causes weight loss, dehydration, ketosis, alkalosis, or hypokalemia is known as hypermesis gravidarum.</p>\n<p>It is associated with the following factors:</p>\n<ul>\n<li>First pregnancy</li>\n<li>Young age</li>\n<li><strong>Low body mass</strong></li>\n<li><strong>History of migraine</strong>/motion sickness</li>\n<li><strong>Positive family history</strong></li>\n<li>Hydatidiform mole and <strong>multi-foetal gestation</strong></li>\n</ul>\n<p>Patients with hyperemesis gravidarum usually also suffer from a transient clinical or subclinical form of <strong>hyperthyroidism.</strong></p>\n<p><strong>Management of hyperemesis gravidarum:&nbsp;</strong>Mild to moderate symptoms can be treated with dietary modifications,&nbsp; vitamin B6 with doxylamine/diphenhydramine. Severe cases need IV hydration with thiamine and parenteral ondansetron/metoclopramide/promethazine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients will be classified as stage III (B) according to Ann Arbor staging for Hodgkin lymphoma?",
    "choices": [
      {
        "id": 1,
        "text": "A 25 year old male patient who has fever, night sweats and lymph nodes in the inguinal region and axilla"
      },
      {
        "id": 2,
        "text": "A 25 year old male patient who has lymph nodes in the cervical and axillary regions without symptoms"
      },
      {
        "id": 3,
        "text": "A 25 year old male patient who has fever and lymph nodes in the cervical region and axilla"
      },
      {
        "id": 4,
        "text": "A 25 year old male patient who has lymph nodes in the inguinal region and axilla without symptoms"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A 25-year-old male who has a fever and lymph nodes in the inguinal region and axilla will be classified as stage III (B). Involvement of lymph <strong>nodes</strong> on <strong>both sides</strong> of the diaphragm with <strong>fever&nbsp;</strong>(or night sweats/unexplained weight loss &gt;10%)&nbsp;is<strong> stage III (B) of Ann-Arbor staging</strong>.</p>\n<p>Other Options:</p>\n<p><strong>Option B</strong>: A 25-year-old male patient who has lymph nodes in the cervical and axillary regions without symptoms will be classified as<strong> II (A).</strong></p>\n<p><strong>Option C</strong>: A 25-year-old male patient who has a fever and lymph nodes in the cervical region and axilla will be classified as <strong>II (B).</strong></p>\n<p><strong>Option D</strong>: A 25-year-old male patient who has lymph nodes in the inguinal region and axilla without symptoms will be classified as <strong>III (A).&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man who has been taking NSAIDs for arthritis for the past 2 years presented to the OPD. He complains of fever, rash, and arthralgia since 1 week. Investigations revealed increased eosinophils in blood and urine, no casts, or crystals in urine. No organism could be cultured from urine. Foley's catheterization was done to monitor the urine output. USG for KUB  revealed the picture as shown below. Kidneys were mildly increased in size. What could be the possible diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute tubular nephritis"
      },
      {
        "id": 2,
        "text": "Chronic kidney disease"
      },
      {
        "id": 3,
        "text": "Urethral obstruction"
      },
      {
        "id": 4,
        "text": "Acute interstitial nephritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The likely diagnosis in the given clinical scenario is <strong>acute interstitial nephritis</strong>.</p>\n<p>Acute interstitial nephritis due to NSAIDs characteristically causes increased eosinophils in blood and urine. The ultrasound image shows maintained corticomedullary differentiation (CMD). Preserved CMD appears as a different echogenicity of cortex and medulla. This finding along with enlarged kidneys makes the diagnosis of acute interstitial nephritis more likely.</p>\n<p>Other options:</p>\n<p>CKD - Duration of 1 week and enlarged kidney size with preserved corticomedullary differentiation (CMD) makes this unlikely.&nbsp;</p>\n<p>Urethral obstruction - Successful foley catheterization rules out urethral obstruction</p>\n<p>ATN - An absence of casts or crystals which are usually seen in ATN are absent in this case.&nbsp;</p>\n<p>In a patient with renal disease, we first try to ascertain if it is acute or chronic. Then the management is decided based on the nature of the renal disease which could be pre-renal, renal, or post-renal:</p>\n<table style=\"height: 392px;\" width=\"318\">\n<tbody>\n<tr>\n<td style=\"width: 9px;\">&nbsp;</td>\n<td style=\"width: 135px;\">Parameter</td>\n<td style=\"width: 80px;\">AKI</td>\n<td style=\"width: 73px;\">CKD</td>\n</tr>\n<tr>\n<td style=\"width: 9px;\">1</td>\n<td style=\"width: 135px;\">Duration</td>\n<td style=\"width: 80px;\">Around 7 days</td>\n<td style=\"width: 73px;\">More than 3 months</td>\n</tr>\n<tr>\n<td style=\"width: 9px;\">2</td>\n<td style=\"width: 135px;\">Size</td>\n<td style=\"width: 80px;\">Normal or enlarged</td>\n<td style=\"width: 73px;\">Shrunken&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 9px;\">3</td>\n<td style=\"width: 135px;\"><strong>Corticomedullary </strong><br /><strong>differentiation</strong></td>\n<td style=\"width: 80px;\"><strong>Preserved</strong></td>\n<td style=\"width: 73px;\">Lost</td>\n</tr>\n<tr>\n<td style=\"width: 9px;\">4</td>\n<td style=\"width: 135px;\">Complications of CKD</td>\n<td style=\"width: 80px;\">Absent&nbsp;</td>\n<td style=\"width: 73px;\">Present</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5d2e72df5e30435db3b95bba52303aa1.jpg"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Neet Mini - 14 (20 Q)';
        const quizFilename = 'neet-mini-14-20-q-d606f106.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>