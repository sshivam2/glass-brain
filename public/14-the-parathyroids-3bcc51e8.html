<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14 The Parathyroids - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "While performing a subtotal thyroidectomy, accidental ligation of which artery can potentially lead to hypoparathyroidism?",
    "choices": [
      {
        "id": 1,
        "text": "Superior thyroid artery"
      },
      {
        "id": 2,
        "text": "Inferior thyroid artery"
      },
      {
        "id": 3,
        "text": "Ascending cervical artery"
      },
      {
        "id": 4,
        "text": "Ascending pharyngeal artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Truncal ligation</strong> of the <strong>inferior thyroid artery</strong> can potentially result in <strong>hypoparathyroidism</strong>.&nbsp;Both&nbsp;superior and inferior<strong> parathyroid glands</strong> receive their blood from the inferior thyroid artery&nbsp;which arises from the subclavian arteries.Hence during thyroidectomy, only capsular branches closer to the thyroid gland should be ligated.</p>\n<p>The <strong>inferior</strong> parathyroid glands may have a <strong>variable blood supply</strong>, from either the ascending branch of the inferior thyroid arteries or the thyroid ima artery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6463da8cf984cbe89b73c1f2ae8a44ex1279x1337.JPEG"
    ]
  },
  {
    "text": "Identify the correct pair based on their embryological development.",
    "choices": [
      {
        "id": 1,
        "text": "Thymus, Inferior parathyroid gland - Third pharyngeal pouch"
      },
      {
        "id": 2,
        "text": "Thymus, Superior parathyroid gland - Fourth pharyngeal pouch"
      },
      {
        "id": 3,
        "text": "Superior and Inferior parathyroid gland - Third pharyngeal arch"
      },
      {
        "id": 4,
        "text": "Thymus, Superior parathyroid gland - Fourth pharyngeal arch"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>thymus</strong> and <strong>inferior parathyroid glands</strong> originate from the <strong>third pharyngeal pouch</strong>. They migrate from the upper neck to the mediastinum during embryonic development. Inferior parathyroid glands have more variation in their anatomical position due to a long descent.</p>\n<p>The <strong>superior parathyroid glands</strong> originate from the <strong>fourth pharyngeal pouch</strong>. They are more constant in their position.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e723d93b507470ebeb71887613a5d94x1280x1407.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most common site of ectopic parathyroid gland?",
    "choices": [
      {
        "id": 1,
        "text": "Mediastinal"
      },
      {
        "id": 2,
        "text": "Intrathyroidal"
      },
      {
        "id": 3,
        "text": "Intrathymic"
      },
      {
        "id": 4,
        "text": "Paraesophageal"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most common</strong> site of the <strong>ectopic parathyroid gland</strong>&nbsp;is <strong>paraesophageal</strong>.</p>\n<p>The common sites of ectopic parathyroid glands are</p>\n<ul>\n<li>Paraesophageal - most common</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Mediastinal&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intrathymic&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Intrathyroidal&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Carotid sheath&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">High cervical or undescended&nbsp;</li>\n</ul>\n<p>Ectopic parathyroid is the most common cause of <strong>persistent </strong>or<strong> recurrent hyperparathyroidism</strong>. In such cases, treatment involves <strong>surgical removal</strong> of the gland.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ee5f3098a3542bdb637c0d81234d267x1279x1485.JPEG"
    ]
  },
  {
    "text": "What is the most common cause of hypercalcemia in hospitalized patients?",
    "choices": [
      {
        "id": 1,
        "text": "Hypervitaminosis D"
      },
      {
        "id": 2,
        "text": "Malignancy"
      },
      {
        "id": 3,
        "text": "Parathyroid adenoma"
      },
      {
        "id": 4,
        "text": "Parathyroid hyperplasia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Cancer</strong> is the most common cause of <strong>hypercalcemia</strong> in <strong>hospitalized patients</strong>, whereas hyperparathyroidism is the most common cause of hypercalcemia detected incidentally in outpatients. The causes of hypercalcemia in cancer :\u00a0</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cancers affecting\u00a0<strong>bone </strong>like\u00a0multiple myeloma, leukemia, bony metastasis - cause the bone to break down which\u00a0<strong>releases excess calcium</strong> into the blood</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Pseudohyperparathyroidism</strong> - tumours producing\u00a0parathyroid hormone-related peptide <strong>(PTHrP)</strong>\u00a0cause the bone to release calcium into the blood. The most common carcinoma associated is squamous cell carcinoma of lung.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cancers affecting <strong>kidneys</strong> - failure to remove excess calcium from the blood</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Dehydration</strong> caused by nausea and vomiting - difficult for the kidneys to remove calcium from the blood properly</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Lack </strong>of<strong> physical activity</strong> - causes bone breakdown, releasing calcium into the blood</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of primary hyperparathyroidism?",
    "choices": [
      {
        "id": 1,
        "text": "Single adenoma"
      },
      {
        "id": 2,
        "text": "Multiple adenoma"
      },
      {
        "id": 3,
        "text": "Hyperplasia"
      },
      {
        "id": 4,
        "text": "Carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A<strong> single adenoma</strong> is the <strong>most common</strong> cause of <strong>primary hyperparathyroidism</strong>. They are most often located in the inferior parathyroid glands.</p>\n<p>Primary hyperparathyroidism is due to <strong>excess </strong>or<strong> non-suppressed PTH</strong> secretion from the following:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Single parathyroid adenoma&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Multiple adenomas&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hyperplasia&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Carcinoma&nbsp;</li>\n</ul>\n<p><strong>Sporadic</strong> primary hyperparathyroidism (<strong>HPT</strong>) is <strong>more common</strong> than familial (MEN syndrome/ familial HPT/ Familial HPT with jaw tumor syndrome). <strong>Women</strong> are affected more commonly than men.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Lab investigations in a patient with fatigue and colicky abdominal pains show elevated PTH and calcium, and low serum phosphate. Which of the following ophthalmic findings is pathognomonic of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Kayser Fleischer rings"
      },
      {
        "id": 2,
        "text": "Band keratopathy"
      },
      {
        "id": 3,
        "text": "Ocular chrysiasis"
      },
      {
        "id": 4,
        "text": "Hudson-Stahli line"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option A: Kayser Fleischer rings are brownish-yellow rings in the corneoscleral junction due to the deposition of <strong>copper</strong> in the cornea.&nbsp;</p>\n<p>Option C: Ocular chrysiasis is the deposition of gold in the cornea, after repeated parenteral administration of <strong>gold salts</strong>.&nbsp;</p>\n<p>Option D: Hudson Stahli line is a superficial brown line at the junction of the upper 2/3 and lower 1/3 of the cornea in an otherwise normal cornea. It is attributed to the deposition of <strong>iron</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4513eb0275e849ffbafce00501ec3d47x1280x960.JPEG"
    ]
  },
  {
    "text": "During a clinical trial, it was found that some individuals who showed radioactive uptake on Sestamibi scan, showed no other evidence of hyperparathyroidism. They were instead found to be suffering from a Hurthle cell nodule of the thyroid gland. Which of the following radioactive tracer tests could be used to rule out the false positives?",
    "choices": [
      {
        "id": 1,
        "text": "Ga-68 Dotatate"
      },
      {
        "id": 2,
        "text": "Iodine-131 MIBG"
      },
      {
        "id": 3,
        "text": "Tc-99m Pertechnetate"
      },
      {
        "id": 4,
        "text": "Tc-99m Medronate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A thyroid-specific tracer like <strong>99Tc-Pertechnetate</strong> and subsequent subtraction images could be used to <strong>rule out</strong> the <strong>false positives</strong> caused by the solid thyroid nodules such as Hurthle cell nodule.</p>\n<p>The Sestamibi scanning is a nuclear-based imaging test used to<strong> localize the parathyroid glands</strong>. Sestamibi is a monovalent lipophilic cation that&nbsp;<strong>accumulates in mitochondria</strong>. Due to this, there is a difference in the rate at which it gets washed out depending upon the number of mitochondria in each tissue. <strong>Parathyroid adenomas</strong> often have a high concentration of <strong>oxyphilic cells</strong> with <strong>high mitochondrial content </strong>and they retain tracers and have a slower washout compared to the normal glands.</p>\n<p>In patients with nodular goiter or functional <strong>tumors of the thyroid gland</strong>, increased uptake of sestamibi by the thyroid gland makes parathyroid visualization difficult.&nbsp;There are two primary techniques to <strong>differentiate</strong> sestamibi uptake by abnormal parathyroid and thyroid tissue:</p>\n<ul>\n<li><strong>Dual-isotope subtraction imaging&nbsp;</strong>(with sestamibi and either iodine-123 or 99mTc pertechnetate)<strong>&nbsp;-&nbsp;&nbsp;<sup>99m</sup>Tc pertechnetate </strong>is taken up only by the<strong> thyroid. </strong>The&nbsp;<sup>99m</sup>Tc pertechnetate scintigram is then digitally subtracted from the sestamibi scan&nbsp;to allow parathyroid localization.</li>\n<li><strong>Single-isotope dual-phase</strong> imaging (with sesta&shy;mibi alone with early and delayed imaging)<strong>&nbsp;- </strong>since the rate of washout from the hyperfunctioning parathyroid gland is slower when compared to the thyroid gland.</li>\n</ul>\n<p>The image given below shows the dual-isotope subtraction imaging.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b76161fc238044019b534813a8a69201x290x276.JPEG"
    ]
  },
  {
    "text": "A patient presents with polyuria, polydipsia, lethargy and abdominal pain. He had an X-ray taken a few days ago, which is given below. Which of the following investigations would not be useful in arriving at a diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Nuclear sestamibi scan"
      },
      {
        "id": 2,
        "text": "Ultrasonography of neck"
      },
      {
        "id": 3,
        "text": "Dual-energy radiographic absorptiometry"
      },
      {
        "id": 4,
        "text": "Angiography of renal arteries"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Investigations</strong> done in primary hyperparathyroidism:</p>\n<ul>\n<li><strong>Ultrasonography</strong> of the neck is a safe and widely used technique for the localization of abnormal parathyroid glands. <strong>\u00a0</strong></li>\n<li>Nuclear medicine scanning with <strong>radiolabeled Sestamibi</strong> is also a widely used technique. Sestamibi accumulates in parathyroid adenomas. This radionuclide is concentrated in the thyroid and parathyroid tissue but usually washes out of normal thyroid tissue in under an hour. It persists in abnormal parathyroid tissue.\u00a0\u00a0</li>\n<li><strong>Dual-energy radiographic absorptiometry</strong> is a useful tool to demonstrate skeletal involvement in primary hyperparathyroidism.</li>\n</ul>\n<p>The image given below shows a radiolabeled Sestamibi scan.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/871e7bbd04c04510b4729524de1f7c2e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5a97f3a764664ddcab38ab9a33f0112ex672x526.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7204f4e10a44f878b1d4145e1e53a47x512x512.PNG"
    ]
  },
  {
    "text": "In a patient with asymptomatic primary hyperparathyroidism, when will you perform parathyroidectomy?",
    "choices": [
      {
        "id": 1,
        "text": "If bone mineral density of  > 2.5 SD above peak bone mass"
      },
      {
        "id": 2,
        "text": "If age >50 years"
      },
      {
        "id": 3,
        "text": "In the presence of hypercalciuria but absence of nephrolithiasis"
      },
      {
        "id": 4,
        "text": "If creatinine clearance is reduced by 30%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Reduction in creatinine clearance by 30%&nbsp;</strong>is an indication for parathyroidectomy in patients with asymptomatic primary hyperparathyroidism.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old lady with a history of multiple pathological fractures and renal stones was diagnosed with parathyroid hyperplasia involving all four glands. Which of the following treatment modalities will you use to treat her?",
    "choices": [
      {
        "id": 1,
        "text": "Complete removal of all four glands alone"
      },
      {
        "id": 2,
        "text": "Complete removal of three glands with a partial resection of the least affected gland"
      },
      {
        "id": 3,
        "text": "Partial resection of the affected glands with autotransplantation of the least affected gland"
      },
      {
        "id": 4,
        "text": "Brachytherapy with PTH supplementation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Hyperplasia involving all four parathyroid glands is treated by <strong>complete removal of three glands</strong> with <strong>partial resection of the least affected gland (Subtotal parathyroidectomy)</strong>. Total cervical parathyroidectomy with heterotropic transplantation can also be done in this patient.</p>\n<p>Modes of <strong>treatment</strong> for parathyroid hyperplasia:</p>\n<ol>\n<li><strong>Subtotal parathyroidectomy -</strong>&nbsp;The <strong>affected glands </strong>are <strong>completely removed</strong> and the <strong>least affected gland </strong>is<strong> partially resected</strong>. The remnants left behind should ideally be 30 mg. A lower gland is preferred because its location reduces the risk of injury to the recurrent laryngeal nerve.&nbsp;</li>\n<li><strong>Total parathyroidectomy</strong> with heterotopic transplantation - <strong>All 4 </strong>parathyroid glands are <strong>removed</strong> and parathyroid <strong>tissue</strong> is <strong>immediately transplanted</strong> to the non-dominant forearm. Pockets are made in the belly of the <strong>brachioradialis</strong> muscle, and one to two pieces of parathyroid tissue measuring 1 mm each are placed into each pocket. A total of 12 to 14 pieces are transplanted.</li>\n</ol>\n<p><strong>Complications</strong> of <strong>parathyroidectomy</strong> include:</p>\n<ul>\n<li>Persistent or recurrent hyperparathyroidism</li>\n<li>Hypoparathyroidism</li>\n<li>Hungry bone syndrome</li>\n<li>Injury to recurrent laryngeal nerve</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Autotransplantation was done after total parathyroidectomy in a patient with hyperplasia of all 4 parathyroid glands. Which of the following best describes this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Heterotopic"
      },
      {
        "id": 2,
        "text": "Orthotopic"
      },
      {
        "id": 3,
        "text": "Auxiliary"
      },
      {
        "id": 4,
        "text": "Isograft"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 348\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Parathyroid is transplanted&nbsp;<strong>heterotopically </strong>i.e.<strong>&nbsp;</strong>organ is implanted in another anatomic location.</p>\n<p>In&nbsp;total parathyroidectomy,&nbsp;all 4 parathyroid glands are removed&nbsp;and parathyroid tissue is&nbsp;immediately transplanted&nbsp;to the brachioradialis muscle in the non-dominant forearm.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Parathyroid gland post surgery  is commonly transferred to:",
    "choices": [
      {
        "id": 1,
        "text": "Triceps"
      },
      {
        "id": 2,
        "text": "Biceps"
      },
      {
        "id": 3,
        "text": "Sartorius"
      },
      {
        "id": 4,
        "text": "Brachioradialis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>parathyroid</strong> is commonly transferred to the <strong>brachioradialis</strong> muscle <strong>post-surgery</strong>. This will facilitate easy removal if there is disease recurrence after surgery.</p>\n<p>Parathyroidectomy is <strong>indicated</strong> in:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Symptomatic</strong> <strong>primary</strong> hyperparathyroidism <strong>(HPT)</strong>:&nbsp;&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Asymptomatic</strong> primary HPT with:\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">raise in serum calcium &gt;1mg/dl of the normal range</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&gt;400 mg urinary calcium in 24-hour urine test</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">&lt; -2.5 Z-score of bone mineral density</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Age &lt;50yr and failed medical treatment&nbsp;</li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Severe cases</strong> of <strong>secondary</strong> HPT</li>\n</ol>\n<p>Parathyroidectomy is <strong>performed</strong> in neck hyperextension <strong>(semi-Fowler position)</strong>. The thyroid gland is mobilized, and the parathyroid gland with adenoma is identified and resected. The parathyroid tissue is <strong>transplanted</strong> to the <strong>non-dominant forearm</strong>.</p>\n<p>Pockets are made in the <strong>belly of the brachioradialis muscle</strong>, and one to two pieces of parathyroid tissue measuring 1 mm each are placed into each pocket. A total of 12 to 14 pieces are transplanted. This is a type of <strong>heterotopic transplant.</strong></p>\n<p><strong>Miami criteria</strong> (confirm the <strong>absence</strong> of another <strong>hyperactive parathyroid</strong>): A drop of parathyroid hormone intraoperatively, to <strong>more than half</strong> the maximum value at <strong>10 minutes </strong>postresection is considered an adequate resection in a parathyroid adenoma. However, if there is <strong>no drop</strong> in PTH level, then a <strong>multi-gland disease</strong> is suspected and the surgery is converted to a bilateral neck exploration.</p>\n<p>Complications of parathyroidectomy include:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Persistent or recurrent hyperparathyroidism</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypoparathyroidism (presenting as hypocalcemia)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hungry bone syndrome</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Injury to the recurrent laryngeal nerve</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman presents with complaints of numbness around the lips and a tingling sensation in her fingers. She underwent parathyroidectomy for hyperparathyroidism one year ago. An ECG was done and is given below. What will be your immediate management?",
    "choices": [
      {
        "id": 1,
        "text": "Beta blockers"
      },
      {
        "id": 2,
        "text": "Teriparatide"
      },
      {
        "id": 3,
        "text": "IV Bisphosphonates"
      },
      {
        "id": 4,
        "text": "IV Calcium gluconate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Acute symptomatic hypocalcemia is an emergency and must be treated with:</p>\n<ul>\n<li><strong>10 ml</strong> of <strong>10% calcium gluconate</strong> is given slowly through <strong>intravenous</strong> route</li>\n<li>Calcium and vitamin D replacement is given orally</li>\n<li>Magnesium supplementation may also be required due to the synergistic actions of calcium and magnesium</li>\n</ul>\n<p>The continuous need for calcium or vitamin D, 1-year postoperatively is called <strong>permanent hypoparathyroidism</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc12d66e8e4a437e92e396317b308ba2.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d4c48e73535461ab15bea1f0755d4d3x600x486.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false about secondary hyperparathyroidism?",
    "choices": [
      {
        "id": 1,
        "text": "Lithium intake may cause secondary hyperparathyroidism"
      },
      {
        "id": 2,
        "text": "Calciphylaxis is seen in early stages"
      },
      {
        "id": 3,
        "text": "Multiple gland affliction is common"
      },
      {
        "id": 4,
        "text": "Transcervical thymectomy is indicated"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Calciphylaxis</strong> (calcific uremic arteriolopathy) is a disseminated calcification seen <strong>late</strong> in the course of <strong>secondary hyperparathyroidism.</strong></p>\n<p>In calciphylaxis, the underlying calcification in the vascular and arteriolar walls&nbsp;&rarr;&nbsp;ischemic necrosis&nbsp;&rarr; ulceration and gangrene &rarr; sepsis &rarr; death.</p>\n<p>It presents as an <strong>expanding cutaneous lesion</strong> which is predominantly seen in the extremities and lower abdomen. Prognosis is poor and an <strong>urgent parathyroidectomy</strong> is shown to increase median survival.<strong><br /></strong></p>\n<p><strong>Causes of secondary hyperparathyroidism:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Chronic renal failure (<strong>most common</strong>)</li>\n<li aria-level=\"1\">Vitamin D3 deficiency</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">GI malabsorption</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Lithium intake</li>\n</ul>\n<p>To minimize the risk of missing parathyroid glands, <strong>transcervical</strong>&nbsp;<strong>thymectomy</strong> should be considered as a routine part of total parathyroidectomy with autotransplantation and subtotal parathyroidectomy. In addition, careful cervical exploration for secondary hyperparathyroidism should be carried out.</p>\n<p>The image below shows <strong>calciphylaxis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f917645c8624c09b6f2543ad514d571x1280x805.PNG"
    ]
  },
  {
    "text": "A 45-year-old patient with chronic renal failure presents to the OPD with complaints of recent onset pain in her feet. Blood investigation showed elevated PTH levels and normal serum calcium values. All of the following mechanisms contribute to elevated PTH in this patient except _____",
    "choices": [
      {
        "id": 1,
        "text": "Stimulation of parathyroid cells by hyperphosphatemia"
      },
      {
        "id": 2,
        "text": "Increased secretion of FGF-23 by osteocytes"
      },
      {
        "id": 3,
        "text": "Reduced expression of Vitamin D receptors and CaSR (calcium-sensing receptor) in bones"
      },
      {
        "id": 4,
        "text": "Interference with parathyroid kinase C signal transduction pathway and Wnt pathway"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario described here showing <strong>elevated PTH</strong> and <strong>normal calcium </strong>levels is that of <strong>secondary hyperparathyroidism</strong> due to renal failure. <strong>Interference</strong> with <strong>parathyroid kinase C</strong> signal transduction pathway and <strong>Wnt pathway</strong> is the proposed mechanism of secondary hyperparathyroidism in the setting of <strong>lithium consumption</strong> and not renal hyperparathyroidism.</p>\n<p>Causes for increased PTH in secondary hyperparathyroidism due to renal failure:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abnormal renal tubular reabsorption&nbsp;&rarr; <strong>hyperphosphatemia</strong> &rarr; stimulation of parathyroid cells &rarr; elevated PTH</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased <strong>FGF-23</strong> secretion from osteocytes &rarr; &nbsp;decreased 1,25 dihydroxyvitamin D &rarr; decreased intestinal absorption of calcium &rarr; elevated PTH</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Normally, ECF calcium controls PTH secretion by interacting with CaSR. Stimulation of CaSR by high calcium suppresses PTH secretion. In chronic renal disease, there is <strong>reduced expression of Vitamin D and CaSR</strong> by bones &rarr; increased skeletal resistance to PTH &rarr; elevated PTH.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old female patient is undergoing focussed parathyroidectomy for parathyroid adenoma. According to the Miami criteria, for the resection to be considered adequate, the intraoperative drop in parathyroid hormone should be ______.",
    "choices": [
      {
        "id": 1,
        "text": "More than one third  the maximum preoperative value in 10min"
      },
      {
        "id": 2,
        "text": "More than one third  the maximum preoperative value in half an 30 min"
      },
      {
        "id": 3,
        "text": "More than half  the maximum preoperative value in 10min"
      },
      {
        "id": 4,
        "text": "More than half  the maximum preoperative value in 30 min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Drop of parathyroid hormone to\u00a0<strong>more than half the maximum</strong> value at <strong>10 min</strong> postresection is considered an adequate resection in a parathyroid adenoma by the <strong>Miami criteria</strong>.</p>\n<p>Most of the patients with primary hyperparathyroidism have <strong>single</strong> <strong>adenoma</strong>, and therefore undergo a <strong>focused</strong> or <strong>minimally invasive parathyroidectomy,</strong> where the localized abnormal parathyroid gland is removed. Once the gland is removed, the surgeon can ensure that there is no other hyperactive gland remaining by performing an intraoperative PTH assay for Miami criteria.</p>\n<p>It is based on the principle that the <strong>half-life</strong> of the PTH is<strong> 3-5 minutes</strong>. In a single-gland disease, once the gland is removed the PTH levels should drop to &gt;<strong>50% of the preoperative PTH level within 10 minutes</strong>. However, if there is no drop in PTH level, then a multi-gland disease is suspected and the surgery is converted to a <strong>bilateral neck exploration.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman presented with complaints of fatigue, vomiting, abdominal cramps and bone pain. She had undergone total parathyroidectomy and heterotopic autotransplantation for the same complaints 8 months ago. Sestamibi scan was done and found to be normal. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Perform Casanova test"
      },
      {
        "id": 2,
        "text": "Post her for bilateral neck exploration"
      },
      {
        "id": 3,
        "text": "Post her for radiotherapy"
      },
      {
        "id": 4,
        "text": "Label her as persistent hyperparathyroidism and start her on medical management"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>recurrent hyperparathyroidism</strong> which could be due to recurrence in the <strong>neck</strong> or <strong>graft</strong> (graft hyperplasia). The next step would be to perform <strong>Casnova test</strong> to differentiate between them, as Sestamibi scan has ruled out ectopic parathyroid.</p>\n<p>Casanova test involves <strong>selective venous sampling</strong> for<strong> PTH levels</strong> from neck veins and brachial veins. If PTH from the <strong>brachial</strong> venous sample is <strong>&gt;20 times</strong> that of <strong>neck</strong> vein sample, <strong>graft hyperplasia</strong> is confirmed.</p>\n<p><strong>Persistent</strong> parathyroidism is defined as hypercalcemia that fails to resolve after parathyroidectomy i.e. <strong>within 6 weeks</strong> of surgery. <strong>Recurrent</strong> parathyroidism is hyperparathyroidism that occurs after an intervening period of at least <strong>6 months</strong> of biochemically documented <strong>normocalcemia</strong>. Causes of persistent/recurrent hyperparathyroidism include:</p>\n<ul>\n<li>Ectopic parathyroid</li>\n<li>Unrecognized hyperplasia - graft site hyperplasia</li>\n<li>Missed adenoma in normal position</li>\n<li>Incomplete resection</li>\n<li>Familial hyperparathyroidism</li>\n<li>MEN-1 syndrome</li>\n</ul>\n<p>The image below summarises the management protocol for a case of persistent/recurrent hyperparathyroidism.<br /><br />*FHH stands for Familial hypocalciuric hypercalcemia</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/79b71b8113c84ba6a42bf8da9c6b5a71x1280x2336.JPEG"
    ]
  },
  {
    "text": "All of the following are indications for surgical intervention of tertiary hyperparathyroidism except ____",
    "choices": [
      {
        "id": 1,
        "text": "Reduced serum phosphate"
      },
      {
        "id": 2,
        "text": "Nephrocalcinosis"
      },
      {
        "id": 3,
        "text": "Nodular hyperplasia of the parathyroid gland"
      },
      {
        "id": 4,
        "text": "Impaired graft function"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Reduced serum phosphate is not an indication for surgical intervention in tertiary hyperparathyroidism.\u00a0</p>\n<p><strong>Renal transplantation</strong> in patients with chronic kidney diseases may be associated with <strong>autonomous</strong> <strong>functioning</strong> of the <strong>parathyroid</strong> gland. This is called\u00a0<strong>tertiary</strong> hyperparathyroidism where there is <strong>hypercalcemic</strong> hyperparathyroidism.</p>\n<p>The <strong>indications</strong> for<strong> surgical intervention</strong> in tertiary hyperparathyroidism are as follows :</p>\n<ul>\n<li>Subacute severe hypercalcaemia (&gt;3 mmol/L)</li>\n<li>Impaired graft function</li>\n<li>Nodular hyperplasia of the parathyroid gland(s)</li>\n<li>Progressive symptoms for &gt;2 years following transplantation\n<ul>\n<li>Worsening bone disease - pain, fractures, bone loss</li>\n<li>Renal stones/nephrocalcinosis</li>\n<li>Soft tissue or vascular calcifications</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 75-year-old lady with type 2 diabetes mellitus, hypertension, and end-stage renal disease on hemodialysis presents with hypercalcemia, hyperphosphatemia, and elevated PTH. What is the treatment of choice in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Total parathyroidectomy without autotransplantation"
      },
      {
        "id": 2,
        "text": "Subtotal parathyroidectomy"
      },
      {
        "id": 3,
        "text": "Minimally invasive focussed parathyroidectomy"
      },
      {
        "id": 4,
        "text": "Medical management with cinacalcet"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient&rsquo;s <strong>long-standing renal failure</strong> and <strong>elevated calcium</strong>, <strong>phosphate</strong>, and <strong>PTH</strong> are suggestive of <strong>tertiary hyperparathyroidism</strong>. This form of hyperparathyroidism can be <strong>life-threatening</strong>, and <strong>all patients</strong> with it should be referred for <strong>surgical intervention</strong>.&nbsp;</p>\n<p>The surgical <strong>procedure of choice</strong> for tertiary hyperparathyroidism is <strong>subtotal parathyroidectomy</strong>. In subtotal parathyroidectomy, the <strong>affected glands are completely removed</strong> and the <strong>least affected gland is partially resected</strong>. &nbsp;</p>\n<p>Option A: Total parathyroidectomy <strong>without an autograft</strong> is <strong>not a treatment option</strong> due to the postoperative and persistent <strong>difficulties</strong> in managing the associated <strong>hypocalcemia.</strong></p>\n<p>Option C: Minimally invasive approaches commonly refer to the removal of a <strong>localized abnormal parathyroid gland</strong> through an incision less than 3cm in length. It is based on the principle that over 80% of individuals with primary hyperparathyroidism have a<strong> single adenoma</strong>.&nbsp;It is <strong>contraindicated</strong> in <strong>multi-glandular disease</strong>, <strong>lithium-induced hyperparathyroidism,</strong> and hyperparathyroidism associated with <strong>familial syndromes</strong>.</p>\n<p>Option D: <strong>Cinacalcet</strong> is a calcimimetic <strong>used in</strong> the treatment of <strong>secondary hyperparathyroidism</strong>. The use of calcimimetics in <strong>tertiary hyperparathyroidism</strong> remains controversial and has <strong>not been approved</strong> for this indication.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 41-year-old man with a history of treatment for Hodgkin's lymphoma in childhood presents with severe abdominal cramps and right flank pain. He has a firm 2x2cm mass in the front of his neck. He has a Calcium of 15.2 mg/dl, normal TSH, markedly elevated PTH, and PGP9.5+ on immunohistochemistry. What is the leading cause of mortality in his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Metastasis"
      },
      {
        "id": 2,
        "text": "Cardiovascular disease"
      },
      {
        "id": 3,
        "text": "Tracheal compression"
      },
      {
        "id": 4,
        "text": "Hypercalcemia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient presents with symptoms suggestive of <strong>primary hyperparathyroidism</strong>. With <strong>early-onset, neck mass</strong>, and positive IHC for <strong>PGP9.5+</strong>, it is concerning for <strong>parathyroid cancer</strong>. <strong>Hypercalcemia</strong> is the <strong>leading cause</strong> of morbidity and <strong>mortality</strong> in patients with parathyroid cancer.&nbsp;</p>\n<p>Parathyroid cancer is a <strong>rare</strong> malignancy and makes up 1% of cases of primary hyperparathyroidism. History of <strong>prior neck radiation</strong> is considered to be a<strong> risk factor.</strong> Patients usually present a decade earlier than primary hyperparathyroidism (5th - 6th decade), with an equal preponderance in males and females. Patients may present with a neck mass and severely elevated calcium and PTH levels.</p>\n<p><strong>Treatment</strong> is focused on <strong>controlling hypercalcemia</strong> and <strong>surgery</strong> is the mainstay.</p>\n<p>Option B: <strong>Cardiovascular disease</strong> is a major contributing cause of <strong>mortality</strong> in patients with <strong>hyperthyroidism </strong>and<strong>&nbsp;chronic kidney disease</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients with parathyroid carcinoma, which of the following treatment modalities would you not consider?",
    "choices": [
      {
        "id": 1,
        "text": "Radiation therapy"
      },
      {
        "id": 2,
        "text": "Azidothymidine"
      },
      {
        "id": 3,
        "text": "En-bloc excision of the tumor and ipsilateral thyroid lobe with MRND"
      },
      {
        "id": 4,
        "text": "Etelcalcetide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Etelcalcetide has no role in the treatment of parathyroid carcinoma. It is ineffective.</p>\n<p><strong>Etelcalcetide</strong> is a calcium-sensing receptor agonist used to treat <strong>secondary hyperparathyroidism</strong> in adult patients with <strong>chronic kidney disease&nbsp;</strong>undergoing dialysis.</p>\n<p><strong>Treatment </strong>modalities for<strong> parathyroid carcinoma:</strong></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Surgical - Bilateral neck exploration + En-bloc excision of the tumor and ipsilateral thyroid lobe with/without MRND (Modified radical neck dissection) in presence of lymph node metastasis.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pharmacological:\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Cinacalcet</strong> hydrochloride, a calcimimetic, can reduce PTH levels by directly binding to the CaSR (calcium-sensing receptor) cells on the parathyroid gland; used to <strong>control hypercalcemia</strong> in refractory parathyroid carcinoma.&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Azidothymidine</strong> (telomerase inhibitor)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Octreotide</strong>&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Anti-parathyroid hormone immunotherapy</li>\n</ul>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Radiation therapy - for unresectable disease or for palliation of bone metastases</li>\n</ul>\n<p><strong>Risk factors</strong> for parathyroid carcinoma incude:</p>\n<ul>\n<li>Radiation exposure</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hyperparathyroidism jaw bone syndrome&nbsp;</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">HPRT gene or parafibromin inactivation</li>\n</ul>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old man presents with severe hypercalcemia. His father had similar complaints and was found to have hyperparathyroid-jaw tumour syndrome. Which of the following is pathognomonic of his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cystic mandibular lesions"
      },
      {
        "id": 2,
        "text": "Ossifying jaw fibromas"
      },
      {
        "id": 3,
        "text": "Osteitis fibrosa cystica"
      },
      {
        "id": 4,
        "text": "Mandibular granulomas"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ossifying jaw fibromas</strong> are a <strong>pathognomonic</strong> feature of <strong>hyperparathyroid-jaw tumour syndrome</strong>.&nbsp;It arises due to inactivating mutations in the HRPT2 gene on chromosome 1 q21-32, encoding <strong>parafibromin.</strong></p>\n<p>It is a rare cause of primary hyperparathyroidism with an <strong>early onset (32 years)</strong> which presents with <strong>severe hypercalcemia</strong>. It is associated with an <strong>increased risk</strong> of <strong>parathyroid carcinoma</strong> and other conditions like polycystic kidney disease.<strong> Surgical intervention</strong> may be considered to remove all enlarged glands.</p>\n<p><strong>Osteitis fibrosa cystica</strong> is a feature of <strong>hyperparathyroidism</strong> but is not considered pathognomonic of any condition.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '14 The Parathyroids';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>