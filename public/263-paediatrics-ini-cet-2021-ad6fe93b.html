<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>263 Paediatrics Ini-Cet 2021 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">11</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a true statement about congenital CMV infection?",
    "choices": [
      {
        "id": 1,
        "text": "About 20-30% of the infections are symptomatic"
      },
      {
        "id": 2,
        "text": "Triad of SNHL, periventricular calcification and enamel hypoplasia"
      },
      {
        "id": 3,
        "text": "Most children asymptomatic at birth can develop conductive hearing loss later in life"
      },
      {
        "id": 4,
        "text": "If mother is  IgG  positive for CMV,  the child is unlikely to  develop infection"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>If the <strong>mother</strong> is <strong>IgG positive </strong>for CMV, then the <strong>child</strong> is <strong>unlikely to develop the infection</strong>.&nbsp;</p>\n<p>In <strong>one-third</strong> of mothers who develop a <strong>primary</strong> infection during pregnancy, the <strong>virus</strong> gets <strong>transmitted</strong> to the fetus. In <strong>previously infected</strong> <strong>mothers</strong> with IgG antibodies, <strong>only</strong> <strong>1-3%</strong> would <strong>transmit</strong> the virus to the fetus.</p>\n<p>Most CMV transmission occurs in the&nbsp;<strong>first&nbsp;trimester</strong>. The&nbsp;<strong>risk</strong>&nbsp;of transmission is high in the&nbsp;<strong>third</strong>&nbsp;trimester. Only <strong>10%</strong> of infants with congenital CMV infection are <strong>symptomatic</strong> (option A).</p>\n<p><strong>Hepatosplenomegaly</strong>, <strong>jaundice,</strong> and <strong>petechiae</strong> constitute the clinical triad (option B) in congenital CMV. Neuroimaging shows&nbsp;<strong>intracranial</strong>&nbsp;<strong>periventricular calcifications</strong>.<strong>&nbsp;</strong>Other manifestations include IUGR, hydrops, microcephaly, pneumonitis, chorioretinitis, seizures, sensorineural hearing loss, abnormal dentition, and hypocalcified enamel.</p>\n<p>About <strong>half</strong> of the <strong>symptomatic</strong> infants develop <strong>long-term sequelae</strong> which include <strong>sensorineural hearing loss</strong> (SNHL)<strong>,</strong> <strong>vision loss,</strong> seizure disorders, mental retardation, and developmental delay. But in <strong>asymptomatic</strong> infants, <strong>only</strong> about <strong>13.5%</strong> develop long-term <strong>sequelae</strong> which is commonly SNHL (option C).</p>\n<p>The investigation of choice is&nbsp;<strong>PCR</strong>&nbsp;or&nbsp;<strong>viral culture</strong>. It should be done&nbsp;<strong>within the first two to three weeks of life</strong>. After this period, it is difficult to distinguish between a congenital and an acquired infection. Since not all affected infants are viremic at birth,&nbsp;<strong>urine&nbsp;</strong>and/or <strong>saliva</strong>&nbsp;are&nbsp;<strong>more reliable</strong>&nbsp;samples than&nbsp;<strong>blood</strong>.&nbsp;</p>\n<p>There is&nbsp;<strong>no definitive treatment</strong>&nbsp;for congenital CMV infection. Treatment with<strong>&nbsp;ganciclovir&nbsp;</strong>is<strong>&nbsp;</strong>indicated only in patients with progressive neurologic disease and deafness.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are components of kangaroo mother care?",
    "choices": [
      {
        "id": 1,
        "text": "Early discharge, skin to skin contact, prevent infection"
      },
      {
        "id": 2,
        "text": "Early discharge, skin to skin contact, exclusive breastfeeding"
      },
      {
        "id": 3,
        "text": "Skin to skin contact, exclusive breastfeeding, prevent infection"
      },
      {
        "id": 4,
        "text": "Early discharge, exclusive breastfeeding and prevent infection"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>duration</strong> of KMC should be gradually <strong>increased</strong> from short sessions of more than one hour to 24 hours a day.</p>\n<p>KMC is <strong>comparable</strong> to incubators in terms of <strong>safety and thermal protection</strong>&nbsp;as evidenced by mortality rates. Additionally, it has been shown to <strong>reduce severe morbidity</strong> by facilitating breastfeeding.</p>\n<p>KMC promotes the <strong>bonding</strong> between mother and child, fostering a strong emotional connection during the early stages of life.</p>\n<p>Note:&nbsp;Incubatory care, feeding via nasal catheter, and prevention of infection are part of intensive care for low birthweight babies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4c0aa0914e5b48578619e9d302291641x1280x855.JPEG"
    ]
  },
  {
    "text": "Which of the following is given as a part of the therapy for a child with severe COVID?",
    "choices": [
      {
        "id": 1,
        "text": "Corticosteroids"
      },
      {
        "id": 2,
        "text": "Ivermectin"
      },
      {
        "id": 3,
        "text": "Remdesivir"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Among the given options, <strong>only corticosteroids</strong> are given for children with <strong>severe</strong> COVID-19.</p>\n<p>Severe COVID-19 infection is defined as&nbsp;<strong>SpO2 &lt;90% on room air</strong> with <strong>any</strong> of the following findings: acute respiratory distress syndrome <strong>(ARDS)</strong>, signs of severe pneumonia, <strong>septic shock</strong>, multi-organ dysfunction syndrome (<strong>MODS</strong>) or <strong>pneumonia with cyanosis</strong>, <strong>grunting</strong>, severe chest retraction, lethargy, somnolence, seizures.</p>\n<p>It is important to note that <strong>CT chest</strong> is <strong>not indicated</strong> in the diagnosis or management of COVID-19 in <strong>children</strong> and is <strong>only</strong> considered when there is <strong>no improvement</strong> in the respiratory status.</p>\n<p>Regarding the management of severe COVID-19 infection, the Ministry of Health and Family Welfare (MoHFW) guidelines mention that, in <strong>mild </strong>or <strong>asymptomatic</strong> COVID-19 infection, <strong>steroids</strong> are <strong>avoided</strong> and are found to be harmful. However, in <strong>rapidly progressive</strong> moderate or severe cases, corticosteroids are <strong>used</strong> in the treatment.</p>\n<p>This can be administered in two ways: <strong>Dexamethasone</strong> at a dose of <strong>0.15 mg/kg</strong>, with a maximum dose of 6 mg, once a day, or <strong>Methylprednisolone</strong> at a dose of <strong>0.75 mg/kg,</strong> with a maximum dose of 30 mg, once a day.</p>\n<p><strong>Steroids</strong> should be given for <strong>5-7 days</strong>, with a gradual tapering off over <strong>10-14 days,</strong> and are avoided within the first 3-5 days of symptom onset, as they <strong>prolong viral shedding</strong>.</p>\n<p>The use of <strong>antivirals</strong> (option C) or <strong>monoclonal antibodies</strong> is <strong>not recommended</strong> for children less than 18 years of age, irrespective of the severity of the infection.</p>\n<p><strong>Antimicrobials</strong> should <strong>not</strong> be prescribed unless there is clinical <strong>suspicion</strong> of a superadded infection or the patient is in septic shock.</p>\n<p><strong>Anticoagulants</strong> are <strong>not</strong> indicated routinely, except in patients having a strong personal or family <strong>history</strong> of <strong>thromboembolism</strong> or more than <strong>four high-risk factors</strong> for developing thrombosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is seen in physiological jaundice?",
    "choices": [
      {
        "id": 1,
        "text": "Increased indirect bilirubin, increased urobilinogen, absent bilirubin in urine"
      },
      {
        "id": 2,
        "text": "Increased indirect bilirubin, absent urobilinogen, absent bilirubin in urine"
      },
      {
        "id": 3,
        "text": "Increased direct bilirubin, increased urobilinogen, absent bilirubin in urine"
      },
      {
        "id": 4,
        "text": "Increased direct bilirubin, absent urobilinogen, absent bilirubin in urine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In physiological jaundice, there is&nbsp;<strong>increased indirect bilirubin</strong>,<strong> increased urobilinogen</strong>,<strong> and absent bilirubin in urine.</strong></p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p><strong>Physiological jaundice </strong>(icterus neonatorum) is due to <strong>increased bilirubin production</strong>&nbsp;from the&nbsp;<strong>breakdown</strong>&nbsp;of&nbsp;<strong>fetal red</strong>&nbsp;<strong>blood cells</strong>&nbsp;combined with transient&nbsp;<strong>limitation in the conjugation of bilirubin</strong>&nbsp;by the immature&nbsp;<strong>neonatal liver</strong>. It first&nbsp;<strong>appears on the 2nd or 3rd days</strong>&nbsp;usually peaks on the 4th day at 5-6 mg/dL and decreases to &lt;2 mg/dL&nbsp;between the 5th and 7th days after birth.</p>\n<p>Physiological jaundice would lead to an increase in <strong>indirect</strong> (unconjugated)<strong> bilirubin</strong>.&nbsp;Increased levels of unconjugated bilirubin in the blood lead to increased production of <strong>urobilinogen</strong> which would be present in the urine. <strong>Urine bilirubin</strong> is not usually found in this condition.</p>\n<p>Risk factors for physiological jaundice include maternal age, maternal diabetes, prematurity, drugs (vitamin K3, novobiocin), polycythemia, male sex, trisomy 21, cutaneous bruising, blood extravasation as in cephalhematoma, breastfeeding, weight loss, and a family history of physiological jaundice.</p>\n<p>On the other hand, in&nbsp;<strong>pathological jaundice, the </strong>appearance of jaundice is<strong>&nbsp;within the first 24 hours</strong>&nbsp;after birth and may be present at or beyond the age of&nbsp;<strong>2 weeks&nbsp;</strong>in<strong>&nbsp;term&nbsp;</strong>babies and<strong>&nbsp;3 weeks&nbsp;</strong>in<strong>&nbsp;preterms&nbsp;</strong>babies. Other signs of pathological jaundice include&nbsp;an <strong>increase</strong> in serum bilirubin exceeding <strong>5mg/dL</strong> within a <strong>24-hour</strong> period, a serum bilirubin level <strong>greater than 12mg/dL</strong> in a full-term&nbsp;infant or between <strong>10-14mg/dL</strong> in a <strong>preterm</strong> infant,&nbsp;and a <strong>direct</strong> bilirubin level more than <strong>2mg/dL</strong> at any given time.&nbsp;Jaundice visible on the&nbsp;<strong>palms and soles</strong>,&nbsp;<strong>unresponsiveness to phototherapy</strong>, and a rapid rise in bilirubin levels during phototherapy indicate pathological jaundice.</p>\n<p>When the concentration of <strong>unconjugated bilirubin exceeds 20-25mg/dL</strong>, bilirubin would penetrate the blood-brain barrier and lead to <strong>kernicterus</strong>.</p>\n<p><strong>Phototherapy</strong>&nbsp;is initiated in babies with pathological jaundice when the&nbsp;<strong>bilirubin</strong>&nbsp;levels&nbsp;<strong>exceed</strong>&nbsp;the&nbsp;<strong>95th percentile</strong>&nbsp;on the&nbsp;<strong>total serum bilirubin&nbsp;</strong>(TSB)<strong>&nbsp;normogram</strong>. Babies are kept at a distance of&nbsp;<strong>30-45 cm</strong>&nbsp;from the UV lamp (<strong>460-490 nm</strong>) with&nbsp;<strong>eyes and gonads covered</strong>. It is&nbsp;<strong>avoided</strong>&nbsp;in babies with&nbsp;<strong>conjugated</strong>&nbsp;hyperbilirubinemia due to the risk of&nbsp;<strong>bronze-baby syndrome</strong>.&nbsp;<strong>Dehydration</strong>&nbsp;and&nbsp;<strong>hypocalcemia</strong>&nbsp;are potential complications and&nbsp;<strong>breastfeeding</strong>&nbsp;is encouraged.</p>\n<p><strong>Exchange transfusion</strong>&nbsp;(ET) is done in cases of&nbsp;<strong>bilirubin encephalopathy</strong>,&nbsp;<strong>Rh incompatibility with significant hemolysis</strong>, and bilirubin values exceeding TSB cutoffs for ET.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child presents with fever and vesicular lesions on the upper limb and the lower limb. Neck stiffness was present. Similar lesions were present on the palms, soles, and oral cavity. CSF analysis revealed normal glucose levels and elevated lymphocytes and protein. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bacterial meningitis with sepsis"
      },
      {
        "id": 2,
        "text": "Coxsackie viral meningitis and Hand Foot Mouth disease"
      },
      {
        "id": 3,
        "text": "Herpes simplex gingivostomatitis and meningoencephalitis"
      },
      {
        "id": 4,
        "text": "Tuberculous meningitis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option A: <strong>Bacterial</strong> meningitis with sepsis is unlikely given the <strong>vesicular lesions' </strong>distribution<strong> pattern</strong> (bacteria are less likely to cause vesicles in the oral cavity). Moreover, CSF findings in bacterial meningitis usually show decreased glucose, elevated neutrophils, and elevated protein levels.</p>\n<p>Option D: <strong>Tuberculous</strong> meningitis is less likely as there is <strong>no</strong> history of TB <strong>exposure</strong> provided. In most cases, CSF findings in tuberculous meningitis demonstrate <strong>elevated lymphocytes</strong> and protein levels, along with <strong>decreased glucose.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a40227920b5c462ca3be28818d25b471.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/88d3937ac7904c4db7f4f67350cd408ax1280x955.PNG"
    ]
  },
  {
    "text": "Match the following developmental milestones:",
    "choices": [
      {
        "id": 1,
        "text": "1-a, 2-b, 3-c, 4-d"
      },
      {
        "id": 2,
        "text": "1-b, 2-a, 3-d, 4-c"
      },
      {
        "id": 3,
        "text": "1-c, 2-b, 3-a, 4-d"
      },
      {
        "id": 4,
        "text": "1-d, 2-c, 3-b, 4-a"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correctly matched developmental milestones are as follows:</p>\n<table style=\"width: 387px; height: 138px;\">\n<tbody>\n<tr style=\"height: 14.5469px;\">\n<td style=\"width: 238.875px; height: 14.5469px;\">1.&nbsp;<span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">Transfers objects</span></td>\n<td style=\"width: 129.125px; height: 14.5469px;\"><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">b. 6-7 months&nbsp;</span></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 238.875px; height: 18px;\">2.&nbsp;<span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">Social smile</span></td>\n<td style=\"width: 129.125px; height: 18px;\"><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">a. 1-2 months</span></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 238.875px; height: 18px;\"><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">3. Pincer grasp &nbsp; &nbsp;</span></td>\n<td style=\"width: 129.125px; height: 18px;\">d. 9-12 months</td>\n</tr>\n<tr style=\"height: 16px;\">\n<td style=\"width: 238.875px; height: 16px;\"><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">4. Walks 1-2 steps</span></td>\n<td style=\"width: 129.125px; height: 16px;\"><span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Column 1 -                                  Column 2\\nReaches for objects                      5-6 months\\nSocial smile                                   1-2 months, \\nPincer grasp                                  9-11 months\\nwalks 1-2 steps                            12- 13 months&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:771,&quot;3&quot;:{&quot;1&quot;:0},&quot;4&quot;:{&quot;1&quot;:2,&quot;2&quot;:11982760},&quot;11&quot;:4,&quot;12&quot;:0}\">c. 12-15 months</span></td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following congenital heart disease has equal saturation in all the chambers of the heart?",
    "choices": [
      {
        "id": 1,
        "text": "Tetralogy of Fallot"
      },
      {
        "id": 2,
        "text": "Total anomalous pulmonary venous circulation"
      },
      {
        "id": 3,
        "text": "Tricuspid atresia"
      },
      {
        "id": 4,
        "text": "Transposition of great arteries"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D - <span class=\"TextRun SCXW247863283\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW247863283\">&nbsp;</span></span>Transposition of great arteries (TGA) <span class=\"TextRun SCXW247863283\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW247863283\">is characterized by the&nbsp;<strong>aorta arising </strong>from the <strong>right ventricle</strong>&nbsp;and the&nbsp;<strong>pulmonary artery </strong>from the l<strong>eft ventricle</strong>. Because of this, the pulmonary and systemic circulations remain separate. The <strong>right side</strong> of the heart has <strong>deoxygenated blood</strong> and the <strong>left side</strong> of the heart has <strong>oxygenated blood.</strong>&nbsp;</span></span><span class=\"TextRun SCXW247863283\" lang=\"EN-IN\" xml:lang=\"EN-IN\"><span class=\"NormalTextRun SCXW247863283\">The pulmonary artery saturation is always higher than the aortic saturation.</span></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/932870621c2e4d3eba75bf3d2553f16ax1280x1267.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/552e64f8fa3142dd885c894c6557e416x1280x1266.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b071b1594a04411847a2e3b6a60b9d7x1280x1266.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b8baf8883f5549aca47cda4b9886ed75x1280x1382.JPEG"
    ]
  },
  {
    "text": "Which of the following marked structure is damaged in respiratory distress syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The alveoli are surrounded by pulmonary capillaries. The alveoli also contain other specialized cells, including pulmonary alveolar macrophages, lymphocytes, plasma cells, neuroendocrine cells, and mast cells.<span class=\"Apple-converted-space\">\u00a0</span></p>\n<p><strong>Respiratory distress syndrome</strong>\u00a0(RDS) is seen in <strong>premature infants</strong>, due to the\u00a0<strong>decreased production and secretion </strong>of the<strong>\u00a0lung surfactant</strong>. The surfactant reduces the alveolar surface tension. This phospholipid is synthesized in <strong>type II pneumocytes</strong>\u00a0(also called granular pneumocytes) in the endoplasmic reticulum.</p>\n<p>The <strong>surfactant</strong> appears in the <strong>amniotic fluid</strong> between <strong>28</strong> and <strong>32 weeks</strong> of gestation. <strong>Mature</strong> levels of the pulmonary surfactant are present usually after <strong>35 weeks</strong> of gestation. In a premature infant, there is a decrease in both the quantity and quality of surfactant resulting in respiratory distress syndrome.\u00a0\u00a0</p>\n<p>Administration of <strong>antenatal glucocorticoids\u00a0</strong>to mothers who deliver at 24 to 34 weeks can\u00a0<strong>increase surfactant production </strong>and\u00a0reduce the risk of RDS. It includes either giving <strong>2</strong> doses of <strong>betamethasone 12mg/dose</strong> with <strong>24 hours</strong> between each dose, or <strong>4</strong> doses of <strong>dexamethasone</strong> <strong>6mg/dose</strong>, with <strong>12 hours</strong> between each dose.</p>\n<p class=\"p1\">Mild to moderate RDS can be managed <span class=\"s1\">with </span>continuous positive <span class=\"s1\">airway </span>pressure (CPAP). <span class=\"s1\"><strong>CPAP</strong> is a </span>noninvasive modality <span class=\"s1\">of support </span>where <span class=\"s1\">a continuous </span>distending pressure <span class=\"s2\">(5-7 </span><span class=\"s1\">cm </span>H<sub><span class=\"s3\">2</span></sub><span class=\"s2\">0) </span>is <span class=\"s1\">applied at the\u00a0</span>nostril level to keep the <span class=\"s1\">alveoli </span>open in <span class=\"s1\">a spontaneously </span>breathing baby. Severe cases will require <strong>mechanical ventilation.<br /></strong></p>\n<p class=\"p1\"><strong>Surfactant\u00a0</strong>administration is reserved for <strong>severe</strong> cases and <strong>moderate</strong> cases not improving even with <strong>fiO2&gt; 40%</strong> in <strong>CPAP.</strong></p>\n<p class=\"p1\">With treatment, it rarely leads to respiratory failure and has a <strong>good</strong> prognosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/32687bfa2ad7416dbf634a9b1d28ddd0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7901dad0826f48d1a03a6ae952a50a5fx1280x1449.JPEG"
    ]
  },
  {
    "text": "Which of the following are causes of neonatal seizures ?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3 only"
      },
      {
        "id": 2,
        "text": "1, 2, 3, and 4"
      },
      {
        "id": 3,
        "text": "1, 3, 4 only"
      },
      {
        "id": 4,
        "text": "2, 4 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>All of the above-given options, <strong>hyponatremia, hypomagnesemia, hypocalcemia, </strong>and<strong> hypernatremia</strong>&nbsp;are causes of neonatal seizures.&nbsp;</p>\n<p>The causes of neonatal seizure according to the age of presentation are summarised in the table below:</p>\n<table style=\"height: 530.23px; width: 691px;\">\n<tbody>\n<tr style=\"height: 22.3926px;\">\n<td style=\"width: 209.277px; height: 22.3926px; text-align: center;\"><strong>1 to 4 days</strong></td>\n<td style=\"width: 202.207px; height: 22.3926px; text-align: center;\"><strong>4 to 14 days</strong></td>\n<td style=\"width: 238.633px; height: 22.3926px; text-align: center;\"><strong>2 to 8 weeks</strong></td>\n</tr>\n<tr style=\"height: 115.166px;\">\n<td style=\"width: 209.277px; height: 115.166px;\">\n<p><strong>Hypoxic ischemic encephalopathy</strong></p>\n</td>\n<td style=\"width: 202.207px; height: 115.166px;\">\n<p>Bacterial meningitis</p>\n<p>Encephalitis (enteroviral, herpes simplex)</p>\n</td>\n<td style=\"width: 238.633px; height: 115.166px;\">\n<p>Encephalitis (enteroviral, herpes simplex)</p>\n<p>Bacterial meningitis</p>\n</td>\n</tr>\n<tr style=\"height: 40.7773px;\">\n<td style=\"width: 209.277px; height: 40.7773px;\">\n<p>Drug withdrawal, maternal drug use</p>\n</td>\n<td style=\"width: 202.207px; height: 40.7773px;\">\n<p>Hypocalcemia <br />Hypoglycemia</p>\n</td>\n<td style=\"width: 238.633px; height: 40.7773px;\">\n<p>Subdural hematoma <br />Child abuse</p>\n</td>\n</tr>\n<tr style=\"height: 76.7773px;\">\n<td style=\"width: 209.277px; height: 76.7773px;\">\n<p>Drug toxicity: lidocaine, penicillin</p>\n</td>\n<td style=\"width: 202.207px; height: 76.7773px;\">\n<p>Galactosemia <br />Fructosemia</p>\n</td>\n<td style=\"width: 238.633px; height: 76.7773px;\">\n<p>Aminoaciduria<br />Urea cycle defects</p>\n</td>\n</tr>\n<tr style=\"height: 54.3848px;\">\n<td style=\"width: 209.277px; height: 54.3848px;\">\n<p><strong>Intraventricular hemorrhage</strong></p>\n</td>\n<td style=\"width: 202.207px; height: 54.3848px;\">\n<p>&nbsp;</p>\n</td>\n<td style=\"width: 238.633px; height: 54.3848px;\">\n<p>Malformations of cortical development</p>\n</td>\n</tr>\n<tr style=\"height: 143.955px;\">\n<td style=\"width: 209.277px; height: 143.955px;\">\n<p>Hypocalcemia<br />Sepsis<br /><strong>Hypoglycemia</strong> Hypomagnesemia <br />Hypo or hypernatremia</p>\n</td>\n<td style=\"width: 202.207px; height: 143.955px;\">\n<p>&nbsp;</p>\n</td>\n<td style=\"width: 238.633px; height: 143.955px;\">\n<p>Tuberous sclerosis</p>\n</td>\n</tr>\n<tr style=\"height: 76.7773px;\">\n<td style=\"width: 209.277px; height: 76.7773px;\">\n<p>Galactosemia<br />Urea cycle disorders</p>\n</td>\n<td style=\"width: 202.207px; height: 76.7773px;\">\n<p>&nbsp;</p>\n</td>\n<td style=\"width: 238.633px; height: 76.7773px;\">\n<p>Sturge-Weber syndrome</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Hypoxic-ischemic encephalopathy</strong> is the <strong>most common</strong> cause. Metabolic disorders cause neonatal seizures commonly. <strong>Hypoglycemia</strong> is the most <strong>common metabolic</strong> cause of neonatal seizures.&nbsp;</p>\n<p>Neonatal seizures may be of different types - subtle, tonic, clonic, spasms, and myoclonic.</p>\n<p><strong>Subtle</strong> seizures are the <strong>most common</strong> type of neonatal seizures. They involve movements like <strong>transient eye deviations, nystagmus,</strong> blinking, mouthing, <strong>cycling,</strong> and<strong> apnea</strong>, and are more <strong>common</strong> in <strong>premature</strong> infants.</p>\n<p><strong>Tonic</strong> seizures are characterized by <strong>increased muscle tension,</strong> either focal (sustained posturing of a single limb) or generalized (bilateral tonic limb extensions or flexions of the upper limbs with tonic extension of the lower limbs and trunk). They can <strong>not</strong> be <strong>provoked</strong> by stimulation or suppressed by restraint.</p>\n<p><strong>Clonic</strong> seizures involve <strong>repetitive contractions</strong> of <strong>muscle groups.</strong> <strong>Spasms</strong> are sudden <strong>generalized jerks</strong> associated with brief discharges.</p>\n<p><strong>Myoclonic</strong> seizures are the least common type of neonatal seizures and are <strong>rapid jerks (&lt;50 msec) without rhythmicity.</strong></p>\n<p><strong>Electroencephalogram</strong> (EEG) is the preferred <strong>diagnostic</strong> investigation for seizures, while <strong>MRI</strong> is the recommended neuroimaging modality for <strong>etiological</strong> evaluation. <strong>Phenobarbital</strong> is the drug of <strong>choice</strong> for treatment. In <strong>term</strong> neonates, hypoxic-ischemic encephalopathy <strong>(HIE)</strong> is the most common cause of seizures, while <strong>intraventricular hemorrhage</strong> (IVH) is more prevalent in <strong>preterm neonates.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A neonate is found to have increased irritability, poor feeding, and 2 episodes of seizures. Lumbar puncture was done and the findings were suggestive of meningitis. What is the most likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Escherichia coli"
      },
      {
        "id": 2,
        "text": "Streptococcus agalactiae"
      },
      {
        "id": 3,
        "text": "Neisseria meningitidis"
      },
      {
        "id": 4,
        "text": "Listeria monocytogenes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario describes <strong>neonatal meningitis</strong>. E. coli &gt; <span data-sheets-value=\"{&quot;1&quot;:2,&quot;2&quot;:&quot;Streptococcus agalactiae&quot;}\" data-sheets-userformat=\"{&quot;2&quot;:769,&quot;3&quot;:{&quot;1&quot;:0},&quot;11&quot;:4,&quot;12&quot;:0}\"><em>Streptococcus agalactiae</em>, part of g</span>roup B <em>streptococ</em>c<em>i</em>, are the most likely causative organism of neonatal meningitis.</p>\n<p><strong>Early</strong> features of meningitis include <strong>temperature instability</strong> (hypo or hyperthermia), lethargy, <strong>bradycardia,</strong> and <strong>feed intolerance.</strong>\u00a0<strong>L</strong><strong>ate</strong> features include <strong>seizures,</strong> bulging fontanelle, and <strong>nuchal rigidity.</strong></p>\n<p>The most common cause of bacterial meningitis in a <strong>0 to 2-month</strong> baby is group B <em>streptococci </em>(Option B) <strong>worldwide</strong> and <strong>g</strong><strong>ram-ve</strong> bacteria like <em><strong>E.coli </strong>and</em> Klebsiella (option A) in India. In babies aged <strong>2 to 24 months</strong>, <strong>pneumococci</strong> are the primary causative pathogens, followed by H. influenzae. For children <strong>older than 2 years</strong>, <strong>pneumococci</strong> remain a prominent cause of meningitis, with Neisseria meningitidis being the second most common pathogen.</p>\n<p>The most common etiological agents of neonatal meningitis and sepsis are listed in the table below:</p>\n<table style=\"border-collapse: collapse; width: 32.4641%; height: 67.1778px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3926px;\">\n<td style=\"width: 17.3386%; height: 22.3926px;\">\u00a0</td>\n<td style=\"width: 42.1315%; height: 22.3926px; text-align: center;\">India</td>\n<td style=\"width: 40.4597%; height: 22.3926px; text-align: center;\">Worldwide</td>\n</tr>\n<tr style=\"height: 22.3926px;\">\n<td style=\"width: 17.3386%; height: 22.3926px;\">Neonatal meningitis</td>\n<td style=\"width: 42.1315%; height: 22.3926px;\"><em><strong>E. coli</strong>, Klebsiella</em></td>\n<td style=\"width: 40.4597%; height: 22.3926px;\">Group B <em>Streptococci</em></td>\n</tr>\n<tr style=\"height: 22.3926px;\">\n<td style=\"width: 17.3386%; height: 22.3926px;\">Neonatal sepsis</td>\n<td style=\"width: 42.1315%; height: 22.3926px;\"><strong><em>Klebsiella</em></strong>, <em>S.</em> aures, <em>E. coli</em></td>\n<td style=\"width: 40.4597%; height: 22.3926px;\">Group B <em>Streptococci</em></td>\n</tr>\n</tbody>\n</table>\n<p>Neonates have immature cellular and humoral immunity. This makes them prone to meningitis and sepsis. Thus, an infant with a fever who is 28 days or younger, should be evaluated for sepsis.</p>\n<p>Option C: <strong>Meningococcal infections</strong> are usually asymptomatic. If invasive disease occurs, then the clinical spectrum varies widely from meningococcal meningitis (highest proportion) to\u00a0bacteremia without sepsis, meningococcal septicemia with or without meningitis, pneumonia, chronic meningococcemia, and occult bacteremia.</p>\n<p class=\"p1\">Option D: Meningitis caused by <em>Listeria monocytogenes</em> is rare but clinically significant. Infants can acquire the infection <strong>in utero</strong> or through an infected <strong>birth canal.</strong> Neonatal <strong>listeriosis</strong> can manifest as <strong>early-onset</strong> disease, typically within <strong>1-2 days</strong> of birth, primarily as a <strong>septicemic</strong> form. Alternatively, it can present as a <strong>late-onset</strong> disease in infants older than <strong>5 days,</strong> predominantly as a <strong>meningitic</strong> form.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "At what age does a child attain half-height of the adult height?",
    "choices": [
      {
        "id": 1,
        "text": "12 - 18 months"
      },
      {
        "id": 2,
        "text": "20 - 24 months"
      },
      {
        "id": 3,
        "text": "32 - 36 months"
      },
      {
        "id": 4,
        "text": "40 - 48 months"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A child attains half of the adult height by <strong>20&nbsp;-24 months.</strong></p>\n<p>The normal length at <strong>birth</strong> is <strong>50 cm</strong>, increasing to around <strong>75 cm</strong> at <strong>1 year</strong> of age. By the end of the second year, the length ranges from 85 to 90 cm.</p>\n<p>From age 2 to around 12 years, there is a steady growth of about 6 cm per year. During pubertal growth spurts after age 12, females grow an average of 8 cm per year, while males grow around 10 cm per year.</p>\n<p>By around <strong>2 years</strong> of age, a normal child reaches<strong> half of their adult height</strong> (around 80-85 cm). Height <strong>doubles</strong> by age <strong>4</strong> and <strong>triples</strong> by age <strong>12</strong> compared to the birth length.</p>\n<p>Between <strong>18-24 months</strong>, a child experiences significant growth and development.</p>\n<p>Physically, they improve their <strong>balance,</strong> learn to <strong>run</strong> and <strong>climb stairs,</strong> and reach about <strong>half</strong> of their <strong>adult height. </strong>Head growth slows slightly, with <strong>85% of adult head</strong> circumference achieved by the age of <strong>2 years.</strong></p>\n<p>Cognitive development includes the establishment of <strong>object permanence</strong> and <strong>problem-solving skills</strong> (e.g., using a stick to obtain a toy that is out of reach).</p>\n<p>Emotionally, they display <strong>self-recognition</strong> and recognize when toys are <strong>broken.&nbsp;</strong>When toddlers see anything abnormal in their noses while gazing into a mirror for the first time, they tend to touch their own faces rather than reaching out toward the reflected image.</p>\n<p>Linguistically, their vocabulary expands from <strong>10-15</strong> words to<strong> 50-100 words</strong>, and they start <strong>combining</strong> words to form simple sentences while understanding <strong>two-step</strong> commands (eg., give me the ball and then get your shoes).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '263 Paediatrics Ini-Cet 2021';
        let hierarchy = ["Marrow", "PYQs", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>