<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet Mini - 3 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An alcoholic man is admitted to a rehabilitation center for alcohol deaddiction. After three days, he develops visual hallucinations. His vital signs are given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Wernicke syndrome"
      },
      {
        "id": 2,
        "text": "Korsakoff psychosis"
      },
      {
        "id": 3,
        "text": "Delirium tremens"
      },
      {
        "id": 4,
        "text": "Alcohol intoxication"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of an alcohol-dependent patient&nbsp;with <strong>tactile hallucinations</strong>, tachycardia, hypertension and fever following alcohol <strong>withdrawal</strong> indicates a likely diagnosis of&nbsp;<strong>delirium tremens</strong>.</p>\n<p><strong>Delirium tremens</strong> is the most severe form of <strong>alcohol withdrawal</strong> syndrome. It occurs within a<strong>&nbsp;week</strong> of a person stopping or reducing the intake of alcohol. Acute infection, hepatitis, and pancreatitis predispose a person in withdrawal to develop delirium tremens. Clinically, patients present with confusion, agitation, and fluctuating levels of consciousness. <strong>Visual </strong>or <strong>tactile hallucinations </strong>are also seen, along with features of <strong>autonomic hyperactivity</strong> like<strong> tachycardia,</strong> diaphoresis, <strong>fever</strong>, insomnia, and <strong>hypertension</strong>.&nbsp;</p>\n<p>Delirium tremend is managed with benzodiazepines such as <strong>lorazepam</strong>&nbsp;(intravenously)&nbsp;or&nbsp;<strong>chlordiazepoxide</strong> (orally every 4 hours). It is also recommended to administer <strong>thiamine</strong> in patients with alcohol-related disorders to prevent Wernicke-Korsakoff syndrome.</p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Wernicke encephalopathy&nbsp;</strong>is an acute encephalopathy caused due to<strong> thiamine deficiency </strong>in alcohol-dependent patients who tend to have micronutrient deficiencies. Patients present with a characteristic triad of <strong>ophthalmoplegia, ataxia</strong>, and <strong>global confusion</strong>. Treatment includes immediate administration of a high dose of 500 mg intravenous thiamine.</p>\n<p>Option B:&nbsp;<strong>Korsakoff psychosis</strong>&nbsp;is an <strong>amnestic syndrome</strong> that occurs due to <strong>thiamine deficiency </strong>in alcohol-dependent patients. The clinical features include impairment of memory, <strong>confabulations</strong>, and disordered temporal sequencing. Treatment includes 100 mg of oral thiamine daily for 3-12 months.</p>\n<p>Option D: In <strong>alcohol intoxication</strong>, there is a <strong>history</strong> of <strong>recent ingestion of alcohol.&nbsp;</strong>Patients present with slurred speech, incoordination, unsteady gait, and nystagmus. Impairments in attention and memory are also seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old woman presents to the physician's office with a history of a new nodule in the neck noted 2 months ago. The patient has a family history of thyroid cancer. Histopathology of the nodule shows the following finding. This patient must be screened for mutations in which of the following genes?",
    "choices": [
      {
        "id": 1,
        "text": "RET"
      },
      {
        "id": 2,
        "text": "RAS"
      },
      {
        "id": 3,
        "text": "p53"
      },
      {
        "id": 4,
        "text": "BRCA"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette with histopathology showing the presence of <strong>amyloid-rich stroma</strong>\u00a0is characteristic of <strong>medullary thyroid carcinoma </strong>(MTC). Patients with MTC must be screened for <strong>RET point mutations</strong>\u00a0so as to distinguish sporadic from familial disease.\u00a0</p>\n<p><span style=\"text-decoration: underline;\"><strong>Medullary thyroid cancer(MTC) -\u00a0</strong></span></p>\n<p>Medullary thyroid carcinoma is a tumor of <strong>parafollicular or C cells</strong>\u00a0of the thyroid gland.\u00a0Most of the MTCs occur sporadically. However, familial MTC is seen in MEN2A and MEN2B.</p>\n<p><strong>Clinical features -\u00a0</strong>Commonly present as a solitary thyroid nodule. It can present with aerodigestive symptoms such as\u00a0dysphagia or hoarseness. Lymph node involvement may be seen in some cases.</p>\n<p><strong>Diagnosis -</strong> Elevated <strong>CEA</strong> and <strong>calcitonin</strong> are commonly seen. USG findings may reveal signs of malignancy such as microcalcifications and hypoechoic lesions.</p>\n<p>All new patients diagnosed with MTC should be screened for <strong>RET point mutations</strong>, <strong>pheochromocytoma</strong>, and <strong>hyperparathyroidism</strong>.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc0cbab9ea0c46a6866994419f1fd89f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the best position for a conscious patient to be in during the insertion of a Ryle's tube?",
    "choices": [
      {
        "id": 1,
        "text": "Supine with neck flexion"
      },
      {
        "id": 2,
        "text": "Supine with neck extension"
      },
      {
        "id": 3,
        "text": "Sitting with neck flexion"
      },
      {
        "id": 4,
        "text": "Sitting with neck extension"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The best position for a <strong>conscious patient</strong> to be in during the insertion of Ryle's tube<strong> (RT)</strong> is <strong>sitting with neck flexion</strong>. The described position helps in directing the RT towards the esophagus and also prevents it from coiling in the oropharynx or entering the trachea.</p>\n<p>RT, also known as nasogastric <strong>(NG) </strong>tube, measures <strong>120-125 cm</strong>. It has <strong>4 markings</strong> at 40cm (cardia), 50cm (body), 60cm (pylorus), and 70 cm (duodenum) to indicate the approximate position after the placement.</p>\n<p>Indications for NG tube:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Feeding in patients with dysphagia, decreased appetite, or those who are nil per os (NPO) for medical or surgical reasons.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aspiration of gastric fluid</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Gastric decompression in cases of intestinal obstruction and paralytic ileus.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Zollinger-Ellison syndrome&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Bowel irrigation</li>\n</ul>\n<p>The <strong>absolute</strong> <strong>contraindications</strong> for an NG tube are <strong>severe midface trauma</strong>, recent nasal surgery, and <strong>basilar skull </strong>fractures</p>\n<p>Steps for the correct insertion of RT in an adult:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Examination of the patient&rsquo;s nostril for any <strong>anatomical abnormalities</strong> and then instillation with 10 ml of 1% lignocaine&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>NEX method</strong> is used to <strong>measure the length of the RT</strong>: &nbsp;Place the exit port of the tube at the tip of the nose. Extend the tube to the earlobe, and then to the xiphisternum.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The patient is asked to sit <strong>upright with partial neck flexion</strong>. The tip of the Ryle&rsquo;s tube is lubricated and passed along the floor of the nasal passage until a resistance is felt(corresponds to nasopharynx)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The patient is subsequently asked to swallow water to guide the tube through the esophagus into the stomach until the <strong>marked length</strong> (based on the NEX method).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">NG tube is finally taped to secure it in place.</li>\n</ol>\n<p><br />Confirmation of the correct position is done by:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Auscultation</strong> in the <strong>epigastric</strong> <strong>area</strong> while injecting a bolus of air</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">X-ray chest to locate the lead markers</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aspiration of contents and subsequently confirming gastric origin (pH &lt;6 indicates gastric placement)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b29d419f2864e5ab70adf6c34335073x576x432.PNG"
    ]
  },
  {
    "text": "A 32-year-old man was scheduled for left frontal craniotomy and excision of a meningioma. After induction of anesthesia, a sudden brief dip in CO2 during the expiratory plateau phase on the capnograph was noticed. Which among the following are likely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Breath sounds in the epigastrium"
      },
      {
        "id": 2,
        "text": "History of chronic obstructive pulmonary disease"
      },
      {
        "id": 3,
        "text": "A dramatic increase in body temperature and muscle rigidity"
      },
      {
        "id": 4,
        "text": "Obvious inspiratory efforts by the patient"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A sudden brief dip in CO<sub>2</sub> during the expiratory plateau phase of the capnograph is known as the <strong>curare notch</strong>, seen in <strong>spontaneous breathing</strong> during mechanical ventilation. <strong>Obvious inspiratory efforts by the patient</strong> will be seen.</p>\n<p>The patient's inspiratory effort causes some fresh gas to be sucked into the capnometer, resulting in a lower carbon dioxide concentration and a notch.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e1c114c8d3145059de9ba8745716b75x1280x904.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d0e7285c1ee4957867ca2ec0f303ce4x1280x1075.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a291b853628e45a6a98971c6ed859715x1280x839.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4db7843f20974d969aac50abfa4a1dccx1280x908.JPEG"
    ]
  },
  {
    "text": "A 4-year-old boy presents with low-grade fever, inspiratory stridor, and barking cough for the past 5 days. Examination reveals a hoarse voice, a moderately inflamed pharynx, and a slightly increased respiratory rate. His chest X-ray showed subglottic narrowing appearing like a steeple. Which among the following is not indicated in the treatment of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Nebulized racemic epinephrine"
      },
      {
        "id": 2,
        "text": "Parenteral cefotaxime"
      },
      {
        "id": 3,
        "text": "Helium oxygen mixture"
      },
      {
        "id": 4,
        "text": "Intramuscular dexamethasone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of a child with a barking cough, inspiratory stridor, hoarseness, low-grade fever, and increased respiratory rate and an X-ray showing\u00a0subglottic narrowing appearing like a steeple is suggestive of\u00a0<strong>croup\u00a0(laryngotracheobronchitis).</strong>\u00a0Parenteral cefotaxime is not indicated in its treatment.</p>\n<p>The median age for\u00a0laryngotracheobronchitis is<strong>\u00a0</strong>3\u00a0months to 5 years. It is caused due to\u00a0<strong>viral infection of the glottic and subglottic regions</strong>. Patients present with\u00a0low-grade fever,\u00a0 barking cough,\u00a0hoarseness of voice, and inspiratory stridor.\u00a0</p>\n<p>The image below shows a <strong>steeple sign</strong>, seen in croup.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e8a72add9ca34693bcc04fc4c23553dex426x429.JPEG"
    ]
  },
  {
    "text": "A 40-year-old sexually active, otherwise healthy man presented with a 3-month history of painless ulcers in the pubic area and over the penis. He mentioned that they were initially nodules that progressed to red ulcerated lesions over the last 1 month. Physical examination revealed multiple beefy-red nontender, round ulcers of various sizes around the pubic area and on the penis. The base of the ulcers shows granulation tissue that bleeds on touch. Direct microscopy appears as shown in the image below. Identify the incorrect statement about the diagnosis of this condition.",
    "choices": [
      {
        "id": 1,
        "text": "Smears can be examined by direct microscopy with the Giemsa stain"
      },
      {
        "id": 2,
        "text": "Smears can be examined by direct microscopy with the Wright's stain"
      },
      {
        "id": 3,
        "text": "Granulation tissue crushed and spread between two slides can be used for microscopy."
      },
      {
        "id": 4,
        "text": "The organism cannot be cultured in vitro."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette described is <strong>Granuloma inguinale (donovanosis)</strong>. It is a chronic, progressive sexually transmitted infection caused by the bacterium <strong>Klebsiella granulomatis.&nbsp;</strong>Klebsiella granulomatis is difficult to culture but can be <strong>grown on egg yolk medium and on modified Levinthal's agar.</strong></p>\n<p>While collecting a sample for smear, the lesion should first be <strong>cleaned with a dry cotton swab</strong> to remove debris. Care should be taken not to disrupt any small blood vessels, to minimize bleeding. If donovanosis is suspected clinically, the swab should always be <strong>obtained before another testing</strong> to maximize tissue collections.</p>\n<p>Granulation tissue can be obtained by using either forceps or scalpel and then <strong>crushed between two slides</strong> as an alternative method to obtaining a smear.</p>\n<p>On direct microscopy, <strong>Donovan bodies</strong> are seen inside large, mononuclear cells (pund cells) as gram-negative intracytoplasmic cysts filled with deeply staining bodies. They can have a characteristic <strong>safety pin appearance</strong> due to bipolar staining of the chromatin material. When these cyst structures rupture, infectious organisms are released. The stains commonly used are<strong>&nbsp;the Giemsa stain and the Wright stain</strong>. Klebsiella granulomatis is difficult to culture but can be grown on <strong>egg yolk medium</strong> and on <strong>modified Levinthal's agar</strong>.</p>\n<p>Histopathological examination shows chronic inflammation with plasma cells and neutrophil infiltration. Epithelial changes like ulceration, microabscesses, and elongation of rete ridges are seen.</p>\n<p>The image below shows round, beefy-red ulcers with granulation tissue on the penis and pubic area - seen in granuloma inguinale.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bdcf01406aa24407bfc91701ec4ef2cf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c685f796d8014c70a39d7743dc963ca9x700x460.JPEG"
    ]
  },
  {
    "text": "A 16-year-old girl presents to the OPD with complaints that her periods have not started, but she has been experiencing lower abdominal pain every month. She also complains of difficulty in passing urine. On examination, she has normal female secondary sexual characteristics, a midline hypogastric lump in the abdomen, and a bluish bulging membrane at the introitus. Identify the incorrect statement(s) about the treatment of this condition.",
    "choices": [
      {
        "id": 1,
        "text": "1, 4 and 5"
      },
      {
        "id": 2,
        "text": "2, 3 and 5"
      },
      {
        "id": 3,
        "text": "3 and 4"
      },
      {
        "id": 4,
        "text": "1, 2 and 3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The condition described is <strong>imperforate hymen</strong> and the incorrect statements about the treatment of the condition are 3 and 4. <strong>Simple needle aspiration</strong> of the hematocolpos and evaluation of the uterus, cervix and/or the upper vagina are <strong>avoided</strong> as they may increase the risk of infection and perforation respectively.</p>\n<div class=\"page\" title=\"Page 442\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The<strong> hymen generally perforates during fetal life</strong>, creating a connection between the vaginal lumen and the perineum. Imperforate hymen is due to the failure of the inferior end of the vaginal plate to canalize. Endometrial blood collects leading to the formation of hematocolpos. Retrograde menstruation may lead to the development of endometriosis.</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Treatment:</strong></p>\n<p>A simple <strong>cruciate incision </strong>of the hymen made<strong>&nbsp;anteroposteriorly from 10-4 and 2-8 o&rsquo;clock positions&nbsp;</strong>allow the free drainage of the collected menstrual blood, leading to normal reproductive function. The hymeneal leaflets are sharply trimmed, but not excised too closely to the vaginal epithelium to prevent scarring.&nbsp;The vagina is then <strong>irrigated</strong> with a sterile saline solution. Cut edges are then <strong>sutured with interrupted stitches.</strong>&nbsp;&nbsp;A <strong>running interlocking suture line is avoided</strong> as it might lead to narrowing of the introitus.</p>\n<p>Laparoscopy is often performed to exclude endometriosis. However, <strong>intraoperative manipulation or evaluation</strong> of the upper vagina, cervix, or uterine cavity is avoided. This is to reduce the <strong>risk of perforation</strong>, as the hematocolpos might have significantly thinned the uterine walls.</p>\n<p><strong>Needle aspiration of a hematocolpos</strong> should be avoided because it may seed the retained blood with bacteria and increase infection risks. Moreover, the hematocolpos may recur as a <strong>result of inadequate drainage.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5f28562dbea491382a8ab1780fc90c2x1280x2300.JPEG"
    ]
  },
  {
    "text": "A 54-year-old woman presents to you with complaints of swollen fingers, heartburn, and occasional joint pains. On examination, the skin over her hands is shiny, taut, and thickened with non-pitting edema. Distal skin creases are absent. Movement of the hand is limited and there appears to be some muscle weakness. Autoantibody assays showed the presence of topoisomerase I antibodies and Anti-RNA polymerase III antibodies. Which among the following features are less commonly seen in this variant of the disease?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "1 and 4"
      },
      {
        "id": 3,
        "text": "2 and 4"
      },
      {
        "id": 4,
        "text": "1, 2, 4 and 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario with positive ANA antibodies, topoisomerase I antibodies, and Anti-RNA polymerase I and III antibodies is&nbsp;<strong>diffuse cutaneous systemic sclerosis. Esophageal involvement </strong>and <strong>ischemic ulcers on digits</strong>&nbsp;are <strong>less commonly seen</strong> <strong>in this variety</strong> of the disease.&nbsp;</p>\n<p>Systemic sclerosis is an autoimmune disorder of connective tissue resulting in fibrosis of the skin, internal organs, and vasculature. It is characterized by Raynaud&rsquo;s phenomenon, ischemia of the digits, sclerodactyly, and cardiac, lung, gut, and renal disease. The peak age of onset is between the fourth and fifth decades of life.</p>\n<p>It is divided into:</p>\n<ul>\n<li>Diffuse cutaneous systemic sclerosis (30% of cases) - poor prognosis</li>\n<li>Limited cutaneous systemic sclerosis (70% of cases)</li>\n</ul>\n<p>The antibodies tested in systemic sclerosis include:</p>\n<ul>\n<li><strong>Antinuclear antibody</strong> (ANA) - positive in most cases of systemic sclerosis. The absence of this antibody suggests considering an alternate diagnosis.</li>\n<li><strong>Antitopoisomerase I</strong> (anti-Scl-70) antibody - usually positive with <strong>diffuse</strong> cutaneous systemic sclerosis.</li>\n<li><strong>Anti-RNA polymerase I and III</strong> antibodies - usually positive with <strong>diffuse</strong> cutaneous systemic sclerosis.</li>\n<li><strong>Anti centromere</strong> antibody (ACA) - usually positive in <strong>limited</strong> cutaneous systemic sclerosis.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-week old baby diagnosed with biliary atresia was posted for Kasai's procedure. After the surgery, the child was well for a brief period, but the condition gradually deteriorated, progressing to a failure to thrive. To enter the waiting list for a hepatic transplant, the Paediatric End-stage Liver Disease (PELD) score is to be calculated. Which of the following investigations is not required for the calculation of this score?",
    "choices": [
      {
        "id": 1,
        "text": "Serum bilirubin"
      },
      {
        "id": 2,
        "text": "Serum albumin"
      },
      {
        "id": 3,
        "text": "INR"
      },
      {
        "id": 4,
        "text": "Serum creatinine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Serum creatinine</strong> is used in the <strong>Model for End-Stage Liver Disease (</strong><strong>MELD) scoring</strong>&nbsp;but is <strong>not required </strong>for<strong> Pediatric End-Stage Liver Disease (PELD) scoring</strong>. <strong>Biliary atresia</strong> is the <strong>most common indication</strong> for <strong>liver transplantation</strong> in the<strong> pediatric age</strong> group, followed by metabolic and inborn disorders, autoimmune and familial cholestatic disorders, and acute hepatic necrosis.<br /><br />The <strong>PELD</strong> model for children <strong>under 12 years</strong> of <strong>age</strong>, includes <strong>both clinical and biochemical factors</strong>. It is <strong>predictive</strong> of disease <strong>severity</strong> and waiting list <strong>mortality</strong> in pediatric patients. The PELD score is calculated using the following variables:</p>\n<ul>\n<li><strong>Albumin</strong> (g/dl)</li>\n<li><strong>Bilirubin </strong>(mg/dl)</li>\n<li><strong>INR</strong> (International normalized ratio)</li>\n<li><strong>Growth failure</strong> (based on gender, height, and weight)</li>\n<li><strong>Age at listing</strong></li>\n</ul>\n<p>The <strong>Child-Pugh score</strong> is a <strong>predictor</strong> of <strong>survival</strong> and complications of <strong>cirrhosis</strong>, such as bleeding from varices and spontaneous bacterial peritonitis. It was <strong>earlier used</strong> to provide standard criteria for listing a patient as a candidate for liver transplantation (Child-Pugh class B) but it has been <strong>replaced</strong> <strong>by</strong> the Model for End-Stage Liver Disease <strong>(MELD)</strong>&nbsp;and Pediatric End-Stage Liver Disease <strong>(PELD)</strong> models for all patients with chronic liver disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following three MR images of the head taken in the sagittal plane are given to you. Match the image to the MR imaging technique used.",
    "choices": [
      {
        "id": 1,
        "text": "1- T1 weighted, 2- T2 weighted, 3- FLAIR"
      },
      {
        "id": 2,
        "text": "1- T1 weighted, 2- FLAIR, 3- T2 weighted"
      },
      {
        "id": 3,
        "text": "1-T2 weighted, 2- T1 weighted, 3- STIR"
      },
      {
        "id": 4,
        "text": "1- STIR, 2- FLAIR, 3- T2 weighted"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Image 1 - T2 weighted MRI, image 2 - T1 weighted MRI, and image 3 is a STIR MRI.</p>\n<p>By altering the sequence of pulses and the scanning parameters, different properties of the tissue can be assessed. These properties are referred to as the weighting of the scan. T1-weighted images and T2-weighted images are two types of imaging sequences with differences in image contrast.</p>\n<p>T1 weighted images:</p>\n<ul>\n<li>Fluid appears dark\u00a0(blood, edema, CSF)</li>\n<li>Fat appears white</li>\n</ul>\n<p>T2 weighted images:</p>\n<ul>\n<li>Fluid appears white\u00a0</li>\n<li>Fat appears dark</li>\n</ul>\n<p>STIR- Short tau inversion recovery or\u00a0short TI inversion recovery</p>\n<div class=\"page\" title=\"Page 115\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Inversion recovery time is short and is used to null signal from fat.</li>\n<li>Fat appears dark</li>\n<li>Highly sensitive to detect musculoskeletal disease, degenerative changes, MS lesions, and vertebral metastasis</li>\n<li>More prone to motion artifacts. Therefore not used in the imaging of the thoracic spine</li>\n</ul>\n</div>\n</div>\n</div>\n<p>FLAIR\u00a0(fluid-attenuated inversion recovery):</p>\n<ul>\n<li>It is a T2 weighted sequence with a long inversion recovery time that suppresses signals from the fluid.</li>\n<li>Fluid appears dark</li>\n<li>Fat appears dark</li>\n<li>Motion artifacts in CSF are removed</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/add8a23dce6e4f25ba2afddb466d6298.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36ed0925aec64b07a2f7a0822cc04670x1280x5649.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7d7a010ce2be44599ecdaaac5e31dd6cx1014x1022.JPEG"
    ]
  },
  {
    "text": "A 2-year-old child is brought into the emergency room  after his elder sibling while playing with the child pulled up the child by holding the childs's hands. The child is now crying, does not use her arm, and does not let anybody touch it.  Which of the following statements are true regarding the underlying condition in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "1, 4, 5"
      },
      {
        "id": 2,
        "text": "1, 2, 5"
      },
      {
        "id": 3,
        "text": "1, 2, 4"
      },
      {
        "id": 4,
        "text": "2, 3, 4, 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The likely diagnosis is&nbsp;<strong>pulled elbow/ Nursemaid's elbow </strong>and&nbsp;<strong>radial head</strong>&nbsp;<strong>subluxations(RHS) </strong>is&nbsp;the cause here. The history of lifting the child by the forearm and later the child refusing to let anyone touch her hand is pointing towards the diagnosis of the pulled elbow.&nbsp;</p>\n<p>The following statements are true regarding pulled elbow</p>\n<p>1 - Occurs due to subluxation of the <strong>annular ligament over the radial head</strong>.<br />2 - Children commonly present with the&nbsp;<strong>elbow extended or slightly flexed</strong>(NOT fully flexed) and the&nbsp;<strong>forearm pronated</strong>(NOT supinated).<br />3 - X-ray is <strong>not</strong> necessary for diagnosis in all patients. Specific conditions where it is required are mentioned below.<br />4 - Reduction may be achieved through the <strong>hyperpronation technique</strong>.&nbsp;<br />5 - <strong>Forearm flexion and supination</strong> can be used to achieve a reduction.</p>\n<p>The mechanism underlying this deformity is the <strong>subluxation of the annular ligament</strong> over the <strong>radial head</strong>. Characteristically the child holds the elbow in <strong>slight flexion with the forearm pronated</strong>.</p>\n<p>Diagnosis is clinical and X-ray is needed only if there is confusion.<br />X-ray is required only in patients who do not have a history of a \"pull injury\" or who have equivocal physical examination findings, indications for plain radiographs include:</p>\n<p><strong>- &lt;5 years of age</strong>:</p>\n<ul>\n<li class=\"bulletIndent2\">Age &lt;6 months without a history of having the arm pulled or caught underneath the body when rolling over&nbsp;</li>\n<li class=\"bulletIndent2\">A concerning mechanism of injury (eg, direct blow or high-force injury)</li>\n<li class=\"bulletIndent2\">A physical examination that demonstrates swelling beyond the anterolateral aspect of the radial head</li>\n<li class=\"bulletIndent2\">Focal bony tenderness over the proximal ulna or distal humerus</li>\n<li class=\"bulletIndent2\">Any bony deformity</li>\n<li class=\"bulletIndent2\">Inability to successfully reduce a presumed RHS&nbsp;</li>\n</ul>\n<p>&nbsp;</p>\n<p class=\"bulletIndent1\"><strong>-</strong>&nbsp;<strong>&ge;5 years of age</strong>:</p>\n<ul>\n<li class=\"bulletIndent1\">RHS is uncommon at this age. Unless there is a classic mechanism of an arm pull and a physical examination consistent with the diagnosis, most children with pain and immobility of the arm warrant radiographs.</li>\n</ul>\n<p>Treatment is achieved with the <strong>hyperpronation</strong> technique or by <strong>f</strong><strong>orearm flexion and supination.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a9f7fe1cd69474aadbb23bcafbca182x1280x2472.4400564174894.JPEG"
    ]
  },
  {
    "text": "A 2-week old, healthy baby was brought with a rash on his trunk. It appeared as crops of small clear vesicles without any signs of inflammation, suggestive of miliaria crystallina. Identify the layer of skin in which the blockage of eccrine glands occurs.",
    "choices": [
      {
        "id": 1,
        "text": "Layer A"
      },
      {
        "id": 2,
        "text": "Layer B"
      },
      {
        "id": 3,
        "text": "Layer C"
      },
      {
        "id": 4,
        "text": "Layer D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>miliaria crystallina</strong>, the obstruction of the eccrine sweat duct occurs at the stratum corneum (layer A), and hence the resultant vesicle that <strong>contains clear fluid</strong> is\u00a0<strong>subcorneal in location.</strong></p>\n<p>Miliaria is a common acute or subacute skin condition that arises due to the\u00a0<strong>occlusion\u00a0</strong>or disruption of\u00a0<strong>eccrine sweat glands.\u00a0</strong>The three forms of miliaria - miliaria crystallina, miliaria rubra, and miliaria profunda\u00a0differ from each other due to the different levels at which occlusion occurs.</p>\n<p>The level of blockade/disruption in miliaria is:</p>\n<table style=\"height: 274px;\" width=\"226\">\n<tbody>\n<tr>\n<td style=\"width: 75px;\">Miliaria crystallina</td>\n<td style=\"width: 135px;\">Stratum corneum</td>\n</tr>\n<tr>\n<td style=\"width: 75px;\">Miliaria profunda</td>\n<td style=\"width: 135px;\">At or below Dermoepidermal junction</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p>The layers of the epidermis are shown in the image given below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/af6431938dd647a9a6af97464bd1dd6d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/08db1e4c4c8f4b599baffeccf609785bx820x1198.PNG"
    ]
  },
  {
    "text": "Which of the following strains of Chlamydia are implicated in causing trachoma?",
    "choices": [
      {
        "id": 1,
        "text": "Serotype L3"
      },
      {
        "id": 2,
        "text": "Serotype D - K"
      },
      {
        "id": 3,
        "text": "Serotype A, B, C"
      },
      {
        "id": 4,
        "text": "Serotype L1 - L2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>&nbsp;<strong>Serotypes A, B, and C</strong> are implicated in the development of <strong>trachoma</strong>, a form of <strong>chronic conjunctivitis</strong> caused by <strong><em>Chlamydia trachomatis</em>.</strong></p>\n<p>Trachoma is considered a major cause of blindness in the developing world. It is endemic in nature, mostly affecting children with a female preponderance. The four stages of trachoma according to&nbsp;<strong>McCallan</strong>&nbsp;are as follows:</p>\n<p><strong>Stage 1:</strong>&nbsp;<strong>Incipient&nbsp;</strong></p>\n<ul>\n<li>Immature follicles are present, but<strong>&nbsp;clinical symptoms are not obvious</strong>.</li>\n</ul>\n<p><strong>Stage 2:&nbsp;Established</strong></p>\n<ul>\n<li>Typical trachomatous lesions<strong>&nbsp;without scarring</strong></li>\n</ul>\n<p><strong>Stage 3:&nbsp;Cicatrizing</strong></p>\n<ul>\n<li><strong>Scarring&nbsp;</strong>along with<strong>&nbsp;active</strong>&nbsp;infection</li>\n</ul>\n<p><strong>Stage 4:</strong>&nbsp;<strong>Healed</strong></p>\n<ul>\n<li>Only scarring, the&nbsp;disease is<strong>&nbsp;either cured or quiet</strong>.</li>\n</ul>\n<p>Other Options:</p>\n<p>Options A and D - Serotypes L1-L3 are implicated in lymphogranuloma venereum.</p>\n<p>Option B - <strong>Serotypes D-K</strong> are implicated in the development of <strong>acute inclusion conjunctivitis</strong>, genital ulcers, and infantile pneumonia. Acute inclusion conjunctivitis presents with <strong>follicular and papillary hypertrophy</strong>, which is greater in the lower eyelid, and associated with <strong>moderately abundant exudate </strong>that is&nbsp;principally composed of neutrophils.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old girl presents with severe pain in the left iliac fossa. On palpation, a 4x4cm tender mass is felt. Laparotomy is performed and pathological examination reveals a cystic cavity filled with teeth, sebaceous material, cartilage, bone, and glandular tissue.  Which of the following statements are false about the mass?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "1,2 and 5"
      },
      {
        "id": 3,
        "text": "2, 4 and 5"
      },
      {
        "id": 4,
        "text": "3 and 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette suggests the tumor is a <strong>dermoid cyst</strong>, which had undergone torsion.\u00a0Statements 3 and 4 are incorrect.</p>\n<p>The <strong>lining</strong> of the dermoid cyst, while<strong> usually squamous</strong> epithelium, it can also be <strong>columnar or transitional</strong> epithelium. Though the cysts are usually unilocular with a smooth surface, they can also be <strong>multilocular</strong>.</p>\n<p><strong>Dermoid Cysts</strong></p>\n<ul>\n<li><strong>5-10%</strong> of all<strong> cystic ovarian</strong> tumors</li>\n<li><strong>Bilateral</strong> in 12-15% cases\u00a0</li>\n<li>Usually<strong> Unilocular</strong> with a smooth surface, but can also be multilocular</li>\n<li><strong>Mature</strong> teratoma\u00a0</li>\n<li>Contains tissue arising from <strong>all 3 germ layers</strong></li>\n<li>Teeth, bone, and hair arise from embryonic node\u00a0</li>\n<li><strong>Sebaceous material</strong> common\u00a0</li>\n<li>Wall usually squamous epithelium, can be formed by other epithelium too\u00a0</li>\n<li>About 40% of dermoid cysts are found in conjunction with <strong>mucinous cystadenomas</strong></li>\n<li>Can undergo<strong> torsion</strong> and present as <strong>acute abdomen</strong></li>\n<li><strong>Multiple dermoids</strong> can coexist in a single ovary\u00a0</li>\n<li>Can be <strong>e</strong><strong>xtra-ovarian</strong>- lumbar, parasacral, uterovesical pouch, rectovaginal septum</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/92e36f3f208e4fa4839d57e8b0089fc2x720x430.JPEG"
    ]
  },
  {
    "text": "A mother brought her 8-year-old son to the OPD with complaints of refusal to eat and poor weight gain. The child complained that food often gets stuck in his throat. Endoscopy revealed the following finding. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gastroesophageal reflux disease"
      },
      {
        "id": 2,
        "text": "Eosinophilic esophagitis"
      },
      {
        "id": 3,
        "text": "Achalasia cardia"
      },
      {
        "id": 4,
        "text": "Plummer-Vinson syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and image showing <strong>multiple stacked esophageal rings</strong> are characteristic of <strong>eosinophilic esophagitis.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://daily-rounds-staging.s3.amazonaws.com/uploads/ef764b2d194e4526b1a5922e9a01385f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs promotes bone formation?",
    "choices": [
      {
        "id": 1,
        "text": "Calcitonin"
      },
      {
        "id": 2,
        "text": "Raloxifene"
      },
      {
        "id": 3,
        "text": "Bisphosphonates"
      },
      {
        "id": 4,
        "text": "Teriparatide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Teriparatide <strong>increases bone formation</strong> especially when given in low doses and intermittently.<br />Teriparatide is a recombinant preparation of <strong>parathyroid hormone.</strong></p>\n<p>The pharmacologic activity of&nbsp;teriparatide,&nbsp;which is similar to the physiologic activity of PTH, includes stimulating osteoblast function, increasing gastrointestinal calcium absorption, and increasing renal tubular reabsorption of calcium.</p>\n<p>Although it may be more effective than bisphosphonates and estrogen, it has to be&nbsp;<strong>administered subcutaneously</strong>&nbsp;every day. Hence it is indicated mostly in severe osteoporosis.</p>\n<p><strong>Teriparatide</strong> increases the <strong>risk of osteosarcoma</strong> and it is contraindicated in conditions that cause high risk of osteosarcoma such as:</p>\n<ul>\n<li>Paget disease</li>\n<li>Prior h/o of radiotherapy</li>\n<li>Young adults with open epiphysis</li>\n<li>Unexplained elevated ALP</li>\n<li>Hypercalcemia</li>\n</ul>\n<p>Option A:&nbsp;<strong>Calcitonin</strong>&nbsp;decreases bone resorption.</p>\n<p>Option B:<strong>&nbsp;Raloxifene</strong> is a selective estrogen receptor modulator, which decreases bone resorption. It is used to prevent and treat osteoporosis in postmenopausal women.</p>\n<p>Option C:<strong>&nbsp;Bisphosphonates</strong> like alendronate and etidronate decrease bone resorption.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly woman presents to the doctor with a 3-month history of easy fatiguability while performing day-to-day activities. On examination, she has pallor. Her hemoglobin level is 10 g/dL. Her laboratory test reports are given below.  Which of the following is true regarding the nutrient deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Calcium increases its absorption"
      },
      {
        "id": 2,
        "text": "It is predominantly absorbed from the duodenum"
      },
      {
        "id": 3,
        "text": "Ascorbic acid decreases its absorption"
      },
      {
        "id": 4,
        "text": "Its uptake is mediated by divalent metal transporter type 2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an elderly woman presenting with <strong>easy fatiguability</strong> with pallor and laboratory features of <strong>decreased hemoglobin, serum iron, transferrin saturation, serum ferritin,</strong> and <strong>increased TIBC</strong> (total iron binding capacity), suggest <strong>iron-deficiency anemia.</strong> Iron\u00a0is predominantly absorbed from the <strong>duodenum.</strong></p>\n<p>Iron is mainly absorbed from the <strong>duodenum </strong>and<strong> proximal small intestine</strong>. The acidic contents of the stomach play a major role in its absorption. Once it reaches the brush border of the enterocyte, the ferric form is converted to the ferrous form by <strong>ferrireductase</strong>. This ferrous form is then transported into the cell by <strong>divalent metal transporter type 1 </strong>(DMT-1).</p>\n<p class=\"p1\">Once inside the\u00a0cell, iron may be <strong>stored</strong> as <strong>ferritin</strong> or transported\u00a0to plasma through\u00a0<strong>ferroportin</strong>. During the transport, iron is converted back into the ferric form by <strong>hephaestin.\u00a0</strong>The iron in plasma is transported to the required tissues by the protein <strong>transferrin.\u00a0</strong></p>\n<p class=\"p1\">Iron is a major content of<strong> hemoglobin, </strong>myoglobin, cytochrome P-450 group of enzymes, components of the electron transport chain, and ribonucleotide reductase.</p>\n<p>Iron is available in food in two forms, heme and nonheme. <strong>Heme iron</strong> is mainly present in <strong>red meat</strong> and is <strong>readily absorbed.\u00a0</strong>Several factors can increase or decrease iron absorption. <strong>Ascorbic acid increases</strong> iron absorption whereas, <strong>phytates</strong> (in bran, oats, rye fiber), <strong>polyphenols</strong> (in tea), <strong>calcium,</strong> and <strong>soy protein</strong> <strong>decrease</strong> its absorption.</p>\n<p>Therefore, a patient with anemia must be advised to consume red meat and oranges/lemons and to avoid coffee, tea, and calcium tablets while taking iron tablets.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/acda5fdbd5dd4d02a24ce182a3060cabx1279x1210.JPEG"
    ]
  },
  {
    "text": "A surgeon applies a very tight plaster cast on patient\u2019s leg and asks the patient to inform if he develops any numbness. The patient develops numbness but does not inform the doctor immediately. Next day, when the patient informs the doctor, the doctor says he is too busy to remove the cast. After a few days, the patient develops a permanent injury. The doctor is held guilty under:",
    "choices": [
      {
        "id": 1,
        "text": "Doctrine of comparative negligence"
      },
      {
        "id": 2,
        "text": "Last clear chance doctrine"
      },
      {
        "id": 3,
        "text": "Avoidable consequences rule"
      },
      {
        "id": 4,
        "text": "Medical maloccurrence"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This is a case of <strong>last clear chance doctrine</strong> and the <strong>doctor is held guilty</strong>.</p>\n<p>In this case:</p>\n<ul>\n<li>The doctor showed negligence by applying tight plaster cast, however, gave proper instructions to the patient.</li>\n<li>The patient has neglected by not informing the doctor immediately after he developed numbness.</li>\n<li>When the patient informed the doctor the next day, the doctor still had a chance to remove the cast and prevent permanent injury. But the doctor again neglected and thus missed the last clear chance.</li>\n</ul>\n<p>So, the doctor cannot plead for contributory negligence and will be held guilty under the last clear chance doctrine.</p>\n<p>Other options:</p>\n<p>Option D: <strong>Medical maloccurrence</strong> is a <strong>defence against negligence for doctors.</strong> In certain cases, despite proper medical skill, attention, and care, the patient may fail to respond or suffer from the adverse effects of drugs.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a primary health center, a nurse asks you about using a polio vaccine vial which has not crossed its expiry date. You look at the vaccine vial monitor (VVM) and tell her that it can be used. What did the VVM most likely show?",
    "choices": [
      {
        "id": 1,
        "text": "Inner square white, outer circle blue"
      },
      {
        "id": 2,
        "text": "Inner square blue, outer circle white"
      },
      {
        "id": 3,
        "text": "Outer square white, inner circle blue"
      },
      {
        "id": 4,
        "text": "Outer square blue, inner circle white"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The vaccine vial monitor has most likely showed <strong>inner square white and outer circle blue.</strong></p>\n<p>The standard polio vaccine vial monitor has a colour monitor or labels on the vaccine bottles. The label has an<strong> inner white square</strong> and an&nbsp;<strong>outer blue circle</strong>.</p>\n<p>It can be used if the <strong>inner square is lighter than the outer circle</strong>. When the colour of the inner square becomes that of the circle, it means that the vaccine has been exposed to a higher temperature and it cannot be used.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who is being evaluated for an abnormal gait was asked to stand on one leg. It was observed that his opposite side pelvis began to drop. Identify the point of insertion of the affected muscles in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The scenario describes the<strong> Trendelenburg sign</strong>. The muscles affected are the&nbsp;<strong>gluteus</strong> <strong>medius&nbsp;</strong>and&nbsp;<strong>gluteus</strong> <strong>minimus.&nbsp;</strong>They are attached to the <strong>greater trochanter</strong> which is labeled as <strong>1</strong> in the image.</p>\n<p><strong>Trendelenburg sign:</strong> This sign is demonstrated by asking the patient to stand on one limb. When the patient stands on the affected limb, the pelvis severely drops over the swing limb.</p>\n<p>Causes of positive Trendelenburg sign:</p>\n<ul>\n<li>Paralysis of the abductor muscles: Gluteus medius and gluteus minimus (injury, polio)</li>\n<li>Damage to the superior gluteal nerve</li>\n<li>Dislocation of the hip</li>\n<li>Destruction of the head of the femur</li>\n<li>Fracture neck of the femur</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/65835ce3f6654e14a4c72100d659b4ab.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2cb7a5a51ea5422e96254c000492acf5x1280x4280.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67066fb092614d779d80ccbb651c9db2x1280x2213.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7469ea311fbb4dfea134ad41d53856bfx800x600.JPEG"
    ]
  }
];
        let quizName = 'Neet Mini - 3 (20 Q)';
        const quizFilename = 'neet-mini-3-20-q-65e5a3c5.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>