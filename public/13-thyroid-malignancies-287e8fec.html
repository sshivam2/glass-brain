<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13 Thyroid Malignancies - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the first investigation you would advise to a patient with a large thyroid swelling?",
    "choices": [
      {
        "id": 1,
        "text": "Ultrasound of the neck"
      },
      {
        "id": 2,
        "text": "FNAC"
      },
      {
        "id": 3,
        "text": "Biochemical function of the thyroid"
      },
      {
        "id": 4,
        "text": "Radioiodine uptake"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Assessing the <strong>biochemical function of the thyroid</strong> i.e. thyroid function test <strong>(TFT)</strong> is the first investigation done in any thyroid condition.</p>\n<p>Assessment of TSH, T3, and T4 is done. However,&nbsp;<strong>TSH</strong> is most helpful in determining the management plan, especially in patients with thyroid nodules who clinically appear to be euthyroid.</p>\n<p>Modalities for evaluation of thyroid swelling include:</p>\n<ul>\n<li>Laboratory evaluation\n<ul>\n<li><strong>TSH</strong></li>\n<li>T3</li>\n<li>T4&nbsp;</li>\n</ul>\n</li>\n<li>Thyroid imaging\n<ul>\n<li><strong>Ultrasound</strong></li>\n<li>Radioisotope scanning</li>\n<li>CT/MRI</li>\n</ul>\n</li>\n<li>Biopsy techniques\n<ul>\n<li><strong>Fine needle aspiration biopsy (FNAB)</strong></li>\n<li>Tru-cut/core-needle biopsy</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a 2.5 cm neck swelling which is firm, non-tender, and moves on swallowing. TSH, T3, and T4 levels are normal. An ultrasound reports the swelling to be cystic and regular with low suspicion for malignancy. What is the next step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Perform an fine needle aspiration biopsy"
      },
      {
        "id": 2,
        "text": "Perform a Radioiodine uptake test"
      },
      {
        "id": 3,
        "text": "Prepare for resection of nodule"
      },
      {
        "id": 4,
        "text": "Reassure the patient and monitor periodically"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Fine needle aspiration (FNA) biopsy</strong>&nbsp;needs to be performed for further evaluation of the nodule.</p>\n<p>In cases where the FNAC is inconclusive, tru-cut or open biopsy can be done. However, this is rarely required.</p>\n<p>FNAC reporting systems are given as:&nbsp;</p>\n<table style=\"height: 407px;\" width=\"483\">\n<tbody>\n<tr>\n<td style=\"width: 32.9844px;\"><strong>Royal College of Pathologists, UK classification</strong></td>\n<td style=\"width: 32.9844px;\"><strong>Bethesda Criteria &nbsp;</strong></td>\n<td style=\"width: 253.25px;\"><strong>&nbsp;Description</strong></td>\n<td style=\"width: 174.766px;\"><strong>Usual Management</strong></td>\n</tr>\n<tr>\n<td style=\"width: 32.9844px;\">\n<p>Thy 1</p>\n<p>Thy 1c</p>\n</td>\n<td style=\"width: 32.9844px;\">I</td>\n<td style=\"width: 253.25px;\">Nondiagnostic or unsatisfactory</td>\n<td style=\"width: 174.766px;\">Repeat FNA with image guidance</td>\n</tr>\n<tr>\n<td style=\"width: 32.9844px;\">&nbsp;Thy 2</td>\n<td style=\"width: 32.9844px;\">II</td>\n<td style=\"width: 253.25px;\">Benign</td>\n<td style=\"width: 174.766px;\">Clinical follow-up</td>\n</tr>\n<tr>\n<td style=\"width: 32.9844px;\" rowspan=\"2\">&nbsp;&nbsp;Thy 3</td>\n<td style=\"width: 32.9844px;\">III</td>\n<td style=\"width: 253.25px;\">Atypia of undetermined significance/follicular lesion of undetermined significance</td>\n<td style=\"width: 174.766px;\">Repeat FNA or lobectomy</td>\n</tr>\n<tr>\n<td style=\"width: 32.9844px;\">IV</td>\n<td style=\"width: 253.25px;\">Follicular neoplasm or suspicious for follicular neoplasm&nbsp;</td>\n<td style=\"width: 174.766px;\">Lobectomy</td>\n</tr>\n<tr>\n<td style=\"width: 32.9844px;\">&nbsp;Thy 4</td>\n<td style=\"width: 32.9844px;\">V</td>\n<td style=\"width: 253.25px;\">Suspicious for malignancy&nbsp;</td>\n<td style=\"width: 174.766px;\">Lobectomy or total thyroidectomy</td>\n</tr>\n<tr>\n<td style=\"width: 32.9844px;\">&nbsp;Thy 5</td>\n<td style=\"width: 32.9844px;\">VI</td>\n<td style=\"width: 253.25px;\">Malignant&nbsp;</td>\n<td style=\"width: 174.766px;\">Total thyroidectomy</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2fd90ad0b05e4d0583451a82a8af1330x1280x2317.JPEG"
    ]
  },
  {
    "text": "FNAC is useful in all types of thyroid cancers except _____",
    "choices": [
      {
        "id": 1,
        "text": "Medullary"
      },
      {
        "id": 2,
        "text": "Papillary"
      },
      {
        "id": 3,
        "text": "Follicular"
      },
      {
        "id": 4,
        "text": "Anaplastic"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>FNAC</strong> is not useful in the diagnosis of follicular carcinoma of thyroid as it <strong>cannot differentiate </strong>between<strong> benign </strong>and<strong> malignant</strong> follicular lesion.<strong> Trucut biopsy</strong> is used to differentiate between them as follicular thyroid malignancy is defined by<strong> capsular</strong> and <strong>vascular invasion</strong>.&nbsp;</p>\n<p><strong>Limitations </strong>of<strong> FNAC </strong>in thyroid disorders:</p>\n<ul>\n<li>Cannot distinguish between&nbsp;follicular carcinoma and adenoma</li>\n<li>Cannot distinguish between Hurthle cell carcinoma and adenoma</li>\n<li>Not useful in Reidel&rsquo;s thyroiditis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following carcinomas of the thyroid arise from the marked cells?",
    "choices": [
      {
        "id": 1,
        "text": "1,4,5"
      },
      {
        "id": 2,
        "text": "2,3"
      },
      {
        "id": 3,
        "text": "2,3,4"
      },
      {
        "id": 4,
        "text": "1,2,3,4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Classification of thyroid neoplasms:</p>\n<ul>\n<li><strong>Benign -\u00a0</strong>Follicular adenoma</li>\n<li><strong>Malignant</strong>\n<table style=\"height: 232px; width: 399px;\">\n<tbody>\n<tr>\n<td style=\"width: 88px;\">\u00a0</td>\n<td style=\"width: 145px;\"><strong>Origin</strong></td>\n<td style=\"width: 150px;\"><strong>Type</strong></td>\n</tr>\n<tr>\n<td style=\"width: 88px; background-color: #ffffff;\" rowspan=\"4\"><strong>Primary</strong></td>\n<td style=\"width: 145px; background-color: #ffffff;\" rowspan=\"2\">Follicular epithelium</td>\n<td style=\"width: 150px;\">Differentiated\n<ul>\n<li style=\"font-weight: 400;\">Papillary</li>\n<li style=\"font-weight: 400;\">Follicular</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 150px;\">Poorly-differentiated\n<ul>\n<li style=\"font-weight: 400;\">Anaplastic</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 145px;\">Parafollicular cells</td>\n<td style=\"width: 150px;\">Medullary</td>\n</tr>\n<tr>\n<td style=\"width: 145px;\">Lymphoid cells</td>\n<td style=\"width: 150px;\">Lymphoma</td>\n</tr>\n<tr>\n<td style=\"width: 88px;\" rowspan=\"2\"><strong>Secondary</strong></td>\n<td style=\"width: 145px;\">Metastatic</td>\n<td style=\"width: 150px;\">\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 145px;\">Local infiltration</td>\n<td style=\"width: 150px;\">\u00a0</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8d9b25e82c904b83b7c791defa36b868.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f6bbb6dc72a43058b6d35b301fa9ba5x562x470.JPEG"
    ]
  },
  {
    "text": "What is the most common thyroid malignancy in iodine-deficient regions?",
    "choices": [
      {
        "id": 1,
        "text": "Papillary"
      },
      {
        "id": 2,
        "text": "Anaplastic"
      },
      {
        "id": 3,
        "text": "Follicular"
      },
      {
        "id": 4,
        "text": "Medullary"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Follicular thyroid carcinoma </strong>is the most common<strong>&nbsp;</strong>thyroid malignancy in<strong> iodine-deficient areas.</strong></p>\n<p><strong>Papillary thyroid carcinoma</strong> is the most common thyroid malignancy in <strong>iodine-sufficient areas</strong>, children, and radiation-exposed&nbsp;areas.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old man with a Thy3 lesion on FNAC was posted for hemithyroidectomy. Histopathology of the frozen section is given below. What is the next step of management?",
    "choices": [
      {
        "id": 1,
        "text": "No further procedure is required"
      },
      {
        "id": 2,
        "text": "Perform a total thyroidectomy"
      },
      {
        "id": 3,
        "text": "Perform RAI ablation"
      },
      {
        "id": 4,
        "text": "Perform central neck dissection"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Capsular</strong><strong>&nbsp;invasion </strong>as seen in the image<strong>&nbsp;</strong>confirms the presence of <strong>follicular carcinoma</strong>. Hence, <strong>total thyroidectomy</strong> is the recommended management.</p>\n<p>As FNAC shows Thy3 lesion which is a follicular neoplasm, the <strong>frozen section</strong> of the excised specimen has to be evaluated. The presence of <strong>capsular</strong> or <strong>vascular invasion </strong>confirms the presence of <strong>follicular carcinoma.</strong></p>\n<p><strong>Surgical management</strong> of differentiated thyroid cancers (DTCs) is as follows:</p>\n<table style=\"width: 534px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; width: 308px; height: 18px;\"><strong>Extent of cancer</strong></td>\n<td style=\"text-align: center; width: 216px; height: 18px;\"><strong>Surgery done</strong></td>\n</tr>\n<tr style=\"height: 168px;\">\n<td style=\"width: 308px; height: 168px;\">\n<p>Low-risk DTC <br />(Fulfilling all 5 of the following conditions)</p>\n<ol>\n<li>&lt; 40 years (better prognosis)</li>\n<li>Unifocal lesion</li>\n<li>Size &lt; 2 cm</li>\n<li>No lymphovascular invasion</li>\n<li>No capsular invasion</li>\n</ol>\n</td>\n<td style=\"width: 216px; height: 168px;\">Hemithyroidectomy</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 308px; height: 64px;\">\n<p><strong>High-risk DTC without LN involvement </strong><br /><strong>(not fulfilling any of the above 5 conditions)</strong></p>\n</td>\n<td style=\"width: 216px; height: 64px;\"><strong>Total thyroidectomy</strong></td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 308px; height: 34px;\">\n<p>High-risk DTC + level VI LN involved</p>\n</td>\n<td style=\"width: 216px; height: 34px;\">Total thyroidectomy + Central neck dissection</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 308px; height: 54px;\">\n<p>High-risk DTC + other cervical LNs involved</p>\n</td>\n<td style=\"width: 216px; height: 54px;\">Total thyroidectomy + Modified radical neck dissection</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c3aedbd5554f460b997db5f91dbff7be.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "All of the following statements are true about follicular thyroid carcinoma except:",
    "choices": [
      {
        "id": 1,
        "text": "Thyroglobulin levels can be used to monitor patients for recurrence"
      },
      {
        "id": 2,
        "text": "Hematogenous spread is more common than lymphatic spread"
      },
      {
        "id": 3,
        "text": "Osteoblastic bone metastasis is seen"
      },
      {
        "id": 4,
        "text": "Mortality rate is twice that of papillary thyroid carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Osteolytic bone metastasis</strong> is seen in follicular thyroid carcinoma and not osteoblastic lesions.</p>\n<p>Thyroglobulin trends may be used to monitor patients with differentiated thyroid cancer for a recurrence. Following <strong>total</strong> <strong>thyroidectomy</strong>, <strong>thyroglobulin</strong> levels must be <strong>undetectable</strong>.</p>\n<p>All thyroid carcinoma, except medullary thyroid carcinoma, have osteolytic bony metastasis. <strong>Medullary</strong> thyroid cancer has <strong>osteoblastic</strong> bony metastasis.</p>\n<p>Differentiated thyroid carcinomas (papillary &amp; follicular):</p>\n<table>\n<tbody>\n<tr>\n<td>&nbsp;</td>\n<td style=\"text-align: center;\"><strong>Papillary carcinoma</strong></td>\n<td style=\"text-align: center;\"><strong>Follicular carcinoma</strong></td>\n</tr>\n<tr>\n<td>Incidence</td>\n<td>Most common</td>\n<td>2nd most common</td>\n</tr>\n<tr>\n<td>Past history</td>\n<td>Radiation exposure</td>\n<td>Long-standing goitre</td>\n</tr>\n<tr>\n<td>Risk factor</td>\n<td><strong>Iodine-sufficient</strong> areas</td>\n<td><strong>Iodine-deficient</strong> areas</td>\n</tr>\n<tr>\n<td>Metastatic spread via</td>\n<td><strong>Lymphatics</strong> &gt; Hematogenous</td>\n<td><strong>Hematogenous</strong> &gt; Lymphatics</td>\n</tr>\n<tr>\n<td>Diagnosis by FNAC</td>\n<td>Useful</td>\n<td>Not useful</td>\n</tr>\n<tr>\n<td>Prognosis</td>\n<td>More favourable</td>\n<td>Less favourable</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a unilateral thyroid mass was diagnosed to have follicular thyroid carcinoma with involvement of level VI cervical lymph nodes. What is the appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Hemithyroidectomy with radioactive iodine ablation"
      },
      {
        "id": 2,
        "text": "Hemithyroidectomy with lateral neck dissection"
      },
      {
        "id": 3,
        "text": "Total thyroidectomy  with modified radical neck dissection"
      },
      {
        "id": 4,
        "text": "Total thyroidectomy with central neck dissection"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Surgical management of differentiated thyroid cancers (DTCs) is as follows:</p>\n<table style=\"width: 534px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; width: 308px; height: 18px;\"><strong>Extent of cancer</strong></td>\n<td style=\"text-align: center; width: 216px; height: 18px;\"><strong>Surgery done</strong></td>\n</tr>\n<tr style=\"height: 168px;\">\n<td style=\"width: 308px; height: 168px;\">\n<p>Low-risk DTC <br />(Fulfilling all 5 of the following conditions)</p>\n<ol>\n<li>&lt; 40 years (better prognosis)</li>\n<li>Unifocal lesion</li>\n<li>Size &lt; 2 cm</li>\n<li>No lymphovascular invasion</li>\n<li>No capsular invasion</li>\n</ol>\n</td>\n<td style=\"width: 216px; height: 168px;\">Hemithyroidectomy</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 308px; height: 64px;\">\n<p>High- risk DTC without LN involvement <br />(not fulfilling all of the above 5 conditions)</p>\n</td>\n<td style=\"width: 216px; height: 64px;\">Total thyroidectomy</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 308px; height: 34px;\">\n<p><strong>High-risk DTC + level VI LN involved</strong></p>\n</td>\n<td style=\"width: 216px; height: 34px;\"><strong>Total thyroidectomy + Central neck dissection</strong></td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 308px; height: 54px;\">\n<p>High-risk DTC + other LNs involved</p>\n</td>\n<td style=\"width: 216px; height: 54px;\">Total thyroidectomy + Modified radical neck dissection</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/508b7824cf3944adae5daf9bd4e95ba4x600x666.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/428682db32154b1c89456a7364131161x1280x1826.JPEG"
    ]
  },
  {
    "text": "A patient presented with a thyroid nodule. The USG showed an irregular hypoechoic mass with microcalcifications. Lymph nodes were not involved. FNAC showed a follicular neoplasm with predominantly Hurthle cells. Intra-op frozen section confirms capsular invasion. What is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Total thyroidectomy central neck dissection"
      },
      {
        "id": 2,
        "text": "Total thyroidectomy"
      },
      {
        "id": 3,
        "text": "Hemithyroidectomy"
      },
      {
        "id": 4,
        "text": "Hemithyroidectomy with radioiodine ablation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>As compared to follicular thyroid cancer, it has a <strong>poorer prognosis</strong> as it is more likely to <strong>metastasize</strong>. It is often bilateral and multifocal. The histological&nbsp;picture consists of <strong>predominantly oxyphil</strong> (Hurthle, Askanazy) cells containing abundant mitochondria. It cannot be diagnosed solely by FNAC as these cancers are characterized by vascular &amp; capsular invasion.</p>\n<p>Surgical management of Hurthle cell carcinoma:</p>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Extent of cancer</strong></td>\n<td style=\"text-align: center;\"><strong>Surgery done</strong></td>\n</tr>\n<tr>\n<td>Unilateral Hurthle cell adenoma</td>\n<td>Hemithyroidectomy</td>\n</tr>\n<tr>\n<td>Bilateral involvement without level VI LNs involvement</td>\n<td>Total thyroidectomy + &nbsp;<strong>Central neck dissection (prophylactic)</strong></td>\n</tr>\n<tr>\n<td>Hurthle cell carcinoma with level VI LNs involved</td>\n<td>Total thyroidectomy +&nbsp; Central neck dissection (therapeutic)</td>\n</tr>\n<tr>\n<td>Hurthle cell carcinoma with other LNs involved</td>\n<td>Total thyroidectomy + Modified radical neck dissection&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d247de175eeb41ba8a811455b533118dx1280x1168.JPEG"
    ]
  },
  {
    "text": "A 32-year-old woman came to the surgeon with a thyroid swelling that had developed a year ago. On examination, the swelling was 3 cm in size, firm and immobile. Further, lymphadenopathy was present. A biopsy of the swelling is given below. Which of the following is incorrect regarding management and post-op care in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Calcium supplementation is given post-operatively"
      },
      {
        "id": 2,
        "text": "Prophylactic neck dissection is done"
      },
      {
        "id": 3,
        "text": "Thyroxine is withheld after the surgery"
      },
      {
        "id": 4,
        "text": "Hemithyroidectomy is performed"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given histological image depicts papillary formation with a fibrovascular stalk, characteristic <strong>orphan annie eye nuclei </strong>and <strong>psammoma bodies</strong>, diagnostic of <strong>papillary carcinoma</strong> of the thyroid.<br /><strong>Total thyroidectomy</strong> with <strong>central neck dissection</strong> would be the appropriate management in this condition, because there is <strong>lymphadenopathy, </strong>although the tumour size is less than 4 cm.</p>\n<p>Surgical management of differentiated thyroid cancers (DTCs) is as follows:</p>\n<table style=\"width: 534px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; width: 308px; height: 18px;\"><strong>Extent of cancer</strong></td>\n<td style=\"text-align: center; width: 216px; height: 18px;\"><strong>Surgery done</strong></td>\n</tr>\n<tr style=\"height: 168px;\">\n<td style=\"width: 308px; height: 168px;\">\n<p>Low-risk DTC <br />(Fulfilling all 5 of the following conditions)</p>\n<ol>\n<li>&lt; 40 years (better prognosis)</li>\n<li>Unifocal lesion</li>\n<li><strong>Size ~ 1-4 cm</strong></li>\n<li>No lymphovascular invasion</li>\n<li>No capsular invasion</li>\n</ol>\n</td>\n<td style=\"width: 216px; height: 168px;\">Hemithyroidectomy</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 308px; height: 64px;\">\n<p><strong>High-risk DTC without LN involvement / </strong><strong>not fulfilling any of the above 5 conditions</strong></p>\n</td>\n<td style=\"width: 216px; height: 64px;\"><strong>Total thyroidectomy</strong></td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 308px; height: 34px;\">\n<p>High-risk DTC + level VI LN involved</p>\n</td>\n<td style=\"width: 216px; height: 34px;\">Total thyroidectomy + Central neck dissection</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 308px; height: 54px;\">\n<p>High-risk DTC + other LNs involved</p>\n</td>\n<td style=\"width: 216px; height: 54px;\">Total thyroidectomy + Modified radical neck dissection</td>\n</tr>\n</tbody>\n</table>\n<div class=\"page\" title=\"Page 2\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>\u00a0</p>\n<p>The other options:<br />Option 1: Post thyroidectomy, calcium supplementation is given to all patients to prevent hypocalcemia.<br />Option 2: Prophylactic neck dissection is done for papillary carcinoma thyroid<br />Option 3: Thyroid hormone replacement is not given to patients who are to receive radioactive iodine therapy within 2 to 3 weeks of surgery. The absence of thyroid hormones raises the TSH, which stimulates the radioactive iodine uptake.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6cad839cfa8e4cedbbb7ba264d3f93d1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87b3c0031f2141df88d7aacc4b980d21x1279x1159.JPEG"
    ]
  },
  {
    "text": "Which of the following describes lateral aberrant thyroid?",
    "choices": [
      {
        "id": 1,
        "text": "Defective development of the fourth pharyngeal pouch"
      },
      {
        "id": 2,
        "text": "Metastatic thyroid cancer in lymph nodes"
      },
      {
        "id": 3,
        "text": "Hyperplastic growth of thyroid tissue"
      },
      {
        "id": 4,
        "text": "Cystic swelling of the thyroglossal duct"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lateral aberrant thyroid</strong> almost always represents <strong>metastatic thyroid cancer </strong>in <strong>lymph nodes</strong>.</p>\n<p>Thyroid tissue situated lateral to the carotid sheath and jugular vein found along the course of the thyroglossal duct was previously termed lateral aberrant thyroid. It is associated with <strong>papillary thyroid cancer</strong> in the ipsilateral thyroid lobe.</p>\n<p>The image given below shows the lateral aberrant thyroid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f7f55e4cbb64e69bf731a6eaf368107x720x503.PNG"
    ]
  },
  {
    "text": "Which type of thyroid cancer has the best prognosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medullary carcinoma"
      },
      {
        "id": 2,
        "text": "Follicular carcinoma"
      },
      {
        "id": 3,
        "text": "Papillary carcinoma"
      },
      {
        "id": 4,
        "text": "Hurthle cell carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Patients with papillary thyroid carcinoma have an <strong>excellent prognosis</strong> with a &gt;95% 10-year survival rate.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man came to the surgery OPD with a midline neck swelling. He does not have any other complaints. The patient had received chemoradiation for Hodgkin\u2019s lymphoma nearly 20 years ago. On palpation, the mass is about 3 cm in size, non-tender, hard, fixed, and seems to arise from the right lobe of the thyroid. TSH levels were raised. A radioiodine uptake study showed cold nodule. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anaplastic thyroid cancer"
      },
      {
        "id": 2,
        "text": "Thyroid lymphoma"
      },
      {
        "id": 3,
        "text": "Papillary thyroid cancer"
      },
      {
        "id": 4,
        "text": "Medullary thyroid cancer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The history of radiation therapy to the head and neck for Hodkin's lymphoma and a cold nodule on radioiodine uptake scan are suggestive of&nbsp;<strong>papillary thyroid cancer.</strong></p>\n<p><strong>Radiation exposure</strong>&nbsp;is an identifiable aetiological factor in the development of differentiated thyroid cancer (follicular and papillary thyroid cancer). The most important factor, however, is <strong>irradiation of the thyroid before 5 years of age. </strong></p>\n<p><strong>Thyroid lymphomas</strong>&nbsp;are non-Hodgkin&rsquo;s B-cell lymphomas. They present with&nbsp;B-symptoms like fever, night sweats, and weight loss in addition to neck swelling. Thus, thyroid lymphoma is an unlikely diagnosis. Thyroid lymphomas&nbsp;often develop in the setting of lymphocytic infiltration.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old patient presents with diffuse enlargement of the thyroid gland. Laboratory studies reveal low T3, T4, high TSH and the presence of anti-TPO antibodies. FNAC from the gland shows enlarged cells with abundant eosinophilic cytoplasm. Which of the following malignancies is commonly associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Follicular carcinoma"
      },
      {
        "id": 2,
        "text": "Anaplastic carcinoma"
      },
      {
        "id": 3,
        "text": "Thyroid lymphoma"
      },
      {
        "id": 4,
        "text": "Hurthle cell carcinoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical case scenario is suggestive of <strong>Hashimoto's thyroiditis</strong>. <strong>Thyroid lymphoma</strong>\u00a0or malignant lymphoma is associated with long-standing Hashimoto\u2019s thyroiditis.</p>\n<p>Thyroid lymphomas are usually\u00a0<strong>non-Hodgkin\u2019s</strong> lymphomas,\u00a0often associated with long-standing <strong>Hashimoto\u2019s thyroiditis</strong>\u00a0(autoimmune lymphocytic thyroiditis).</p>\n<p>The clinical features include: <strong>B - symptoms</strong> i.e. fever, night sweats, and weight loss</p>\n<p>As FNAC cannot characterize lymphoma, Tru-Cut biopsy is preferred. Chemotherapy and radiation therapy are often sufficient. Total thyroidectomy is indicated only in residual/recurrent disease.</p>\n<p>A chemotherapy regimen <strong>(RCHOP)</strong> is the first line of management.<br /><strong>R</strong> - Rituximab<br /><strong>C</strong> - Cyclophosphamide<br /><strong>H</strong> - Hydroxydaunorubicin (Adriamycin)<br /><strong>O</strong> - Oncovin (Vincristine)<br /><strong>P</strong> - Prednisolone</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 72-year-old woman has a history of papillary thyroid carcinoma left untreated for 2 years. She complains that the rapid enlargement in her neck swelling over the last month has made it difficult for her to swallow and talk. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Local invasion of the surrounding structures"
      },
      {
        "id": 2,
        "text": "Progression to Hurthle cell carcinoma"
      },
      {
        "id": 3,
        "text": "Conversion to follicular thyroid cancer"
      },
      {
        "id": 4,
        "text": "Anaplastic thyroid cancer"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>An <strong>elderly woman</strong> with <strong>rapidly enlarging</strong> neck mass and <strong>dysphagia</strong> in the setting of an <strong>untreated papillary carcinoma</strong> suggests a diagnosis of <strong>anaplastic thyroid cancer</strong>.</p>\n<p>Anaplastic thyroid cancer, a <strong>poorly differentiated</strong>&nbsp;thyroid carcinoma, is the <strong>most aggressive cancer</strong> and has the <strong>worst prognosis</strong>&nbsp;of all thyroid malignancies.&nbsp;</p>\n<p>It usually occurs in&nbsp;<strong>elderly females.</strong> The typical manifestation is an with <strong>rapidly enlarging</strong> neck mass, dysphagia, and cervical tenderness. Patients usually have a history of untreated <strong>differentiated thyroid carcinoma (DTC).&nbsp;</strong>Local invasion to the recurrent laryngeal nerve <strong>(RLN)</strong> causes hoarseness. It may also cause tracheal obstruction.&nbsp;<strong>Distant metastasis</strong> is more common in the&nbsp;<strong>lungs</strong> via the hematogenous route.</p>\n<p>Diagnosis is made by <strong>FNAC.</strong> However, trucut/open biopsy is frequently used to confirm the diagnosis in cases of doubt.<strong><br /></strong></p>\n<p>Management:</p>\n<ul>\n<li>If <strong>metastasis is absent:</strong> Total thyroidectomy + LN dissection</li>\n<li>If <strong>metastasis is present:</strong> Palliative care with chemotherapy and radiotherapy</li>\n<li>If <strong>tracheal obstruction:</strong> Isthmectomy to relieve obstruction</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old woman was brought in a dehydrated state and complains of loose stools. On examination, a tender neck swelling was found which was found to be present for 1 year. Histopathology of the swelling shows the following finding. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medullary thyroid carcinoma"
      },
      {
        "id": 2,
        "text": "Systemic amyloidosis"
      },
      {
        "id": 3,
        "text": "Thyroid lymphoma"
      },
      {
        "id": 4,
        "text": "Papillary thyroid carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario<strong>&nbsp;</strong>is suggestive of <strong>medullary thyroid carcinoma </strong>(MTC).&nbsp;Histopathology shows the presence of amyloid deposits that are derived from the altered calcitonin molecules.</p>\n<p>Medullary thyroid carcinoma is a tumor of <strong>parafollicular or C cells</strong>&nbsp;of the thyroid gland. They are derived from the neural crest cells of the&nbsp;<strong>ultimobranchial bodies</strong>.&nbsp;</p>\n<p>Most of the MTCs occur sporadically. However, around a quarter of the cancers are associated with familial MTC, MEN2A, and MEN2B.</p>\n<p>Patients with sporadic MTC present at an older age, whereas patients with familial MTC usually present at a younger age.&nbsp;Features of MTC include:</p>\n<ul>\n<li>Painful neck mass with cervical lymphadenopathy</li>\n<li>Dysphagia, dysphonia or dyspnea if locally invaded</li>\n<li><strong>Diarrhoea</strong>&nbsp;due to increased intestinal motility by serotonin</li>\n<li><strong>Cushingoid habitus</strong>&nbsp;due to ectopic ACTH production</li>\n<li>Metastasis is&nbsp;<strong>blood-borne</strong></li>\n<li>Microscopically, they consist of sheets of neoplastic cells separated by collagen and&nbsp;<strong>amyloid stroma</strong></li>\n</ul>\n<p>It is diagnosed by careful family history, physical examination,&nbsp;<strong>raised calcitonin, CEA levels</strong>, and fine-needle aspiration biopsy of the mass.</p>\n<p><strong>Total thyroidectomy</strong>&nbsp;with&nbsp;<strong>central neck node dissection</strong>&nbsp;is the treatment of choice in MTC patients. External beam radiotherapy can be used in patients with unresectable tumors. Targeted therapy can be considered using vandetanib, sorafenib, sunitinib, and cabozantinib.</p>\n<p><strong>Prophylactic total thyroidectomy</strong>&nbsp;should be considered within&nbsp;<strong>5years</strong>&nbsp;of age in<strong>&nbsp;MEN2A</strong>&nbsp;mutation and within&nbsp;<strong>1year</strong>&nbsp;of age in&nbsp;<strong>MEN2B</strong>&nbsp;mutation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/39a84c606e19450086350fdba90d72c7.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the substances secreted by medullary thyroid carcinoma:",
    "choices": [
      {
        "id": 1,
        "text": "1,2"
      },
      {
        "id": 2,
        "text": "2,3,4"
      },
      {
        "id": 3,
        "text": "1,3,4,5"
      },
      {
        "id": 4,
        "text": "1,2,3,5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Medullary thyroid tumors secrete calcitonin, serotonin, histaminadases, and CEA (carcinoembryonic antigen).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with medullary thyroid carcinoma is posted for surgery. He is nearly 6.5 ft tall, with a slender build and elongated digits. What is the screening test that should be done pre-operatively?",
    "choices": [
      {
        "id": 1,
        "text": "MRI-Brain"
      },
      {
        "id": 2,
        "text": "Serum calcium"
      },
      {
        "id": 3,
        "text": "Urinary catecholamines"
      },
      {
        "id": 4,
        "text": "IGF-1 assay"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient with <strong>medullary thyroid carcinoma</strong> and features of <strong>marfanoid </strong>habitus (very tall patient with\u00a0long, slender fingers and toes) is suggestive of <strong>MEN 2B</strong> syndrome. Such patients are to be <strong>screened</strong> for <strong>pheochromocytoma</strong> by measuring <strong>urinary catecholamines.</strong></p>\n<p>Pheochromocytoma, if present, should be treated first, and then MTC is to be treated next.</p>\n<p>A thyroid swelling with elevated calcitonin indicates a medullary thyroid carcinoma (MTC). MTC can either be <strong>sporadic</strong> (80%) or <strong>familial</strong> (RET gene mutation). In case of <strong>familial</strong> medullary thyroid carcinoma, <strong>stimulation</strong> with <strong>pentagastrin</strong> increases the release of calcitonin. This can be used for the screening of medullary thyroid carcinoma.</p>\n<p>MTC can be inherited as a part of <strong>autosomal dominant</strong> (AD) syndromes such as:</p>\n<ul>\n<li>Familial MTC</li>\n<li style=\"font-weight: 400;\">MEN 2A</li>\n<li style=\"font-weight: 400;\">MEN 2B</li>\n</ul>\n<p><strong>Prophylactic total thyroidectomy</strong>\u00a0should be considered within\u00a0<strong>5years</strong>\u00a0of age in<strong>\u00a0MEN2A</strong>\u00a0mutation and within\u00a0<strong>1year</strong>\u00a0of age in\u00a0<strong>MEN2B</strong>\u00a0mutation.</p>\n<p><strong>Note:</strong> Serum calcium is measured to screen for parathyroid adenoma in MEN 2A.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is diagnosed with medullary thyroid carcinoma. Which of the following could be used to screen the rest of her family?",
    "choices": [
      {
        "id": 1,
        "text": "Pentagastrin"
      },
      {
        "id": 2,
        "text": "Histaminadases"
      },
      {
        "id": 3,
        "text": "Prostaglandin E2 and F2 alpha"
      },
      {
        "id": 4,
        "text": "Serotonin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 1577\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Screening of patients with familial MTC was historically done using <strong>pentagastrin stimulation test</strong> for <strong>calcitonin </strong>levels to make the diagnosis.&nbsp;</p>\n<p>Pentagastrin is a synthetic gastrin analogue. It acts on the CCK-B/gastrin receptor of the C cells&nbsp;and <strong>increases</strong> the&nbsp;basal rate of <strong>calcitonin</strong> <strong>secretion</strong>.</p>\n<p>Basal calcitonin level = total C cell mass x rate of secretion.</p>\n<p>Medullary thyroid tumors secrete calcitonin and carcinoembryonic antigen (CEA), but also other peptides such as calcitonin gene-related peptide, histaminadases, prostaglandins E2 and F2&alpha;, and serotonin.</p>\n<p>Another test that can be used for screening is&nbsp;calcium-stimulated calcitonin levels.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old female was diagnosed with medullary thyroid carcinoma. On USG paratracheal lymph node involvement was found. What is the best method of management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Total thyroidectomy\u00a0with central neck dissection"
      },
      {
        "id": 2,
        "text": "Total thyroidectomy\u00a0with central neck dissection\u00a0and RAI ablation"
      },
      {
        "id": 3,
        "text": "Total thyroidectomy\u00a0with  modified radical and central neck dissection"
      },
      {
        "id": 4,
        "text": "Total thyroidectomy\u00a0with lateral and central neck dissection"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Medullary thyroid carcinoma (MTC) with Level VI or paratracheal lymph node involvement is managed with <strong>total thyroidectomy </strong>with <strong>central neck dissection </strong>and <strong>modified radical neck dissection. </strong></p>\n<p>Surgical management of MTC is as follows:</p>\n<table style=\"height: 113px; width: 611px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"text-align: center; height: 18px; width: 195px;\"><strong>Extent of cancer</strong></td>\n<td style=\"text-align: center; height: 18px; width: 402px;\"><strong>Surgery done</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"height: 46px; width: 195px;\">\n<p>MTC without LN involvement</p>\n</td>\n<td style=\"height: 46px; width: 402px;\">Total thyroidectomy + Central neck dissection (prophylactic)</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"height: 34px; width: 195px;\">\n<p><strong>MTC + level VI LN involved</strong></p>\n</td>\n<td style=\"height: 34px; width: 402px;\"><strong>Total thyroidectomy + Central neck dissection (therapeutic) +&nbsp;Modified radical neck dissection (prophylactic)</strong></td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"height: 19px; width: 195px;\">\n<p>MTC + other LNs involved</p>\n</td>\n<td style=\"height: 19px; width: 402px;\">Total thyroidectomy + Central neck dissection + Modified radical neck dissection (therapeutic)</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Note:&nbsp;</strong>Prophylactic neck dissection is not routinely performed in papillary or follicular carcinoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Prophylactic thyroidectomy is indicated in patients with which of the following features:",
    "choices": [
      {
        "id": 1,
        "text": "Long standing thyroglossal cyst"
      },
      {
        "id": 2,
        "text": "Marfanoid habitus, multiple neuromas on the lip and familial pheochromocytoma,"
      },
      {
        "id": 3,
        "text": "Dense lymphatic infiltration of the thyroid detected on FNAC"
      },
      {
        "id": 4,
        "text": "Upregulation of BRAF"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Prophylactic thyroidectomy is indicated in <strong>MEN 2B</strong> syndrome as they can develop medullary thyroid carcinoma. This syndrome manifests as:</p>\n<ul>\n<li>Pheochromocytoma</li>\n<li>Marfanoid habitus</li>\n<li>Mucosal neuromas</li>\n<li>Medullary thyroid cancer.&nbsp;</li>\n</ul>\n<p>Medullary thyroid carcinoma (MTC) can be inherited as <strong>familial MTC, MEN 2A</strong> or <strong>MEN 2B</strong> syndromes. These conditions are autosomal dominant and occur due to <strong>RET proto-oncogene mutation</strong>. As almost all cases of MEN 2B develop medullary thyroid cancer, a prophylactic thyroidectomy may be performed even during infancy.</p>\n<p>Option A:&nbsp;The most common malignancy in <strong>thyroglossal</strong> cysts is&nbsp;<strong>papillary</strong>&nbsp;thyroid carcinoma. In such a case,&nbsp;Sistrunk operation&nbsp;with&nbsp;total thyroidectomy&nbsp;is considered.</p>\n<p>Option C: <strong>Hashimoto's</strong> thyroiditis shows dense lymphatic infiltration of the thyroid detected on FNAC which is treated with thyroxine. However, total thyroidectomy is performed in malignant transformation to thyroid lymphoma.</p>\n<p>Option D: Upregulation of <strong>BRAF</strong> is associated with <strong>papillary</strong> thyroid carcinoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common site of distant metastasis in patients with medullary thyroid carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Liver"
      },
      {
        "id": 2,
        "text": "Bone"
      },
      {
        "id": 3,
        "text": "Lung"
      },
      {
        "id": 4,
        "text": "Adrenal"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Liver</strong> <strong>metastasis</strong> is more common in <strong>medullary</strong> thyroid carcinoma.</p>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Type of thyroid cancer</strong></td>\n<td style=\"text-align: center;\"><strong>Most common distant site</strong></td>\n</tr>\n<tr>\n<td>Papillary</td>\n<td>Lungs</td>\n</tr>\n<tr>\n<td>Follicular</td>\n<td>Bones</td>\n</tr>\n<tr>\n<td><strong>Medullary</strong></td>\n<td><strong>Liver</strong></td>\n</tr>\n<tr>\n<td>Anaplastic</td>\n<td>Lungs</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about the 8th edition AJCC staging of thyroid neoplasms?",
    "choices": [
      {
        "id": 1,
        "text": "In DTC, distant metastasis is IVB"
      },
      {
        "id": 2,
        "text": "In staging, age barrier is 55 years"
      },
      {
        "id": 3,
        "text": "T3a includes minor extrathyroidal extension"
      },
      {
        "id": 4,
        "text": "N1a includes level VI and VII"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Minor extrathyroidal extension</strong> detected only on histological examination is <strong>removed from the definition of T3</strong> disease and therefore has no impact on either T category or overall stage.</p>\n<p><strong>Differentiated Thyroid Cancer:</strong></p>\n<ul>\n<li>The <strong>age</strong> <strong>cutoff</strong> used for staging is increased from 45 to <strong>55 years</strong> of age at diagnosis.&nbsp;</li>\n<li>N1 disease no longer upstages a patient to stage III. If<strong> &lt; 55 years</strong> of age at diagnosis, <strong>N1 disease is stage I</strong>. If <strong>&ge; 55 years</strong> of age, <strong>N1 disease is stage II.</strong></li>\n<li><strong>T3a</strong> is a new category for tumors <strong>&gt; 4 cm confined to the thyroid gland</strong></li>\n<li><strong>T3b</strong> is a new category for tumors of any size demonstrating<strong> gross extrathyroidal extension into strap muscles</strong> (sternohyoid, sternothyroid, thyrohyoid or omohyoid muscles)</li>\n<li><strong>Level VII</strong> lymph nodes, previously classified as lateral neck lymph nodes (N1b) is re-classified as central neck lymph nodes <strong>(N1a)</strong> to be more anatomically consistent and because level VII presented significant coding difficulties for tumor registrars, clinicians and researchers.</li>\n<li>In differentiated thyroid cancer, the presence of <strong>distant metastases</strong> <strong>(M1)</strong> in older patients is classified as <strong>IVB</strong> disease rather than IVC disease. Distant metastasis in anaplastic thyroid cancer continues to be classified as IVC disease.</li>\n</ul>\n<p>Minimal or occult/microcarcinoma are tumors&nbsp;1 cm or less in size. They have&nbsp;no evidence of local invasiveness through the thyroid capsule or angioinvasion. Occult malignancies are&nbsp;usually not associated with lymph node metastases. However, about <strong>25% of patients </strong>with these tumors have associated occult lymph node metastases. These are&nbsp;<strong>nonpalpable </strong>and are found<strong> i</strong><strong>ncidentally</strong>&nbsp;at operative and histologic examinations or at autopsy.&nbsp;&nbsp;</p>\n<table style=\"width: 382.253px;\">\n<tbody>\n<tr>\n<td style=\"width: 96px;\">TNM staging</td>\n<td style=\"width: 133px;\">7th AJCC (2010)</td>\n<td style=\"width: 155.253px;\"><strong>8th AJCC (2018)</strong></td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">Primary tumor(pT)</td>\n<td style=\"width: 133px;\">&nbsp;</td>\n<td style=\"width: 155.253px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">TX</td>\n<td style=\"width: 133px;\">Cannot be assessed</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">T0</td>\n<td style=\"width: 133px;\">No evidence of cancer</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">T1</td>\n<td style=\"width: 133px;\">Tumour &le; 2 cm, intrathyroidal\n<ul>\n<li>T1a:&nbsp;&le;1 cm, intrathyroidal</li>\n<li>T1b<strong>:</strong>&nbsp;1-2 cm, intrathyroidal</li>\n</ul>\n</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">T2</td>\n<td style=\"width: 133px;\">\n<div class=\"page\" title=\"Page 927\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>2-4 cm, intrathyroidal</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">T3</td>\n<td style=\"width: 133px;\">\n<div class=\"page\" title=\"Page 927\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>&gt;4 cm limited to the thyroid or any size with minimal extrathyroidal extension (muscle, soft tissue)</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 155.253px;\"><br />\n<ul>\n<li><strong>T3a:&nbsp;</strong>Tumor <strong>&gt;4 cm limited to the thyroid</strong></li>\n<li><strong>T3b:&nbsp;Gross extrathyroidal extension</strong> invading only <strong>strap muscles</strong> (sternohyoid, sternothyroid, thyrohyoid or omohyoid muscles) from a tumour of any size</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">T4</td>\n<td style=\"width: 133px;\">\n<div class=\"page\" title=\"Page 927\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>T4a Invades subcutaneous tissue, larynx, trachea, esophagus, or RLN</li>\n<li>T4b Invades prevertebral fascia or encases carotid or mediastinal vessels</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 155.253px;\">\n<p>&nbsp;</p>\n<p>-do-<br /><br /></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">Regional lymph nodes (pN)</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">NX</td>\n<td style=\"width: 133px;\">Regional lymph nodes cannot be assessed</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">N0</td>\n<td style=\"width: 133px;\">No lymph node metastasis</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">N1a</td>\n<td style=\"width: 133px;\">\n<div class=\"page\" title=\"Page 927\">\n<div class=\"page\" title=\"Page 927\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Positive in level VI; unilateral or bilateral disease</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 155.253px;\"><strong>Metastasis to level VI or VII;&nbsp;</strong>unilateral or bilateral disease</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">N1b</td>\n<td style=\"width: 133px;\">\n<div class=\"page\" title=\"Page 927\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Metastasis to unilateral, bilateral or contralateral lateral neck lymph nodes (levels I, II, III, IV or V) or retropharyngeal lymph nodes</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 155.253px;\">-do-<br /><br /></td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">Distant metastasis (pM)</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">M0</td>\n<td style=\"width: 133px;\">No Distant metastasis</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n<tr>\n<td style=\"width: 96px;\">M1</td>\n<td style=\"width: 133px;\">Distant metastasis present</td>\n<td style=\"width: 155.253px;\">-do-</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<table style=\"height: 216px; width: 389px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 645px; height: 18px;\" colspan=\"3\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TNM CLASSIFICATION of Thyroid tumours</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 645px; height: 18px;\" colspan=\"3\">PAPILLARY OR FOLLICULAR TUMORS</td>\n</tr>\n<tr style=\"height: 38px;\">\n<td style=\"width: 105px; height: 38px;\">Stage</td>\n<td style=\"width: 258.116px; height: 38px;\">TNM&nbsp;AJCC 7<sup>th</sup> edition</td>\n<td style=\"width: 281.884px; height: 38px;\"><strong>TNM AJCC 8<sup>th</sup> edition</strong>&nbsp;</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">&nbsp;</td>\n<td style=\"width: 258.116px; height: 18px;\">&lt;45 y</td>\n<td style=\"width: 281.884px; height: 18px;\">&nbsp;<strong>&lt;55 y</strong></td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 105px; height: 46px;\">\n<p>I</p>\n</td>\n<td style=\"width: 258.116px; height: 46px;\">&nbsp;Any T, any N, M0</td>\n<td style=\"width: 281.884px; height: 46px;\">&nbsp;-do-</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 105px; height: 46px;\">\n<p>II</p>\n</td>\n<td style=\"width: 258.116px; height: 46px;\">&nbsp;Any T, any N, M1</td>\n<td style=\"width: 281.884px; height: 46px;\">&nbsp;-do-</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">&nbsp;</td>\n<td style=\"width: 258.116px; height: 18px;\">&nbsp;&ge;45 y</td>\n<td style=\"width: 281.884px; height: 18px;\"><strong>&nbsp;&gt;55 y</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">I</td>\n<td style=\"width: 258.116px; height: 18px;\">&nbsp;T1, N0, M0</td>\n<td style=\"width: 281.884px; height: 18px;\">&nbsp;<strong>T1-2</strong>, N0, M0</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 105px; height: 78px;\">II</td>\n<td style=\"width: 258.116px; height: 78px;\">&nbsp;T2, N0, M0</td>\n<td style=\"width: 281.884px; height: 78px;\">\n<p>&nbsp;T1-2, <strong>N1</strong>, M0</p>\n<p><strong>T3</strong>, <strong>any N</strong>, M0</p>\n</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 105px; height: 78px;\">III</td>\n<td style=\"width: 258.116px; height: 78px;\">\n<div class=\"page\" title=\"Page 1572\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>T3, N0, M0</p>\n<p>T1&ndash;3, N1a, M0</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 281.884px; height: 78px;\"><strong>T4a, any N</strong>, M0</td>\n</tr>\n<tr style=\"height: 78px;\">\n<td style=\"width: 105px; height: 78px;\">IV A</td>\n<td style=\"width: 258.116px; height: 78px;\">\n<p>T4a, N0-1a, M0</p>\n<p>T1-4a, N1b, M0</p>\n</td>\n<td style=\"width: 281.884px; height: 78px;\">&nbsp;<strong>T4b, any N</strong>, M0</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">&nbsp;IV B</td>\n<td style=\"width: 258.116px; height: 18px;\">&nbsp;T4b, any N, M0</td>\n<td style=\"width: 281.884px; height: 18px;\">&nbsp;<strong>any T, any N, M1&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 59.8438px;\">\n<td style=\"width: 105px; height: 59.8438px;\">\n<p>IV C</p>\n</td>\n<td style=\"width: 258.116px; height: 59.8438px;\">\n<p>Any T, any N, M1</p>\n</td>\n<td style=\"width: 281.884px; height: 59.8438px;\">\n<p><strong>- deleted-</strong></p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 645px; height: 18px;\" colspan=\"3\">MEDULLARY THYROID CANCER&nbsp;</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">Stage</td>\n<td style=\"width: 258.116px; height: 18px;\">TNM&nbsp;AJCC 7<sup>th</sup> edition</td>\n<td style=\"width: 281.884px; height: 18px;\"><strong>TNM AJCC 8<sup>th</sup> edition</strong>&nbsp;</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">I</td>\n<td style=\"width: 258.116px; height: 18px;\">T1, N0, M0</td>\n<td style=\"width: 281.884px; height: 18px;\">-do-</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">II</td>\n<td style=\"width: 258.116px; height: 18px;\">T2&ndash;3, N0, M0</td>\n<td style=\"width: 281.884px; height: 18px;\">-do- &nbsp;</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">III</td>\n<td style=\"width: 258.116px; height: 18px;\">T1&ndash;3, N1a, M0</td>\n<td style=\"width: 281.884px; height: 18px;\">-do-&nbsp;</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">IV A</td>\n<td style=\"width: 258.116px; height: 18px;\">\n<p>T4a, any N, M0;</p>\n<p>T1-3, N1b, M0&nbsp;</p>\n</td>\n<td style=\"width: 281.884px; height: 18px;\">-do-</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">IV B</td>\n<td style=\"width: 258.116px; height: 18px;\">&nbsp;T4b, any N, M0</td>\n<td style=\"width: 281.884px; height: 18px;\">-do-</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 105px; height: 18px;\">IV C</td>\n<td style=\"width: 258.116px; height: 18px;\">&nbsp;Any T, any N, M1</td>\n<td style=\"width: 281.884px; height: 18px;\">-do-</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p><strong>Anaplastic :</strong></p>\n<ul>\n<li>Unlike previous editions where all anaplastic thyroid cancers were classified as T4 disease, anaplastic cancers now use the<strong> same T&nbsp; definitions as differentiated thyroid cancer</strong>.</li>\n<li><strong>Intrathyroidal disease</strong> (<strong>T1-3a)</strong> is stage <strong>IVA</strong></li>\n<li><strong>Gross extrathyroidal extension</strong>(<strong>T3b,T4)</strong> or <strong>cervical lymph node metastases (N1)</strong> is stage <strong>IVB</strong></li>\n<li><strong>Distant metastases</strong> <strong>(M1)</strong> are stage <strong>IVC</strong></li>\n</ul>\n<table style=\"height: 216px; width: 372px;\">\n<tbody>\n<tr style=\"height: 45px;\">\n<td style=\"width: 621px; height: 45px;\" colspan=\"3\">\n<p>ANAPLASTIC CANCER</p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 151px; height: 46px;\">\n<p>Stage</p>\n</td>\n<td style=\"width: 227.628px; height: 46px;\">\n<p>TNM&nbsp;AJCC 7<sup>th</sup> edition</p>\n</td>\n<td style=\"width: 242.372px; height: 46px;\">&nbsp;<strong>TNM AJCC 8<sup>th</sup>edition</strong>&nbsp; &nbsp;</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 151px; height: 46px;\">\n<p>IV A</p>\n</td>\n<td style=\"width: 227.628px; height: 46px;\">&nbsp;T4a, Any N, M0</td>\n<td style=\"width: 242.372px; height: 46px;\">&nbsp;<strong>T1-3a, N0,</strong> M0</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 151px; height: 46px;\">&nbsp;IV B</td>\n<td style=\"width: 227.628px; height: 46px;\">&nbsp;T4b, Any N, M0</td>\n<td style=\"width: 242.372px; height: 46px;\">\n<p>T1-3a, <strong>N1</strong>, M0;</p>\n<p><strong>T3b</strong>, Any N, M0;</p>\n<p><strong>T4</strong>, Any N, M0</p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 151px; height: 46px;\">IV C</td>\n<td style=\"width: 227.628px; height: 46px;\">&nbsp;Any T, Any N, M1</td>\n<td style=\"width: 242.372px; height: 46px;\">&nbsp;-do-</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following will not be a treatment option for a pregnant patient with papillary thyroid carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Total Thyroidectomy"
      },
      {
        "id": 2,
        "text": "Total Thyroidectomy plus Lymph node dissection"
      },
      {
        "id": 3,
        "text": "Radioiodine ablation of thyroid"
      },
      {
        "id": 4,
        "text": "Right Hemithyroidectomy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Radioiodine ablation of thyroid is <strong>contraindicated in pregnant women </strong>due to risk of <strong>radiation exposure to the fetus</strong>.&nbsp;</p>\n<p><strong>Therapeutic uses</strong> for radioactive iodine</p>\n<ul>\n<li><strong>In primary thyrotoxicosis after 45 years.</strong></li>\n<li>In <strong>autonomous toxic nodule after 45 years</strong>, it is useful as remaining gland still will function adequately after radiotherapy.</li>\n<li>In <strong>follicular carcinoma of thyroid, after total thyroidectomy</strong>, if there are secondaries elsewhere in the body, as in bones or lungs, then I<sub>131 </sub>is given.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with papillary thyroid carcinoma underwent total thyroidectomy with central neck dissection, a month ago. At present, a whole-body iodine scan is positive. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Re-exploration of thyroid gland"
      },
      {
        "id": 2,
        "text": "Radio-iodine ablation"
      },
      {
        "id": 3,
        "text": "USG-neck"
      },
      {
        "id": 4,
        "text": "Bi-annual follow-up"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Radio-iodine ablation</strong> is undertaken when a whole-body iodine scan is positive after a total thyroidectomy for any differentiated thyroid cancer (papillary or follicular carcinoma).&nbsp;</p>\n<p>The presence of any metastatic or residual thyroid tissue after total thyroidectomy can be detected by observing the uptake of radio-iodine in the entire body. To achieve effective uptake of radio-iodine, TSH levels need to be greatly increased, for example, by withdrawing thyroxine after the surgery for <strong>4-6 weeks</strong>.</p>\n<p>A <strong>positive</strong> whole-body iodine scan after total thyroidectomy indicates that there is either a metastatic or residual disease present. These patients are treated with I<sup>131</sup> for <strong>radio-iodine ablation</strong>.&nbsp;</p>\n<p>A <strong>negative</strong>&nbsp;scan means there is no metastasis or residual thyroid tissue. They are followed up regularly with serum thyroglobulin, TSH and USG-neck.</p>\n<p>If the tumour is <strong>resistant</strong> to radioiodine <strong>ablation</strong>, <strong>EBRT</strong> (external beam radiotherapy) is done.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A whole-body iodine scan is not useful in patients with which thyroid malignancy?",
    "choices": [
      {
        "id": 1,
        "text": "Papillary thyroid cancer"
      },
      {
        "id": 2,
        "text": "Anaplastic thyroid cancer"
      },
      {
        "id": 3,
        "text": "Medullary thyroid cancer"
      },
      {
        "id": 4,
        "text": "Follicular thyroid cancer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>After a total thyroidectomy, a whole-body iodine scan is not useful for detecting residual thyroid tissue or metastasis in&nbsp;<strong>medullary thyroid carcinoma</strong>.</p>\n<p>Medullary thyroid carcinoma is a tumour of <strong>parafollicular</strong> or<strong> C cells.&nbsp;</strong>These cells which are derived from neural crest cells, <strong>do not take up iodine</strong>. &nbsp;</p>\n<p>A whole-body iodine scan is useful in thyroid&nbsp;tumours derived from follicular cells that take up iodine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following scales consider the completeness of surgical resection to determine the prognosis of a patient with thyroid cancer?",
    "choices": [
      {
        "id": 1,
        "text": "AMES"
      },
      {
        "id": 2,
        "text": "AGES"
      },
      {
        "id": 3,
        "text": "MACIS"
      },
      {
        "id": 4,
        "text": "TNM"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>MACIS scale includes completeness of the original surgical resection to determine the prognosis of the thyroid cancer.</p>\n<p><strong>Prognostic indicators</strong> of well differentiated thyroid cancers:&nbsp;</p>\n<ul>\n<li class=\"li1\"><strong>AGES</strong> system - <strong>A</strong>ge, histologic<strong> G</strong>rade, <strong>E</strong>xtrathyroidal invasion, and metastases and tumor <strong>S</strong>ize.</li>\n<li class=\"li1\"><strong>AMES</strong> system - <strong>A</strong>ge (men &lt;40 years old, women &lt;50 years old), <strong>M</strong>etastases, <strong>E</strong>xtrathyroidal spread, and <strong>S</strong>ize of tumors (&lt; or &gt;5 cm).\n<ul>\n<li class=\"li1\">DAMES - DNA aneuploidy + AMES</li>\n<li class=\"li1\">GAMES - Grade + AMES</li>\n</ul>\n</li>\n<li class=\"li1\"><strong>TNM</strong> staging - <strong>T</strong>umor, <strong>N</strong>odal status,<strong> M</strong>etastases.</li>\n<li class=\"li1\"><strong>MACIS</strong> scale (postop modification) - distant <strong>M</strong>etastases, <strong>A</strong>ge at presentation (&lt;40 or &gt;40 years old), <strong>Completeness of original surgical resection</strong>, extrathyroidal <strong>I</strong>nvasion, and <strong>S</strong>ize of original lesion (in centimeters).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '13 Thyroid Malignancies';
        const quizFilename = '13-thyroid-malignancies-287e8fec.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>