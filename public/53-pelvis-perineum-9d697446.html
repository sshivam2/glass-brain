<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>53 Pelvis & Perineum - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Identify the structure marked in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Poupart\u2019s ligament"
      },
      {
        "id": 2,
        "text": "Lacunar ligament"
      },
      {
        "id": 3,
        "text": "Cooper\u2019s ligament"
      },
      {
        "id": 4,
        "text": "Conjoint tendon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The structure marked is the <strong>l</strong><strong>acunar ligament.</strong></p>\n<p><strong>Lacunar </strong>(Gimbernat's)<strong> ligament </strong>- It&nbsp;is a thick triangular band of tissue formed from fibres of the medial end of the inguinal ligament and fascia lata.&nbsp; It forms the <strong>medial wall</strong> of the<strong> femoral canal.</strong> The apex of the triangle is attached to the pubic tubercle.</p>\n<p>Inguinal (<strong>Poupart&rsquo;s</strong>) <strong>ligament</strong>&nbsp;- The thick external oblique aponeurosis stretched <strong>between ASIS</strong> (anterior superior iliac spine) and <strong>pubic tubercle</strong>.&nbsp;</p>\n<p><strong>Pectineal</strong> (Astley-<strong>Cooper'</strong>s) <strong>ligament</strong>&nbsp;- A strong fibrous band that <strong>extends laterally</strong> along the pectineal line <strong>from</strong> the <strong>pectineal attachment</strong> of the <strong>lacunar ligament.</strong></p>\n<p><strong>Conjoint tendon -&nbsp;</strong>It is a condensation of tissue that runs through the<strong> lateral edge </strong>of the lower<strong> rectus sheath. </strong>It is formed from the<strong> common aponeurosis </strong>of the<strong> internal oblique </strong>muscle and<strong> transverse abdominis </strong>muscle. The fibers turn inferiorly and<strong> insert </strong>into the<strong> crest of the pubis </strong>at the pectineal line immediately deep to the<strong> superficial inguinal ring.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3a06d68a78f44d4185fcd97599fded16.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/54eb9a3fdd984ab2be0791a692711d9ax1280x1423.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a33435c81014a51a7d5fa8dfd65d103x1279x1860.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00646b9ca659499e905c76c15af92922x1280x1659.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is true about the iliopubic tract?",
    "choices": [
      {
        "id": 1,
        "text": "It is a thickening of the lumbar fascia"
      },
      {
        "id": 2,
        "text": "It lies anterior to the Poupart's ligament"
      },
      {
        "id": 3,
        "text": "It inserts into the pubic tubercle in front of the conjoint tendon"
      },
      {
        "id": 4,
        "text": "Its fibers fan out with fascia iliaca laterally"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The fibers of the&nbsp;<strong>iliopubic tract</strong> fan out with <strong>fascia iliaca</strong> <strong>laterally</strong>.</p>\n<p>The&nbsp;<strong>iliopubic tract</strong>&nbsp;is a thickening of the <strong>transversalis fascia</strong>&nbsp;lying immediately posterior to the inguinal (Poupart's) ligament. It extends from the anterior superior iliac spine (ASIS) superolaterally and arches across the front of the femoral sheath.</p>\n<p><strong>Attachments:</strong></p>\n<ul>\n<li><strong>Medially</strong>, its fibres insert&nbsp;by a broad attachment into the <strong>pubic tubercle</strong> and pectineal line,<strong> behind the conjoint tendon</strong>.&nbsp;</li>\n<li><strong>Laterally</strong>, its fibres fan out within the<strong> fascia transversalis</strong> and <strong>fascia iliaca </strong>without bony attachment to the iliac spines.&nbsp;</li>\n</ul>\n<p>Clinical note:<strong>&nbsp;</strong>It is considered as an important<strong> landmark</strong> in <strong>laparoscopic hernia surgeries</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d657fa50c188484ea76b246e6d67f7f5x1280x1659.JPEG"
    ]
  },
  {
    "text": "Which of the following does not form the bony pelvis?",
    "choices": [
      {
        "id": 1,
        "text": "Pubis"
      },
      {
        "id": 2,
        "text": "Ilium"
      },
      {
        "id": 3,
        "text": "L5"
      },
      {
        "id": 4,
        "text": "Coccyx"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The L5 lumbar vertebra does not form the bony pelvis.</p>\n<p>The bony <strong>pelvis</strong> consists of <strong>four bones:</strong></p>\n<ul>\n<li>two hip bones</li>\n<li>sacrum</li>\n<li>coccyx</li>\n</ul>\n<p>The articulations of these bones form <strong>four joints</strong> which are:</p>\n<ul>\n<li>Two <strong>sacroiliac</strong> joints &ndash; Between the ilium of the hip bones, and the sacrum.</li>\n<li><strong>Sacrococcygeal</strong> symphysis &ndash; Between the sacrum and the coccyx.</li>\n<li><strong>Pubic symphysis</strong> &ndash; Between the pubis bodies of the two hip bones.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b16fa6b8ca824f05935a9d6b28d1a58ax600x600.PNG"
    ]
  },
  {
    "text": "A 33-year-old primigravida presented at term with non-engagement of the fetal head. She is suspected to have cephalopelvic disproportion at the level of inlet. Which of the following does not form the boundary of the involved structure?",
    "choices": [
      {
        "id": 1,
        "text": "Sacral promontory"
      },
      {
        "id": 2,
        "text": "Ischial tuberosity"
      },
      {
        "id": 3,
        "text": "Pecten Pubis"
      },
      {
        "id": 4,
        "text": "Pubic symphysis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Clinical significance:</strong></p>\n<p><strong>Cephalopelvic disproportion</strong> can occur when any of the inlet or outlet <strong>diameters</strong> are <strong>shortened</strong> by <strong>more than 0.5 cm</strong>, thus leading to the fetal head not getting engaged during labor. A primigravida presenting with a <strong>non-engaged head at term</strong> should raise suspicion of a contracted pelvis and cephalopelvic disproportion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1dc7cb91081547f992295a5c60ef260cx1280x1700.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/566630c4ef9c4a76a8449eaf7c81e8adx1280x1700.JPEG"
    ]
  },
  {
    "text": "A patient with sciatica was found to have inflammation of the muscle marked below. Identify it.",
    "choices": [
      {
        "id": 1,
        "text": "Piriformis"
      },
      {
        "id": 2,
        "text": "Gamellus superior"
      },
      {
        "id": 3,
        "text": "Gluteus minimus"
      },
      {
        "id": 4,
        "text": "Quadratus femoris"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked muscle is the <strong>piriformis</strong> muscle.\u00a0</p>\n<ul>\n<li>Origin:\n<ul>\n<li>The anterior surface of the sacrum</li>\n<li>The posterior inferior iliac spine</li>\n<li>The capsule of the sacroiliac joint</li>\n<li>Sacrotuberous ligament</li>\n</ul>\n</li>\n<li>Insertion -\u00a0greater trochanter of the femur.</li>\n<li>Action -\u00a0 lateral rotation of the thigh in extension and abduction of the thigh in the flexed position</li>\n</ul>\n<p>The muscle forms the posterolateral wall of the pelvic cavity. The <strong>sciatic nerve</strong> is closely related to the muscle and it <strong>passes</strong> through the muscle fibres or <strong>below the muscle</strong>.</p>\n<p>Clinical significance:</p>\n<p><strong>Piriformis syndrome\u00a0</strong>is a clinical condition characterized by the <strong>compression of the sciatic nerve</strong> by the piriformis muscle. This can occur due to inflammation of the piriformis muscle. The patient will present with <strong>pain along the distribution</strong> of the sciatic nerve which is also known as <strong>sciatica</strong>.</p>\n<p>The following image shows relationship of sciatic nerve with the piriformis.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/30c1dc52ce534d96bb74181c047d7794.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/968d426286b54dac8b20e2482ad9e290x1280x1711.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ff31c9a8765c411a9edb1cc383b89c68x1279x1598.JPEG"
    ]
  },
  {
    "text": "Which of the following forms the anterolateral wall of the true pelvis?",
    "choices": [
      {
        "id": 1,
        "text": "Obturator externus"
      },
      {
        "id": 2,
        "text": "Piriformis"
      },
      {
        "id": 3,
        "text": "Obturator internus"
      },
      {
        "id": 4,
        "text": "Levator ani"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Obturator internus</strong> with its fascia&nbsp;forms the<strong> anterolateral wall</strong> of the <strong>true pelvis</strong>.</p>\n<p><strong>Muscles forming walls of the true pelvis:</strong></p>\n<ul>\n<li>Anterolateral wall - obturator internus and the fascia over its upper and inner (pelvic) surface.</li>\n<li>Posterolateral wall - piriformis</li>\n<li>Floor - levator ani and coccygeus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c0bafe2e502f461e940a89256019ae23x600x614.JPEG"
    ]
  },
  {
    "text": "An elderly woman presented with the following finding. Weakness of which of the following muscles could not have led to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Puborectalis"
      },
      {
        "id": 2,
        "text": "Pubococcygeus"
      },
      {
        "id": 3,
        "text": "Ischiococcygeus"
      },
      {
        "id": 4,
        "text": "Iliococcygeus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given case scenario and image is suggestive of <strong>uterine prolapse&nbsp;</strong>which&nbsp;occurs&nbsp;due to <strong>weakness of</strong> the <strong>levator ani</strong> muscle.&nbsp;Ischiococcygeus is <strong>not a part</strong> of the levator ani. It is a separate muscle that lies at the posterosuperior part of the pelvis and is not a part of the supports of the uetrus.</p>\n<p>The levator ani forms a large portion of the pelvic floor. It is composed of<strong> three </strong>separate<strong> paired muscles:</strong></p>\n<ul>\n<li>Pubococcygeus - this starts from the posterior part of the pubis and runs lateral to the urethra and it' spinchter while passing through the pelvic floor.</li>\n<li>Puborectalis - This muscle starts from the ischiopubic rami and runs medial to pubococcygeus and iliococcygeus to terminate posterior to the rectum at anorectal junction.&nbsp;</li>\n<li>Iliococcygeus - This muscle is placed posterior most as a triangular musculotendinous sheet where the apex is attached to the tip of the ischial spine and the base is attached to the lateral margin of coccyx and the fifth sacral segment.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e81d45caf18f4a2994cddf53c9e5769e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b82f3d73cec84e0b9c34b5592bacd696x600x684.JPEG"
    ]
  },
  {
    "text": "Which of the following is false about the levator ani?",
    "choices": [
      {
        "id": 1,
        "text": "Contraction leads to occlusion of the vaginal canal"
      },
      {
        "id": 2,
        "text": "Puborectalis and  pubococcygeus creates the anorectal angle"
      },
      {
        "id": 3,
        "text": "Helps in maintaining rectal tone"
      },
      {
        "id": 4,
        "text": "Arises from the condensation of the piriformis fascia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The levator ani muscle arises from <strong>condensations of the obturator fascia</strong> which forms the <strong>tendinous arch</strong> of the levator ani.</p>\n<p>The <strong>vaginal,</strong> urethral, and rectal lumen are <strong>occluded</strong> by the <strong>contraction</strong> of the <strong>levator ani</strong> and relaxation of the muscle is needed for defecation and urination.</p>\n<p>The <strong>pubococcygeus</strong> and<strong> puborectalis</strong> parts of the levator ani help maintain the <strong>tone</strong> of the <strong>rectum</strong> as well as create the <strong>anorectal angle</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0090ea163b584c9fb97a3635e4ce5a03x600x684.JPEG"
    ]
  },
  {
    "text": "During the evaluation of a patient with erectile dysfunction, his internal pudendal artery was found to be stenosed. Which of the following\u200b vessels is this a branch of?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior division of internal iliac artery"
      },
      {
        "id": 2,
        "text": "Posterior division of internal iliac artery"
      },
      {
        "id": 3,
        "text": "External iliac artery"
      },
      {
        "id": 4,
        "text": "Iliolumbar artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>anterior division </strong>of the <strong>internal iliac artery</strong> gives rise to the&nbsp;<strong>internal pudendal artery.</strong></p>\n<p>The <strong>internal iliac artery</strong> is the major artery of the pelvis. At the superior border of the <strong>greater sciatic foramen</strong> in the pelvis, it<strong> divides into anterior and posterior</strong> trunks.</p>\n<p><strong>Branches of the anterior trunk </strong>of internal iliac artery:</p>\n<ul>\n<li>Obturator artery</li>\n<li>Superior vesical artery</li>\n<li>Inferior vesical artery&nbsp;</li>\n<li>Inferior gluteal artery</li>\n<li>Middle rectal artery</li>\n<li>Vaginal artery (in females)</li>\n<li>Uterine artery (in females)</li>\n<li>Internal pudendal artery</li>\n</ul>\n<p><strong>Branches of the posterior trunk</strong> of internal iliac artery:</p>\n<ul>\n<li>Iliolumbar artery</li>\n<li>Lateral sacral arteries</li>\n<li>Superior gluteal artery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While examining a patient with a direct inguinal hernia, you note that the sac protrudes through the Hesselbach's triangle. Where does the structure forming its lateral boundary originate from?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior trunk of the internal iliac artery"
      },
      {
        "id": 2,
        "text": "Posterior trunk of the internal iliac artery"
      },
      {
        "id": 3,
        "text": "External iliac artery"
      },
      {
        "id": 4,
        "text": "Femoral artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The&nbsp;<strong>lateral boundary</strong>&nbsp;of <strong>Hesselbach's triangle</strong> is formed by the&nbsp;<strong>inferior epigastric artery. </strong>It&nbsp;originates from the <strong>external iliac artery.</strong></p>\n<p>The<strong> external iliac artery</strong> is the main artery of the<strong> lower limb</strong>. Its branches are:</p>\n<ul>\n<li>Deep circum\ufb02ex iliac&nbsp;</li>\n<li>Inferior epigastric</li>\n<li>Small branches to psoas major and nearby lymph nodes</li>\n<li>Femoral artery</li>\n</ul>\n<p>Clinical significance:</p>\n<p>Apart from being a <strong>landmark</strong> in <strong>hernia surgery</strong>, the inferior epigastric artery contributes to the <strong>corona mortis</strong>. This is an anastomosis between&nbsp;the common iliac, internal iliac, obturator, inferior epigastric, and external iliac vessels. <strong>Iatrogenic injury</strong> in this region leads to <strong>torrential hemorrhage</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a tributary of the common iliac vein?",
    "choices": [
      {
        "id": 1,
        "text": "Middle rectal vein"
      },
      {
        "id": 2,
        "text": "Superior gluteal vein"
      },
      {
        "id": 3,
        "text": "Inferior gluteal vein"
      },
      {
        "id": 4,
        "text": "Median sacral vein"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>The median sacral vein&nbsp;</strong>is a tributary of the common iliac vein.</p>\n<p><strong>Tributaries of common iliac vein:</strong></p>\n<ul>\n<li>Median sacral veins</li>\n<li>Iliolumbar vein</li>\n<li>Lateral sacral veins (occasionally)</li>\n</ul>\n<p><strong>Tributaries of internal iliac vein:</strong></p>\n<ul>\n<li>Superior and inferior gluteal veins</li>\n<li>Internal pudendal vein</li>\n<li>Obturator vein</li>\n<li>Lateral sacral veins (usually)</li>\n<li>Middle rectal vein</li>\n<li>Vesical veins</li>\n<li>Uterine and vaginal veins</li>\n</ul>\n<p><strong>Tributaries of external iliac vein:</strong></p>\n<ul>\n<li>Inferior epigastric vein</li>\n<li>Deep circum\ufb02ex iliac vein</li>\n<li>Pubic vein</li>\n</ul>\n<p>Clinical Note: <strong>Agenesis </strong>of the<strong> external iliac vein</strong> has been reported in association with <strong>Klippel&ndash;Trenaunay syndrome.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eba5e9022dac4e0dba4755c9487f54d9x450x429.PNG"
    ]
  },
  {
    "text": "Which of the following structures given below is related to the structure highlighted (red) in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Pudendal nerve"
      },
      {
        "id": 2,
        "text": "Sciatic nerve"
      },
      {
        "id": 3,
        "text": "Obturator nerve"
      },
      {
        "id": 4,
        "text": "Femoral nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The structure marked in red is the <strong>ischial spine</strong> and the&nbsp;<strong>pudendal nerve</strong> is related to it.</p>\n<p>The pudendal nerve originates from the sacral plexus <strong>S2-S4</strong>. It exits out of the pelvis by passing through the greater sciatic foramen. It then enters the perineum below the pelvic floor by passing around the <strong>ischial spine.</strong>&nbsp;The ischial spine is used as a <strong>landmark</strong> for <strong>pudendal nerve block.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/db285732270b479cb859610543c375c8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/956270f002614ad88fee7b54142210fax600x685.JPEG"
    ]
  },
  {
    "text": "Which of the following does not form an anatomical boundary of the perineum?",
    "choices": [
      {
        "id": 1,
        "text": "Arcuate ligament of pubis"
      },
      {
        "id": 2,
        "text": "Sacrotuberous ligaments"
      },
      {
        "id": 3,
        "text": "Sacrospinous ligaments"
      },
      {
        "id": 4,
        "text": "Coccyx"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The sacrospinous ligament&nbsp;does not form an anatomical boundary of the perineum.</p>\n<p>The <strong>perineum</strong> is a diamond-shaped region that <strong>overlies</strong> the <strong>pelvic outlet.</strong></p>\n<p><strong>Boundaries</strong> <strong>of perineum:</strong></p>\n<ul>\n<li><strong>Anteriorly</strong>: Pubic symphysis and its arcuate ligament.</li>\n<li><strong>Posteriorly</strong>: Coccyx</li>\n<li><strong>Anterolaterally</strong>: Ischiopubic rami and the ischial tuberosities.</li>\n<li><strong>Posterolaterally</strong>: Sacrotuberous ligaments</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0c02a8af1f7447f7b3870e36b9c21ca1x1280x1700.JPEG"
    ]
  },
  {
    "text": "A line between which of the following structures divides the perineum into anterior and posterior triangles?",
    "choices": [
      {
        "id": 1,
        "text": "Right and left ischial spines"
      },
      {
        "id": 2,
        "text": "Symphysis pubis and sacral promontory"
      },
      {
        "id": 3,
        "text": "Right and left ischial tuberosities"
      },
      {
        "id": 4,
        "text": "Symphysis pubis and coccyx"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An imaginary line joining the <strong>ischial tuberosities</strong> (the inter-ischial line) <strong>divides</strong> the <strong>perineum</strong> into an anterior urogenital triangle and a posterior anal triangle.</p>\n<p>The <strong>urogenital triangle</strong> faces <strong>downwards</strong> and <strong>forwards</strong> and has the following structures:</p>\n<p>In males:</p>\n<ul>\n<li>Scrotum</li>\n<li>The root of the penis&nbsp;</li>\n</ul>\n<p>In females:</p>\n<ul>\n<li>Mons pubis</li>\n<li>Labia with the vestibule</li>\n</ul>\n<p>The <strong>anogenital triangle</strong> faces <strong>downwards</strong> and <strong>backwards</strong> and has the following structures common to both males and females:</p>\n<ul>\n<li>Anal canal with its sphincters</li>\n<li>Ischioanal fossa with its contents</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b9fc69051ec4895943fb370b2c08f62x1280x1398.JPEG"
    ]
  },
  {
    "text": "A 30-year-old man with a history of blunt trauma to the pelvis was diagnosed with urethral rupture. Imaging revealed extravasation of the urine into the superficial perineal pouch. The attachment of which \u200bof the following fascia prevents extravasation into the thigh and anal triangle?",
    "choices": [
      {
        "id": 1,
        "text": "Fatty layer of Camper"
      },
      {
        "id": 2,
        "text": "Membranous layer of Scarpa"
      },
      {
        "id": 3,
        "text": "Buck's fascia"
      },
      {
        "id": 4,
        "text": "Colle's fascia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Colle's&nbsp;</strong><strong>fascia</strong>&nbsp;prevents the extravasation of the urine from spreading into the thigh and anal triangle.&nbsp;</p>\n<p>Scarpa's fascia is continuous with the <strong>superficial fascia</strong> of the <strong>scrotum&nbsp;</strong>and becomes&nbsp;the Colles' fascia. In women, it continues into the labia majora and is <strong>continuous</strong> with the <strong>fascia</strong> of the <strong>perineum.&nbsp;</strong>Colle's fascia has the following <strong>attachments</strong>:</p>\n<ul>\n<li>Posterior -&nbsp;<strong>perineal membrane.</strong>&nbsp;It prevents the extravasation of fluids such as blood, pus, or urine into the anal triangle.&nbsp;</li>\n<li>Lateral -&nbsp;<strong>ischiopubic</strong> <strong>rami</strong>&nbsp;and<strong> fascia lata</strong>&nbsp;along&nbsp;<strong>Holden's line. </strong>This line extends from the pubic tubercle laterally for 8 cm. It prevents the extravasation of fluids into the thigh.&nbsp;</li>\n</ul>\n<p>Option A: Camper's fascia is the superficial fatty layer of the superficial fascia of the abdomen.</p>\n<p>Option B: Scarpa's fascia is the deep membranous layer of the superficial fascia of the abdomen.</p>\n<p>Option C: Buck's fascia is the deep fascia of the penis&nbsp;</p>\n<p><strong>Clinical significance:</strong></p>\n<p>When a urethral injury occurs, urine can extravasate into the superficial perineal pouch, penis, scrotum, labia majora and the anterior abdominal wall.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a89e957c868f466f97b3198f1ab132fcx1280x1244.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0624861ecd0e41df8f38903183694536x600x759.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a content of the superficial perineal pouch?",
    "choices": [
      {
        "id": 1,
        "text": "Root of penis"
      },
      {
        "id": 2,
        "text": "Bulbospongiosus muscle"
      },
      {
        "id": 3,
        "text": "Great vestibular glands"
      },
      {
        "id": 4,
        "text": "Bulbourethral glands"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Bulbourethral glands</strong> are not a content of the superficial perineal pouch.&nbsp;They are located in the <strong>deep perineal pouch.&nbsp;</strong></p>\n<p>The <strong>superficial perineal pouch</strong> is a potential space between the <strong>perineal membrane above</strong> and the membranous layer of perineal fascia (<strong>Colle's fascia</strong>) <strong>below.</strong></p>\n<p><strong>Contents </strong>of superficial perineal pouch:</p>\n<table style=\"height: 218px;\" width=\"534\">\n<tbody>\n<tr>\n<td style=\"width: 170.996px; text-align: center;\"><strong>Males</strong></td>\n<td style=\"width: 170.996px; text-align: center;\"><strong>Common to both</strong></td>\n<td style=\"width: 171.016px; text-align: center;\"><strong>Females</strong></td>\n</tr>\n<tr>\n<td style=\"width: 170.996px;\">Root of the penis</td>\n<td style=\"width: 170.996px;\">Urethra</td>\n<td style=\"width: 171.016px;\">Body of the clitoris</td>\n</tr>\n<tr>\n<td style=\"width: 170.996px;\">\n<p>Muscles:&nbsp;</p>\n<ul>\n<li>Two corpora cavernosa</li>\n<li>Corpora spongiosa</li>\n</ul>\n</td>\n<td style=\"width: 170.996px;\">\n<p>Muscles:</p>\n<ul>\n<li>Superficial transverse perinei</li>\n<li>Ischiocavernosus</li>\n<li>Bulbocavernosus</li>\n</ul>\n</td>\n<td style=\"width: 171.016px;\">Bulbs of vestibule</td>\n</tr>\n<tr>\n<td style=\"width: 170.996px;\">\n<p>Perineal nerve branches:</p>\n<ul>\n<li>Posterior scrotum</li>\n<li>Bulb of penis</li>\n</ul>\n</td>\n<td style=\"width: 170.996px;\">Perineal nerve: muscular branches</td>\n<td style=\"width: 171.016px;\">\n<p>Perineal nerve branches:</p>\n<ul>\n<li>Labia</li>\n<li>Bulbs of vestibule</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170.996px;\">\n<p>Perineal artery branches:</p>\n<ul>\n<li>Posterior scrotal artery</li>\n<li>Branches of the penile artery</li>\n</ul>\n</td>\n<td style=\"width: 170.996px;\">\n<p>Perineal artery branches:&nbsp;</p>\n<ul>\n<li>Transverse perineal branch</li>\n</ul>\n</td>\n<td style=\"width: 171.016px;\">\n<p>Perineal artery branches:</p>\n<ul>\n<li>Posterior labial artery</li>\n<li>Branches of the clitoral artery</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 170.996px;\">The duct of the bulbourethral gland</td>\n<td style=\"width: 170.996px;\">&nbsp;</td>\n<td style=\"width: 171.016px;\">Greater vestibular gland and its ducts</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50dffd7383ee4187bea7fa602c798959x1280x1343.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a content of the deep perineal pouch?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal nerve of penis"
      },
      {
        "id": 2,
        "text": "Bulbourethral gland"
      },
      {
        "id": 3,
        "text": "Root of penis"
      },
      {
        "id": 4,
        "text": "Sphincter urethrae"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> root of the penis</strong>&nbsp;consists of two crura and one bulb. It is a content of the <strong>superficial</strong> <strong>perineal pouch</strong>.</p>\n<p>The <strong>deep perineal pouch</strong> is used to describe the space enclosed <strong>between</strong> the <strong>endopelvic fascia</strong> and the <strong>perineal membrane</strong> and includes the following contents:</p>\n<table style=\"height: 192px;\" width=\"574\">\n<tbody>\n<tr>\n<td style=\"width: 184.336px; text-align: center;\"><strong>Males</strong></td>\n<td style=\"width: 184.336px; text-align: center;\"><strong>Common to both</strong></td>\n<td style=\"width: 184.336px; text-align: center;\"><strong>Females&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 184.336px;\">Nerves: Dorsal nerve of penis&nbsp;</td>\n<td style=\"width: 184.336px;\">\n<p>Muscles:</p>\n<ul>\n<li>Deep transverse perinei</li>\n<li>Sphincter urethrae</li>\n</ul>\n</td>\n<td style=\"width: 184.336px;\">Nerves: Dorsal nerve of clitoris&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 184.336px;\">\n<p>Arteries:</p>\n<ul>\n<li>Penile artery</li>\n<li>Origin&nbsp; of the branches of the penile artery</li>\n</ul>\n</td>\n<td style=\"width: 184.336px;\">Arteries:&nbsp;\n<ul>\n<li>Origin of the urethral artery</li>\n</ul>\n</td>\n<td style=\"width: 184.336px;\">\n<p>Arteries:&nbsp;</p>\n<ul>\n<li>Clitoral artery</li>\n<li>Origin&nbsp; of the branches of the artery of clitoris</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 184.336px;\">Bulbourethral glands</td>\n<td style=\"width: 184.336px;\">Urethra</td>\n<td style=\"width: 184.336px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d37394b81ec41b291dfd93e2621fbbbx1280x1343.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles is not involved in the formation of the perineal body?",
    "choices": [
      {
        "id": 1,
        "text": "Bulbospongiosus muscle"
      },
      {
        "id": 2,
        "text": "Superficial transverse perineal muscles"
      },
      {
        "id": 3,
        "text": "Deep transverse perineal muscles"
      },
      {
        "id": 4,
        "text": "Internal anal sphincter muscle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The internal anal sphincter is not involved in the formation of the perineal body.</p>\n<p>The <strong>perineal body</strong> is a <strong>fibromuscular structure</strong> present in the midline at the&nbsp;junction between the anal and urogenital triangle. It <strong>attaches to</strong> various muscles in the pelvis:</p>\n<ul>\n<li><strong>Anterior</strong> - superficial and deep transverse perinei, bulbospongiosus</li>\n<li><strong>Posterior</strong> - external anal sphincter&nbsp;</li>\n<li><strong>Superior</strong> - puborectalis, pubovaginalis and the rectovaginal septum&nbsp;</li>\n</ul>\n<p>It is continuous with the perineal membrane and the superficial perineal fascia. In <strong>males,</strong> it continues as the<strong> perineal raphe</strong>, and in <strong>females,</strong> it is attached to the <strong>posterior commissure</strong> and the <strong>introitus.</strong>&nbsp;</p>\n<p>The following image shows the perineal body and its muscular attachments.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eddef80a0bc84c469de46bb57a35da68x1280x788.JPEG"
    ]
  },
  {
    "text": "A surgeon is dissecting the ischioanal fossa in a patient with anal cancer. Which of the following statements is correct about its boundaries?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior boundary is the perineal membrane"
      },
      {
        "id": 2,
        "text": "Anterior boundary is the sacrotuberous ligament"
      },
      {
        "id": 3,
        "text": "Lateral boundary is the obturator internus"
      },
      {
        "id": 4,
        "text": "Medial boundary is the gluteus maximus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>lateral boundaries</strong> of the ischioanal fossa are formed by&nbsp;<strong>obturator internus</strong>(with its<strong> fascia</strong>).</p>\n<p>The ischioanal fossa is a <strong>wedge-shaped</strong> space on either side of the anal canal in the anorectal triangle. It has a <strong>pad of fat</strong>. The boundaries include:</p>\n<ul>\n<li><strong>Anterior</strong>: Posterior border of perineal membrane</li>\n<li><strong>Posterior</strong>: Gluteus maximus muscle, Sacrotuberous ligament</li>\n<li><strong>Lateral</strong>: Ischial tuberosity, Obturator internus</li>\n<li><strong>Medial</strong>: Sphincter ani externus, Pelvic diaphragm (levator ani).</li>\n</ul>\n<p><strong>Clinical significance</strong>:</p>\n<p>Ischioanal fossa provides a relatively <strong>bloodless field during resection</strong> of anal cancers, therefore it is an important surgical plane.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a963b97e7bca4d13b469e2f8af0a1615x599x583.JPEG"
    ]
  },
  {
    "text": "The fascia of which of the following muscles is involved in the formation of the Alcock's canal?",
    "choices": [
      {
        "id": 1,
        "text": "Levator ani"
      },
      {
        "id": 2,
        "text": "Obturator internus"
      },
      {
        "id": 3,
        "text": "External anal sphincter"
      },
      {
        "id": 4,
        "text": "Gluteus minimus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>Alcock's</strong> (pudendal)&nbsp;<strong>canal</strong>&nbsp;is formed by the <strong>fascia</strong> of the <strong>obturator internus</strong> muscle.</p>\n<p>It is formed by connective tissue binding the vessels and nerve to the medial surface of the fascia covering obturator internus.</p>\n<p><strong>Contents of the pudendal canal:</strong></p>\n<ul>\n<li>Internal pudendal artery and vein</li>\n<li>Pudendal nerve</li>\n</ul>\n<p><strong>Clinical significance:</strong></p>\n<ul>\n<li>Infiltration of a local anesthetic around the trunk of the pudendal nerve at the level of the ischial spine results in analgesia of the lower vagina, posterior perineum, and vulva.&nbsp;</li>\n<li>Pudendal neuralgia can occur due to compression of pudendal nerve in the pudendal canal.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '53 Pelvis & Perineum';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>