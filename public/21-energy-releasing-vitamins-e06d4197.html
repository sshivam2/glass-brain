<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21 Energy Releasing Vitamins - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Biochemistry
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following multienzyme complexes catalyzing decarboxylation reactions does not require thiamine as a coenzyme?",
    "choices": [
      {
        "id": 1,
        "text": "Pyruvate dehydrogenase"
      },
      {
        "id": 2,
        "text": "\u03b1-ketoglutarate dehydrogenase"
      },
      {
        "id": 3,
        "text": "Branched-chain keto-acid dehydrogenase"
      },
      {
        "id": 4,
        "text": "Isocitrate dehydrogenase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Thiamine pyrophosphate</strong> (TPP) does not serve as the coenzyme for <strong>isocitrate dehydrogenase</strong>.\u00a0</p>\n<p>Isocitrate dehydrogenase, an enzyme of the citric acid cycle, uses <strong>Mg<sup>2+</sup></strong> or <strong>Mn<sup>2+</sup></strong> ions as a coenzyme.\u00a0</p>\n<p><strong>Thiamine</strong> pyrophosphate (TPP), from vitamin B1, serves as the coenzyme for three multienzyme complexes that catalyze oxidative decarboxylation reactions:</p>\n<ul>\n<li><strong>Pyruvate dehydrogenase</strong>\u00a0- carbohydrate metabolism</li>\n<li><strong>\u03b1-ketoglutarate dehydrogenase</strong> - citric acid cycle</li>\n<li><strong>Branched-chain keto-acid dehydrogenase</strong> - metabolism of leucine, isoleucine, valine</li>\n</ul>\n<p>Most of these enzymes are involved in carbohydrate metabolism, so thiamine is required in excess during a high carbohydrate diet. TPP also serves as the cofactor for <strong>transketolase</strong> in the <strong>HMP shunt.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following  co-enzyme deficiencies makes a patient prone to lactic acidosis?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine"
      },
      {
        "id": 2,
        "text": "Riboflavin"
      },
      {
        "id": 3,
        "text": "Biotin"
      },
      {
        "id": 4,
        "text": "Niacin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Thiamine</strong> (Vitamin B1)<strong>\u00a0deficiency</strong> makes a patient prone to<strong> lactic acidosis</strong>.</p>\n<p><strong>Thiamine pyrophosphate</strong> (TPP) serves as a coenzyme for the <strong>pyruvate dehydrogenase</strong> enzyme. In a state of thiamine deficiency, there is an impaired conversion of pyruvate to acetyl CoA. When the patient consumes a<strong> high carbohydate diet</strong>, there is thus an accumulation of pyruvate. Pyruvate then gets converted into lactate by the enzyme <strong>lactate dehydrogenase.\u00a0</strong>This results in increased plasma concentrations of lactate and pyruvate, leading to a state of <strong>lactic acidosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the reason behind decreased energy production in thiamine deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "It is required for transamination reactions"
      },
      {
        "id": 2,
        "text": "It is the coenzyme for pyruvate dehydrogenase"
      },
      {
        "id": 3,
        "text": "It is the coenzyme for transketolase"
      },
      {
        "id": 4,
        "text": "It is required in the process of oxidative reduction"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Decreased energy production</strong> is seen in <strong>thiamine deficiency</strong>\u00a0because it acts as a <strong>coenzyme</strong> for<strong> pyruvate dehydrogenase\u00a0</strong>and\u00a0\u03b1-ketoglutarate dehydrogenase.</p>\n<p>Both pyruvate dehydrogenase and \u03b1-ketoglutarate dehydrogenase are required for the production of <strong>NADH</strong>, which is used for ATP production. In <strong>thiamine deficiency</strong>, the\u00a0reaction catalyzed by pyruvate dehydrogenase cannot go forward. Hence, there is <strong>no formation</strong> of<strong> acetyl CoA</strong>, causing decreased substrate for the citric acid cycle. As a result, energy (ATP) production is grossly reduced and instead, <strong>lactic acidosis</strong> is seen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man with chronic alcoholism presented with orthopnea and pedal edema. On investigation, cardiomegaly is noted. Which vitamin deficiency can lead to this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B1"
      },
      {
        "id": 2,
        "text": "Vitamin B2"
      },
      {
        "id": 3,
        "text": "Vitamin B5"
      },
      {
        "id": 4,
        "text": "Vitamin B6"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Cardiac failure (orthopnea and pedal edema) and cardiomegaly in a patient with chronic alcoholism suggest a diagnosis of <strong>wet\u00a0beriberi.</strong>\u00a0<strong>Thiamine\u00a0</strong>(vitamin B1)\u00a0<strong>deficiency</strong> leads to this condition.\u00a0</p>\n<p><strong>Chronic alcohol consumption</strong> is associated with thiamine deficiency due to inadequate dietary intake, malabsorption of thiamine from the gastrointestinal tract and impaired utilization of thiamine in the cells. This deficiency presents as:</p>\n<ol>\n<li><strong>Wet beriberi: </strong>The <strong>cardiovascular system</strong> is affected. Patients present with high output cardiac failure (orthopnea, pedal edema), dyspnea, cardiomegaly, and pulmonary edema.</li>\n<li><strong>Dry beriberi: </strong>Both the <strong>peripheral</strong> and<strong> central nervous</strong> <strong>systems</strong> are affected. Patients present with symmetric motor and sensory neuropathy (pain, paresthesia, loss of reflexes) especially in lower limbs. In severe cases, muscle atrophy may also be seen.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following enzyme activity assays can be used for the diagnosis of a patient with suspected thiamine deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "Pyruvate dehydrogenase"
      },
      {
        "id": 2,
        "text": "Erythrocyte transketolase"
      },
      {
        "id": 3,
        "text": "\u03b1-ketoglutarate dehydrogenase"
      },
      {
        "id": 4,
        "text": "RBC glutathione reductase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Erythrocyte transketolase activity </strong>can be<strong> </strong>measured to diagnose <strong>thiamine deficiency.\u00a0</strong></p>\n<p><strong>Thiamine pyrophosphate </strong>(TPP)\u00a0is the\u00a0<strong>cofactor</strong> of erythrocyte transketolase, which is involved in the non-oxidative phase of the <strong>HMP pathway.</strong> In thiamine or vitamin B1 deficiency, the value of erythrocyte transketolase activity will be <strong>decreased.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged man with a history of chronic alcohol comsuption presented to the casualty with confusion, ataxia and diplopia. What is the protocol to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine injection followed by glucose infusion"
      },
      {
        "id": 2,
        "text": "Glucose infusion followed thiamine injection"
      },
      {
        "id": 3,
        "text": "Glucose infusion alone"
      },
      {
        "id": 4,
        "text": "Thiamine injection alone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Diplopia, ataxia and confusion in a patient with chronic alcohol consumption\u00a0 is suggestive of <strong>Wernicke's\u00a0encephalopathy.\u00a0</strong>The current standard of treatment for patients with symptoms of Wernicke's encephalopathy is to give<strong>\u00a0thiamine 100 mg intravenously before</strong> administering<strong> glucose-containing</strong>\u00a0IV<strong> fluids.</strong></p>\n<p>Thiamine deficiency\u00a0leads to the following:</p>\n<ol>\n<li><strong>Wernicke\u2019s encephalopathy:\u00a0</strong>It is more commonly seen in alcoholics with chronic thiamine deficiency. It is characterized by global confusion, truncal ataxia, ophthalmoplegia and horizontal nystagmus.</li>\n<li><strong>Korsakoff psychosis:</strong> Symptoms in addition to those of Wernicke's encephalopathy include memory loss and <strong>confabulation</strong></li>\n<li><strong>Beriberi:\u00a0</strong>It can be either -\n<ul>\n<li><strong>Dry</strong> beriberi: Sensorimotor peripheral neuropathy, muscle weakness</li>\n<li><strong>Wet</strong> beriberi: Tachycardia, cardiomegaly, high-output cardiac failure</li>\n</ul>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "FMN and FAD coenzymes are derived from which of the following vitamin?",
    "choices": [
      {
        "id": 1,
        "text": "Niacin"
      },
      {
        "id": 2,
        "text": "Vitamin B1"
      },
      {
        "id": 3,
        "text": "Riboflavin"
      },
      {
        "id": 4,
        "text": "Vitamin B5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Coenzymes<strong> flavin mononucleotide</strong> (FMN)<strong> </strong>and <strong>flavin adenine dinucleotide</strong> (FAD) are\u00a0derived from <strong>riboflavin </strong>(vitamin B2).</p>\n<p>FMN-coenzyme is part of <strong>complex I</strong> (also known as NADH-Q oxidoreductase, NADH dehydrogenase) in <strong>electron transport chain </strong>(ETC). \u00a0It also acts as a coenzyme for <strong>L-amino acid oxidase.\u00a0</strong></p>\n<p>FAD-coenzyme is part of <strong>complex II</strong> in ETC. It acts as a coenzyme for <strong>succinate dehydrogenase </strong>(Kreb's cycle), <strong>acyl CoA dehydrogenase</strong> (fatty acid oxidation), <strong>D-amino acid oxidase</strong> and <strong>xanthine oxidase</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young lady presented with a tingling sensation in her legs and hands. On examination, she had fissured tongue, lips, and lesions in the angle of the mouth. On investigation, she had low RBC glutathione reductase activity. Which vitamin is most likely deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B12"
      },
      {
        "id": 2,
        "text": "Vitamin B3"
      },
      {
        "id": 3,
        "text": "Niacin"
      },
      {
        "id": 4,
        "text": "Riboflavin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Tingling sensation of legs and hands, fissured tongue and lips, and lesions in the angle of the mouth combined with low RBC glutathione reductase activity is consistent with <strong>riboflavin </strong>(vitamin B<sub>2</sub>)\u00a0<strong>deficiency.</strong></p>\n<p>Deficiency state of riboflavin, a water soluble vitamin, is characterized by the following signs and symptoms:</p>\n<ol>\n<li><strong>Cheilosis</strong>: Pallor in the angle of mouth and fissuring of lips, which extends radially to skin</li>\n<li><strong>Glossitis:</strong> Tongue becomes smooth, loss of papilla causing<strong> magenta-colored tongue</strong></li>\n<li><strong>Eyes: </strong>Keratitis, conjunctivitis and<strong>\u00a0corneal vascularisation</strong></li>\n<li><strong>Other features:\u00a0</strong>Seborrheic dermatitis, anemia</li>\n</ol>\n<p>The\u00a0<strong>nutritional status </strong>of riboflavin can be assessed by<strong> measuring</strong>\u00a0the activity of the\u00a0<strong>RBC glutathione reductase,</strong> by FAD added in vitro. This test is specific for riboflavin deficiency.</p>\n<p>The image below shows cheilosis and stomatitis due to riboflavin deficiency.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20d4bfe5b5604b788088095473bf9cf4x720x480.JPEG"
    ]
  },
  {
    "text": "A man presents with rashes around the neck, as shown in the image below. Dietary history reveals that he has consumed jowar for a long duration. Which vitamin is most likely deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin B5"
      },
      {
        "id": 2,
        "text": "Vitamin B1"
      },
      {
        "id": 3,
        "text": "Vitamin B3"
      },
      {
        "id": 4,
        "text": "Vitamin B7"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A patient with high intake of jowar and characteristic <strong>Casal\u2019s necklace</strong> pattern rash is most likely suffering from\u00a0<strong>pellagra.\u00a0</strong>It is caused due to a <strong>deficiency</strong> of<strong> vitamin B3</strong>, known as niacin.</p>\n<p>Pellagra, or niacin deficiency, presents with 3 classical Ds - <strong>dermatitis</strong> (photosensitive), <strong>diarrhea</strong> and<strong> dementia.</strong> Patients often have the <strong>Casal collar</strong> or <strong>Casal necklace</strong>. It is a clinical sign in which there is an erythematous pigmented skin rash in the distribution of a broad collar (dermatomes C3 and C4). If left untreated, pellagra leads to the 4th D of <strong>death</strong>.\u00a0</p>\n<p><strong>Jowar </strong>(sorghum)\u00a0has\u00a0<strong>high leucine</strong> content. This <strong>inhibits QPRTase</strong>, an enzyme responsible for the synthesis of niacin from amino acid tryptophan. Excessive consumption of <strong>maize-based diets</strong> can also cause pellagra due to their low levels of niacin and tryptophan.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/30ff0d9d269e43b3a480077d5a0d6024.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A farmer presents with loose stools, depression, and photosensitive dermatitis as shown in the image. On examination, a red beefy tongue is noted. Which of the following is not associated with this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Hartnup disease"
      },
      {
        "id": 2,
        "text": "Carcinoid syndrome"
      },
      {
        "id": 3,
        "text": "Wernicke's encephalopathy"
      },
      {
        "id": 4,
        "text": "Pyridoxine deficiency"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Loose stools, depression, beefy red tongue and Casal's necklace, as seen in the image, is suggestive of <strong>pellagra.</strong> Pellagra-like symptoms are<strong> not seen</strong> in<strong> Wernicke's encephalopathy</strong>.</p>\n<p>Pellagra is caused by niacin deficiency, either due to<strong> dietary\u00a0deficiency</strong> or <strong>deficient conversion</strong> of tryptophan to niacin. Hence, pellagra-like symptoms are seen in:</p>\n<ul>\n<li><strong>Hartnup disease:</strong> It is an\u00a0<strong>a</strong><strong>utosomal recessive</strong> disease<strong>\u00a0</strong>caused by mutations in the <em>SLC6A19</em> gene leading to defective membrane transport of tryptophan across PCT (kidney) and enterocytes (intestine). This leads to malabsorption, and hence deficiency of tryptophan.</li>\n<li><strong>Carcinoid syndrome:</strong> Due to excess conversion of tryptophan to serotonin, there is a decreased level of tryptophan availavle for niacin synthesis</li>\n<li><strong>Pyridoxine deficiency:</strong> Pyridoxine is required as the co-factor of <strong>kynureninase</strong>, an enzyme in the pathway of niacin synthesis.</li>\n<li><strong>Maize/corn rich diet</strong>: In these grans, niacin is in bound form (niacytin form) and is not absorbed.</li>\n<li><strong>Jowar diet </strong>(Sorghum): The increased leucine content inhibits QPRTase enzyme, an enzyme in the pathway of niacin synthesis.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/20f0c68170c2437a8e235efe8000eed6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman with hypertriglyceridemia is considered for niacin therapy. She is a known diabetic managed adequately with sugars well under control. Why should niacin be used cautiously in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "It can cause hyperglycemia."
      },
      {
        "id": 2,
        "text": "It can cause scleroderma which makes injecting insulin difficult."
      },
      {
        "id": 3,
        "text": "It can increase the metabolism of oral hypoglyemic drugs."
      },
      {
        "id": 4,
        "text": "It can cause hypoglycemia."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Niacin</strong> should be used cautiously in diabetics as it can cause<strong>\u00a0hyperglycemia.</strong></p>\n<p>Niacin induces<strong> insulin resistance\u00a0</strong>and also<strong> decreases glucose-stimulated insulin secretion, </strong>which\u00a0may result in severe hyperglycemia. When niacin is prescribed for patients with known or suspected diabetes, blood glucose levels should be monitored at least once a week.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An alcoholic patient presented with itchy lesions as shown in the image, He also has a red-colored beefy tongue. Which of the following histories would you like to additionally ask/ elicit in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ask for diarrhea and history of memory loss"
      },
      {
        "id": 2,
        "text": "Ask for diarrhea, thiamine deficiency features, and detailed dietary history"
      },
      {
        "id": 3,
        "text": "History of allergy"
      },
      {
        "id": 4,
        "text": "Ask for diarrhea and conjunctivitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An alcoholic patient with a <strong>red-colored beefy tongue</strong>, itching and the characteristic <strong>Casal's necklace, </strong>shown in the image, is suggestive of <strong>pellagra.</strong> It is<strong> </strong>caused by <strong>niacin/vitamin B3 deficiency.</strong> Hence, one should ask for a <strong>history </strong>of <strong>diarrhea </strong>and<strong> memory loss</strong> in this case.</p>\n<p>Pellagra presents with\u00a0<strong>4 Ds: </strong>Diarrhea, Dermatitis, Dementia, and if untreated, Death. Early symptoms of pellagra are loss of appetite, generalized weakness and irritability, abdominal pain, and vomiting.<strong> </strong><strong>Photosensitive dermatitis </strong>is seen over sun-exposed areas. <strong>Diarrhea</strong> occurs due to proctitis or malabsorption. <strong>Bright red glossitis </strong>(beefy tongue) and <strong>Casal\u2019s necklace </strong>(a pigmented, scaly skin rash that forms a ring around the neck) follow. Depressive psychosis and dementia also commonly occur.</p>\n<p><strong>Corn/ maize/ jowar</strong> based diets are the main causes of niacin deficiency. Corn/maize lacks niacin and tryptophan. The excess leucine in jowar and maize disrupts the conversion of tryptophan to niacin. Niacin deficiency is also seen in alcoholism. Hence, additional histories of diarrhea and memory loss will aid in supporting the diagnosis of pellagra (along with dietary history).</p>\n<p><strong>Treatment</strong> includes\u00a0oral supplementation with 100\u2013200 mg of <strong>nicotinamide</strong> or <strong>nicotinic acid</strong> three times daily for 5 days.</p>\n<p>Option B: <strong>Thiamine deficiency</strong> (vitamin B1) features include CVS manifestations like heart failure and edema (wet beriberi), peripheral neuritis (dry beriberi), and Wernicke encephalopathy (in alcoholics).</p>\n<p>Option C: <strong>Dermatitis </strong>seen in pellagra is due to dietary deficiency of niacin and so allergy history is not relevant.</p>\n<p>Option D: <strong>Conjunctivitis</strong> is not a feature of niacin deficiency.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/745692850c3b4fa897e04261e4486ac0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A middle aged man comes for routine follow-up. His lipid profile shows hypercholesterolemia, hypertriglyceridemia, elevated LDL and VLDL. Which of the following vitamins can be used to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Riboflavin"
      },
      {
        "id": 2,
        "text": "Pantothenic acid"
      },
      {
        "id": 3,
        "text": "Nicotinic acid"
      },
      {
        "id": 4,
        "text": "Pyridoxine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A man with hypercholesterolemia, hypertriglyceridemia, elevated LDL and VLDL should be treated with a <strong>lipid-lowering agent.</strong> Thus, the vitamin that can be used to treat this patient is <strong>nicotinic acid</strong> (niacin or vitamin B3).</p>\n<p>Niacin causes a <strong>reduction</strong> in<strong> LDL, VLDL</strong>\u00a0and<strong> triglycerides</strong> along with <strong>increasing\u00a0HDL</strong>. It is the only lipid-lowering agent that <strong>lowers lipoprotein (a)</strong> levels significantly. The main adverse effect of niacin is cutaneous <strong>flushing </strong>and<strong> pruritus.</strong> It can be controlled by <strong>pre-treatment </strong>with<strong> aspirin.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient is prescribed niacin for treating his hyperlipidemia. All of the following statements about this drug are true except:",
    "choices": [
      {
        "id": 1,
        "text": "It inhibits lipolysis in adipose tissue"
      },
      {
        "id": 2,
        "text": "It causes a reduction in the liver TAG synthesis"
      },
      {
        "id": 3,
        "text": "It reduces the level of HDL"
      },
      {
        "id": 4,
        "text": "It reduces the level of LDL"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Niacin <strong>increases</strong>\u00a0the level of <strong>HDL.</strong></p>\n<p>Niacin (vitamin B3) is known to <strong>inhibit lipolysis</strong> within the adipose tissue. Hence, the circulating <strong>free fatty acids</strong> (FFAs) are <strong>reduced</strong>. The liver normally uses these circulating FFAs as a precursor in the synthesis of <strong>triacylglycerol </strong>(TAG)<strong>.\u00a0</strong>As a result, niacin causes a reduction in liver TAG synthesis. TAGs are in turn required for very low density lipoprotein (VLDL) and low density lipoprotein (LDL) synthesis. Therefore both plasma VLDL and LDL values are reduced. Overall,<strong> </strong>niacin <strong>decreases LDL, VLDL</strong> and <strong>TAG levels</strong>,<strong> </strong>and<strong> increases high-density lipoprotein</strong> (HDL) <strong>levels</strong>. Thus it is particularly useful in the treatment of <strong>type IIb hyperlipoproteinemia</strong>, in which both VLDL and LDL are elevated.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vitamins constitutes a part of the coenzyme A?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine"
      },
      {
        "id": 2,
        "text": "Riboflavin"
      },
      {
        "id": 3,
        "text": "Pantothenic acid"
      },
      {
        "id": 4,
        "text": "Pyridoxine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Pantothenic acid</strong> constitutes a part of the <strong>coenzyme A</strong>.</p>\n<p>The primary function of coenzyme A (pantothenic acid) is to transfer <strong>acyl groups. </strong>Pantothenic acid as coenzyme A is involved in:</p>\n<ul>\n<li>Fatty acid oxidation</li>\n<li>TCA cycle (as succinyl Co-A and acetyl Co-A)</li>\n<li>Cholesterol synthesis (as HMG Co-A)</li>\n<li>Acetylation reactions</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Burning feet syndrome is caused by a particular vitamin deficiency. Which of the following amino acids is contained in this vitamin?",
    "choices": [
      {
        "id": 1,
        "text": "Phenylalanine"
      },
      {
        "id": 2,
        "text": "Arginine"
      },
      {
        "id": 3,
        "text": "Beta-alanine"
      },
      {
        "id": 4,
        "text": "Tryptophan"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The vitamin that is deficient in <strong>burning feet syndrome</strong> is <strong>vitamin B5</strong> (pantothenic acid) which contains the amino acid <strong>beta-alanine.</strong></p>\n<p><strong>Pantothenic acid deficiency</strong> is rarely seen as the vitamin is abundantly found in food (egg yolks, whole frains, vegetables). <strong>Burning feet syndrome</strong> is classically seen in pantothenic acid deficiency. The other symptoms of pantothenic deficiency are <strong>non-specific</strong> and include GI disturbances, paraesthesia, muscle cramps and ataxia.\u00a0</p>\n<p>Beta-alanine is an amino acid seen in:</p>\n<ul>\n<li style=\"font-weight: 400;\">Pantothenic acid (vitamin B5)</li>\n<li style=\"font-weight: 400;\">Coenzyme A</li>\n<li style=\"font-weight: 400;\">Carnosine</li>\n<li style=\"font-weight: 400;\">Anserine</li>\n<li style=\"font-weight: 400;\">Acyl carrier protein</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following vitamins serves as a cofactor in carboxylation reactions?",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine"
      },
      {
        "id": 2,
        "text": "Riboflavin"
      },
      {
        "id": 3,
        "text": "Pyridoxine"
      },
      {
        "id": 4,
        "text": "Biotin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Biotin </strong>serves as an important<strong> cofactor</strong> in\u00a0<strong>carboxylation reactions</strong></p>\n<p>Biotin (vitamin B7) functions as a carrier for the <strong>activated carbon dioxide </strong>molecule in carboxylation reactions. The enzymes using biotin as a cofactor are <strong>acetyl CoA carboxylase</strong>, pyruvate carboxylase, propionyl CoA carboxylase and methyl crotonyl CoA carboxylase.</p>\n<p>Malic enzyme and carbomyl phosphate synthetase I and II do not use biotin as a coenzyme.<strong> Gamma carboxylation</strong> by vitamin K is also <strong>biotin-independent.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old bodybuilder presented with fatigue on moderate exercise. He had recently started eating raw eggs for protein. Which of the following enzymes is likely deficient in him?",
    "choices": [
      {
        "id": 1,
        "text": "Glucose-6-phosphatase"
      },
      {
        "id": 2,
        "text": "Glycogen phosphorylase"
      },
      {
        "id": 3,
        "text": "Pyruvate carboxylase"
      },
      {
        "id": 4,
        "text": "Phosphoenolpyruvate carboxykinase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient developed <strong>pyruvate carboxylase</strong> enzyme <strong>deficiency.</strong></p>\n<p>Individuals who eat an excess of <strong>uncooked</strong> <strong>egg-white</strong>\u00a0develop <strong>biotin deficiency</strong> and as a result carboxylase enzyme deficiency. This is because a protein called <strong>avidin</strong> present in the egg-white<strong> binds </strong>to<strong> biotin</strong> in the diet and makes biotin unavailable for intestinal absorption.\u00a0Biotin deficiency can cause <strong>dermatitis</strong>, mental status changes (depression, hallucinations), paraesthesia and alopecia.</p>\n<p>Biotin serves as a co-enzyme for the synthesis of several carboxylase enzymes such as acetyl-CoA carboxylase, <strong>pyruvate carboxylase</strong>, propionyl CoA carboxylase and methylcrotonyl-CoA carboxylase. Thus these enzymes are deficient in biotin deficiency.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Vitamin B12 is found maximum in:",
    "choices": [
      {
        "id": 1,
        "text": "Animal products"
      },
      {
        "id": 2,
        "text": "Green leafy vegetables"
      },
      {
        "id": 3,
        "text": "Roots and tubers"
      },
      {
        "id": 4,
        "text": "Vegetarian diet"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Vitamin B12</strong> is found maximum in<strong> animal products.</strong></p>\n<p>Vitamin B12 or <strong>cobalamin</strong> is synthesized <strong>only</strong> by <strong>microorganisms</strong>. Thus, the only source of cobalamin for humans is animal products. It is<strong> not found</strong> in <strong>plant</strong> sources. Therefore, individuals who are <strong>strict vegetarians</strong> are usually at the <strong>risk</strong> of developing vitamin B12 <strong>deficiency.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which vitamin, when infused in supraphysiological doses, causes macular edema and macular cysts?",
    "choices": [
      {
        "id": 1,
        "text": "Vitamin A"
      },
      {
        "id": 2,
        "text": "Vitamin D"
      },
      {
        "id": 3,
        "text": "Vitamin E"
      },
      {
        "id": 4,
        "text": "Vitamin B3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Macular cysts</strong> and <strong>edema</strong> may develop in patients due to the infusion of <strong>supraphysiological doses</strong> of\u00a0<strong>vitamin B3 </strong>(niacin\u00a0toxicity).</p>\n<p>The<strong> toxic effects</strong> of niacin include:</p>\n<ul>\n<li><strong>Flushing</strong>\u00a0associated with skin dryness, itching, paresthesia, and headache is seen. These effects\u00a0may be seen with even a low dose of 30mg/day. <strong>Pre-medication</strong> with<strong> aspirin alleviates</strong> these symptoms as these symptoms are mediated by <strong>prostaglandins.</strong></li>\n<li><strong>Macular edema </strong>and <strong>macular cysts</strong></li>\n<li>Nausea, vomiting, and abdominal pain.</li>\n<li>Hepatic toxicity presents as jaundice with elevated AST and ALT levels.</li>\n<li>Fulminant hepatitis requiring liver transplantation.</li>\n<li>Glucose intolerance</li>\n<li>Hyperuricemia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '21 Energy Releasing Vitamins';
        let hierarchy = ["Marrow", "qBank", "Biochemistry"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>