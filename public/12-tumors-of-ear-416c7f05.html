<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12 Tumors Of Ear - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / ENT
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">27</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the most common site for ear carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Cartilaginous external auditory meatus"
      },
      {
        "id": 2,
        "text": "Isthmus of canal"
      },
      {
        "id": 3,
        "text": "Pinna"
      },
      {
        "id": 4,
        "text": "Mastoid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>most common</strong> site for ear carcinoma is the <strong>pinna</strong>, followed by the external auditory meatus, the middle ear, and mastoid.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where are sebaceous cysts most commonly located in the ear?",
    "choices": [
      {
        "id": 1,
        "text": "Helix"
      },
      {
        "id": 2,
        "text": "Cymba concha"
      },
      {
        "id": 3,
        "text": "Pre auricular area"
      },
      {
        "id": 4,
        "text": "Post auricular area"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most common</strong> site of a sebaceous cyst is<strong> postauricular sulcus</strong> or below and behind the ear lobule. Treatment is total surgical excision.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is shown in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Dermoid cyst"
      },
      {
        "id": 2,
        "text": "Sebaceous cyst"
      },
      {
        "id": 3,
        "text": "Meningioma"
      },
      {
        "id": 4,
        "text": "Post auricular fistula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows a <strong>dark-colored summit</strong> over a <strong>swelling</strong>, usually seen in a <strong>sebaceous cyst</strong>.</p>\n<p><strong>Sebaceous cysts</strong> are the<strong> retention cysts</strong> of the <strong>sebaceous gland </strong>that are usually present on the<strong> face, scalp, or scrotum</strong>. They contain<strong> yellowish-white cheesy</strong> material with fat and epithelium.</p>\n<p>Clinical features:&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The swelling is <strong>painless</strong>, soft, and <strong>freely mobile</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Though <strong>non-transilluminating</strong>, they are Paget's test positive <strong>(fluctuant)</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Punctum</strong> is seen in <strong>70%</strong> of the patients with sebaceous cysts. They are <strong>dark</strong> in color due to the accumulation of<strong> denuded epithelium.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">They also have an <strong>unpleasant sebum odor</strong>.</li>\n<li aria-level=\"1\">The swelling can <strong style=\"font-weight: 400;\">ulcerate</strong> and become <strong style=\"font-weight: 400;\">painful</strong> <strong style=\"font-weight: 400;\">(</strong><strong>Cock&rsquo;s peculiar tumor</strong><strong style=\"font-weight: 400;\">).</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Some cysts over the scalp may also harden over time (<strong>Sebaceous horn</strong>).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Many may get <strong>infected</strong> and lead to <strong>abscess</strong> formation.</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Excision including skin adjacent to punctum using elliptical incision-dissection method.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Incision and avulsion of cyst wall.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">In the presence of an <strong>abscess</strong>, an initial treatment with an <strong>incision</strong> later followed by <strong>excision</strong> of the cyst</li>\n</ul>\n<p>Other options:</p>\n<p>Option A: <strong>Dermoid cysts</strong> present as <strong>firm</strong> <strong>painless</strong> subcutaneous nodules and are of 4 types:</p>\n<ol>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Sequestration dermoid - sequestration of epithelium during embryological development</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Tubulodermoid - accumulation of secretions from ectodermal tube/duct</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Implantation dermoid - implantation of the epidermis due to trauma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Teratomatous dermoid - having all 3 germ layers (ecto, meso, and endoderm)</li>\n</ol>\n<p>Option C: <strong>Meningiomas</strong> are <strong>benign</strong> tumors arising from the <strong>meningothelial cells</strong> of the <strong>dura</strong>. They present with <strong>headaches</strong>, <strong>seizures</strong>, or focal neurological deficits.</p>\n<p>Option D: <strong>Postauricular</strong> <strong>cutaneous</strong> <strong>mastoid</strong> <strong>fistula</strong> is a rare complication of <strong>chronic</strong> <strong>otitis</strong> <strong>media</strong> that heals very slowly and needs <strong>surgical</strong> <strong>closure</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1f3cc2f6a26f4f63955b0cf603ca5203.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A surfer presented with hearing loss and a feeling of fullness in his ear. On otoscopy, multiple bony swellings were present in the external auditory canal. Which of the following features is diagnostic of exostosis?",
    "choices": [
      {
        "id": 1,
        "text": "Unilateral"
      },
      {
        "id": 2,
        "text": "Irregular"
      },
      {
        "id": 3,
        "text": "Sessile"
      },
      {
        "id": 4,
        "text": "Seen in cartilaginous canal"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Exostoses</strong> are <strong>bilateral, multiple, smooth, sessile bony</strong> swellings in the deeper canal seen in divers/swimmers and surfers. It is also called as&nbsp;<strong>s</strong><strong>urfer&rsquo;s ear</strong>.</p>\n<table>\n<tbody>\n<tr>\n<td width=\"199\">\n<p><strong>Osteoma</strong></p>\n</td>\n<td width=\"208\">\n<p><strong>Exostosis/Surfer's Ear</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"199\">\n<p>Single</p>\n</td>\n<td width=\"208\">\n<p>Multiple</p>\n</td>\n</tr>\n<tr>\n<td width=\"199\">\n<p>Unilateral</p>\n</td>\n<td width=\"208\">\n<p>Bilateral</p>\n</td>\n</tr>\n<tr>\n<td width=\"199\">\n<p>Pedunculated, hard</p>\n</td>\n<td width=\"208\">\n<p>Sessile, smooth</p>\n</td>\n</tr>\n<tr>\n<td width=\"199\">\n<p>Outer canal</p>\n</td>\n<td width=\"208\">\n<p>Inner, deeper canal</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presents with foul-smelling ear discharge and hearing loss for 1 year. On examination, a hemorrhagic polypoidal mass was seen in the middle ear. Biopsy revealed squamous cell carcinoma of the middle ear. Where is it least likely to spread to?",
    "choices": [
      {
        "id": 1,
        "text": "Dura"
      },
      {
        "id": 2,
        "text": "Facial canal"
      },
      {
        "id": 3,
        "text": "Eustachian tube"
      },
      {
        "id": 4,
        "text": "Petrous apex"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Squamous cell carcinoma</strong> is least likely to spread to the <strong>dura,</strong> as it is <strong>resistant</strong> to invasion.</p>\n<p>It commonly affects <strong>middle-aged women.</strong> Other clinical features include-</p>\n<ul>\n<li>Chronic<strong> foul-smelling </strong>discharge that is usually <strong>blood-stained</strong>.</li>\n<li>Friable, <strong>hemorrhagic granulations</strong></li>\n<li>Polyp</li>\n<li>Hearing loss</li>\n</ul>\n<p>It usually spreads to</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ossicles</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Facial canal</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Internal ear</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Jugular bulb &amp; carotid artery</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Petrous pyramid</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Parotid &amp; temporomandibular joint</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Eustachian tube, Nasopharynx &amp; Infratemporal fossa.</li>\n</ul>\n<p>Lymph node involvement is a late finding.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common benign tumor of the middle ear?",
    "choices": [
      {
        "id": 1,
        "text": "Glomus tumour"
      },
      {
        "id": 2,
        "text": "Acoustic neuroma"
      },
      {
        "id": 3,
        "text": "Exostosis"
      },
      {
        "id": 4,
        "text": "Osteoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Glomus tumor </strong>is the <strong>most common</strong> <strong>benign</strong> neoplasm of the middle ear and is so-named because of its origin from the glomus bodies.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A post-menopausal woman with progressive hearing loss and tinnitus is diagnosed to have a glomus tumor. Which cells do her tumor originate from?",
    "choices": [
      {
        "id": 1,
        "text": "Perivascular cells"
      },
      {
        "id": 2,
        "text": "Peritubal cells"
      },
      {
        "id": 3,
        "text": "Paraganglionic cells"
      },
      {
        "id": 4,
        "text": "Paraneoplastic cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Glomus tumors</strong>&nbsp;originate from&nbsp;<strong>paraganglionic cells</strong>&nbsp;that are derived from neural crest cells. They are found in&nbsp;<strong>glomus bodies</strong> present in the dome of the jugular bulb or promontory.&nbsp;</p>\n<p>These cells are found in 2 sites giving rise to 2 similar yet distinct clinical tumors:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Glomus jugulare</strong>: in the <strong>jugular bulb</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Glomus tympanicum</strong>: over the <strong>promontory</strong> along Jacobson&rsquo;s nerve(<strong>IX nerve</strong>).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is false about paragangliomas of the head and neck?",
    "choices": [
      {
        "id": 1,
        "text": "Slow growing tumor"
      },
      {
        "id": 2,
        "text": "More common in men"
      },
      {
        "id": 3,
        "text": "Usually seen in middle age"
      },
      {
        "id": 4,
        "text": "Highly vascular tumour"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Paragangliomas</strong> of the head and neck, also known as <strong>glomus tumors</strong>, affect <strong>women</strong> more than men.</p>\n<p>Glomus tumors are <strong>benign, non-encapsulated</strong> but <strong>vascular</strong>. They are extremely <strong>slow-growing, locally invasive</strong>, and often seen in <strong>middle age</strong> (40\u201350 years).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the earliest symptom of glomus tumors?",
    "choices": [
      {
        "id": 1,
        "text": "Sensory-neural deafness"
      },
      {
        "id": 2,
        "text": "Headache"
      },
      {
        "id": 3,
        "text": "Tinnitus"
      },
      {
        "id": 4,
        "text": "Vertigo"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Earliest symptoms of glomus tumor are <strong>tinnitus and hearing loss</strong>.</p>\n<p>Hearing loss is <strong>conductive</strong> and slowly progressive.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are a junior resident in the ENT department. A patient presents to you with pulsatile tinnitus. Which of the following will be your first differential diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "CSOM"
      },
      {
        "id": 2,
        "text": "ASOM"
      },
      {
        "id": 3,
        "text": "Mastoiditis"
      },
      {
        "id": 4,
        "text": "Glomus tumour"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Glomus tumour</strong>&nbsp;will be your first differential diagnosis.&nbsp;<strong>Tinnitus</strong> in glomus tumors is:</p>\n<ul>\n<li><strong>Pulsatile</strong></li>\n<li>Of swishing character</li>\n<li>Synchronous with pulse and</li>\n<li>Can be temporarily stopped by carotid pressure.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are evaluating a patient with a glomus tumor and on otoscopy, see the following image. Which of the following signs is seen here?",
    "choices": [
      {
        "id": 1,
        "text": "Cartwheel appearance"
      },
      {
        "id": 2,
        "text": "Lighthouse sign"
      },
      {
        "id": 3,
        "text": "Rising sun sign"
      },
      {
        "id": 4,
        "text": "Schwartze sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Rising sun</strong>&nbsp;sign is seen here, as it is a case of <strong>glomus tumor.</strong> The rising sun appearance is seen when a tumor arises from the<strong> floor of the middle ear</strong>. Otoscopy shows a <strong>red reflex</strong> through an <strong>intact tympanic membrane.&nbsp;</strong></p>\n<p>Option A - Cartwheel appearance is the leash of blood vessels appear along the handle of malleus and at the periphery of tympanic membrane.</p>\n<p>Option B - Lighthouse sign is a pulsatile discharge from a pin-hole perforation of pars tensa seen in mastoiditis.&nbsp;</p>\n<p>Option D - Schwartze sign is the reddish hue seen on the promontory through the tympanic membrane in otosclerosis.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/88ad58a638db4ef08d482215314f57f7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/13d81baadd69456bb1eb28a2005c592ax1280x1268.JPEG"
    ]
  },
  {
    "text": "While evaluating a patient with a suspected aural polyp, you apply Siegel's speculum and observe that the mass pulsates vigorously and then blanches. What is this sign called?",
    "choices": [
      {
        "id": 1,
        "text": "Rising sun sign"
      },
      {
        "id": 2,
        "text": "Schwarze's sign"
      },
      {
        "id": 3,
        "text": "Lighthouse sign"
      },
      {
        "id": 4,
        "text": "Brown's sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The sign is called <strong>Brown&rsquo;s sign</strong> or <strong>pulsation sign&nbsp;</strong>which&nbsp;is suggestive of <strong>glomus tumor</strong>.</p>\n<p>When ear canal <strong>pressure</strong> is <strong>raised</strong> with Siegel&rsquo;s speculum, the&nbsp;<strong>tumor pulsates</strong> vigorously and then <strong>blanches.&nbsp;</strong>The&nbsp;reverse happens with the release of pressure.</p>\n<p>Option A - Rising Sun sign is seen when glomus tumor arises from the floor of the middle ear.</p>\n<p>Option B - Schwarze sign is the reddish hue seen on the promontory through the tympanic membrane in otosclerosis.</p>\n<p>Option C - Lighthouse sign is a pulsatile discharge from a pin-hole perforation of pars tensa seen in mastoiditis.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a history of hearing loss and tinnitus. On examination, a polypoidal mass is seen in the middle ear, which bleeds heavily on touch. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Angiofibroma"
      },
      {
        "id": 2,
        "text": "Exostosis"
      },
      {
        "id": 3,
        "text": "Glomus tympanicum"
      },
      {
        "id": 4,
        "text": "Acoustic neuroma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>glomus tympanicum,</strong>&nbsp;a subtype of glomus tumors<strong>.</strong>&nbsp;</p>\n<p>Symptoms of glomus tumors:</p>\n<ul>\n<li><strong>Hearing loss</strong></li>\n<li><strong>Tinnitus</strong></li>\n<li><strong>Bleeding&nbsp;</strong>from the <strong>ear</strong></li>\n<li>Vertigo and facial palsy</li>\n<li>Dysphagia, hoarseness of voice (cranial nerve palsies).</li>\n</ul>\n<p>Examination findings:</p>\n<ul>\n<li>Intratympanic tumor: <strong>rising sun appearance </strong>with<strong>&nbsp;</strong>a<strong> positive Brown sign</strong></li>\n<li>Red, vascular <strong>polyp</strong> that <strong>bleeds</strong> readily on <strong>manipulation</strong> or biopsy</li>\n<li>Once the tympanic membrane is breached: bleeding polyp in the external ear</li>\n<li><strong>Audible bruit </strong>over the <strong>mastoid.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old woman presented with hearing loss, pulsatile ringing in the right ear, and deviation of the tongue to the right side. MRI revealed a mass in the right jugular fossa. On examination, a pulsatile reddish mass was seen behind the intact tympanic membrane. Which of the following structures is invaded by the mass?",
    "choices": [
      {
        "id": 1,
        "text": "Epitympanum"
      },
      {
        "id": 2,
        "text": "Mesotympanum"
      },
      {
        "id": 3,
        "text": "Hypotympanum"
      },
      {
        "id": 4,
        "text": "Mastoid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given<strong> </strong>case<strong> </strong>scenario of hearing loss, pulsatile tinnitus, 12th cranial nerve involvement, and red mass on otoscopy is suggestive of <strong>glomus jugulare. Hypotympanum</strong> is invaded by the tumor.</p>\n<p>It arises in the adventitia of the dome of the <strong>jugular bulb</strong> and invades the <strong>hypotympanum</strong>, <strong>jugular foramen,</strong> and <strong>jugular vein</strong>.</p>\n<p>In addition to ear signs and symptoms, <strong>cranial nerve</strong> involvement is commonly seen of the <strong>IXth to XIIth</strong> cranial nerves in glomus jugulare.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old is referred to your ENT practice with pulsatile tinnitus, and Brown\u2019s sign is positive. The patient gives you her CT films. Which of the following CT signs will help you differentiate between glomus jugulare and glomus tympanicum?",
    "choices": [
      {
        "id": 1,
        "text": "Battle sign"
      },
      {
        "id": 2,
        "text": "Lyre sign"
      },
      {
        "id": 3,
        "text": "Phelp sign"
      },
      {
        "id": 4,
        "text": "Griesinger sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Phelp sign</strong> helps differentiate between glomus jugulare and glomus tympanicum on<strong> CT</strong>.</p>\n<p>It is the <strong>erosion</strong> of the spine of the<strong> carotico-jugular crest</strong>, seen in <strong>glomus jugulare</strong> tumors. It is <strong>intact</strong> in <strong>glomus tympanicum</strong>.</p>\n<p>Option A - Battle's sign is ecchymosis over the mastoid seen in fractures of the temporal bone.</p>\n<p>Option B - Lyre sign- splaying apart of internal and external carotid arteries on angiogram in cases of carotid body tumor of the neck.&nbsp;</p>\n<p>Option D - Griesinger's sign is edema over the mastoid and is seen in lateral sinus thrombosis.</p>\n<p>The image given shows Battle's sign.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2ce510eb141f421aa119c88ad636a68cx720x743.JPEG"
    ]
  },
  {
    "text": "A 68-year old woman presents with complaints of right-sided facial weakness for 15 days and progressive hearing loss for 2 years. On examination, there is tachycardia and carotid bruit on the right side. Otoscopy shows a red mass behind the tympanic membrane and 24-hour urine collection shows the presence of metanephrines. Which of the following classification systems is used for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lederman's classification"
      },
      {
        "id": 2,
        "text": "Fisch classification"
      },
      {
        "id": 3,
        "text": "Austin's  classification"
      },
      {
        "id": 4,
        "text": "Sade's classification"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given case scenario with right-sided facial palsy, hearing loss, red mass behind the tympanic membrane, tachycardia, carotid bruit and positive urinary metanephrines is suggestive of a <strong>functional glomus tumor</strong>.\u00a0</p>\n<p>10% of all glomus tumors are functional and secrete <strong>catecholamines.</strong> This is diagnosed by testing the patient's 24-hour urine collection for <strong>urinary VMA</strong> (vanillylmandelic acid) or <strong>metanephrines.\u00a0</strong></p>\n<p><strong>Glomus tumors</strong> are classified based on <strong>Fisch classification</strong></p>\n<table style=\"height: 193px; width: 574.688px;\">\n<tbody>\n<tr>\n<td style=\"width: 146px;\"><strong>Class</strong></td>\n<td style=\"width: 259.688px;\"><strong>Extent\u00a0</strong></td>\n</tr>\n<tr style=\"height: 41px;\">\n<td style=\"width: 146px; height: 41px;\">Class A</td>\n<td style=\"width: 259.688px; height: 41px;\">Tumor limited to the middle ear (mesotympanum)</td>\n</tr>\n<tr style=\"height: 41px;\">\n<td style=\"width: 146px; height: 41px;\">Class B</td>\n<td style=\"width: 259.688px; height: 41px;\">\n<div class=\"page\" title=\"Page 4101\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Tumor in the middle ear (meso- and hypotympanum) and the mastoid</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 41px;\">\n<td style=\"width: 146px; height: 41px;\">Class C</td>\n<td style=\"width: 259.688px; height: 41px;\">\n<div class=\"page\" title=\"Page 4101\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Tumour originates in the dome of the jugular bulb, destroying the overlying bone\u00a0and has extensive local spread.</p>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr style=\"height: 41px;\">\n<td style=\"width: 146px; height: 41px;\">Class D</td>\n<td style=\"width: 259.688px; height: 41px;\">\n<div class=\"page\" title=\"Page 4101\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 4101\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Intracranial extension.\u00a0It can be intradural or extradural</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n</tbody>\n</table>\n<p class=\"page\" title=\"Page 4101\">Option A: Lederman's classification is used in maxillary carcinoma.</p>\n<p class=\"page\" title=\"Page 4101\">Option C: Austin's classification is used to classify\u00a0anatomical defects in the ossicular chain.</p>\n<p class=\"page\" title=\"Page 4101\">Option D:\u00a0Sade's classification is used to classify atelectasis or retraction of the pars tensa.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged woman presents with deafness, tinnitus, and bleeding from the ear. On examination, a reddish mass is seen behind the tympanic membrane which blanches on applying pressure with the pneumatic speculum. Which of the following is not a part of its management?",
    "choices": [
      {
        "id": 1,
        "text": "Preoperative biopsy"
      },
      {
        "id": 2,
        "text": "Radiotherapy"
      },
      {
        "id": 3,
        "text": "Preoperative embolisation"
      },
      {
        "id": 4,
        "text": "Surgery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note: Although CT is the test of choice for the evaluation of bone involvement, gadolinium-enhanced MRI provides a superior definition of the relationship of the tumor to adjacent vascular and skull base structures. Hence Both MRI and CT are typically needed for a suspected jugulotympanic paraganglioma given that the information derived from each study is complementary.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/955d6c1d30fb4f5a8e2c0364d913f016x679x785.JPEG"
    ]
  },
  {
    "text": "What is the most common tumor at the cerebellopontine angle?",
    "choices": [
      {
        "id": 1,
        "text": "Acoustic neuroma"
      },
      {
        "id": 2,
        "text": "Cholesteatoma"
      },
      {
        "id": 3,
        "text": "Glomus tumor"
      },
      {
        "id": 4,
        "text": "Meningioma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Acoustic neuroma</strong>&nbsp;is the most common tumor at the<strong> cerebellopontine angle.&nbsp;</strong>It <strong>arises</strong> from the <strong>vestibular division of the VIIIth nerve</strong> within the internal auditory canal, widens and erodes the canal and appears at the cerebellopontine angle.&nbsp;</p>\n<p>Other tumors arising at the cerebellopontine angle are:</p>\n<ul>\n<li>Meningioma</li>\n<li>Cholesteatoma</li>\n<li>Arachnoid cysts</li>\n<li>Facial nerve schwannomas</li>\n<li>Glomus tumor.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where does acoustic neuroma most commonly arise from?",
    "choices": [
      {
        "id": 1,
        "text": "Facial nerve"
      },
      {
        "id": 2,
        "text": "Vestibular division of 8th cranial nerve"
      },
      {
        "id": 3,
        "text": "Cochlear division of  8th cranial nerve"
      },
      {
        "id": 4,
        "text": "Auricular nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Acoustic neuroma</strong>&nbsp;or <strong>vestibular schwannoma&nbsp;</strong>almost always arises from the <strong>Schwann cells</strong> of the <strong>vestibular division of 8th nerve.</strong></p>\n<p>It arises from the superior and the inferior division of the vestibular nerve in the <strong>medial internal auditory canal</strong> at the site of transition of central to peripheral myelin i.e.,&nbsp;<strong>Obersteiner-Redlich zone.</strong></p>\n<p>Rarely, it can arise from the cochlear division of the 8th nerve within the internal auditory canal.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features is common to vestibular schwannomas and glomus tumors?",
    "choices": [
      {
        "id": 1,
        "text": "Encapsulated"
      },
      {
        "id": 2,
        "text": "Common in middle aged females"
      },
      {
        "id": 3,
        "text": "Vascular"
      },
      {
        "id": 4,
        "text": "Slow growing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Glomus tumors and vestibular shwannomas are both <strong>slow-growing, benign </strong>tumors of the temporal bone with <strong>locally invasive</strong> properties.</p>\n<p><strong>Vestibular shwannomas </strong>are<strong> encapsulated tumors. </strong>They are<strong> </strong>seen in middle aged individuals and have <strong>equal incidence</strong> in both <strong>sexes</strong>.</p>\n<p><strong>Glomus tumors</strong> are<strong>\u00a0vascular</strong> paragangliomas and are <strong>non-encapsulated tumors</strong>. They are seen more commonly in <strong>middle-aged women</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common symptoms that acoustic neuroma presents with?",
    "choices": [
      {
        "id": 1,
        "text": "Conductive hearing loss"
      },
      {
        "id": 2,
        "text": "Sensorineural hearing loss"
      },
      {
        "id": 3,
        "text": "Vertigo"
      },
      {
        "id": 4,
        "text": "Headache"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Progressive unilateral sensorineural hearing loss (SNHL),</strong> often accompanied by tinnitus, is the presenting symptom in the majority of cases.</p>\n<p>Early symptoms of acoustic neuroma:</p>\n<ul>\n<li><strong>Progressive unilateral SNHL</strong></li>\n<li>Gross inability to understand speech out of proportion to the PTA average</li>\n<li><strong>Tinnitus</strong></li>\n<li>Unsteadiness and <strong>imbalance</strong></li>\n</ul>\n<p>The involvement of other cranial nerves leads to other deficits.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the earliest cranial nerve to be involved in acoustic neuroma?",
    "choices": [
      {
        "id": 1,
        "text": "5th"
      },
      {
        "id": 2,
        "text": "6th"
      },
      {
        "id": 3,
        "text": "7th"
      },
      {
        "id": 4,
        "text": "8th"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>8th cranial nerve</strong> is the earliest to be involved in acoustic neuroma.</p>\n<p><strong>Cochleovestibular symptoms </strong>are the <strong>earliest symptoms</strong> when the tumor is still intracanalicular and are caused by pressure on cochlear or vestibular nerve fibers or on the internal auditory artery.</p>\n<p>Once the tumor erodes the canal, it presents in the cerebellopontine angle and can expand to involve other nearby cranial nerves such as the 5th and 7th cranial nerves.</p>\n<p><strong>Note</strong>: Acoustic neuroma arises from the 8th cranial nerve. Hence, it is the first nerve involved.&nbsp;However, if the 8th cranial nerve is not given as an option, then the answer would be the&nbsp;<strong>5th cranial nerve</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old patient presents with progressive unilateral hearing loss, decreased lacrimation, and loss of taste. On examining the external auditory meatus, there is decreased sensation on the posterior side. You suspect acoustic neuroma in this case. What sign was elicited here?",
    "choices": [
      {
        "id": 1,
        "text": "Brown's sign"
      },
      {
        "id": 2,
        "text": "Pulsation sign"
      },
      {
        "id": 3,
        "text": "Hitzelberger's sign"
      },
      {
        "id": 4,
        "text": "Rising sun sign"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hitzelberger&rsquo;s sign</strong> is the sign elicited in the given clinical scenario of&nbsp;<strong>acoustic neuroma. </strong></p>\n<p>Hitzelberger&rsquo;s sign is the <strong>hypoaesthesia </strong>of the<strong> posterior meatal wall </strong>because&nbsp;the tumor has affected the <strong>sensory fibers</strong> of the <strong>facial nerve. </strong> In this case, sensory fibers of the facial nerve are affected, as the patient has decreased lacrimation and loss of taste.&nbsp;<strong>Motor fibers</strong> are more <strong>resistant</strong> and are affected late. A delayed blink reflex may be an early manifestation.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the gold standard investigation to confirm acoustic neuroma?",
    "choices": [
      {
        "id": 1,
        "text": "CECT"
      },
      {
        "id": 2,
        "text": "Gadolinium enhanced MRI"
      },
      {
        "id": 3,
        "text": "X-Ray"
      },
      {
        "id": 4,
        "text": "Biopsy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>MRI with gadolinium contrast&nbsp;</strong>is the <strong>gold standard</strong> for the diagnosis of acoustic neuroma.</p>\n<p>It is <strong>superior to a CT scan.&nbsp;</strong>Intracanalicular tumors measuring even a <strong>few millimeters</strong>&nbsp;can be easily diagnosed by this method.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A middle-aged-man presents with progressive sensorineural hearing loss, imbalance, and tinnitus. Which of the following features rules out Meniere\u2019s disease and is diagnostic of acoustic neuroma?",
    "choices": [
      {
        "id": 1,
        "text": "Stapedial reflex is present"
      },
      {
        "id": 2,
        "text": "Recruitment phenomenon is present"
      },
      {
        "id": 3,
        "text": "High SISI score"
      },
      {
        "id": 4,
        "text": "Rollover phenomenon is seen"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Rollover phenomenon</strong> is diagnostic of <strong>acoustic neuroma</strong>. It is a feature of <strong>retro-cochlear/neural lesions</strong> wherein the <strong>speech discrimination</strong> steadily <strong>increases with intensity</strong> but <strong>suddenly drops</strong> significantly beyond a particular intensity of sound.</p>\n<p>Meniere&rsquo;s disease is an important differential for acoustic neuroma as the patients suffer from similar symptoms. Meniere&rsquo;s is a cochlear pathology and acoustic neuroma is retrocochlear.</p>\n<p>Option A - Stapedial reflex is present in cochlear lesions (Meniere&rsquo;s) and absent in retrocochlear lesion (acoustic neuroma)</p>\n<p>Option B - Recruitment phenomenon is the abnormal growth in loudness in the affected ear, seen in cochlear pathologies.&nbsp;</p>\n<p>Option C - SISI (short increment sensitivity score) is a test of intensity discrimination which is very high in cochlear pathologies but low in retro-cochlear.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old man presents with difficulty hearing. Pure tone audiometry shows rollover phenomenon. An MRI with Gadolinium contrast shows a mass over the cerebellopontine angle. What is the treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Surgery"
      },
      {
        "id": 2,
        "text": "Radiotherapy"
      },
      {
        "id": 3,
        "text": "Chemotherapy"
      },
      {
        "id": 4,
        "text": "Conservative"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>acoustic neuroma</strong>. <strong>Treatment of choice</strong> in this case is <strong>surgery.&nbsp;</strong></p>\n<p>The approach depends upon site and size of tumor:</p>\n<ul>\n<li>Middle cranial fossa approach</li>\n<li>Translabyrinthine approach</li>\n<li>Retrosigmoid/Suboccipital approach</li>\n<li>Combined.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not used in the treatment of vestibular schwannomas?",
    "choices": [
      {
        "id": 1,
        "text": "X-Knife"
      },
      {
        "id": 2,
        "text": "Gamma knife"
      },
      {
        "id": 3,
        "text": "Cold knife"
      },
      {
        "id": 4,
        "text": "CyberKnife"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Cold knife</strong> is not used in the treatment of vestibular schwannomas. It is used for the <strong>conization of the cervix</strong> in <strong>cervical carcinoma.</strong></p>\n<p><strong>Stereotactic radiosurgery</strong> is a reasonable alternative for people who refuse or <strong>cannot tolerate surgery</strong>. Here, beams are modified and focused only to concentrate on the tumor and have little effect on surrounding tissue. It can be done by using&nbsp;</p>\n<ul>\n<li><strong>X-knife</strong> using a linear accelerator (LINAC)</li>\n<li><strong>Gamma-knife</strong> using Cobalt 60</li>\n<li><strong>CyberKnife</strong> - image-guided linear accelerator using real-time image guidance to deliver radiation from multiple angles.</li>\n</ul>\n<p><strong>External beam radiation</strong> is <strong>not recommended</strong> as it causes significant <strong>damage</strong> to the <strong>surrounding brain</strong> and neural structures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '12 Tumors Of Ear';
        let hierarchy = ["Marrow", "qBank", "ENT"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>