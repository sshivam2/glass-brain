<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>19 Anti-Epileptics I - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pharmacology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">29</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most important mechanism of antiepileptic activity of phenytoin?",
    "choices": [
      {
        "id": 1,
        "text": "Prolongation of Na+ channel inactivation"
      },
      {
        "id": 2,
        "text": "Reduction in Ca2+ influx"
      },
      {
        "id": 3,
        "text": "Facilitation of GABA response"
      },
      {
        "id": 4,
        "text": "Increasing the K+ influx"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">The most important mechanism of antiepileptic activity of <strong>phenytoin</strong> is the <strong>prolongation</strong> of <strong>Na<sup>+</sup> ion channel inactivation</strong>. It slows down the rate of recovery of Na+ channels and thus limiting the propagation of the action potential.</p>\n<p style=\"text-align: justify;\">Phenytoin also <strong>inhibits voltage-gated Ca<sup>2+</sup> channels</strong>. This reduces&nbsp;the influx of calcium inside the membrane and&nbsp;reduces the inflow of potassium&nbsp;ions during repolarization.</p>\n<p>At higher or toxic doses, phenytoin facilitates GABA response and inhibits the action of glutamate.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A known case of seizure disorder has been on long-term phenytoin therapy. Which of the following statements about this drug would be incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Extensively bound to plasma proteins"
      },
      {
        "id": 2,
        "text": "Metabolism follows only zero order kinetics"
      },
      {
        "id": 3,
        "text": "Requires therapeutic drug monitoring"
      },
      {
        "id": 4,
        "text": "Metabolized extensively by the CYP enzymes in the liver"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Phenytoin follows <strong>first-order kinetics</strong> at<strong> lower concentrations&nbsp;</strong>and as the&nbsp;<strong>concentration increases</strong>, the elimination changes to <strong>zero-order kinetics.&nbsp;</strong>The rate of elimination of phenytoin varies with the serum concentration.</p>\n<p>As the blood levels rise, the maximal capacity of the liver to metabolize phenytoin is reached. Thus even a small increase in the dosage can result in disproportionally high plasma levels. Therefore, it requires&nbsp;<strong>therapeutic drug monitoring.&nbsp;</strong></p>\n<p>About&nbsp;<strong>90%</strong> of phenytoin is <strong>bound to plasma proteins,&nbsp;</strong>mainly albumin. Phenytoin is metabolized by the<strong> CYP enzymes</strong> in the liver.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is an incorrect statement regarding fosphenytoin?",
    "choices": [
      {
        "id": 1,
        "text": "Water soluble prodrug of phenytoin"
      },
      {
        "id": 2,
        "text": "Fosphenytoin displaces phenytoin from protein-binding sites"
      },
      {
        "id": 3,
        "text": "Causes hyperphosphatemia in renal failure patients"
      },
      {
        "id": 4,
        "text": "ECG monitoring is not required when administering IV"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Fosphenytoin</strong> like phenytoin requires<strong> continuous ECG monitoring</strong> during IV infusion due to the <strong>risk</strong> of <strong>arrhythmias.</strong></p>\n<p>Fosphenytoin is a <strong>water-soluble prodrug</strong> of phenytoin. Fosphenytoin is also extensively protein bound, mainly <strong>albumin</strong>. This binding is saturable and fosphenytoin displaces phenytoin from protein-binding sites.</p>\n<p><strong>Hydrolysis</strong> of fosphenytoin yields phosphate, which increases the <strong>risk </strong>of<strong> hyperphosphatemia</strong> in patients with renal failure.&nbsp;It is contraindicated in patients with sinus bradycardia, sino-atrial block, second and third-degree A-V block.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presenting to the ER with generalized tonic-clonic seizures is started on phenytoin therapy. All of the following adverse effects can be expected in this patient except?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3 and 4"
      },
      {
        "id": 2,
        "text": "2 and 4"
      },
      {
        "id": 3,
        "text": "2 only"
      },
      {
        "id": 4,
        "text": "3 and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Phenytoin</strong> causes <strong>hypocalcemia</strong> and <strong>hyperglycemia</strong>.</p>\n<p>It <strong>interferes</strong> with the <strong>metabolism</strong> of <strong>vitamin D</strong> and intestinal <strong>calcium absorption</strong> and results in hypocalcemia.&nbsp;Hyperglycemia and glycosuria can be seen due to the <strong>inhibition</strong> of <strong>insulin</strong> secretion.</p>\n<p>Long-term usage of phenytoin can also cause cutaneous <strong>pseudolymphoma</strong> which is mainly T-cell predominant.<a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4601451/\" target=\"_blank\" rel=\"noopener\"></a></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features would you not expect to find in a baby born to a woman on phenytoin therapy?",
    "choices": [
      {
        "id": 1,
        "text": "Digital hypoplasia"
      },
      {
        "id": 2,
        "text": "Gum hyperplasia"
      },
      {
        "id": 3,
        "text": "Microcephaly"
      },
      {
        "id": 4,
        "text": "Cleft lip"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The newborn baby is unlikely to have gum hyperplasia. A baby&nbsp;born to a pregnant mother who was on<strong>&nbsp;phenytoin</strong>&nbsp;therapy will be suffering from <strong>fetal</strong> <strong>hydantoin syndrome</strong>.</p>\n<p>Features of fetal hydantoin syndrome are:</p>\n<ul>\n<li>Microcephaly</li>\n<li>Digital hypoplasia</li>\n<li>Cleft lip/ cleft palate</li>\n</ul>\n<p><strong>Gum hyperplasia</strong> is the most common adverse effect of phenytoin in children and young adolescents on <strong>chronic use</strong>.<label class=\"ng-binding label label-success\"></label></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with recent-onset primary generalized epilepsy develops a skin reaction due to phenytoin sodium. What is the most appropriate course of action?",
    "choices": [
      {
        "id": 1,
        "text": "Switch to clonazepam"
      },
      {
        "id": 2,
        "text": "Stop and restart phenytoin sodium after two weeks"
      },
      {
        "id": 3,
        "text": "Switch to sodium valproate"
      },
      {
        "id": 4,
        "text": "Switch to ethosuximide"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p style=\"text-align: left;\"><strong>Hypersensitivity reaction</strong> to<strong> phenytoin&nbsp;</strong>warrants <strong>discontinuation</strong> of the drug.&nbsp;<strong>Switching</strong> to <strong>sodium valproate</strong> is the most appropriate course of action for this patient.&nbsp;</p>\n<p style=\"text-align: left;\"><strong>Sodium valproate</strong> is one of the first-line agents indicated for<strong> GTCS. Clonazepam</strong> and <strong>ethosuximide</strong> are primarily used in <strong>absence seizures</strong> and are not indicated for GTCS.&nbsp;</p>\n<p style=\"text-align: left;\">Clonazepam is indicated as <strong>adjunctive therapy</strong> in the absence seizures when first-line agents (ethosuximide, sodium valproate, lamotrigine) fail to control the seizures adequately.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 51-year-old male complains of severe, sharp, piercing intermittent electrical shock-like pain sensation on the left side of his face. The pain was triggered by talking, washing his face, eating, and brushing his teeth. Which of the following drugs is most effective to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin"
      },
      {
        "id": 2,
        "text": "Carbamazepine"
      },
      {
        "id": 3,
        "text": "Sodium valproate"
      },
      {
        "id": 4,
        "text": "Lamotrigine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features in this patient are suggestive of a diagnosis of <strong>trigeminal neuralgia</strong> and <strong>carbamazepine</strong> is the most effective agent for its treatment.&nbsp;&nbsp;</p>\n<p>If carbamazepine is ineffective, then second-line<strong>&nbsp;</strong>agents like <strong>lamotrigine</strong> and <strong>phenytoin</strong> are used.</p>\n<p>Sodium valproate although effective for trigeminal neuralgia lacks enough evidence for use.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true about carbamazepine?",
    "choices": [
      {
        "id": 1,
        "text": "It is indicated in focal seizures with impaired awareness"
      },
      {
        "id": 2,
        "text": "It is an enzyme inhibitor"
      },
      {
        "id": 3,
        "text": "It causes hypernatremia"
      },
      {
        "id": 4,
        "text": "It is the drug of choice for status epilepticus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Carbamazepine</strong> is indicated in <strong>focal seizures</strong> with<strong> impaired awareness.</strong></p>\n<p>Carbamazepine is an antiepileptic drug that acts by <strong>prolonging</strong> the <strong>inactivated</strong> state of the <strong>Na+ channel</strong> similar to phenytoin. It is used in:</p>\n<ul>\n<li>Focal seizures with impaired awareness</li>\n<li>Focal seizures with intact awareness</li>\n<li>Generalized tonic-clonic seizures</li>\n<li>Trigeminal and related neuralgias</li>\n<li>Manic depressive psychosis.</li>\n</ul>\n<p>Option B: Carbamazepine is an <strong>enzyme inducer</strong>. It is a substrate as well as an inducer of CYP3A4 and CYP2C9.</p>\n<p>Option C: Carbamazepine causes <strong>hyponatremia</strong> and not hypernatremia. Other side effects of carbamazepine include <strong>agranulocytosis</strong> or<strong> aplastic anemia,&nbsp;</strong>hepatotoxicity, water retention and hyponatremia (by potentiating ADH action ), and dose-related neurotoxicity.</p>\n<p>Option D:&nbsp;It is <strong>not</strong> <strong>used</strong> in status epilepticus. <strong>Lorazepam</strong> is the drug of choice for <strong>status epilepticus</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "If carbamazepine is added to ongoing valproate therapy, what adverse effect is risked?",
    "choices": [
      {
        "id": 1,
        "text": "Pancreatitis"
      },
      {
        "id": 2,
        "text": "Thrombocytopenia"
      },
      {
        "id": 3,
        "text": "Hepatotoxicity"
      },
      {
        "id": 4,
        "text": "Hyperammonemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>If <strong>carbamazepine</strong> is added to ongoing <strong>valproate</strong> therapy, it can result in <strong>hepatotoxicity</strong>.</p>\n<p>A combination of valproate and carbamazepine increases hepatotoxicity. Valproic acid may inhibit carbamazepine clearance and increase steady-state carbamazepine blood levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In patients recieving carbamazepine, which of the following idiosyncratic reactions are not expected to occur?",
    "choices": [
      {
        "id": 1,
        "text": "Rash"
      },
      {
        "id": 2,
        "text": "Agranulocytosis"
      },
      {
        "id": 3,
        "text": "Peripheral neuropathy"
      },
      {
        "id": 4,
        "text": "Steven Johnson syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Peripheral neuropathy&nbsp;</strong>is not an idiosyncratic reaction that can occur after <strong>carbamazepine</strong> use<strong>.</strong> It is a&nbsp;<strong>dose-dependent</strong> CNS adverse effect. It can be minimized by gradually increasing the dose from initiation or reducing the maintenance dose.</p>\n<p><strong>Idiosyncratic reactions</strong> are hypersensitivity reactions like:</p>\n<ul>\n<li>Rash</li>\n<li>Steven-Johnson syndrome</li>\n<li>Eosinophilia</li>\n<li>Lymphadenopathy.</li>\n<li>Diplopia</li>\n</ul>\n<p>Serious hematological toxicity includes aplastic anemia and agranulocytosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old man is on carbamazepine therapy. Which of the following is expected to occur in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hypernatremia"
      },
      {
        "id": 2,
        "text": "Hyponatremia"
      },
      {
        "id": 3,
        "text": "Hypocalcemia"
      },
      {
        "id": 4,
        "text": "Hypokalemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Carbamazepine</strong> is expected to cause&nbsp;<strong>hyponatremia </strong>in this patient.</p>\n<p>Carbamazepine potentiates the action of antidiuretic hormone (<strong>ADH</strong>). It can result in&nbsp;<strong>water retention</strong> with <strong>decreased osmolarity</strong> and <strong>hyponatremia,</strong> especially in<strong> elderly</strong> patients with cardiac disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old child diagnosed to have focal seizures was initiated on oxcarbazepine. Which of the following would be incorrect regarding the agent being used?",
    "choices": [
      {
        "id": 1,
        "text": "Keto analog of carbamazepine"
      },
      {
        "id": 2,
        "text": "Enzyme induction potency is less when compared to carbamazepine"
      },
      {
        "id": 3,
        "text": "Metabolised by glucuronide conjugation"
      },
      {
        "id": 4,
        "text": "Hyponatremia risk is less when compared to carbamazepine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The risk of <strong>hyponatremia </strong>with <strong>oxcarbazepine</strong> is <strong>higher</strong> when compared to carbamazepine.&nbsp;</p>\n<p>Option A: Oxcarbazepine is a <strong>keto analog</strong> of carbamazepine. It is a prodrug. The mechanism of action of oxcarbazepine is by <strong>blocking</strong> voltage-gated <strong>sodium channels</strong> (same as carbamazepine).</p>\n<p>Option C: Active form is metabolized by <strong>glucuronide conjugation</strong>.</p>\n<p>Option B: Oxcarbazepine does not cause auto-induction of metabolizing enzymes. It can induce CYP enzymes but less potent when compared to carbamazepine.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A neonate diagnosed with rhabdomyosarcoma was started on vincristine, cyclophosphamide, and cisplatin. A week after initiation of treatment, the baby had multiple episodes of seizures, refractory to diazepam and lidocaine. Workup revealed an elevated ADH level and euvolemic hyponatremia. Which of the following drugs can be used to treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Carbamazepine"
      },
      {
        "id": 2,
        "text": "Phenytoin"
      },
      {
        "id": 3,
        "text": "Oxcarbazepine"
      },
      {
        "id": 4,
        "text": "Phenobarbital"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>refractory seizures</strong> induced by <strong>hyponatremia</strong>&nbsp;caused by&nbsp;<strong>SIADH</strong> (due to anticancer drugs). <strong>Phenytoin</strong> is used to treat this patient. It is known to <strong>decrease ADH secretion</strong> and stop seizures by<strong> correcting</strong>&nbsp;severe <strong>hyponatremia.</strong></p>\n<p>Options A and C: Carbamazepine and oxcarbazepine <strong>increase</strong> the antidiuretic hormone (<strong>ADH</strong>) levels. This leads to increased sensitivity of renal tubules to ADH levels and hyponatremia. Carbamazepine cannot be used in SIADH because of its antidiuretic effects.</p>\n<p>Option D: Phenobarbital does not affect&nbsp;ADH secretion or action and thus will be ineffective in stopping the seizures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5th-grade student, after receiving multiple complaints from teachers at school for repeated episodes of inattention was brought to the OPD. The mother gave a history that her child had brief spells of staring associated with lip-smacking movements. Which anti-epileptic drug is the most effective for this child?",
    "choices": [
      {
        "id": 1,
        "text": "Carbamazepine"
      },
      {
        "id": 2,
        "text": "Ethosuximide"
      },
      {
        "id": 3,
        "text": "Phenytoin"
      },
      {
        "id": 4,
        "text": "Gabapentin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features are suggestive of <strong>absence seizures</strong> and <strong>ethosuximide</strong> is the most effective agent for this condition.</p>\n<p>First-line drugs in:</p>\n<ul>\n<li>Typical absence seizures: Ethosuximide (<strong>drug of choice</strong>), valproate, lamotrigine</li>\n<li>Atypical absence seizures: Sodium valproate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with absence seizures improves after being treated with ethosuximide. Which of the following is the mechanism of action of this drug?",
    "choices": [
      {
        "id": 1,
        "text": "Inhibits L type Ca2+ channels"
      },
      {
        "id": 2,
        "text": "Inhibits  N type Ca2+ channels"
      },
      {
        "id": 3,
        "text": "Inhibits T type Ca2+ channels"
      },
      {
        "id": 4,
        "text": "Inhibits R type Ca2+ channels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The mechanism of action of <strong>ethosuximide</strong> is by<strong> inhibition of T-type Ca<sup>2+</sup> </strong>channels in <strong>thalamic neurons</strong> at clinically relevant concentrations.</p>\n<p>It also affects&nbsp;other ion channels affected include voltage-gated sodium channels and potassium channels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old child is brought to the OPD with a history of vacant stares lasting for about half a minute. The EEG shows a characteristic 3 Hz spike and wave pattern. Which of the following drugs can be used for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2 and 5"
      },
      {
        "id": 2,
        "text": "2 and 3"
      },
      {
        "id": 3,
        "text": "2 only"
      },
      {
        "id": 4,
        "text": "3, 4 and 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>absence seizures</strong>. <strong>Ethosuximide</strong> and <strong>valproate</strong> are the first-line drugs in this condition.</p>\n<p>Absence seizures are characterized by <strong>sudden</strong>, brief <strong>lapses</strong> of <strong>consciousness</strong> without loss of postural control. There is no postictal confusion. The following subtle motor signs may accompany the episodes</p>\n<ul>\n<li>Rapid blinking of the eyelids</li>\n<li>Chewing movements</li>\n<li>Small-amplitude clonic movements of the hands</li>\n</ul>\n<p><strong>Hyperventilation</strong> has a tendency to <strong>provoke</strong> absence seizures. First-line drugs include:</p>\n<ul>\n<li>Typical absence seizures: Ethosuximide (<strong>drug of choice</strong>), valproate, lamotrigine</li>\n<li>Atypical absence seizures: Valproate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not an enzyme inducer?",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin"
      },
      {
        "id": 2,
        "text": "Phenobarbital"
      },
      {
        "id": 3,
        "text": "Carbamazepine"
      },
      {
        "id": 4,
        "text": "Sodium valproate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Sodium valproate</strong> is not an enzyme inducer. It is <strong>metabolized by CYP2C9/19</strong> and is an <strong>inhibitor of CYP2C9</strong>.</p>\n<p>Phenytoin, phenobarbital, and carbamazepine are inducers of CYP and UGT enzymes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not the mechanism of action of sodium valproate?",
    "choices": [
      {
        "id": 1,
        "text": "Prolongation of Na+ channel inactivation"
      },
      {
        "id": 2,
        "text": "Inhibition of T type Ca2+ channels"
      },
      {
        "id": 3,
        "text": "Inhibition of GABA transaminase"
      },
      {
        "id": 4,
        "text": "Inhibition of GABA transporter"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sodium valproate has no action on the GABA transporter.</p>\n<p><strong>Mechanism</strong> <strong>of action</strong> of <strong>sodium valproate:</strong></p>\n<ul>\n<li>Prolongation of sodium channel inactivation</li>\n<li>Inhibition of T-type Ca<sup>2+</sup> channels</li>\n<li>Inhibition of GABA transaminase</li>\n<li>Increases GABA synthesis from glutamic acid.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are not adverse effects of sodium valproate?",
    "choices": [
      {
        "id": 1,
        "text": "Weight gain"
      },
      {
        "id": 2,
        "text": "Alopecia"
      },
      {
        "id": 3,
        "text": "Liver damage"
      },
      {
        "id": 4,
        "text": "Osteomalacia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Osteomalacia is not an adverse effect of sodium valproate.</p>\n<p>The <strong>side effects</strong> of valproate (mnemonic: <strong>VALPROATE</strong>)</p>\n<ul>\n<li><strong>V</strong>omiting</li>\n<li><strong>A</strong>lopecia</li>\n<li><strong>L</strong>iver toxicity</li>\n<li><strong>P</strong>ancreatitis</li>\n<li><strong>R</strong>ash</li>\n<li><strong>O</strong>besity</li>\n<li><strong>A</strong>norexia</li>\n<li><strong>T</strong>eratogenicity (most common: spina bifida), thrombocytopenia, tremors&nbsp;</li>\n<li><strong>E</strong>dema</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antiepileptic drugs does not cause fulminant hepatitis as a serious complication?",
    "choices": [
      {
        "id": 1,
        "text": "Sodium valproate"
      },
      {
        "id": 2,
        "text": "Felbamate"
      },
      {
        "id": 3,
        "text": "Phenytoin"
      },
      {
        "id": 4,
        "text": "Vigabatrin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Vigabatrin</strong> is not associated with fulminant hepatitis. It is largely <strong>excreted unchanged</strong> in urine <strong>without</strong> undergoing any <strong>hepatic metabolism.</strong></p>\n<p>Sodium valproate, felbamate and phenytoin are associated with<strong> fulminant hepatitis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old female patient is admitted to the neurology ward for evaluation of GTCS. She reports that she has been on oral contraceptive pills for the past 6 months. Which of the following drugs would you prescribe to this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Carbamazepine"
      },
      {
        "id": 2,
        "text": "Phenobarbital"
      },
      {
        "id": 3,
        "text": "Valproate"
      },
      {
        "id": 4,
        "text": "Phenytoin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Valproate</strong> is the drug used for this patient as it <strong>does not cause contraceptive failure.</strong></p>\n<p>Valproate is an enzyme inhibitor and it <strong>inhibits</strong> the <strong>degradation</strong> of <strong>OCPs.</strong> OCPs thus have a longer duration of action and less incidence of contraceptive failure with valproate.</p>\n<p>However, other antiepileptic drugs like carbamazepine, phenytoin, phenobarbital, primidone, oxcarbazepine, topiramate are <strong>enzyme inducers</strong>. They cause <strong>increased degradation</strong> of <strong>OCPs</strong> and hence lead to<strong> contraceptive failure</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old patient was brought to the ER with bilateral jerking movements of arms. EEG revealed diffuse, symmetric, bilateral 4-6 Hz polyspike and wave discharges with a frontocentral predominance. What is the most appropriate drug for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Lamotrigine"
      },
      {
        "id": 2,
        "text": "Levetiracetam"
      },
      {
        "id": 3,
        "text": "Topiramate"
      },
      {
        "id": 4,
        "text": "Sodium valproate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical features and EEG findings are suggestive of <strong>juvenile myoclonic epilepsy.</strong>&nbsp;The most appropriate drug for management is <strong>s</strong><strong>odium valproate.&nbsp;</strong></p>\n<p>In patients with myoclonic seizures which are refractory to valproate, clonazepam or clobazam may be added.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old man visits the neurology OPD with complaints of tremors in both his hands which improve on alcohol intake. On examination, there is a significant worsening of tremors towards the end of finger-to-nose testing and head-nodding movements. Which antiepileptic is approved for use in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Phenobarbital"
      },
      {
        "id": 2,
        "text": "Phenytoin"
      },
      {
        "id": 3,
        "text": "Primidone"
      },
      {
        "id": 4,
        "text": "Valproate"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\" style=\"text-align: justify;\">The clinical features are suggestive of a diagnosis of <strong>essential tremors</strong> in this patient. <strong>P</strong><strong>rimidone</strong> is considered to be the first-line therapy for the same along with <strong>propranolol.</strong>&nbsp;</p>\n<p class=\"p1\" style=\"text-align: justify;\"><strong>Bilateral, symmetric</strong> <strong>tremors</strong> involving the <strong>hands</strong> associated with head nodding (<strong>titubation</strong>) and <strong>worsening</strong> of tremors <strong>towards</strong> the <strong>end</strong> of <strong>goal-directed movements</strong> such as drinking from a glass or finger-to-nose testing is suggestive of essential tremors.</p>\n<p class=\"p1\" style=\"text-align: justify;\"><strong>Primidone</strong> is a barbiturate and functions as a <strong>GABA enhancer</strong>. It is an enzyme inducer. It is used in the treatment of generalized tonic-clonic seizures and partial seizures.</p>\n<p class=\"p1\" style=\"text-align: justify;\">It has side effects like sedation, ataxia, and hyperactivity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Pseudolymphoma may occur in patients on long-term therapy with:",
    "choices": [
      {
        "id": 1,
        "text": "Carbamazepine"
      },
      {
        "id": 2,
        "text": "Phenobarbital"
      },
      {
        "id": 3,
        "text": "Phenytoin"
      },
      {
        "id": 4,
        "text": "Primidone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Phenytoin</strong> on long-term use can result in <strong>pseudolymphoma</strong>.</p>\n<p>This lymphadenopathy can be difficult to distinguish from malignant lymphoma. Although some studies suggest a causal relationship between phenytoin use and Hodgkin&rsquo;s disease, the data are far from conclusive. Almost all lesions are benign and termed as <strong>pseudolymphoma.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common adverse effect of phenytoin in children and young adolescents on chronic use?",
    "choices": [
      {
        "id": 1,
        "text": "Hirsutism"
      },
      {
        "id": 2,
        "text": "Osteomalacia"
      },
      {
        "id": 3,
        "text": "Gingival hyperplasia"
      },
      {
        "id": 4,
        "text": "Megaloblastic anemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Gingival hyperplasia</strong> occurs in patients on <strong>chronic phenytoin therapy</strong>. It is the <strong>most common manifestation</strong> in children and young adolescents.</p>\n<p>Gingival hyperplasia due to phenytoin therapy occurs due to tissue overgrowth secondary to <strong>altered collagen metabolism.</strong> The toothless portion of gums is not involved. It does not warrant discontinuation of the drug. It can be <strong>minimized</strong> by maintaining <strong>good oral hygiene.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a carbamazepine analogue that has an advantage of once daily dosing?",
    "choices": [
      {
        "id": 1,
        "text": "Oxcarbezepine"
      },
      {
        "id": 2,
        "text": "Eslicarbazepine acetate"
      },
      {
        "id": 3,
        "text": "Dacarbazine"
      },
      {
        "id": 4,
        "text": "Licarbazepine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Eslicarbazepine acetate</strong> is an analog of carbamazepine that has the advantage of <strong>once-daily</strong> dosing. It is a <strong>prodrug</strong> and is rapidly converted to active <strong>licarbazepine</strong>.</p>\n<p><strong>Oxcarbazepine</strong> is an analog of carbamazepine that is also converted to licarbazepine. Oxcarbazepine does not have the advantage of once-daily dosing like eslicarbazepine acetate.</p>\n<p><strong>Dacarbazine</strong> is not a carbamazepine analog like the other drugs and is a <strong>chemotherapy</strong> medication used in the treatment of <strong>melanoma</strong> and <strong>Hodgkin's lymphoma.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with a history of mitral stenosis presents with the given intractable finding that is refractory to conventional therapy.  What is the drug of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Probenecid"
      },
      {
        "id": 2,
        "text": "Diazepam"
      },
      {
        "id": 3,
        "text": "Haloperidol"
      },
      {
        "id": 4,
        "text": "Sodium valproate"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The drug used for <strong>refractory intractable rheumatic chorea</strong> is <strong>sodium valproate,&nbsp;</strong>as it doesn't have extrapyramidal side effects.&nbsp;</p>\n<p>Sydenham's chorea&nbsp;is characterized by <strong>involuntary, purposeless, jerky movements</strong> which mainly affect the&nbsp;<strong>head&nbsp;</strong>and<strong>&nbsp;upper limbs</strong>. In the tongue, it is visible as the characteristic darting movements.</p>\n<p>Medications used to treat Sydenham chorea are:</p>\n<ul>\n<li><strong>Mild</strong> cases - Providing a <strong>calm</strong> environment.</li>\n<li><strong>Severe</strong> cases:\n<ul>\n<li>Dopamine antagonists - haloperidol, pimozide</li>\n<li>Antiepileptic medications - <strong>sodium valproate,&nbsp;</strong>carbamazepine.&nbsp;&nbsp;</li>\n</ul>\n</li>\n<li>Severe, refractory cases - Steroids (thought to be immune-mediated)</li>\n<li>IV immunoglobulins, plasmapheresis - limited studies, decreased efficacy (not currently recommended)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b859810aab194066b796468d2d827abb.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old child is brought to the OPD with a history of vacant stares lasting for about half a minute. The EEG shows <3 Hz spike and wave pattern. The first-line drug for the management of this condition is:",
    "choices": [
      {
        "id": 1,
        "text": "Sodium valproate"
      },
      {
        "id": 2,
        "text": "Lamotrigine"
      },
      {
        "id": 3,
        "text": "Levitiracetam"
      },
      {
        "id": 4,
        "text": "Felbamate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and&nbsp;<strong>&lt;3 Hz</strong> spike and wave pattern on EEG is suggestive of <strong>atypical</strong>&nbsp;<strong>absence seizures</strong>. The <strong>first-line&nbsp;</strong><strong>drug</strong> in the treatment of atypical&nbsp;absence seizures is <strong>sodium valproate</strong>.&nbsp;</p>\n<p>Symmetric <strong>3 Hz</strong> spike and wave pattern on EEG is seen in<strong> typical absence seizures</strong>. First-line drugs in its treatment include:</p>\n<ul>\n<li>Ethosuximide (<strong>drug of choice</strong>)</li>\n<li>Valproate</li>\n<li>Lamotrigine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 18-year-old girl was brought to the OPD with complaints of excessive growth of hair on her face and chest. She is a known case of epilepsy and is on treatment with phenytoin. Which of the following drugs would not cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Metoclopramide"
      },
      {
        "id": 2,
        "text": "Methyldopa"
      },
      {
        "id": 3,
        "text": "Amantadine"
      },
      {
        "id": 4,
        "text": "Phenothiazines"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette of excessive hair growth secondary to treatment with <strong>phenytoin</strong> is suggestive of <strong>hirsutism.&nbsp;</strong><strong>Amantadine</strong> does not cause hirsutism or hypertrichosis but its characteristic side effect is <strong>livedo reticularis</strong> (bluish discoloration of the skin).</p>\n<p>Following are the <strong>drugs causing hirsutism</strong>:</p>\n<ul>\n<li>Phenytoin</li>\n<li>Anabolic steroids</li>\n<li>Danazol</li>\n<li>Metoclopramide</li>\n<li>Methyldopa</li>\n<li>Phenothiazines</li>\n<li>Progestins</li>\n<li>Reserpine</li>\n<li>Testosterone</li>\n</ul>\n<p>Following are the <strong>drugs causing hypertrichosis</strong>:</p>\n<ul>\n<li>Cyclosporine</li>\n<li>Diazoxide</li>\n<li>Hydrocortisone</li>\n<li>Minoxidil</li>\n<li>Penicillamine</li>\n<li>Phenytoin</li>\n<li>Psoralens</li>\n<li>Streptomycin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '19 Anti-Epileptics I';
        let hierarchy = ["Marrow", "qBank", "Pharmacology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>