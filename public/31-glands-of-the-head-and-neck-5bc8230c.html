<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>31 Glands Of The Head And Neck - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A surgeon approaches the anteromedial surface of the parotid gland while performing a radical parotidectomy. Which of the following structures is related to it?",
    "choices": [
      {
        "id": 1,
        "text": "Mastoid process"
      },
      {
        "id": 2,
        "text": "Medial pterygoid muscle"
      },
      {
        "id": 3,
        "text": "Superficial parotid lymph nodes"
      },
      {
        "id": 4,
        "text": "Styloid process"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>anteromedial surface</strong> of the <strong>parotid</strong> gland is related to the <strong>medial pterygoid muscle</strong>.</p>\n<p>The parotid gland&nbsp;is the largest salivary gland. It is usually in the shape of an <strong>inverted pyramid</strong> and has a superior surface, apex, superficial surface, anteromedial surface, and posteromedial surface.</p>\n<p>Relations of the parotid gland:</p>\n<ul>\n<li><strong>Superior surface</strong> - the external acoustic meatus and posterior part of the temporomandibular joint.</li>\n<li><strong>Apex</strong> - directed downwards and is related to the posterior belly of the digastric and carotid triangle.</li>\n<li><strong>Superficial surface</strong> - skin, superficial fascia, greater auricular nerve, parotid lymph nodes, and platysma.</li>\n<li><strong>Anteromedial surface</strong>&nbsp;- posteroinferior part of the mandibular ramus, masseter, medial pterygoid, and temporomandibular joint.</li>\n<li><strong>Posteromedial surface</strong> i- mastoid process, posterior belly of the digastric, styloid process, and the muscles attached to it.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59f9533b303f43d59003c9bd82e616a4x600x898.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false about the parotid gland?",
    "choices": [
      {
        "id": 1,
        "text": "Covered with deep fascia"
      },
      {
        "id": 2,
        "text": "Contains retromandibular vein"
      },
      {
        "id": 3,
        "text": "Develops from ectoderm"
      },
      {
        "id": 4,
        "text": "Parotid nodes lie behind the gland"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The parotid nodes lie on the <strong>superficial surface </strong>of the <strong>parotid gland</strong>.</p>\n<p>The false <strong>capsule</strong> which covers the parotid gland is derived from the <strong>investing layer</strong> of <strong>deep cervical fascia</strong>.</p>\n<p>Structures present in the parotid gland from superficial to deep are the facial nerve, retromandibular vein, and external carotid artery.</p>\n<p>The parotid gland is derived from the <strong>ectoderm</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A radiologist is performing an ultrasound of the parotid gland in a case of parotid abscess. Which of the following structures will he not visualize within the gland?",
    "choices": [
      {
        "id": 1,
        "text": "External carotid artery"
      },
      {
        "id": 2,
        "text": "Facial artery"
      },
      {
        "id": 3,
        "text": "Transverse facial artery"
      },
      {
        "id": 4,
        "text": "Retromandibular vein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Nerves:</strong></p>\n<p><strong>Facial</strong> <strong>nerve</strong> and its branches and<strong> parotid lymph nodes</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6e824f363e814025870f1ff827840f33x1280x1452.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fe71f61a744a422099fd9a77be276d7fx1280x1452.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d4ffcb5845ea43c7a6f63cf5256a75c0x600x624.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is incorrect regarding the location of the otic ganglion?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior to middle meningeal artery"
      },
      {
        "id": 2,
        "text": "Lateral to tensor veli palatini"
      },
      {
        "id": 3,
        "text": "Lateral to mandibular nerve"
      },
      {
        "id": 4,
        "text": "Inferior to foramen ovale"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Otic ganglion is a <strong>parasympathetic ganglion</strong>&nbsp;which supplies secretomotor fibres to the parotid gland and is present below the foramen ovale.&nbsp;</p>\n<ul>\n<li>Preganglionic fibres originate in the <strong>inferior salivatory nucleus</strong> and pass through the <strong>lesser petrosal nerve</strong> which is the continuation of the tympanic branch of the glossopharyngeal nerve. They relay in the otic ganglion.</li>\n<li>Postganglionic fibres pass by the communicating branches to the auriculotemporal nerve and supply the <strong>parotid gland</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b70996c4b7848c39b85875232914de8x600x535.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/66f3fcea11af405ba715eee8badeac8fx1280x2560.JPEG"
    ]
  },
  {
    "text": "Match the following with the structures they supply.",
    "choices": [
      {
        "id": 1,
        "text": "A-2, B- 4, C-3, D-1"
      },
      {
        "id": 2,
        "text": "A-3, B-1, C-4, D-2"
      },
      {
        "id": 3,
        "text": "A-3,  B-4, C-1, D-2"
      },
      {
        "id": 4,
        "text": "A-2, B-4, C-1, D-3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> otic ganglion</strong> supplies the<strong> parotid gland</strong>.</p>\n<p>The <strong>pterygopalatine ganglion</strong>&nbsp;(also known as <strong>Meckel's ganglion</strong>) supplies the <strong>lacrimal</strong> glands and <strong>palatal</strong> glands</p>\n<p>The <strong>submandibular ganglion</strong> supplies the <strong>submandibular</strong> glands and <strong>sublingual glands</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Where does the nerve passing through the marked foramen derive its parasympathetic preganglionic fibres from?",
    "choices": [
      {
        "id": 1,
        "text": "Jacobson's nerve"
      },
      {
        "id": 2,
        "text": "Nervus cochlearis"
      },
      {
        "id": 3,
        "text": "Nervus intermedius"
      },
      {
        "id": 4,
        "text": "Chorda tympani"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Note: Mandibular division of trigeminal nerve also passes through the foramen ovale. However, it does not have any parasympathetic pre-ganglionic fibres.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bfdc354c119848a5b85695e5db154bf7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9a545997e927463ca8e51df83e1b1435x1280x1783.JPEG"
    ]
  },
  {
    "text": "A medical student skipped breakfast to be able to attend his morning class. He is currently thinking about having food and coffee after class, and notices increased salivary secretion. The nerve fibres to the parotid gland responsible for this come from all except:",
    "choices": [
      {
        "id": 1,
        "text": "Otic ganglion"
      },
      {
        "id": 2,
        "text": "Greater petrosal nerve"
      },
      {
        "id": 3,
        "text": "Auriculotemporal nerve"
      },
      {
        "id": 4,
        "text": "Tympanic plexus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sympathetic</strong> supply to the parotid gland is derived from the <strong>plexus</strong> around the <strong>middle meningeal artery</strong>.</p>\n<p><strong>Sensory</strong> supply to the parotid gland is from the <strong>auriculotemporal</strong> nerve and to the parotid capsule is from the sensory fibres of greater auricular nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eeca679871634849bf7cd64fc46f7b27x1280x1783.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/46dea83774a4405d80b8c74603254a06x1280x2560.JPEG"
    ]
  },
  {
    "text": "While performing a parotid sialography, what anatomical landmark would you use to locate the Stensen's duct?",
    "choices": [
      {
        "id": 1,
        "text": "1st upper molar"
      },
      {
        "id": 2,
        "text": "2nd upper molar"
      },
      {
        "id": 3,
        "text": "1st lower molar"
      },
      {
        "id": 4,
        "text": "2nd lower molar"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Clinical significance:</strong></p>\n<p>Sialolithiasis is the presence of stones in the salivary ducts. It is more commonly seen in the submandibular gland than the parotid gland. Parotid duct stones are usually radiolucent and rarely visible on plain radiography, therefore contrast is given to perform sialography to visualize the stones on X-rays.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7386087d8a25401395056d16cf55d9c0x1280x1158.JPEG"
    ]
  },
  {
    "text": "Where is the accessory parotid gland present?",
    "choices": [
      {
        "id": 1,
        "text": "Between the parotid duct and mandible"
      },
      {
        "id": 2,
        "text": "Below the apex of the parotid gland"
      },
      {
        "id": 3,
        "text": "Above the zygomatic arch"
      },
      {
        "id": 4,
        "text": "Between the parotid duct and zygomatic arch"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>accessory parotid gland</strong> is present between the <strong>parotid duct </strong>and <strong>zygomatic arch.</strong></p>\n<p>It is usually a <strong>detached part</strong> of the parotid gland. They have their <strong>own blood supply</strong> and a <strong>secondary duct</strong> that drains into the main parotid duct.</p>\n<p><strong>Clinical significance:</strong></p>\n<ul>\n<li>They can be missed during complete parotidectomy.</li>\n<li>They can present as mid-cheek masses.</li>\n<li>The histological characteristics of accessory glands can differ from that of main gland and hence tumors arising from them can show different clinical course.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with Frey's syndrome receives a Botox injection into the skin over the parotid region. Which of the following nerves has undergone aberrant innervation in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Facial nerve"
      },
      {
        "id": 2,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 3,
        "text": "Auriculotemporal nerve"
      },
      {
        "id": 4,
        "text": "Great auricular nerve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Frey's syndrome\u00a0</strong>occurs\u00a0due to the\u00a0aberrant innervation of the <strong>auriculotemporal nerve</strong>. It is also known as gustatory sweating or auriculotemporal syndrome.</p>\n<p>It commonly develops after <strong>parotid surgery</strong> or any <strong>trauma</strong> where there is an injury to the parotid capsule.</p>\n<p>During the regrowth, an<strong> aberrant connection</strong> develops between the parasympathetic fibres supplying the\u00a0<strong>parotid gland</strong>\u00a0(<strong>auriculotemporal nerve</strong>) and the\u00a0<strong>sweat glands</strong>.</p>\n<p>This results in <strong>sweating,</strong> warmth, and <strong>redness</strong> of the face during the <strong>salivary stimulation</strong> by the smell or taste of food.</p>\n<p><strong>Management:</strong></p>\n<ul>\n<li>Antiperspirants - aluminum chloride</li>\n<li>Tympanic neurectomy</li>\n<li>Botulinum toxin injection into the affected skin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Lobes of the structure marked X are divided by ____",
    "choices": [
      {
        "id": 1,
        "text": "Mylohyoid"
      },
      {
        "id": 2,
        "text": "Genioglossus"
      },
      {
        "id": 3,
        "text": "Stylohyoid"
      },
      {
        "id": 4,
        "text": "Styloglossus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The structure marked X is the<strong> submandibular gland. Lobes</strong> of the submandibular gland are <strong>divided by</strong> the <strong>mylohyoid</strong> muscle.</p>\n<p>The submandibular gland is divided into a larger superficial and smaller deep part by the&nbsp;mylohyoid muscle. They are continuous with each other around the posterior border of the mylohyoid.</p>\n<table style=\"height: 202px;\" width=\"519\">\n<tbody>\n<tr>\n<td style=\"width: 251.875px; text-align: center;\" colspan=\"2\"><strong>Relations of the submandibular gland&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 251.875px; text-align: center;\"><strong>Superficial relations</strong></td>\n<td style=\"width: 251.875px; text-align: center;\"><strong>Deep relations</strong></td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Facial artery</td>\n<td style=\"width: 251.875px;\">Deep lingual vein</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Facial vein</td>\n<td style=\"width: 251.875px;\">Sublingual gland</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Deep lingual vein</td>\n<td style=\"width: 251.875px;\">Lingual nerve&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Submandibular ganglion</td>\n<td style=\"width: 251.875px;\">&nbsp;Hypoglossal nerve</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Cervical branch of the facial nerve</td>\n<td style=\"width: 251.875px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Glossopharyngeal nerve</td>\n<td style=\"width: 251.875px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Lingual nerve</td>\n<td style=\"width: 251.875px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 251.875px;\">Hypoglossal nerve</td>\n<td style=\"width: 251.875px;\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5398b424340744b4a3f35b640744c2d5.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0adf86f531045a89fb512fdfabe0b97x1280x1361.JPEG"
    ]
  },
  {
    "text": "Which of the following nerves is susceptible to injury in a patient undergoing a submandibular gland excision?",
    "choices": [
      {
        "id": 1,
        "text": "Mandibular nerve"
      },
      {
        "id": 2,
        "text": "Lingual nerve"
      },
      {
        "id": 3,
        "text": "Inferior alveolar nerve"
      },
      {
        "id": 4,
        "text": "Recurrent laryngeal nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>lingual nerve</strong> is susceptible to <strong>injury</strong> during <strong>excision</strong> of the <strong>submandibular gland.</strong></p>\n<p>Lingual nerve&nbsp;<strong>loops around</strong> the <strong>submandibular duct</strong>,<strong>&nbsp;</strong>and hence is susceptible to injury during the procedures involving the submandibular region.&nbsp;</p>\n<p>Superficial to the hyoglossus muscle, the submandibular duct lies between <strong>lingual </strong>and<strong> hypoglossal nerves</strong>.&nbsp;As it reaches the anterior border of the hyoglossus, it is crossed by the lingual nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dd265949e5c14612b03d3b7fada94aa4x1280x1204.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man presents with the following finding and is diagnosed with sialadenitis secondary to sialolithiasis. The stone is lodged deep within the gland, hence excision is planned. Which of the following is correct about the surgical anatomy?",
    "choices": [
      {
        "id": 1,
        "text": "The submandibular gland is seen to wrap around the posterior border of mylohyoid"
      },
      {
        "id": 2,
        "text": "Facial artery is related to the deep part of the gland"
      },
      {
        "id": 3,
        "text": "The hypoglossal nerve loops under the submandibular duct"
      },
      {
        "id": 4,
        "text": "Damage to the lingual nerve will cause loss of sensation to the posterior 1/3rd of the tongue"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given case, the swelling is present in the submandibular region, involving the&nbsp;<strong>submandibular gland.&nbsp;</strong>The gland&nbsp;is seen to wrap around the <strong>posterior border </strong>of the <strong>mylohyoid</strong>.</p>\n<p>The <strong>submandibular gland</strong> is made up of large <strong>superficial</strong> and smaller <strong>deep parts,</strong> which are continuous with each other around the posterior border of the mylohyoid.</p>\n<p>Option B: The facial artery is related to the superficial part of the gland.</p>\n<p>Option C, D: Lingual nerve loops around the submandibular duct.&nbsp;Damage to it causes loss of sensation in the anterior 2/3rd of the tongue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f8b14ea86cdf4297aee9c2ece386389f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3fd3068f2a04b60b2f63c093ac478cax1280x1361.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c126114e8224313b0f0b2d7500d9a31x1280x1204.JPEG"
    ]
  },
  {
    "text": "Where do the preganglionic fibers to the submandibular ganglion arise from?",
    "choices": [
      {
        "id": 1,
        "text": "Superior salivatory nucleus"
      },
      {
        "id": 2,
        "text": "Inferior salivatory nucleus"
      },
      {
        "id": 3,
        "text": "Nucleus of tractus solitarius"
      },
      {
        "id": 4,
        "text": "Nucleus ambiguus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Preganglionic fibres</strong> to the submandibular ganglion arise from the <strong>superior salivatory nucleus</strong>..</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4b743a02dc74100ad81bb196c6a66b1x1280x1600.JPEG"
    ]
  },
  {
    "text": "What is the extent of the thyroid gland?",
    "choices": [
      {
        "id": 1,
        "text": "B to D"
      },
      {
        "id": 2,
        "text": "A to C"
      },
      {
        "id": 3,
        "text": "A to D"
      },
      {
        "id": 4,
        "text": "C to D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<table style=\"width: 374px;\">\n<tbody>\n<tr>\n<td style=\"width: 100px; text-align: center;\" colspan=\"2\"><strong>Levels with respect to the tracheal rings and vertebra</strong></td>\n</tr>\n<tr>\n<td style=\"width: 100px;\">\n<p>Lobes of the thyroid gland</p>\n</td>\n<td style=\"width: 272px;\">\n<p>Thyroid cartilage to 4<sup>th</sup> tracheal ring</p>\n<p>Vertebral level-&nbsp;<strong>C5-T1</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 100px;\">\n<p>Isthmus of the thyroid gland</p>\n</td>\n<td style=\"width: 272px;\">\n<p>Opposite 2<sup>nd</sup> and 3<sup>rd</sup>&nbsp;tracheal rings</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/800817e2a52a490ebedba2871aad18f1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f67761092d394db59f7ade1378e28094x1280x1748.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf5f760a0d2d4e0c91c6db4db8ef4cdex1280x1056.JPEG"
    ]
  },
  {
    "text": "What does the area marked X overlie?",
    "choices": [
      {
        "id": 1,
        "text": "3rd, 4th and 5th tracheal cartilage"
      },
      {
        "id": 2,
        "text": "1st and 2nd tracheal cartilage"
      },
      {
        "id": 3,
        "text": "2nd, 3rd, and 4th tracheal cartilage"
      },
      {
        "id": 4,
        "text": "3rd and 4th tracheal cartilage"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked X is the <strong>isthmus</strong> of the <strong>thyroid</strong> gland. It overlies <strong>2nd, 3rd, and 4th</strong> tracheal rings.</p>\n<p>Isthmus connects the lower parts of both the lobes of the thyroid gland. It is usually present anterior to the 2nd and 3rd tracheal cartilages, but the position may vary according to its size.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/968451226f794569b04a3434aeef0b08.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9295552fc5124ec9971411ca14d66fa1x1280x1114.JPEG"
    ]
  },
  {
    "text": "You are an intern, scrubbed in on a thyroidectomy. You observe that the operating surgeon ligates the inferior thyroid artery close to the gland. This is done to prevent injury to which of the following structures?",
    "choices": [
      {
        "id": 1,
        "text": "Superior laryngeal nerve"
      },
      {
        "id": 2,
        "text": "Recurrent laryngeal nerve"
      },
      {
        "id": 3,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 4,
        "text": "External laryngeal nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Recurrent laryngeal nerve</strong>&nbsp;is related to the posterior branch of the <strong>inferior thyroid artery</strong> near the lobes of the thyroid gland. Therefore, during ligation of the artery, it is ligated close to the gland to prevent injury to it.&nbsp;</p>\n<p><strong>External laryngeal nerve</strong> is related to the <strong>superior thyroid artery</strong>. Superior thyroid artery pierces the thyroid fascia and supplies the upper part of the gland. The superior thyroid artery is ligated close to the gland to prevent injury to this nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/200a1f745d3c4b1da03fa57436ed0c74x1280x1114.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/17b4f855c1f540b49629ef34fcc3a243x1280x1421.JPEG"
    ]
  },
  {
    "text": "Inferior thyroid artery is a branch of ______",
    "choices": [
      {
        "id": 1,
        "text": "Thyrocervical trunk"
      },
      {
        "id": 2,
        "text": "External carotid artery"
      },
      {
        "id": 3,
        "text": "Internal carotid artery"
      },
      {
        "id": 4,
        "text": "Lingual artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Inferior thyroid artery is a branch of the&nbsp;<strong>thyrocervical trunk</strong> of the <strong>subclavian artery.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old woman underwent a thyroidectomy for a multinodular goiter. After coming out of anesthesia, the patient reports weakness of the right side of the body and is unable to speak. CT-brain showed multiple scattered air bubbles in the left hemisphere. Intraoperative injury to which of the following structures can lead to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Superior or middle thyroid vein"
      },
      {
        "id": 2,
        "text": "Middle or inferior thyroid vein"
      },
      {
        "id": 3,
        "text": "Superior or inferior thyroid vein"
      },
      {
        "id": 4,
        "text": "Superior or inferior thyroid artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case scenario is suggestive of <strong>cerebral air embolism</strong>. Intra-operative injury to the<strong> superior</strong> or<strong> middle thyroid veins</strong> causes air to get sucked into them due to the <strong>negative venous pressure. </strong>The air embolus then&nbsp;travels up through the <strong>internal</strong> <strong>jugular vein</strong> into the cerebral venous circulation. <strong>H</strong><strong>ead-down position</strong> during surgery <strong>prevents</strong> air embolism.</p>\n<p><strong>Venous drainage</strong> of the <strong>thyroid</strong> gland:</p>\n<ul>\n<li>Superior and middle thyroid veins - drain into the internal jugular vein</li>\n<li>Inferior thyroid vein - drains into the brachiocephalic vein</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are examining a case of goitre and observe that it moves with deglutition. The movement occurs due to the attachment of the thyroid gland by Berry's ligament, to which of the following structures?",
    "choices": [
      {
        "id": 1,
        "text": "Hyoid bone"
      },
      {
        "id": 2,
        "text": "Cricoid cartilage"
      },
      {
        "id": 3,
        "text": "Tracheal rings"
      },
      {
        "id": 4,
        "text": "Thyroid cartilage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>movement</strong> of the thyroid gland<strong> with deglutition</strong> is due to the attachment of Berry's ligament to the <strong>cricoid cartilage.</strong></p>\n<p><strong>Ligament of Berry:</strong></p>\n<p>The&nbsp;<strong>pretracheal fascia&nbsp;</strong>encloses the thyroid gland to form its false capsule. This <strong>capsule</strong> is <strong>thickened posteriorly</strong> and on either side forms a suspensory ligament which is known as ligament of Berry or lateral thyroid ligament. The posteromedial aspects of the lobes of the thyroid are attached to the side of the<strong> cricoid cartilage</strong> by the ligament of Berry. It&nbsp;also prevents the thyroid gland from sinking into the mediastinum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1db26c73769546cfa4272b9b3a69b030x600x560.JPEG"
    ]
  },
  {
    "text": "A 28-year-old male was rushed to the ER after a road traffic accident. He has extensive trauma to the neck, and an emergency mid-line tracheostomy was performed. All of the following structures are prone to injury except:",
    "choices": [
      {
        "id": 1,
        "text": "Isthmus of thyroid"
      },
      {
        "id": 2,
        "text": "Arteria thyroid ima"
      },
      {
        "id": 3,
        "text": "Inferior thyroid artery"
      },
      {
        "id": 4,
        "text": "Inferior thyroid vein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure that is not damaged during the emergency tracheostomy is the&nbsp;<strong>inferior thyroid artery,&nbsp;</strong>as it is not a mid-line structure.</p>\n<p><strong>Isthmus, arteria thyroid ima,</strong> <strong>inferior thyroid vein</strong> are in the midline and are prone to damage during <strong>tracheostomy</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year old female underwent total thyroidectomy and on the third postoperative day, the patient complains of numbness in her fingers and perioral area. Which of the following vessels would have been injured during the surgery?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior branch of superior thyroid artery"
      },
      {
        "id": 2,
        "text": "Posterior branch of superior thyroid artery"
      },
      {
        "id": 3,
        "text": "Superior branch of inferior thyroid artery"
      },
      {
        "id": 4,
        "text": "Inferior branch of inferior thyroid artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of postoperative&nbsp;<strong>hypoparathyroidism</strong>&nbsp;due to injury to the&nbsp;<strong>superior branch </strong>of the <strong>inferior thyroid artery</strong>.</p>\n<p>The parathyroid glands are small yellowish-brown structures lying between the <strong>posterior border</strong> of the <strong>thyroid</strong> gland and its <strong>capsule.</strong>&nbsp; There are</p>\n<ul>\n<li><strong>Two superior</strong> parathyroid glands&nbsp;</li>\n<li><strong>Two inferior</strong> parathyroid glands</li>\n</ul>\n<p>These are&nbsp;supplied by the superior branch of the <strong>inferior thyroid artery.&nbsp;</strong>They secrete <strong>parathormone</strong> which helps in the regulation of the serum calcium, by the<strong> release of calcium from bones.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/09e8328d287147098dfa4277ae09450bx600x628.JPEG"
    ]
  },
  {
    "text": "Which of the following structures prevents the upward extension of thyroid swelling through its attachment to the thyroid cartilage?",
    "choices": [
      {
        "id": 1,
        "text": "Pretracheal fascia"
      },
      {
        "id": 2,
        "text": "Sternothyroid"
      },
      {
        "id": 3,
        "text": "Thyrohyoid membrane"
      },
      {
        "id": 4,
        "text": "Ligament of berry"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Sternothyroid</strong>&nbsp;and sternohyoid prevent the upward extension of the thyroid swelling&nbsp;through its attachment to the thyroid cartilage.</p>\n<p><strong>Pretracheal fascia</strong>&nbsp;encloses the thyroid gland and is attached to the larynx. This attachment is responsible for the <strong>movement</strong> of the enlarged <strong>thyroid gland</strong> on <strong>deglutition.</strong></p>\n<p>The <strong>thyrohyoid membrane</strong>&nbsp;is a fibro-elastic ligament, which arises from the superior margin of the thyroid cartilage, and gets attached to the hyoid bone. It facilitates the <strong>upward movement </strong>of the <strong>larynx during swallowing</strong>.</p>\n<p>The <strong>ligament of Berry</strong>,&nbsp;also called the suspensory ligament extends from the cricoid cartilage to the thyroid. Its attachment <strong>prevents</strong> the thyroid gland from <strong>sinking</strong> down <strong>into</strong> the <strong>mediastinum.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6def48cabf014919b3392b51a56ce3e7x1280x1388.JPEG"
    ]
  },
  {
    "text": "The newly discovered salivary glands are predominantly present over",
    "choices": [
      {
        "id": 1,
        "text": "Soft palate"
      },
      {
        "id": 2,
        "text": "Torus tubarius"
      },
      {
        "id": 3,
        "text": "Posterior \u2154 rd of the tongue"
      },
      {
        "id": 4,
        "text": "Eustachian tube"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>newly discovered salivary glands</strong> are predominantly present over <strong>torus tubarius.</strong> Torus tubarius is the anatomical structure formed by the cartilage that supports the entrance of the auditory tube.</p>\n<p>The proposed name of these newly identified glands is <strong>tubarial salivary glands.</strong> These glands extend <strong>caudally</strong> to the <strong>pharyngeal wall</strong> and <strong>cranially</strong> to <strong>Rosenmuller's fossa.</strong></p>\n<p>Positron emission tomography/computed tomography with radio-labeled ligands to the prostate-specific membrane antigen (<strong>PSMA PET/CT</strong>) can <strong>visualize</strong> these salivary glands with high sensitivity and specificity.</p>\n<p><strong>Clinical significance:</strong></p>\n<p>It has been reported that radiotherapy over the location of these glands has led to xerostomia and dysphagia. Sparing these glands, thus, might improve the quality of life of patients receiving radiotherapy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f33273d50ac7499fb69c66f16a37db0bx1279x1328.JPEG"
    ]
  }
];
        let quizName = '31 Glands Of The Head And Neck';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>