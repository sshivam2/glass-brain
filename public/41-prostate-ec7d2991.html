<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>41 Prostate - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following are storage symptoms of BPH?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 4"
      },
      {
        "id": 2,
        "text": "2 and 5"
      },
      {
        "id": 3,
        "text": "1, 2, 4, 5"
      },
      {
        "id": 4,
        "text": "1, 2, 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Storage</strong> symptoms are seen in conditions where the bladder is <strong>irritated</strong>. <strong>Voiding</strong> symptoms are common in conditions causing bladder outlet <strong>obstruction</strong>. In <strong>benign prostatic hyperplasia</strong>, both <strong>storage</strong> and <strong>voiding</strong> symptoms are present.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man presented with fever, chills, and dysuria. On per-rectal examination, his prostate was tender and boggy. His PSA level was 7.4 ng/dl. What is the next best step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Repeat PSA"
      },
      {
        "id": 2,
        "text": "Catheterization and prostatic massage"
      },
      {
        "id": 3,
        "text": "TURP-guided biopsy"
      },
      {
        "id": 4,
        "text": "Antibiotic therapy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of<strong>\u00a0acute bacterial prostatitis </strong>and should be managed by<strong> antibiotics.</strong></p>\n<p>A\u00a0<strong>rigorous</strong> and <strong>prolonged </strong>treatment<strong>\u00a0</strong>for<strong>\u00a02-6\u00a0weeks</strong>\u00a0with an <strong>antibiotic</strong> that penetrates the prostate wall is indicated (<strong>trimethoprim,</strong>\u00a0<strong>ciprofloxacin or aminoglycoside</strong>).\u00a0Incomplete infection eradication lead to recurrent attacks and chronic prostatitis.</p>\n<p><strong>Acute bacterial prostatitis </strong>is usually\u00a0caused by an ascending urinary tract infection (UTI) or reflux of infected urine into prostatic ducts. The most common organism is<strong><em> Escherichia\u00a0coli</em>.\u00a0</strong>An associated increase in levels of PSA(&gt;4ng/ml) may be present due to prostate inflammation.</p>\n<p><strong>Catheterization</strong> and <strong>prostatic massage</strong> are\u00a0<strong>contraindicated\u00a0</strong>in patients with suspected acute prostatitis, as they increase the chance for bacteremia and sepsis. Instead, suprapubic tap should be performed to alleviate retention.</p>\n<p>Chronic bacterial prostatitis is the sequela of inadequately treated acute prostatitis.<br />Diagnosis includes:\u00a0</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Three-glass urine test</strong> - If the first glass with the initial urine sample is clear, but the <strong>second</strong> and <strong>third</strong> samples contain <strong>prostatic threads </strong>and <strong>leukocytes</strong>, it indicates the presence of <strong>prostatitis</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Digital rectal examination -\u00a0Prostate may be normal, boggy, or tender.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Prostatic fluid examination</strong> - <strong>post-prostatic massage</strong> fluid shows pus cells and bacteria.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the most common organism causing acute bacterial prostatitis?",
    "choices": [
      {
        "id": 1,
        "text": "Enterococcus"
      },
      {
        "id": 2,
        "text": "Proteus"
      },
      {
        "id": 3,
        "text": "Streptococcus Agalacticia"
      },
      {
        "id": 4,
        "text": "E.coli"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most common organism causing acute bacterial prostatitis (ABP) is <strong><em>Escherichia coli</em>.</strong></p>\n<p>It is commonly caused by an ascending urethral infection or reflux of infected urine into prostatic ducts. <strong>Sexually transmissible infections</strong> and other&nbsp;urinary pathogens,&nbsp;such as <span style=\"color: #000000;\"><em><strong>Staphylococcus aureus </strong>and<strong> Streptococcus faecalis</strong></em>&nbsp;</span>may also be responsible.</p>\n<p>The patient presents with fever, perineal pain, chills and rigor, and dysuria. Per rectal examination will reveal a <strong>tender, boggy prostate</strong>. Care should be taken to avoid aggressive palpation or prostatic massage as it can lead to <strong>bacterial dissemination</strong> and <strong>sepsis</strong>.</p>\n<p>Urine examination and culture should be done. Urine examination reveals <strong>threads</strong> in urine.</p>\n<p>Management:&nbsp;&nbsp;</p>\n<p>Patients with systemic signs of infection should be admitted for IV antibiotics, hydration, and monitoring of laboratory parameters.</p>\n<p>Patients who have no signs of systemic infection, who can tolerate oral intake, and who have no urinary retention can be treated with oral antibiotics. Antibiotics are given for <strong>2-6 weeks</strong> to ensure the eradication of the infection as antibiotics don't penetrate the prostate capsule easily.&nbsp;</p>\n<p>For outpatient therapy: <strong>Ciprofloxacin</strong> 500 mg oral every 12 hours or <strong>levofloxacin</strong> 500 mg OD or <strong>trimethoprim</strong>-<strong>sulfamethoxazole</strong> double-strength tablet oral every 12 hours can be used.</p>\n<p>For hospitalized patients: Intravenous <strong>ciprofloxacin</strong> or <strong>levofloxacin</strong> with or without an <strong>aminoglycoside</strong> (gentamicin or tobramycin) or intravenous <strong>beta-lactam</strong> with or without an aminoglycoside. Gram-positive infections are treated with cephalosporins (<strong>cephalexin</strong>, <strong>cefazolin</strong>) or <strong>dicloxacillin</strong> and <strong>vancomycin</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of following compounds form endogenous prostatic calculi?",
    "choices": [
      {
        "id": 1,
        "text": "Calcium oxalate"
      },
      {
        "id": 2,
        "text": "Calcium phosphate"
      },
      {
        "id": 3,
        "text": "Struvite"
      },
      {
        "id": 4,
        "text": "Uric acid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Corpora amylacea</strong> are benign histological findings in prostate glands. <strong>Prostatic calculi</strong> are thought to develop from the calcification of corpora amylacea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c99e9cf786964808b0a911fa2c4e0fcex440x293.JPEG"
    ]
  },
  {
    "text": "Which of the following is false regarding the medical management of benign prostatic hyperplasia?",
    "choices": [
      {
        "id": 1,
        "text": "5-alpha-reductase inhibitors take at least 6 months to act."
      },
      {
        "id": 2,
        "text": "Alpha blockers act quicker."
      },
      {
        "id": 3,
        "text": "Tamsulosin can cause abnormal ejaculation."
      },
      {
        "id": 4,
        "text": "5-alpha-reductase inhibitors act best when the gland is small."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>5-alpha-reductase inhibitors act best when the prostate is <strong>large</strong>(&gt;50g)<strong>.</strong></p>\n<p>The pathogenesis of BPH has a static and dynamic component responsible for the lower urinary tract symptoms. Conversion of <strong>testosterone to DHT</strong> is responsible for prostatic stromal hypertrophy which is the<strong> static</strong> component of BPH. The <strong>contraction of smooth muscles</strong> in the prostate is considered the <strong>dynamic</strong> component of BPH.&nbsp;</p>\n<table style=\"height: 115px; width: 759px;\">\n<tbody>\n<tr>\n<td style=\"width: 191px;\">&nbsp;</td>\n<td style=\"width: 300px;\"><strong>Alpha-blockers</strong></td>\n<td style=\"width: 274px;\"><strong>&nbsp;5-alpha-reductase inhibitors</strong></td>\n</tr>\n<tr>\n<td style=\"width: 191px;\"><strong>Mechanism of action</strong></td>\n<td style=\"width: 300px;\">Inhibit the <strong>contraction of smooth muscles</strong> in the&nbsp;prostate.</td>\n<td style=\"width: 274px;\">Inhibit the&nbsp;<strong>conversion of testosterone to dihydrotestosterone (DHT)&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 191px;\"><strong>Onset of action</strong></td>\n<td style=\"width: 300px;\">Work <strong>quickly</strong></td>\n<td style=\"width: 274px;\">To be taken for at least&nbsp;<strong>6 months</strong></td>\n</tr>\n<tr>\n<td style=\"width: 191px;\"><strong>Example</strong></td>\n<td style=\"width: 300px;\">Tamsulosin</td>\n<td style=\"width: 274px;\">Finasteride</td>\n</tr>\n<tr>\n<td style=\"width: 191px;\"><strong>Adverse effects</strong></td>\n<td style=\"width: 300px;\">\n<p>Dizziness (due to postural hypotension)</p>\n<p>Abnormal ejaculation</p>\n</td>\n<td style=\"width: 274px;\">\n<p>Dizziness</p>\n<p>Impotence&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following findings is not an indication to perform prostatectomy in patients with benign prostatic hyperplasia?",
    "choices": [
      {
        "id": 1,
        "text": "Bladder diverticula"
      },
      {
        "id": 2,
        "text": "Recurrent urinary tract infections"
      },
      {
        "id": 3,
        "text": "Residual volume of 200 ml"
      },
      {
        "id": 4,
        "text": "Increased frequency of micturition"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Increased frequency </strong>alone is <strong>not</strong> an&nbsp;<strong>indication</strong> for <strong>prostatectomy</strong>.</p>\n<p>Increasing difficulty in micturition, with considerable frequency during both day and night, delay in starting, and a poor stream are the usual symptoms for which surgery is advised.</p>\n<p><strong>Other indications</strong> include the following:</p>\n<ul>\n<li>Acute retention</li>\n<li>Chronic retention and renal impairment\n<ul>\n<li>Residual urine of <strong>&ge;200 mL</strong>&nbsp;</li>\n<li>Raised blood urea</li>\n<li>Hydroureter or hydronephrosis</li>\n</ul>\n</li>\n<li>Complications of bladder outflow obstruction\n<ul>\n<li>Stone</li>\n<li><strong>Infection</strong></li>\n<li><strong>Diverticuli</strong></li>\n</ul>\n</li>\n<li>Hemorrhage - Venous bleeding from a ruptured vein overlying the prostate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the approach for surgery of the prostate as shown in the image:",
    "choices": [
      {
        "id": 1,
        "text": "Young approach"
      },
      {
        "id": 2,
        "text": "Freyer approach"
      },
      {
        "id": 3,
        "text": "Millin approach"
      },
      {
        "id": 4,
        "text": "Transurethral approach"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the <strong>transvesical approach</strong>, also known as&nbsp;<strong>Freyer</strong>&nbsp;approach.</p>\n<p>In this approach, the bladder is opened and the prostate<strong>&nbsp;</strong>is enucleated by putting a finger into the urethra, pushing forward towards the pubes to separate the lateral lobes, and then working the finger between the adenoma and the false capsule.</p>\n<p>Among the other approaches, TURP is most commonly performed.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f1221830191e4c9bb9f5b71a1fb77f29.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3a43024c64b4b5b8e02a306610816e4x1280x1605.JPEG"
    ]
  },
  {
    "text": "As a first-year surgery resident, you have scrubbed in to assist a urologist on a TURP procedure. Up to what distal anatomical landmark do you expect him to resect?",
    "choices": [
      {
        "id": 1,
        "text": "External urethral sphincter"
      },
      {
        "id": 2,
        "text": "Prostatic utricle"
      },
      {
        "id": 3,
        "text": "Bladder neck"
      },
      {
        "id": 4,
        "text": "Verumontanum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Verumontanum</strong> is used as the <strong>distal-most border</strong> of the resection in transurethral resection of the prostate (TURP). This <strong>prevents damage</strong> to the<strong> external urethral sphincter</strong> which is located just distal to the verumontanum.</p>\n<p><strong>Damage</strong> to the <strong>external urethral sphincter</strong> leads to <strong>urinary incontinence</strong>.</p>\n<p>The <strong>bladder neck</strong> is the <strong>proximal</strong> limit of resection.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ebefeebb71af4c3a90a6522f36a26ecfx1280x1440.JPEG"
    ]
  },
  {
    "text": "A patient in your ward is scheduled for monopolar-TURP. Which of the given fluids should be used for irrigation during the procedure?",
    "choices": [
      {
        "id": 1,
        "text": "1.5 % glycine"
      },
      {
        "id": 2,
        "text": "Normal saline"
      },
      {
        "id": 3,
        "text": "N/5 saline"
      },
      {
        "id": 4,
        "text": "Distilled water"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>best irrigating fluid</strong> for <strong>M-TURP</strong> is <strong>1.5% isotonic glycine.</strong></p>\n<p><strong>M-TURP&nbsp;</strong>removes tissue with a wire loop that has an electrical current flowing in one direction (monopolar). The surgical site is irrigated with a non-conducting non-ionic fluid as the use of an <strong>ionic solution</strong> leads to dissipation of the cutting current and poor cutting efficacy. Thus,&nbsp;<strong>normal saline</strong> and <strong>N/5 saline</strong> cannot be used.</p>\n<p>The use of <strong>distilled water</strong> in TURP leads to the <strong>water-intoxication syndrome</strong>.&nbsp;</p>\n<p>Bipolar transurethral resection of the prostate (<strong>B-TURP</strong>) uses a specialized resecting loop that incorporates both the active and the return portions of the circuit on the same electrode and an ionic irrigating solution such as&nbsp;<strong>normal saline</strong>&nbsp;can be used <strong>safely</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old patient with benign prostatic hypertrophy underwent TURP.  An hour later, he was found to have an altered sensorium and had several bouts of vomiting. What is the most probable cause?",
    "choices": [
      {
        "id": 1,
        "text": "Overdose of spinal anesthetic agent"
      },
      {
        "id": 2,
        "text": "Hypernatremia"
      },
      {
        "id": 3,
        "text": "Hyperkalemia"
      },
      {
        "id": 4,
        "text": "Water intoxication"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most probable cause for the above-mentioned symptoms is <strong>water intoxication</strong>&nbsp;also known as transurethral resection of the prostate&nbsp;(<strong>TURP</strong>)<strong> syndrome</strong>.&nbsp;</p>\n<p>Absorption of water into the circulation at the time of transurethral urethral resection can lead to :</p>\n<ul>\n<li><strong>Hyponatremia</strong>, which may manifest as confusion, nausea,&nbsp;and vomiting</li>\n<li>Congestive cardiac failure</li>\n<li>Hemolysis&nbsp;</li>\n</ul>\n<p>It is managed by fluid restriction.</p>\n<p>The use of <strong>isotonic glycine</strong>&nbsp;for irrigation during resection reduces the incidence of water intoxication.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man presents with a history of minimal ejaculation at sexual climax and passing cloudy urine after. He is a known diabetic and underwent TURP 6 months ago. What is the mechanism leading to this complication?",
    "choices": [
      {
        "id": 1,
        "text": "Injury to the external urethral sphincter"
      },
      {
        "id": 2,
        "text": "Disruption of the autonomic nerve supply to the corpora of the penis"
      },
      {
        "id": 3,
        "text": "Over use of coagulating diathermy during the procedure"
      },
      {
        "id": 4,
        "text": "Bladder neck disruption"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario above suggests the patient has&nbsp;<strong>retrograde ejaculation</strong>. The most likely mechanism of its development is <strong>disruption of the bladder neck</strong>.&nbsp;</p>\n<p>Retrograde ejaculation is the <strong>most common</strong> complication of transurethral resection of the prostate (TURP).&nbsp;</p>\n<p>Option A: Injury to the external urethral sphincter causes <strong>incontinence</strong>&nbsp;following TURP.&nbsp;</p>\n<p>Option B: Disruption of the autonomic nerve supply to the corpora of the&nbsp;penis causes<strong>&nbsp;impotence</strong>.<strong>&nbsp;</strong></p>\n<p>Option C: Overuse of coagulating diathermy following TURP causes <strong>bladder neck contracture.&nbsp;</strong></p>\n<p>Other complications of TURP include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Transurethral resection of prostate (TUR) syndrome&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Primary and secondary hemorrhage</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Perforation of the bladder or the prostatic capsule&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Sepsis&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Urethral stricture</li>\n</ul>\n<div id=\"1636620480.003700\" class=\"c-virtual_list__item\" tabindex=\"0\" role=\"listitem\" data-qa=\"virtual-list-item\">\n<div class=\"c-message_kit__background p-message_pane_message__message c-message_kit__message\" role=\"presentation\" data-qa=\"message_container\" data-qa-unprocessed=\"false\" data-qa-placeholder=\"false\">\n<div class=\"c-message_kit__hover\" role=\"document\" aria-roledescription=\"message\" data-qa-hover=\"true\">\n<div class=\"c-message_kit__actions c-message_kit__actions--above\">\n<div class=\"c-message_kit__gutter\">\n<div class=\"c-message_kit__gutter__right\" role=\"presentation\" data-qa=\"message_content\">\n<div class=\"c-message_kit__blocks c-message_kit__blocks--rich_text\">\n<div class=\"c-message__message_blocks c-message__message_blocks--rich_text\">\n<div class=\"p-block_kit_renderer\" data-qa=\"block-kit-renderer\">\n<div class=\"p-block_kit_renderer__block_wrapper p-block_kit_renderer__block_wrapper--first\">\n<div class=\"p-rich_text_block\" dir=\"auto\">\n<div class=\"p-rich_text_section\">Note:Transurethral microwave thermotherapy (TUMT), Transurethral needle ablation (TUNA), and laser vaporization are less invasive methods used for the treatment of BPH. They have a decreased incidence of ejaculatory dysfunction and hemorrhage.</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On per rectal examination, which of the following findings will help you identify a malignant prostate lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Smooth surface"
      },
      {
        "id": 2,
        "text": "Firm consistency"
      },
      {
        "id": 3,
        "text": "Rectal mucosa mobile over the prostate"
      },
      {
        "id": 4,
        "text": "Presence of nodules"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Palpable <strong>nodules</strong> over the prostate is highly suggestive of carcinoma.</p>\n<table style=\"height: 127px; width: 362px;\">\n<tbody>\n<tr>\n<td style=\"width: 155.625px;\"><strong>Features of carcinoma of the prostate</strong></td>\n<td style=\"width: 209.375px;\"><strong>Features of benign disease of the prostate</strong></td>\n</tr>\n<tr>\n<td style=\"width: 155.625px;\">\n<ul>\n<li><strong>Hard\u00a0</strong>consistency</li>\n<li><strong>Rectal mucosa immobile\u00a0</strong>over the prostate</li>\n<li><strong>Obliteration of the median groove</strong></li>\n<li>Nodular surface</li>\n</ul>\n</td>\n<td style=\"width: 209.375px;\">\n<ul>\n<li><strong>Firm</strong> consistency</li>\n<li><strong>Rectal mucosa mobile </strong>over the prostate</li>\n<li><strong>Residual urine may be felt</strong> as a fluctuating swelling above the prostate</li>\n<li>Smooth surface</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68- year-old patient presents with difficulty in initiating micturition. A DRE reveals an enlarged nodular prostate with adherent rectal mucosa. PSA was found to be 25 ng/ml and a biopsy result was suggestive of adenocarcinoma. Which of the following statements is false regarding his condition ?",
    "choices": [
      {
        "id": 1,
        "text": "PSA is a not specific marker for the condition."
      },
      {
        "id": 2,
        "text": "Gleason score correlates with the pathological stage"
      },
      {
        "id": 3,
        "text": "It is associated with decreased % free PSA"
      },
      {
        "id": 4,
        "text": "It arises from the transitional zone of the gland."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Gleason grading</strong> may be used after biopsy to evaluate the <strong>stage</strong> of <strong>histopathological</strong> specimen. Gleason scores range from 6 to 10 where 6 is low risk for prostate cancer while 10 is high risk.<strong><br /></strong></p>\n<p><strong>PSA</strong> (prostatic specific antigen) is a glycoprotein peptidase that facilitates the liquefaction of semen. It is useful for screening and for monitoring response to therapy but is <strong>neither specific nor sensitive</strong> to the condition as it can be elevated due to <strong>old age</strong> and benign conditions such as <strong>prostatitis</strong> and <strong>BPH</strong>.</p>\n<p>Slightly elevated total PSA (between 4.0 and 10.0 ng/mL) and&nbsp;<strong>low free PSA (&lt;25%)</strong>&nbsp;is suspicious for <strong>prostate cancer.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6c9a44e8276747d0a0200f37d95ae0fex600x568.JPEG"
    ]
  },
  {
    "text": "A 63-year-old patient comes to the urology OPD with hesitancy, incomplete voiding, and pelvic pain. On a digital rectal examination, an irregularly enlarged prostate with a nodular surface is felt. The rectal mucosa does not move freely over it. A biopsy using an automated gun is planned. How many biopsy cores should be obtained?",
    "choices": [
      {
        "id": 1,
        "text": "5"
      },
      {
        "id": 2,
        "text": "8"
      },
      {
        "id": 3,
        "text": "10"
      },
      {
        "id": 4,
        "text": "12"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ideally,&nbsp;<strong>12</strong>&nbsp;systematic biopsy cores are obtained in patients with suspected prostatic cancer.</p>\n<p>A 12-core systematic biopsy that incorporates apical and far-lateral cores in template distribution allows maximum cancer detection. It also avoids detection of insignificant prostate cancers and the need of a repeat biopsy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 77-year-old man was evaluated for a nodule found on his prostate. His PSA levels were 15 ng/dl and a transrectal biopsy indicated a malignancy. Which of the following statements is false regarding its spread?",
    "choices": [
      {
        "id": 1,
        "text": "Local spread can occur to the seminal vesicles."
      },
      {
        "id": 2,
        "text": "Direct involvement of rectum is common."
      },
      {
        "id": 3,
        "text": "Obturator nodes are most commonly involved."
      },
      {
        "id": 4,
        "text": "Spread by bloodstream usually occurs to the bones."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Palpable nodules over the prostate with raised PSA are highly suggestive of carcinoma. direct involvement of the <strong>rectum</strong> is rare but it may become <strong>stenosed</strong> by the <strong>tumor infiltrating</strong> around it.</p>\n<p>Option A: Local invasion occurs upwards, first involving seminal vesicles, bladder neck, and trigone; this is followed by distal invasion to the external sphincter. Obstruction of one or both ureters can occur resulting in anuria.&nbsp;</p>\n<p>Option C: Lymph nodes involved are&nbsp;<strong>obturator</strong> lymph nodes, external iliac nodes, and occasionally retroperitoneal, mediastinal, and <strong>supraclavicular</strong> lymph nodes.&nbsp;</p>\n<p>Option D:&nbsp;Spread by the bloodstream occurs mostly to the bones; the bones involved most frequently in carcinoma of the prostate are the <strong>pelvic bones </strong>and the<strong> lower lumbar vertebrae.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 66-year-old man presents with an enlarged, hard, nodular prostate. Further investigations reveal a tumor that has extended through the prostatic capsule to the seminal vesicle. Other adjacent structures are not involved. What is the stage of his disease?",
    "choices": [
      {
        "id": 1,
        "text": "T1"
      },
      {
        "id": 2,
        "text": "T2"
      },
      {
        "id": 3,
        "text": "T3"
      },
      {
        "id": 4,
        "text": "T4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The stage of the tumor&nbsp;that has extended through the <strong>prostatic capsule</strong> to the <strong>seminal vesicle</strong> and not to other adjacent structures is <strong>T3b</strong>.</p>\n<table style=\"height: 208px; width: 350.59375px;\">\n<tbody>\n<tr style=\"height: 46px;\">\n<td style=\"width: 340.59375px; height: 46px;\" colspan=\"2\">\n<p><strong>Staging of prostate carcinoma:</strong></p>\n</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">Tx</td>\n<td style=\"width: 236.59375px; height: 36px;\">Primary tumor cannot be assessed</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 104px; height: 18px;\">T0</td>\n<td style=\"width: 236.59375px; height: 18px;\">No evidence of primary tumor</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">T1</td>\n<td style=\"width: 236.59375px; height: 54px;\">Clinically inapparent tumor. <strong>Neither palpable nor visible</strong> on imaging</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">T1a</td>\n<td style=\"width: 236.59375px; height: 36px;\">Incidental histologic finding in 5% or less of tissue resected</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">T1b</td>\n<td style=\"width: 236.59375px; height: 36px;\">Incidental histologic findings in more than 5% of tissue resected</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">T1c</td>\n<td style=\"width: 236.59375px; height: 54px;\">Tumor identified by needle biopsy (for example, because of elevated PSA level)</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 104px; height: 64px;\">T2</td>\n<td style=\"width: 236.59375px; height: 64px;\">\n<p>Tumor <strong>confined within</strong> <strong>the prostate</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 104px; height: 64px;\">T2a</td>\n<td style=\"width: 236.59375px; height: 64px;\">\n<p>Tumor involves one-half of one lobe or less</p>\n</td>\n</tr>\n<tr style=\"height: 82px;\">\n<td style=\"width: 104px; height: 82px;\">T2b</td>\n<td style=\"width: 236.59375px; height: 82px;\">\n<p>Tumor involves more than one-half of one lobe but not both lobes</p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 104px; height: 46px;\">T2c</td>\n<td style=\"width: 236.59375px; height: 46px;\">\n<p>Tumor involves both lobes</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 104px; height: 64px;\">T3</td>\n<td style=\"width: 236.59375px; height: 64px;\">\n<p>Tumors <strong>extend through the prostate capsule</strong></p>\n</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">T3a</td>\n<td style=\"width: 236.59375px; height: 36px;\">Extracapsular extension (unilateral or bilateral)</td>\n</tr>\n<tr style=\"height: 39px;\">\n<td style=\"width: 104px; height: 39px;\">T3b</td>\n<td style=\"width: 236.59375px; height: 39px;\">\n<p>Tumor invades seminal vesicle(s)</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 104px; height: 18px;\">T4</td>\n<td style=\"width: 236.59375px; height: 18px;\">Tumor is fixed or<strong> invades adjacent structures other than seminal vesicles</strong>, such as external sphincter, rectum, bladder, levator muscles, and/or pelvic wall</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 75-year-old man provisionally diagnosed with BPH underwent a TURP procedure. Histopathological exam of the resected tissue revealed a tumor involving less than 5% of the specimen. What is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Conservative"
      },
      {
        "id": 2,
        "text": "Radical prostatectomy"
      },
      {
        "id": 3,
        "text": "Radiotherapy"
      },
      {
        "id": 4,
        "text": "Androgen ablation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A <strong>tumor</strong> discovered incidentally on TURP present in <strong>&lt;5% of resected tissue</strong> is staged as <strong>T1a.&nbsp;</strong>For <strong>older men</strong>, <strong>conservative treatment</strong> is done for stage T1a prostatic carcinoma.</p>\n<p>Radical surgical treatment might be considered in younger (&lt;70 years) men with the same stage of the disease.</p>\n<table style=\"height: 208px; width: 350.59375px;\">\n<tbody>\n<tr style=\"height: 46px;\">\n<td style=\"width: 340.59375px; height: 46px;\" colspan=\"2\">\n<p><strong>Staging of prostate carcinoma:</strong></p>\n</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">Tx</td>\n<td style=\"width: 236.59375px; height: 36px;\">Primary tumor cannot be assessed</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 104px; height: 18px;\">T0</td>\n<td style=\"width: 236.59375px; height: 18px;\">No evidence of primary tumor</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">T1</td>\n<td style=\"width: 236.59375px; height: 54px;\">Clinically inapparent tumor. <strong>Neither palpable nor visible</strong> on imaging</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">T1a</td>\n<td style=\"width: 236.59375px; height: 36px;\">Incidental histologic finding in 5% or less of tissue resected</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">T1b</td>\n<td style=\"width: 236.59375px; height: 36px;\">Incidental histologic findings in more than 5% of tissue resected</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 104px; height: 54px;\">T1c</td>\n<td style=\"width: 236.59375px; height: 54px;\">Tumor identified by needle biopsy (for example, because of elevated PSA)</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 104px; height: 64px;\">T2</td>\n<td style=\"width: 236.59375px; height: 64px;\">\n<p>Tumor <strong>confined within</strong> <strong>the prostate</strong></p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 104px; height: 64px;\">T2a</td>\n<td style=\"width: 236.59375px; height: 64px;\">\n<p>Tumor involves one-half of one lobe or less</p>\n</td>\n</tr>\n<tr style=\"height: 82px;\">\n<td style=\"width: 104px; height: 82px;\">T2b</td>\n<td style=\"width: 236.59375px; height: 82px;\">\n<p>Tumor involves more than one-half of one lobe but not both lobes</p>\n</td>\n</tr>\n<tr style=\"height: 46px;\">\n<td style=\"width: 104px; height: 46px;\">T2c</td>\n<td style=\"width: 236.59375px; height: 46px;\">\n<p>Tumor involves both lobes</p>\n</td>\n</tr>\n<tr style=\"height: 64px;\">\n<td style=\"width: 104px; height: 64px;\">T3</td>\n<td style=\"width: 236.59375px; height: 64px;\">\n<p>Tumors <strong>extend through the prostate capsule</strong></p>\n</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 104px; height: 36px;\">T3a</td>\n<td style=\"width: 236.59375px; height: 36px;\">Extracapsular extension (unilateral or bilateral)</td>\n</tr>\n<tr style=\"height: 39px;\">\n<td style=\"width: 104px; height: 39px;\">T3b</td>\n<td style=\"width: 236.59375px; height: 39px;\">\n<p>Tumor invades seminal vesicle(s)</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 104px; height: 18px;\">T4</td>\n<td style=\"width: 236.59375px; height: 18px;\">Tumor is fixed or<strong> invades adjacent structures other than seminal vesicles</strong>, such as external sphincter, rectum, bladder, levator muscles, and/or pelvic wall</td>\n</tr>\n</tbody>\n</table>\n<table style=\"height: 122px; width: 385.140625px;\">\n<tbody>\n<tr>\n<td style=\"width: 367.140625px;\" colspan=\"3\"><strong>Management of Prostatic Carcinoma</strong>&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 148px;\"><strong>Stage of cancer</strong></td>\n<td style=\"width: 148px;\"><strong>Age &gt; 70 or Gleason score=6</strong></td>\n<td style=\"width: 71.140625px;\"><strong>Age &lt; 70&nbsp;or&nbsp;Gleason score &gt;6 &nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 148px;\"><strong>Early prostate cancer: T1B,T2A</strong></td>\n<td style=\"width: 148px;\">Active surveillance</td>\n<td style=\"width: 71.140625px;\">Radical prostatectomy &nbsp; &nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 148px;\"><strong>Locally advanced prostate cancer: T2B, T2C, T3, T4, N1</strong></td>\n<td style=\"width: 148px;\">Brachytherapy + Androgen deprivation therapy</td>\n<td style=\"width: 71.140625px;\">Brachytherapy + Radical prostatectomy&nbsp; &nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 148px;\"><strong>Metastatic prostate cancer</strong></td>\n<td style=\"width: 219.140625px;\" colspan=\"2\">Androgen deprivation therapy&nbsp;Chemotherapy and radiotherapy (hormone-resistant&nbsp; tumor)Radiopharmaceutical therapy (hormone resistant bony metastasis)&nbsp;</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Orchidectomy is used as treatment for which of the following stages of prostate cancer?",
    "choices": [
      {
        "id": 1,
        "text": "T1c  cancer in the young"
      },
      {
        "id": 2,
        "text": "T2b cancer in the young"
      },
      {
        "id": 3,
        "text": "T2b cancer in the elderly"
      },
      {
        "id": 4,
        "text": "T1c disease in the elderly"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Orchidectomy is performed to carry out <strong>androgen ablation </strong>in the treatment of <strong>locally advanced</strong>&nbsp;disease in the elderly. It is also done to manage&nbsp;<strong>metastatic disease.</strong></p>\n<p>Bilateral orchidectomy, whether total or subcapsular, will eliminate the major source of testosterone production.&nbsp;LHRH analogs such as goserelin and buserelin along with anti-androgens such as flutamide is used to perform medical androgen ablation.</p>\n<table style=\"height: 122px;\" width=\"468\">\n<tbody>\n<tr>\n<td style=\"width: 148.671875px;\" colspan=\"3\"><strong>Management of Prostatic Carcinoma</strong></td>\n</tr>\n<tr>\n<td style=\"width: 148.671875px;\"><strong>Stage of cancer</strong></td>\n<td style=\"width: 148.671875px;\"><strong>Age &gt; 70 or Gleason score=6</strong></td>\n<td style=\"width: 148.671875px;\"><strong>&nbsp;Age &lt; 70&nbsp;or&nbsp;Gleason score &gt;6 &nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 148.671875px;\"><strong>Early prostate cancer: T1,T2A</strong></td>\n<td style=\"width: 148.671875px;\">Active surveillance</td>\n<td style=\"width: 148.671875px;\">Radical prostatectomy &nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 148.671875px;\"><strong>Locally advanced prostate cancer: T2B, T2C, T3, T4, N1</strong></td>\n<td style=\"width: 148.671875px;\">Brachytherapy + Androgen deprivation therapy</td>\n<td style=\"width: 148.671875px;\">Brachytherapy + Radical prostatectomy&nbsp; &nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 148.671875px;\"><strong>Metastatic prostate cancer</strong></td>\n<td style=\"width: 148.671875px;\" colspan=\"2\">Androgen deprivation therapy&nbsp;<br />Chemotherapy and radiotherapy (hormone-resistant&nbsp; tumor)<br />Radiopharmaceutical therapy (hormone resistant bony metastasis)&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 77-year-old man presented with worsening hip and back pain. The X-ray revealed the given lesions  The patient had undergone an orchidectomy three years ago to manage his prostatic carcinoma. However, recent serial estimations of PSA have shown an increasing trend. What is the treatment of choice for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Paclitaxel"
      },
      {
        "id": 2,
        "text": "Goserelin"
      },
      {
        "id": 3,
        "text": "Docetaxel"
      },
      {
        "id": 4,
        "text": "Radium-223"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Blastic</strong> lesions on X-Ray after surgical castration (therapeutic orchidectomy) in patients with <strong>prostatic carcinoma</strong> is suggestive of hormone-resistant <strong>bone metastasis</strong>. The treatment of choice for <strong>hormone-resistant bone metastasis</strong> is radiopharmaceutical therapy with <strong>radium-223</strong>.</p>\n<p>Radium-223 is a radioactive isotope that emits low levels of alpha-particle radiation. The alpha-particle radiation causes double-strand breaks in DNA, which kills cells. Radium-223 is a &ldquo;calcium mimetic&rdquo; that <strong>accumulates</strong> <strong>preferentially</strong> in areas of bone undergoing increased turnover, such as areas of bone metastases.</p>\n<table style=\"height: 122px; width: 390.140625px;\">\n<tbody>\n<tr>\n<td style=\"width: 315.140625px;\" colspan=\"3\"><strong>Management of Prostatic Carcinoma</strong>&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 115px;\"><strong>Stage of cancer</strong></td>\n<td style=\"width: 157px;\"><strong>Age&gt;70 or Gleason score=6</strong></td>\n<td style=\"width: 43.140625px;\"><strong>&nbsp;Age&lt;70&nbsp;or&nbsp;Gleason score&gt;6 &nbsp; &nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 115px;\"><strong>Early prostate cancer: T1, T2A</strong></td>\n<td style=\"width: 157px;\">Active surveillance</td>\n<td style=\"width: 43.140625px;\">Radical prostatectomy&nbsp; &nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 115px;\"><strong>Locally advanced prostate cancer: T2B, T2C, T3, T4, N1</strong></td>\n<td style=\"width: 157px;\">Brachytherapy + Androgen deprivation therapy</td>\n<td style=\"width: 43.140625px;\">Brachytherapy + Radical prostatectomy</td>\n</tr>\n<tr>\n<td style=\"width: 115px;\"><strong>Metastatic prostate cancer</strong></td>\n<td style=\"width: 200.140625px;\" colspan=\"2\">\n<p>Androgen deprivation therapy</p>\n<p>Chemotherapy and radiotherapy (hormone-resistant&nbsp; tumor)</p>\n<p>Radiopharmaceutical therapy (hormone-resistant bony metastasis)&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7f6877aee4df493dbb2b657aed2434b2.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following vaccines is used in the treatment of prostate cancer?",
    "choices": [
      {
        "id": 1,
        "text": "Talimogene laherparepvec"
      },
      {
        "id": 2,
        "text": "Bacillus Calmette\u2013Gu\u00e9rin"
      },
      {
        "id": 3,
        "text": "Sipuleucel-T"
      },
      {
        "id": 4,
        "text": "Algenpantucel-L"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sipuleucel-T</strong> (Provenge) is an autologous prostatic acid phosphatase (PAP)-loaded dendritic cell vaccine.&nbsp;</p>\n<p>It is approved for patients with <strong>hormone-resistant, metastatic prostate cancer</strong> with minimal or no cancer-related symptoms.</p>\n<p>Other immunotherapies in prostate cancer include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">GVAX allogeneic recombinant whole-cell vaccine</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Immune checkpoint inhibitors such as PD-1/PD-L1 inhibitor</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">CTLA-4 inhibitor</li>\n</ul>\n<p>Option A: Talimogene laherparepvec (T-VEC) has demonstrated therapeutic activity in <strong>melanoma</strong>.</p>\n<p>Option B: Bacillus Calmette&ndash;Gu&eacute;rin is used for <strong>bladder carcinoma.</strong></p>\n<p>Option D: Algenpantucel-L is used as immunotherapy in <strong>pancreatic adenocarcinoma.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is used in laser enucleation of the prostate?",
    "choices": [
      {
        "id": 1,
        "text": "Carbon dioxide laser"
      },
      {
        "id": 2,
        "text": "Nd-YAG laser"
      },
      {
        "id": 3,
        "text": "Ho-YAG laser"
      },
      {
        "id": 4,
        "text": "Argon laser"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ho-YAG laser</strong> is the most common laser used in enucleation of the prostate. The procedure is known as <strong>Holmium laser enucleation of the prostate (HoLEP).</strong></p>\n<p>Laser <strong>reduce</strong> the duration of the procedure and\u00a0the <strong>risk</strong> of<strong> harmorrhage</strong>.</p>\n<p><strong>KTPA green light laser</strong> is the best laser that can be used. It causes <strong>vaporisation</strong> of prostatic tissue. As it is <strong>hemostatic</strong> in nature, it can be safely used in patients on anticoagulants.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '41 Prostate';
        const quizFilename = '41-prostate-ec7d2991.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>