<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>031 Biochemistry Aiims 2017 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Biochemistry
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">19</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Identify the anaplerotic reaction among the following?",
    "choices": [
      {
        "id": 1,
        "text": "Conversion of pyruvate to Acetyl CoA"
      },
      {
        "id": 2,
        "text": "Conversion of pyruvate to Oxaloacetate"
      },
      {
        "id": 3,
        "text": "Conversion of pyruvate to Acetaldehyde"
      },
      {
        "id": 4,
        "text": "Conversion of pyruvate to Lactic acid"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The conversion of <strong>pyruvate to oxaloacetate</strong> is an <strong>anaplerotic reaction.\u00a0</strong>It is catalyzed by <strong>pyruvate carboxylase.</strong></p>\n<p><strong>Anaplerotic</strong> reactions are chemical reactions that form <strong>intermediates</strong> of a <strong>metabolic pathway.</strong> The above reaction is important in maintaining an adequate concentration of oxaloacetate for the condensation reaction with acetyl-CoA. If acetyl-CoA accumulates, it acts as an activator of pyruvate carboxylase and an inhibitor of pyruvate dehydrogenase, thereby ensuring an adequate supply of oxaloacetate.</p>\n<p>Other anaplerotic reactions are:</p>\n<ul>\n<li>Compounds that are <strong>metabolized to yield propionyl CoA,</strong> which can be <strong>then carboxylated and isomerized to succinyl CoA</strong>.</li>\n<li><strong>Glutamate and glutamine</strong> are important anaplerotic substrates because they yield \u03b1-ketoglutarate as a result of the reactions catalyzed by glutaminase and glutamate dehydrogenase.</li>\n<li><strong>Transamination of aspartate</strong> leads directly to the formation of oxaloacetate.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "True regarding mitochondrial DNA is:",
    "choices": [
      {
        "id": 1,
        "text": "One set from each parents"
      },
      {
        "id": 2,
        "text": "It has a higher mutation rate than nuclear DNA"
      },
      {
        "id": 3,
        "text": "It codes for more than 25% of oxidative phosphorylation proteins"
      },
      {
        "id": 4,
        "text": "It has 3 X 10^9 base pairs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The true statement is that <strong>mitochondrial DNA </strong>has a <strong>high mutation rate.</strong></p>\n<p>Mitochondrial DNA is circular and double-stranded. It has <strong>16,569 bp</strong> (that makes up approximately 1% of total cellular DNA) while nuclear DNA has 3.3 billion bp.\u00a0It has 37 genes that encode <strong>13 protein subunits </strong>of the <strong>respiratory chain </strong>(out of a total of 67 proteins) i.e. about <strong>20%</strong>. It mutates at a rate <strong>5-10 times </strong>that of <strong>nuclear DNA. </strong>Mitochondrial DNA is transmitted by <strong>maternal non-mendelian inheritance.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1d5a85ea75074782ada747316830eeb2x1280x1035.PNG"
    ]
  },
  {
    "text": "Which of the following is Thermogenic food",
    "choices": [
      {
        "id": 1,
        "text": "High fat diet"
      },
      {
        "id": 2,
        "text": "It does not depend on the macronutrients"
      },
      {
        "id": 3,
        "text": "High protein diet"
      },
      {
        "id": 4,
        "text": "High carbohydrate diet"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>A high intake of protein results in a higher rate of protein turnover, which explains the increased diet-induced thermogenesis</strong> seen in people consuming a high protein diet.&nbsp;</p>\n<p>The state of protein nutrition can be determined by measuring the difference between intake and output of nitrogenous compounds which are known as <strong>nitrogen balance</strong>.&nbsp;</p>\n<ul>\n<li>In a <strong>healthy adult,</strong> nitrogen balance is in <strong>equilibrium,</strong> when intake equals output, and there is no change in the total body content of protein.</li>\n<li>In a <strong>growing child, a pregnant woman</strong>, the excretion of nitrogenous compounds is less than the dietary intake of nitrogen in the body as protein&mdash; <strong>positive nitrogen balance.</strong></li>\n<li>In response to<strong><strong> trauma or infection</strong>, </strong>or if the intake of protein is inadequate to meet requirements, there is the net loss of protein nitrogen from the body&mdash;negative nitrogen balance.</li>\n</ul>\n<p>A high intake of protein does not lead to positive nitrogen balance; although it increases the rate of protein synthesis, it also increases the rate of protein catabolism, so that nitrogen equilibrium is maintained with a higher rate of protein turnover.&nbsp;</p>\n<p>Both protein synthesis and catabolism are ATP expensive, hence the increased diet-induced thermogenesis seen in people consuming a high protein diet.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Klenow fragment lacks the activity of",
    "choices": [
      {
        "id": 1,
        "text": "3'\u21925' Exonuclease"
      },
      {
        "id": 2,
        "text": "5'\u21923' Exonuclease"
      },
      {
        "id": 3,
        "text": "5'\u21923' DNA polymerase"
      },
      {
        "id": 4,
        "text": "3'\u21925' DNA polymerase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Klenow fragment lacks<strong>\u00a05\u2019 \u2192 3\u2019 exonuclease</strong> activity.</p>\n<p><strong>DNA polymerase I</strong> is an enzyme involved in DNA replication. It has polymerase activity along with <strong>both 3' \u2192 5' </strong>and <strong>5' \u2192 3' exonuclease activity</strong>. When the 5' \u2192 3' exonuclease domain is <strong>removed</strong>, the remaining fragment is called <strong>Klenow fragment</strong>. It retains the polymerization and proofreading activities of DNA polymerase I.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In SCID, what type of DNA repair is defective:",
    "choices": [
      {
        "id": 1,
        "text": "Base excision repair"
      },
      {
        "id": 2,
        "text": "Nucleotide excision repair"
      },
      {
        "id": 3,
        "text": "Mismatch Repair"
      },
      {
        "id": 4,
        "text": "Non-homologous end joining repair"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>SCID</strong> is due to defective <strong>non-homologous end joining repair</strong>.</p>\n<p><strong>Defects in DNA Repair:</strong></p>\n<table style=\"height: 190px;\" width=\"339\">\n<tbody>\n<tr>\n<td style=\"width: 161px;\"><strong>Non-Homologous End Joining Repair</strong></td>\n<td style=\"width: 162px;\">Severe combined immunodeficiency disease (SCID)</td>\n</tr>\n<tr>\n<td style=\"width: 161px;\"><strong>Homologous Repair</strong></td>\n<td style=\"width: 162px;\">Bloom syndrome Werner syndrome Breast cancer susceptibility</td>\n</tr>\n<tr>\n<td style=\"width: 161px;\"><strong>Nucleotide Excision Repair</strong></td>\n<td style=\"width: 162px;\">Xeroderma pigmentosum</td>\n</tr>\n<tr>\n<td style=\"width: 161px;\"><strong>Mismatch Repair</strong></td>\n<td style=\"width: 162px;\">Hereditary nonpolyposis colorectal cancer (HNPCC)</td>\n</tr>\n<tr>\n<td style=\"width: 161px;\"><strong>Base Excision Repair</strong></td>\n<td style=\"width: 162px;\">\n<p class=\"textbox\" dir=\"ltr\">MUTYH-associated polyposis (MAP)</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy rapidly develops hypoglycemia after moderate activity. Blood examination reveals raised levels of ketone bodies, lactic acid, and triglycerides. On examination, the liver and kidneys are found to be enlarged. Histopathology of the liver shows deposits of glycogen in an excess amount. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "von Gierke\u2019s disease"
      },
      {
        "id": 2,
        "text": "Pompe\u2019s disease"
      },
      {
        "id": 3,
        "text": "McArdle\u2019s disease"
      },
      {
        "id": 4,
        "text": "Cori\u2019s disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given features are consistent with <strong>v</strong><strong>on Gierke's disease.</strong> It is the\u00a0most common glycogen storage disease.</p>\n<p>Enzyme deficient in this condition is\u00a0<strong>glucose-6-phosphatase</strong> (common to both glycogenolysis and gluconeogenesis). Inheritance is autosomal recessive.\u00a0</p>\n<p>Von Gierke disease (type I glycogen storage disorder) occurs due to the <strong>deficiency</strong> of <strong>glucose-6-phosphatase</strong> enzyme in the <strong>liver, kidney,</strong> and <strong>intestinal</strong> mucosa. Patients present commonly by 3-4 months of age with <strong>hypoglycemia</strong> (leading to seizures), <strong>lactic acidosis,</strong> and <strong>hepatomegaly.</strong> Affected children often have a <strong>doll-like face</strong> with fat cheeks, relatively thin extremities, short stature, and a protuberant abdomen due to massive hepatomegaly. The kidneys are also enlarged, whereas the spleen and heart are not involved. Laboratory findings include hypoglycemia, lactic acidosis, <strong>hyperuricemia,</strong> and <strong>hyperlipidemia.</strong></p>\n<p>A definitive <strong>diagnosis</strong> is made using a <strong>liver biopsy. Fructose</strong> and <strong>galactose restriction</strong> in the diet is advised.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which one of the following is not involved in iron metabolism:",
    "choices": [
      {
        "id": 1,
        "text": "Ceruloplasmin"
      },
      {
        "id": 2,
        "text": "Hepcidin"
      },
      {
        "id": 3,
        "text": "Transthyretin"
      },
      {
        "id": 4,
        "text": "Transferrin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Hepcidin, ceruloplasmin, and transferrin </strong>are involved in iron metabolism.</li>\n<li><strong>Transthyretin transports thyroxine and retinol-binding protein</strong> and has no role in iron metabolism</li>\n</ul>\n<p><strong>Proteins involved in iron metabolism</strong>:</p>\n<ul>\n<li>Ferritin and hemosiderin: Iron storage</li>\n<li><strong>Transferrin</strong>: Iron transport</li>\n<li><strong>Ceruloplasmin</strong>: a copper-containing enzyme with ferroxidase activity</li>\n<li><strong>Hepcidin</strong>: Chief regulator of systemic iron homeostasis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following amino acids is not formed after post-translational modification?",
    "choices": [
      {
        "id": 1,
        "text": "Selenocysteine"
      },
      {
        "id": 2,
        "text": "Triiodothyronine"
      },
      {
        "id": 3,
        "text": "Hydroxy proline"
      },
      {
        "id": 4,
        "text": "Hydroxylysine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Selenocysteine,</strong> the 21<sup>st</sup> amino acid, is formed by <strong>co-translational modification</strong>.\u00a0It is coded by the <strong>UGA codon</strong>, which is normally a stop codon<strong>.\u00a0</strong>The protein synthetic apparatus can identify a selenocysteine-encoding UGA by the presence of the selenocysteine insertion sequence <strong>(SECIS)</strong> in the untranslated region of mRNA.\u00a0</p>\n<p>Selenocysteine is an analog of cysteine and is synthesized from serine.</p>\n<p>Selenocysteine is present at the active site of several human enzymes that catalyze redox reactions such as <strong>thioredoxin reductase, glutathione peroxidase, and deiodinase.\u00a0</strong>Since Glutathione peroxidase contains selenocysteine and hence it is an <strong>antioxidant.</strong></p>\n<p>Impairments in human selenoproteins have been implicated in tumorigenesis and atherosclerosis and are associated with selenium deficiency cardiomyopathy (Keshan disease).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which test will be positive in starvation state in urine?",
    "choices": [
      {
        "id": 1,
        "text": "Benedict test and heat coagulation test"
      },
      {
        "id": 2,
        "text": "Heat coagulation test"
      },
      {
        "id": 3,
        "text": "Rothera's test"
      },
      {
        "id": 4,
        "text": "Heat coagulation test and Rothera's test"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Detectable levels of <strong>ketone bodies in urine</strong> (ketonuria) are seen in conditions characterized <strong>by increased ketogenesis</strong> <strong>such as starvation</strong>. The urine test done for ketone bodies is the Rothera&rsquo;s test in which formation of a purple ring indicates presence of ketone bodies.&nbsp;<strong>Gerhardt&rsquo;s test</strong> is also done to detect<strong> ketone bodies</strong> in urine.</p>\n<p>Benedict&rsquo; test done for reducing sugars.</p>\n<p>Heat coagulation test done for proteins.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the marked bond:",
    "choices": [
      {
        "id": 1,
        "text": "Ionic bond"
      },
      {
        "id": 2,
        "text": "Covalent bond"
      },
      {
        "id": 3,
        "text": "Hydrogen bond"
      },
      {
        "id": 4,
        "text": "Phosphodiester Bond"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The marked bond represents a <strong>hydrogen bond</strong> between <strong>thymine</strong> and <strong>adenine</strong>.</p>\n<p>The <strong>complementary nitrogenous bases</strong> of the 2 strands of the DNA double helix are linked by <strong>hydrogen bonds</strong>. Adenine and thymine are linked by <strong>two</strong> hydrogen bonds\u00a0<strong>(A=T) </strong>whereas<strong>\u00a0three</strong> hydrogen bonds are present between cytidine and guanine <strong>(C</strong><strong>\u2261G). </strong><strong>Van der Waals </strong>and <strong>hydrophobic interactions </strong>are present between the stacked <strong>adjacent base pairs.</strong></p>\n<p>A <strong>\u03b2-N-glycosidic\u00a0</strong>bond is present between the <strong>nitrogenous base</strong> and<strong> deoxyribose sugar</strong>. C1 of deoxyribose/ribose sugar is joined covalently to <strong>N1 of pyrimidines</strong> and <strong>N9 of purines</strong> by \u03b2-N-glycosidic bond. An <strong>ester bond</strong> is present between the sugar and phosphate group of the same nucleotide. An <strong>acid anhydride</strong> bond is present between two phosphate groups.</p>\n<p>A polymer of <strong>nucleotides</strong> is joined by\u00a0<strong>3\u2019-5\u2019 phosphodiester bond.</strong> The bond is present between the sugar of one nucleotide\u00a0and the phosphate\u00a0group of another.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dc66b66b3b064d81bf38e8d71be06f83.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/411eab63632c4eeb92f023b9736d29c6x800x400.JPEG"
    ]
  },
  {
    "text": "Which among the following serves as cofactor for Glycogen phosphorylase:",
    "choices": [
      {
        "id": 1,
        "text": "Thiamine"
      },
      {
        "id": 2,
        "text": "Niacin"
      },
      {
        "id": 3,
        "text": "Pyridoxal Phosphate"
      },
      {
        "id": 4,
        "text": "Biotin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Pyridoxal phosphate</strong> is a <strong>cofactor of glycogen phosphorylase</strong>, where the phosphate group is catalytically important.</li>\n<li><strong>PLP</strong> also acts as the coenzyme for many enzymes involved in amino acid metabolism, especially <strong>transamination and decarboxylation</strong>.</li>\n<li><strong>Glycogen phosphorylase</strong> is a debranching enzyme which cleaves alpha-1,4 bonds of the glycogen chain to produce glucose-1-phosphate in glycogenolysis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bcf6d2bd79a442cd99e6bad2f8b5480cx800x202.PNG"
    ]
  },
  {
    "text": "Glucosamines are used in which of the following conditions:",
    "choices": [
      {
        "id": 1,
        "text": "Arthritis"
      },
      {
        "id": 2,
        "text": "Niemann Pick disease"
      },
      {
        "id": 3,
        "text": "Alzheimer\u2019s disease"
      },
      {
        "id": 4,
        "text": "Cancer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The combined use of glucosamine sulfate and chondroitin sulfates in the treatment of degenerative joint disease has become an extremely popular supplementation protocol in&nbsp;<strong>arthritic</strong>&nbsp;conditions of the joints.</p>\n<ul>\n<li><strong>Glucosamines </strong>are <strong>amino sugars</strong> which form the major component of glycosaminoglycans. (GAG&rsquo;s are tandem repeats of amino sugar and uronic acid)</li>\n<li><strong>GAG&rsquo;s combine with proteins</strong> to form <strong>proteoglycans</strong></li>\n<li>One such proteoglycan is <strong>aggrecan </strong>containing several GAGs (hyaluronic acid, chondroitin sulphate, and keratan sulphate) and both link and core proteins</li>\n<li><strong>Aggrecan is the major proteoglycan in cartilage</strong></li>\n<li>Hence, from this we can deduce that <strong>glucosamines</strong> being a major part of GAG&rsquo;s and proteoglycans such as aggrecan are <strong>protective against arthritis.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following site does the restriction enzyme act when RFLP is used in-order to identify the five different species of staphylococci in a surgical ICU?",
    "choices": [
      {
        "id": 1,
        "text": "ATGGAC-TACGTG"
      },
      {
        "id": 2,
        "text": "GATATC- CTATAG"
      },
      {
        "id": 3,
        "text": "TAGATA-ATCTCT"
      },
      {
        "id": 4,
        "text": "AATATA-TATAAT"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Restriction endonuclease </strong>enzymes act at <strong>specific palindromic sequences</strong> that create DNA fragments of different lengths. By analyzing the fragments, specific species of bacteria can be identified. Option B is the only palindromic sequence here, hence it is the answer.</p>\n<p>RFLP is a restriction fragment length polymorphism (RFLP) analysis technique that involves cutting a particular region of DNA with known variability, with restriction enzymes, then separating the DNA fragments by agarose gel electrophoresis and determining the number of fragments and relative sizes.\u00a0</p>\n<p><strong>Cleavage</strong> of a <strong>sample</strong> of <strong>DNA</strong>\u00a0with a\u00a0<strong>restriction enzyme</strong>\u00a0produces a\u00a0characteristic set of <strong>smaller DNA fragments</strong>. Deviations in the normal product pattern, produce RFLPs that occur if a mutation renders a restriction site unrecognizable and alternatively, generates a new recognition site.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Thiamine deficiency results in decreased\u200b energy production, because TPP _______",
    "choices": [
      {
        "id": 1,
        "text": "Interferes with alcohol metabolism"
      },
      {
        "id": 2,
        "text": "Interferes  with transketolase activity"
      },
      {
        "id": 3,
        "text": "Is coenzyme for pyruvate and alpha ketoglutarate dehydrogenase"
      },
      {
        "id": 4,
        "text": "Interferes with energy production from amino acids"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Thiamine deficiency results in decreased energy production because thiamine pyrophosphate (TPP) is a coenzyme of pyruvate and\u00a0\u03b1-ketoglutarate dehydrogenase, which are required for the production of ATP using NADH.</p>\n<p>Thiamine pyrophosphate is an important coenzyme in three multienzyme complexes that catalyze oxidative decarboxylation reactions:</p>\n<ul>\n<li><strong>Pyruvate dehydrogenase</strong> in carbohydrate metabolism.</li>\n<li><strong>\u03b1-ketoglutarate dehydrogenase</strong>\u00a0in the citric acid cycle.</li>\n<li><strong>Branched-chain ketoacid dehydrogenase</strong> involved in the metabolism of leucine, isoleucine and valine.</li>\n</ul>\n<p>NAD is a co-factor in pyruvate and \u03b1-ketoglutarate dehydrogenase. Hence in thiamine deficiency, there is decreased ATP production owing to reduced NADH entering into the electron transport chain.</p>\n<p><strong>Option A:</strong>\u00a0Thiamine does not interfere in alcohol metabolism but alcohol\u00a0interferes directly with the absorption of thiamine and with the synthesis of thiamine pyrophosphate.</p>\n<p><strong>Option B:</strong> Thiamine is also the coenzyme for transketolase in the pentose phosphate pathway (HMP shunt) but there is no ATP synthesized in this pathway.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young patient came with complaints of acute abdominal pain on and off and tingling sensation of limbs and at times weakness of limbs. She had a history of eating paint from the wall of a newly built house.  Which of the following enzyme defect will be the cause of her condition?",
    "choices": [
      {
        "id": 1,
        "text": "ALA synthase"
      },
      {
        "id": 2,
        "text": "ALA dehydratase"
      },
      {
        "id": 3,
        "text": "Heme synthase"
      },
      {
        "id": 4,
        "text": "Coproporphyrinogen oxidase"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:\u00a0</p>\n<p>Option A: <strong>ALA synthase 2 </strong>defect causes X-linked protoporphyria.\u00a0<br />Option C: <strong>Heme synthase</strong>, or ferrochelatase, defect causes erythropoeitic protoporphyria.\u00a0<br />Option D:\u00a0<strong>Coproporphyrinogen oxidase\u00a0</strong>defect causes hereditary corproporphyria.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b98b5f3f140340c3be0a305fa0fd4771x1280x1525.JPEG"
    ]
  },
  {
    "text": "Under anaerobic metabolism which of the following substrates yields 3 molecules of ATP?",
    "choices": [
      {
        "id": 1,
        "text": "Glycogen"
      },
      {
        "id": 2,
        "text": "Amino acid"
      },
      {
        "id": 3,
        "text": "Glucose"
      },
      {
        "id": 4,
        "text": "Galactose"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The first step in glycolysis involves the conversion of glucose to glucose-6-phosphate which requires one ATP. Glycogen breakdown leads to formation of glucose-6-phosphate which can enter glycolysis hence bypassing the first step and saving one ATP.</p>\n<table style=\"height: 195px; width: 492px;\" width=\"669\">\n<tbody>\n<tr>\n<td style=\"width: 129.633px;\"><span style=\"font-size: 10pt;\">REACTION</span></td>\n<td style=\"width: 105.047px;\"><span style=\"font-size: 10pt;\">ENZYME</span></td>\n<td style=\"width: 124.938px;\"><span style=\"font-size: 10pt;\">METHOD OF ATP FORMATION</span></td>\n<td style=\"width: 76.1953px;\"><span style=\"font-size: 10pt;\">NET ATP PRODUCED</span></td>\n</tr>\n<tr>\n<td style=\"width: 129.633px;\"><span style=\"font-size: 10pt;\">1,3-bisphosphoglycerate to 3 phosphoglycerate</span></td>\n<td style=\"width: 105.047px;\"><span style=\"font-size: 10pt;\">Phosphoglycerate kinase</span></td>\n<td style=\"width: 124.938px;\"><span style=\"font-size: 10pt;\">Substrate level phosphorylation</span></td>\n<td style=\"width: 76.1953px;\"><span style=\"font-size: 10pt;\">2 ATP</span></td>\n</tr>\n<tr>\n<td style=\"width: 129.633px;\"><span style=\"font-size: 10pt;\">Phosphoenol pyruvate to Pyruvate</span></td>\n<td style=\"width: 105.047px;\"><span style=\"font-size: 10pt;\">Pyruvate kinase</span></td>\n<td style=\"width: 124.938px;\"><span style=\"font-size: 10pt;\">Substrate level phosphorylation</span></td>\n<td style=\"width: 76.1953px;\"><span style=\"font-size: 10pt;\">2 ATP</span></td>\n</tr>\n<tr>\n<td style=\"width: 129.633px;\">\u00a0</td>\n<td style=\"width: 105.047px;\">\u00a0</td>\n<td style=\"width: 124.938px;\"><span style=\"font-size: 10pt;\">TOTAL PRODUCED</span></td>\n<td style=\"width: 76.1953px;\"><span style=\"font-size: 10pt;\">4 ATP</span></td>\n</tr>\n</tbody>\n</table>\n<p>One ATP is used for conversion of fructose-6-phosphate to fructose 1,6 biphosphate hence net ATP formed from anaerobic glycolysis of glycogen is 3ATP</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/87b3d4869f354b6dae3fcffa6315307bx1280x2966.JPEG"
    ]
  },
  {
    "text": "Which of the following is the reason for using phenylbutyrate in urea cycle disorders?",
    "choices": [
      {
        "id": 1,
        "text": "It maintains renal output"
      },
      {
        "id": 2,
        "text": "It scavenges nitrogen"
      },
      {
        "id": 3,
        "text": "It maintains energy production"
      },
      {
        "id": 4,
        "text": "It activates enzymes"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Phenylbutyrate scavenges nitrogen</strong> by combining with amino acids to form a more water-soluble product, which can be easily excreted by the kidneys.&nbsp;</p>\n<p>Phenylbutyrate combines with glutamate to form pheynylbutylglutamine.</p>\n<p>Other substances that can be used as nitrogen scavengers are:</p>\n<ul>\n<li>Combination of benzoate (forms hippurate on combining with endogenous glycine)</li>\n<li>Phenylacetate (forms phenylacetylglutamine on combining with glutamate) available as ammonia.</li>\n<li>Arginine is also useful.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following can alter the gene expression by methylation and acetylation but not change the gene sequence?",
    "choices": [
      {
        "id": 1,
        "text": "Mutation"
      },
      {
        "id": 2,
        "text": "Epigenetics"
      },
      {
        "id": 3,
        "text": "Translocation"
      },
      {
        "id": 4,
        "text": "Inversion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Epigenetics is defined as heritable changes in gene expression that are not caused by alteration in gene sequence.</strong><br />It means &ldquo;above genetics&rdquo; and refers to the fact that gene regulatory mechanisms do not change the underlying regulated DNA sequence, but rather simply the expression patterns of the DNA.</p>\n<p><br />Epigenetic mechanisms play a key role in establishment, maintenance, and reversibility of transcriptional states. A key feature is that the controlled transcriptional on/off states can be maintained through multiple rounds of cell division. This observation indicates there must be robust mechanisms to maintain and stably propagate these epigenetic states.</p>\n<p><br />Histone <strong>M</strong>ethylation Mostly Makes DNA <strong>M</strong>ute.<br />Histone <strong>A</strong>cetylation: Relaxes DNA coiling, allowing for transcription. Histone Acetylation makes DNA<strong> A</strong>ctive.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not seen in low insulin-glucagon ratio?",
    "choices": [
      {
        "id": 1,
        "text": "Glycogen breakdown"
      },
      {
        "id": 2,
        "text": "Ketogenesis"
      },
      {
        "id": 3,
        "text": "Glycogen storage"
      },
      {
        "id": 4,
        "text": "Gluconeogenesis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A<strong> low insulin/glucagon ratio</strong> indicates low insulin and high glucagon levels, which are observed in the\u00a0<strong>fasting</strong> state. In the fasting state, all of the above processes (i.e., glycogen breakdown, ketogenesis, and gluconeogenesis) occur, but not glycogen storage.</p>\n<table style=\"width: 364px;\">\n<tbody>\n<tr>\n<td style=\"width: 122px;\">\n<p><strong>Metabolic process</strong></p>\n</td>\n<td style=\"width: 124px;\">\n<p><strong>Fasting state/ low insulin-glucagon ratio</strong></p>\n</td>\n<td style=\"width: 106px;\">\n<p><strong>Fed state/ high insulin-glucagon ratio </strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">\n<p>Gluconeogenesis</p>\n</td>\n<td style=\"width: 124px;\">\n<p>Increased</p>\n</td>\n<td style=\"width: 106px;\">\n<p>Decreased</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">\n<p>Glycogenolysis</p>\n</td>\n<td style=\"width: 124px;\">\n<p>Increased</p>\n</td>\n<td style=\"width: 106px;\">\n<p>Decreased</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">\n<p>Ketogenesis</p>\n</td>\n<td style=\"width: 124px;\">\n<p>Increased</p>\n</td>\n<td style=\"width: 106px;\">\n<p>Decreased</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\">\n<p>Glycogen storage</p>\n</td>\n<td style=\"width: 124px;\">\n<p>Decreased</p>\n</td>\n<td style=\"width: 106px;\">\n<p>Increased</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '031 Biochemistry Aiims 2017';
        let hierarchy = ["Marrow", "PYQs", "Biochemistry"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>