<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiology Mini Test - Medicine And Allied Subjects, Obg - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The plain x-ray shows a particular change in ribs. This is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Coarctation of aorta"
      },
      {
        "id": 2,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 3,
        "text": "Osteogenesis imperfecta"
      },
      {
        "id": 4,
        "text": "Rheumatoid arthritis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The x-ray depicts the&nbsp;<strong>inferior rib notching,&nbsp;</strong>which is a finding associated with&nbsp;<strong>coarctation of the aorta.</strong></p>\n<p>Coarctation of the aorta is the&nbsp;narrowing/constriction of the aorta most commonly occurring at origin of ductus arteriosis. It can also be seen preductal or post ductal and is associated with Turner syndrome.</p>\n<div class=\"page\" title=\"Page 4163\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Preductal </strong>or<strong> infantile</strong> type has severe coarctation&nbsp;become symptomatic as soon as the duct begins to close. Differential cyanosis and <strong>radial-femoral delay</strong> are classic signs.</p>\n</div>\n</div>\n</div>\n<p><strong>Adult</strong> or <strong>juxta ducta</strong>l is usually mild and goes unnoticed until adolescence. They present as weakness, pain or<strong> claudication</strong> in legs after exercise,&nbsp;hypertension in the upper extremities with&nbsp;weak pulses and hypotension in the lower extremities.</p>\n<div class=\"page\" title=\"Page 4164\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Roesler sign-Notching</strong> of the <strong>inferior margin</strong> of the ribs(4th-8th) from pressure erosion by enlarged <strong>collateral</strong> vessels is common by late childhood.&nbsp;</p>\n<p><strong>A figure of 3 sign </strong>(Reverse 3) is a contour abnormality of the aorta as shown below.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3230e684758d432b980dff92cd9f001e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c30e24d3fd5147cfb198f30738c006e4x1024x1024.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman who is in her 12th week of gestation was referred to you by an obstetrician for sonographic evaluation. You notice the following sign on USG. Identify the sign and the type of twin gestation it indicates.",
    "choices": [
      {
        "id": 1,
        "text": "T-sign, monochorionic diamniotic"
      },
      {
        "id": 2,
        "text": "T-sign, dichorionic diamniotic"
      },
      {
        "id": 3,
        "text": "Lambda sign, monochorionic diamniotic"
      },
      {
        "id": 4,
        "text": "Lambda sign, dichorionic diamniotic"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows the<strong> lambda sign</strong> or <strong>twin peak sign</strong> seen in <strong>dichorionic diamniotic pregnancy</strong>.</p>\n<p>Chorionicity of the placenta is best diagnosed by ultrasound at 10\u201313 weeks of gestation. In dichorionic twins, there is a thick septum between the two gestational sacs.</p>\n<p>A triangular projection is seen at the base of the membrane. This is known as lambda or twin peak sign. The presence of <strong>lambda or twin peak sign indicates a dichorionic placenta</strong>.</p>\n<p>The <strong>\"T sign\"</strong> seen in sonographic images signifies a <strong>monochorionic twin</strong> pregnancy, where there is a <strong>lack of chorion</strong> extending between the layers of the intertwin membrane.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5c1bfce552ce4e4aa865f973461aadcc.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3-day-old neonate presents with abdominal distension, bilious vomiting, and failure to pass meconium since birth. A contrast enema shows the following findings. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Necrotizing enterocolitis"
      },
      {
        "id": 2,
        "text": "Intussusception"
      },
      {
        "id": 3,
        "text": "Meconium ileus"
      },
      {
        "id": 4,
        "text": "Duodenal atresia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of a <strong>3-day-old</strong> presenting with <strong>abdominal distension, bilious vomiting,</strong> and <strong>failure to pass meconium, </strong>with a contrast enema showing <strong>microcolon</strong> (entire colon is small in calibre) is suggestive of <strong>meconium</strong> <strong>ileus</strong>.</p>\n<p><strong>Cystic fibrosis</strong> is the most common cause of meconium ileus. In cystic fibrosis, the <strong>malfunctioning</strong> <strong>ATP-gated chloride channels</strong> result in the formation of <strong>dense</strong> and <strong>thick meconium</strong>. This becomes lodged in the terminal ileum, leading to a <strong>blockage</strong> in the distal part of the intestine.</p>\n<p>Clinical features in a newborn include the <strong>inability</strong> to <strong>pass meconium</strong> within the <strong>initial</strong> <strong>24-48 hours</strong> after birth, accompanied by indicators of small bowel obstruction. These signs include <strong>bilious vomiting</strong> and <strong>abdominal distention</strong>.\u00a0</p>\n<p><strong>Abdominal X-ray</strong> in meconium ileus reveals <strong>dilated small bowel loops</strong> and a <strong>soap-bubble appearance</strong> in the <strong>right iliac fossa</strong>, caused by the combination of meconium and gas. Contrast enema examination shows an <strong>empty microcolon</strong>.</p>\n<p>Other options:\u00a0</p>\n<p>Option A: <strong>Necrotizing enterocolitis</strong> (NEC) is a <strong>rapidly progressive disease</strong> that causes extensive <strong>bowel necrosis, </strong>infection, and <strong>perforation</strong> in newborns. <strong>Pneumatosis intestinalis</strong> (shown below) is a radiographic finding that appears as <strong>train-track lucency</strong> within the bowel<strong> </strong>wall due to <strong>bacterial gas</strong> production. Other findings may include <strong>portal vein gas</strong> and <strong>pneumoperitoneum</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a3fc3b95278d40e1bcba6998deceb8cf.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c0efce83929417a99e38d7896bb6237x720x1122.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d81d8af7dc2c42c1847e0212ef827ddfx720x598.JPEG",
      "https://cdn1.dailyrounds.org/uploads/d36fb657e5a94b2e9b4b52b7db69ddf5.JPEG"
    ]
  },
  {
    "text": "A 34-year-old female patient presents with excessive bleeding during her menstrual cycles for the last year. Laboratory evaluation reveals iron deficiency anemia. Abdominal examination reveals an enlarged uterus corresponding to 14 weeks with an irregular contour.  Her ultrasound is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Endometrial carcinoma"
      },
      {
        "id": 2,
        "text": "Pregnant uterus"
      },
      {
        "id": 3,
        "text": "Uterine leiomyoma"
      },
      {
        "id": 4,
        "text": "Uterine adenomyosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The likely diagnosis in this patient with menorrhagia, iron deficiency anemia, and the irregular, enlarged uterus is <strong>uterine leiomyoma.</strong></p>\n<p>The image shows an ultrasound with a large fibroid within the uterine cavity.\u00a0</p>\n<p><strong>Leiomyoma</strong> or <strong>fibroid</strong> uterus are slow-growing, benign tumors of the uterus that affect women of <strong>reproductive age. </strong>They occur due to <strong>smooth muscle proliferation</strong> in response to estrogen and progesterone produced by the body.\u00a0</p>\n<p>Conditions with <strong>hormone excess</strong> such as reproductive age group, hyperestrogenism, pregnancy, and oral contraceptives are associated with increased growth of fibroids.\u00a0</p>\n<p>Fibroids are formed in the <strong>intramural</strong> (interstitial), <strong>submucous</strong>, and <strong>subserous</strong> parts of the uterus. They can also form in the <strong>extrauterine</strong> <strong>structures</strong> such as round ligament, uterosacral ligament, vagina, and vulva.\u00a0</p>\n<p>Patients usually present with <strong>menorrhagia</strong>, metrorrhagia, <strong>infertility</strong>, recurrent abortions, <strong>pain</strong>, pressure symptoms, <strong>abdominal mass</strong>, and vaginal discharge. However, many women are asymptomatic.\u00a0</p>\n<p>Fibroids can undergo secondary changes such as atrophy, calcareous degeneration, and red degeneration.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Option A -\u00a0<strong>Endometrial carcinoma</strong> is unlikely to cause irregular uterine contour. In addition, it usually occurs in older women and presents as post-menopausal bleeding.\u00a0</p>\n<p>Option B - <strong>Pregnant uterus</strong> would also be enlarged, but it would be soft, and round. She would also have a history of amenorrhea. In addition, an ultrasound will reveal the fetal anatomy.\u00a0</p>\n<p>Option D -\u00a0<strong>Uterine adenomyosis\u00a0</strong>is a condition seen frequently in elderly women (Age &gt; 40 years), which is characterized by endometrial islands in the wall of the uterus. It is similar in presentation to fibroids except that in adenomyosis, the uterus would be <strong>uniformly enlarged</strong> and would not be more than 12 to 14 weeks gestation in size.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5fb4d1a505f14327b3a7ebe1904cacab.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following investigation is shown in the radiograph?",
    "choices": [
      {
        "id": 1,
        "text": "Barium swallow"
      },
      {
        "id": 2,
        "text": "Barium meal follow through"
      },
      {
        "id": 3,
        "text": "Barium meal"
      },
      {
        "id": 4,
        "text": "Barium enema"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The contrast radiograph given above is that of <strong>barium follow-through.</strong></p>\n<p>It is useful in visualising <strong>small bowel pathology</strong>. It is performed following a barium meal examination of the oesophagus, stomach, and duodenum. It is inferior to enteroclysis where contrast is administered through NG tube. It is also used to evaluate the function of the small bowel.</p>\n<p>Barium meal examines the lower half of the esophagus, stomach, and entire duodenum.</p>\n<p><strong>Preparations and uses of Barium sulfate as a contrast in GI imaging:</strong></p>\n<ul>\n<li>Ba swallow uses barium paste (for esophagus).</li>\n<li>Ba meal - 95% BaSO4 (for stomach and duodenum).</li>\n<li>Ba meal follow through - 50% BaSO4 (for small bowel).</li>\n<li>Ba enema -25% BaSO4 (for large bowel).</li>\n<li>For Single contrast films, barium alone is used. Double-contrast films require air and barium which is better for a small mucosal lesion.</li>\n</ul>\n<p><strong>Contraindications to use of Barium:</strong></p>\n<ul style=\"list-style-type: circle;\">\n<li>Tracheoesophageal fistula: Dianosil-water soluble non-ionic agent is used.</li>\n<li>Perforation peritonitis and esophageal perforation: Iohexol is used.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4d53e70b7fb64f238e664546ee143b3e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d41b1715a91b48d2bd19db1a16c7dc5dx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f6e2f41aa2e4522bb3b8ed6ba5d3053x387x450.JPEG"
    ]
  },
  {
    "text": "A woman presents to you with a feeling of heaviness of her head, swelling on the forehead, and dull headache throughout the day. On investigating further, her serum ALP levels are raised and the following radiographic changes are seen. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Paget's disease"
      },
      {
        "id": 2,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 3,
        "text": "Multiple myeloma"
      },
      {
        "id": 4,
        "text": "Osteomyelitis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario of heaviness of head, swelling on the forehead, dull headache throughout the day, <strong>raised serum ALP</strong> levels, and the radiograph showing <strong>Tam o' Shanter sign</strong> are suggestive of&nbsp;<strong>Paget's disease.</strong></p>\n<div class=\"page\" title=\"Page 176\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Paget's bone disease (PBD) is a chronic disease of <strong>increased bone turnover</strong> in localized areas resulting in enlarged and thickened bones. There is a significant increase in osteoclastic and osteoblastic activity. It is usually asymptomatic but can present with a <strong>dull aching pain</strong> unless the disease is severe. <strong>Bowing</strong> of leg bones may occur. There is an increased risk of <strong>pathological fractures</strong> and osteosarcoma.<strong>&nbsp;Serum ALP</strong> levels may be raised or maybe normal. Treatment is done using <strong>intravenous zoledronate</strong> given as a single infusion of 4-5 mg.</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Radiographic features:&nbsp;</strong></p>\n<ul>\n<li>The early phase features the osteolytic (lucent) region which is later followed by coarse trabeculae and bony enlargement.</li>\n<li>Sclerotic changes occur much later in the disease process.&nbsp;</li>\n<li><strong>Osteoporosis circumscripta </strong>is seen as a<strong>&nbsp;</strong>large, well-defined lytic lesion</li>\n<li><strong>Cotton wool appearance&nbsp;</strong>&nbsp;is seen as a mixed lytic and sclerotic lesion of the skull</li>\n<li><strong>Tam o'Shanter sign </strong>is<strong>&nbsp;</strong>frontal bone enlargement, with the appearance of the skull falling over the facial bones.</li>\n<li><strong>Flame-shaped</strong>&nbsp;lesions- Seen in long bones due to localized osteolysis/osteopenia.&nbsp;</li>\n</ul>\n<p>The image below shows the cotton-wool appearance of the skull seen in Paget's disease:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7d4afedd35ce46d2b9f020d7a9ac0b55.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/00125f11309f4ce2a41aca620101003bx618x458.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4dfaf00f8bc54e588edb2627851ea14bx613x526.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/402bb1915c4d40fcba6af8bbb7066c91x720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6f136492a4e740f69ab307038f116255x512x513.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58647f14e86a4d0d8a7f2885e748c107x720x860.PNG"
    ]
  },
  {
    "text": "A child presented with swelling of the wrist joint. She also had perifollicular hemorrhages and ecchymosis around hair follicles. Bleeding gums were seen on examination. An x-ray of her wrist is shown below. Identify the marked sign.",
    "choices": [
      {
        "id": 1,
        "text": "Trummerfeld zone"
      },
      {
        "id": 2,
        "text": "Pelcan\u2019s spur"
      },
      {
        "id": 3,
        "text": "Wimberger's sign"
      },
      {
        "id": 4,
        "text": "Frankel's line"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>scurvy</strong> and the sign marked by the arrow is <strong>Wimberger's sign</strong>. It is a <strong>ring-shaped </strong>outline of the<strong> epiphysis.</strong></p>\n<p>Dietary deficiency of vitamin C leads to scurvy. It is common between 6 and 9 months of age. <strong>Defective osteoid production</strong> by osteoblasts with <strong>reduced endochondral bone ossification</strong> is likely to be the cause of the condition.</p>\n<p>Clinical features include <strong>bleeding</strong> into the <strong>skin</strong> which includes petechiae, ecchymosis, perifollicular hemorrhages, bleeding into <strong>joints</strong>, and bleeding <strong>gums</strong> which are mainly due to the impaired formation of connective tissue.</p>\n<p>Radiological features:</p>\n<ul>\n<li>\n<p><strong>Trummerfeld zone</strong></p>\n</li>\n<li>\n<p><strong>Frankel's line</strong> - an increased density at the&nbsp;<strong>metaphyseal ends </strong>(Option D)</p>\n</li>\n<li>\n<p><strong>Pelcan's spur</strong> - seen in the <strong>metaphysis</strong> and is prone to fracture (Option B), and</p>\n</li>\n<li><strong>Wimberger's sign -&nbsp;</strong>a pencil-shaped outline seen in the epiphysis. (Option A).</li>\n</ul>\n<p><strong>Treatment</strong> includes <strong>supplementation</strong> of vitamin C (200 mg/day).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c3b0c84937e9401dbd66cf8c973119fe.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 16-month-child is brought with a history of abdominal distension and delayed mental development. On examination, the cornea is cloudy and there appears to be hepatosplenomegaly. The radiograph of the child is given below. What is the probable diagnosis in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Tay-Sachs disease"
      },
      {
        "id": 2,
        "text": "Hurler\u2019s Syndrome"
      },
      {
        "id": 3,
        "text": "Gaucher\u2019s Disease"
      },
      {
        "id": 4,
        "text": "Hunter\u2019s Syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most probable diagnosis in this patient is <strong>Hurler's syndrome.</strong></p>\n<p>As the child presents with <strong>mental retardation, hepatosplenomegaly,</strong>&nbsp;<strong>cloudy cornea</strong> and given x-ray shows a <strong>J-shaped sella turcica and a thickened calvaria, </strong>the most likely diagnosis is<strong> Hurler's Syndrome.</strong></p>\n<p>Hurler's syndrome is also known as <strong>mucopolysaccharidosis&nbsp;1</strong>. This is due to the defect in the <strong>&alpha;-L iduronidase</strong> leading to the accumulation of <strong>heparan sulphate and dermatan sulphate</strong>.</p>\n<p>Radiological features in Hurler Syndrome:</p>\n<ul>\n<li>Macrocephaly</li>\n<li><strong>J-shaped sella </strong>(seen in above radiograph)</li>\n<li>Thickened calvaria (skull cap)</li>\n<li><strong>Oar-shaped ribs</strong> (seen below)</li>\n<li>Hook-shaped vertebral bodies</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d289ca70136741d29d1a17c8b8bc1a0e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e1359a7c84c8433a813aeb52cdb9de48x360x269.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15fb810a4a3d4dd99ac927713e5ae7fbx360x265.JPEG"
    ]
  },
  {
    "text": "What is the most probable diagnosis of the computed tomography (CT) image provided below?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary hypertension"
      },
      {
        "id": 2,
        "text": "Thoracic aorta aneurysm"
      },
      {
        "id": 3,
        "text": "Pulmonary embolism"
      },
      {
        "id": 4,
        "text": "Mural thrombus of the aorta"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image is a CT pulmonary angiography showing a <strong>pulmonary </strong>(saddle) <strong>embolism</strong>.</p>\n<p>CT pulmonary angiography using multi-detector CT is the best investigation for pulmonary embolism.\u00a0</p>\n<p>An embolus in the bifurcation of the main <strong>pulmonary artery</strong> is referred to as a <strong>saddle embolus</strong>. Pulmonary emboli (PE) originate from deep venous thromboses. Fragmented thrombi from DVTs are carried through progressively larger veins and the right side of the heart, before slamming into the pulmonary arterial vasculature.</p>\n<p>Depending on the size of the embolus, it can occlude the main pulmonary artery; straddle the pulmonary artery bifurcation (saddle embolus); or pass out into the smaller, branching arteries.</p>\n<p>The below image shows a CT thorax of saddle embolism.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2fceca3f81f94de89bf62ee866c0f36b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a7949de94e9e4def82dabb32324ba2c2x1024x806.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82603917a5b342eab3e8c13ee01da532x462x309.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59e50e72dcd4401aa466cfe03dd2748dx669x600.PNG"
    ]
  },
  {
    "text": "A newborn baby presented to the pediatrician with respiratory distress.  On examination, the infant has a scaphoid abdomen and breath sounds are decreased on both sides. The baby was born via normal vaginal delivery at term and antenatal visits were not done regularly. An X-ray of the infant is given below. Which of the following statements is true regarding the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "For small defects a porous polytetrafluoroethylene patch can be used"
      },
      {
        "id": 2,
        "text": "Extra corporeal membranous oxygenation is contraindicated"
      },
      {
        "id": 3,
        "text": "Conventional mechanical ventilation is used for managing respiratory failure"
      },
      {
        "id": 4,
        "text": "Bag and mask ventilation should be used in the initial management"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above X-ray chest shows <strong>i</strong><strong>ntra-thoracic bowel shadows</strong> along with a&nbsp;<strong>m</strong><strong>ediastinal shift</strong> suggestive of <strong>congenital diaphragmatic hernia </strong>and<strong> conventional mechanical ventilation</strong>&nbsp;is&nbsp;the main strategy used to support respiratory failure in infants with CDH.</p>\n<p>If the defect is posterolateral it is called&nbsp;<strong>Bochdalek hernia </strong>and if it's anteromedial it is called<strong> Morgagni hernia.&nbsp;&nbsp;</strong>Bochdalek hernia is the most common variant.</p>\n<p>Clinical features :</p>\n<ul>\n<li><strong>Respiratory distress</strong>&nbsp;is a cardinal sign in infants with a congenital diaphragmatic hernia (CDH).</li>\n<li><strong>Early respiratory distress, within 6 hr after birth, is thought to be a poor prognostic sign</strong>.</li>\n<li>Children with CDH may also have a&nbsp;<strong>scaphoid abdomen and increased chest wall diameter.</strong></li>\n<li>Bowel sounds may also be heard in the chest, with a&nbsp;<strong>bilateral&nbsp;decrease in breath sounds.</strong></li>\n<li>The point of maximal cardiac impulse may be displaced away from the side of a hernia if a&nbsp;<strong>mediastinal shift</strong>&nbsp;has occurred.</li>\n<li><strong>Retroperitoneal fat, left kidney, spleen&nbsp;</strong>or only the omentum commonly herniates through the defect. If the defect is large, most abdominal contents including the stomach may herniate.</li>\n</ul>\n<p><strong>Diagnosis:</strong></p>\n<ul>\n<li>Chest radiography and passage of a nasal gastric tube confirm the diagnosis.</li>\n<li>CDH can be diagnosed on&nbsp;<strong>prenatal ultrasonography (between 16 and 24 weeks of gestation)</strong></li>\n<li>High-speed fetal magnetic resonance imaging (MRI) can further define the lesion.</li>\n</ul>\n<p><strong>Differential</strong>&nbsp;<strong>diagnosis</strong>:</p>\n<ul>\n<li>Diaphragmatic eventration</li>\n<li>Cystic adenomatoid malformation</li>\n<li>Bronchogenic cyst</li>\n<li>Cystic teratoma</li>\n</ul>\n<p><strong>Treatment:</strong></p>\n<p>Variable period of time (24-72 hours) to allow for stabilization before surgical repair. Immediate respiratory support should be provided, including rapid endotracheal intubation and sedation.&nbsp;</p>\n<p>Bag and Mask Ventilation&nbsp;is&nbsp;<strong>contraindicated&nbsp;</strong>in newborns with congenital diaphragmatic hernia because it&nbsp;causes&nbsp;<strong>distension of the stomach</strong>&nbsp;which in turn may limit the expansion of the already&nbsp;<strong>hypoplastic lung</strong>.</p>\n<p>During surgery, the viscera are reduced into the abdominal cavity, and the posterolateral defect in the diaphragm is closed using interrupted, nonabsorbable sutures.</p>\n<p>In most cases (80%-90%), a hernia sac is not present. If identified, it is excised at the time of repair.</p>\n<p>Conventional mechanical ventilation, high-frequency oscillatory ventilation (HFOV), and extracorporeal membrane oxygenation (<strong>ECMO</strong>) are the 3 main strategies to support respiratory failure in the newborn with CDH.</p>\n<p><strong>Good relative indicators</strong> of stability are as follows:</p>\n<ul>\n<li>Requirement for conventional ventilation only</li>\n<li>Low peak inspiratory pressure</li>\n<li><strong>Fi-O2 &lt;50</strong></li>\n</ul>\n<p>If the defect is <strong>too large</strong>, a porous polytetrafluoroethylene (Gore-Tex)<strong> patch</strong> is used.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3cd8f5dc4d7347429bbdabffd2cf31bf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/318c5c1998774266a2e3891274abefe6x1280x1660.JPEG"
    ]
  },
  {
    "text": "In which of the following conditions, the characteristic appearance marked by arrows, is seen as shown in the MRI image below",
    "choices": [
      {
        "id": 1,
        "text": "Metastases"
      },
      {
        "id": 2,
        "text": "Neurocysticercosis"
      },
      {
        "id": 3,
        "text": "Multiple sclerosis"
      },
      {
        "id": 4,
        "text": "Intracranial Haemorrhage"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows ovoid lesions with their long axis perpendicular to the ventricular surface called <strong>Dawson</strong> <strong>fingers</strong> (white arrows) which are characteristically seen in <strong>multiple</strong> <strong>sclerosis.</strong></p>\n<p>Multiple sclerosis (MS) is considered to be autoimmune in origin and is the <strong>most common </strong>demyelinating disease.</p>\n<p><strong>MRI</strong> is the <strong>study of choice</strong> in imaging multiple sclerosis because of its greater sensitivity than computed tomography in demonstrating plaques, both in the brain and spinal cord.</p>",
    "explanation_video": "",
    "question_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e595ca3ec8314ddc851428efe3eafe9ax512x357.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old premenopausal woman complained of heavy menstrual bleeding and bleeding between her cycles. The patient was in good health, with no other complaints. No significant past history. She was referred for a pelvic ultrasound which revealed a 12 x 11mm mass within the endometrial cavity surrounded by free fluid. Doppler US established internal vascularity via a single feeder vessel. Which among the following is not a risk factor for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Tamoxifen"
      },
      {
        "id": 2,
        "text": "Oral contraceptive pills"
      },
      {
        "id": 3,
        "text": "Obesity"
      },
      {
        "id": 4,
        "text": "Increasing age"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The clinical case described along with visualization of a <strong>feeding vessel</strong> on ultrasonography is characteristic of an&nbsp;<strong>endometrial polyp, </strong>and oral contraceptive pills are not a risk factor.</p>\n<p class=\"p1\">Risk factors for development of endometrial polyps include:</p>\n<ul>\n<li class=\"p1\">Increasing age</li>\n<li class=\"p1\">Obesity</li>\n<li class=\"p1\">Tamoxifen use&nbsp;</li>\n<li class=\"p1\">Some studies suggest an association with hormone replacement therapy</li>\n</ul>\n<p><strong>Oral contraceptive pills</strong> appear to be <strong>protective</strong>. For women taking tamoxifen, the levonorgestrel-releasing intrauterine system (LNG-IUS) was investigated and shown to lower endometrial polyp formation rates.</p>\n<p>Estrogen and progesterone have been implicated in the growth of endometrial polyps, and higher receptor levels are seen compared with the normal endometrium.</p>\n<p>Benign endometrial polyps commonly occur at all ages, with their greatest prevalence after age 50. They are a common cause of <strong>postmenopausal bleeding.&nbsp;</strong>Women with polyps may present with heavy cyclic or intermenstrual bleeding, or without complaints as an incidental finding on imaging.</p>\n<div class=\"page\" title=\"Page 216\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>On transvaginal sonography, endometrial polyps may appear as a nonspecific area of endometrial thickening or a round or elongated hyperechoic focal mass within the endometrial cavity. Some polyps may contain cystic spaces corresponding to dilated endometrial glands.&nbsp; On color or power Doppler, endometrial polyps typically have only <strong>one arterial feeding vessel</strong>.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 216\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Treatment is by hysteroscopic polypectomy for symptomatic women or women with risk factors for malignant transformation. For asymptomatic women without risk factors, conservative management with regular monitoring can be done.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/72c0fe133b17492294110ad218ce73b1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 70-year-old lady with recent-onset, progressive dementia presents with myoclonus. The brain imaging findings are shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lewy body dementia"
      },
      {
        "id": 2,
        "text": "Progressive multifocal leukoencephalopathy"
      },
      {
        "id": 3,
        "text": "Subacute sclerosing panencephalitis"
      },
      {
        "id": 4,
        "text": "Creutzfeldt-Jakob disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><span data-preserver-spaces=\"true\">The most likely diagnosis in this patient is\u00a0</span><strong><span data-preserver-spaces=\"true\">Creutzfeldt-Jakob disease (CJD).</span></strong></p>\n<p><span data-preserver-spaces=\"true\">The imaging studies are diffusion-weighted imaging</span>\u00a0and\u00a0T2-weighted-fluid-attenuated inversion recovery (T2-FLAIR) imaging.\u00a0The findings of <strong>cortical ribboning</strong>\u00a0and\u00a0<strong>basal\u00a0ganglia hyperintensity</strong>\u00a0on the two abovementioned MRI modalities have a high sensitivity\u00a0and\u00a0specificity. This has diminished the need for brain biopsy in\u00a0patients with suspected CJD.</p>\n<p><span data-preserver-spaces=\"true\">CJD is a\u00a0</span><strong><span data-preserver-spaces=\"true\">spongiform encephalopathy</span></strong><span data-preserver-spaces=\"true\">\u00a0caused by a\u00a0</span><strong><span data-preserver-spaces=\"true\">prion</span></strong><span data-preserver-spaces=\"true\">. It presents as\u00a0</span><strong>rapidly progressive dementia</strong>\u00a0and is usually fatal<span data-preserver-spaces=\"true\">\u00a0within 1 year of the onset of symptoms.</span></p>\n<p>Symptoms\u00a0are almost always\u00a0rapidly progressive, and the clinical presentation includes the following:</p>\n<ul>\n<li><strong><span data-preserver-spaces=\"true\">Myoclonus</span></strong></li>\n<li><span data-preserver-spaces=\"true\">Higher\u00a0</span><strong><span data-preserver-spaces=\"true\">cortical deficits</span></strong></li>\n<li><strong><span data-preserver-spaces=\"true\">Psychiatric manifestations -</span></strong><span data-preserver-spaces=\"true\">\u00a0depression, psychosis, and visual hallucinations</span></li>\n<li><span data-preserver-spaces=\"true\">Profound\u00a0</span><strong><span data-preserver-spaces=\"true\">dementia -</span></strong><span data-preserver-spaces=\"true\">\u00a0memory loss, impaired judgment, intellectual decline</span></li>\n<li><span data-preserver-spaces=\"true\">Visual impairment or cerebellar gait and coordination deficits in a few patients</span></li>\n<li><span data-preserver-spaces=\"true\">Nonspecific\u00a0</span><strong><span data-preserver-spaces=\"true\">prodromal</span></strong><span data-preserver-spaces=\"true\">\u00a0symptoms - fatigue, sleep disturbance, weight, loss, headache, anxiety, vertigo, malaise, and ill-defined pain\u00a0</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Extrapyramidal</span></strong><span data-preserver-spaces=\"true\">\u00a0dysfunction - rigidity, masklike facies, choreoathetoid movements;</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Seizures</span></strong></li>\n<li><span data-preserver-spaces=\"true\">Hypoesthesia</span></li>\n<li><span data-preserver-spaces=\"true\">Supranuclear gaze palsy, optic atrophy</span></li>\n</ul>\n<p>EEG<span data-preserver-spaces=\"true\">\u00a0shows repetitive, high-voltage, triphasic, and polyphasic sharp discharges in advanced cases.\u00a0</span>CSF<span data-preserver-spaces=\"true\">\u00a0analysis shows a\u00a0</span><strong><span data-preserver-spaces=\"true\">positive</span></strong><span data-preserver-spaces=\"true\">\u00a0assay for\u00a0</span><strong><span data-preserver-spaces=\"true\">14-3-3 protein.</span></strong><span data-preserver-spaces=\"true\">\u00a0</span>Brain biopsy<span data-preserver-spaces=\"true\">\u00a0shows the presence of\u00a0</span><span data-preserver-spaces=\"true\">prion protein scrapie (<strong>PrP<sup>Sc</sup></strong>).</span></p>\n<p><span data-preserver-spaces=\"true\">Management is mainly\u00a0</span>supportive.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/de1f2cd332f5488e8a28c973861367e3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/54ceb57b84954921bc439a2fcf9d3cafx600x950.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/243c6ccc0f8f4e33b201102359c3d8bfx512x263.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/39101aee0f014d1091d96c85a0729c53x512x275.PNG"
    ]
  },
  {
    "text": "An elderly patient presented with easy fatiguability and backache. He has had recurrent infections in the past 3 months. Reports showed hypercalcemia. His skull x-ray is  below. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 2,
        "text": "Multiple myeloma"
      },
      {
        "id": 3,
        "text": "Paget's disease"
      },
      {
        "id": 4,
        "text": "Eosinophilic granuloma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Multiple myeloma</strong> is the most likely diagnosis for this patient. The given radiograph represents the multiple well-defined,\u00a0<strong>punched-out lytic lesions</strong> of various sizes scattered throughout the skull, giving the<strong> raindrop skull appearance</strong>, which is seen in multiple myeloma.</p>\n<p>Multiple myeloma is the malignant production of\u00a0<strong>plasma cells</strong> that results in bone pain or fractures, renal failure, increased susceptibility to infections, anemia, hypercalcemia, and manifestations of hyperviscosity. The incidence of multiple myeloma increases with age, and it is more commonly seen in males than in females.</p>\n<p><strong>Bone pain</strong> is the most common symptom and is due to the proliferation of tumor cells, stimulation of osteoclasts that destroy the bone, and inhibition of osteoblast cells that form new bone resulting in osteolytic lesions. <strong>Recurrent infections</strong> in multiple myeloma are due to hypogammaglobulinemia. <strong>Hypercalcemia</strong> results from the chronic mobilization of calcium from bones.</p>\n<p><strong>Revised International Myeloma Working Group criteria for the diagnosis of multiple myeloma.</strong></p>\n<div class=\"page\" title=\"Page 844\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Clonal bone marrow plasma cells\u00a0<strong>\u226510%</strong>\u00a0(or) Biopsy-proven bony or extramedullary plasmacytoma</p>\n<p><strong>Plus</strong></p>\n<p>Any one<strong>\u00a0or more</strong>\u00a0of the following\u00a0<strong>myeloma-defining events</strong>:</p>\n<ul>\n<li><strong>Evidence of end-organ damage</strong>\u00a0attributable to the underlying plasma cell proliferative disorder: (specifically <strong>CRAB</strong>\u00a0features)\n<ul>\n<li>Hyper<strong>C</strong>alcemia: Serum calcium level &gt;1 mg/dL higher than the upper limit of normal or\u00a0<strong>&gt;11 mg/dL</strong></li>\n<li><strong>R</strong>enal insufficiency: Creatinine clearance of\u00a0<strong>&lt;40 mL/min</strong>\u00a0or serum creatinine level of\u00a0<strong>&gt;2 mg/dL</strong></li>\n<li><strong>A</strong>nemia: Hemoglobin level &gt;20 g/L (2 mg/dL) below the lowest limit of normal or hemoglobin level of\u00a0<strong>&lt;10 g/dL</strong></li>\n<li><strong>B</strong>one lesions:\u00a0<strong>One</strong>\u00a0or more osteolytic lesions on skeletal radiography, computed tomography (CT), or positron-emission tomography (PET)/CT</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Any one or more</strong>\u00a0of the following biomarkers of malignancy:\n<ul>\n<li>Clonal bone marrow plasma cells\u00a0<strong>\u226560%</strong></li>\n<li>Serum involved/uninvolved free light-chain ratio of\u00a0<strong>100 or greater</strong></li>\n<li><strong>&gt;1</strong>\u00a0focal lesion on MRI that is\u00a0<strong>at least 5 mm</strong>\u00a0or greater in size</li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>Option A - <strong>Hyperparathyroidism</strong> is characterized by multiple tiny, well-defined lucencies in the skull due to the resorption of trabecular bone, resulting in the\u00a0<strong>salt and pepper appearance</strong> or <strong>pepper pot skull.\u00a0</strong>The clinical features are mainly due to hypercalcemia and typically include anorexia, nausea, abdominal pain, depression, fatigue, and muscle weakness. Renal stones/nephrocalcinosis can occur due to hypercalciuria. Joint symptoms occur due to chondrocalcinosis.</p>\n<p>Other radiological findings in hyperparathyroidism:</p>\n<ul>\n<li><strong>Sub-periosteal resorption </strong>of<strong> middle phalanges </strong>-<strong>\u00a0</strong>Classical and pathognomonic feature of hyperparathyroidism</li>\n<li>Loss of lamina dura\u00a0</li>\n<li>An atypical cyst-like lytic lesion, otherwise known as <strong>brown tumor</strong>\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/71ad0b9aea114bee995de3cdc641c3cb.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c3fbe8719a9f48b4889f01eb18d3cb6bx672x526.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83d862ccf8c94ab3b1efba5eb13314acx720x555.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7e65a351f8d34cc8ba39fdd016b0a8e1x512x439.PNG"
    ]
  },
  {
    "text": "The condition is seen in all except:",
    "choices": [
      {
        "id": 1,
        "text": "Hypoparathyroidism"
      },
      {
        "id": 2,
        "text": "Pseudohypoparathyroidism"
      },
      {
        "id": 3,
        "text": "Pseudopseudohypoparathyroidism"
      },
      {
        "id": 4,
        "text": "Turner\u2019s syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above radiologicalimage shows a short 4<span style=\"font-size: 8pt;\"><sup>th</sup></span> metacarpal.</p>\n<p><strong>Causes of short 4<span style=\"font-size: 8pt;\"><sup>th</sup></span> metacarpal:</strong></p>\n<ul>\n<li>Pseudohypoparathyroidism</li>\n<li>Pseudopseudohypoparathyroidism</li>\n<li>Turner&rsquo;s syndrome</li>\n<li>Idiopathic</li>\n<li>Post infection</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8b0233e96eff4258a23d259ea2444baa.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 22-year-old woman comes with a history of 6 weeks of amenorrhea, vomiting, and easy fatigability. The ultrasound image of the patient is given below. What is the diagnosis of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Unruptured tubal ectopic pregnancy"
      },
      {
        "id": 2,
        "text": "Normal pregnancy"
      },
      {
        "id": 3,
        "text": "Twin pregnancy"
      },
      {
        "id": 4,
        "text": "Duodenal atresia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of <strong>amenorrhea, vomiting,</strong> and<strong> easy fatigability</strong> along with ultrasound findings of <strong>double decidual sign</strong>\u00a0points to the diagnosis of <strong>normal pregnancy</strong>.</p>\n<p>This sign can be seen in <strong>first-trimester</strong> transvaginal sonograms. In the image, the empty head red arrow points to the concentric double rings that are - the outer <strong>decidua parietalis</strong> and the inner <strong>decidua capsularis</strong>. The filled head red arrow points to the <strong>yolk sac</strong>. The presence of the yolk sac confirms the intrauterine location of the pregnancy. It usually appears by the 5th week.</p>\n<p>Another indicator of early intrauterine pregnancy is the intradecidual sign. It is seen as an anechoic center surrounded by a single echogenic rim.</p>\n<p>Cardiac motion is usually seen after the 6th week.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a79424cdab624ef2a4ad9b282c701325.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient who is known to have pulmonary adenocarcinoma presents with severe dyspnea. A chest X-ray was taken which reveals the following finding. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Consolidation"
      },
      {
        "id": 2,
        "text": "Pneumatocele"
      },
      {
        "id": 3,
        "text": "Pneumothorax"
      },
      {
        "id": 4,
        "text": "Massive pleural effusion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical history of dyspnoea and chest X-ray findings suggests a diagnosis of&nbsp;<strong>massive pleural effusion</strong>&nbsp;&nbsp;</p>\n<p>The chest X-ray above shows a massive left-sided pleural effusion that is displacing the heart and trachea to the right.&nbsp;</p>\n<p><strong>Pleural effusion</strong> is the <strong>abnormal accumulation</strong> of <strong>fluid</strong> in the pleural cavity. It can be seen on chest X-rays as homogenous opacification of the lower chest as well as the <strong>blunting</strong> of the <strong>lateral costophrenic angle</strong> and hemidiaphragm. If pleural effusion can be seen to the level of the fourth anterior rib, it means that a fluid volume of around 1000mL would be present. A <strong>massive pleural effusion</strong> would cause a <strong>mediastinal shift</strong> to the opposite side and an opacification of the hemithorax.&nbsp;</p>\n<p>Other options:</p>\n<p>Option A: <strong>Consolidation</strong> is the filling of alveolar spaces with fluid. If it is fairly dense, it can be easily <strong>localized</strong>. It can be seen in <strong>community-acquired pneumonia</strong>. The X-ray shown below shows a consolidation within the right mid and both lower lobes.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d1a1328a85cf49fe9c02a6794e8242c9.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d063b4afa034df09eb6d5b240fce30cx728x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3d54ee5d682e43fd8eadbc991fc6d3c9x765x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eeed37f9388141de9feabdf181c02fa9x705x600.JPEG"
    ]
  },
  {
    "text": "Which of the following conditions is associated with the Bagel sign on sonography as shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Ruptured ectopic pregnancy"
      },
      {
        "id": 2,
        "text": "Unruptured ectopic pregnancy"
      },
      {
        "id": 3,
        "text": "Early intrauterine pregnancy"
      },
      {
        "id": 4,
        "text": "Intrauterine death"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bagel sign</strong> on an ultrasonogram (USG) is seen in an <strong>unruptured ectopic pregnancy.</strong></p>\n<p>Bagel sign is also known as the tubal ring sign or the blob sign. It refers to the appearance of an<strong> anechoic gestational sac in the adnexa surrounded by a hyperechoic ring.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/edd3a4784a2f45e3bd7d6b5a5a461e81.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bcda511fa77d43b2a527f04f593ba662x1280x1623.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c3f02ad21694d8d9363e0f7ff96a095x498x342.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0eef8c33a1a143e38b966f4ec038a545x1076x711.JPEG"
    ]
  },
  {
    "text": "Identify the type of MRI image given below.",
    "choices": [
      {
        "id": 1,
        "text": "T1"
      },
      {
        "id": 2,
        "text": "T2"
      },
      {
        "id": 3,
        "text": "FLAIR"
      },
      {
        "id": 4,
        "text": "STIR"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The MRI image given above is FLAIR.</p>\n<ul>\n<li>In FLAIR images CSF and white matter is dark.</li>\n<li>FLAIR (fluid attenuated inversion recovery) is an inversion recovery technique that nulls fluid.</li>\n</ul>\n<p>In T2 images CSF is bright/hyperintense and white matter is dark whereas in T1 images CSF is dark/hypointense and white matter is white.</p>\n<p>STIR (Short tau inversion recovery) is done to detect bone marrow oedema.</p>\n<p>Here White matter appears darker than gray while gray matter appears gray and the fluids appear very bright.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/53935dc756d844deaa1a41b7278b9d11.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cd196ee6702748aca923e5820fb0fc02x577x379.JPEG"
    ]
  },
  {
    "text": "A 62-year-old man presents with parkinsonism and cerebellar features. The MRI of this patient shows the following findings over the pons. Identify the sign shown in the image.",
    "choices": [
      {
        "id": 1,
        "text": "Hot cross bun sign"
      },
      {
        "id": 2,
        "text": "Molar tooth sign"
      },
      {
        "id": 3,
        "text": "Tram track sign"
      },
      {
        "id": 4,
        "text": "Dawson's fingers"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The given MRI image shows<strong> pontine hot cross bun sign </strong>seen in patients with <strong>m</strong><span class=\"s1\"><strong>ultiple system atrophy (MSA) with predominant cerebellar features</strong></span></p>\n<p>MSA manifests as a combination of <strong>parkinsonian</strong>, <strong>cerebellar</strong>, and <strong>autonomic features</strong>. Based on predominant clinical features it is further divided into :</p>\n<ul>\n<li>MSA-P: predominantly parkinsonian features</li>\n<li>MSA-C: predominantly cerebellar features</li>\n</ul>\n<p>Characteristic MRI findings include:</p>\n<ul>\n<li>MSA-P: T2 weighted imaging demonstrates\u00a0<strong>hyperintense putaminal rim\u00a0</strong></li>\n<li><strong>MSA-C</strong>: cerebellar and brainstem atrophy causing\u00a0<strong>pontine hot cross bun sign</strong></li>\n</ul>\n<p>Below image shows hot cross bun sign (arrow) due to severe atrophy of pons seen in <strong>m</strong><span class=\"s1\"><strong>ultiple system atrophy.</strong></span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8b1cb7a980bb46c5a0ba5118f763437b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aadf751364a041c588390288256e2a6bx267x237.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/27bd701ee13144d5b93b20e9dc49fc8ex365x371.PNG"
    ]
  }
];
        let quizName = 'Radiology Mini Test - Medicine And Allied Subjects, Obg';
        const quizFilename = 'radiology-mini-test-medicine-and-allied-subjects-obg-5bf46cb3.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>