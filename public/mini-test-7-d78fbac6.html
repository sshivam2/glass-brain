<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 7 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2022-23
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Ultrasound of a pregnant female showed a snowstorm appearance and enlarged ovaries with theca lutein cysts. She is scheduled to undergo suction and evacuation. Which of the following statements is incorrect regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Theca lutein cysts do not require specific management apart from suction evacuation of the mole."
      },
      {
        "id": 2,
        "text": "She should be followed up at weekly intervals till hCG values become normal."
      },
      {
        "id": 3,
        "text": "p57 is strongly expressed in the tissues involved."
      },
      {
        "id": 4,
        "text": "She should be advised to use contraception during the follow-up period."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The USG showing a <strong>snowstorm appearance</strong> is characteristic of a <strong>complete mole</strong>. The&nbsp;<strong>p57 protein is absent in complete moles</strong>, and tissues&nbsp;<strong>do not</strong>&nbsp;pick up this stain.</p>\n<p>p57 is used for immunohistochemical staining. It is a nuclear protein whose gene is<strong>&nbsp;paternally imprinted and maternally expressed</strong>. This means that the gene product is produced only in tissues containing a maternal allele. Because complete moles contain only paternal genes, the<strong>&nbsp;</strong>p57 protein is absent in complete moles, and tissues&nbsp;do not&nbsp;pick up this stain.</p>\n<p>Hydatidiform mole is a <strong>benign</strong> abnormal condition of the placenta characterized by partial degenerative or proliferative changes of the <strong>chorionic villi</strong>. Though benign, it has malignant potential. The patient presents with a characteristic history of <strong>abdominal pain, vaginal bleeding</strong> or <strong>spotting,</strong> and <strong>vomiting</strong> during the first trimester. Also, there may be a history of passing <strong>grape-like</strong> vesicles vaginally. On examination, the size of the uterus is <strong>larger for gestational age</strong> and the <strong>fetal heart sounds are absent</strong>.</p>\n<p>A USG scan shows a <strong><span class=\"notion-enable-hover\" data-token-index=\"1\" data-reactroot=\"\">snowstorm appearance</span></strong> which is characteristic of a <strong>complete mole</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b9d00cb705dc4befa2b95c2868273fd3x676x568.JPEG"
    ]
  },
  {
    "text": "A 53-year-old woman presented with difficulty in reading and blurring of vision in both eyes. On evaluation, her visual acuity and fundus examination were normal. Her visual field charting showed a defect as shown below. Where is the site of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Temporal lobe"
      },
      {
        "id": 2,
        "text": "Parietal lobe"
      },
      {
        "id": 3,
        "text": "Optic chiasma"
      },
      {
        "id": 4,
        "text": "Optic tract"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The visual field defect shown in the image is <strong>bitemporal hemianopia</strong>. The site of the lesion is the <strong>optic chiasma</strong> due to the decussation of nasal fibres.</p>\n<p><strong>Optic chiasm lesions&nbsp;</strong>may produce the following visual field defects</p>\n<ul>\n<li><strong>Bitemporal hemianopia </strong>in case&nbsp;of medial optic chiasm lesions.</li>\n<li><strong>Binasal hemianopia</strong> in case&nbsp;of lateral optic chiasm lesions.</li>\n</ul>\n<p>Other notable visual field defects are</p>\n<ul>\n<li><strong>Superior quadrantic hemianopia</strong>\n<ul>\n<li><strong>Pie-in-the-sky</strong> defects</li>\n<li>Involvement of <strong>Meyer&rsquo;s loop</strong> - inferior fibres of optic radiations</li>\n<li>Contralateral <strong>temporal</strong> lobe</li>\n</ul>\n</li>\n<li><strong>Inferior quadrantic hemianopia</strong><br />\n<ul>\n<li><strong>Pie-in-the-floor</strong> defects</li>\n<li>Involvement of <strong>Baum&rsquo;s loop</strong> - superior fibres of optic radiations</li>\n<li>Contralateral <strong>parietal</strong> lobe</li>\n</ul>\n</li>\n<li><strong>Homonymous hemianopia</strong>\n<ul>\n<li>Involvement of <strong>retrochiasmal</strong> regions such as optic tract, geniculate body, and optic radiations.</li>\n<li><strong>Sparing of the macula</strong> and more <strong>congruous</strong> field defect (both sides have the same extent of field loss) when the <strong>occipital cortex</strong> is involved.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/09c117ab26ce45baba87ddb6db94cf37.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a6d5974c669f4da0b6bbd38869931454x1280x1487.JPEG"
    ]
  },
  {
    "text": "A patient undergoing surgery suddenly developed a temperature of 102 F and a pulse rate of 130 bpm. His capnograph shows the following finding. Your senior resident injects intravenous dantrolene immediately. All the following drugs can be used in the treatment of this patient, except ______.",
    "choices": [
      {
        "id": 1,
        "text": "Bicarbonates"
      },
      {
        "id": 2,
        "text": "Furosemide"
      },
      {
        "id": 3,
        "text": "Insulin"
      },
      {
        "id": 4,
        "text": "Calcium channel blockers"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>malignant hyperthermia</strong> managed with intravenous dantrolene.&nbsp;All the above-mentioned drugs can be used in the treatment of this patient, except <strong>calcium channel blockers</strong>&nbsp;as they may cause&nbsp;<strong>hyperkalemia&nbsp;</strong>when used in combination with dantrolene.</p>\n<p>The capnograph shows a&nbsp;<strong>sudden and progressive increase in EtCO<sub>2&nbsp;</sub></strong>which is typical of malignant hyperthermia.&nbsp;</p>\n<p><strong>Dantrolene sodium </strong>is the <strong>mainstay of therapy</strong>&nbsp;for malignant hyperthermia but it is to be reconstituted with <strong>sterile distilled water.&nbsp;</strong>It is given at a dose of <strong>2.5 mg/kg </strong>intravenously and can be repeated every 5-10 minutes (up to 10 mg/kg) till the attack subsides.</p>\n<p><strong>Correction of&nbsp;Electrolyte Imbalances:</strong></p>\n<ul>\n<li class=\"p1\">Administer <strong>bicarbonate</strong> for metabolic acidosis.</li>\n<li class=\"p1\">Hyperkalemia should be treated with <strong>insulin.</strong></li>\n<li class=\"p1\"><strong>Furosemide</strong> may be used to induce diuresis and prevent acute kidney failure.</li>\n</ul>\n<p>Other treatment options:</p>\n<ul>\n<li>All anesthetic agents should be cut off.</li>\n<li>Hyperventilation with 100% O<sub>2.</sub></li>\n<li>If the body temperature is high, it should be brought down using cold intravenous fluids, cooling body cavities with sterile iced fluids, surface cooling with ice packs, and cooling blankets.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9b49c13a82684219a24816134612aed9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man exercises at a high altitude. Which of the following changes would occur in him?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 2,
        "text": "Rise in urinary bicarbonate"
      },
      {
        "id": 3,
        "text": "Low blood lactate levels"
      },
      {
        "id": 4,
        "text": "Decrease in pH"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: justify;\">In the given scenario, there will be a <strong>rise</strong> in <strong>urinary bicarbonate levels</strong> if a person is observed exercising at a high altitude.</p>\n<p style=\"text-align: justify;\"><strong>Adaptation at High Altitudes:</strong></p>\n<ul>\n<li style=\"text-align: justify;\">The work capacity is reduced at high altitudes and this reduction is in direct proportion to the <strong>decrease</strong> in <strong>O<sub>2</sub></strong> uptake.</li>\n<li style=\"text-align: justify;\">Immediate exposure to low PO<sub>2</sub> at higher altitudes stimulates the arterial chemoreceptors, and this stimulation <strong>increases alveolar ventilation.</strong></li>\n<li style=\"text-align: justify;\">This immediate increase in pulmonary ventilation upon rising to a high altitude blows off large quantities of CO2, reducing the PCO2 and <strong>increasing the pH</strong> of the body fluids causing <strong>r</strong><strong>espiratory alkalosis (not metabolic - option A).</strong> This raised pH inhibits the brainstem respiratory center and opposes the increased ventilation. So, respiratory alkalosis will hinder maximal exercise effort.</li>\n<li style=\"text-align: justify;\">To compensate for this respiratory alkalosis, <strong>kidneys reduce hydrogen ion secretion and increase bicarbonate excretion</strong>. This reduces plasma and cerebrospinal fluid bicarbonate concentration and brings the pH toward normal. It removes the inhibitory effect of alkalosis on respiration. Hence fall in blood bicarbonate facilitates the exercise effort.</li>\n<li style=\"text-align: justify;\"><strong>Lactic acid</strong> levels increase which causes extreme fatigue. When there is insufficient oxygen (at high altitudes), most of the pyruvic acid is converted into lactic acid, which diffuses out of the muscle cells into the interstitial fluid and blood.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An hour after the blood transfusion, the patient develops a fever with chills and flank pain. Tachycardia and hypotension are noted on examination. The direct Coombs test is positive. Which of the following mediates this reaction?",
    "choices": [
      {
        "id": 1,
        "text": "IgM antibody"
      },
      {
        "id": 2,
        "text": "IgG antibody"
      },
      {
        "id": 3,
        "text": "IgE antibody"
      },
      {
        "id": 4,
        "text": "IgA antibody"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div>The given clinical scenario is suggestive of\u00a0<strong>acute hemolytic transfusion reaction</strong>\u00a0(AHTR) following blood transfusion. It occurs most often due to\u00a0<strong>ABO incompatibility</strong>\u00a0and is mediated by <strong>IgM antibodies.</strong></div>\n<div>\u00a0</div>\n<div>Acute hemolytic transfusion reaction (AHTR) occurs\u00a0<strong>within 24 hours</strong>\u00a0of transfusion and is usually caused by preformed IgM antibodies against donor red cells that fix complement. The patient presents with tachycardia, tachypnea, hypotension, fever, flank pain, and in severe cases, hemoglobinuria, renal failure, and disseminated intravascular coagulation (DIC).</div>\n<div>\u00a0</div>\n<div>It is caused by ABO incompatibility which is a <strong>type 2 hypersensitivity reaction.</strong> They<strong> test positive</strong> for the<strong>\u00a0direct Coomb's test.</strong> In light of acute hemolytic transfusion reaction, the transfusion is to be stopped immediately.</div>\n<div>\n<p><strong>Allergic or urticarial reactions</strong> during transfusions are mediated by IgE antibodies.</p>\n<p><strong>A delayed hemolytic transfusion reaction</strong> which occurs after 24 hours (within 2 weeks) of transfusion is a reaction mediated by IgG antibodies.</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You were posted for screening of deafness in school children under your primary health center. Which type of screening is done in this scenario?",
    "choices": [
      {
        "id": 1,
        "text": "Prospective screening"
      },
      {
        "id": 2,
        "text": "Multiphasic screening"
      },
      {
        "id": 3,
        "text": "Prescriptive screening"
      },
      {
        "id": 4,
        "text": "Selective screening"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The type of<strong> screening\u00a0</strong>done for <strong>deafness in school children</strong> is <strong>prescriptive screening</strong>.\u00a0</p>\n<p><strong>Prescriptive screening</strong> is done for <strong>case detection</strong>. People are examined primarily for their <strong>own benefit</strong>. It may lead to the\u00a0<strong>early identification </strong>of\u00a0an <strong>unrecognized disease</strong>.\u00a0Hence, appropriate treatment can be initiated immediately to decline the disease progression.</p>\n<p>Screening\u00a0is initiated by\u00a0medical and public health personnel and is not requested by a patient. Examples of prescriptive screening are:</p>\n<ul>\n<li>Screening of hemolytic disease in newborns</li>\n<li>Screening of infants for <strong>phenylketonuria</strong></li>\n<li>Screening of bacteriuria in pregnancy</li>\n<li>Screening of <strong>school children</strong> for visual and auditory defects</li>\n</ul>\n<p>Other options:</p>\n<p>Option A -\u00a0<strong>Prospective screening</strong> is done for <strong>disease control</strong>. People are screened for the<strong> benefit</strong> of<strong> others</strong>.\u00a0It may\u00a0lead to an <strong>early</strong> <strong>diagnosis</strong> and permit more effective treatment. It also <strong>reduces</strong>\u00a0the <strong>spread</strong> of infectious diseases in the community. Hence,\u00a0reduces mortality associated with the disease. Examples of prospective screening are:</p>\n<ul>\n<li>Screening of<strong> immigrants</strong> from <strong>infectious diseases</strong> such as tuberculosis and syphilis to protect the citizens</li>\n<li>Screening for<strong> streptococcal infection</strong> to prevent rheumatic fever</li>\n<li>Screening of<strong> sex workers for HIV</strong>\u00a0to prevent transmission of HIV to others</li>\n<li>Screening of <strong>COVID infection</strong> among the international passengers at the airport</li>\n</ul>\n<p>Option B - <strong>Multiphasic screening</strong> is the application of<strong> two or more screening tests</strong> in combination, to a large population at<strong> one time</strong>. It is not cost-effective and has shown no benefit in reducing the morbidity and mortality of the population.</p>\n<p>Option D - <strong>Selective screening</strong> is done in <strong>high-risk groups</strong>. It is one of the most <strong>effective\u00a0</strong>screening tests. Example: <strong>Screening for diabetes</strong> in the other members of a family for a detected diabetes case since these diseases get aggregated in families.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old patient had undergone prolonged surgery in a  prone position with his hip extended. Post-operatively he complained of pain, numbness, and paresthesia along the anterolateral aspect of the thigh. What is the root value of the nerve involved in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "L1, L2"
      },
      {
        "id": 2,
        "text": "L2, L3"
      },
      {
        "id": 3,
        "text": "L1, L2, L3"
      },
      {
        "id": 4,
        "text": "L2, L3, L4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical scenario of a patient with a history of&nbsp;<strong>prolonged surgery</strong> in prone position with <strong>hip extended</strong> and symptoms of<strong> paresthesia</strong> over the <strong>anterolateral aspect of the thigh</strong> is suggestive of <strong>meralgia paresthetica.</strong> It is due to <strong>compression</strong> neuropathy or neuroma of the lateral femoral cutaneous nerve of the thigh. The root value of the lateral cutaneous nerve of the thigh is<strong> L2 and L3.</strong></span></p>\n<p><span data-preserver-spaces=\"true\">The lateral cutaneous nerve of the thigh&nbsp;arises from the <strong>posterior divisions</strong> of the ventral rami of L2 and L3, and it supplies the skin of the <strong>anterior</strong> and <strong>lateral surfaces</strong> of the<strong> thigh up to the knee.</strong></span></p>\n<p><span data-preserver-spaces=\"true\">It is prone to injury especially as it leaves the pelvis deep to the inguinal ligament just medial to the anterior superior iliac spine.&nbsp;</span>The angulation of the nerve <strong>as it crosses the iliac crest</strong> makes it vulnerable to compression during hip extension which may increase angulation and tension on the nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/953656d28b6f4070bf7fdc199d55efb2x1280x1540.JPEG"
    ]
  },
  {
    "text": "A patient underwent emergency surgery for a femoral shaft fracture. On the 2nd post-operative day, he developed fever, breathlessness, and was disoriented. On examination, he had axillary and subconjunctival petechiae. CT pulmonary angiogram showed diffuse patchy ground-glass shadowing. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hemorrhagic shock"
      },
      {
        "id": 2,
        "text": "Acute compartment syndrome"
      },
      {
        "id": 3,
        "text": "Fat embolism syndrome"
      },
      {
        "id": 4,
        "text": "Crush syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The development of fever, breathlessness, disorientation, and subconjunctival and axillary petechiae <strong>within 72 hours</strong>&nbsp;of a <strong>traumatic skeletal&nbsp;</strong>(femur) <strong>fracture&nbsp;</strong>and CT angiogram showing pulmonary infarction&nbsp;points towards the diagnosis of <strong>fat embolism syndrome</strong>.&nbsp;</p>\n<p>Fat embolism syndrome is the presence of fat globules in vital organs and peripheral circulation after the fracture of a long bone or other major trauma. Its pathogenesis can be related to 2 factors:</p>\n<ul>\n<li>The&nbsp;release of free fatty acids&nbsp;by the action of lipases on the neutral fats that causes toxic vasculitis.</li>\n<li>Actual obstruction&nbsp;of small pulmonary vessels by fat globules.</li>\n</ul>\n<p>The early signs of fat embolism syndrome that occur <strong>within 72 hours</strong> of injury are&nbsp;<strong>fever</strong> and <strong>tachycardia. </strong>The presenting features can be classified into 2 types:</p>\n<ul>\n<li><strong>Cerebral type</strong>: drowsiness, restlessness, disorientation, and coma</li>\n<li><strong>Pulmonary type</strong>: tachypnoea, tachycardia</li>\n</ul>\n<p>Pathognomic signs include a<strong>&nbsp;petechial rash</strong>&nbsp;in front of neck/ anterior <strong>axillary fold</strong>/ chest/ <strong>conjunctiva.</strong></p>\n<p><strong>Management</strong> of fat embolism is mainly supportive. This consists of respiratory support with high inspired oxygen concentration, <strong>heparinization,</strong> intravenous low molecular weight <strong>dextran,</strong> and <strong>corticosteroids</strong> to reduce the inflammation in the lungs. <strong>Prompt stabilization</strong> of long-bone fractures reduces the incidence of fat embolism syndrome.</p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Hemorrhagic shock</strong>&nbsp;is the most common cause of shock in surgical or trauma patients. Here the patient presents with agitation, <strong>cold clammy extremities, hypotension, tachycardia, and weak peripheral pulses</strong>. Acidosis and elevated lactate levels may be seen due to hypoperfusion of tissues.</p>\n<p>Option B:&nbsp;<strong>Acute compartment syndrome</strong>&nbsp;refers to an elevation of the intra-compartmental pressure (ICP) which increases the risk for tissue ischemia and necrosis. It can occur following fractures (commonly) or soft tissue injuries and is a<strong> localized condition involving the affected limb</strong>. The clinical features include <strong>pain, paresthesia, pallor, paralysis, and pulselessness</strong>. The diagnosis is confirmed by measuring the intra-compartmental pressures. Fasciotomy is done in confirmed cases.</p>\n<p>Option D:&nbsp;Crush syndrome can result when a <strong>limb is compressed</strong> for a prolonged period (e.g. getting crushed or entrapped in a vehicle or machinery). This results in hypoperfusion and <strong>myonecrosis</strong> in the crushed limb. When the limb is released from the compression, toxic metabolites get released to cause reperfusion injury.&nbsp;Free myoglobin can lead to <strong>acute tubular necrosis</strong> and <strong>renal failure</strong>. Myonecrosis can lead to <strong>metabolic acidosis</strong> with <strong>hyperkalemia</strong> and <strong>hypocalcemia</strong>. The procoagulants that escaped into the systemic circulation can produce <strong>systemic coagulopathy</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-day-old neonate born at term presents with progressively deepening cyanosis and tachypnea since birth. The chest x-ray of the neonate is shown below. The given congenital heart defect is seen due to the developmental defect of _______.",
    "choices": [
      {
        "id": 1,
        "text": "Tricuspid valve"
      },
      {
        "id": 2,
        "text": "Pulmonary veins"
      },
      {
        "id": 3,
        "text": "Pulmonary artery"
      },
      {
        "id": 4,
        "text": "Truncus arteriosus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario suggests the neonate has a <strong>cyanotic heart defect</strong> and the given x-ray shows <strong>figure of 8</strong> or <strong>snowman appearance</strong> characteristic of<strong> total anomalous pulmonary venous circulation (TAPVC)</strong>.</p>\n<p><strong>TAPVC\u00a0</strong>refers to a condition in which <strong>pulmonary veins</strong> instead of draining into the left atrium drain into the right atrium directly or indirectly. This results in anomalous drainage of pulmonary venous blood flow into the systemic venous circulation. It is a cyanotic heart disease with features of congestive heart failure. The patients are irritable and have failure to thrive.\u00a0</p>\n<p>The following types are seen:</p>\n<ul>\n<li><strong>Supracardiac</strong> <strong>(most common)</strong>: Common pulmonary vein drains into the superior vena cava or the left innominate vein.</li>\n<li><strong>Cardiac:</strong> Pulmonary veins drain into the right atrium or coronary sinus.</li>\n<li><strong>Infracardiac </strong>(always obstructive and most dangerous): Pulmonary veins drain into the portal vein or inferior vena cava.</li>\n</ul>\n<p>Snowman appearance is classically seen in<strong> supracardiac variant</strong> of TAPVC. The dilated vertical vein on the left, the brachiocephalic vein on top, and the superior vena cava on the right form the head of the snowman; the body of the snowman is formed by the enlarged right atrium. It is shown in the image below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d6a4acd1df3346e9b9b602ba6b8907e0.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e32e24d5b85547a8bacea7fecf7b6af0x1280x1561.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3651148edf32400ab62f7291f87aa826x1200x1429.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0cae4817e5bb4f47aa10c959ea6df044x510x709.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8c3acc75aa994cc680debacb9a48410bx1280x1260.JPEG"
    ]
  },
  {
    "text": "A young woman presented to the emergency with epistaxis due to multiple episodes of continuous violent sneezes. To control the bleeding the following technique was performed as shown in the image given below. This method helps her to control bleeding from the septal branches of all of the following arteries, except _______.",
    "choices": [
      {
        "id": 1,
        "text": "Superior labial artery"
      },
      {
        "id": 2,
        "text": "Posterior ethmoidal artery"
      },
      {
        "id": 3,
        "text": "Sphenopalatine artery"
      },
      {
        "id": 4,
        "text": "Greater palatine artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows<strong><span data-preserver-spaces=\"true\"> Trotter&rsquo;s method.</span></strong><strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong>This method helps her to control bleeding from all of the given arteries,&nbsp;<strong>except</strong> t<span data-preserver-spaces=\"true\">he <strong>septal branch of the posterior ethmoidal artery.&nbsp;</strong></span></p>\n<p><span data-preserver-spaces=\"true\">Trotter's method is a step to control epistaxis from&nbsp;<strong>Little&rsquo;s area.&nbsp;</strong></span><span data-preserver-spaces=\"true\">Here, the patient is made to sit, leaning a little forward over a basin to spit any blood and breathe quietly from the mouth and&nbsp;pinching the nose with the thumb and index finger for about 5 minutes.&nbsp;The septal branch of the posterior ethmoidal artery<strong>&nbsp;</strong>does not take part in the vascular anastomoses seen in this area. Hence, it fails to prevent bleeding from this artery.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Little&rsquo;s area</span></strong><span data-preserver-spaces=\"true\">&nbsp;is situated at the</span><strong><span data-preserver-spaces=\"true\">&nbsp;anteroinferior </span></strong>part of the<strong><span data-preserver-spaces=\"true\"> nasal septum,&nbsp;</span></strong><span data-preserver-spaces=\"true\">just above the vestibule. It is the&nbsp;</span>most<strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong><span data-preserver-spaces=\"true\">common site of epistaxis</span><strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong>in<strong><span data-preserver-spaces=\"true\"> children </span></strong>and<strong><span data-preserver-spaces=\"true\"> young adults. </span></strong>S<span data-preserver-spaces=\"true\">eptal branches of four arteries anastomose here to form a vascular plexus called <strong>Kiesselbach&rsquo;s plexus</strong>. The arteries include:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>superior labial</strong> artery</span></li>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>anterior ethmoidal</strong> artery</span></li>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>sphenopalatine</strong> artery</span></li>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>greater palatine</strong> artery</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">Note: <strong>Woodruff's plexus</strong>&nbsp;</span>is a site of posterior epistaxis in adults. It is a plexus of veins situated inferior to the posterior end of inferior turbinate.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/833b214fe55f4a5088d97e37e3f1703f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc5dba114fab4cdd874c32c2b90d95c0x600x1072.JPEG"
    ]
  },
  {
    "text": "A tourist presented with fever, lymphadenopathy, and a skin lesion as shown below after a forest hike. He remembers getting an insect bite during the forest hike. Which of the following is the causative organism for the above disease?",
    "choices": [
      {
        "id": 1,
        "text": "Orientia tsutsugamushi"
      },
      {
        "id": 2,
        "text": "Rickettsia prowazekii"
      },
      {
        "id": 3,
        "text": "Rickettsia conorii"
      },
      {
        "id": 4,
        "text": "Rickettsia rickettsii"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of insect bite followed by fever and lymphadenopathy and the clinical image of <strong>eschar</strong> formation are suggestive of&nbsp;<strong>scrub typhus. </strong>The causative organism for scrub typhus is<strong>&nbsp;<em>O. tsutsugamushi.</em></strong></p>\n<p>Scrub typhus&nbsp;is caused by&nbsp;<em>O. tsutsugamushi<strong>&nbsp;</strong></em>and the vector is&nbsp;<strong>trombiculid</strong> mite. Clinical features include<strong> fever,</strong> <strong>lymphadenopathy</strong>, headache, and <strong>eschar</strong> where the chigger has been fed.</p>\n<p>Serologic assays are used for diagnosis. <strong>Doxycycline, Azithromycin</strong>, or <strong>chloramphenicol</strong> are also used for the treatment.&nbsp;In the case of pregnant women<strong>&nbsp;</strong>where doxycycline is relatively contraindicated,&nbsp;azithromycin<strong>&nbsp;</strong>may be preferred.</p>\n<p>The image below shows the&nbsp;trombiculid mite:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0e2fb10f282d467899050d9d0da04f1b.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/384660830c4b42fe9ef3c336184acb24x720x766.JPEG"
    ]
  },
  {
    "text": "A 47-year-old male patient comes to the clinic with complaints of abdominal pain, intense pruritus, and weight loss for the past four months. Further evaluation reveals the laboratory findings:",
    "choices": [
      {
        "id": 1,
        "text": "c-ANCA is a commonly associated antibody in this condition"
      },
      {
        "id": 2,
        "text": "This patient should be evaluated for the presence of inflammatory bowel disease"
      },
      {
        "id": 3,
        "text": "Osteoporosis is a complication of advanced disease"
      },
      {
        "id": 4,
        "text": "The only curative option for this patient is liver transplantation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of <strong>primary sclerosing cholangitis </strong>and it is commonly <strong>associated with p-ANCA </strong>antibody,<strong> not c-ANCA.</strong></p>\n<p class=\"p1\"><strong>Primary Sclerosing Cholangitis&nbsp;</strong>(PSC)<strong>&nbsp;</strong>is characterized by inflammatory strictures involving intrahepatic and extrahepatic biliary tree. It eventually leads to secondary biliary cirrhosis. It affects the age group 30&ndash;45 years with a male: female ratio of 2:1.&nbsp;It is <strong>associated </strong>with<strong> ulcerative colitis,</strong>&nbsp;Riedel&rsquo;s thyroiditis, and retroperitoneal fibrosis.<strong>&nbsp;</strong>Patients may also develop <strong>cholangiocarcinoma</strong>.&nbsp;</p>\n<p><strong>Clinical features</strong> of a patient with PSC include:</p>\n<ul>\n<li>Intermittent jaundice</li>\n<li>Fatigue</li>\n<li>Weight loss</li>\n<li>Pruritus</li>\n<li>Abdominal pain</li>\n</ul>\n<p>Liver function tests show a <strong>cholestatic</strong> pattern with an <strong>elevation of ALP</strong> and<strong> GGT</strong> and smaller rises in the aminotransferases. Bilirubin values may be variable. There is <strong>hypergammaglobulinemia</strong>.</p>\n<p>Endoscopic retrograde cholangiography (ERC) is a gold standard in diagnosis and shows multiple dilatations and strictures (beading) of both<strong> intra and extrahepatic biliary tree</strong>.</p>\n<p>Currently, there is no known effective medical therapy. Surgical management with resection of extrahepatic biliary tree and hepaticojejunostomy has shown reasonable effects. For patients with sclerosing cholangitis with advanced liver disease, <strong>liver transplantation</strong> is the&nbsp;only available option that is curative. A long-standing complication of this condition includes&nbsp;<strong>osteoporosis</strong>,<strong>&nbsp;</strong>cirrhosis, and cholangiocarcinoma.</p>\n<p>The below image shows a cholangiogram of primary sclerosing cholangitis. There are diffuse strictures of intrahepatic and extrahepatic bile ducts with dilatation of the areas in between:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/80a506d1889d42b29ada973b84427e4c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ba8b55c65bd944ad81457059cf2adb90x315x307.JPEG"
    ]
  },
  {
    "text": "A lady diagnosed with breast carcinoma underwent chemotherapy and reports hair loss after two weeks. What is this pattern of hair loss known as?",
    "choices": [
      {
        "id": 1,
        "text": "Alopecia areata"
      },
      {
        "id": 2,
        "text": "Telogen effluvium"
      },
      {
        "id": 3,
        "text": "Anagen effluvium"
      },
      {
        "id": 4,
        "text": "Telogen gravidarum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Alopecia&nbsp;after chemotherapy</strong>&nbsp;is known as <strong>anagen effluvium.</strong>&nbsp;</p>\n<p>Hair loss following chemotherapy usually occurs within 1&ndash;3 weeks after initiation of the therapy. In this type of hair loss, the anagen phase is abruptly terminated. This leads to the loss of dystrophic or broken hairs and the condition is called anagen effluvium. The hair loss is acute and diffuse. However, there is full recovery within a few months of stopping the causative drug.&nbsp;</p>\n<p>The<strong> most important drugs</strong> implicated <strong>in the order of decreasing frequency</strong> of association causing <strong>anagen effluvium</strong>:</p>\n<ol>\n<li>Anti-microtubule agents (paclitaxel)</li>\n<li>Topo-isomerase inhibitors (doxorubicin)</li>\n<li>Alkylating agents (cyclophosphamide)</li>\n<li>Anti-metabolites (5-fluorouracil)</li>\n</ol>\n<div class=\"page\" title=\"Page 2309\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Alopecia areata</strong> is a chronic inflammatory condition that causes non-scarring hair loss. It is caused by a T\u2010cell\u2010mediated autoimmune mechanism. The characteristic initial lesion is a smooth, circum&shy;scribed patch of hair loss. Short, easily extractable broken hairs are seen at the margins of the patch, known as exclamation mark hairs.</p>\n<p>Option B: <strong>Telogen effluvium</strong> refers to an increase in the shedding of telogen club hairs due to premature termination of the anagen phase. It is an acute\u2010onset hair loss. It usually occurs 2&ndash;3 months following a triggering event such as high fever, surgery, sudden starvation, or hemorrhage.</p>\n<p>Option D: <strong>Telogen gravidarum</strong> refers to the telogen hair loss that occurs 2&ndash;3 months after childbirth.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman presented with mood disturbance, tearfulness, and a lack of energy on the 5th day of postpartum. She was counseled and educated about postpartum blues. She should be evaluated for postpartum depression if her symptoms last longer than:",
    "choices": [
      {
        "id": 1,
        "text": "1 week"
      },
      {
        "id": 2,
        "text": "2 months"
      },
      {
        "id": 3,
        "text": "1 month"
      },
      {
        "id": 4,
        "text": "2 weeks"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient should be evaluated for postpartum depression if her symptoms <strong>last &gt;2 weeks</strong>.</p>\n<p><strong>Postpartum blues</strong> is common in mothers in the puerperal period. It is characterized by <strong>transient</strong> mood disturbances like a <strong>labile mood&nbsp;</strong>and sadness. It<strong>&nbsp;</strong>typically develops&nbsp;<strong>within one week&nbsp;</strong>of&nbsp;<strong>delivery.&nbsp;</strong>It is thought to be due to changes in hormone levels, the stress of childbirth, and anxiety about the responsibilities of motherhood.&nbsp;Treatment is nothing more than <strong>education </strong>and <strong>support, </strong>however,<strong> symptoms lasting longer</strong> than <strong>2 weeks</strong> should be <strong>evaluated</strong> for <strong>postpartum depression</strong>.</p>\n<p><strong>Postpartum depression</strong> is characterized by a&nbsp;<strong>minimum</strong>&nbsp;of&nbsp;<strong>5 symptoms</strong>&nbsp;of major depressive disorder i.e. impaired sleep, interest, guilt, energy, concentration, appetite, psychomotor activity, and suicidal ideation lasting for &gt;2 weeks.&nbsp;It is usually seen within the <strong>4-6 weeks</strong>. There may be associated thoughts of suicide or of <strong>harming</strong> the<strong> baby</strong>.&nbsp;</p>\n<p><strong>Postpartum psychosis</strong>&nbsp;or puerperal psychosis is a psychotic disorder characterized by&nbsp;<strong>hallucinations</strong>,&nbsp;<strong>delusions</strong>,&nbsp;<strong>suicidal</strong>&nbsp;<strong>thoughts</strong>, and<strong>&nbsp;thoughts</strong>&nbsp;of&nbsp;<strong>harming&nbsp;</strong>the&nbsp;<strong>baby</strong>. It is a <strong>psychiatric emergency</strong> and usually has a mean time of onset of&nbsp;<strong>2-3</strong>&nbsp;<strong>weeks postpartum&nbsp;</strong>although it can occur in the first few days.&nbsp;The onset of psychotic symptoms is usually preceded by insomnia, restlessness, agitation, lability of mood, and mild cognitive deficits. The treatment of choice involves <strong>antipsychotics</strong> and<strong> lithium</strong>, with an <strong>antidepressant</strong>.&nbsp;</p>\n<p><strong>Postpartum delirium</strong> is characterized by&nbsp;<strong>fluctuating</strong>&nbsp;<strong>levels</strong>&nbsp;of&nbsp;<strong>awareness </strong>or <strong>attention</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are examining the injuries in a suspected case of homicide. The shape of the stab wound that you notice is depicted in the image below. What type of weapon might have caused this injury?",
    "choices": [
      {
        "id": 1,
        "text": "Single edged knife"
      },
      {
        "id": 2,
        "text": "Double-edged knife"
      },
      {
        "id": 3,
        "text": "Ice pick"
      },
      {
        "id": 4,
        "text": "Screw driver"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows a <strong>wedge-shaped wound</strong>, which is caused by injury with a <strong>single-edged knife.</strong></p>\n<p>A stab wound occurs when the force is applied into the depths of the body, along the long axis of narrow or pointed weapons like knives, daggers, swords, etc. The depth of the stab wound is more than its length and width.</p>\n<div class=\"page\" title=\"Page 212\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The size and shape of a stab wound depend on the weapon, the body part that is stabbed, the depth of insertion, angle of withdrawal, the direction of thrust, and the condition of tension or relaxation of the skin.&nbsp;</p>\n<div class=\"page\" title=\"Page 213\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The shape of the wound usually corresponds to the weapon used, but the shape of the wounds made by the same weapon may differ on different parts of the body.&nbsp;</p>\n<p>Single-edged weapons cause <strong>triangular</strong> or <strong>wedge-shaped</strong> wounds. One angle of the wound will be sharp, while the other will be rounded, blunt, or squared off. If the back edge of the blade is stout, small splits in the skin at the corners of the blunt end of the wound may be seen. These are referred to as fishtailing.</p>\n<p>Other options:</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Option B -&nbsp;</strong>A <strong>double-edged knife</strong> would produce a <strong>slit-like </strong>or<strong> elliptical wound</strong>. Both the edges of the wound are likely to be sharp.</p>\n<p><strong>Option C -&nbsp;</strong>An <strong>ice pick</strong> would produce a single <strong>small circular wound</strong> resembling wounds caused by a small caliber gun.</p>\n<p><strong>Option D - </strong>A <strong>screwdriver</strong> would produce a <strong>slit-like wound</strong> with <strong>squared edges</strong>.</p>\n<p>The types of wounds produced by different weapons are summarized in the image below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fff7c2afb4fe40818ae2769120dae1d9.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/706526acbaac4fc4a846ed31d74482e8x1280x1851.PNG"
    ]
  },
  {
    "text": "A child is brought to the doctor with severe agonizing, burning pain in the hands, feet, and proximal extremities. On examination, he also has telangiectatic skin lesions, particularly between the umbilicus and knees. The ophthalmic examination also reveals corneal opacity. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Fabry disease"
      },
      {
        "id": 2,
        "text": "Niemann-Pick disease"
      },
      {
        "id": 3,
        "text": "Gaucher disease"
      },
      {
        "id": 4,
        "text": "Tay-Sachs disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis is <strong>Fabry disease.</strong></p>\n<p><strong>Fabry disease</strong>&nbsp;is an&nbsp;<strong>X-linked</strong>&nbsp;inborn error of glycosphingolipid metabolism because of deficient activity of&nbsp;<strong>&alpha;-galactosidase A </strong>enzyme. This enzyme deficiency leads to accumulations of neutral glycosphingolipids, primarily&nbsp;<strong>globotriaosylceramide</strong>, especially in the plasma and lysosomes of vascular endothelial and smooth muscle cells, cardiac myocytes, and renal podocytes. The features of Fabry disease include:</p>\n<ul>\n<li><strong>Angiokeratomas</strong>- telangiectatic skin lesions characteristically seen densest between the umbilicus and knees called the bathing trunk area</li>\n<li>Hypohidrosis - decreased sweating</li>\n<li><strong>Corneal&nbsp;</strong>and&nbsp;lenticular opacities (<strong>Cornea verticillata</strong>)</li>\n<li>Painful <strong>acroparesthesias</strong>&nbsp;</li>\n<li><strong>Fabry crises&nbsp;</strong>- severe agonizing pain in the hands, feet, and proximal extremities</li>\n<li>Urinary examination shows lipid inclusions with birefringent&nbsp;<strong>maltese cross</strong></li>\n</ul>\n<p>&nbsp;Given below is the image of <strong>cornea verticillata.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d5861221eb74b53be6a81fd2764cab9x1200x719.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b15a11d8bfff41698cc4ad0f6534a475x720x632.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a8ce296c7ab54af8be9d8d3c020a44f2x720x538.JPEG"
    ]
  },
  {
    "text": "A 54-year-old man had an NSTEMI 3 years ago and was lost to follow-up. He has now presented with dyspnea on exertion and pedal edema. On examination, he has an elevated JVP, hepatomegaly, and ascites. Which of the following drugs is not found to decrease the risk of mortality in him?",
    "choices": [
      {
        "id": 1,
        "text": "Enalapril"
      },
      {
        "id": 2,
        "text": "Metoprolol"
      },
      {
        "id": 3,
        "text": "Dapagliflozin"
      },
      {
        "id": 4,
        "text": "Digoxin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario is suggestive of <strong>heart failure</strong> secondary to NSTEMI.<strong> Digoxin</strong> is not found to decrease the risk of mortality in heart failure.</p>\n<p>Heart failure is a complex clinical syndrome that occurs because the <strong>ventricle</strong> is<strong> unable</strong> to<strong> fill</strong> with or <strong>eject blood</strong>. The important etiologies of heart failure include\u00a0<strong>hypertension</strong>,\u00a0diabetes mellitus,\u00a0<strong>coronary artery disease</strong>, <strong>myocardial infarction</strong>,\u00a0high output states, such as beriberi, thyrotoxicosis, and severe anemia.</p>\n<p>Clinical features of heart failure include <strong>dyspnea on exertion, orthopnea, pedal edema,</strong> anorexia, pallor, elevated JVP, ascites, and hepatomegaly.</p>\n<p>Heart failure is classified based on the <strong>ejection fraction</strong>:</p>\n<div class=\"page\" title=\"Page 87\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Heart failure with\u00a0<strong>preserved ejection fraction</strong>\u00a0<strong>(HFpEF) </strong>- left ventricular ejection fraction is\u00a0<strong>\u226550%</strong></li>\n<li>Heart failure with<strong> mid-range ejection fraction (HFmEF) -\u00a0</strong>left ventricular ejection fraction <strong>40-50%</strong></li>\n<li>Heart failure with\u00a0<strong>reduced ejection fraction (HFrPF) </strong>- left ventricular ejection fraction is <strong>\u226440%</strong></li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>The mainstay management of heart failure is medical therapy and device therapy is reserved for refractory cases. The type of medications used in medical therapy are:</p>\n<ul>\n<li>Drugs with <strong>symptomatic</strong> and <strong>mortality benefits</strong> provide symptomatic relief and reduce mortality risk by <strong>preventing cardiac remodeling</strong>. It includes -\u00a0\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Angiotensin receptor\u2013neprilysin inhibitor (ARNI) - a combination of <strong>sacubitril</strong> and <strong>valsartan</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Angiotensin-converting enzyme (ACE) inhibitors - ramipril, <strong>enalapril</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">\u03b2-blockers -<strong> metoprolol</strong>, carvedilol, bisoprolol</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Mineralocorticoid receptor antagonist -<strong> spironolactone</strong>, eplerenone</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Sodium-glucose cotransporter 2 inhibitors (SGLT2 inhibitor) -<strong> dapagliflozin</strong></li>\n</ul>\n</li>\n<li>Drugs with only symptomatic benefits provide only symptomatic relief and have no effect on reducing mortality risk. It includes -\u00a0\n<ul>\n<li>Loop diuretics - <strong>furosemide</strong></li>\n<li><strong>Digoxin</strong></li>\n</ul>\n</li>\n</ul>\n<p>Unfortunately, evidence of the clinical benefits of most therapies is restricted to <strong>HFrEF</strong>. Pharmacological therapy used in <strong>HFpEF</strong> is mainly <strong>diuretics</strong>.</p>\n<p><strong>Non-pharmacological therapy</strong> includes\u00a0<strong>implantable cardioverter defibrillators (ICD),\u00a0</strong><strong>cardiac resynchronization</strong> using biventricular pacing, etc.\u00a0These treatments are not found to be effective in HFpEF.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While calculating the ankle-brachial pressure index for patients with peripheral vascular disease using the formula X/systolic pressure of the brachial artery, what is taken as the value of 'X'?",
    "choices": [
      {
        "id": 1,
        "text": "Highest of systolic pressure of dorsalis pedis, posterior tibial or peroneal arteries"
      },
      {
        "id": 2,
        "text": "One-third of the systolic pressure of dorsalis pedis artery"
      },
      {
        "id": 3,
        "text": "Two third of the systolic pressure of  posterior tibial artery"
      },
      {
        "id": 4,
        "text": "Sum of systolic pressures of peroneal and dorsalis pedis arteries"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ankle-brachial pressure index<strong> (ABPI)</strong> is the <strong>ratio of systolic pressure at the ankle to that in the ipsilateral arm.&nbsp;</strong>The&nbsp;<strong>numerator </strong>is the<strong>&nbsp;highest pressure</strong> in the <strong>dorsalis pedis, posterior tibial,</strong> or <strong>peroneal artery.&nbsp;</strong>The&nbsp;<strong>brachial</strong> systolic pressure in the ipsilateral arm is the<strong> denominator. </strong></p>\n<p><strong>Interpretation:</strong></p>\n<ul>\n<li>&gt;0.9 &ndash; Normal</li>\n<li>&lt;0.9 &ndash; Claudication</li>\n<li>&lt;0.5 &ndash; Rest pain</li>\n<li>&lt;0.4 &ndash; Imminent necrosis (Critical Limb Ischemia)</li>\n</ul>\n<p><span style=\"text-decoration: underline;\"><strong>Peripheral arterial disease (PAD) -</strong></span>&nbsp;</p>\n<p>PAD presents as&nbsp;<strong>intermittent claudication,</strong>&nbsp;which is pain that increases with walking and may sometimes present with&nbsp;<strong>rest pain</strong>. It is generally caused by&nbsp;<strong>atherosclerosis</strong>&nbsp;but may also be due to trauma. The&nbsp;<strong>initial investigation</strong>&nbsp;done is an&nbsp;<strong>ABPI</strong>. Physical exam findings include atrophied skin,<strong>&nbsp;pallor on raising leg (Buerger's test)</strong>, nail changes, and decreased peripheral pulses.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An unimmunized child developed a fever, cough, and conjunctival congestion. 4 days later he developed a rash behind his ears which soon became widespread as shown in the image below. On examination, bluish-white spots were seen on the inner aspect of the cheek. Which of the following statements is false regarding the complications associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Myocarditis is the most common cause of death"
      },
      {
        "id": 2,
        "text": "Hemorrhagic form of the disease is often fatal"
      },
      {
        "id": 3,
        "text": "Low levels of retinol is associated with increased  mortality"
      },
      {
        "id": 4,
        "text": "Acute otitis media is the most common complication"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The clinical vignette and the image showing a morbilliform rash are suggestive of&nbsp;<strong>measles.&nbsp;</strong>The incorrect statement about the complication related to this condition is that myocarditis is the most common cause of death.<strong> Pneumonia</strong> is the most common cause of death in measles.&nbsp;</p>\n<p class=\"p1\">Pneumonia in measles can be&nbsp;<strong>giant cell pneumonia&nbsp;</strong>which is caused by the virus directly or can be due to superadded bacterial infection.</p>\n<p class=\"p1\"><strong>Measles infection&nbsp;</strong>is caused by a&nbsp;<strong>single-stranded</strong>,&nbsp;<strong>lipid-enveloped RNA Paramyxovirus</strong>. It has an incubation period of&nbsp;8-12 days, after which&nbsp;the prodrome phase begins with mild fever, conjunctivitis, upper respiratory tract infection, and pathognomic <strong>Koplik spots</strong>. These spots are&nbsp;<strong>small, bluish-white ulcerations</strong> on the inner aspect of the cheek at the level of the premolars.</p>\n<p class=\"p1\">A maculopapular rash appears <strong>4 days</strong> after fever, which begins at the <strong>face</strong> and spreads to the torso and extremities. Lymphadenopathy may be present. Patients can transmit infection <strong>3 days before</strong> and <strong>4-6 days after</strong> the onset of rash. The morbilliform rash is shown below.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a6fc6b0fd5d04c38a4988afd50357804.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cc2323c53a5043389da8f7df69608e9ax685x1053.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/198e8cf803f64ebe9e6072cbdf854377x720x492.JPEG"
    ]
  },
  {
    "text": "A patient with deep vein thrombosis was started on a new drug. This drug acts by inhibiting the enzyme vitamin K epoxide reductase. Which of the following drugs is used in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Warfarin"
      },
      {
        "id": 2,
        "text": "Heparin"
      },
      {
        "id": 3,
        "text": "Dabigatran"
      },
      {
        "id": 4,
        "text": "Rivaroxaban"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Warfarin </strong>acts by inhibiting the enzyme&nbsp;<strong>vitamin K epoxide reductase</strong>.</p>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p><strong>Activation</strong> of <strong>coagulation factors II, VII, IX,</strong> and <strong>X</strong> and proteins C and S is done by <strong>carboxylation</strong> of their glutamate residues, with the help of the reduced form of <strong>vitamin</strong> <strong>K</strong> as a co-factor. This reduced form of vitamin K needs to be constantly recycled back from its oxidized form for the reaction to continue. This recycling is done by the enzyme&nbsp;<strong>vitamin K epoxide reductase,&nbsp;</strong>which&nbsp;is&nbsp;<strong>competitively</strong>&nbsp;<strong>inhibited by warfarin</strong>. Hence, there will be a reduction in the activation of coagulation factors.</p>\n<p>The image below shows warfarin's mechanism of action.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2bc835721e6e4ef99b01e279efaeada3x1279x1234.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 7';
        const quizFilename = 'mini-test-7-d78fbac6.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2022-23"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>