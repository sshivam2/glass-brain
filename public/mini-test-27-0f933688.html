<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 27 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The following capnographic waveform is suggestive of:",
    "choices": [
      {
        "id": 1,
        "text": "Malignant hyperthermia"
      },
      {
        "id": 2,
        "text": "Bronchospasm"
      },
      {
        "id": 3,
        "text": "Rebreathing"
      },
      {
        "id": 4,
        "text": "Accidental extubation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given capnographic waveform is suggestive of <strong>bronchospasm</strong>.</p>\n<p><strong>Capnography</strong> refers to the method of <strong>CO2</strong> measurement as a function of time or volume. <strong>Bronchospasms</strong> may be due to respiratory pathologies like <strong>asthma, chronic obstructive</strong> pulmonary disease (COPD), or <strong>acute lung injury.</strong> Another cause of this waveform is a <strong>partially obstructed endotracheal</strong> tube or breathing circuit. Capnographic changes in bronchospasm include:</p>\n<ul>\n<li>Loss of verticality of Phase II</li>\n<li>The opening of the angle between phases 2 and 3 (\u03b1 angle)</li>\n<li>Increased upslope of phase III</li>\n<li>No plateau before the next inspiration</li>\n<li><strong>Shark fin</strong> appearance - in severe cases</li>\n</ul>\n<p>\u00a0Normal capnography is shown in the image below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe66ce83cf0f49da855b5fec4985dce1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8341e8c2b6024c32aadcc20933fd2adex1280x1075.JPEG"
    ]
  },
  {
    "text": "An adolescent girl presents to you with lesions on her face. She confides in you that she frequently picks the real or imagined acne from her face and does this when she is under stress. The term used for this self-inflicted skin condition is called:",
    "choices": [
      {
        "id": 1,
        "text": "Acne excori\u00e9e"
      },
      {
        "id": 2,
        "text": "Acne mechanica"
      },
      {
        "id": 3,
        "text": "Acne conglobata"
      },
      {
        "id": 4,
        "text": "Acne fulminans"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Acne excori&eacute;e</strong>&nbsp;is a self-inflicted skin condition,&nbsp;in which the <strong>sufferer compulsively picks real or imagined acne lesions</strong> predominantly on the face. It is predominantly seen in <strong>adolescent girls</strong>.&nbsp;</p>\n<p>Other psychiatric disorders associated with acne are:</p>\n<ul>\n<li><strong>Body dysmorphic disorder:</strong>&nbsp;A small number of patients with BDD have acne as their prime symptom. The perceived acne is out of proportion to physical signs.</li>\n<li><strong>Eating disorders:</strong>&nbsp;Acne has been reported in anorexia nervosa. Acne itself may be a predisposing factor for anorexia in vulnerable teenage age groups who adopt a diet in an attempt to control their acne.&nbsp;</li>\n</ul>\n<p>Other options:</p>\n<p>Option B: <strong>Acne mechanica:</strong>&nbsp;This term describes acneform lesions that occur at the site of <strong>repeated mechanical trauma and/or frictional obstruction of the pilosebaceous outlet</strong>. Examples include mechanical pressure from high\u2010necked jerseys, shoulder pads, seat backs in trucks, or adhesive plasters causing acneform folliculitis.</p>\n<p>Option C:<strong> Acne conglobata:&nbsp;</strong>Acne conglobata represents a <strong>rare and severe form</strong> of acne characterized by multiple and extensive<strong> inflammatory papules</strong>, tender nodules, and abscesses which commonly <strong>coalesce</strong> to form <strong>malodorous draining sinus tracts</strong>.</p>\n<p>Option D:<strong> Acne fulminans:</strong>&nbsp;Acne fulminans or acne maligna is a rare and severe destructive form of acne presenting <strong>primarily in adolescent males</strong>. It most frequently affects the<strong> trunk</strong> but can affect the face. It presents acutely in<strong> association with systemic symptoms</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A farmer presented with a mass on his jaw, containing draining sinuses with purulent discharge. The culture of the discharge from the sinus grew colonies, which are shown in the image given below. What is the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Cryptococcus"
      },
      {
        "id": 2,
        "text": "Bacillus anthracis"
      },
      {
        "id": 3,
        "text": "Actinomyces"
      },
      {
        "id": 4,
        "text": "Klebsiella"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario along with the image showing <strong>molar tooth colonies&nbsp;</strong>that are&nbsp;characteristic of <strong>actinomyces</strong> species. The given clinical scenario describes a <strong>lumpy jaw</strong> seen in<strong> cervicofacial actinomycosis.</strong></p>\n<p class=\"p1\">Actinomycosis is a chronic suppurative and granulomatous infection caused by <em>Actinomyces</em>. It presents as one of the following clinical types:</p>\n<ul>\n<li class=\"p1\"><strong>Cervicofacial</strong> actinomycosis- fluctuant mass in the jaw area producing draining fistulas (lumpy jaw)</li>\n<li class=\"p1\"><strong>Thoracic</strong> actinomycosis- pulmonary infection with fever, cough, and purulent sputum.&nbsp;</li>\n<li class=\"p1\"><strong>Abdominal</strong> actinomycosis- following ruptured appendix or ulcer. It may involve multiple organs.</li>\n</ul>\n<p class=\"p1\">The image given below shows cervicofacial actinomycosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7d7da7d93524427bb535f7a6888c557a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8baebbe837aa478ab1eb3abf7a417457x401x599.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/71207f08b1304388b3c728137772ec09x700x460.JPEG"
    ]
  },
  {
    "text": "Parkinson\u2019s triangle is related to:",
    "choices": [
      {
        "id": 1,
        "text": "Cavernous sinus"
      },
      {
        "id": 2,
        "text": "Basal ganglia"
      },
      {
        "id": 3,
        "text": "4th ventricle"
      },
      {
        "id": 4,
        "text": "Mastoid bone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The space between the trochlear and ophthalmic nerves at the lateral wall of the <strong>cavernous</strong> <strong>sinus</strong>&nbsp;is known as the <strong>infratrochlear</strong> or <strong>Parkinson&rsquo;s triangle.</strong></p>\n<div>Parkinson&rsquo;s triangle (infratrochlear triangle) is a triangle formed by the following structures:</div>\n<ul>\n<li><strong>Medial</strong> border: Inferior margin of the <strong>trochlear nerve</strong> from its beginning in the lateral wall of the cavernous sinus to its transit through the superior orbital fissure</li>\n<li><strong>Lateral</strong> border: Superior margin of the <strong>ophthalmic division</strong> of the trigeminal nerve&nbsp;</li>\n<li>Base: Line connecting the entry points of these 2 nerves into the cavernous sinus</li>\n</ul>\n<p>It gives access to the <strong>horizontal</strong>&nbsp;<strong>cavernous part</strong>,&nbsp;<strong>posterior</strong> <strong>genu and&nbsp;</strong><strong>meningohypophyseal</strong> <strong>trunk of the internal carotid artery,&nbsp;</strong>and <strong>abducens</strong> <strong>nerve</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/35bd896853334b1b956d5852d36511ebx1280x1653.JPEG"
    ]
  },
  {
    "text": "Match the following DNA polymerase enzymes with their functions :",
    "choices": [
      {
        "id": 1,
        "text": "1-A, 2-C, 3-B 4-D"
      },
      {
        "id": 2,
        "text": "1-B, 2-D, 3-A, 4-C"
      },
      {
        "id": 3,
        "text": "1-C, 2-B, 3-D 4-A"
      },
      {
        "id": 4,
        "text": "1-D, 2-A, 3-C, 4-B"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The option which is correctly matched is B with&nbsp;1-B, 2-D, 3-A, 4-C</p>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>DNA Polymerase</strong></td>\n<td style=\"text-align: center;\"><strong>Function</strong></td>\n</tr>\n<tr>\n<td>1.&nbsp;&beta;</td>\n<td>B.&nbsp;DNA repair</td>\n</tr>\n<tr>\n<td>2.&nbsp;&gamma;</td>\n<td>D.&nbsp;Mitochondrial DNA synthesis</td>\n</tr>\n<tr>\n<td>3.&nbsp;&alpha;</td>\n<td>A.&nbsp;Primase</td>\n</tr>\n<tr>\n<td>4.&nbsp;&delta;</td>\n<td>C.&nbsp;Processive, lagging strand synthesis</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p><strong>DNA polymerase</strong> engages in DNA replication and has 3 essential properties :</p>\n<ul>\n<li>Chain elongation: It accounts for the rate&nbsp;at which DNA polymerization occurs. The rate is in nucleotides per second (nt/s)</li>\n<li>Processivity: This is an expression of the number of nucleotides added to the nascent chain before the polymerase disengages from the template</li>\n<li>Proofreading: The function where&nbsp;copying errors are identified and corrected</li>\n</ul>\n<p>The prokaryotic DNA polymerases are DNA polymerases I, II, and III.</p>\n<ul>\n<li><strong>DNA polymerase I: Gap filling</strong> following DNA replication, repair, and recombination</li>\n<li><strong>DNA polymerase II</strong>: DNA <strong>proofreading and repair.</strong></li>\n<li><strong>DNA polymerase III</strong>: The primary enzyme for the<strong> synthesis of the leading strand of DNA.&nbsp;</strong></li>\n</ul>\n<p>Eukaryotic cells have&nbsp;a large number of DNA polymerases primarily involved in DNA repair</p>\n<ul>\n<li>DNA Pol &alpha; synthesizes RNA primers which are responsible for the initiation of DNA synthesis.</li>\n<li>DNA pol&nbsp;&beta; has a primary role in DNA repair</li>\n<li>DNA pol &gamma; is responsible for mitochondrial DNA synthesis</li>\n<li>DNA&nbsp;pol &epsilon; and pol &delta; catalyze leading and lagging&nbsp;strand synthesis.&nbsp;</li>\n</ul>\n<p>The following image is a schematic image showing DNA replication in a eukaryotic cell :</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d9e1b6352a584242b80cac6a08678d3bx1280x1866.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a criteria for discharging a patient recovering from dengue?",
    "choices": [
      {
        "id": 1,
        "text": "Absence of fever for 12 hours"
      },
      {
        "id": 2,
        "text": "Return of appetite"
      },
      {
        "id": 3,
        "text": "Platelet count >50,000/mm3"
      },
      {
        "id": 4,
        "text": "Adequate urine output"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The absence of fever for 12 hours is not a criterion for the discharge of a patient recovering from dengue. <strong>Fever</strong> should be <strong>absent</strong> for <strong>at least 24 hours</strong>\u00a0without the use of <strong>antipyretic</strong> drugs in order to discharge a patient recovering from dengue.</p>\n<p>Criteria for discharge of patients recovering from dengue:</p>\n<ul>\n<li>Absence of fever for at least <strong>24 hours</strong> without the use of antipyretic drugs</li>\n<li><strong>Platelet count &gt;50,000/mm<sup>3</sup></strong></li>\n<li><strong>Return of appetite</strong></li>\n<li><strong>Adequate urine output</strong></li>\n<li>Visible clinical improvement</li>\n<li>Minimum of 2-3 days after recovery from shock</li>\n<li>No respiratory distress from pleural effusion or ascites</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman presented to the emergency with epistaxis due to multiple episodes of continuous violent sneezes. To control the bleeding the following technique was performed as shown in the image given below. This method helps her to control bleeding from the septal branches of all of the following arteries, except _______.",
    "choices": [
      {
        "id": 1,
        "text": "Superior labial artery"
      },
      {
        "id": 2,
        "text": "Posterior ethmoidal artery"
      },
      {
        "id": 3,
        "text": "Sphenopalatine artery"
      },
      {
        "id": 4,
        "text": "Greater palatine artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows<strong><span data-preserver-spaces=\"true\"> Trotter&rsquo;s method.</span></strong><strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong>This method helps her to control bleeding from all of the given arteries,&nbsp;<strong>except</strong> t<span data-preserver-spaces=\"true\">he <strong>septal branch of the posterior ethmoidal artery.&nbsp;</strong></span></p>\n<p><span data-preserver-spaces=\"true\">Trotter's method is a step to control epistaxis from&nbsp;<strong>Little&rsquo;s area.&nbsp;</strong></span><span data-preserver-spaces=\"true\">Here, the patient is made to sit, leaning a little forward over a basin to spit any blood and breathe quietly from the mouth and&nbsp;pinching the nose with the thumb and index finger for about 5 minutes.&nbsp;The septal branch of the posterior ethmoidal artery<strong>&nbsp;</strong>does not take part in the vascular anastomoses seen in this area. Hence, it fails to prevent bleeding from this artery.</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Little&rsquo;s area</span></strong><span data-preserver-spaces=\"true\">&nbsp;is situated at the</span><strong><span data-preserver-spaces=\"true\">&nbsp;anteroinferior </span></strong>part of the<strong><span data-preserver-spaces=\"true\"> nasal septum,&nbsp;</span></strong><span data-preserver-spaces=\"true\">just above the vestibule. It is the&nbsp;</span>most<strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong><span data-preserver-spaces=\"true\">common site of epistaxis</span><strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong>in<strong><span data-preserver-spaces=\"true\"> children </span></strong>and<strong><span data-preserver-spaces=\"true\"> young adults. </span></strong>S<span data-preserver-spaces=\"true\">eptal branches of four arteries anastomose here to form a vascular plexus called <strong>Kiesselbach&rsquo;s plexus</strong>. The arteries include:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>superior labial</strong> artery</span></li>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>anterior ethmoidal</strong> artery</span></li>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>sphenopalatine</strong> artery</span></li>\n<li><span data-preserver-spaces=\"true\">Septal branch of the <strong>greater palatine</strong> artery</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">Note: <strong>Woodruff's plexus</strong>&nbsp;</span>is a site of posterior epistaxis in adults. It is a plexus of veins situated inferior to the posterior end of inferior turbinate.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/833b214fe55f4a5088d97e37e3f1703f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc5dba114fab4cdd874c32c2b90d95c0x600x1072.JPEG"
    ]
  },
  {
    "text": "Nysten\u2019s rule describes the sequential onset of:",
    "choices": [
      {
        "id": 1,
        "text": "Algor mortis"
      },
      {
        "id": 2,
        "text": "Rigor mortis"
      },
      {
        "id": 3,
        "text": "Livor mortis"
      },
      {
        "id": 4,
        "text": "Postmortem caloricity"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Nysten\u2019s rule</strong> describes the sequential onset of <strong>rigor mortis.</strong></p>\n<p>Rigor mortis is also known as cadaveric rigidity or death stiffening. It refers to the stiffening and shortening of muscles following death. Both voluntary and involuntary muscles are involved. In India, it begins 1-2 hours following death.</p>\n<p>Nysten's rule\u00a0describes the order of appearance of\u00a0rigor mortis\u00a0in the various\u00a0muscle groups. It first appears in the myocardium, which becomes rigid in an hour. The order of appearance of rigor mortis is:</p>\n<p>Myocardium&gt; eyelids &gt; neck and lower jaw &gt; face&gt; muscles of chest &gt; upper limb&gt; abdomen &gt; lower limb &gt; fingers and toes <strong>(proximo-distal progression)</strong></p>\n<p>It passes off in the same order of its appearance.</p>\n<div class=\"page\" title=\"Page 172\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Medicolegal importance:</p>\n<ul>\n<li>Sign of death</li>\n<li>Helps in estimating the time of death, but is not reliable</li>\n<li>Indicates the position of the body at the time of death</li>\n</ul>\n<p>Conditions that simulate rigor mortis include heat stiffening, cold stiffening, and cadaveric spasm.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy presented with growth over the nasal aspect of the left eye. Initially, it was small but has now progressed to the size shown in the image below. The vision was 6/12 in the left eye and refraction examination revealed astigmatism. Choose the correct statement regarding the management of this case.",
    "choices": [
      {
        "id": 1,
        "text": "It is best left alone for spontaneous resolution"
      },
      {
        "id": 2,
        "text": "Only medical management is sufficient at this stage"
      },
      {
        "id": 3,
        "text": "Limbal conjunctival tissue from the same eye can be used for grafting"
      },
      {
        "id": 4,
        "text": "Application of mitomycin C drops reduces recurrence with no complications"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical case and image point to a diagnosis of<strong>&nbsp;pterygium with astigmatism,</strong> for which <strong>conjunctival autografting</strong> is an effective method of treatment after excision. Conjunctival tissue can be taken from the limbus on the same side or from the other eye for grafting.</p>\n<p>A pterygium<strong>&nbsp;</strong>is a degenerative&nbsp;<strong>subconjunctival fibrovascular tissue</strong> encroaching the cornea.<strong>&nbsp;</strong>It is most commonly seen on the nasal aspect of the eye. It is made up of three parts:</p>\n<ul>\n<li>cap (an avascular halo-like zone at the advancing edge)</li>\n<li>head</li>\n<li>body</li>\n</ul>\n<p>Patients may be asymptomatic or present with irritation, grittiness, or episodes of inflammation. As they enlarge, it may obstruct vision and lead to astigmatism.</p>\n<p>Treatment:<strong>&nbsp;</strong></p>\n<div class=\"page\" title=\"Page 198\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>A pterygium is best left alone unless:\n<ul>\n<li>It is progressing towards the pupillary area</li>\n<li>Causes excessive astigmatism</li>\n<li>Restricts ocular motility</li>\n<li>Causes disfigurement.</li>\n</ul>\n</li>\n<li>Excision: Simple excision of the pterygium is associated with a high recurrence rate, and should be combined with:\n<ul>\n<li>Mitomycin C drops- applied pre-operatively/ intra-operatively or post-operatively to prevent a recurrence. However, it may lead to complications like scleral necrosis, cataract, and iritis and should be used judiciously.&nbsp;</li>\n<li>Beta irradiation</li>\n<li>Conjunctival autografting- limbal tissue from the same or other eye is grafted and secured with <strong>fibrin glue </strong>or sutures.</li>\n<li>Amniotic membrane graft</li>\n<li>Peripheral lamellar keratoplasty if the lesion is deep.</li>\n</ul>\n</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6ab848364f104bc396634f50a596d16c.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 2-week-old infant with ambiguous genitalia (as shown in the picture) presents with an episode of dehydration and shock, requiring hospitalization. Levels of which of the following would be increased in the infant?",
    "choices": [
      {
        "id": 1,
        "text": "1, 2, 3, 4, 5"
      },
      {
        "id": 2,
        "text": "2, 3, 4, 5"
      },
      {
        "id": 3,
        "text": "1, 2, and 3"
      },
      {
        "id": 4,
        "text": "1, 4, and 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ambiguous genitalia</strong> (virilization) with <strong>dehydration</strong> and <strong>shock</strong> (salt-wasting crisis) suggests the diagnosis of <strong>congenital adrenal hyperplasia</strong> due to <strong>21-hydroxylase deficiency</strong>.&nbsp;Lab investigations would reveal <strong>cortisol</strong> to be <strong>decreased</strong> while<strong>&nbsp;17-hydroxyprogesterone,&nbsp;ACTH, serum androgens, </strong>and<strong> plasma renin</strong> would be <strong>increased</strong>.</p>\n<div class=\"page\" title=\"Page 5339\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Congenital adrenal hyperplasia (CAH) is a set of <strong>autosomal</strong> <strong>recessive</strong> disorders characterized by <strong>impaired synthesis of&nbsp;cortisol</strong>. This cortisol deficiency increases the secretion of ACTH, which leads to adrenocortical hyperplasia.</p>\n<div class=\"page\" title=\"Page 5343\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>21-hydroxylase deficiency is the most common cause of CAH. The synthesis of both cortisol and aldosterone requires 21-hydroxylation, hence both hormones are deficient. These babies present at 10&ndash;14 days of age with progressive weight loss, weakness, anorexia, vomiting, <strong>dehydration</strong>,<strong> hypoglycemia,&nbsp;and hypotension</strong>. Without treatment,<strong> shock</strong>, cardiac arrhythmias, and death may occur within days or weeks.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b82320a1fe77491f8341041f35f1a255.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "During a biochemical screening, an obstetrician identifies that a woman is carrying a fetus with trisomy 18. Which of the following markers would likely be low in this screening test?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 2 only"
      },
      {
        "id": 2,
        "text": "1, 2, 3, and 4"
      },
      {
        "id": 3,
        "text": "3 and 4 only"
      },
      {
        "id": 4,
        "text": "1, 2, and 4 only"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct answer is\u00a0<strong>1, 2, 3, </strong>and <strong>4.\u00a0</strong>All of the above-given findings are decreased in<strong> trisomy 18</strong> (Edward's syndrome).\u00a0Maternal serum AFP, beta hCG, unconjugated estriol, and pregnancy-associated plasma protein A levels are <strong>reduced</strong>.</p>\n<p><strong>Combined first-trimester screening tests:</strong>\u00a0It is performed between <strong>11</strong> and <strong>14 weeks gestation</strong>. It comprises of:</p>\n<div class=\"page\" title=\"Page 297\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Human chorionic gonad\u00adotropin (hCG)</li>\n<li>Pregnancy-associated plasma protein-A (PAPP-A)</li>\n<li>Sonographic measurement of the nuchal translucency (NT)</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>The abnormalities seen on the <strong>triple</strong> screen are tabulated below:</p>\n<table style=\"width: 499px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 105px;\"><strong>\u00a0Parameter</strong></td>\n<td style=\"width: 90px;\"><strong>Trisomy 21</strong></td>\n<td style=\"width: 90.9766px;\"><strong>Trisomy 18</strong></td>\n<td style=\"width: 188.023px;\"><strong>Neural tube defect or abdominal wall defect</strong></td>\n</tr>\n<tr>\n<td style=\"width: 105px;\"><strong>MSAFP</strong></td>\n<td style=\"width: 90px;\">Low</td>\n<td style=\"width: 90.9766px;\">Low</td>\n<td style=\"width: 188.023px;\">High</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\"><strong>\u03b2 hCG</strong></td>\n<td style=\"width: 90px;\">High</td>\n<td style=\"width: 90.9766px;\">Low</td>\n<td style=\"width: 188.023px;\">Normal</td>\n</tr>\n<tr>\n<td style=\"width: 105px;\"><strong>Unconjugated estriol</strong></td>\n<td style=\"width: 90px;\">Low</td>\n<td style=\"width: 90.9766px;\">Low</td>\n<td style=\"width: 188.023px;\">Normal</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Quadruple testing</strong>\u00a0is done in the\u00a0<strong>second trimester\u00a0</strong>between<strong>\u00a015-21 weeks\u00a0</strong>of gestation.\u00a0It comprises:</p>\n<ul>\n<li>Maternal serum AFP</li>\n<li>Human chorionic gonadotropin</li>\n<li>Unconjugated estriol</li>\n<li>Inhibin A</li>\n</ul>\n<p><strong>Trisomy 18</strong> or <strong>Edwards</strong>\u2019 syndrome is a condition characterised by <strong>intellectual</strong> <strong>disability</strong>, micrognathia, low-set ears, <strong>rocker-bottom feet</strong>, and congenital heart diseases. The most characteristic finding is a <strong>clenched fist</strong> with <strong>overlapping fingers</strong> i.e. the index finger overlies the third and fourth fingers, while the fifth finger overlaps the fourth. This syndrome is also associated with <strong>polyhydramnios</strong> and a <strong>single umbilical artery</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young boy who is anticipating his board exams has been increasingly isolated with flat affect for the past 6 months. He has disorganized speech and says he hears a voice telling him that the government is tracking him. On mental status examination, you find that he is depressed. Considering the likely diagnosis, which of the following can be considered a good prognostic factor for him?",
    "choices": [
      {
        "id": 1,
        "text": "2, 3, 4"
      },
      {
        "id": 2,
        "text": "1, 3"
      },
      {
        "id": 3,
        "text": "1, 4, 5"
      },
      {
        "id": 4,
        "text": "2, 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario showing a flat affect, auditory hallucinations, and disorganized speech is highly suggestive of&nbsp;<strong>schizophrenia.</strong>&nbsp;The&nbsp;<strong>presence of a stressor</strong>&nbsp;and <strong>depression</strong> are&nbsp;<strong>good prognostic factors.</strong></p>\n<p><strong>Schizophrenia</strong> is a <strong>psychosis</strong>, a type of mental illness characterized by distortions in thinking, perception, emotions, language, sense of self, and behavior.</p>\n<p>The DSM-5 criteria to diagnose schizophrenia require a total duration of <strong>6 months</strong>. Within this 6-month period, there must be <strong>at least 1 month</strong> of <strong>active-phase</strong> <strong>symptoms</strong> (overt psychotic symptoms) where <strong>2 or more</strong> of the following have to be present, with <strong>at least</strong> one among the symptoms <strong>a, b, or c</strong>:&nbsp;</p>\n<ol style=\"list-style-type: lower-alpha;\">\n<li>Delusion</li>\n<li>Hallucination</li>\n<li>Disorganized speech (or formal thought disorder)</li>\n<li>Disorganized behavior</li>\n<li>Affective flattening or other negative symptoms</li>\n</ol>\n<p>Studies have pointed out that more than half of the patients generally have a poor prognosis. Poor prognostic factors are associated with repeated hospitalizations, exacerbation of symptoms, and suicide attempts. At least one-third of people with schizophrenia experiences complete remission of symptoms. Some people with schizophrenia experience worsening and remission of symptoms periodically throughout their lives, others a gradual worsening of symptoms over time.</p>\n<p>The good and the poor prognostic factors are given below:</p>\n<table style=\"width: 324px; height: 405px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\"><strong>Good Prognostic factors&nbsp;</strong></td>\n<td style=\"width: 152.386px; height: 18px;\"><strong>&nbsp;Poor prognostic factors</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\">Acute onset</td>\n<td style=\"width: 152.386px; height: 18px;\">Insidious onset</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\">Late-onset</td>\n<td style=\"width: 152.386px; height: 18px;\"><strong>Early-onset</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\"><strong>Presence of a stressor</strong></td>\n<td style=\"width: 152.386px; height: 18px;\">Absence of a stressor</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\"><strong>Presence of depression</strong></td>\n<td style=\"width: 152.386px; height: 18px;\">No depression</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\">Positive symptoms</td>\n<td style=\"width: 152.386px; height: 18px;\"><strong>Negative symptoms</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 156.023px; height: 36px;\">Family history of mood disorder</td>\n<td style=\"width: 152.386px; height: 36px;\">Family history of schizophrenia</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 156.023px; height: 18px;\">Married, female sex</td>\n<td style=\"width: 152.386px; height: 18px;\">Single, <strong>male sex</strong></td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p>Based on the predominant clinical presentation, schizophrenia is divided into <strong>five subtypes</strong>: paranoid, disorganized, undifferentiated, catatonic, and residual. <strong>Antipsychotics</strong> form the <strong>mainstay</strong> of treatment, while <strong>psychotherapy</strong> is used as an adjunct.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Given below are colours representing the various available intravenous cannulae. Arrange the following in the decreasing order of sizes.",
    "choices": [
      {
        "id": 1,
        "text": "2, 3, 4, 1, 5"
      },
      {
        "id": 2,
        "text": "4, 3, 2, 1, 5"
      },
      {
        "id": 3,
        "text": "2, 4, 3, 5, 1"
      },
      {
        "id": 4,
        "text": "4, 2, 3, 1, 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The decreasing order of size for the given cannulae are - <strong>orange, grey, green, pink, and blue.</strong></p>\n<p>Standard wire gauge (SWG) is used to size cannulas. It is a measure of the cross-sectional area. It refers to the number of wires of the same size as the cannula that could pass through a hole of a standard size in parallel. Therefore <strong>larger cannulae have a smaller gauge number.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is correct regarding Peutz-Jeghers Syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "2, 4, 5"
      },
      {
        "id": 2,
        "text": "1, 2, 3"
      },
      {
        "id": 3,
        "text": "1, 3, 4"
      },
      {
        "id": 4,
        "text": "2, 3, 5"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> correct </strong>statements regarding Peutz-Jeghers syndrome are<strong> 1, 2, and 3.</strong></p>\n<p><strong>Peutz-Jeghers syndrome</strong>&nbsp;is an&nbsp;<strong>autosomal</strong>&nbsp;<strong>dominant</strong>, hereditary disorder characterized by multiple gastrointestinal hamartomatous polyps and mucocutaneous hyperpigmentation. The pigmentation&nbsp;is particularly evident on the face, buccal mucosa, hands, feet, and perianal and genital regions. This rare syndrome presents at a median age of&nbsp;<strong>11 years.</strong></p>\n<p>Germline heterozygous&nbsp;loss-of-function mutations in the gene <strong>STK11</strong>&nbsp;are present in half the individuals with familial Peutz-Jeghers syndrome.</p>\n<p>Histologic examination&nbsp;shows a characteristic <strong>arborizing network of connective tissue</strong>, smooth muscle, lamina propria, and glands lined by the normal-appearing intestinal epithelium.</p>\n<p>A complication of Peutz-Jeghers polyps&nbsp;is&nbsp;<strong>intussusception</strong>, which is occasionally fatal. Peutz-Jegher syndrome&nbsp;is associated with a markedly increased risk of colon, pancreatic, breast, lung, ovarian, and uterine cancers.</p>\n<p>Note:-&nbsp;Congenital hypertrophy of retinal pigment epithelium is seen in FAP, not&nbsp;<strong>Peutz-Jeghers syndrome</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d998dd091f184c19bb6dfc1541734616x581x697.PNG"
    ]
  },
  {
    "text": "A 14-year-old male patient presented with painful swelling below the knee joint. On examination, there is localized tenderness over the tibial tuberosity. The X-ray image is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Jumper\u2019s knee"
      },
      {
        "id": 2,
        "text": "Osgood-Schlatter disease"
      },
      {
        "id": 3,
        "text": "Sinding-Larsen-Johansson syndrome"
      },
      {
        "id": 4,
        "text": "Osteochondritis dissecans"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The X-ray image shows a<strong> traction injury of the tibial tuberosity</strong>, at the site where the <strong>patellar</strong> <strong>tendon</strong> is inserted, which is characteristic of <strong>Osgood-Schlatter Disease</strong>, also known as <strong>apophysitis of the tibial tuberosity</strong>.</p>\n<p>The condition is usually seen in <strong>young</strong> <strong>adolescents</strong> and may not be associated with any injury.</p>\n<p>The presenting feature is a <strong>painful</strong> <strong>lump</strong> below the knee joint. On examination, the lump is <strong>tender</strong> and its situation <strong>over the tibial tuberosity</strong> is diagnostic of the disease.</p>\n<p><strong>Other options:</strong></p>\n<p><strong>Option a: Jumper&rsquo;s knee</strong>, also known as patellar tendinitis is an inflammation of the proximal patellar tendon, which occurs due to overuse injury and is usually seen in athletes.</p>\n<p><strong>Option c: Sinding-Larsen-Johansson Syndrome </strong>is seen where there is a partial rupture or avulsion of the distal patellar tendon, where it inserts into the patella, leading to traction tendonitis and calcification in the patellar ligament.</p>\n<p><strong>Option d: Osteochondritis</strong> <strong>Dissecans</strong> is a condition characterized by demarcation or separation and necrosis of a part of articular cartilage and bone. The condition is often associated with intra-articular loose bodies.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/79e82f7f0cfa485bbe9dea54ab92e563.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male patient is brought to the emergency room with complaints of nausea, muscle weakness, and a sense of extreme fatigue. He is a known case of CKD on treatment with enalapril. His ECG is given below. What is the first step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "IV potassium chloride"
      },
      {
        "id": 2,
        "text": "IV calcium gluconate"
      },
      {
        "id": 3,
        "text": "IV sodium bicarbonate"
      },
      {
        "id": 4,
        "text": "IV 50% dextrose"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given ECG shows <strong>peaked T waves</strong>,<strong> flattened P waves</strong>, and <strong>broad QRS complexes</strong>, suggesting <strong>hyperkalemia</strong>. This patient also has <strong>chronic kidney disease</strong>\u00a0and is on treatment with an <strong>ACE inhibitor</strong>, enalapril. Both of these factors are independent risk factors for hyperkalemia. The <strong>first step </strong>in the management of <strong>hyperkalemia</strong> is the administration of <strong>IV calcium gluconate</strong>.</p>\n<p>ECG changes seen in hyperkalemia vary with the level of serum K<sup>+ </sup>(normal serum K<sup>+</sup> is 3.5-5.5 mEq/L):</p>\n<ul>\n<li>5.5-6.5 mEq/L- tall, peaked T waves</li>\n<li>6.5-7.5 mEq/L- flattening of P waves</li>\n<li>7.0-8.0 mEq/L - widening of QRS complexes</li>\n<li>&gt;8.0 mEq/L - sine wave pattern of ECG</li>\n</ul>\n<p>The\u00a0<strong>resting membrane potential</strong>\u00a0of excitable cells is\u00a0close to the<strong> resting membrane potential </strong>for<strong> K<sup>+</sup></strong>. In the\u00a0<strong>resting state</strong>, there is a<strong>\u00a0</strong>constant leakage of K<sup>+</sup>\u00a0out of the cell. If the\u00a0K<sup>+</sup>\u00a0is higher in the extracellular environment\u00a0(hyperkalemia),\u00a0less K<sup>+</sup>\u00a0will leak out\u00a0of the cell because the gradient is unfavorable. This\u00a0increases the positive charge inside\u00a0the cell, leading to the membrane potential being pushed more toward the threshold. In other words, the\u00a0cell is now <strong>more excitable.</strong>\u00a0</p>\n<p><strong>Calcium administration</strong>\u00a0counteracts this by\u00a0<strong>reducing </strong>the<strong> excitability of the cells</strong>\u00a0and maintaining the membrane potential at the actual resting value. Calcium is\u00a0administered by<strong> intravenous infusion</strong>\u00a0over 2-3 minutes with cardiac monitoring. The\u00a0effect of the infusion\u00a0lasts for\u00a0up to 60 minutes. During this time, the steps to correct K+ levels can be taken. These steps include:</p>\n<ul>\n<li>10 units of\u00a0<strong>IV insulin </strong>followed\u00a0immediately\u00a0by\u00a050 mL 50%\u00a0<strong>dextrose bolus</strong></li>\n<li><strong>Inhaled</strong>\u00a0<strong>\u03b22 agonists</strong>\u00a0such as\u00a0<strong>albuterol</strong></li>\n<li><strong>Cation exchange resins</strong>\u00a0such as\u00a0<strong>sodium polystyrene sulfonate</strong>\u00a0and\u00a0<strong>patiromer</strong>\u00a0can be used for the management of both acute and chronic hyperkalemia</li>\n<li><strong>Hemodialysis</strong>\u00a0is the\u00a0<strong>most effective</strong>\u00a0method to reduce K+ concentration</li>\n</ul>\n<p>Note that<strong>\u00a0</strong>intravenous bicarbonate administration\u00a0does not have a role\u00a0in the management of acute hyperkalemia.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/81063980ab3e43d8b24113cb1b4d9694.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/60415581506b44a69e0feddac3bdadb7x778x600.JPEG"
    ]
  },
  {
    "text": "Your physiology laboratory partner is being examined during a cardiac system practical. Her heart rate is 80 beats/min and her BP is 100/70 mmHg measured in the supine position. Her heart rate increases to 90 beats/min on standing. Which of the following must have prompted the increase in heart rate?",
    "choices": [
      {
        "id": 1,
        "text": "Decrease in venous return"
      },
      {
        "id": 2,
        "text": "Increase in cardiac output"
      },
      {
        "id": 3,
        "text": "Increased activity of arterial baroreceptors"
      },
      {
        "id": 4,
        "text": "Increased vagal tone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>decrease in venous return</strong> is the likely initial event to have prompted an <strong>increase in heart rate</strong>.</p>\n<p>When a person <strong>stands up from a lying down position</strong>, it causes <strong>pooling of the blood</strong> in the legs, due to gravity. This <strong>reduces the venous return</strong> and causes a <strong>decrease</strong> in <strong>cardiac output.\u00a0</strong>Reduced cardiac output leads to a <strong>fall in blood pressure,</strong> which in turn causes<strong> reduced firing from baroreceptors.\u00a0</strong>As a result, the <strong>vagal tone is suppressed</strong>,<strong>\u00a0</strong>leading to<strong> increased heart rate.</strong></p>\n<p>\u00a0<strong>Baroreceptors </strong>are<strong> m</strong><strong>echanoreceptors receptors</strong>\u00a0located in the heart and adventitia of the blood vessels.</p>\n<ul>\n<li><strong>Types based on location</strong>\n<ul>\n<li>Carotid sinus and aortic arch receptors (high-pressure regions)</li>\n<li>Cardiopulmonary receptors (low-pressure regions)</li>\n</ul>\n</li>\n<li><strong>Afferents</strong>\n<ul>\n<li>Carotid sinus- a branch of the glossopharyngeal nerve (IX CN)\u2013 the carotid sinus nerve (sinus nerve of Hering)</li>\n<li>Aortic arch receptor- a branch of the vagus nerve (X CN)\u2013 aortic depressor nerve</li>\n</ul>\n</li>\n<li><strong>Center for Reflex</strong>\n<ul>\n<li>Medulla (nucleus tractus solitarius)</li>\n</ul>\n</li>\n<li><strong>Efferents</strong>\n<ul>\n<li>Sympathetic and parasympathetic neurons to heart and vasculature</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea2bf1e55f9f42aea11632369c07aad3x1280x2026.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is/are true in the given graph?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "2 and 4"
      },
      {
        "id": 3,
        "text": "4 and 3"
      },
      {
        "id": 4,
        "text": "2 and 3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Statements <strong>2 and 4</strong> are <strong>true</strong> about the given dose-response curve. Drug C has the same efficacy as drug A. Drug D has more efficacy but has less potency than Drug C.</p>\n<p><strong>Potency</strong>&nbsp;is the <strong>dose</strong>&nbsp;or&nbsp;concentration of a drug required to produce 50% of the drug&rsquo;s maximal effect.&nbsp;The&nbsp;<strong>more the curve is on the left&nbsp;</strong>in a dose-response curve (DRC)<strong>, the greater is its potency.</strong>&nbsp;</p>\n<p><strong>Efficacy</strong>&nbsp;is defined as the<strong>&nbsp;maximum effect produced</strong>&nbsp;by the drug and is determined by the&nbsp;<strong>peak of the curve</strong>. It reflects the capacity of the drug to bind a receptor and produce a cellular response.</p>\n<p>In the above graph <strong>order of potency</strong> is <strong>A&gt;B&gt;C&gt;D</strong>. Drugs A and C have same efficacy, and drug B and D have the same efficacy.</p>\n<div class=\"page\" title=\"Page 81\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The slope of the DRC also has significance. A <strong>steep slope</strong> implies that a moderate increase in dose markedly increases the response. Thus, for such drugs, the dose needs <strong>individualization</strong>. A <strong>flat slope</strong> implies that over a wide dose range, only a little increase in response will occur. Thus, these drugs can be given in <strong>standard doses</strong>.</p>\n</div>\n</div>\n</div>\n</div>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ea6d949c988044b395ddef9c20d3ebaf.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following effects indicate the stochastic effect of radiation seen in a person working in a diagnostic center and having an increased risk of radiation exposure?",
    "choices": [
      {
        "id": 1,
        "text": "Lens opacities"
      },
      {
        "id": 2,
        "text": "Transient oligozoospermia"
      },
      {
        "id": 3,
        "text": "Radiation induced skin erythema"
      },
      {
        "id": 4,
        "text": "Heritable mutations"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Heritable mutations</strong> are <strong>stochastic effects</strong> that occur as a result of radiation exposure.</p>\n<p>The harmful effects of radiation may be classified into two general categories:</p>\n<ul>\n<li>Stochastic effects</li>\n<li>Nonstochastic or deterministic effects</li>\n</ul>\n<p><strong>Stochastic effects</strong> (<strong>chance</strong> or<strong> random effects</strong>): These effects of ionizing radiation are <strong>chance events. </strong>The probability of the effect increases with the dose. But the severity of the effect is independent of the dose received.\u00a0There is <strong>no threshold</strong>. These effects are associated with damage to the DNA of cells.</p>\n<p>Examples of stochastic effects include <strong>secondary malignancies </strong>and<strong> heritable mutations</strong>.</p>\n<p><strong>Non-stochastic/Deterministic effects (non-random effects)</strong>:\u00a0These effects are related directly to the absorbed radiation dose. The severity of the effect increases as the dose increases.\u00a0A deterministic effect typically has a <strong>threshold</strong> below which the effect does not occur.</p>\n<p>Examples of nonstochastic or deterministic effects include radiation-induced <strong>skin erythema</strong>, <strong>lens opacification</strong>, and transient <strong>decrease in sperm count</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Caroli's disease is __________",
    "choices": [
      {
        "id": 1,
        "text": "Type I choledochal cyst"
      },
      {
        "id": 2,
        "text": "Type II choledochal cyst"
      },
      {
        "id": 3,
        "text": "Type III choledochal cyst"
      },
      {
        "id": 4,
        "text": "Type V choledochal cyst"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Caroli's disease</strong> is a&nbsp;<strong>type V choledochal cyst.</strong></p>\n<p>Choledochal cysts are congenital cystic dilations of the intrahepatic and/or extrahepatic biliary tree. They present with a triad of <strong>jaundice, a palpable upper quadrant mass, </strong>and<strong> abdominal pain.</strong></p>\n<p>Choledochal cyst is classified into five types:</p>\n<ul>\n<li><strong>Type I</strong>: is a simple cyst that can involve any portion of the CBD.</li>\n<li><strong>Type II</strong>: It is described as an isolated diverticulum arising from the wall of the CBD</li>\n<li><strong>Type III:</strong> They arise from the intraduodenal portion of the common bile duct and are also known as <strong>choledochocele</strong>.</li>\n<li><strong>Type IVA:</strong> The cysts consist of multiple dilatations of the intrahepatic and extrahepatic bile ducts.</li>\n<li><strong>Type IVB:</strong> These choledochal cysts are multiple dilatations involving only the extrahepatic bile ducts.</li>\n<li><strong>Type V (Caroli&rsquo;s disease):</strong> It consists of multiple dilatations limited to the intrahepatic bile ducts.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Mini Test 27';
        const quizFilename = 'mini-test-27-0f933688.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>