<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>39 Infections And Tumors Of Kidney - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following statements is false regarding acute pyelonephritis?",
    "choices": [
      {
        "id": 1,
        "text": "CECT abdomen is the investigation of choice"
      },
      {
        "id": 2,
        "text": "Commonly associated with uric acid stones"
      },
      {
        "id": 3,
        "text": "Renal scarring is common in untreated cases"
      },
      {
        "id": 4,
        "text": "The mainstay of treatment is broad-spectrum antibiotics"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of<strong> acute pyelonephritis</strong>. Patients with acute pyelonephritis are more likely to have <strong>struvite</strong> stones, not uric acid stones. This is because of infection with&nbsp;urea-splitting organisms such as <em>proteus</em>&nbsp;that release ammonia. This makes the <strong>urine alkaline</strong> and promotes the formation of struvite stones.</p>\n<p><strong>Acute pyelonephritis</strong>&nbsp;is a bacterial infection causing inflammation of the kidneys. <strong>Ascending infection</strong> in the urinary tract is the most common route. It is more common in<strong>&nbsp;young, sexually active women</strong>. Up to 50%&nbsp;of children with urinary infections have an underlying anatomical abnormality (e.g., reflux or obstruction).&nbsp;</p>\n<p>Clinical features include:</p>\n<ul>\n<li>Prodromal symptoms such as headache, lassitude, vomiting</li>\n<li>Flank pain, fever, rigor</li>\n<li>Pyuria and occasionally hematuria</li>\n</ul>\n<p><strong>CECT</strong> abdomen is the <strong>investigation of choice</strong> to rule out pyonephrosis.&nbsp;</p>\n<p>The mainstay of treatment is <strong>broad-spectrum antibiotics</strong> to <strong>prevent renal scarring.&nbsp;</strong>Surgery is indicated only if antibiotic therapy fails.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A diabetic patient presents with pyrexia and left flank pain. On examination, Murphy's punch sign is positive. CECT abdomen done is shown below. What is the most likely causative organism for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "E.coli"
      },
      {
        "id": 2,
        "text": "Proteus"
      },
      {
        "id": 3,
        "text": "Clostridium"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given history with Murphy's punch sign positive, and\u00a0<strong>streaks of gas</strong>\u00a0on CECT abdomen point to a diagnosis of\u00a0<strong>emphysematous pyelonephritis</strong>. <strong>Escherichia coli</strong> is the most common causative organism.</p>\n<p>Emphysematous pyelonephritis is associated with an <strong>acute necrotizing infection</strong> of the kidney by <strong>gas-producing organisms</strong> that occurs predominantly in<strong> diabetic</strong> patients. E. coli produces carbon dioxide by the fermentation of sugar.</p>\n<p>Patients frequently present with sepsis and ketoacidosis.\u00a0It can be associated with tenderness at the costovertebral angle known as\u00a0<strong>Murphy's punch sign.</strong></p>\n<p><strong>CECT abdomen</strong> shows an <strong>enlarged destructed</strong> renal <strong>parenchyma</strong> with small linear <strong>streaks of gas.</strong></p>\n<p>Treatment includes <strong>broad-spectrum antibiotics</strong> with <strong>drainage</strong>. In patients who fail to respond to treatment, <strong>nephrectomy</strong> is considered.</p>\n<p>Note:<strong>\u00a0Clostridium species</strong> are the\u00a0most common causative organisms in emphysematous cholecystitis.</p>\n<p>Murphy's punch sign is also seen\u00a0in infection, inflammation, or obstruction of the kidney. The below\u00a0image shows the\u00a0costovertebral angle\u00a0formed between the\u00a0lower border\u00a0of the\u00a012<sup>th</sup>\u00a0rib\u00a0and the\u00a0vertebral column.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c1081d2e43a54ebe8e2860dcef4be39e.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec75a7146c2b45d6b90f7ce12f737b94x600x774.JPEG"
    ]
  },
  {
    "text": "A woman is referred to you for evaluation of recurrent episodes of right flank pain and high-grade fever. She also had a history of recurrent urinary calculi in the past. CECT abdomen done is shown below. What is the preferred treatment for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "DJ stenting"
      },
      {
        "id": 2,
        "text": "Subcapsular nephrectomy"
      },
      {
        "id": 3,
        "text": "Drainage"
      },
      {
        "id": 4,
        "text": "Broad spectrum antibiotics"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario with CECT abdomen showing bear paw sign is suggestive of <strong>xanthogranulomatous pyelonephritis </strong>(XGP).&nbsp;<strong>Subcapsular nephrectomy</strong> is the preferred treatment in patients with XGP.</p>\n<p>It is a form of <strong>chronic pyelonephritis</strong> seen most frequently in middle-aged <strong>diabetic women</strong> and, rarely, in children. XGP is most commonly caused by<strong> proteus</strong> followed by E. coli.&nbsp;The disease is usually <strong>unilateral</strong> and is associated with prolonged obstructing nephrolithiasis.</p>\n<p>CECT abdomen shows&nbsp;dilated and enlarged renal pelvis and calyxes showing a multiloculated appearance. This is referred to as the&nbsp;<strong>bear paw sign</strong>.&nbsp;Histology shows foamy,&nbsp;<strong>lipid-laden macrophages</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e754f1ae35d549d9af0fb958776e0b3a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "CT done for a patient with abdominal pain and sterile pyuria is shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Renal stones"
      },
      {
        "id": 2,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Renal tuberculosis"
      },
      {
        "id": 4,
        "text": "Nephrocalcinosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario of <strong>sterile pyuria</strong> with CT showing right-sided <strong>putty kidney</strong> points&nbsp;<strong>to</strong>&nbsp;<strong>renal tuberculosis</strong>.<span class=\"Apple-converted-space\">&nbsp;</span></p>\n<p>Putty kidney refers to the&nbsp;<strong>amorphous dystrophic calcification</strong> seen over the entire kidney during the <strong>end stage</strong> of genitourinary TB.&nbsp;</p>\n<p><strong>Genitourinary tuberculosis</strong> is caused by the dissemination of the organism through the bloodstream. It occurs either due to reinfection or reactivation of old TB.</p>\n<p><strong>CT</strong> is the most sensitive modality and is the preferred means of visualizing <strong>renal calcifications</strong>. <strong>CT urography</strong> is done to assess the <strong>various stages</strong> of renal TB.&nbsp;</p>\n<p><strong>ATT</strong> is given to all patients with genitourinary TB.&nbsp;<strong>Nephrectomy</strong> is the preferred treatment in patients with <strong>putty</strong>/ <strong>cement </strong>kidneys.</p>\n<p>Option D: <strong>Nephrocalcinosis</strong> refers to the deposition of calcium salts in the kidney parenchyma and tubules.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f86677fab92a4550b4a756ec0fa6c956.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43717f766b854716840a198e10d37ae6x1280x1703.JPEG"
    ]
  },
  {
    "text": "A man presented to the OPD with hematuria and intermittent right flank pain. He received ATT for pulmonary TB two years ago. Urine analysis revealed pus cells, and no growth was seen on culture. Which of the following lesions are associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Only 1"
      },
      {
        "id": 2,
        "text": "1 & 4"
      },
      {
        "id": 3,
        "text": "2, 3 & 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4 &5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given history of <strong>pulmonary TB</strong> and presence of <strong>sterile pyuria</strong> on urine culture is suggestive of a diagnosis of<strong> renal tuberculosis.</strong>\u00a0All of the above lesions can be seen in renal TB.\u00a0</p>\n<p>Lesions in the kidney include:</p>\n<ul>\n<li><strong>Papillary ulcer</strong> - earliest lesion</li>\n<li><strong>Pyonephrosis/ Putty kidney</strong> - caused by multiple scattered papillary ulcers undergoing caseous necrosis, which later become filled with pus</li>\n<li><strong>Cement kidney</strong> -\u00a0 caused by calcifications in putty kidney</li>\n<li><strong>Perinephric abscess</strong> -\u00a0 by extension of pyonephrosis or tuberculous renal abscess</li>\n<li><strong>Pseudocalculi</strong> - occurs when calcium gets deposited in a papillary ulcer healed with fibrosis</li>\n<li><strong>Ghost calyces</strong> - caused by the destruction of the calyces</li>\n<li><strong>Thimble bladder</strong> - caused by fibrosis. The earliest sign is the paleness of bladder mucosa. managed by\u00a0<strong><span style=\"font-size: 14px;\">ileocystoplasty</span></strong></li>\n<li><strong>Golf hole ureteric orifice - </strong>Dilated<strong>\u00a0</strong>ureteric orifice. Managed by <strong>ureter reimplantation</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The Bosniak classification system is used in assessing patients with which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Renal cysts"
      },
      {
        "id": 2,
        "text": "Ureteropelvic junction obstruction"
      },
      {
        "id": 3,
        "text": "Renal carcinoma"
      },
      {
        "id": 4,
        "text": "Renal stones"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>Bosniak classification system</strong> is used&nbsp;for assessing patients with&nbsp;<strong>renal cysts</strong>.</p>\n<p>It divides renal cystic masses into <strong>five classes</strong> based on imaging characteristics seen on<strong> CECT</strong>. It is helpful in <strong>predicting</strong> the <strong>risks of malignancy</strong> and identifying the appropriate choice of <strong>clinical follow-up </strong>or<strong> treatment</strong>.</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Renal cyst class</strong></td>\n<td><strong>Risk of malignancy</strong></td>\n<td><strong>Workup</strong></td>\n</tr>\n<tr>\n<td><strong>1</strong></td>\n<td>0%</td>\n<td>Nil</td>\n</tr>\n<tr>\n<td><strong>2</strong></td>\n<td>0%</td>\n<td>Nil</td>\n</tr>\n<tr>\n<td><strong>2F</strong></td>\n<td>5%</td>\n<td>USG/ CT follow up</td>\n</tr>\n<tr>\n<td><strong>3</strong></td>\n<td>50%</td>\n<td>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Partial nephrectomy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Radiofrequency ablation - in elderly or poor surgical candidates</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td><strong>4</strong></td>\n<td>100%</td>\n<td>Partial or total nephrectomy</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/210d48e8592e456aa0a4de3830436364x1280x2560.JPEG"
    ]
  },
  {
    "text": "An ultrasound abdomen done for evaluation of flank pain in a man revealed a large mass arising from the right kidney. CECT abdomen done showed the presence of a central stellate scar. What is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Wilms tumor"
      },
      {
        "id": 2,
        "text": "Oncocytoma"
      },
      {
        "id": 3,
        "text": "Angiomyolipoma"
      },
      {
        "id": 4,
        "text": "Renal sarcoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given slide shows large eosinophilic cells arranged in nests</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1a6eebf3ce4849019c160dd2cbef5f9ex500x404.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d938b98d96f74042bb72555276a4a57bx600x452.JPEG"
    ]
  },
  {
    "text": "A patient presented to the casualty with severe back pain and vomiting. He was diagnosed to have tuberous sclerosis during childhood. CT scan revealed the presence of renal tumors with high-fat content as shown in the image below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Adrenal myolipoma"
      },
      {
        "id": 2,
        "text": "Renal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Angiomyolipoma"
      },
      {
        "id": 4,
        "text": "Retroperitoneal liposarcoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario and CT findings are suggestive of a diagnosis of&nbsp;<strong>angiomyolipoma.&nbsp;</strong></p>\n<p>Angiomyolipoma (AML) is a <strong>benign</strong>&nbsp;neoplasm&nbsp;of the kidney. It contains blood vessels, smooth muscles, and fat, and arises from <strong>perivascular epithelioid cells</strong>. It can occur in isolated forms or may be associated with <strong>tuberous sclerosis</strong>.</p>\n<p>Patients can either be <strong>asymptomatic</strong> or may present with <strong>abdominal pain </strong>or a<strong> lump</strong>.&nbsp;Some patients may also present with<strong> massive hemorrhage</strong> referred to as <strong>Wunderlich&rsquo;s syndrome</strong>. <strong>Lenk&rsquo;s triad</strong> seen in patients with Wunderlich&rsquo;s syndrome includes:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abdominal mass</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Abdominal pain</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Shock</li>\n</ul>\n<p>Due to the presence of <strong>abundant fat tissue</strong>, they can be easily identified on CT scans. Immunohistochemistry is positive for<strong> HMB 45.&nbsp;</strong>Treatment includes:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Asymptomatic</strong> tumors and tumors<strong> less than 4 cm</strong> in size - Observation with serial CECT</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Symptomatic</strong> tumors and tumors <strong>more than 4 cm</strong> in size - Partial nephrectomy/ nephron-sparing surgery&nbsp;</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Bleeding</strong> tumors - Angioembolization followed by partial nephrectomy</li>\n</ul>\n<p><strong>Everolimus</strong> is FDA approved for the treatment of AMLs.</p>\n<p>Note: HMB45 is positive on IHC for malignant melanoma and angiomyolipomas.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3da5a29f5e114b7d8e3bea0d79aab733.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false regarding Grawitz tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Most common renal neoplasm"
      },
      {
        "id": 2,
        "text": "Derived from the proximal tubular epithelium"
      },
      {
        "id": 3,
        "text": "Clear cell is the most common histological type"
      },
      {
        "id": 4,
        "text": "Radiosensitive tumor"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Renal cell carcinoma</strong> (RCC) also known as <strong>Grawitz tumor </strong>or hypernephroma,&nbsp;is a <strong>radio-resistant&nbsp;</strong>tumor.</p>\n<p>RCC accounts for&nbsp;<strong>85% of renal neoplasms</strong> in adults. It is&nbsp;more common in <strong>males</strong> between the&nbsp;<strong>sixth to seventh decades</strong>.&nbsp;<strong>Clear-cell</strong>&nbsp;RCC is the <strong>most common</strong> type of renal cell cancer.</p>\n<p>The proximal convoluted tubule (<strong>PCT</strong>) of the nephron is usually the site of <strong>origin</strong> of RCC.</p>\n<p><strong>Risk factors</strong> for RCC:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Smoking</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Obesity</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Family history of RCC</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Drugs like phenacetin and diuretics</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Thorotrast exposure</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased protein intake</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true regarding the presentation of renal cell carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Flank pain is the most common presentation"
      },
      {
        "id": 2,
        "text": "It is more commonly associated with left sided varicoceles"
      },
      {
        "id": 3,
        "text": "It may be associated with pulsatile bony metastasis"
      },
      {
        "id": 4,
        "text": "Palpable abdominal mass is part of the classic triad seen in RCC"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>most common presentation</strong> in patients with <strong>renal cell carcinoma</strong> (RCC) is <strong>gross</strong>&nbsp;<strong>hematuria.</strong></p>\n<p>The <strong>classic triad&nbsp;</strong>(seen in <strong>&lt;10%</strong> of cases)&nbsp;includes :</p>\n<ul>\n<li>Gross hematuria&nbsp;</li>\n<li>Flank pain&nbsp;</li>\n<li>Palpable abdominal mass&nbsp;</li>\n</ul>\n<p><strong>Rapidly developing varicoceles</strong> can be seen in patients with RCC. Varicocele is usually seen on the <strong>left side</strong>, as the left gonadal vein drains into the left renal vein at a sharp angle. On the right side, the gonadal vein opens into the much larger IVC.</p>\n<p>Patients may also present with <strong>paraneoplastic syndromes</strong>.<strong>&nbsp;</strong>RCC&nbsp;can give rise to<strong>&nbsp;pulsatile bony metastases.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man presents with intermittent hematuria and flank pain for 2 months. He is a known smoker and is found to be anemic. Further investigations reveal an enhancing lesion arising from the right kidney. Which of the following paraneoplastic syndromes is not likely to be seen in his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cushing's syndrome"
      },
      {
        "id": 2,
        "text": "Polycythemia"
      },
      {
        "id": 3,
        "text": "Cerebellar degeneration"
      },
      {
        "id": 4,
        "text": "Hypercalcemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Hematuria and flank pain in a known smoker with the given investigation findings&nbsp;is suggestive of <strong>renal cell carcinoma</strong>. Cerebellar degeneration is not a paraneoplastic syndrome associated with RCC.</p>\n<p><strong>Paraneoplastic syndromes associated with RCC include</strong>:</p>\n<p><strong>Endocrine</strong>&nbsp;paraneoplastic syndromes -</p>\n<ul>\n<li><strong>Stauffer syndrome -&nbsp;</strong>non-metastatic liver dysfunction, characterized by elevated serum bilirubin, ALP, and prolonged prothrombin time</li>\n<li aria-level=\"1\"><strong>Hypercalcemia</strong> - due to increased vitamin D, PTH-related protein</li>\n<li aria-level=\"1\">Hypertension</li>\n<li aria-level=\"1\"><strong>Polycythemia</strong></li>\n<li aria-level=\"1\">Galactorrhea</li>\n<li aria-level=\"1\"><strong>Cushing&rsquo;s syndrome</strong></li>\n<li aria-level=\"1\">Alterations in glucose metabolism</li>\n</ul>\n<p><strong>Non-endocrine</strong>&nbsp;paraneoplastic syndromes include&nbsp;<strong>Lambert Eaton syndrome</strong>&nbsp;(neuromyopathy), amyloidosis, anemia, vasculopathy, nephropathy, coagulopathy, elevated<strong>&nbsp;</strong>ESR,&nbsp;prostaglandin elevation.</p>\n<p><strong>Elevated ESR</strong> is the <strong>most common </strong>paraneoplastic syndrome associated with <strong>RCC.</strong></p>\n<p>Note: Cerebellar degeneration is a paraneoplastic syndrome in Hodgkin's lymphoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Lab values from a routine workup done for a hypertensive man are given below.  Further investigations revealed hepatosplenomegaly with a 5.5 cm tumor arising from the right kidney. No signs of metastasis were noted. What is the most likely diagnosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hepato renal syndrome"
      },
      {
        "id": 2,
        "text": "Stauffer syndrome"
      },
      {
        "id": 3,
        "text": "Budd chiari syndrome"
      },
      {
        "id": 4,
        "text": "Metastatic liver dysfunction syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario points to a diagnosis of <strong>Stauffer syndrome</strong> in a patient with <strong>renal cell carcinoma</strong>.&nbsp;</p>\n<p><strong>Stauffer syndrome</strong> is a rare <strong>paraneoplastic syndrome</strong> seen in RCC. It is a <strong>non-metastatic liver dysfunction</strong> mediated via interleukin 6.&nbsp;It is characterized by the presence of hepatosplenomegaly with no features of metastasis and the following lab findings:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hyperbilirubinemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Raised ALP</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypoalbuminemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hypergammaglobulinemia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Prolonged prothrombin time</li>\n</ul>\n<p>Option A: <strong>Hepatorenal syndrome</strong> refers to the development of renal failure in patients with advanced chronic liver disease.</p>\n<p>Option C: <strong>Budd Chiari syndrome</strong> is characterized by hepatic venous outflow tract obstruction (HVOTO).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following types of renal cell carcinoma is characterized by multiple losses of entire chromosomes?",
    "choices": [
      {
        "id": 1,
        "text": "Papillary"
      },
      {
        "id": 2,
        "text": "Clear cell"
      },
      {
        "id": 3,
        "text": "Chromophobe"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Chromophobe type </strong>renal cell carcinomas (RCC) are uniquely associated with <strong>multiple losses of entire chromosomes</strong>,&nbsp;including chromosomes 1, 2, 6, 10, 13, 17, and 21. Thus, they show extreme hypodiploidy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man was referred for the evaluation of an unsteady gait with weakness of his legs for the past 1 month. He gave a history of similar problems in his brother. Imaging revealed cerebellar hemangioblastomas and bilateral renal masses suggestive of RCC.  Which histological type of this renal malignancy is he most likely to have?",
    "choices": [
      {
        "id": 1,
        "text": "Papillary"
      },
      {
        "id": 2,
        "text": "Clear cell"
      },
      {
        "id": 3,
        "text": "Chromophobe"
      },
      {
        "id": 4,
        "text": "Collecting duct"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical features mentioned are consistent with <strong>renal cell carcinoma</strong>\u00a0and<strong> cerebellar hemangioblastoma </strong>which\u00a0along with the family history points to a diagnosis of <strong>von Hippel Lindau\u2019s disease </strong>(VHL). <strong>Clear cell RCC</strong> is the most common type associated with <strong>VHL</strong> disease.\u00a0</p>\n<p><strong>VHL disease</strong> is inherited as an <strong>autosomal dominant</strong> trait and is caused by a germline mutation of the <strong>VHL gene on chromosome 3p</strong>. A second hit can increase the predisposition to a variety of neoplasms, particularly hemangioblastomas of the cerebellum and retina, and <strong>clear cell renal carcinoma</strong>(in 40-60%).</p>\n<p>The given slide shows clear cell RCC.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a60f8aa23dc046c8873a58d37dc42548x1279x1117.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most common method of diagnostic investigation in patients suspected to have hypernephroma?",
    "choices": [
      {
        "id": 1,
        "text": "CT scan abdomen and pelvis"
      },
      {
        "id": 2,
        "text": "USG abdomen and pelvis"
      },
      {
        "id": 3,
        "text": "MRI abdomen and pelvis"
      },
      {
        "id": 4,
        "text": "Intravenous pyelogram"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong> most common&nbsp;</strong>method of <strong>diagnostic investigation</strong> in <strong>hypernephroma</strong> or renal cell carcinoma is a <strong>CT scan </strong>of the abdomen and pelvis.&nbsp;Characteristic features of RCC on CT scan include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Enhancement of the lesion after injection of IV contrast</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Thickened irregular walls</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Thickened or enhanced septa within the mass or multilocular mass</li>\n</ul>\n<p><strong>CT scan</strong> has replaced IVP and ultrasound as the radiological modality of choice to evaluate renal masses.</p>\n<p><strong>MRI</strong> can be performed for diagnosing <strong>poorly characterized renal masses on CT</strong> or if a CT scan is contraindicated (in case of allergy to IV contrast). It also helps in defining <strong>tumor extension into the renal vein or IVC.</strong>&nbsp;</p>\n<p>The below image shows a cystic tumor involving the left kidney suggestive of renal cell carcinoma.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a513ac81de5c4c6abd63894e6d709460x630x630.JPEG"
    ]
  },
  {
    "text": "A CECT abdomen done to evaluate an elderly man with intermittent flank pain is shown below. Which of the following will be the most common site for secondary metastasis in patients with this tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Adrenal glands"
      },
      {
        "id": 2,
        "text": "Lungs"
      },
      {
        "id": 3,
        "text": "Liver"
      },
      {
        "id": 4,
        "text": "Brain"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The history and CECT mentioned in the above scenario are consistent with a diagnosis of <strong>renal cell carcinoma</strong>. The most common site for <strong>secondary metastasis</strong> in RCC is the <strong>lungs</strong>, where they form secondaries commonly known as <strong>cannonball secondaries</strong>.</p>\n<p>The tumor is prone to extend into the renal vein and reach the lungs via circulation. RCC also metastasizes to the bone, lymph nodes, liver, adrenal glands, and brain.</p>\n<p><strong>Para-aortic nodes</strong> are the first draining lymph nodes.</p>\n<p>The image below shows multiple round opacities in bilateral lungs suggestive of cannonball metastasis in the lungs.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/601c0f339c564feca309e2614de26236.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9429de57accc476a8f14cb2f65aaea5fx720x714.JPEG"
    ]
  },
  {
    "text": "In patients with which of the following findings on CECT abdomen, would you stage the tumor as T3 stage of RCC?",
    "choices": [
      {
        "id": 1,
        "text": "8.5 cm tumor limited to the kidney"
      },
      {
        "id": 2,
        "text": "5 cm tumor limited to the kidney"
      },
      {
        "id": 3,
        "text": "12 cm tumor involving the supra-diaphragmatic IVC"
      },
      {
        "id": 4,
        "text": "11.5 cm tumor extending into the ipsilateral adrenal gland"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the <strong>T3c stage</strong> of hypernephroma or renal cell carcinoma, the tumor spreads to the <strong>supra-diaphragmatic IVC</strong> or <strong>invades the wall of the IVC</strong>.</p>\n<p><strong>TNM staging for renal cell carcinoma</strong></p>\n<table style=\"width: 812px;\">\n<tbody>\n<tr>\n<td style=\"width: 814px;\"><strong>T: Primary tumor&nbsp;</strong></td>\n</tr>\n<tr>\n<td style=\"width: 814px;\"><strong>T1</strong>: Limited to the&nbsp;kidney,&nbsp;<strong><span style=\"text-decoration: underline;\">&lt;</span>7 cm</strong></td>\n</tr>\n<tr>\n<td style=\"width: 814px;\"><strong>T2</strong>: Limited to the&nbsp;kidney, <strong>&gt;7 cm</strong></td>\n</tr>\n<tr>\n<td style=\"width: 814px;\">\n<p><strong>T3</strong>: Tumor <strong>extension into major veins or perinephric tissues</strong>, but not into ipsilateral adrenal gland or beyond Gerota's fascia</p>\n<ul>\n<li>T3a: Tumor grossly extends into the renal vein or its segmental (muscle-containing) branches, or tumor invades perirenal and/or renal sinus fat but not beyond the Gerota's fascia</li>\n<li>T3b: Spread to infra-diaphragmatic IVC</li>\n<li>T3c: Spread to supra-diaphragmatic IVC or invades the wall of the IVC</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 814px;\"><strong>T4</strong>: Involves <strong>ipsilateral adrenal gland</strong> or invades <strong>beyond Gerota's fascia</strong></td>\n</tr>\n</tbody>\n</table>\n<table style=\"width: 812px;\">\n<tbody>\n<tr>\n<td style=\"width: 818px;\"><strong>N: Regional lymph nodes</strong></td>\n</tr>\n<tr>\n<td style=\"width: 818px;\">N0: No nodal involvement</td>\n</tr>\n<tr>\n<td style=\"width: 818px;\">N1: Metastatic involvement of regional lymph node(s)</td>\n</tr>\n</tbody>\n</table>\n<table style=\"width: 812px;\">\n<tbody>\n<tr>\n<td style=\"width: 820px;\"><strong>M: Metastasis</strong></td>\n</tr>\n<tr>\n<td style=\"width: 820px;\">M0: No distant metastases</td>\n</tr>\n<tr>\n<td style=\"width: 820px;\">M1: Distant metastases</td>\n</tr>\n</tbody>\n</table>\n<p>Note: Robson staging is a less commonly used staging system for RCC. Fuhrmann grading is used for grading RCC.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following should be the treatment of choice for renal cell carcinoma with tumor less than 4 cm in size?",
    "choices": [
      {
        "id": 1,
        "text": "Partial nephrectomy"
      },
      {
        "id": 2,
        "text": "Partial nephrectomy + neoadjuvant chemotherapy"
      },
      {
        "id": 3,
        "text": "Radical nephrectomy"
      },
      {
        "id": 4,
        "text": "Radical nephrectomy + postoperative radiotherapy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Partial<strong> nephrectomy</strong>&nbsp;(also known as <strong>nephron-sparing surgery</strong>) is the treatment of choice for tumors &lt;4 cm.</p>\n<p>Indications for partial nephrectomy:</p>\n<ul>\n<li><strong>Tumors &lt; 4cm</strong></li>\n<li><strong>Well-selected tumors between 4-7 cm</strong></li>\n<li><strong>Bilateral tumors</strong></li>\n<li><strong>Tumor in solitary kidneys</strong></li>\n<li>Patients with <strong>pre-existing renal dysfunction</strong>.</li>\n</ul>\n<p>Recently, partial nephrectomy is also increasingly being performed for <strong>stage T1b</strong> tumors.&nbsp;</p>\n<p>Treatment of renal cell carcinoma:&nbsp;</p>\n<p>RCC is a <strong>radio </strong>and <strong>chemoresistant</strong> tumor.</p>\n<table style=\"border-collapse: collapse; width: 80.853%;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 12.0225%; text-align: center;\">Staging&nbsp;</td>\n<td style=\"width: 43.3674%; text-align: center;\">Description&nbsp;</td>\n<td style=\"width: 44.6101%; text-align: center;\">Management&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 12.0225%;\">Stage 1&nbsp;</td>\n<td style=\"width: 43.3674%;\">Tumor &lt;7 cm, confined to the kidney</td>\n<td style=\"width: 44.6101%;\">Partial nephrectomy&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 12.0225%;\">Stage 2&nbsp;</td>\n<td style=\"width: 43.3674%;\">Tumor &gt;7 cm, confined to the kidney</td>\n<td style=\"width: 44.6101%;\">Radical nephrectomy&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 12.0225%;\">Stage 3&nbsp;</td>\n<td style=\"width: 43.3674%;\">Tumor extends into the major veins or adrenal gland with intact Gerota&rsquo;s fascia or regional lymph nodes involved.&nbsp;</td>\n<td style=\"width: 44.6101%;\">Radical nephrectomy&nbsp;</td>\n</tr>\n<tr>\n<td style=\"width: 12.0225%;\">Stage 4&nbsp;</td>\n<td style=\"width: 43.3674%;\">Tumor invades beyond Gerota fascia (including contiguous extension into the ipsilateral adrenal gland)&nbsp;</td>\n<td style=\"width: 44.6101%;\">\n<ul>\n<li>Debulking surgery</li>\n<li>mTOR inhibitors such as everolimus, sirolimus</li>\n<li>Tyrosine kinase inhibitors: sunitinib, sorafenib</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Radical nephrectomy</strong>&nbsp;consists of the removal of the&nbsp;<strong>kidney, perirenal fat, adrenal gland, and regional lymph nodes.&nbsp;</strong>The adrenal gland is&nbsp;<strong>no longer removed</strong> except in cases of obvious tumor involvement. Lymphadenectomy is indicated only in high-risk patients with large primary tumors and enlarged lymph nodes.</p>\n<p><strong>Cryoablation</strong>&nbsp;is indicated in the&nbsp;<strong>T1a</strong>&nbsp;stage of RCC if surgery cannot be performed. It is also indicated in&nbsp;<strong>advanced/metastatic</strong>&nbsp;tumors.&nbsp;</p>\n<p>Note: Sunitinib and sorafenib are also used in GIST and hepatocellular carcinoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are assisting in a radical nephrectomy in a patient with renal cell carcinoma. Which of the following statements is false regarding this procedure?",
    "choices": [
      {
        "id": 1,
        "text": "Early ligation of vessels is performed to reduce tumor spread"
      },
      {
        "id": 2,
        "text": "It includes removal of the kidney with Gerota's fascia"
      },
      {
        "id": 3,
        "text": "Excision of ipsilateral adrenal gland is done in all the cases"
      },
      {
        "id": 4,
        "text": "Regional lymphadenectomy is done for tumors more than 10 cm in size"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Excision </strong>of the<strong> ipsilateral adrenal gland</strong> in radical nephrectomy is done <strong>only if</strong> the <strong>tumor is adherent</strong> to it.</p>\n<p><strong>Classical radical nephrectomy</strong> includes:</p>\n<ul>\n<li>Early ligation of the renal artery and vein to prevent tumor spread</li>\n<li>Removal of the kidney with primary dissection external to the Gerota's fascia</li>\n<li>A complete regional lymphadenectomy from the crus of the diaphragm to the aortic bifurcation</li>\n</ul>\n<p><strong>Regional lymphadenectomy</strong> is not required in every radical nephrectomy. It is indicated in the following conditions:</p>\n<ul>\n<li>Enlarged lymph nodes on imaging</li>\n<li>Cytoreductive surgery for metastatic disease</li>\n<li><strong>Tumor size &gt; 10 cm</strong></li>\n<li>Nuclear grade &ge; 3</li>\n<li>Sarcomatoid histology in renal tumor</li>\n<li>Presence of tumor necrosis on imaging</li>\n<li>Extrarenal tumor extension</li>\n<li>Tumor thrombus</li>\n<li>Direct tumoral invasion of adjacent organs</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the most common abdominal tumor seen in children?",
    "choices": [
      {
        "id": 1,
        "text": "Wilm's tumor"
      },
      {
        "id": 2,
        "text": "Neuroblastoma"
      },
      {
        "id": 3,
        "text": "Lymphoma"
      },
      {
        "id": 4,
        "text": "Hepatoblastoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 4742\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Neuroblastoma</strong> is the <strong>most common </strong>abdominal&nbsp;tumor of <strong>childhood</strong>.</p>\n<div class=\"page\" title=\"Page 4750\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Wilms tumor</strong>, or nephroblastoma, is the <strong>most common</strong> primary malignant <strong>renal tumor</strong> of childhood.</p>\n<p>The renal origin of the mass is usually apparent on CT, but it can be mistaken for neuroblastoma. <strong>Wilm's tumor</strong> shows<strong> peripheral calcification</strong> in contrast-enhanced CT, unlike <strong>intratumoral calcifications</strong> and<strong> vascular encasement</strong>, which are observed <strong>in neuroblastoma.</strong></p>\n<table style=\"width: 776.546875px; height: 422px;\">\n<tbody>\n<tr>\n<td style=\"width: 174px;\"><strong>Features</strong></td>\n<td style=\"width: 233px;\"><strong>Wilms tumor (Nephroblastoma)</strong></td>\n<td style=\"width: 347.546875px;\"><strong>Neuroblastoma</strong></td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Age group</strong></td>\n<td style=\"width: 233px;\">Peaks at 3-4 years of age</td>\n<td style=\"width: 347.546875px;\">Age &lt;2 years of age</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Presentation</strong></td>\n<td style=\"width: 233px;\">Painless abdominal mass</td>\n<td style=\"width: 347.546875px;\">Painful abdominal mass</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Associated syndromes</strong></td>\n<td style=\"width: 233px;\">\n<p>WAGR syndrome</p>\n<p>Beckwith Weidman syndrome</p>\n<p>Denys Drash syndrome</p>\n</td>\n<td style=\"width: 347.546875px;\">Opsoclonus-myoclonus syndrome</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Calcifications</strong></td>\n<td style=\"width: 233px;\">Uncommon (10-15%)</td>\n<td style=\"width: 347.546875px;\">Very common (90%)</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Margins</strong></td>\n<td style=\"width: 233px;\">Well circumscribed</td>\n<td style=\"width: 347.546875px;\">Poorly marginated</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Vascular invasion</strong></td>\n<td style=\"width: 233px;\">Extends into the IVC and renal vein</td>\n<td style=\"width: 347.546875px;\">Encases vascular structures but does not invade them</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Metastasis</strong></td>\n<td style=\"width: 233px;\">Lung (most common)</td>\n<td style=\"width: 347.546875px;\">Bone (most common)</td>\n</tr>\n<tr>\n<td style=\"width: 174px;\"><strong>Findings on CECT</strong></td>\n<td style=\"width: 233px;\">Peripheral calcifications</td>\n<td style=\"width: 347.546875px;\">Intratumoral calcifications with vascular encasement</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A boy was brought by his parents, with complaints of blood in his urine. A left-sided reniform mass was palpated. Further investigations were suggestive of Wilms tumor. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Most cases occur in children between 2-5 years of age"
      },
      {
        "id": 2,
        "text": "It is the most common primary malignant renal tumor of childhood"
      },
      {
        "id": 3,
        "text": "Early metastasis occurs to the liver"
      },
      {
        "id": 4,
        "text": "Nephrogenic rest cells are precursor lesions"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Metastasis to the <strong>lungs</strong> occurs early in <strong>Wilms tumor</strong>.\u00a0Liver, bone, and brain metastasis is rare.</p>\n<p><strong>Wilms tumor</strong> or nephroblastoma is the most common <strong>primary malignant renal tumor</strong> of childhood. It is commonly seen in children between <strong>2-5 years </strong>of age. More than one-third of the cases contain precursor lesions known as <strong>nephrogenic rests</strong>.\u00a0</p>\n<p><strong>Asymptomatic abdominal mass</strong> discovered incidentally is the most common presentation. Patients may also present with:</p>\n<ul>\n<li>Abdominal pain</li>\n<li>Gross painless <strong>hematuria</strong></li>\n<li>Fever</li>\n<li>Hypertension</li>\n</ul>\n<p>Most unilateral tumors are treated by <strong>chemotherapy</strong> (cyclophosphamide, vincristine,\u00a0and dactinomycin) followed by nephrectomy.\u00a0</p>\n<p><strong>Radical nephrectomy</strong> is the standard surgical procedure done.\u00a0<strong>Partial nephrectomy</strong> is considered if all the following conditions are met:</p>\n<ul>\n<li>The tumor involves only one pole of the kidney</li>\n<li>No evidence of collecting system or vascular involvement</li>\n<li>The involved kidney has an appreciable function</li>\n<li>There are clear margins between tumor and surrounding structures</li>\n</ul>\n<p>It is done for children with<strong> bilateral</strong> disease or with a <strong>solitary kidney</strong>. Preoperative chemotherapy can be used in these cases to induce tumor shrinkage.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A mother notices a swelling in the abdomen of her 3-year-old child while bathing him. He had a history of hematuria two weeks back which resolved spontaneously. On examination, a right-sided reniform ballotable mass was found. What all investigations will you do?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 2"
      },
      {
        "id": 2,
        "text": "2 and 4"
      },
      {
        "id": 3,
        "text": "1, 2 and 3"
      },
      {
        "id": 4,
        "text": "1, 2, 3 and 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical features of a ballotable renal mass with hematuria in a 3-year-old child are suggestive of <strong>Wilms tumor </strong>and FNAC is not done in this condition.</p>\n<p><strong>Investigations in suspected cases of Wilms tumor</strong>:</p>\n<ul>\n<li>Laboratory study - shows hematuria, polycythemia, thrombocytosis, and elevated APTT</li>\n<li><strong>USG </strong>with doppler study of renal veins - for evaluation of the collecting system and to look for tumor thrombi in renal veins and inferior vena cava</li>\n<li><strong>CECT abdomen </strong>-&nbsp;to identify the extent of the disease, to access the contralateral kidney, and for metastasis</li>\n<li>MRI - not used routinely as it requires sedation</li>\n<li>Positron emission tomography(<strong>PET</strong>)<strong> scan</strong>&nbsp;- to identify regional spread and metastatic lesions</li>\n</ul>\n<p>Diagnosis should be made by imaging studies and it is <strong>confirmed after nephrectomy</strong>. A <strong>biopsy is discouraged</strong> in this condition as it results in disease upstaging. Only in cases with <strong>atypical presentation</strong> such as older age, signs of infection, etc, or with unusual imaging findings a <strong>core needle biopsy</strong> via the posterior approach can be performed.&nbsp;</p>\n<p>Note:&nbsp;Neuroblastoma also presents similar to Wilms tumor. It is commonly seen in children of <strong>preschool age.</strong>&nbsp;Affected children commonly present with a <strong>palpable abdominal mass </strong>and the most common site of the tumor is the <strong>retroperitoneum.</strong> Therefore, this disease becomes an important differential diagnosis. So we should also test for the presence of <strong>vanillyl mandelic acid </strong>(VMA) in this patient to exclude this tumor.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most important factor in determining the prognosis of a child with Wilms tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Size of the abdominal mass"
      },
      {
        "id": 2,
        "text": "Loss of heterozygosity of chromosome 1p"
      },
      {
        "id": 3,
        "text": "Histology of the tumour"
      },
      {
        "id": 4,
        "text": "Age less than 1 year at presentation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The most important <strong>prognostic factor</strong> in Wilms tumor is the <strong>histology of the tumor</strong>.</p>\n<p><strong>Wilms tumor</strong> (WT) is characterized by abnormal proliferation of the metanephric blastema, with no differentiation into tubules or glomeruli. It usually arises from three tissue elements (<strong>triphasic</strong> tumor):</p>\n<ol>\n<li>Blastema&nbsp;(poor prognosis if the blastemal component is more)</li>\n<li>Epithelium&nbsp;</li>\n<li>Stroma</li>\n</ol>\n<p>Wilms tumors <strong>lacking anaplasia</strong> (presence of atypical, polyploid mitotic figures, large nuclear size, and hyperchromasia) are designated as having <strong>&ldquo;favorable histology\".</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d5c8539fe8e0490b83e57116630c354ex510x525.GIF"
    ]
  },
  {
    "text": "Which of the following staging systems is used for staging of Wilms tumor in a child posted for partial nephrectomy post neoadjuvant chemotherapy?",
    "choices": [
      {
        "id": 1,
        "text": "Children's oncology group staging"
      },
      {
        "id": 2,
        "text": "International society of paediatric oncology staging"
      },
      {
        "id": 3,
        "text": "American joint committee on cancer staging"
      },
      {
        "id": 4,
        "text": "Shimada staging"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>International society of pediatric oncology <strong>(SIOP)</strong> is the <strong>post-chemotherapy</strong>&nbsp;staging system used for Wilms tumor. The SIOP approach involves the shrinkage of the tumor using preoperative chemotherapy.&nbsp;</p>\n<p>Option A: <strong>Children's oncology group</strong>&nbsp;(COG) staging&nbsp;is used for <strong>post-operative</strong> staging followed by chemotherapy. It was previously known as national Wilms tumor staging<strong>&nbsp;(NWTSG).</strong></p>\n<p>Option C: <strong>TNM staging (AJCC)</strong> is used for staging internal malignancies such as gastric, renal, breast, etc.</p>\n<p>Option D: <strong>Shimada</strong>&nbsp;staging is used for neuroblastoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child with a left-sided renal mass is suspected to have Wilms tumor. CECT also revealed a small mass on the right kidney. A frozen section done intraoperatively confirmed the presence of bilateral Wilms tumor. What is the stage of the tumor in this child?",
    "choices": [
      {
        "id": 1,
        "text": "Stage II"
      },
      {
        "id": 2,
        "text": "Stage III"
      },
      {
        "id": 3,
        "text": "Stage IV"
      },
      {
        "id": 4,
        "text": "Stage V"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Wilms</strong> tumor with <strong>bilateral</strong> involvement of&nbsp;<strong>kidneys</strong> is <strong>stage V</strong>.</p>\n<p><strong>Children's oncology group (COG) staging system</strong></p>\n<table style=\"height: 379px; width: 688px;\">\n<tbody>\n<tr>\n<td style=\"width: 56.625px;\">Stage I</td>\n<td style=\"width: 616.375px;\">Tumor confined to the kidney and completely resected with negative lymph nodes.</td>\n</tr>\n<tr>\n<td style=\"width: 56.625px;\">Stage II</td>\n<td style=\"width: 616.375px;\">Tumor extends beyond the kidney but is completely resected with negative margins and lymph nodes.</td>\n</tr>\n<tr>\n<td style=\"width: 56.625px;\">Stage III</td>\n<td style=\"width: 616.375px;\">Residual tumor present following surgery confined to the abdomen, including gross or microscopic tumor.</td>\n</tr>\n<tr>\n<td style=\"width: 56.625px;\">Stage IV</td>\n<td style=\"width: 616.375px;\">Hematogenous metastases (lung, liver, bone, brain, etc.) or lymph node metastases outside the abdominopelvic region.</td>\n</tr>\n<tr>\n<td style=\"width: 56.625px;\"><strong>Stage V</strong></td>\n<td style=\"width: 616.375px;\">Metastasis to opposite kidney (<strong>bilateral</strong> renal involvement).</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '39 Infections And Tumors Of Kidney';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>