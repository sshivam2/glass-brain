<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>38 Brachial Plexus And Nerves - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 48-year-old construction worker presented with complaints of unilateral loss of sweating on the face. He had a history of trauma to his back 1 month ago. Examination revealed the following findings. What is the likely site of the lesion?",
    "choices": [
      {
        "id": 1,
        "text": "Grey ramus of T1"
      },
      {
        "id": 2,
        "text": "White ramus of T1"
      },
      {
        "id": 3,
        "text": "Grey ramus of C8"
      },
      {
        "id": 4,
        "text": "White ramus of C8"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The difference between the sympathetic and parasympathetic ganglions are tabulated below.</p>\n<table style=\"height: 204px; width: 323px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 36px; text-align: center; height: 36px;\">&nbsp;</td>\n<td style=\"width: 33px; text-align: center; height: 36px;\"><strong>Sympathetic ganglions</strong></td>\n<td style=\"width: 234px; text-align: center; height: 36px;\"><strong>Parasympathetic ganglions</strong></td>\n</tr>\n<tr style=\"height: 37px;\">\n<td style=\"width: 36px; height: 37px;\">Location</td>\n<td style=\"width: 33px; height: 37px;\">Closer to the spinal cord</td>\n<td style=\"width: 234px; height: 37px;\">Closer to the organ</td>\n</tr>\n<tr style=\"height: 37px;\">\n<td style=\"width: 36px; height: 37px;\">Pre-ganglionic fibers</td>\n<td style=\"width: 33px; height: 37px;\">Short&nbsp;</td>\n<td style=\"width: 234px; height: 37px;\">Long</td>\n</tr>\n<tr style=\"height: 56px;\">\n<td style=\"width: 36px; height: 56px;\">Post-ganglionic fibers</td>\n<td style=\"width: 33px; height: 56px;\">Long</td>\n<td style=\"width: 234px; height: 56px;\">Short</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/113e06a5d3f24de195ab3afae572cdb1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f89d332c4b714a9eaacacaf03dbdb04dx1280x1002.JPEG"
    ]
  },
  {
    "text": "Which of the following structures of brachial plexus do not give branches?",
    "choices": [
      {
        "id": 1,
        "text": "Roots"
      },
      {
        "id": 2,
        "text": "Cords"
      },
      {
        "id": 3,
        "text": "Trunks"
      },
      {
        "id": 4,
        "text": "Divisions"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>divisions</strong> in the brachial plexus do <strong>not give any branches.</strong>&nbsp;</p>\n<p>However, the roots, trunks, and cords of the brachial plexus give out direct branches.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements about brachial plexus is false?",
    "choices": [
      {
        "id": 1,
        "text": "Nerve to subclavius arises from superior trunk"
      },
      {
        "id": 2,
        "text": "Arterial supply to brachial plexus is from branches of common carotid arteries"
      },
      {
        "id": 3,
        "text": "Radial nerve is the largest branch of the entire brachial plexus"
      },
      {
        "id": 4,
        "text": "C4 contributes to brachial plexus occasionally"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Arterial supply</strong> to <strong>brachial plexus</strong>&nbsp;is from branches of <strong>subclavian</strong> and <strong>vertebral</strong> arteries, and&nbsp;not from carotid arteries.&nbsp;</p>\n<p>The upper/<strong>superior&nbsp;trunk</strong> of the brachial plexus gives two <strong>branches</strong>:</p>\n<ul>\n<li><strong>Suprascapular</strong> nerve&nbsp;(C5, C6)</li>\n<li>Nerve to the <strong>subclavius </strong>(C5, C6)</li>\n</ul>\n<p><strong>Radial nerve</strong> (C5, C6, C7, C8, T1) is the <strong>largest</strong> branch of the brachial plexus. It originates as the <strong>terminal branch</strong> of the posterior cord of the plexus.</p>\n<p>Brachial plexus <strong>variations</strong> can be 2 types:</p>\n<ul>\n<li>C4 pre-fixed brachial plexus&nbsp;</li>\n<li>T2 post-fixed brachial plexus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An infraclavicular block was given in a patient with distal humerus fracture for open reduction and internal fixation. Which of the following branches of brachial plexus would likely be anesthetized?",
    "choices": [
      {
        "id": 1,
        "text": "Nerve to Subclavius"
      },
      {
        "id": 2,
        "text": "Dorsal scapular nerve"
      },
      {
        "id": 3,
        "text": "Nerve to serratus anterior"
      },
      {
        "id": 4,
        "text": "Thoracodorsal nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The <strong>thoracodorsal&nbsp;nerve</strong> would be anesthetized in the infraclavicular nerve block as it is an <strong>infraclavicular branch</strong> of the brachial plexus.&nbsp;It arises from the <strong>posterior cord</strong> (C6-C8).</p>\n<p style=\"text-align: justify;\">Branches of the brachial plexus that arise from the <strong>roots</strong> and <strong>trunk</strong> are <strong>supraclavicular</strong> branches. They include:</p>\n<ul>\n<li>Dorsal scapular nerve (C5)</li>\n<li>Long thoracic nerve of Bell (C5-C7)</li>\n<li>Suprascapular nerve (C5, C6)</li>\n<li>Nerve to Subclavius (C5, C6)</li>\n</ul>\n<p><strong>All</strong> the <strong>other branches</strong> of the brachial plexus that arise from the <strong>cords</strong> are <strong>infraclavicular</strong> branches.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d95d11a5f5cb4cfc8d6f66be46b49279x1280x806.JPEG"
    ]
  },
  {
    "text": "A neonate is being examined after delivery. The delivery was complicated by shoulder dystocia which led to the injury of the upper trunk of the brachial plexus. Which of the following deformities is least likely to be seen in this neonate?",
    "choices": [
      {
        "id": 1,
        "text": "Extension at elbow joint"
      },
      {
        "id": 2,
        "text": "Pronation at radio-ulnar joint"
      },
      {
        "id": 3,
        "text": "Abduction and medial rotation at shoulder joint"
      },
      {
        "id": 4,
        "text": "Sensory loss along the outer aspect of the arm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario, <strong>upper cervical trunk injury</strong> causes Erb's or <strong>Erb-Duchene palsy</strong>. This palsy involves&nbsp;<strong>adduction</strong> and medial rotation at the shoulder, and not abduction.&nbsp;</p>\n<p>The most common cause of Erb's palsy is the undue separation of head and neck i.e. fall on shoulder and birth injuries.<strong>&nbsp;</strong>The stretching causes damage to the <strong>upper trunk</strong> (<strong>C5, C6</strong>). Hence, the affected nerves include:&nbsp;</p>\n<ul>\n<li>Suprascapular nerve</li>\n<li>Axillary nerve</li>\n<li>Musculocutaneous nerve</li>\n<li>Radial nerve</li>\n</ul>\n<p>Erb's palsy<strong>&nbsp;</strong>has a typical presentation of a&nbsp;<strong>policeman's tip</strong> or<strong>&nbsp;waiter's tip</strong> hand deformity. It includes the following features:</p>\n<ul>\n<li>Arm is adducted and medially rotated at the shoulder joint</li>\n<li>Elbow joint is extended</li>\n<li>Radioulnar joint is pronated&nbsp;</li>\n<li>Sensory loss along the outer aspect of the arm</li>\n</ul>\n<p>The given image below shows classic deformity seen in Erb's palsy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f53b94f0be6646d0a21ea44493e4cfe1x456x581.JPEG"
    ]
  },
  {
    "text": "A medical student receives a booster dose of Hepatitis B vaccination. A few hours later, she develops weakness in the abduction and lateral rotation of that arm. Which nerve is most likely to have been injured?",
    "choices": [
      {
        "id": 1,
        "text": "Surgeon\u2019s nerve"
      },
      {
        "id": 2,
        "text": "Labourer\u2019s nerve"
      },
      {
        "id": 3,
        "text": "Nerve of Bell"
      },
      {
        "id": 4,
        "text": "Musician's nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Named nerves of the upper limb are:</p>\n<ul>\n<li>Laborer&rsquo;s nerve - median nerve</li>\n<li>Musician&rsquo;s nerve - ulnar nerve</li>\n<li>Surgeon&rsquo;s nerve - axillary nerve</li>\n<li>Nerve of Bell&nbsp;- long thoracic nerve</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d327b952dd3d42d48e8aa5ec2753be58x1280x2059.JPEG"
    ]
  },
  {
    "text": "Which of the following nerves is not directly related to humerus?",
    "choices": [
      {
        "id": 1,
        "text": "Axillary nerve"
      },
      {
        "id": 2,
        "text": "Median nerve"
      },
      {
        "id": 3,
        "text": "Ulnar nerve"
      },
      {
        "id": 4,
        "text": "Radial nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>median nerve</strong> is not directly related to the humerus.</p>\n<p>&nbsp;Nerves related to the<strong>&nbsp;humerus:</strong></p>\n<ul>\n<li><strong>Axillary</strong> nerve is at the <strong>surgical neck</strong>&nbsp;</li>\n<li><strong>Ulnar</strong> nerve is at the <strong>medial epicondyle</strong></li>\n<li><strong>Radial</strong> nerve is at the&nbsp;<strong>spiral groove</strong> of the shaft of the humerus.&nbsp;</li>\n</ul>\n<p>&nbsp;<strong>Median nerve course:&nbsp;</strong></p>\n<ul>\n<li><strong>Origin: Lateral</strong> and<strong> medial cords </strong>of the brachial plexus&nbsp;</li>\n<li><strong>Axilla and arm: </strong>No muscle supply from the median nerve</li>\n<li><strong>Forearm (flexor</strong> compartment): It supplies most <strong>superficial&nbsp;flexors.&nbsp;</strong>It leaves the cubital fossa between the 2 heads of Pronator teres and<strong>&nbsp;</strong>gives off the <strong>anterior interosseous nerve</strong></li>\n<li>Before entering deep into the flexor retinaculum gives off a<strong> palmar cutaneous branch.&nbsp;</strong>At the distal end of the flexor retinaculum, it divides into a <strong>recurrent branch</strong>&nbsp;and<strong> palmar digital nerves</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/360f436e4a984f6d93d52ff3e80673c7x600x1322.JPEG"
    ]
  },
  {
    "text": "Which of the following will you test in patients with median nerve injury at the wrist?",
    "choices": [
      {
        "id": 1,
        "text": "Contraction of flexor pollicis brevis"
      },
      {
        "id": 2,
        "text": "Loss of sensation of the palm"
      },
      {
        "id": 3,
        "text": "Contraction of abductor pollicis brevis"
      },
      {
        "id": 4,
        "text": "Loss of sensation on the ring finger"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option B: The <strong>lateral 1/2</strong> of the <strong>palm</strong> is supplied by the <strong>palmar cutaneous branch</strong> of the median nerve. It is usually <strong>spared</strong> in median nerve injury to the wrist as it does not pass through the carpal tunnel.&nbsp;</p>\n<p>Option D: The loss of sensation over ring finger cannot be tested for median nerve injury as it supplies:</p>\n<ul>\n<li>Lateral half of palmar aspect</li>\n<li>Medial half of distal 1/3 of dorsal aspect</li>\n</ul>\n<p>Note: Out of three muscles in the thenar eminence only abductor pollicis brevis and opponens pollicis can be tested for isolated action. Flexor pollicis brevis cannot be tested for isolated action.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/69526a82cd0c4671ab9f2c4d3cd069c2x1280x1442.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a8a0fa0dbe046729f57315e6adb33bbx1280x1223.JPEG"
    ]
  },
  {
    "text": "A 56-year-old man presented with a loss of sensation over the hand as marked in the given image. Which of the following statements is true regarding the affected nerve?",
    "choices": [
      {
        "id": 1,
        "text": "It innervates adductor pollicis"
      },
      {
        "id": 2,
        "text": "It innervates medial half of flexor digitorum profundus"
      },
      {
        "id": 3,
        "text": "Ape thumb deformity can be seen irrespective of site of lesion"
      },
      {
        "id": 4,
        "text": "Wrist drop can be seen if the lesion is above the elbow"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A: Adductor pollicis is innervated by the ulnar nerve.</p>\n<p>Option B: Median nerve&nbsp;innervates lateral half of flexor digitorum profundus.&nbsp;Ulnar nerve innervates medial half of flexor digitorum profundus.</p>\n<p>Option D: Wrist drop is seen in radial nerve palsy.</p>\n<p>Note: Thenar muscles include&nbsp;abductor pollicis, adductor pollicis, opponens pollicis, and flexor pollicis brevis.&nbsp;<strong>Adductor pollicis</strong>&nbsp;is called the&nbsp;<strong>graveyard of</strong> the<strong> ulnar nerve</strong>&nbsp;because after supplying all other muscles medially it ends laterally in adductor pollicis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3fe740c630e42ec928d74a3f3d5bba4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c709092baed040b3966467654fd4919fx1280x1111.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9126c70331194bc183536ac65fca759fx602x422.GIF"
    ]
  },
  {
    "text": "Lesion of the structure marked 'A' causes:",
    "choices": [
      {
        "id": 1,
        "text": "Loss of sensation of the nail of index finger"
      },
      {
        "id": 2,
        "text": "Hypothenar muscles wasting"
      },
      {
        "id": 3,
        "text": "Loss of sensation at the tip of radial tubercle"
      },
      {
        "id": 4,
        "text": "Loss of sensation of the 4th interdigital cleft"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Contents of cubital fossa: (From medial to lateral) - &ldquo;MBBR&rdquo;</p>\n<ul>\n<li><strong>M</strong>edian nerve</li>\n<li><strong>B</strong>rachial artery</li>\n<li><strong>B</strong>iceps brachii tendon</li>\n<li><strong>R</strong>adial nerve</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bf8824e32fb84d73a0e6d295a20d898c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6fc6af3c40054271873617b25aae05a1x1280x1142.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bdfed687a45f4a2ca55d40da02f2d684x602x422.GIF"
    ]
  },
  {
    "text": "Which of the following muscles are likely to be affected in patients with ulnar nerve injury at the elbow?",
    "choices": [
      {
        "id": 1,
        "text": "Flexor digitorum superficialis"
      },
      {
        "id": 2,
        "text": "Palmaris longus muscle"
      },
      {
        "id": 3,
        "text": "Pronator teres"
      },
      {
        "id": 4,
        "text": "Palmar interossei"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Ulnar nerve supply:</p>\n<table style=\"height: 239px;\" width=\"382\">\n<tbody>\n<tr style=\"height: 29.7326px;\">\n<td style=\"width: 183px; height: 29.7326px;\"><strong>Branches</strong></td>\n<td style=\"width: 183px; height: 29.7326px;\"><strong>Muscles/ region</strong></td>\n</tr>\n<tr style=\"height: 96px;\">\n<td style=\"width: 183px; height: 96px;\">Upper forearm branches</td>\n<td style=\"width: 183px; height: 96px;\">\n<p>Flexor carpi ulnaris</p>\n<p>Medial half of flexor digitorum profundus</p>\n</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 183px; height: 54px;\">Dorsal cutaneous branch&nbsp;(distal forearm)</td>\n<td style=\"width: 183px; height: 54px;\">Dorsum of medial 1/3 of hand and medial 1 1/2 fingers</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 183px; height: 36px;\">Palmar cutaneous branch (near the wrist)</td>\n<td style=\"width: 183px; height: 36px;\">Hypothenar eminence</td>\n</tr>\n<tr style=\"height: 96px;\">\n<td style=\"width: 183px; height: 96px;\">Superficial terminal branch</td>\n<td style=\"width: 183px; height: 96px;\">\n<p>Palmaris brevis</p>\n<p>Palmar surface of medial 1 1/2 fingers</p>\n</td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 183px; height: 72px;\">Deep terminal branch&nbsp;</td>\n<td style=\"width: 183px; height: 72px;\">All&nbsp;intrinsic muscles of the hand (except first 2 lumbricals&nbsp;and thenar eminence)</td>\n</tr>\n</tbody>\n</table>\n<p>The image given below shows the cutaneous innervation of the hand by the ulnar nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3b41f9045216439a9a42e6033028f5dfx1280x2371.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b28a2e4f1ec54271a84ca0fe1fa4e825x703x492.GIF"
    ]
  },
  {
    "text": "A patient came with complaints of inability to move his 4th and 5th digit, cannot hold a pen and he was not able to hold a paper between fingers. Which of the following sites given below is the probable cause of injury to the nerve in question?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A: It is the <strong>radial groove</strong> where <strong>radial nerve</strong> runs along with profunda brachii artery.</p>\n<p>Option D: It is the <strong>neck of humerus</strong> where <strong>axillary nerve</strong> runs around.</p>\n<p>Option B: It is the <strong>lateral epicondyle</strong>. Fracture of this part may lead to <strong>tardy ulnar nerve palsy</strong>, but incidence is less.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49925339e6fc47d8bae1fbac41054488.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/688511e3b2d44422b868a4d982e79576x1280x1359.JPEG"
    ]
  },
  {
    "text": "Which of the following is injured in a patient presenting with atrophy of hypothenar eminence and numbness in the palmar aspect of the little finger?",
    "choices": [
      {
        "id": 1,
        "text": "Deep branch of ulnar nerve"
      },
      {
        "id": 2,
        "text": "Ulnar nerve before it\u2019s division into superficial and deep branch"
      },
      {
        "id": 3,
        "text": "Palmar cutaneous branch of ulnar nerve"
      },
      {
        "id": 4,
        "text": "Superficial terminal branch of ulnar nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Note:\u00a0Wartenberg's sign is used to assess the weakness of palmar interossei.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea1d56353cbb46e7817fb678e9c6eca8x1280x2058.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7626a36cdb3f466380ec412c2045d02dx1280x2371.JPEG"
    ]
  },
  {
    "text": "A patient is unable to hold a piece of paper between his thumb and index finger firmly following a cut wound over the hypothenar eminence. Which of the following nerves is likely to be damaged?",
    "choices": [
      {
        "id": 1,
        "text": "Superficial terminal branch of ulnar nerve"
      },
      {
        "id": 2,
        "text": "Deep branch of ulnar nerve"
      },
      {
        "id": 3,
        "text": "Deep branch of radial nerve"
      },
      {
        "id": 4,
        "text": "Deep branch of median nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Loss of adduction </strong>points toward the<strong>&nbsp;deep ulnar nerve injury.</strong>&nbsp;The hypothenar injury could have caused downstream loss of innervation of the deep ulnar nerve which innervates adductor pollicis in thenar eminence.</p>\n<p>The<strong> course</strong> of deep ulnar nerve:</p>\n<ul>\n<li>At its <strong>origin,</strong> it innervates the <strong>hypothenar muscles.</strong></li>\n<li>As it <strong>crosses</strong> the deep part of the hand, it innervates all the <strong>interosseous muscles</strong> and the third and fourth<strong> lumbricals.</strong></li>\n<li>It ends by innervating the <strong>adductor pollicis </strong>and <strong>t</strong>he medial (deep) head of the <strong>flexor pollicis brevis</strong>.&nbsp;</li>\n<li>It also sends articular filaments to the <strong>wrist joint</strong>&nbsp;following Hilton's law.</li>\n</ul>\n<p>Given below is the course of the ulnar nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5484537c4e174f03b3ecf6b329cb88f9x1280x2371.JPEG"
    ]
  },
  {
    "text": "A 25-year-old man presented with displaced fracture of distal humerus. Which of the following signs would indicate that the ulnar nerve is injured at this site?",
    "choices": [
      {
        "id": 1,
        "text": "Total claw hand"
      },
      {
        "id": 2,
        "text": "Paralysis of all interossei"
      },
      {
        "id": 3,
        "text": "Complete paralysis of flexor digitorum profundus"
      },
      {
        "id": 4,
        "text": "Paralysis of all lumbricals"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Paralysis</strong> of all <strong>interossei</strong> is seen in <strong>injury</strong> to the <strong>ulnar nerve</strong> in the <strong>elbow</strong>.</p>\n<p>All interossei (dorsal and palmar) are supplied by ulnar nerve.</p>\n<ul>\n<li><strong>D</strong>orsal Interossei -&nbsp;<strong>Ab</strong>duction (<strong>DAB</strong>)</li>\n<li><strong>P</strong>almar Interossei - <strong>Ad</strong>duction (<strong>PAD</strong>)</li>\n</ul>\n<p>Note:<strong>&nbsp;</strong>Median nerve and ulnar nerve injury lead to a total claw hand.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following digits can be used to test radial nerve, ulnar nerve, and median nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Ring finger"
      },
      {
        "id": 2,
        "text": "Index finger"
      },
      {
        "id": 3,
        "text": "Little finger"
      },
      {
        "id": 4,
        "text": "Thumb"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The radial nerve, ulnar nerve, and median nerve can be tested using the <strong>thumb.</strong></p>\n<p>The muscles of thumb that are affected in the different nerve injuries are:</p>\n<table style=\"height: 328px; width: 505px;\">\n<tbody>\n<tr>\n<td style=\"width: 129px;\"><strong>Nerve injury</strong></td>\n<td style=\"width: 179.878px;\"><strong>Thumb muscle affected</strong></td>\n<td style=\"width: 174.122px;\"><strong>Thumb movement lost</strong></td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Median nerve</td>\n<td style=\"width: 179.878px;\">Opponens pollicis</td>\n<td style=\"width: 174.122px;\">Thumb opposition</td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Ulnar nerve</td>\n<td style=\"width: 179.878px;\">\n<p>Adductor pollicis</p>\n<p>Palmar interossei</p>\n</td>\n<td style=\"width: 174.122px;\">Adduction of thumb</td>\n</tr>\n<tr>\n<td style=\"width: 129px;\">Radial nerve</td>\n<td style=\"width: 179.878px;\">\n<p>Abductor pollicis longus (APL)</p>\n<p>Extensor pollicis brevis (EPB)</p>\n<p>Extensor pollicis longus (EPL)</p>\n</td>\n<td style=\"width: 174.122px;\">Thumb extension&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old woman presents with paresthesias in the lower lateral part of the arm. Branch of which of the following nerve is affected here?",
    "choices": [
      {
        "id": 1,
        "text": "Axillary nerve"
      },
      {
        "id": 2,
        "text": "Radial nerve"
      },
      {
        "id": 3,
        "text": "Median nerve"
      },
      {
        "id": 4,
        "text": "Ulnar nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>lower lateral part</strong> of the <strong>arm</strong> is innervated by the lower <strong>lateral cutaneous nerve</strong> of the arm. It is one of the 5 branches of the&nbsp;<strong>radial nerve</strong> in the spiral groove.</p>\n<p>The<strong> course</strong> of the radial nerve:</p>\n<ul>\n<li>It is the largest branch of the brachial plexus (C5, 6, 7,8, T1).</li>\n<li>It leaves the axilla by passing through the<strong>&nbsp;</strong>lower triangular space.</li>\n<li>It enters the arm and&nbsp;runs along the radial groove with profunda brachii artery. It gives the following branches:\n<ul>\n<li>Lower lateral cutaneous nerve of arm</li>\n<li>Posterior cutaneous nerve of forearm</li>\n<li>Branch to lateral head of triceps</li>\n<li>Branch to medial&nbsp;head of triceps</li>\n<li>Branch to anconeus</li>\n</ul>\n</li>\n<li>In the forearm, it<strong>&nbsp;</strong>divides in to 2 branches&nbsp;<strong>superficial (sensory)</strong>&nbsp;and&nbsp;<strong>deep (motor)</strong>&nbsp;branch at the cubital fossa.</li>\n<li>Superficial branch crosses the tendon of brachioradialis and goes posterior to supply dorsum of the hand.</li>\n<li>Deep branch/ posterior interroseous nerve pierces the supinator and supplies the extensors in the forearm.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1ce14f51c8664581abe340f23155e6aex1280x2971.JPEG"
    ]
  },
  {
    "text": "A patient with radial head fracture presents with an inability to extend the metacarpophalangeal joint. On examination, wrist extension is normal with no sensory impairment. Which of the following is the probable cause?",
    "choices": [
      {
        "id": 1,
        "text": "Injury to the radial nerve just below the spiral groove"
      },
      {
        "id": 2,
        "text": "Injury to the anterior interosseous nerve"
      },
      {
        "id": 3,
        "text": "Injury to the posterior interosseous nerve"
      },
      {
        "id": 4,
        "text": "Injury to the common extensor origin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given clinical scenario, there is a likely&nbsp;<strong>injury</strong> to the <strong>posterior interosseous nerve</strong>.</p>\n<p>It is prone to be injured in <strong>radial head fractures</strong>&nbsp;as the nerve winds around the radial neck to go into the posterior compartment of the forearm. There is <strong>no cutaneous sensory loss</strong> in lesions confined to the posterior interosseous nerve.</p>\n<p>The<strong> radial nerve </strong>divides into 2 branches, namely&nbsp;<strong>superficial (sensory)</strong> and <strong>deep (motor)</strong> branches at the cubital fossa.&nbsp;</p>\n<p>Deep radial nerve&nbsp;after supplying extensor carpi radialis brevis (ECRB)&nbsp;and supinator,&nbsp;continues as posterior interosseous nerve&nbsp;(<strong>PIN</strong>). From the posterior compartment, the&nbsp;<strong>supinator</strong> muscle wraps around the upper 1/3rd of the radius to reach the anterior compartment.&nbsp;</p>\n<p>PIN&nbsp;arches&nbsp;and winds <strong>around </strong>the<strong> radial neck</strong>&nbsp;along with the supinator muscle, into the posterior compartment of the forearm. Hence, it is in close relation with the radial head and neck, and the supinator arch or&nbsp;<strong>a</strong><strong>rcade of Froese</strong>.&nbsp;</p>\n<p>There is no cutaneous innervation&nbsp;by the posterior interosseous nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4ccccee3be5d4c20876d38b1e5a4abf2x1280x2062.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man has a C6, C7 nerve root injury due to disc herniation. Sensations of which part of the upper limb will be lost?",
    "choices": [
      {
        "id": 1,
        "text": "Thumb and index finger"
      },
      {
        "id": 2,
        "text": "Little finger"
      },
      {
        "id": 3,
        "text": "Upper medial part of arm"
      },
      {
        "id": 4,
        "text": "Upper medial side of forearm"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Sensations</strong> over the <strong>thumb</strong> and <strong>index finger</strong> are lost in <strong>C6, C7 nerve root</strong> injuries.</p>\n<p>The palmar pad of&nbsp;the thumb is innervated by C6 and the pad of the&nbsp;index finger is innervated by C7.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are testing the deep tendon reflexes in a patient with Guillan-Barre syndrome. Which spinal segment is tested predominantly by a tap on the triceps tendon?",
    "choices": [
      {
        "id": 1,
        "text": "C6"
      },
      {
        "id": 2,
        "text": "C7"
      },
      {
        "id": 3,
        "text": "C5"
      },
      {
        "id": 4,
        "text": "C8"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A tap on\u00a0the<strong> tendon </strong>of\u00a0the<strong> triceps</strong> posterior to the elbow <strong>mainly</strong> tests for<strong> C7.</strong></p>\n<p>A tap on the <strong>tendon</strong> of the\u00a0<strong>biceps</strong> in the cubital fossa tests <strong>mainly</strong> for spinal cord level <strong>C6</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding the radial nerve is true?",
    "choices": [
      {
        "id": 1,
        "text": "It leaves the axilla by passing through the quadrangular space"
      },
      {
        "id": 2,
        "text": "Lateral head of triceps is paralyzed in a lesion of radial nerve in lower spiral groove"
      },
      {
        "id": 3,
        "text": "Anconeus is supplied by a branch arising in the axilla"
      },
      {
        "id": 4,
        "text": "In the arm it travels along the brachial artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option A: Radial nerve branches from the posterior cord of the brachial plexus. It leaves the axilla by passing through the<strong> lower triangular space.</strong></p>\n<p>Option C:&nbsp;<strong>Anconeus</strong> is supplied by a branch arising in the <strong>spiral groove</strong>.</p>\n<p>Option D: In the arm, it<strong>&nbsp;</strong>runs along the radial groove with the&nbsp;<strong>profunda brachii artery</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e23efcdf892c4e4fbfe2029bc58b4467x1280x2971.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding carpal tunnel syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatoid arthritis is a cause"
      },
      {
        "id": 2,
        "text": "Pain and paresthesia are worse at night time"
      },
      {
        "id": 3,
        "text": "Paresthesia over the skin of thenar eminence is prominent"
      },
      {
        "id": 4,
        "text": "No artery passes through the tunnel"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Paresthesia over the skin of thenar eminence is not seen in carpal tunnel syndrome.&nbsp;As the <strong>median nerve</strong> gives off the <strong>palmar cutaneous</strong> branch, that supplies the thenar eminence <strong>before</strong> it <strong>enters</strong> the <strong>carpal tunnel</strong>.</p>\n<p>Carpal tunnel syndrome is due to <strong>compression</strong> of the <strong>median nerve</strong>&nbsp;due to:</p>\n<ul>\n<li>Reduced size of the osseofibrous carpal tunnel</li>\n<li>Inflammation or thickening of the synovial sheaths of the flexors tendons (tenosynovitis) due to stress injury (eg., occupational)</li>\n<li>Inflammation of the flexor retinaculum</li>\n<li>Arthritic changes in the carpal bones (particularly rheumatoid arthritis)</li>\n</ul>\n<p>The pain and paresthesia are <strong>worse at night</strong> and on gripping objects.</p>\n<p><strong>Structures</strong> passing through the <strong>carpal tunnel</strong>:&nbsp;</p>\n<ul>\n<li>Tendons of&nbsp;<strong>FDS </strong>(flexor digitorum superficialis),<strong> FDP </strong>(flexor digitorum profundus), <strong>FPL</strong>&nbsp;(flexor pollicis long)</li>\n<li>Median nerve</li>\n</ul>\n<p>No artery passes through the carpal tunnel.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1fa85d4d917840789b7b2782e2acd8e8x1280x2558.JPEG"
    ]
  },
  {
    "text": "Which of the following structure is not likely to be injured in a wrist slash injury over the radial side of the left wrist?",
    "choices": [
      {
        "id": 1,
        "text": "Radial artery"
      },
      {
        "id": 2,
        "text": "Radial nerve"
      },
      {
        "id": 3,
        "text": "Flexor carpi radialis"
      },
      {
        "id": 4,
        "text": "Palmaris longus tendon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The median nerve is likely to be injured in case of deep laceration of the radial side of the wrist, whereas the radial nerve is least likely to be injured.</p>\n<p><strong>Wrist slash injuries:</strong></p>\n<p>A deep laceration on the <strong>radial side</strong> of the wrist may injure the following structures:</p>\n<ul>\n<li>Radial artery</li>\n<li><strong>Median nerve</strong></li>\n<li>Flexor carpi radialis tendon</li>\n<li>Palmaris longus tendon</li>\n</ul>\n<p>A deep laceration on the <strong>ulnar side</strong> of the wrist may injure the following structures:</p>\n<ul>\n<li>Ulnar artery</li>\n<li><strong>Ulnar nerve</strong></li>\n<li>Flexor carpi ulnaris tendon</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f1a3d639b314b02a0a5f19cb1a23ec0x1280x2558.JPEG"
    ]
  },
  {
    "text": "Which of the following forms the roof of the structure marked in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Pisiform bone, flexor carpi ulnaris and abductor digiti minimi"
      },
      {
        "id": 2,
        "text": "Flexor retinaculum and pisohamate ligaments"
      },
      {
        "id": 3,
        "text": "Hook of hamate, extrinsic flexor tendons, the transverse carpal ligaments"
      },
      {
        "id": 4,
        "text": "Palmar carpal ligament and palmaris brevis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked in the image is the <strong>Guyon's canal.</strong>&nbsp;The<strong> roof</strong>&nbsp;of Guyon's canal is formed by the&nbsp;<strong>palmar carpal ligament</strong> and <strong>palmaris brevis</strong>.</p>\n<p>Guyon's canal is a&nbsp;4 cm long canal formed by splitting of the flexor retinaculum along the anteromedial side of the wrist.</p>\n<p><strong>Boundaries</strong>:</p>\n<ul>\n<li>Ulnar/Medial side -&nbsp;Pisiform bone, flexor carpi ulnaris, and abductor digiti minimi</li>\n<li>Lateral -&nbsp;Hook of hamate, extrinsic flexor tendons, and the transverse carpal ligaments</li>\n<li>Floor -&nbsp;Flexor retinaculum and pisohamate ligaments</li>\n<li>Roof -&nbsp;Palmar carpal ligament and palmaris brevis</li>\n</ul>\n<p><strong>Contents</strong>:</p>\n<ul>\n<li>Ulnar nerve</li>\n<li>Ulnar artery</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/57dbed7ff09a485682e401580c744af2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/51bc40ec70fc4c65bd89cc38e568a328x600x556.JPEG"
    ]
  },
  {
    "text": "A 13-year-old boy presents with injury to the medial epicondyle of the humerus. Which of the following is least likely to be seen?",
    "choices": [
      {
        "id": 1,
        "text": "Weakness of the ulnar deviation and flexion"
      },
      {
        "id": 2,
        "text": "Complete paralysis of the IIIrd and IVth digits"
      },
      {
        "id": 3,
        "text": "Atrophy of the hypothenar eminence"
      },
      {
        "id": 4,
        "text": "Decreased sensation of the hypothenar eminence"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Injury to the&nbsp;<strong>medial epicondyle</strong> injures the <strong>ulnar nerve</strong>. Since flexor digitorum superficialis (supplied by median nerve) and extensor digitorum (supplied by the radial nerve) are still functional, complete paralysis of the third and fourth digits is not seen.&nbsp;</p>\n<p>Injury to the <strong>medial epicondyle</strong> damages the<strong>&nbsp;ulnar nerve</strong>. This causes:</p>\n<ul>\n<li>Paralysis of:\n<ul>\n<li>Flexor carpi ulnaris (<strong>FCU</strong>) -&nbsp;loss of ulnar deviation&nbsp;</li>\n<li>Medial half of flexor digitorum profundus (FDP) -&nbsp;loss of distal interphalangeal joint flexion</li>\n<li><strong>Hypothenar</strong> paralysis&nbsp;- lead to atrophy</li>\n</ul>\n</li>\n<li>Sensory loss over medial 1/3 of hand and medial 1 1/2 fingers</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are suspecting injury to the long thoracic nerve in a patient who underwent radical mastectomy. Which of the following tasks will you ask the patient to perform to test the integrity of the nerve?",
    "choices": [
      {
        "id": 1,
        "text": "Shrug the shoulders"
      },
      {
        "id": 2,
        "text": "Raise the arm above the head on the affected side"
      },
      {
        "id": 3,
        "text": "Touch the opposite shoulder"
      },
      {
        "id": 4,
        "text": "Lift a heavy object from ground"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Injury</strong> to the <strong>long thoracic nerve</strong> during radical mastectomy paralyzes the <strong>serratus anterior</strong> muscle. This can be tested by&nbsp;<strong>raising </strong>the<strong> arm above </strong>the<strong> head </strong>on the affected side.</p>\n<p><strong>Shrugging</strong> of the&nbsp;<strong>shoulders</strong> is mainly carried out by the&nbsp;<strong>trapezius</strong>, which is supplied by the<strong> spinal accessory nerve</strong>. This muscle works with the serratus anterior for overhead abduction.</p>\n<p><strong>Pectoralis major</strong>, supplied mainly by medial and lateral pectoral nerves, causes flexion at the shoulder joint. It is involved in <strong>touching</strong> the <strong>opposite</strong> <strong>shoulder</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Till which point does the anterior axial line extend?",
    "choices": [
      {
        "id": 1,
        "text": "Shoulder"
      },
      {
        "id": 2,
        "text": "Elbow"
      },
      {
        "id": 3,
        "text": "Wrist"
      },
      {
        "id": 4,
        "text": "Knuckle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> anterior axial line</strong> extends till the&nbsp;<strong>wrist </strong>joint.</p>\n<p>The axial line is the junction between two dermatomes supplied by discontinuous spinal nerves.</p>\n<ul>\n<li>The <strong>anterior axial line</strong> starts from the&nbsp;<strong>sternal angle</strong> (second rib) and extends to the&nbsp;<strong>wrist joint</strong> level.</li>\n<li>The posterior axial line begins at the shoulder and reaches the elbow joint level.</li>\n</ul>\n<p>The images given below show the dermatomes of the upper limb with a dark green line indicating the axial line.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7830b8b2408d41b08494dd8a84500ff8x1280x2558.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a74437aefa034eefb7fd738db4fd60cax1280x2558.JPEG"
    ]
  },
  {
    "text": "What is the deformity seen in patients with 'main en griffe'?",
    "choices": [
      {
        "id": 1,
        "text": "Extension at metacarpophalengeal joint and flexion at interphalengeal joint"
      },
      {
        "id": 2,
        "text": "Extension at both metacarpophalengeal and interphalengeal joints"
      },
      {
        "id": 3,
        "text": "Flexion at both metacarpophalengeal and interphalengeal joints"
      },
      {
        "id": 4,
        "text": "Flexion at metacarphophalengeal joint and extension at interphalengeal joint"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Extension</strong> at the\u00a0<strong>metacarpophalangeal</strong> joint and <strong>flexion</strong> at <strong>interphalangeal</strong> joints due to <strong>ulnar</strong> nerve injury produces <strong>claw hand</strong> (<strong>main en griffe</strong>).</p>\n<p>The <strong>ulnar nerve</strong> supplies <strong>medial</strong> two <strong>lumbricals</strong> in the hand. The lumbricals have a combined action on metacarpophalangeal (MCP) joint flexion and interphalangeal (IP) joint extension (<strong>glass holding posture</strong>).</p>\n<p>In ulnar nerve injury, since the medial lumbricals are not functional, the forearm muscles are unopposed. <strong>MCP</strong> joint goes into <strong>hyperextension</strong> (unopposed activity of extensor digitorum, posterior forearm) and <strong>IP</strong> joints go into <strong>flexion</strong> (unopposed activity of flexor digitorum muscles, anterior forearm) and they bring about the claw hand deformity.\u00a0</p>\n<p>The image given below shows the ulnar claw hand (main en griffe). Note the hyperextension at MCP joints and flexion at IP joints.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db2b969fbcb94942bcad483f07f3b215x720x583.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1472395e5c254c058ba7ea4701ef0a34x1279x1225.JPEG"
    ]
  },
  {
    "text": "Nerve supply of the area marked by arrow in the image is:",
    "choices": [
      {
        "id": 1,
        "text": "Radial nerve"
      },
      {
        "id": 2,
        "text": "Posterior interosseus nerve"
      },
      {
        "id": 3,
        "text": "Median nerve"
      },
      {
        "id": 4,
        "text": "Ulnar nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The area marked in the image is supplied by <strong>radial nerve</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ffe36e9dace747a5811db772749db9cf.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "True regarding the lesion of the structure marked by the arrow  is:",
    "choices": [
      {
        "id": 1,
        "text": "Ape thumb deformity"
      },
      {
        "id": 2,
        "text": "Claw hand"
      },
      {
        "id": 3,
        "text": "Claudication"
      },
      {
        "id": 4,
        "text": "Wrist drop"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Ape thumb </strong>deformity is seen in a lesion of the <strong>median nerve</strong>.</p>\n<p><strong>Claw hand </strong>deformity is seen in a lesion of the <strong>ulnar nerve</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/94b8cc5b1f514abaaf63d2d2ffa20daa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36ee2aea014e45c29cb91aad5206cef6x1280x1142.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8b6fb3ab5a54b02b7a73e2d5ee84320x1280x2971.JPEG"
    ]
  },
  {
    "text": "A patient is unable to abduct his arm. Which of the following root values is likely to be affected?",
    "choices": [
      {
        "id": 1,
        "text": "C4"
      },
      {
        "id": 2,
        "text": "C5"
      },
      {
        "id": 3,
        "text": "C6"
      },
      {
        "id": 4,
        "text": "C7"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> inability</strong> to<strong> abduct</strong> the arm is most likely due to a lesion of the&nbsp;<strong>C5 root.</strong></p>\n<p>The <strong>deltoid </strong>muscle is the main muscle involved in the abduction of the arm. It is innervated by the C5 root of the <strong>axillary nerve.&nbsp;</strong>So, a lesion involving the C5 causes inability to abduct the arm.</p>\n<p>The table below shows the movements and muscles tested to determine the location of the lesion in the upper limb.</p>\n<table style=\"width: 432.555px; height: 417px;\">\n<tbody>\n<tr>\n<td style=\"width: 118px;\"><strong>Arm movement</strong></td>\n<td style=\"width: 123px;\"><strong>Muscle</strong></td>\n<td style=\"width: 56px;\"><strong>Root</strong></td>\n<td style=\"width: 102.555px;\"><strong>Nerve</strong></td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Shoulder abduction</td>\n<td style=\"width: 123px;\">Deltoid</td>\n<td style=\"width: 56px;\">C5</td>\n<td style=\"width: 102.555px;\">Axillary</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Elbow extension</td>\n<td style=\"width: 123px;\">Triceps</td>\n<td style=\"width: 56px;\">C7</td>\n<td style=\"width: 102.555px;\">Radial</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">\n<p>Elbow flexion</p>\n<p>&nbsp;</p>\n</td>\n<td style=\"width: 123px;\">\n<p>Biceps</p>\n<p>Brachioradialis</p>\n</td>\n<td style=\"width: 56px;\">\n<p>C5/6</p>\n<p>C6</p>\n</td>\n<td style=\"width: 102.555px;\">\n<p>Musculocutaneous</p>\n<p>Radial</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Radial wrist extensor</td>\n<td style=\"width: 123px;\">Extensor carpi radialis longus</td>\n<td style=\"width: 56px;\">C6</td>\n<td style=\"width: 102.555px;\">Radial</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Finger extensors</td>\n<td style=\"width: 123px;\">Extensor digitorum</td>\n<td style=\"width: 56px;\">C7</td>\n<td style=\"width: 102.555px;\">Posterior interosseus</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Finger flexors</td>\n<td style=\"width: 123px;\">\n<div class=\"page\" title=\"Page 1066\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Flexor pollicis longus and flexor digitorum profundus, index</p>\n<div class=\"page\" title=\"Page 1066\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Flexor digitorum profundus, ring and little</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 56px;\">\n<p>C8</p>\n<p>C8</p>\n</td>\n<td style=\"width: 102.555px;\">Anterior interosseous\n<div class=\"page\" title=\"Page 1066\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Ulnar</p>\n</div>\n</div>\n</div>\n</div>\n</td>\n</tr>\n<tr>\n<td style=\"width: 118px;\">Finger abduction</td>\n<td style=\"width: 123px;\">\n<p>First dorsal interosseus</p>\n<p>Abductor pollicis brevis</p>\n</td>\n<td style=\"width: 56px;\">\n<p>T1</p>\n<p>T1&nbsp;</p>\n</td>\n<td style=\"width: 102.555px;\">\n<p>Ulnar&nbsp;</p>\n<p>Median</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '38 Brachial Plexus And Nerves';
        const quizFilename = '38-brachial-plexus-and-nerves-05ce9962.html';
        let hierarchy = ["Marrow", "qBank", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>