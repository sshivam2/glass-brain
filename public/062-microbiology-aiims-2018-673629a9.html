<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>062 Microbiology Aiims 2018 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Microbiology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">24</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A kinyoun positive oocyst (25 \u03bcm) was isolated from an HIV patient with diarrhea. Identify the organism.",
    "choices": [
      {
        "id": 1,
        "text": "Cystoisospora"
      },
      {
        "id": 2,
        "text": "Cyclospora"
      },
      {
        "id": 3,
        "text": "Cryptosporidium"
      },
      {
        "id": 4,
        "text": "Microspora"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Modified acid-fast staining (like Kinyoun stain) showing oocysts of&nbsp;Cryptosporidium species.</p>\n<p>In immunocompromised patients, the infection causes severe diarrhea similar to cholera and require hospitalization.</p>\n<p>The diagnosis is made with stool microscopy. The cyst wall and sporoblasts are dyed red with the Ziehl&ndash;Neelsen (warm) or Kinyoun (cold) staining methods. Both methods have good specificity and therefore are useful as confirmatory tests.</p>\n<p>The treatment is fluid replacement and cotrimoxazole.</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/832e73804a10421bbacc4ed14006e7f4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb7670963b1046c88ea8a938f3e3ac9ax508x368.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9ffc8bed88464893a60488eefaae23a1x512x284.JPEG"
    ]
  },
  {
    "text": "The test shown below, which uses a bacitracin disk, is useful in identifying ____________.",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcus aureus"
      },
      {
        "id": 2,
        "text": "Streptococcus pyogenes"
      },
      {
        "id": 3,
        "text": "Clostridium botulinum"
      },
      {
        "id": 4,
        "text": "Bacillus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows blood agar culture with bacitracin disk with a zone of inhibition around the disk, which means that the organism is sensitive to bacitracin.</p>\n<p>Among the options given, <em><strong>Streptococcus pyogenes</strong></em> is susceptible to bacitracin.</p>\n<p>Streptococci belonging to group A are identified (presumptively) by inhibition of growth by bacitracin.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6b2b4c2213364ff4a8469a2038aacb12.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the incubation period of lymphogranuloma venereum?",
    "choices": [
      {
        "id": 1,
        "text": "1-5 days"
      },
      {
        "id": 2,
        "text": "7-10 days"
      },
      {
        "id": 3,
        "text": "10-30 days"
      },
      {
        "id": 4,
        "text": "30-60 days"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 1603\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 1602\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The <strong>incubation period</strong> of <em><strong>Lymphogranuloma venereum</strong></em> ranges from <strong>10-30 days.</strong></p>\n<p><em>Chlamydia trachomatis</em> serovars L1, L2, and L3 cause lymphogranuloma venereum (LGV). The most common presentation is\u00a0the<strong> inguinal syndrome</strong>, which is characterized by painful inguinal lymphadenopathy.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is the agent used to treat the infection caused by the cestode egg in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Praziquantel"
      },
      {
        "id": 2,
        "text": "Ivermectin"
      },
      {
        "id": 3,
        "text": "Albendazole"
      },
      {
        "id": 4,
        "text": "Diethylcarbamazine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Hymenolepiasis&nbsp;is the most common of all the cestode infections and is usually asymptomatic.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/575f7b66bd404923adc47c0cfb1ddb4c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/64af404af17d4eeabd9e06632e4993cfx520x435.GIF"
    ]
  },
  {
    "text": "Human herpesvirus 8 is associated with all except ______.",
    "choices": [
      {
        "id": 1,
        "text": "Kaposi sarcoma"
      },
      {
        "id": 2,
        "text": "Castleman\u2019s disease"
      },
      {
        "id": 3,
        "text": "Adult T-cell leukemia"
      },
      {
        "id": 4,
        "text": "Primary effusion lymphoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Adult T-cell leukemia </strong>is caused by <strong>HTLV-1</strong> (and not HHV8).</p>\n<p><strong>Human Herpesvirus 8 </strong>(HHV8), also known as Kaposi sarcoma-associated herpesvirus (KSHV), is lymphotropic virus and is closely related to Ebstein&ndash;Barr virus (EBV).</p>\n<p>Diseases caused by HHV:</p>\n<ul>\n<li><strong>Kaposi sarcomas</strong></li>\n<li>Vascular tumors of mixed cellular composition</li>\n<li>Body cavity-based lymphomas occurring in AIDS patients (<strong>Primary effusion lymphoma</strong>)</li>\n<li><strong>Multicentric Castleman disease</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the condenser in the following image.",
    "choices": [
      {
        "id": 1,
        "text": "Above the stage"
      },
      {
        "id": 2,
        "text": "Below the stage"
      },
      {
        "id": 3,
        "text": "Near the eyepiece"
      },
      {
        "id": 4,
        "text": "Above the objective lenses"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The purpose of the condenser lens is to <strong>focus </strong>the light from the illuminator onto the <strong>specimen</strong>. Microscopes with a stage condenser lens render a <strong>sharper image</strong> than those with no condenser lens.</p>\n<p>The <strong>simple microscope</strong> was invented first by\u00a0<strong>Antonie van Leeuwenhoek, </strong>the father of microscopy and microbiology. It uses <strong>1 lens</strong> for magnification. The <strong>compound microscope</strong>, introduced by Hans and Zacharias Janssen uses <strong>2 lenses</strong>, an objective lens and an eyepiece, to provide <strong>better magnification</strong> power than the simple microscope.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7ff62277586e4d888e78c475ea63dc96.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/abe685cceae541b586b31df0d6b9d8d7x600x619.JPEG"
    ]
  },
  {
    "text": "The following test is positive for identification of ________",
    "choices": [
      {
        "id": 1,
        "text": "Candida albicans"
      },
      {
        "id": 2,
        "text": "Candida glabrata"
      },
      {
        "id": 3,
        "text": "Candida parapsilosis"
      },
      {
        "id": 4,
        "text": "Candida tropicalis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows the<strong>\u00a0germ tube test\u00a0</strong>used for<strong>\u00a0</strong>identifying <strong><em>Candida albicans.\u00a0</em></strong></p>\n<p>Candida species, when cultured, grow as oval, budding yeast cells with pseudohyphae. Unlike other species of candida, Candida albicans can also produce <strong>true hyphae </strong>or <strong>germ tubes</strong>. This can be demonstrated after <strong>incubation</strong> in <strong>serum</strong>\u00a0maintained <strong>at 37\u00b0C</strong> for about <strong>90 minutes.</strong>\u00a0This is known as\u00a0the<strong> Reynolds-Braude phenomenon.\u00a0</strong>This test is positive for\u00a0<strong><em>Candia dubliniensis</em></strong> as well. Another distinguishing feature of <em>C. albicans</em> is that it produces large, spherical <strong>chlamydospores</strong> on nutritionally deficient media.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/53a2996c5ddf4a3faaa168cbaa5877fb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Choose the correct statement regarding CMV.",
    "choices": [
      {
        "id": 1,
        "text": "Ganciclovir resistance is due to mutation in UL97 phosphotransferase gene"
      },
      {
        "id": 2,
        "text": "CMV can be cultured in vitro in any mammalian cell"
      },
      {
        "id": 3,
        "text": "Commonest manifestation of CMV associated disease is watery diarrhea"
      },
      {
        "id": 4,
        "text": "UL54 mutated CMV strains do not show cross resistance to foscarnet"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Resistance</strong> to <strong>ganciclovir</strong> most commonly occurs due to<strong> mutations</strong> in the<strong> UL97 phosphotransferase gene.\u00a0</strong></p>\n<p><strong>Cytomegalovirus\u00a0</strong>(CMV) is a beta-herpes virus. It is the most common congenital infection. In adults, its disease is mostly subclinical (option C). An apparent CMV infection resembles infectious mononucleosis (fever, sore throat, enlarged lymph nodes and splenomegaly). It is the most common infection in the donor organ seen 1-4 months after solid organ transplantation. In immunosuppressed hosts, it causes pneumonia and colitis.\u00a0</p>\n<p>Diagnosis is by PCR assays. Human CMV replicates in vitro <strong>only </strong>in<strong> human fibroblasts</strong> (option B) and can thus be cultured in them,<strong> </strong>although the virus is often isolated from epithelial cells of the host. The cultured fibroblasts show <strong>owl-eye inclusion bodies</strong> after 2-3 weeks.\u00a0</p>\n<p><strong>UL54 </strong>(DNA polymerase) gene mutations can confer CMV resistance to ganciclovir, cidofovir and <strong>foscarnet</strong> (option D).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Solvent/Detergent (SD) plasma destroys lipid-enveloped viruses. So, on SD plasma transfusion, which of the following infection is likely to occur?",
    "choices": [
      {
        "id": 1,
        "text": "Human Immunodeficiency Virus (HIV)"
      },
      {
        "id": 2,
        "text": "Hepatitis A Virus (HAV)"
      },
      {
        "id": 3,
        "text": "Hepatitis B Virus (HBV)"
      },
      {
        "id": 4,
        "text": "Hepatitis C Virus (HCV)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Solvent detergent plasma is a form of blood plasma&nbsp;made from plasma collected from many people which is then processed with solvents&nbsp;to try to get rid of viruses.&nbsp;<strong>HAV</strong> is a <strong>non-enveloped</strong> virus, and hence it&rsquo;s <strong>not affected by solvent/detergent (SD) plasma.</strong></p>\n<p>Only the <strong>viruses with an envelope</strong> are <strong>susceptible to SD plasma destruction</strong>.</p>\n<p>Hepatitis B, C, and HIV are enveloped.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Plasma sterilization makes use of ____________.",
    "choices": [
      {
        "id": 1,
        "text": "Hydrogen peroxide"
      },
      {
        "id": 2,
        "text": "Ethylene oxide"
      },
      {
        "id": 3,
        "text": "Gamma rays"
      },
      {
        "id": 4,
        "text": "UV rays"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A variety of <strong>hydrogen peroxide</strong> gas&ndash;based processes that use plasma as part of the sterilization process are known as \"<strong>plasma sterilization</strong>.\"</p>\n<p>The mechanisms of antimicrobial action in these processes are primarily due to hydrogen peroxide gas (or condensed gas) and not plasma, although the plasma generation phase of these processes is known to assist in the breakdown of residual peroxide in the chamber load.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the organism below that causes effacement and attachment of intestinal cells.",
    "choices": [
      {
        "id": 1,
        "text": "ETEC"
      },
      {
        "id": 2,
        "text": "EIEC"
      },
      {
        "id": 3,
        "text": "EPEC"
      },
      {
        "id": 4,
        "text": "EAEC"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image below shows an electron microscopy image of E Coli.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dd8c6b12e06c4a618c5833f64e86a693.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb665fb7793947eabae4829a87df5a89x1280x1046.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bc3d14de6014f70bf6970fdc8a7a784x720x604.PNG"
    ]
  },
  {
    "text": "Which of the following organisms is represented by the given form of replication?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatitis virus"
      },
      {
        "id": 2,
        "text": "Influenza virus"
      },
      {
        "id": 3,
        "text": "HIV"
      },
      {
        "id": 4,
        "text": "Herpes virus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows generation of mRNA from negative sense RNA within the nucleus. This occurs during the replication of <strong>influenza virus</strong>.</p>\n<p><strong>Orthomyxoviruses\u00a0</strong>(influenza virus) contain segmented (8 segments) negative sense ssRNA that is replicated in the nucleus. Stages of viral replication include the following:\u00a0</p>\n<div class=\"page\" title=\"Page 583\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ol>\n<li><strong>Attachment, penetration, uncoating: </strong>The virus attaches to cell-surface sialic acid via hemagglutinin. It is then internalized by receptor-mediated endocytosis. There is fusion of the viral envelope and cell membrane, resulting in uncoating or release of nucleocapsid into the host cell cytoplasm.\u00a0</li>\n<li><strong>Transcription</strong> and<strong> translation: </strong>\u00a0mRNAs are produced from nucleocapsids via a virus-encoded polymerase. This process occurs in the nucleus. The mRNAs thus produced are translated into viral proteins in the cytoplasm.\u00a0</li>\n<li><strong>Viral RNA replication:</strong> The viral genome is replicated by the same virus-encoded polymerase involved in transcription. The negative sense RNA is converted to its positive sense form. The positive sense copies serve as templates for replication of the viral genome.\u00a0</li>\n<li><strong>Maturation:</strong>\u00a0The virus matures by budding from the surface of the cell.</li>\n</ol>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2f95a71e225842cd9d0f47b1091c0966.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which method of diagnosis is shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Darkfield microscopy"
      },
      {
        "id": 2,
        "text": "Phase contrast microscopy"
      },
      {
        "id": 3,
        "text": "Fluorescent microscopy"
      },
      {
        "id": 4,
        "text": "Electron microscopy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image is of<strong>&nbsp;darkfield microscopy</strong> as it has a <strong>dark background</strong> with a refractile organism.</p>\n<p>The dark ground microscope has an optical system that <strong>enhances the contrast</strong> of <strong>unstained</strong> bodies.</p>\n<p>Dark ground microscopy is the <strong>most specific and sensitive</strong> technique to diagnose <strong>syphilis</strong> when an active chancre or condyloma lata is present to visualize&nbsp;<em>Treponema pallidum</em>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a57832675e124540906f1a9f5765c107.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the helminth from the life cycle given below.",
    "choices": [
      {
        "id": 1,
        "text": "Ancylostoma duodenale"
      },
      {
        "id": 2,
        "text": "Strongyloides stercoralis"
      },
      {
        "id": 3,
        "text": "Ascaris lumbricoides"
      },
      {
        "id": 4,
        "text": "Enterobius vermicularis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows the life cycle of<em><strong> Strongyloides stercoralis.</strong></em></p>\n<p><em>Strongyloides stercoralis</em> is the <strong>smallest</strong> nematode known to cause human infection. It has both a <strong>free-living</strong> and a <strong>parasitic</strong>\u00a0life cycle. Its natural host is man. The <strong>infective form</strong> to man\u00a0is the <strong>filariform larva. </strong>Infection occurs through penetration of the skin by larvae in the soil. Then, the larvae migrate to the small intestine. They molt twice and become adult female worms in the small intestine. The eggs laid in the mucosa of the intestine hatch immediately releasing the <strong>rhabditiform larva</strong> (L1 stage). Thus, it is <strong>ovoviviparous</strong>. These rhabditiform larvae in the bowel can develop directly into filariform larvae that penetrate the colonic wall or perianal skin and enter the circulation to repeat the migration. This establishes ongoing<strong> internal reinfection.</strong></p>\n<p>The rhabditiform larva can also be passed in the stool. It may directly metamorphose to the infective filariform larva in the soil, or develop into adult worms. The free-living adult worms then pass eggs, which hatch and mature to form infective filariform larvae.\u00a0</p>\n<p>\u00a0In <em>Ancylostoma duodenale</em> infestation, eggs containing <strong>segmented ova </strong>(not rhabditiform larvae) are passed in the stool. The rhabditiform larva hatches 2 days after the eggs are passed in the soil.\u00a0</p>\n<p><strong>Note:</strong> Based on the method of reproduction, nematodes are classified as follows:</p>\n<ol>\n<li><strong>Oviparous</strong> - They lay eggs:\n<ul>\n<li>Unsegmented eggs: <em>Ascaris lumbricoides, Trichuris trichuria</em></li>\n<li>Segmented eggs: \u00a0<em>Ancylostoma duodenale, Necator americanus</em></li>\n<li>Eggs containing larva: <em>Enterobius vermicularis</em></li>\n</ul>\n</li>\n<li><strong>Viviparous</strong> - They produce larvae. e.g., <em>Trichinella spiralis, Wuchereria bancrofti, Brugia malayi</em></li>\n<li><strong>Ovoviviparous</strong> \u2013 They lay eggs containing fully formed larvae that hatch immediately. e.g., <em>Strongyloides stercoralis</em></li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d56d5520329b4aceb6b6e248aabc0b56.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Northern blotting is used for detection of which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "DNA"
      },
      {
        "id": 2,
        "text": "RNA"
      },
      {
        "id": 3,
        "text": "Proteins"
      },
      {
        "id": 4,
        "text": "None"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Northern</strong> <strong>blotting</strong> is used for the detection of RNA.</p>\n<p><strong>Southern</strong> <strong>blotting</strong> is used for the detection of DNA and <strong>Western</strong> <strong>blotting</strong> is used for the detection of protein.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4f45aa909d44abd8abf483d6fee594bx1196x998.PNG"
    ]
  },
  {
    "text": "A cook prepares sandwiches for 10 people going for picnic. Eight out of them develop severe gastroenteritis within 4-6 hrs of consumption of the sandwiches. It is likely that on investigations the cook is found to be the carrier of:",
    "choices": [
      {
        "id": 1,
        "text": "Salmonella typhi"
      },
      {
        "id": 2,
        "text": "Vibrio cholera"
      },
      {
        "id": 3,
        "text": "Entamoeba histolytica"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The cook is most likely to be carrier of Staph. aureus.</p>\n<p>The onset of food poisioning with in 4-6 hrs of food is mainly due to:</p>\n<ul>\n<li>Staphylococcus aureus</li>\n<li>Bacillius cereus (has no carriers)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following image depicts:",
    "choices": [
      {
        "id": 1,
        "text": "Production of monoclonal antibodies"
      },
      {
        "id": 2,
        "text": "Cell lines for viral culture"
      },
      {
        "id": 3,
        "text": "Vaccine synthesis"
      },
      {
        "id": 4,
        "text": "Process of genetic engineering"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts the production of <strong>monoclonal antibodies</strong> by<strong> hybridoma technology</strong>.</p>\n<p>The following are the <strong>steps</strong> involved in hybridoma technology:</p>\n<ul>\n<li><strong>Mice</strong> are <strong>immunized</strong> with an antigen. After several weeks of immunization, blood samples are obtained from mice for measurement of serum antibodies.</li>\n<li>When the antibody titer is high enough, mice are commonly boosted by injecting antigen, without adjuvant, intraperitoneally or intravenously. Then the mice are euthanized and their <strong>spleens removed</strong> for in vitro hybridoma cell production.</li>\n<li><strong>Fusing antibody-producing spleen cells</strong>, which have a limited life span, with <strong>myeloma cells</strong> (derived from an immortal tumor of lymphocytes) results in a <strong>hybridoma</strong> that is capable of unlimited growth.</li>\n<li>The cells are <strong>cultured</strong> in a medium containing hypoxanthine, aminopterin, and thymidine <strong>(HAT medium)</strong>\u00a0which allows only the fused cells to survive in culture.</li>\n<li><strong>Monoclonal antibodies</strong> are then <strong>harvested.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fa2e954137ea466d8cea79c8c9da21a6.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3bebd319c7d4675a652de0a07077b66x1280x1423.JPEG"
    ]
  },
  {
    "text": "A patient has complains of fever with chills. A throat examination reveals swollen glands and a thick, whitish membrane over his tonsils. Albert staining is to be done. What are the constituents of Albert's stain?",
    "choices": [
      {
        "id": 1,
        "text": "Carbol fuschin and methylene blue"
      },
      {
        "id": 2,
        "text": "Carbol fuschin and malachite green"
      },
      {
        "id": 3,
        "text": "Toluidine and malachite green"
      },
      {
        "id": 4,
        "text": "Toluidine and methylene blue"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario is suggestive of <strong>diphtheria</strong> caused by <strong><em>Corynebacterium diphtheria</em></strong>. This organism is stained using <strong>Albert's stain</strong> which contains <strong>toluidine blue 'O'</strong> and <strong>malachite green.\u00a0</strong>Both these dyes\u00a0have an affinity for acidic cytoplasm as they are basic dyes.</p>\n<p>Albert\u2019s, Neisser\u2019s, and Ponder\u2019s stain are used to demonstrate the <strong>metachromatic granules</strong>(Volutin / Babes Ernst granules) of <em>Corynebacterium diphtheria</em>.</p>\n<p><em>Corynebacterium diphtheria </em>appears as green-coloured bacilli with purple-blue-coloured metachromatic granules in <strong>cuneiform</strong> arrangement.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d6225a1ac1242b2b91995eff21c5051x510x465.GIF"
    ]
  },
  {
    "text": "Which of the following infection presents with mucus in stools and abdominal pain?",
    "choices": [
      {
        "id": 1,
        "text": "Giardia"
      },
      {
        "id": 2,
        "text": "Entamoeba"
      },
      {
        "id": 3,
        "text": "Campylobacter"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Stools with mucus and abdominal pain are seen in infection due to <strong>Entamoeba.</strong></p>\n<p><strong>Clinical features of intestinal amebiasis:</strong></p>\n<ul>\n<li>Acute intestinal amebiasis presents as dysentery accompanied by lower abdominal discomfort and flatulence. Stools usually have blood and mucus.</li>\n<li>Chronic amebiasis presents with low-grade symptoms such as occasional diarrhea, weight loss, and fatigue.</li>\n<li>A granulomatous lesion called an ameboma may form in the cecal or rectosigmoid areas of the colon which can resemble an adenocarcinoma of the colon.</li>\n</ul>\n<p><strong>Other options:\u00a0</strong></p>\n<p>Option a - Giardia is often asymptomatic, but in some cases can lead to fat malabsorption, dull epigastric pain, and flatulence.</p>\n<p>Option c - Campylobacter presents with fever, pain and bloody or watery diarrhea. Stool contains leucocytes and blood.</p>\n<p>Option d - Staphylococcal food poisoning is toxin-mediated and presents with nausea, vomiting, and diarrhea.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient's plasma has high levels of interferon beta. He most likely has an infection due to _____",
    "choices": [
      {
        "id": 1,
        "text": "Virus"
      },
      {
        "id": 2,
        "text": "Bacteria"
      },
      {
        "id": 3,
        "text": "Fungi"
      },
      {
        "id": 4,
        "text": "Mycoplasma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Interferon-beta</strong> is secreted during infection due to <strong>viruses.</strong>\u00a0</p>\n<p>Interferons are classified as cytokines. Interferons are non-toxic, non-antigenic and species-specific molecules. They are inactivated by proteases. They are stable at pH over 2-10, except INF-\u03b3 (labile at pH 2) and are non-dialysable and non-sedimentable.</p>\n<p>There are three types of interferons - \u03b1, \u03b2 and \u03b3.<strong>\u00a0IFN-\u03b1</strong> or leukocyte interferon is produced by leucocytes. It has antiviral activity, is immunoregulaotry and antiproliferative.<strong>\u00a0IFN-\u03b2</strong> or fibroblast interferon is produced by fibroblasts and epithelial cells. It has antiviral activity and is thus increased in viral infections. It enhances MHC class 1 and NK cell activity.\u00a0<strong>IFN-\u03b3 </strong>or immune interferon is produced by T-lymphocytes, NK cells . It activates macrophages, increases neutrophil function, enhances both MHC class 1 and class II expression and has anti-proliferative (anti-tumour) functions.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most potent stimulator of naive T-cells?",
    "choices": [
      {
        "id": 1,
        "text": "Mature dendritic cells"
      },
      {
        "id": 2,
        "text": "Follicular dendritic cells"
      },
      {
        "id": 3,
        "text": "B lymphocytes"
      },
      {
        "id": 4,
        "text": "NK cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Mature dendritic cells</strong> are the <strong>most potent stimulator</strong> of<strong> naive T cells.</strong></p>\n<p>Naive CD4<sup>+</sup> T cells are activated when they come in contact with two ligands - MHC class II and a costimulary membrane protein (eg: CD28). Both of these are present in <strong>antigen-presenting cells</strong>, the most potent of which is the mature dendritic cell. Other professional antigen-presenting cells include macrophages and B lymphocytes (option C).</p>\n<p>Other options:</p>\n<p>Option B: <strong>Follicular dendritic cells</strong>\u00a0are functionally different from dendritic cells. They are not antigen-presenting-cells and\u00a0do not activate naive T cells.</p>\n<p>Option D: NK cells do not stimulate naive T cells.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/10226498d4f14accbc321452d6f3d620x1280x1839.JPEG"
    ]
  },
  {
    "text": "Which of the following is an immunologically privileged site?",
    "choices": [
      {
        "id": 1,
        "text": "Seminiferous tubule"
      },
      {
        "id": 2,
        "text": "Area postrema"
      },
      {
        "id": 3,
        "text": "Optic nerve"
      },
      {
        "id": 4,
        "text": "Loop of Henle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The<strong>\u00a0seminiferous tubules</strong>\u00a0are an<strong> </strong>immunologically privileged site.</p>\n<p>Immunologically privileged sites can tolerate the introduction of antigens without eliciting an immune response. This allows a higher likelihood of graft survival, even without perfect HLA matching. As a result, an allograft can be placed in these sites without endangering a rejection reaction.</p>\n<p>The unique immune tolerance in these regions is primarily due to the lack of effective lymphatic drainage, which prevents antigen presentation to the immune system, and the presence of blood-tissue barriers that restrict immune cell infiltration. Low vascularity contributes to immune privilege by minimising antigen exposure and immune cell recruitment.\u00a0</p>\n<p>Examples of immune-privileged sites are the anterior chamber of the eye, cornea, testes, and brain.\u00a0</p>\n<p>Note: Although part of the brain, the blood-brain barrier is absent at the area postrema, therefore it is not an immune-privileged site.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Bone marrow aspirate of a patient shows the following features. Which of the following is true?",
    "choices": [
      {
        "id": 1,
        "text": "Buffy coat is used to diagnose the parasite"
      },
      {
        "id": 2,
        "text": "It is an obligate extracellular parasite"
      },
      {
        "id": 3,
        "text": "It is transmitted from sheep"
      },
      {
        "id": 4,
        "text": "Stibogluconate is the first line of treatment in India."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image shows<strong>&nbsp;the amastigote form of leishmaniasis</strong> located intracellularly in macrophages. <strong>Buffy coat is used to diagnose the parasite.</strong></p>\n<p>Visceral leishmaniasis (kala-azar) is a slowly progressing indigenous disease caused by a protozoan parasite of genus Leishmania. Leishmaniasis is a parasitic disorder transmitted by the bite of an infected female Phlebotomus sandfly in developing countries. The disease is transmitted by sand flies, which inoculate the flagellated promastigotes into the skin of the host.</p>\n<p>In human beings, the disease presents in four different forms with a broad range of clinical manifestation:</p>\n<ul>\n<li>Visceral leishmaniasis, or kala-azar,</li>\n<li>Cutaneous leishmaniasis,</li>\n<li>Mucocutaneous leishmaniasis, and</li>\n<li>Diffuse cutaneous leishmaniasis.</li>\n</ul>\n<p>The life cycle of Leishmania involves two forms,</p>\n<ul>\n<li>The promastigote which develops and lives extracellularly in the sandfly vector and</li>\n<li>The amastigote which multiplies intracellularly in the reticuloendothelial cells of the host.</li>\n</ul>\n<p>It lowers immunity, causes persistent fever, anemia, liver and spleen enlargement, and if left untreated, death may occur due to opportunistic infection.</p>\n<p><strong>Diagnosis:</strong></p>\n<ul>\n<li>Rapid diagnostic test: rK39 Rapid diagnostic test and Kala azar dipstick test strip.</li>\n<li>Parasitological diagnosis: Demonstration of LD bodies in buffy coat smear - confirmatory.</li>\n<li>Aldehyde test of Napier: Widely used for surveillance.</li>\n<li>Serological tests for diagnosis: Rapid dipstick test, Direct agglutination test, ELISA, Indirect Fluorescent Antibody Test</li>\n<li>Leishmanin (Montenegro) test: Induration of 5mm or more is considered positive, usually positive 4-6 weeks after onset in cutaneous leishmaniasis, valuable for distinguishing immune from nonimmune subjects and endemicity.</li>\n</ul>\n<p>Drugs used in the treatment of visceral leishmaniasis are sodium stibogluconate, miltefosine, and amphotericin. Liposomal amphotericin single dose 10mg/Kg IV is the first line of treatment in India.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ebb8097935bb4294b1da181fb632e4c6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following drugs is not used for typhoid fever in adults?",
    "choices": [
      {
        "id": 1,
        "text": "Azithromycin"
      },
      {
        "id": 2,
        "text": "Ciprofloxacin"
      },
      {
        "id": 3,
        "text": "Ceftriaxone"
      },
      {
        "id": 4,
        "text": "Amikacin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<table style=\"height: 252px; width: 527px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 456.836px; height: 36px; text-align: center;\" colspan=\"4\"><strong>Antibiotic therapy for enteric fever in adults</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 106.25px; height: 36px;\"><strong>Indication</strong></td>\n<td style=\"width: 162.383px; height: 36px;\"><strong>Agent</strong></td>\n<td style=\"width: 87.9297px; height: 36px;\"><strong>Dosage (Route)</strong></td>\n<td style=\"width: 100.273px; height: 36px;\"><strong>Duration, Days</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 456.836px; height: 18px;\" colspan=\"4\"><strong>Empirical Treatment</strong></td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 106.25px; height: 77px;\" rowspan=\"2\">\u00a0\u00a0</td>\n<td style=\"width: 162.383px; height: 35px;\">Ceftriaxone</td>\n<td style=\"width: 87.9297px; height: 35px;\">2 g/d (IV)</td>\n<td style=\"width: 100.273px; height: 35px;\">10-14</td>\n</tr>\n<tr style=\"height: 42px;\">\n<td style=\"width: 162.383px; height: 42px;\">Azithromycin</td>\n<td style=\"width: 87.9297px; height: 42px;\">1 g/d (PO)</td>\n<td style=\"width: 100.273px; height: 42px;\">5</td>\n</tr>\n<tr style=\"height: 22px;\">\n<td style=\"width: 456.836px; height: 22px;\" colspan=\"4\"><strong>Fully Susceptible</strong></td>\n</tr>\n<tr style=\"height: 8px;\">\n<td style=\"width: 106.25px; height: 74px;\" rowspan=\"2\">\n<p>\u00a0</p>\n<p>Optimal treatment</p>\n</td>\n<td style=\"width: 162.383px; height: 8px;\">\n<p>Ciprofloxacin</p>\n</td>\n<td style=\"width: 87.9297px; height: 8px;\">\n<p>500 mg bid (PO) or 400 mg q12 h (IV)</p>\n</td>\n<td style=\"width: 100.273px; height: 8px;\">\n<p>5-7</p>\n</td>\n</tr>\n<tr style=\"height: 66px;\">\n<td style=\"width: 162.383px; height: 66px;\">\n<p>Azithromycin</p>\n</td>\n<td style=\"width: 87.9297px; height: 66px;\">\n<p>1 g/d (PO)</p>\n</td>\n<td style=\"width: 100.273px; height: 66px;\">\n<p>5</p>\n</td>\n</tr>\n<tr style=\"height: 8px;\">\n<td style=\"width: 106.25px; height: 57px;\" rowspan=\"3\">\n<p>\u00a0</p>\n<p>Alternative treatment</p>\n<p>\u00a0</p>\n</td>\n<td style=\"width: 162.383px; height: 8px;\">\n<p>Amoxicillin</p>\n</td>\n<td style=\"width: 87.9297px; height: 8px;\">\n<p>1 g tid (PO) or 2 g q6h (IV)</p>\n</td>\n<td style=\"width: 100.273px; height: 8px;\">\n<p>14</p>\n</td>\n</tr>\n<tr style=\"height: 8px;\">\n<td style=\"width: 162.383px; height: 8px;\">\n<p>Chloramphenicol</p>\n</td>\n<td style=\"width: 87.9297px; height: 8px;\">\n<p>25 mg/kg tid (PO or IV)</p>\n</td>\n<td style=\"width: 100.273px; height: 8px;\">\n<p>14-21</p>\n</td>\n</tr>\n<tr style=\"height: 41px;\">\n<td style=\"width: 162.383px; height: 41px;\">\n<p>Trimethoprim-sulfamethoxazole</p>\n</td>\n<td style=\"width: 87.9297px; height: 41px;\">\n<p>160/800 mg bid (PO)</p>\n</td>\n<td style=\"width: 100.273px; height: 41px;\">\n<p>7-14</p>\n</td>\n</tr>\n<tr style=\"height: 29px;\">\n<td style=\"width: 456.836px; height: 29px;\" colspan=\"4\"><strong>Multidrug-resistant, fluroquinolone-susceptible</strong></td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 106.25px; height: 62px;\" rowspan=\"2\">\n<p>Optimal treatment</p>\n</td>\n<td style=\"width: 162.383px; height: 19px;\">\n<p>Ceftriaxone</p>\n</td>\n<td style=\"width: 87.9297px; height: 19px;\">\n<p>2 g/d (IV)</p>\n</td>\n<td style=\"width: 100.273px; height: 19px;\">\n<p>10-14</p>\n</td>\n</tr>\n<tr style=\"height: 43px;\">\n<td style=\"width: 162.383px; height: 43px;\">\n<p>Azithromycin</p>\n</td>\n<td style=\"width: 87.9297px; height: 43px;\">\n<p>1 g/d (PO)</p>\n</td>\n<td style=\"width: 100.273px; height: 43px;\">\n<p>5</p>\n</td>\n</tr>\n<tr style=\"height: 81px;\">\n<td style=\"width: 106.25px; height: 81px;\">\n<p>Alternative treatment</p>\n</td>\n<td style=\"width: 162.383px; height: 81px;\">\n<p>Ciprofloxacin</p>\n</td>\n<td style=\"width: 87.9297px; height: 81px;\">\n<p>500 mg bid (PO) or 400 mg q12h (IV)</p>\n</td>\n<td style=\"width: 100.273px; height: 81px;\">\n<p>5-14</p>\n</td>\n</tr>\n<tr>\n<td colspan=\"4\"><strong>Quinolone-resistant</strong></td>\n</tr>\n<tr style=\"height: 52px;\">\n<td style=\"width: 106.25px; height: 54px;\" rowspan=\"2\">Optimal treatment</td>\n<td style=\"width: 162.383px; height: 52px;\">Ceftriaxone</td>\n<td style=\"width: 87.9297px; height: 52px;\">\u00a02 g/d (IV)</td>\n<td style=\"width: 100.273px; height: 52px;\">\u00a010-14</td>\n</tr>\n<tr style=\"height: 2px;\">\n<td style=\"width: 162.383px; height: 2px;\">Azithromycin</td>\n<td style=\"width: 87.9297px; height: 2px;\">\n<p>1 g/d (PO)</p>\n</td>\n<td style=\"width: 100.273px; height: 2px;\">\n<p>5</p>\n</td>\n</tr>\n<tr style=\"height: 67.8001px;\">\n<td style=\"width: 106.25px; height: 67.8001px;\">Alternative treatment</td>\n<td style=\"width: 162.383px; height: 67.8001px;\">High dose ciprofloxacin</td>\n<td style=\"width: 87.9297px; height: 67.8001px;\">\n<p>750 mg bid (PO) or 400 mg q12h (IV)</p>\n</td>\n<td style=\"width: 100.273px; height: 67.8001px;\">\n<p>10-14</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 456.836px;\" colspan=\"4\"><strong>Ceftriaxone-resistant</strong></td>\n</tr>\n<tr>\n<td style=\"width: 106.25px;\" rowspan=\"2\">Optimal treatment</td>\n<td style=\"width: 162.383px;\">Meropenem</td>\n<td style=\"width: 87.9297px;\">1 g q8h (IV)</td>\n<td style=\"width: 100.273px;\">10-14</td>\n</tr>\n<tr>\n<td style=\"width: 162.383px;\">Azithromycin</td>\n<td style=\"width: 87.9297px;\">1 g/d (PO)</td>\n<td style=\"width: 100.273px;\">5</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '062 Microbiology Aiims 2018';
        let hierarchy = ["Marrow", "PYQs", "Microbiology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>