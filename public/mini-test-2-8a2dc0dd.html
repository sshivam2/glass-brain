<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 2 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which among the following does the graph given below depict?",
    "choices": [
      {
        "id": 1,
        "text": "Bohr effect"
      },
      {
        "id": 2,
        "text": "Henry's law in respiration"
      },
      {
        "id": 3,
        "text": "Haldane effect"
      },
      {
        "id": 4,
        "text": "Boyle's law"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The graph given above depicts the <strong>Haldane effect.</strong></p>\n<p>The binding of O2 with hemoglobin tends to displace CO2 from the blood. This is known as the Haldane effect. It helps in the transport of CO2 from the tissues to the lungs. The graph shows small portions of two CO2 dissociation curves:</p>\n<ul>\n<li>When the PO2 is 100 mm Hg, which is the case in the <strong>blood capillaries</strong> of the lungs.</li>\n<li>When the PO2 is 40 mm Hg, which is the case in the <strong>tissue capillaries</strong>.</li>\n</ul>\n<p>At the <strong>normal PCO2 </strong>of 45 mm Hg in the tissues represented by <strong>point A, </strong>52 volume percent of CO2 combines with the blood. Upon entering the lungs, the PCO2 falls to 40 mm Hg and the PO2 rises to 100 mm Hg. The<strong> increase in PO2</strong> shifts the CO2 dissociation curve from the top curve to the lower curve, so the <strong>CO2 content falls</strong> to <strong>point B. </strong></p>\n<p>Thus, the Haldane effect approximately doubles the amount of CO2 released from the blood in the lungs and the amount picked up by the tissues.</p>\n<p>(Remember - Ha<strong>L</strong>dane effect occurs in&nbsp;<strong>L</strong>ungs and causes&nbsp;<strong>L</strong>eft shift of O2-Hb dissociation curve)</p>\n<p>Other options:</p>\n<p>Option A:&nbsp;<strong>Bohr effect:</strong> A right shift of the oxygen-hemoglobin dissociation curve in response to an increase in blood CO2 and hydrogen ions, enhances the release of O2 from the blood in the tissues. This enhances the oxygenation of the blood in the lungs.</p>\n<p>Option B:&nbsp;<strong>Henry's Law</strong> in <strong>Respiration: </strong>The amount of oxygen that dissolves into the bloodstream is directly proportional to the partial pressure of oxygen in alveolar air.</p>\n<p>Option D: Boyle's <strong>Law</strong>: The pressure of a fixed mass of <strong>gas</strong> is inversely proportional to its volume if its temperature is kept constant.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/077df98566fa4a319fbd2e1e8cc4a775.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old male was planned for an elective open inguinal hernia repair. The patient also had a history of heart surgery 8 months back with the placement of a drug-eluting stent and currently on dual antiplatelet therapy. When should this anti-platelets be stopped before the current elective surgery?",
    "choices": [
      {
        "id": 1,
        "text": "Stopped 2 weeks before surgery"
      },
      {
        "id": 2,
        "text": "Stopped 1 week before surgery"
      },
      {
        "id": 3,
        "text": "Stopped 1 day before surgery"
      },
      {
        "id": 4,
        "text": "Need not to be stopped"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The antiplatelets are not be stopped in patients with <strong>d</strong><strong>rug-eluting stents</strong> until they have completed <strong>12 months</strong> of dual antiplatelet therapy.</p>\n<p>Similarly, the antiplatelets are not discontinued in the patients with<strong> bare-metal stents</strong>\u00a0until they have completed <strong>1 month</strong> of dual antiplatelet therapy.</p>\n<p>Note:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Antiplatelets</strong></td>\n<td><strong>Waiting period</strong></td>\n</tr>\n<tr>\n<td>Ticlopidine</td>\n<td>14 days</td>\n</tr>\n<tr>\n<td>Clopidogrel</td>\n<td>7 days</td>\n</tr>\n<tr>\n<td>Abciximab</td>\n<td>48 hour</td>\n</tr>\n<tr>\n<td>Eptifibatide</td>\n<td>8 hour</td>\n</tr>\n</tbody>\n</table>\n<div class=\"layoutArea\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following image depicts a biotechnology process. Choose the false statement regarding it.",
    "choices": [
      {
        "id": 1,
        "text": "Hybrid cells lack the enzyme hypoxanthine phosphoribosyl transferase"
      },
      {
        "id": 2,
        "text": "Specific antibody-producing cells are integrated with myeloma cells"
      },
      {
        "id": 3,
        "text": "Hybrid cells are cultured in HAT medium"
      },
      {
        "id": 4,
        "text": "Monoclonal antibodies are produced"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image depicts the production of <strong>monoclonal antibodies</strong> by<strong> hybridoma technology</strong>.&nbsp;<strong>Myeloma cells</strong>&nbsp;(not hybrid cells) are <strong>deficient</strong> in the enzyme HPRT (Hypoxanthine phosphoribosyl transferase).</p>\n<p><strong>Monoclonal antibodies</strong>&nbsp;refer to the antibodies produced by a group of lymphocytes that produce antibodies against a single antigen. These antibodies are produced by <strong>hybridoma technology.&nbsp;</strong></p>\n<p>In this technology, the <strong>B-lymphocytes</strong> of mice spleen are immunized with an antigen to produce specific antibody. These specific antibody-producing B lymphocytes are then fused with <strong>myeloma cells</strong> that can multiply indefinitely.</p>\n<p>The myeloma cells are <strong>deficient</strong> in the hypoxanthine-guanine-phosphoribosyltransferase <strong>(HGPRT) gene</strong> and do not produce immunoglobulins. Therefore, the resulting hybrid cell is producing antibodies against a single antigen indefinitely. These hybrid cells are cultured in a&nbsp;<strong>HAT medium</strong> (containing hypoxanthine, aminopterin, and thymidine) and the <strong>monoclonal antibodies</strong> are obtained.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e847677d329b488b9509e4c92ed90e21.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58ad7b35fb474d5da75002501c78702fx1280x2037.JPEG"
    ]
  },
  {
    "text": "A 53-year-old male patient was admitted to the emergency department following a road traffic accident. On examination, paradoxical respiration was seen. His chest X-ray is shown below. He was given analgesics and oxygen was administered via face mask but he developed respiratory failure. What is the best line of management of this case?",
    "choices": [
      {
        "id": 1,
        "text": "Chest tube drainage"
      },
      {
        "id": 2,
        "text": "Intrapleural analgesia"
      },
      {
        "id": 3,
        "text": "Mechanical Ventilation"
      },
      {
        "id": 4,
        "text": "Surgical fixation of the fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario alongwith the X-ray showing contiguous rib fractures on the right side suggest Flail chest.</p>\n<p>Flail chest is characterized by <strong>contiguous rib fractures</strong> and <strong>paradoxical respiration</strong>\u00a0following blunt trauma to the chest wall. Mechanical ventilation (like Intermittent Positive Pressure Ventilation) is the management of flail chest with respiratory failure.</p>\n<p><strong>Flail Chest :</strong></p>\n<ul>\n<li>A flail chest occurs when a segment of the chest wall does not have bony continuity with the rest of the thoracic cage.</li>\n<li>This condition results from blunt trauma associated with multiple rib fractures, i.e. <strong>2 adjacent ribs or</strong>\u00a0<strong>3\u00a0or more ribs fractured in two or more places</strong>.</li>\n<li>The blunt force required to disrupt the integrity of the thoracic cage typically produces an <strong>underlying pulmonary contusion </strong>as well.</li>\n</ul>\n<p><strong>Clinical Features:</strong></p>\n<p><strong>On inspiration,\u00a0</strong>the <strong>loose segment </strong>of the chest wall is <strong>displaced inwards </strong>and less air, therefore, moves into the lungs. On expiration, the segment moves outwards(<strong>paradoxical respiration</strong>).</p>\n<p><strong>Diagnosis - </strong>To confirm the diagnosis the chest wall can be observed for the paradoxical motion of a chest wall segment for several respiratory cycles and during coughing. Voluntary splinting as a result of pain, mechanically impaired chest wall movement, and the associated lung contusion are all causes of hypoxia and respiratory failure.</p>\n<p>The patient is also at high risk of developing a <strong>pneumothorax </strong>or <strong>hemothorax.</strong></p>\n<p><strong>Treatment</strong></p>\n<ul>\n<li><strong>Chest strapping </strong>or splinting should be<strong> avoided</strong></li>\n<li>Currently, treatment consists of <strong>oxygen administration</strong>, <strong>adequate analgesia </strong>(including opiates) or <strong>epidural analgesia </strong>and <strong>physiotherapy.</strong></li>\n<li><strong>IPPV (Intermittent Positive Pressure Ventilation) </strong>is reserved for cases developing <strong>respiratory failure</strong> despite adequate analgesia and oxygen.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b1c7227533614712bb5af8f07b8e312b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A male patient presented with complaints of weakness, weight loss, diarrhea, oily stools, and joint pain for about 6 months.  A diagnosis of malabsorption syndrome was suspected. A duodenal biopsy was done, and the findings are given below. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Whipple's disease"
      },
      {
        "id": 2,
        "text": "Celiac disease"
      },
      {
        "id": 3,
        "text": "Tropical sprue"
      },
      {
        "id": 4,
        "text": "Small-bowel bacterial overgrowth"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a patient with <strong>diarrhea, weight loss,</strong>\u00a0and chronic <strong>arthralgia</strong> and the given slide showing<strong> macrophages filled with PAS-positive inclusions</strong> points to a diagnosis of<strong> Whipple's disease</strong>.</p>\n<p>Whipple's disease is a <strong>multi-system disease</strong> caused by infection with <strong>gram-positive bacillus</strong>\u00a0<em><strong>Tropheryma whipplei</strong></em>. Clinical features include <strong>arthralgia</strong> and arthritis, abdominal pain, <strong>diarrhea,</strong> and weight loss. <strong>Arthralgias</strong> and arthritis are present for many years <strong>before</strong> the appearance of <strong>GI symptoms</strong>. CNS involvement is common and presents as <strong>psychiatric</strong> <strong>manifestations</strong>, memory problems, or <strong>ophthalmoplegia</strong>. Dementia may occur in later stages. Cardiac involvement may be in the form of <strong>endocarditis</strong>, <strong>myocarditis,</strong> and <strong>pericarditis</strong>. <strong>Hyperpigmentation</strong> in sun-exposed areas may also be seen. Intermittent <strong>low-grade fever</strong> is present in most of the patients.</p>\n<p>The diagnosis of Whipple's disease is primarily established by <strong>endoscopic biopsy</strong> and histological evaluation. Infiltration of <strong>lamina propria</strong> with <strong>PAS-positive macrophages containing the bacilli</strong> is diagnostic. The remainder of the cases are diagnosed by <strong>PCR,</strong> which can be done on duodenal biopsies or fluids (such as <strong>CSF</strong> and synovial fluid) or tissues.</p>\n<p>The treatment regimen for Whipple's disease is <strong>ceftriaxone or meropenem</strong> for <strong>2 weeks</strong>, followed by <strong>trimethoprim-sulfamethoxazole for 12 months</strong>. Prolonged antibiotics are recommended, but there is still uncertainty prevailing regarding the optimal regimen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d84f500313914387828a6c91a563a52f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8c19474661754bbebcb0d28373fe4759x1280x1574.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/36002a4157b64614bab30ac9176882e9x1280x854.JPEG"
    ]
  },
  {
    "text": "Which of the following type of interactions is responsible for the stability of the following structure shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Van der Waal interactions"
      },
      {
        "id": 2,
        "text": "Hydrogen bonds"
      },
      {
        "id": 3,
        "text": "Hydrophobic interactions"
      },
      {
        "id": 4,
        "text": "Ionic interactions"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image represents a\u00a0<strong>beta-sheet</strong>\u00a0which is a\u00a0<strong>secondary structure</strong>\u00a0of proteins. They owe their stability to <strong>hydrogen bonds</strong> formed between two adjacent beta-sheets.</p>\n<p>Proteins are arranged in the following four structures:</p>\n<ul>\n<li><strong>Primary</strong>\n<ul>\n<li>The\u00a0<strong>sequence of amino acids</strong>\u00a0in a protein is called a primary structure.</li>\n</ul>\n</li>\n<li><strong>Secondary</strong>\n<ul>\n<li>The\u00a0<strong>folding</strong>\u00a0of short contiguous polypeptide sequences into geometrically ordered units.</li>\n<li><strong>Alpha helix</strong>\u00a0and\u00a0<strong>beta sheets\u00a0</strong>are examples of secondary structure.\n<ul>\n<li>Alpha helix - It\u00a0is the most common and stable secondary structure as a result of hydrogen bonds, supplemented by Van der Waal interactions.</li>\n<li>Beta-sheets -\u00a0They derive their stability from hydrogen bonds between the carbonyl oxygens and amide hydrogens of peptide bonds between adjacent sheets.</li>\n</ul>\n</li>\n<li>Hydrogen bonds play an important role in the maintenance of the secondary structure.</li>\n<li>Of this, beta sheets are represented as broad arrows, with the carboxy-terminal of the polypeptide chain at the tip of the arrow.</li>\n</ul>\n</li>\n<li>\u00a0<strong>Tertiary</strong>\n<ul>\n<li>This refers to the\u00a0<strong>folding and final arrangement of domains in a polypeptide structure</strong>. In this, hydrophobic side chains are buried in the core whereas hydrophilic side chains are freely exposed.</li>\n<li>An example of a tertiary structure is <strong>domain. </strong>These\u00a0are the areas/structures of a protein that are capable of performing a particular chemical or physical task, for example, binding to a molecule, acting as a receptor, etc.\u00a0</li>\n<li><strong>Disulfide bonds, hydrophobic interactions, hydrogen bonds, and ionic interactions</strong> account for the stability of the structure.</li>\n</ul>\n</li>\n<li>\u00a0<strong>Quaternary</strong>\n<ul>\n<li>It is the arrangement of\u00a0<strong>different polypeptide subunits</strong>\u00a0in a protein</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/17e1bd1fac6047ab85d490150b18308c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0d07f51c74534bef9de017634655e8fex800x1065.JPEG"
    ]
  },
  {
    "text": "A 24-year old male patient  presented with a painful and swollen right thumb following a fall on an outstretched hand with his thumb extended. The X-ray image of his right thumb is shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Bennett fracture"
      },
      {
        "id": 2,
        "text": "Rolando fracture"
      },
      {
        "id": 3,
        "text": "Gamekeeper's thumb"
      },
      {
        "id": 4,
        "text": "Epibasal thumb fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The X-ray shows the <strong>avulsion fracture </strong>of the ulnar <strong>base of the proximal phalanx of the thumb</strong>, known as <strong>Gamekeeper&rsquo;s fracture.</strong></p>\n<p><strong>A gamekeeper thumb</strong>, also known as <strong>skier&rsquo;s thumb</strong> is an injury to the ulnar collateral ligament (UCL) of the first metacarpophalangeal joint. The UCL may get ruptured or avulsed from its site of insertion on the base of the proximal phalanx. Sometimes, a small fragment of the bone may be pulled off during the injury.</p>\n<p>Injury is usually caused by a<strong> fall on an outstretched hand</strong> with radial and palmar abduction.</p>\n<p>Patients present with pain, swelling, and ecchymosis around the first metacarpophalangeal joint.</p>\n<p>Diagnosis can be made on plain radiographs and/or anteroposterior stress radiographs.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0fae3175ee52498b97badf6fd5850a58.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/902a9b87ecd1411d8b2d0e57b8451b83x1280x1665.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e85f86e814e4466ea57212f50ccdd3a4x1280x1664.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ecdcc3238b6843e3bd7bfbe8d8ccb239x1279x1635.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5821d5be2fa4094b9eac74d26764f5cx1280x2558.JPEG"
    ]
  },
  {
    "text": "The given image shows the various curves obtained for three different screening tests (A, B, C) employed on a population. Which of the following represents the correct match with respect to the Receiver-Operator-Curve (ROC) obtained in each of them?",
    "choices": [
      {
        "id": 1,
        "text": "A \u2013 3, B \u2013 1, C \u2013 2"
      },
      {
        "id": 2,
        "text": "A \u2013 2, B \u2013 1, C \u2013 3"
      },
      {
        "id": 3,
        "text": "A \u2013 1, B \u2013 2, C \u2013 3"
      },
      {
        "id": 4,
        "text": "A \u2013 1, B \u2013 3, C \u2013 2"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct match is A &ndash; 2, B &ndash; 1, C &ndash; 3.</p>\n<p>The curves obtained mean the following:</p>\n<ul>\n<li>A &ndash; There are some false negatives and some false positives as shown below. Therefore, the area under the curve is around 0.7 to 0.8. The ROC curve would thus be as shown in Image 2.</li>\n<li>B &ndash; There are almost nil false positives or negatives. The test completely differentiates between healthy and diseased. Thus, the area under the ROC would be close to 0.9 to 1 as shown in Image 1.</li>\n<li>C &ndash; The test does not differentiate between healthy and diseased people at all. The area under the curve for such tests would be 0.5 as represented by Image 3.</li>\n</ul>\n<p>Note:</p>\n<p>The&nbsp;<strong>ROC curve</strong>&nbsp;is a fundamental tool for diagnostic test evaluation. In a ROC curve the true positive rate (Sensitivity) is plotted in function of the false positive rate (100-Specificity) for different cut-off points of a parameter. Each point on the ROC curve represents a sensitivity/specificity pair corresponding to a particular decision threshold. The area under the ROC curve (<abbr title=\"Area Under Curve\">AUC</abbr>) is a measure of how well a parameter can distinguish between two diagnostic groups (diseased/normal).</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/806c4e0927e7457596cff4a278759025.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77e18c6d1ec9488ea8481735aac5dc1dx460x1339.PNG"
    ]
  },
  {
    "text": "A 26-year-old woman presented with infertility, and a cervical mucus study was performed on the 24th day of her menstrual cycle (she has a regular 28 days cycle). Which of the following is not true regarding the interpretation of the findings shown in this test?",
    "choices": [
      {
        "id": 1,
        "text": "This finding is due to the presence of sodium chloride in the mucus."
      },
      {
        "id": 2,
        "text": "This phenomenon occurs under the influence of estrogen."
      },
      {
        "id": 3,
        "text": "This test indicates that ovulation has occurred in this patient."
      },
      {
        "id": 4,
        "text": "Corpus luteum is absent during this time of her cycle."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows a specimen of dried cervical mucus with<strong>\u00a0ferning.\u00a0</strong>It occurs under the influence of <strong>estrogen.</strong>\u00a0The <strong>persistence</strong> of ferning beyond day 22 indicates\u00a0<strong>anovulation.</strong> In this patient,\u00a0<strong>ferning is present on the 24th day,\u00a0</strong>which indicates that her cycles are<strong> anovulatory.</strong></p>\n<p><strong>Fern test:</strong></p>\n<p>A drop of cervical mucus is spread and dried on a glass slide and observed under the low-power microscope.\u00a0</p>\n<p>In the <strong>preovulatory</strong> (estrogenic) phase, a characteristic pattern of fern formation is observed due to the presence of <strong>sodium chloride</strong> in the mucus secreted under the estrogenic effect.</p>\n<p>Following ovulation, <strong>ferning disappears</strong> due to <strong>progesterone</strong> activity. The disappearance of ferning is presumptive evidence of corpus luteum activity.</p>\n<p><strong>Insler</strong> devised a scoring system by just taking into account various properties of cervical mucus such as amount, ferning, and viscosity as an <strong>inexpensive test of ovulation.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4afe5cbf12ca4ab891c36529eae816a9.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image shows the inferior surface of the liver. Which lobe of the liver marked below forms the superior boundary of the epiploic foramen?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>caudate lobe</strong> of the liver forms the <strong>superior boundary</strong> of the <strong>epiploic foramen</strong>. The lobe marked as '<strong>3'</strong>&nbsp;in the above image represents the&nbsp;<strong>caudate lobe.</strong></p>\n<p>The caudate lobe is visible as a prominence on the inferior and posterior surfaces of the liver. It lies <strong>posterior to the porta hepatis</strong> and to its right is the groove for the inferior vena cava.</p>\n<p>The caudate lobe of the liver has a portal blood supply and hepatic vein drainage independent of the remainder of the liver.</p>\n<p>&nbsp;Other markings:</p>\n<p><strong>1</strong>- Quadrate lobe</p>\n<p><strong>2</strong>- Left Lobe&nbsp;</p>\n<p><strong>4</strong>- Right lobe&nbsp;</p>\n<p>Shown below are 2 views of the visceral surface of the liver -</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/787d004158e643f88ff8853acfb3b243.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b42454585fb04bc980147adf08f66f09x960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ffbf4d7c50fe417fa8ff4e41ab48c1acx1280x1086.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d34980c0e2043e090abbc6f3e9df7a1x1279x1333.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8de33b510c0d4eaa9a272c2575bef7cbx1280x1722.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man presented with the blurring of vision. Urine examination showed proteinuria. Fundus examination showed dot and blot hemorrhages, microaneurysms, and cotton wool spots. Histopathology of the kidney was as shown below. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Diffuse lupus nephritis"
      },
      {
        "id": 2,
        "text": "Renal amyloidosis"
      },
      {
        "id": 3,
        "text": "Kimmelstiel-Wilson disease"
      },
      {
        "id": 4,
        "text": "Focal segmental glomerulosclerosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient's presentation of diabetic retinopathy with proteinuria and the histopathological image showing <strong>acellular periodic acid Schiff (PAS)-positive nodules</strong> with increased mesangial matrix is highly suggestive of <strong>Kimmelstiel&ndash;Wilson disease</strong>, which occurs in patients with&nbsp;<strong>diabetic nephropathy</strong>.</p>\n<p>Kimmelstiel&ndash;Wilson disease is also known as nodular glomerulosclerosis or intercapillary glomerulosclerosis</p>\n<p>Mesangial matrix appear as ovoid or spherical, acellular nodules in the periphery of the glomerulus. These nodules are PAS-positive.&nbsp;Capillary loops at the periphery are dilated. Accumulations of hyaline material occurs in the capillary loops (<strong>fibrin caps</strong>) and bowman capsules (<strong>capsular drops</strong>).</p>\n<p>Other renal lesions that are seen in diabetic nephropathy:</p>\n<ul>\n<li><strong>Glomerular lesions</strong>:\n<ul>\n<li>Capillary basement membrane thickening</li>\n<li>Diffuse mesangial sclerosis</li>\n<li>Nodular glomerulosclerosis/Kimmelstiel&ndash;Wilson disease</li>\n</ul>\n</li>\n<li><strong>Renal vascular lesions</strong>, mainly hyaline arteriolosclerosis</li>\n<li><strong>Pyelonephritis</strong>, including necrotizing papillitis</li>\n</ul>\n<p>Given below is another histopathology image of diffuse and nodular diabetic glomerulosclerosis (PAS stain). Diffuse increase in mesangial matrix and characteristic acellular PAS-positive nodules are seen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b84552b1813a42aaa0dbb0fe4e8be6db.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa525c2b0e4e42b28d49d5a515bf1218x537x352.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/58475f604d7f494592db884a241590e6x720x480.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b01c179ee47b443892c0e38506df9607x800x531.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/69482e14a5ea4e8bbbf3f290db514022x1024x683.JPEG"
    ]
  },
  {
    "text": "A 55-year-old female patient with no significant past history comes to the emergency department with sudden onset of palpitations. On examination, her pulse is 140 bpm and her blood pressure is 110/70 mmHg. Her ECG is given below. What will be the initial line of management?",
    "choices": [
      {
        "id": 1,
        "text": "IV adenosine"
      },
      {
        "id": 2,
        "text": "Carotid sinus massage"
      },
      {
        "id": 3,
        "text": "IV diltiazem"
      },
      {
        "id": 4,
        "text": "IV procainamide"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The ECG is suggestive of<strong>&nbsp;paroxysmal supraventricular tachycardia (PSVT) </strong>as it shows&nbsp;narrow&nbsp;QRS complexes without visible p waves and pseudo R' waves in aVR lead. Since the patient is hemodynamically stable, a&nbsp;<strong>carotid sinus massage</strong> will be provided as<strong>&nbsp;first-line therapy.</strong></p>\n<p><strong>Vagal maneuvers</strong> like the carotid sinus massage and the Valsalva maneuver&nbsp;are techniques used to increase vagal parasympathetic tone.</p>\n<p>Vagal maneuvers transiently <strong>increase the arterial pressure</strong> in the carotid sinuses and aortic arch. This triggers the <strong>baroreceptor reflex,</strong> which increases parasympathetic output to the heart via cranial nerve X.&nbsp;</p>\n<p>The right vagus nerve innervates the sinoatrial (SA) node and the left vagus nerve&nbsp;innervates the atrioventricular (AV) node. Stimulation of the right and left vagus nerve cause&nbsp;<strong>slowing of the electrical activity</strong> within the SA node and AV node.</p>\n<p>Thus, vagal stimulation results in a decrease in the speed and frequency of electrical impulses in the heart, which could ultimately slow or terminate a tachydysrhythmia.</p>\n<p><strong>Treatment of PSVT:</strong></p>\n<p>In&nbsp;hemodynamically <strong>unstable</strong> patients<strong>,&nbsp;</strong>QRS-synchronous <strong>DC cardioversion</strong> should be done.</p>\n<p>In hemodynamically <strong>stable</strong> patients,</p>\n<ol>\n<li><strong>Vagal maneuvers </strong>such as carotid sinus massage are provided as first-line therapy only if there is a low risk of carotid vascular disease. It is contraindicated in patients with <strong>carotid</strong> <strong>bruit</strong> and prior history of <strong>stroke.</strong></li>\n<li>If the vagal maneuvers fail or cannot be performed, <strong>intravenous adenosine</strong> can be used.</li>\n<li>If adenosine does not work, IV <strong>beta-blockers</strong>&nbsp;or <strong>calcium channel blockers </strong>(<strong>verapamil</strong>, <strong>diltiazem</strong>) can be used</li>\n<li>Irregular, wide complex tachycardia can be treated with IV procainamide, ibutilide, or cardioversion.&nbsp;</li>\n</ol>\n<p>Care should be taken to perform continuous ECG monitoring with facilities for emergency cardioversion and defibrillation on standby.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b0d6147390b64e98b761875a9b5f0716.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/32806ab51c6946f18ac65c5475efd5f7x510x812.PNG"
    ]
  },
  {
    "text": "A patient presents with bilateral nasal obstruction. On anterior rhinoscopy, multiple smooth pale glistening masses are found bilaterally suggestive of ethmoidal polyps. The surgeon plans functional endoscopic sinus surgery to remove them. Which of the following structures shown in the image given below is removed during infundibulotomy?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image above shows the <strong>computed tomography (CT) scan of the ostiomeatal complex</strong> in the coronal plane. The structure marked as<strong> 1 </strong>is the<strong> uncinate process</strong> which is removed in<strong> infundibulotomy.</strong></p>\n<p><strong>Infundibulotomy,&nbsp;</strong>also known as<strong> uncinectomy,</strong> is the first surgical step in functional endoscopic sinus surgery (FESS). FESS is the treatment of choice for ethmoidal polyps, which this patient has.</p>\n<p>The structure marked as <strong>2</strong> is the <strong>ethmoidal bulla</strong>, and is removed in bullectomy.</p>\n<p>The structure marked as <strong>3</strong> is the <strong>middle turbinate</strong></p>\n<p>The structure marked as <strong>4&nbsp;</strong>is the <strong>medial wall of the maxillary sinus.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d3b11301aa0d4320ad91d3191842a7df.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cee32eb2b0f4c5da5e281bc53f332ecx1280x1096.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/49049a0dc0e44418960900a6c4896c49x1280x2558.JPEG"
    ]
  },
  {
    "text": "A 4-year-old boy is brought to casualty after falling from a balcony. Based on the CT scan finding provided, what is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Subdural hematoma"
      },
      {
        "id": 2,
        "text": "Subarchnoid hemorrhage"
      },
      {
        "id": 3,
        "text": "Epidural hematoma"
      },
      {
        "id": 4,
        "text": "Hemorrhagic contusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above axial CT shows a <strong>hyperdense lentiform (biconvex) opacity</strong>, consistent with an <strong>epidural hematoma</strong>, which is a collection of blood between the inner surface of the skull and the outer periosteal layer of the dura mater, typically following a history of trauma. The characteristic biconvex shape arises due to the limited ability of blood to expand within the fixed attachment of periosteal dura to the cranial sutures. If bleeding is significant, it may lead to a\u00a0mass effect with herniation.\u00a0</p>\n<p>Additionally, a<strong> swirl</strong> <strong>sign</strong> may be present, representing acute blood extravasation into a hematoma (extradural/subdural), showing fresh, unclotted blood with lower attenuation than the clotted blood (which is of a higher attenuation), highlighting the need for surgical intervention.</p>\n<p>The following CT image depicts a swirl sign:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b596bc74f302487790a0144dd5c9c7f2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d349d08c232d4b29b72311607b38fcbbx784x963.JPEG"
    ]
  },
  {
    "text": "You have been asked to present a case on homicide, with pictorial representations. You added the following image in your presentation. Which of the following is the mechanism of death in this form of homicide?",
    "choices": [
      {
        "id": 1,
        "text": "Cerebral anemia"
      },
      {
        "id": 2,
        "text": "Slow asphyxia"
      },
      {
        "id": 3,
        "text": "Reflex cardiac arrest"
      },
      {
        "id": 4,
        "text": "Venous congestion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The image shows <strong>smothering\u00a0</strong>with a pillow, which involves the blockage of the <strong>external</strong> air passages. It can be performed by a hand as well<strong>. </strong>Death in smothering with a pillow is due to\u00a0<strong>slow hypoxia</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Smothering</strong> is defined as a form of asphyxia that is caused by <strong>closing</strong> the <strong>external respiratory orifices</strong> either by the <strong>hand</strong> or by <strong>other means</strong> or blocking up the cavities of the nose and mouth by the introduction of a foreign substance. Smothering</span><span data-preserver-spaces=\"true\">\u00a0can be either a</span><span data-preserver-spaces=\"true\">ccidental, s</span><span data-preserver-spaces=\"true\">uicidal, or h</span><span data-preserver-spaces=\"true\">omicidal.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Accidental</strong> smothering makes up <strong>most of</strong> the\u00a0</span><strong>fatal smotherings.\u00a0</strong><span data-preserver-spaces=\"true\">A person suffering from <strong>epilepsy</strong> or <strong>intoxicated</strong> by alcohol might accidentally lie in a position that restricts the airway which might consequently cause death.\u00a0</span><span data-preserver-spaces=\"true\">Falling into a large quantity of semisolid or fine material might also cause asphyxia by covering the openings of the airway.\u00a0</span><span data-preserver-spaces=\"true\"><strong>Children</strong> may be suffocated accidentally while playing with <strong>plastic bags</strong> and is seen often in people who are addicted to\u00a0</span><span data-preserver-spaces=\"true\">glue-sniffing.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Suicide</strong> by smothering is <strong>not possible</strong> using</span><span data-preserver-spaces=\"true\">\u00a0the <strong>hand.</strong>\u00a0</span><span data-preserver-spaces=\"true\">Psychiatric patients or prisoners might attempt suicide by\u00a0<strong>burying</strong> their<strong> faces</strong> in a <strong>mattress</strong> or in their <strong>clothing.</strong>\u00a0</span><span data-preserver-spaces=\"true\">It can be attempted by <strong>tying</strong> a <strong>polythene\u00a0bag</strong> over the<strong> head</strong> as well.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Homicidal</strong> smothering</span><span data-preserver-spaces=\"true\">\u00a0is a simple and convenient method of homicide because it is <strong>extremely difficult to prove</strong> as it may not leave any evidence.\u00a0</span><span data-preserver-spaces=\"true\">The mouth and nose are closed by a hand or cloth, or the face may be pressed into a pillow (gentle homicide).</span></p>\n<p><span data-preserver-spaces=\"true\">Bruising of the inner surface of the lips may be seen if greater force is applied during smothering. At times, mucus and squamous respiratory epithelium from the victim may be found in the smothering material.\u00a0</span>In most cases, death is due to <strong>slow asphyxia</strong> where death occurs <strong>between three to five minutes.</strong> However, death in plastic bag suffocation is rapid <strong>due to reflex cardiac arrest</strong>, rather than a purely hypoxic process. (Option C)</p>\n<p><span data-preserver-spaces=\"true\">Other options-</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Option (A)</strong> and<strong> (D)</strong> both relate to <strong>causes of death</strong> which are observed<strong> in </strong></span><span data-preserver-spaces=\"true\"><strong>hanging</strong>.</span></p>\n<p><span data-preserver-spaces=\"true\">Option (A): <strong>Cerebral anemia</strong> occurs when the noose of the rope is placed at the nape of the neck which causes compression of the large vessels (both arteries and veins). This causes death within 10 to 15 seconds due to cerebral anemia and consequent coma.</span></p>\n<p><span data-preserver-spaces=\"true\">Option (D): <strong>Venous congestion</strong>\u00a0is seen in cases where the knot is situated over the chin causing compression of the jugular veins. This in-turn stops cerebral circulation leading to a rise in the venous pressure in the head and subsequent loss of consciousness. A tension of 2kgs is required to occlude the jugular veins.</span></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7de49772cd2246d5a7d9f2446345f932.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/849c601f6ca94f52b433d9265bf2254dx1280x1789.JPEG"
    ]
  },
  {
    "text": "A young boy is brought to the OPD with a sore throat and a rash, which appears as shown in the image, for the past 2 days. The rash started around the neck and then spread to the trunk and extremities. On examination, rash blanches on pressure. Tongue examination shows swollen papillae. Which of the following toxins is responsible for this child's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Pyrogenic exotoxin"
      },
      {
        "id": 2,
        "text": "Exfoliotoxin"
      },
      {
        "id": 3,
        "text": "Enterotoxin"
      },
      {
        "id": 4,
        "text": "Panton-Valentine leukocidin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of <strong>scarlet fever,</strong> which is caused by a&nbsp;<strong>pyrogenic exotoxin</strong> produced by Group A <em>streptococcus</em> (GAS).</p>\n<p>In scarlet fever, the rash appears within 24&ndash;48 hours of the onset of upper respiratory infections. It begins around the head and neck and spreads over the trunk and extremities. It usually spares palms, and soles. It is a diffuse, <strong>papular</strong>, and erythematous eruption, which <strong>blanches on pressure.&nbsp;</strong>The cheeks are erythematous, with pallor around the mouth. The tongue is usually coated, and the <strong>papillae are swollen,</strong> giving the tongue a <strong>strawberry appearance.</strong></p>\n<p>The image below shows a strawberry tongue.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/483340bf95cb4cb8bfaadeb081085a3b.jpg"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/674c304abfdc49bcbb8ab5befb9ab76bx400x490.JPEG"
    ]
  },
  {
    "text": "All of the following are the uses of enteric-coated drugs except:",
    "choices": [
      {
        "id": 1,
        "text": "Protect the acid labile drug from gastric acidity"
      },
      {
        "id": 2,
        "text": "Protect the gastric mucosa from irritant effects  of certain drugs"
      },
      {
        "id": 3,
        "text": "Prolongs the half life of the drug"
      },
      {
        "id": 4,
        "text": "Deliver drugs distal to stomach"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Enteric coating of the drug</strong> <strong>does</strong> <strong>not prolong the half-life </strong>of the drug.</p>\n<p>The half-life of a drug depends on the volume of distribution and rate of clearance from the blood. It is given by t1/2 = 0.693x Volume of distribution / Clearance.</p>\n<p>The enteric coating can be done for the following reasons:</p>\n<ul>\n<li>Protection of active pharmaceutical ingredients, from the acidic environment of the stomach (e.g. enzymes and certain antibiotics).</li>\n<li>To prevent gastric distress or nausea from a drug due to irritation (e.g. sodium salicylate).</li>\n<li>For the delivery of drugs that are optimally absorbed in the small intestine to their primary absorption site in their most concentrated form.</li>\n<li>To provide a delayed-release component for repeat action.</li>\n<li>Required for minimizing the first-pass metabolism of the drug</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newly married couple has come for counseling as the male partner has had difficulty maintaining an erection until the completion of sexual activity for the past 8 months. He does not have any known ailment. Which phase of the normal sexual cycle does this disorder belong to?",
    "choices": [
      {
        "id": 1,
        "text": "Desire phase"
      },
      {
        "id": 2,
        "text": "Orgasmic phase"
      },
      {
        "id": 3,
        "text": "Arousal phase"
      },
      {
        "id": 4,
        "text": "Resolution phase"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of <strong>erectile dysfunction</strong>, which is a disorder of the <strong>arousal</strong>\u00a0<strong>phase\u00a0</strong>(excitement phase) of the normal sexual cycle.</p>\n<p>Erectile dysfunction is marked by difficulty in <strong>achieving</strong> or <strong>maintaining</strong> an <strong>erection</strong>. A considerable decrease in penile rigidity during erection is also associated. All or one of these symptoms must be present during intercourse for at least <strong>six months</strong> for a diagnosis. It causes significant <strong>distress</strong> to the individual.</p>\n<p>Patients who have had\u00a0<strong>lifelong</strong>\u00a0erectile disorder have never been able to obtain an erection sufficient for insertion. <strong>Acquired</strong> male erectile disorder is marked by successful penetration at some point in his sexual life but is now unable to do so. Erectile dysfunction experienced in particular circumstances is termed\u00a0<strong>situational</strong> male erectile disorder.</p>\n<p>Other options:</p>\n<p>Option A: The <strong>desire\u00a0phase </strong>consists of sexual fantasies and the desire to have sex.\u00a0This phase is affected in people with\u00a0<strong>frigidity</strong>(lack of sexual desire).</p>\n<p>Option B: The <strong>orgasmic phase</strong> lasts for 3-15 seconds. It is marked by ejaculation. This phase is affected in people with\u00a0<strong>premature ejaculation</strong>.</p>\n<p>Option D: The <strong>resolution phase</strong> lasts for 10-15 minutes. If no orgasm is achieved, it can last for 1/2 -1 day. It is marked by full detumescence in 5-30 minutes. Detumescence is the release of vascular activity and muscle tone after orgasm.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sequentially arrange the following fundoscopic findings according to the respective grades in which they are seen, as per Keith Wagener Barker (KWB) grading of hypertensive retinopathy, starting with grade 1.",
    "choices": [
      {
        "id": 1,
        "text": "1,2,3,4"
      },
      {
        "id": 2,
        "text": "4,3,1,2"
      },
      {
        "id": 3,
        "text": "3,4,1,2"
      },
      {
        "id": 4,
        "text": "2,3,1,4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct sequence according Keith Wagener Barker (KWB) grading of hypertensive retinopathy\u00a0is</p>\n<p>3. Retinal arteriolar narrowing\u00a0</p>\n<p>4. Arteriovenous nipping</p>\n<p>1. Macular star</p>\n<p>2. Optic Disc swelling</p>\n<p><strong>Keith Wagener Barker</strong> (KWB) grading of hypertensive retinopathy:</p>\n<p><strong>Grade 1</strong>: Presence of mild generalized <strong>retinal arteriolar narrowing.\u00a0</strong></p>\n<p><strong>Grade 2</strong>: Presence of focal arteriolar narrowing and <strong>arteriovenous nipping.</strong></p>\n<ul>\n<li>Copper wiring: Opacified appearance of arteriolar walls.</li>\n<li class=\"half_rhythm\">\n<div>Salus\u2019s sign: Deflection of retinal vein as it crosses the arteriole.</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Gunn\u2019s sign: Tapering of the retinal vein on either side of the AV crossing.</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Bonnet\u2019s sign: Banking of the retinal vein distal to the AV crossing.</div>\n</li>\n</ul>\n<p><strong>Grade 3</strong>: Grade 2 plus retinal hemorrhages, exudates and macular star.</p>\n<ul>\n<li>Retinal hemorrhages:\n<ul>\n<li><strong>Dot-blot hemorrhages</strong>: Bleeding in the inner retinal layer</li>\n<li><strong>Flame shaped hemorrhage</strong>: Bleeding is in the superficial retinal layer</li>\n</ul>\n</li>\n<li>Retinal exudates:\n<ul>\n<li><strong>Hard exudates</strong>: Lipid deposits in the retina</li>\n<li><strong>Soft exudates</strong>: These are also known as <strong>cotton wool spots</strong> which appear due to ischemia of the nerve fibers</li>\n</ul>\n</li>\n<li>Macular Changes\n<ul>\n<li><strong>Macular star</strong> formation due to deposition of hard exudates around the macula.</li>\n</ul>\n</li>\n</ul>\n<p><strong>Grade 4</strong>: Severe grade 3 plus <strong>optic disc swelling</strong>. This is a marker of malignant hypertension.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a3ad93aab5b7404dacab28597038fa68x1200x2876.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man, whose wife is a known case of leprosy, presents with the following skin lesions all over his body. Which of the following is incorrect about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Low  bacillary load in lesions"
      },
      {
        "id": 2,
        "text": "Reactions are rarely seen"
      },
      {
        "id": 3,
        "text": "Associated with dapsone resistance"
      },
      {
        "id": 4,
        "text": "Biopsy shows interlacing histiocytes"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image with <strong>shiny papules</strong> and <strong>nodules</strong> on normal skin is suggestive of <strong>histoid leprosy</strong>. It is characterized by a very <strong>high&nbsp;bacillary load.</strong></p>\n<p>Histoid leprosy is a <strong>rare</strong> type of <strong>multibacillary</strong> leprosy where the bacilli are <strong>confined</strong> to the <strong>lesions</strong> and hence, <strong>globi </strong>are relatively<strong> few</strong>. The name arises from the microscopic finding of&nbsp;<strong>spindle-shaped</strong>&nbsp;<strong>histiocytes</strong> forming <strong>interlacing</strong> bands and whorls.</p>\n<p>It was initially associated with&nbsp;dapsone monotherapy and irregular treatment, leading to the development of <strong>dapsone-resistant</strong> bacteria. It is now recognized to arise<strong> de novo also</strong>.</p>\n<p><strong>Lepra reactions</strong>&nbsp;are considered to be <strong>uncommon</strong> in histoid leprosy.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/77e1e90ed4404827a3d03fd07561fdf0.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Mini Test 2';
        const quizFilename = 'mini-test-2-8a2dc0dd.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>