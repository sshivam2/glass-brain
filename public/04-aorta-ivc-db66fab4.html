<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04  Aorta  Ivc - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        DAMS / DQB / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "id": 50000,
    "choices": [
      {
        "id": 200000,
        "text": "Superior gluteal artery"
      },
      {
        "id": 200001,
        "text": "Inferior gluteal artyery"
      },
      {
        "id": 200002,
        "text": "Superior vesical artery"
      },
      {
        "id": 200003,
        "text": "Middle rectal artery"
      }
    ],
    "text": "Branch of posterior division of internal iliac artery is -",
    "unique_key": "Q6993233",
    "question_audio": null,
    "question_video": null,
    "map_id": 34899249,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Superior gluteal artery. Explanation for the Correct Answer: A. Superior gluteal artery: The superior gluteal artery is a branch of the posterior division of the internal iliac artery. It supplies the gluteal muscles, specifically the gluteus maximus, gluteus medius, and gluteus minimus muscles. This artery exits the pelvis through the greater sciatic foramen above the piriformis muscle and is the largest branch of the posterior division. Explanation for Incorrect Answers: B. Inferior gluteal artery: The inferior gluteal artery is a branch of the anterior division of the internal iliac artery, not the posterior division. It supplies the gluteus maximus, the piriformis, and other muscles in the pelvic region. C. Superior vesical artery: The superior vesical artery is a branch of the anterior division of the internal iliac artery. It supplies the upper part of the bladder and also contributes to the vas deferens in males. It is not a branch of the posterior division. D. Middle rectal artery: The middle rectal artery is also a branch of the anterior division of the internal iliac artery. It supplies the rectum and is not a branch of the posterior division.",
    "correct_choice_id": 200000,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/19917751697973275/19917751697973275.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/19917751697973275/19917751697973275.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50001,
    "choices": [
      {
        "id": 200004,
        "text": "splenic"
      },
      {
        "id": 200005,
        "text": "Hepatic"
      },
      {
        "id": 200006,
        "text": "Portal"
      },
      {
        "id": 200007,
        "text": "Inf. vena cava"
      }
    ],
    "text": "Superior mesenteric vein drains into vein-",
    "unique_key": "Q4602211",
    "question_audio": null,
    "question_video": null,
    "map_id": 34247253,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Portal. Explanation for the Correct Answer: C. Portal vein: The superior mesenteric vein drains into the portal vein. The superior mesenteric vein collects blood from the small intestine, the cecum, and the ascending colon, and then drains into the portal vein. The portal vein is responsible for carrying blood from the gastrointestinal tract and spleen to the liver for processing. Explanation for Incorrect Answers: A. Splenic vein: The splenic vein drains blood from the spleen, pancreas, and part of the stomach, and it merges with the superior mesenteric vein to form the portal vein. However, the superior mesenteric vein does not directly drain into the splenic vein. B. Hepatic vein: The hepatic veins drain blood from the liver into the inferior vena cava. These veins do not receive blood from the superior mesenteric vein, as the latter drains into the portal vein. D. Inferior vena cava: The inferior vena cava collects blood from the lower body and the liver through the hepatic veins, but it is not involved in the drainage of blood from the superior mesenteric vein.",
    "correct_choice_id": 200006,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/23222631697973335/23222631697973335.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/23222631697973335/23222631697973335.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50002,
    "choices": [
      {
        "id": 200008,
        "text": "Rt. gastric"
      },
      {
        "id": 200009,
        "text": "Lt. gastric"
      },
      {
        "id": 200010,
        "text": "Gastroduodena"
      },
      {
        "id": 200011,
        "text": "Rt. gastroepiploic artery"
      }
    ],
    "text": "Which is the direct branch of coeliac trunk-",
    "unique_key": "Q2542297",
    "question_audio": null,
    "question_video": null,
    "map_id": 34093715,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Left gastric artery. Explanation for the Correct Answer: B. Left gastric artery: The left gastric artery is a direct branch of the celiac trunk. It is one of the first arteries that arises from the celiac trunk and supplies the lesser curvature of the stomach and the lower esophagus. Explanation for Incorrect Responses: A. Right gastric artery: This is incorrect because the right gastric artery is not a direct branch of the celiac trunk. Instead, it typically arises from the common hepatic artery, which itself is a branch of the celiac trunk, but it is not a direct branch. C. Gastroduodenal artery: This is incorrect because the gastroduodenal artery is a branch of the common hepatic artery, which is a branch of the celiac trunk, but it is not a direct branch of the celiac trunk itself. D. Right gastroepiploic artery: This is incorrect because the right gastroepiploic artery is a branch of the gastroduodenal artery, not a direct branch of the celiac trunk.",
    "correct_choice_id": 200009,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/27514641697973519/27514641697973519.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/27514641697973519/27514641697973519.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50003,
    "choices": [
      {
        "id": 200012,
        "text": "Left testicular vein"
      },
      {
        "id": 200013,
        "text": "Rt suprarenal vein"
      },
      {
        "id": 200014,
        "text": "Lt. ovarian vein"
      },
      {
        "id": 200015,
        "text": "Lt. suprarenal vein"
      }
    ],
    "text": "Vein draining to IVC is-",
    "unique_key": "Q2563895",
    "question_audio": null,
    "question_video": null,
    "map_id": 34971294,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Right suprarenal vein. Explanation for the Correct Answer: B. Right suprarenal vein: The right suprarenal vein drains directly into the inferior vena cava (IVC). The right adrenal gland (suprarenal gland) has its venous drainage through the right suprarenal vein, which does not pass through the left renal vein but instead drains directly into the IVC. Explanation for Incorrect Responses: A. Left testicular vein: This is incorrect because the left testicular vein drains into the left renal vein, which then drains into the IVC. The left testicular vein does not directly drain into the IVC, unlike the right testicular vein, which drains directly into the IVC. C. Left ovarian vein: This is incorrect because the left ovarian vein also drains into the left renal vein before draining into the IVC. Like the left testicular vein, the left ovarian vein does not drain directly into the IVC. D. Left suprarenal vein: This is incorrect because the left suprarenal vein drains into the left renal vein, which then drains into the IVC. The left suprarenal vein does not drain directly into the IVC, unlike the right suprarenal vein.",
    "correct_choice_id": 200013,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/77701931697973547/77701931697973547.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/77701931697973547/77701931697973547.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50004,
    "choices": [
      {
        "id": 200016,
        "text": "Superior gluteal"
      },
      {
        "id": 200017,
        "text": "Uterine"
      },
      {
        "id": 200018,
        "text": "Obturator"
      },
      {
        "id": 200019,
        "text": "Internal pudendal"
      }
    ],
    "text": "The branch of anterior division of internal iliac artery Does not include",
    "unique_key": "Q8070555",
    "question_audio": null,
    "question_video": null,
    "map_id": 34700269,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Superior gluteal. Explanation for the Correct Answer: A. Superior gluteal: The superior gluteal artery is a branch of the posterior division of the internal iliac artery, not the anterior division. It supplies the gluteal muscles and structures in the pelvis. This makes it the correct answer as it does not belong to the anterior division of the internal iliac artery. Explanation for Incorrect Responses: B. Uterine: This is incorrect because the uterine artery is a branch of the anterior division of the internal iliac artery. It supplies blood to the uterus, cervix, and parts of the vagina. C. Obturator: This is incorrect because the obturator artery also arises from the anterior division of the internal iliac artery. It supplies the muscles of the pelvic region, as well as the hip joint and part of the thigh. D. Internal pudendal: This is incorrect because the internal pudendal artery is another branch of the anterior division of the internal iliac artery. It supplies the perineum and external genitalia.",
    "correct_choice_id": 200016,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24438001697973589/24438001697973589.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/24438001697973589/24438001697973589.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50005,
    "choices": [
      {
        "id": 200020,
        "text": "Passes through diaphragm at level of T10 vertebra"
      },
      {
        "id": 200021,
        "text": "Rt. suprarenal vein directly drains to it."
      },
      {
        "id": 200022,
        "text": "It lies anterior to the right renal artery"
      },
      {
        "id": 200023,
        "text": "It forms the posterior wall of the epiploic foramen"
      }
    ],
    "text": "False about inferior vena cava -",
    "unique_key": "Q8410943",
    "question_audio": null,
    "question_video": null,
    "map_id": 34951449,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Passes through diaphragm at level of T10 vertebra. Explanation for the Correct Answer: A. Passes through diaphragm at level of T10 vertebra: This statement is incorrect because the inferior vena cava passes through the diaphragm at the level of the T8 vertebra, not T10. The T10 vertebra is associated with the passage of the esophagus through the diaphragm, not the inferior vena cava. Explanation for Incorrect Responses: B. Right suprarenal vein directly drains to it: This statement is correct. The right suprarenal vein directly drains into the inferior vena cava, while the left suprarenal vein typically drains into the left renal vein before reaching the inferior vena cava. C. It lies anterior to the right renal artery: This statement is correct. The inferior vena cava is positioned anterior to the right renal artery as it ascends along the right side of the vertebral column. D. It forms the posterior wall of the epiploic foramen: This statement is correct. The inferior vena cava forms part of the posterior boundary of the epiploic foramen (also known as the foramen of Winslow), which is an opening that connects the greater and lesser sacs of the peritoneal cavity.",
    "correct_choice_id": 200020,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/15832441697973651/15832441697973651.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/15832441697973651/15832441697973651.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50006,
    "choices": [
      {
        "id": 200024,
        "text": "Left brachiocephalic vein"
      },
      {
        "id": 200025,
        "text": "Hemiazygous vein"
      },
      {
        "id": 200026,
        "text": "Left renal vein"
      },
      {
        "id": 200027,
        "text": "Left gonadal vein"
      }
    ],
    "text": "Vein that doesn\u2019t cross the midline is:",
    "unique_key": "Q9858402",
    "question_audio": null,
    "question_video": null,
    "map_id": 34170545,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Left gonadal vein. Explanation for the Correct Answer: D. Left gonadal vein: The left gonadal vein (which drains the left ovary or left testicle) does not cross the midline. It drains into the left renal vein, which then drains into the inferior vena cava (IVC). The left gonadal vein remains on the left side of the body and does not cross the midline, unlike some other veins that cross to the right side. Explanation for Incorrect Responses: A. Left brachiocephalic vein: The left brachiocephalic vein crosses the midline. It is formed by the union of the left subclavian and left internal jugular veins and travels across the midline to join the right brachiocephalic vein, forming the superior vena cava. B. Hemiazygous vein: The hemiazygous vein is another vein that crosses the midline. It runs along the left side of the vertebral column and eventually drains into the azygous vein, which crosses the midline at the level of the T8 vertebra to enter the superior vena cava. C. Left renal vein: The left renal vein does cross the midline as it drains the left kidney into the inferior vena cava. It passes behind the aorta and in front of the lumbar spine, crossing the midline before entering the IVC.",
    "correct_choice_id": 200027,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/41321221697974322/41321221697974322.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/41321221697974322/41321221697974322.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50007,
    "choices": [
      {
        "id": 200028,
        "text": "Anteriorly, above the superior mesenteric artery"
      },
      {
        "id": 200029,
        "text": "Anteriorly, below the superior mesenteric artery"
      },
      {
        "id": 200030,
        "text": "Posteriorly, at the level of superior mesenteric artery"
      },
      {
        "id": 200031,
        "text": "Anteriorly, below the inferior mesenteric artery"
      }
    ],
    "text": "Left renal vein crosses the Aorta:",
    "unique_key": "Q3293405",
    "question_audio": null,
    "question_video": null,
    "map_id": 34582308,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) Anteriorly, below the superior mesenteric artery The left renal vein crosses the aorta anteriorly and lies below the superior mesenteric artery (SMA). This anatomical relationship is important in vascular and surgical procedures, as the left renal vein can sometimes be compressed between the aorta and the SMA, a condition known as nutcracker syndrome. In this situation, the left renal vein is compressed between the two vessels, leading to symptoms like hematuria and flank pain. Incorrect Responses: (A) Anteriorly, above the superior mesenteric artery The left renal vein does not cross the aorta above the superior mesenteric artery. This would be anatomically incorrect, as the left renal vein passes beneath the SMA, not above it. Therefore, A is incorrect. (C) Posteriorly, at the level of superior mesenteric artery The left renal vein does not cross the aorta posteriorly at the level of the superior mesenteric artery. It crosses anteriorly to the aorta, so this description does not accurately reflect the correct anatomy. Therefore, C is incorrect. (D) Anteriorly, below the inferior mesenteric artery The left renal vein crosses the aorta below the superior mesenteric artery, not the inferior mesenteric artery. The inferior mesenteric artery arises at a much lower level and does not influence the path of the left renal vein.",
    "correct_choice_id": 200029,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/62776551697975113/62776551697975113.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/62776551697975113/62776551697975113.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50008,
    "choices": [
      {
        "id": 200032,
        "text": "Subclavian artery"
      },
      {
        "id": 200033,
        "text": "External iliac artery"
      },
      {
        "id": 200034,
        "text": "Internal iliac artery"
      },
      {
        "id": 200035,
        "text": "External carotid A"
      },
      {
        "id": 200036,
        "text": "Axillary artery"
      }
    ],
    "text": "In rectus sheath which branch of aorta make anastomosis with superior epigastric artery -",
    "unique_key": "Q5541206",
    "question_audio": null,
    "question_video": null,
    "map_id": 34833201,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (B) External iliac artery The superior epigastric artery, which is a terminal branch of the internal thoracic artery (arising from the subclavian artery), descends within the rectus sheath and anastomoses with the inferior epigastric artery. The inferior epigastric artery is a branch of the external iliac artery, which arises from the aorta. This anastomosis occurs in the rectus sheath posterior to the rectus abdominis muscle. This connection is clinically important as it provides collateral blood flow between the subclavian and external iliac arteries. Incorrect Responses: (A) Subclavian artery Although the subclavian artery is the source of the internal thoracic artery, which gives rise to the superior epigastric artery, it does not directly contribute to the anastomosis with the inferior epigastric artery. Thus, A is incorrect. (C) Internal iliac artery The internal iliac artery primarily supplies the pelvic organs, perineum, and gluteal regions. It does not directly participate in the anastomosis with the superior epigastric artery. Therefore, C is incorrect. (D) External carotid artery The external carotid artery supplies the head and neck region and is not involved in the blood supply of the rectus sheath or abdominal wall. Hence, D is incorrect. (E) Axillary artery The axillary artery supplies the upper limb, chest wall, and shoulder region. It does not have any direct role in the blood supply of the rectus sheath or the anastomosis between the superior and inferior epigastric arteries.",
    "correct_choice_id": 200033,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/25222051697975285/25222051697975285.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/25222051697975285/25222051697975285.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50009,
    "choices": [
      {
        "id": 200037,
        "text": "Right internal iliac vein"
      },
      {
        "id": 200038,
        "text": "Inferior mesenteric vein"
      },
      {
        "id": 200039,
        "text": "Right renal vein"
      },
      {
        "id": 200040,
        "text": "Hemiazygous vein"
      },
      {
        "id": 200041,
        "text": "Inferior vena cava"
      }
    ],
    "text": "A 28 years old male presents to your office complaining of lower abdominal discomfort. Physical examination reveals right-sided testicular enlargement that feels like a 'bag of worms' when the patient stands up The venous blood from the affected testicle drains directly into the:",
    "unique_key": "Q3416703",
    "question_audio": null,
    "question_video": null,
    "map_id": 34062422,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (E) Right Gonadal and Suprarenal veins drain into IVC whereas left Gonadal and Suprarenal veins drain into left renal vein.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/qid%2069844.jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200041,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/7851221698324802/7851221698324802.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/7851221698324802/7851221698324802.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50010,
    "choices": [
      {
        "id": 200042,
        "text": "Common hepatic"
      },
      {
        "id": 200043,
        "text": "Right gastroepiploic"
      },
      {
        "id": 200044,
        "text": "Splenic"
      },
      {
        "id": 200045,
        "text": "Left gastric"
      },
      {
        "id": 200046,
        "text": "Superior mesenteric"
      },
      {
        "id": 200047,
        "text": "Gastroduodenal"
      },
      {
        "id": 200048,
        "text": "Inferior pancreaticoduodenal"
      }
    ],
    "text": "A 45 years old man is brought to the emergency department for repeated vomiting that began 2 hours ago. His vomit is dark brown. The patient has a history of gastritis, for which he takes antacids. Physical examination reveals mild epigastric tenderness. Endoscopy shows a deep, bleeding ulcer on the posterior wall of the duodenum. This ulcer has most likely penetrated which of the following arteries?",
    "unique_key": "Q8559099",
    "question_audio": null,
    "question_video": null,
    "map_id": 34679729,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (F) Gastroduodenal A. is present posterior to 1st part of the duodenum and hence is involved by the ulcer.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/qid%2069845.jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200047,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/76476961698324823/76476961698324823.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/76476961698324823/76476961698324823.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50011,
    "choices": [
      {
        "id": 200049,
        "text": "A"
      },
      {
        "id": 200050,
        "text": "B"
      },
      {
        "id": 200051,
        "text": "C"
      },
      {
        "id": 200052,
        "text": "D"
      },
      {
        "id": 200053,
        "text": "E"
      }
    ],
    "text": "A 45 years old patient presents with vague abdominal pain and undergoes CT imaging of the abdomen (see below). Which of the following labeled organs is supplied by an artery of the foregut although it is not a foregut derivative?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/Doc5(1).jpg\" alt=\"Question Image\"></p>",
    "unique_key": "Q5331087",
    "question_audio": null,
    "question_video": null,
    "map_id": 34896189,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (E) Spleen is supplied by branch of Coelic trunk however it is not a foregut derivative.",
    "correct_choice_id": 200053,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/60805201698325156/60805201698325156.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/60805201698325156/60805201698325156.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50012,
    "choices": [
      {
        "id": 200054,
        "text": "Common iliac artery"
      },
      {
        "id": 200055,
        "text": "Phrenic artery"
      },
      {
        "id": 200056,
        "text": "Internal iliac artery"
      },
      {
        "id": 200057,
        "text": "Renal artery"
      },
      {
        "id": 200058,
        "text": "Superior Vesical"
      }
    ],
    "text": "A 45 years old patient with end-stage renal disease underwent renal transplant. The upper 1/3 of the ureter of the trCorrect Answerplanted kidney is retained and attached to the recipient patient's bladder. Which of the following arteries is the major source of blood supply to the upper ureter?",
    "unique_key": "Q3826686",
    "question_audio": null,
    "question_video": null,
    "map_id": 34259167,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Renal artery.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/image(345).png\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200057,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/47115941698325275/47115941698325275.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/47115941698325275/47115941698325275.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50013,
    "choices": [
      {
        "id": 200059,
        "text": "It joins the splenic vein to form the portal vein"
      },
      {
        "id": 200060,
        "text": "It drains into the left subclavian vein in the thorax"
      },
      {
        "id": 200061,
        "text": "It is formed by the union of the common iliac veins"
      },
      {
        "id": 200062,
        "text": "It is drained by the cystic duct into the common duct"
      },
      {
        "id": 200063,
        "text": "It gives rise to the right and left renal arteries"
      }
    ],
    "text": "A 52 years old man is being evaluated for two episodes of painless hematuria. CT image of his abdomen is shown below. Which of the following statements best describes the structure indicated by the arrow?<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/CL%20ANAT%20Q47.png\" alt=\"Question Image\"></p>",
    "unique_key": "Q7430707",
    "question_audio": null,
    "question_video": null,
    "map_id": 34435783,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Arrow marked is IVC which is formed by the union of the common iliac veins",
    "correct_choice_id": 200061,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/28191181698325457/28191181698325457.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/28191181698325457/28191181698325457.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50014,
    "choices": [
      {
        "id": 200064,
        "text": "Ductusarteriosus"
      },
      {
        "id": 200065,
        "text": "Superior vena cava"
      },
      {
        "id": 200066,
        "text": "Inferior vena cava"
      },
      {
        "id": 200067,
        "text": "Pulmonarytrunk"
      },
      {
        "id": 200068,
        "text": "Descending aorta"
      },
      {
        "id": 200069,
        "text": "Umbilical artery"
      }
    ],
    "text": "Five measurements of blood oxygen saturation taken in a fetus are: 64, 61, 66, 52 and 37%. The highest value is most likely recorded in which of the following vessels?",
    "unique_key": "Q3092370",
    "question_audio": null,
    "question_video": null,
    "map_id": 34225078,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) in fetal circulation, umbilical vein carries oxygenated blood then it reaches ductus venosus in the liver and then through IVC into right atrium. Among given options IVC has highest value.",
    "correct_choice_id": 200066,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/56383361698328308/56383361698328308.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/56383361698328308/56383361698328308.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50015,
    "choices": [
      {
        "id": 200070,
        "text": "The abdomen was found to be distended."
      },
      {
        "id": 200071,
        "text": "A rectal examination with the gloved little finger resulted in the passage of a large amount of flatus and the abdominal distension became visibly less."
      },
      {
        "id": 200072,
        "text": "A low barium enema followed by an X-ray examination showed a normal rectum."
      },
      {
        "id": 200073,
        "text": "On the radiograph, above the rectum, a narrowed part of the colon led to a funnel-shaped expansion, which in turn led to a greatly dilated descending colon and transverse colon."
      },
      {
        "id": 200074,
        "text": "On placing a stethoscope on the abdominal wall, the physician could not hear sounds of peristalsis"
      }
    ],
    "text": "A 3-week-old boy was taken to a pediatrician because of repeated vomiting and reluctance to feed. On questioning, the mother said the child had started to vomit on the first day of life and has vomited at least once a day since then. Early on, the mother had been reassured and told that the baby was taking his feedings too quickly and that the vomiting eventually would cease. While initially accepting this reassurance, the mother now noticed that the child did not seem hungry at feeding time; moreover, she could see that the abdomen was becoming distended. She added that the child definitely was constipated; very occasionally, hard meconium was passed. After a thorough physical examination of the child, the pediatrician made the diagnosis of primary megacolon (Hirschsprung disease). The examination of the child revealed the following possible signs except which?",
    "unique_key": "Q6140685",
    "question_audio": null,
    "question_video": null,
    "map_id": 34153863,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (E) In patients with primary megacolon, the muscle of the colon immediately proximal to the obstruction is hypertrophied as the result of attempting to force the meconium and feces onward. Usually very active peristalsis is heard on listening to the abdomen with a stethoscope.",
    "correct_choice_id": 200074,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/46816801698328828/46816801698328828.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/46816801698328828/46816801698328828.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50016,
    "choices": [
      {
        "id": 200075,
        "text": "Azygos and hemiazygos veins"
      },
      {
        "id": 200076,
        "text": "Gonadal veins"
      },
      {
        "id": 200077,
        "text": "External iliac veins"
      },
      {
        "id": 200078,
        "text": "Splenic vein"
      }
    ],
    "text": "A 54-year-old man has cirrhosis, with obstruction of the portal circulation within the liver. Portal blood could still be conveyed to the caval system via which of the following?",
    "unique_key": "Q3153808",
    "question_audio": null,
    "question_video": null,
    "map_id": 34486709,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) The esophageal venous plexus, which drains into the azygos and hemiazygos veins within the thorax, has anastomoses with branches of the left gastric vein. Thus, following blockage of the portal vein, portal blood may enter the superior vena cava via the azygos system. Other important portacaval connections include the superior rectal vein with the middle and inferior rectal veins; paraumbilical veins with epigastric veins (engorgement of these vessels results in caput medusae); and the colic and splenic veins with renal veins and veins of the posterior body wall. The gonadal veins (choice B) exclusively drain the gonads (although in the female, the ovarian vein communicates with the uterovaginal plexus). These vessels have no anastomoses with portal vessels. The external iliac veins (choice C), which drain much of the inferior extremities, have no demonstrated portal anastomoses. The splenic vein (choice D) is incorrect because it is itself a component of the portal venous system.",
    "correct_choice_id": 200075,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/1928901698329116/1928901698329116.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/1928901698329116/1928901698329116.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50017,
    "choices": [
      {
        "id": 200079,
        "text": "Abdominal aorta"
      },
      {
        "id": 200080,
        "text": "Celiac trunk"
      },
      {
        "id": 200081,
        "text": "Common iliac artery"
      },
      {
        "id": 200082,
        "text": "Inferior mesenteric artery"
      }
    ],
    "text": "An arteriogram is performed on a patient with atherosclerosis. Luminal narrowing of which of the following vessels would compromise blood flow through the renal arteries?",
    "unique_key": "Q1610830",
    "question_audio": null,
    "question_video": null,
    "map_id": 34761784,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) The renal arteries emerge from the abdominal aorta at about the level of the L1/L2 intervertebral disc and travel at nearly right angles to it (on the right, passing posterior to the inferior vena cava) to enter the hilum of the kidney. The celiac trunk gives off the common hepatic, splenic, and left gastric arteries. The common iliac artery gives off the internal and external iliac arteries.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/1_1(46).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200079,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/1013211698329596/1013211698329596.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/1013211698329596/1013211698329596.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50018,
    "choices": [
      {
        "id": 200083,
        "text": "Abnormal persistence of the right dorsal aorta"
      },
      {
        "id": 200084,
        "text": "Abnormal persistence of the right fourth aortic arch"
      },
      {
        "id": 200085,
        "text": "Abnormal persistence of the right seventh inter-segmental artery"
      },
      {
        "id": 200086,
        "text": "Abnormal persistence of the right sixth aortic arch"
      }
    ],
    "text": "A patient is complaining of difficulty swallowing. A barium contrast x-ray shows a constriction of the esophagus at the level of the third thoracic vertebra. An aortogram shows that the patient has a double aortic arch. Which of the following developmental abnormalities explains this finding?",
    "unique_key": "Q7703735",
    "question_audio": null,
    "question_video": null,
    "map_id": 34988184,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Each pharyngeal arch has an aortic arch that passes through it. The aortic arches connect the aortic sac with the right and left dorsal aortas. Normally, the left fourth aortic arch is retained as the definitive aortic arch. The right fourth aortic arch normally forms the proximal part of the right subclavian artery. The distal part of this artery is formed by the right seventh intersegmental artery. Normally, most of the right dorsal aorta between these two vessels disappears. The presence of a right aortic arch in addition to the normal left aortic arch indicates that the portion of the right dorsal aorta that should have disappeared did not. The right fourth aortic arch normally persists. It forms the proximal part of the right subclavian artery. The right seventh intersegmental artery normally persists. It forms the distal part of the right subclavian artery. The proximal part of the right sixth aortic arch normally persists. It forms the right pulmonary artery.<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/8_1(22).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200083,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/72803291698329923/72803291698329923.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/72803291698329923/72803291698329923.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50019,
    "choices": [
      {
        "id": 200087,
        "text": "Right Gastric and Right gastroepiploic artery"
      },
      {
        "id": 200088,
        "text": "Right Gastric and Left gastric artery"
      },
      {
        "id": 200089,
        "text": "Right Gastroepiploic and Left short gastric vessels"
      },
      {
        "id": 200090,
        "text": "Right Gastric and short gastric vessels"
      }
    ],
    "text": "Ligation of the common hepatic artery will impair blood supply in:",
    "unique_key": "Q7971107",
    "question_audio": null,
    "question_video": null,
    "map_id": 34116655,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Option A-if common hepatic artery ligated,blood supply in Right gastric and right gastro epiploic artery will impaired as right gastric artery is a branch of proper hepatic artery which itself is a branch of common hepatic artery.And right gastroepiploic artery is a branch of gastroduodenal artery which itself is a branch of common hepatic artery. Option B-Left gastric artery is a direct branch of celiac trunk. Option C,D-short gastric vessels are branches of splenic artery.",
    "correct_choice_id": 200087,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/18366531698504654/18366531698504654.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/18366531698504654/18366531698504654.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50020,
    "choices": [
      {
        "id": 200091,
        "text": "Right Internal Iliac Artery"
      },
      {
        "id": 200092,
        "text": "Right External Iliac Artery"
      },
      {
        "id": 200093,
        "text": "left External Iliac Artery"
      },
      {
        "id": 200094,
        "text": "Aorto iliac Junction"
      }
    ],
    "text": "A patient with H/O pain in both legs while taking long walk. He has developed toe gangrene and he admits to have Erectile dysfunction. Which of the following artery is involved in this patient?",
    "unique_key": "Q6380351",
    "question_audio": null,
    "question_video": null,
    "map_id": 34948964,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (D) Option A-Right Internal Iliac Artery obstruction won't cause pain in both legs. Option B-Right External Iliac Artery obstruction will cause pain only in right leg. Option C-left External Iliac Artery obstruction will cause pain only in left leg. Option D-Aorto iliac Junction obstruction will cause pain in both legs while taking long walk [intermittent claudication], toe gangrene and Erectile dysfunction due to reduced penile blood supply. Internal iliac artery gives two branches known as anterior division & posterior division. ANTERIOR DIVISION Mnemonic \u2013 shiv obtained marks in PG S (V) \u2013 superior Vesicle I (V) \u2013 inferior vesicle (replaced in females by uterine & vaginal a. ) OBTAINED \u2013 obturator MARKS \u2013 middle rectal IN (P)- inf pudendal (G)- inf gluteal POSTERIOR DIVISION \u2013 Mnemonic \u2013 SIL S \u2013 Sup. gluteal I \u2013 Ilio lumbar L \u2013 lat. Sacral<p><img src=\"https://d2enu63wt1sf3u.cloudfront.net/ckfinder/files/3_1(145).jpg\" alt=\"Solution Image\"></p>",
    "correct_choice_id": 200094,
    "solution_audio": null,
    "solution_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/725721698502603/725721698502603.m3u8",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "https://d2enu63wt1sf3u.cloudfront.net/dqb_vod/725721698502603/725721698502603.m3u8",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50021,
    "choices": [
      {
        "id": 200095,
        "text": "Left Gonadal Vein"
      },
      {
        "id": 200096,
        "text": "Left Suprarenal Vein"
      },
      {
        "id": 200097,
        "text": "Left inferior phrenic Vein"
      },
      {
        "id": 200098,
        "text": "Right ascending lumbar vein"
      }
    ],
    "text": "Which of the following drains into IVC ?",
    "unique_key": "Q6575425",
    "question_audio": null,
    "question_video": null,
    "map_id": 34679099,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (C) Option A-Left Gonadal Vein drains into left renal vein. Option B-Left Suprarenal Vein drains into left renal vein. Option C-Left inferior phrenic Vein drains into IVC. Option D-Right ascending lumbar vein drains into azygos vein.",
    "correct_choice_id": 200097,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "id": 50022,
    "choices": [
      {
        "id": 200099,
        "text": "Ascending colon"
      },
      {
        "id": 200100,
        "text": "Transverse colon"
      },
      {
        "id": 200101,
        "text": "Descending colon"
      },
      {
        "id": 200102,
        "text": "Sigmoid colon"
      }
    ],
    "text": "Shortest part of the colon is-",
    "unique_key": "Q9267363",
    "question_audio": null,
    "question_video": null,
    "map_id": 34222581,
    "difficulty_level": "intermediate",
    "subjects_id": [],
    "solution": "Correct Answer (A) Ascending colon The ascending colon is the shortest part of the colon. It begins at the cecum, where the ileum of the small intestine connects to the large intestine, and ascends along the right side of the abdomen to the hepatic flexure. Its short, vertical course makes it the shortest section of the colon compared to the other parts. Incorrect Responses: (B) Transverse colon The transverse colon is longer than the ascending colon. It runs horizontally across the abdominal cavity from the right to the left side, connecting the hepatic flexure on the right with the splenic flexure on the left. This makes it longer than the ascending colon, so B is incorrect. (C) Descending colon The descending colon extends downward on the left side of the abdomen, from the splenic flexure to the sigmoid colon. While it is relatively short, it is still longer than the ascending colon. Therefore, C is incorrect. (D) Sigmoid colon The sigmoid colon is also longer than the ascending colon. It has an S-shaped curve, extending from the descending colon to the rectum. This makes it one of the longer segments of the colon.",
    "correct_choice_id": 200099,
    "solution_audio": null,
    "solution_video": "",
    "audio_explanation_heading": null,
    "video_explanation_heading": null,
    "solution_media_position": "bottom",
    "tags": [],
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '04  Aorta  Ivc';
        const quizFilename = '04-aorta-ivc-db66fab4.html';
        let hierarchy = ["DAMS", "DQB", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on navigation
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>