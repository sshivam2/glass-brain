<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 3 - Physiology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "While flipping through a journal you come across an interesting case of Kartagener\u2019s syndrome. The defect is in specialized cellular appendages in the airways that are involved in expelling the mucus. Which of the following statement(s) is/are true regarding these appendages?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 3"
      },
      {
        "id": 2,
        "text": "1, 2, 3, 5"
      },
      {
        "id": 3,
        "text": "1 and 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Kartagener\u2019s syndrome</strong>, a type of primary ciliary dyskinesia, affects specialized cellular appendages known as<strong> cilia</strong> in various parts of the body, including the respiratory tree<strong>,</strong> where they help in expelling mucus. The <strong>true</strong> statement regarding cilia is <strong>2 and 3.</strong></p>\n<p><strong>Cilia</strong> are present in the epithelium of the respiratory passages, starting from the <strong>anterior third</strong> of the <strong>nose</strong> and extending to the <strong>bronchioles.</strong> However, they are<strong> absent</strong> in the last few generations of the airways, including the <strong>alveoli </strong>(statement 1). Cilia play a crucial role in clearing the airways as part of the '<strong>mucociliary escalator.</strong>'\u00a0</p>\n<p>On top of them, a <strong>mucus layer</strong> is present, aiding in<strong> trapping foreign particles</strong>. These particles are then transported through the <strong>synchronized</strong> <strong>metachronal rhythm</strong> of the cilia, which<strong> </strong>beat at a frequency of 10-20 times per second (statement 5). The direction of their 'power stroke' is always toward the pharynx; that is, the cilia in the <strong>lungs</strong> <strong>beat upward</strong>, whereas those in the <strong>nose beat downward </strong>(statement 4) This continual beating causes the<strong> </strong>mucus coat to flow slowly toward the pharynx. Subsequently, the mucus and its entrapped particles are either swallowed or coughed to the exterior.</p>\n<p>Cilia may be either <strong>motile </strong>(called secondary cilia) or <strong>non-motile</strong> (called primary cilia). The <strong>motile</strong> cilia<strong> </strong>contain a <strong>microtubule</strong> core arranged in a \u201c<strong>9+2</strong>\u201d pattern (nine pairs of microtubules around the circumference of the cilium and one pair of microtubules in the center) (statement 3). <strong>Dynein</strong> is the <strong>molecular</strong> <strong>motor</strong> that drives the movement<strong> </strong>of the cilium (statement 2). \u00a0</p>\n<p>Other<strong> </strong>sites where cilia are present include the <strong>fallopian tube, kidney</strong>, and <strong>inner ear</strong>. <strong>Nonmotile cilia</strong> serve as <strong>mechanoreceptors </strong>and are involved in determining<strong> left-right asymmetry</strong> of organs during<strong> </strong>embryological development, as well as sensing the flow rate of fluid in the nephron of the kidney.</p>\n<p><strong>Kartagener\u2019s syndrome </strong>or primary ciliary dyskinesia (also called immotile cilia syndrome) is an <strong>autosomal recessive</strong> disorder affecting ciliary motility. It occurs due to defects in the dynein arm of the cilia. This causes the retention of secretions due to a failed mucociliary clearance mechanism. Clinically, this manifests as the classical <strong>triad</strong> of <strong>s</strong><strong>itus inversus</strong>, <strong>c</strong><strong>hronic sinusitis</strong>, and <strong>b</strong><strong>ronchiectasis.</strong> Male patients with this condition tend to be <strong>infertile</strong>, due to <strong>asthenospermia</strong> (immotile spermatozoa due to impaired sperm flagella function).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old man who is a known case of DVT presents with sudden onset pleuritic chest pain and dyspnea. His ECG shows the characteristic S1Q3T3 changes. A chest X-ray was done which showed the following finding. Which of the following statements is true with respect to the V/Q mismatch in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Increased shunting in the lungs"
      },
      {
        "id": 2,
        "text": "pO2 of the alveolus will be equal to that in the inspired air"
      },
      {
        "id": 3,
        "text": "V/Q ratio of the alveolus equals to zero"
      },
      {
        "id": 4,
        "text": "Increased PCO2 in the pulmonary capillary blood"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">In the given clinical scenario, the presence of <strong>sudden onset</strong> <strong>pleuritic chest pain </strong>and <strong>dyspnea</strong> in a <strong>DVT</strong> patient, with ECG showing the characteristic <strong>S1Q3T3 changes</strong> and chest X-ray showing a <strong>hyper-lucent area</strong> with <strong>decreased vascularity</strong> <strong>(Westermark sign) </strong>are suggestive of <strong>pulmonary embolism.\u00a0</strong>Due to the presence of <strong>dead space</strong> in pulmonary embolism <strong>(V/Q = \u221e),</strong> the pO<sub>2</sub> of the<strong> alveolus</strong> will be <strong>equal </strong>to that in the <strong>inspired air</strong>.</p>\n<p class=\"p1\">In normal individuals, the V/Q ratio is around<strong> 0.8. </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">The ventilated alveoli are close to perfused capillaries, which allows for optimal gas exchange. A <strong>V/Q mismatch/defect</strong> can be induced by ventilation of non-perfused lung regions (dead space), where the\u00a0<strong>V/Q= \u221e.</strong></span></p>\n<p><strong>Pulmonary embolism </strong>is an example of dead space, in which blood flow to a section of the lung (or even the entire lung) is obstructed. Because no gas exchange occurs in dead space, PO<sub>2</sub> of the alveolus will be equal to that in the inspired air. <strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">PaO<sub>2</sub> is 150 mm Hg and PaCO<sub>2</sub> is 0.</span></strong></p>\n<p>Pulmonary embolism refers to embolic occlusion of the pulmonary arterial system. Most patients present with <strong>pleuritic chest pain, dyspnoea, </strong>and <strong>tachypnoea.</strong> The classical clinical triad of sudden onset of chest pain, dyspnoea, and hemoptysis is present in only a few cases.</p>\n<p>ECG changes in acute PE (shown below) are characterized by the classic\u00a0<strong>S1Q3T3 changes</strong>, due to right ventricular strain and ischemia:</p>\n<ul>\n<li>A prominent S wave in lead I (blue arrow)</li>\n<li>Q wave in lead III (red arrow)</li>\n<li>An inverted T wave in lead III (green arrow)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dcd38e9531ec47c7891c7a9812316964.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/089f61424ad54205b76a111ee834b6f8x1280x674.JPEG"
    ]
  },
  {
    "text": "A baby born at 26 weeks of gestation presented with cyanosis, tachypnea, and grunting 3 hours after birth. Auscultation revealed decreased air entry and bilateral homogenous opacification of the lungs on the chest radiograph. This is likely due to a defect in the synthesis of?",
    "choices": [
      {
        "id": 1,
        "text": "Dipalmitoyl serine"
      },
      {
        "id": 2,
        "text": "Dipalmitoyl lecithin"
      },
      {
        "id": 3,
        "text": "Dipalmitoyl cephalin"
      },
      {
        "id": 4,
        "text": "Dipalmitoyl inositol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A preterm baby having respiratory distress along with homogenous opacification of the lungs\u00a0is suggestive of<strong> respiratory distress syndrome </strong>which\u00a0is likely due to a defect in the synthesis of\u00a0<strong>dipalmitoyl lecithin</strong>.</p>\n<p>Respiratory distress syndrome (RDS),\u00a0also known as<strong>\u00a0hyaline membrane disease</strong>, is due to the <strong>decreased\u00a0</strong>production and secretion of the<strong>\u00a0lung surfactant</strong>. It is primarily made of <strong>phospholipids </strong>such as<strong>\u00a0</strong>dipalmitoyl\u00a0lecithin (otherwise known as\u00a0<strong>dipalmitoylphosphatidylcholine</strong>). The other minor components are\u00a0phosphatidylglycerol, apoproteins, and cholesterol.\u00a0It is synthesized in <strong>type II pneumocytes</strong>/granular pneumocytes in the endoplasmic reticulum (shown below).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7901dad0826f48d1a03a6ae952a50a5fx1280x1449.JPEG"
    ]
  },
  {
    "text": "A concerned mother brings her baby to the OPD saying that the baby defecates shortly after every meal. Which of the following GIT hormones amplify this response?",
    "choices": [
      {
        "id": 1,
        "text": "Secretin"
      },
      {
        "id": 2,
        "text": "Motilin"
      },
      {
        "id": 3,
        "text": "Cholecystokinin"
      },
      {
        "id": 4,
        "text": "Gastrin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given scenario of the baby defecating shortly <strong>after every meal</strong> is a classic description of the <strong>gastrocolic reflex</strong>. <strong>Gastrin</strong>\u00a0<strong>amplifies</strong> the gastrocolic reflex.</p>\n<p><strong>Distension of the stomach</strong> and digestive byproducts in the small intestine activate afferents to the <strong>prevertebral sympathetic ganglia</strong>. This results in stimulation of the colon and an urge to defecate. This is known as the\u00a0<strong>gastrocolic reflex</strong>. This reflex is <strong>amplified</strong> <strong>by</strong> the action of <strong>gastrin</strong>.</p>\n<p>GIT reflexes which are mediated by <strong>prevertebral sympathetic ganglia</strong> include:</p>\n<ul>\n<li><strong>Gastrocolic reflex</strong></li>\n<li><strong>Enterogastric reflex</strong> \u2192 signals from the colon and small intestine <strong>inhibit stomach motility</strong> and secretion</li>\n<li><strong>Colonoileal reflex</strong> \u2192 signals from the colon to <strong>inhibit</strong> the <strong>emptying</strong> of <strong>ileal contents</strong> into the colon</li>\n</ul>\n<p>GIT reflexes which are mediated by the\u00a0<strong>brain stem</strong> and <strong>spinal cord</strong> include:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Pain reflexes that cause inhibition of the whole gastrointestinal tract</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Long-distance vagal reflexes regulating gastric motor and secretory activity</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Defecation reflex</strong> \u2192 Distension of the rectum and colon results in powerful contractions of the rectum, colon, and abdominal wall which are required for defecation.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly patient who presented with chest pain is undergoing coronary angiography. When the cardiologist injected the radiocontrast dye into the patient, the patient developed profound bradycardia, hypotension, and a brief period of apnea followed by rapid shallow breathing. The reflex that is responsible for this scenario is",
    "choices": [
      {
        "id": 1,
        "text": "J reflex"
      },
      {
        "id": 2,
        "text": "Cushing reflex"
      },
      {
        "id": 3,
        "text": "Bainbridge reflex"
      },
      {
        "id": 4,
        "text": "Bezold-Jarisch reflex"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Reflex responsible for the above scenario is the <strong>Bezold Jarisch reflex.&nbsp;</strong></p>\n<p class=\"p1\">Activation of <strong>chemosensitive vagal C fibres</strong> in the cardiopulmonary region (eg, juxtacapillary region of alveoli, ventricles, atria, great veins, and pulmonary artery) causes profound <strong>bradycardia</strong>, <strong>hypotension</strong>, and a brief period of <strong>apnea</strong> followed by <strong>rapid shallow breathing</strong>. This is called the Bezold Jarisch reflex and can be elicited by&nbsp;capsaicin, serotonin, phenylbiguanide, and veratridine. It can also be activated during myocardial infarction and on exposure to radioactive dyes during coronary angiography.</p>\n<p class=\"p1\">Other options</p>\n<p class=\"p1\">Option A- C fibre endings close to the pulmonary vessels are called <strong>J (juxtacapillary) receptors</strong>. These receptors are stimulated by hyperinflation of the lungs or intravenous administration of capsaicin. The reflex produced is apnea followed by rapid breathing, bradycardia and hypotension. This is called the <strong>J reflex.</strong></p>\n<p class=\"p1\">Option B-<strong> Cushing reflex</strong> is the <strong>increased blood pressure</strong> and <strong>bradycardia</strong> seen in patients with raised intracranial pressure. Increased intracranial pressure compresses the cerebral blood vessels and causes <strong>hypercapnia</strong>. This stimulates the central chemoreceptors located in the ventrolateral surface of the medulla and causes increased blood pressure. This increase is proportional to the increase in the intracranial pressure. Increased blood pressure stimulates baroreceptors and causes bradycardia.</p>\n<p class=\"p1\">Option C- <strong>Brainbridge reflex</strong> is the <strong>increase</strong> in the <strong>heart rate</strong> when the atrium is <strong>stretched. </strong>Whenever there is a stretch of the atrium, the stretch receptors are activated. They transmit their afferent signals through the vagus nerves to the medulla of the brain. Efferent signals are then transmitted back through vagal and sympathetic nerves to increase the heart rate and strength of heart contraction. This reflex prevents the accumulation of blood in the atria, veins and pulmonary circulation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presented with symptoms of delayed adaptation to vision in dark places, gritty sensation in the eyes, and dry eyes. Arrange the following in order of their appearance in the cycle occurring in the retina affected in this patient.",
    "choices": [
      {
        "id": 1,
        "text": "1-3-4-5-2"
      },
      {
        "id": 2,
        "text": "1-3-2-4-5"
      },
      {
        "id": 3,
        "text": "1-2-3-4-5"
      },
      {
        "id": 4,
        "text": "2-1-3-5-4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of a patient with delayed adaptation to vision in <strong>dark places</strong>, <strong>gritty sensation</strong> in the eyes, and <strong>dry eyes</strong> is that of <strong>vitamin A deficiency</strong>. The cycle occurring in the retina affected in this patient is <strong>Wald's visual cycle</strong> due to the deficiency of <strong>11-cis retinaldehyde </strong>(retinal), a form of vitamin A. The correct sequence of this cycle is <strong>1-3-2-4-5.</strong></p>\n<p>1. Rhodopsin\u00a0<br />3. Bathorhodopsin<br />2. Lumirhodopsin<br />4. Metarhodopsin<br />5. Scotopsin</p>\n<p><strong>Rhodopsin</strong>, the visual pigment of the rod cells in the retina, consists of <strong>11-cis retinal</strong> specifically bound to the protein opsin. When rhodopsin is <strong>exposed to light</strong>, a series of photochemical isomerizations occurs. This results in the bleaching of the visual pigment and release of <strong>all-trans-retinal </strong>and <strong>opsin.</strong> This process triggers a <strong>nerve impulse</strong> that is transmitted by the <strong>optic nerve</strong> to the brain.</p>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">The image given below shows Wald's visual cycle.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e1554173235345298919bfbb3892c3a8x1279x1623.JPEG"
    ]
  },
  {
    "text": "A patient was admitted for acute diarrhea and vomiting 2 days ago. The doctor on duty assessed that he has recovered from dehydration and ordered discontinuation of the IV fluids. The ward nurse by mistake administered 0.45% NaCl to this patient. Which of the following Darrow-Yannet diagrams represents the fluid shift in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Image 2"
      },
      {
        "id": 2,
        "text": "Image 4"
      },
      {
        "id": 3,
        "text": "Image 1"
      },
      {
        "id": 4,
        "text": "Image 3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient\u00a0did not need IV fluids but was administered <strong>hypotonic saline (0.45% NaCl)</strong>. The\u00a0Darrow Yannet diagram in\u00a0<strong>image 3</strong> represents the fluid shift in case of hypotonic fluid administration as seen in this patient.\u00a0</p>\n<p><strong>Darrow Yannet diagrams\u00a0</strong>depict the change in plasma osmolarity and plasma volume in various conditions. The dotted line in the diagram is the change after either the addition or removal of fluid.</p>\n<p><strong>Hypotonic saline</strong> leads to the <strong>decreased</strong> osmolarity of the ECF. This causes a <strong>shift of fluid</strong> from the ECF to the ICF until the osmolarity of both compartments becomes equal. The fluid influx leads to a <strong>decrease</strong> in the osmolarity of the ICF as well. The net result is the decreased osmolarity and increased volume of both the compartments.</p>\n<p><strong>Other options:</strong></p>\n<p><strong>Image 1</strong>- <strong>Normal</strong> ECF and ICF balance.</p>\n<p><strong>Image 2-\u00a0</strong>The addition of isotonic saline to ECF does not cause any fluid shift from the ICF. Hence, it only leads to an <strong>increase</strong> in ECF volume without causing any change in osmolarity.</p>\n<p><strong>Image 4-</strong> The addition of hypertonic saline to the ECF pulls the fluid from the ICF into the ECF. This results in a <strong>decreased</strong> volume of ICF, <strong>increased</strong> volume of ECF, and <strong>increased</strong> <strong>osmolarity</strong> in both ECF and ICF.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da9f45b69bd44d22889c37659f6f881f.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/345e3ebef1344e3e8d833b6714196613x1280x1825.JPEG"
    ]
  },
  {
    "text": "The pupillary light reflex is being assessed in a child with suspected cranial nerve palsy. Which two cranial nerves are being tested here?",
    "choices": [
      {
        "id": 1,
        "text": "2nd and 5th cranial nerves"
      },
      {
        "id": 2,
        "text": "3rd and 5th cranial nerves"
      },
      {
        "id": 3,
        "text": "2nd and 3rd cranial nerves"
      },
      {
        "id": 4,
        "text": "3rd and 7th cranial nerves"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong>\u00a02<sup>nd</sup></strong>\u00a0and <strong>3<sup>rd</sup>\u00a0</strong>cranial nerves are being tested during the pupillary light reflex.<strong>\u00a0</strong>The<strong> afferent </strong>of <strong>pupillary light reflex</strong> is\u00a0the<strong> 2<sup>nd</sup>\u00a0</strong>cranial nerve and the\u00a0<strong>efferent </strong>is\u00a0the\u00a0<strong>3<sup>rd\u00a0</sup></strong>cranial nerve.</p>\n<p>When light is shone in one eye, the pupils of both eyes constrict.\u00a0</p>\n<ul>\n<li>Constriction of the pupil of the same eye is called <strong>direct reflex.</strong></li>\n<li>Constriction of the contralateral pupil is called <strong>consensual reflex/indirect reflex.\u00a0</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7853040afd94e54a38f9c9cafad101cx1250x1259.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b2e91359c0e1469f9f766b68ab475ed4x1280x1883.JPEG"
    ]
  },
  {
    "text": "A 55-year-old man comes to his primary-care clinician complaining of erectile dysfunction. He is given a prescription for sildenafil, and on follow-up, reports that his ability to sustain an erection has been improved markedly by this treatment. The action of which of the following vasoactive mediators would primarily be prolonged in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Histamine"
      },
      {
        "id": 2,
        "text": "Endothelin-1"
      },
      {
        "id": 3,
        "text": "Prostacyclin"
      },
      {
        "id": 4,
        "text": "Nitric oxide"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The action of <strong>nitric oxide</strong> would primarily be prolonged in this patient.</p>\n<p><strong>Sildenafil </strong>is used to treat erectile dysfunction. It <strong>inhibits cGMP-specific phosphodiesterase-5</strong> (PDE-5), an enzyme that degrades cGMP, thereby effectively <strong>prolonging the action of NO.</strong></p>\n<p><strong>Penile erection</strong> is produced by the release of <strong>nitric oxide (NO)</strong>, with consequent vasodilation and engorgement of the <strong>corpora cavernosa</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man working in a loud machinery unit came to the OPD complaining of hearing loss for the past 3 months. He also complains of high-pitched tinnitus and is unable to hear in noisy environments. On pure tone audiometry, a downsloping audiogram is seen. Which of the following ions is responsible for the depolarisation of hair cells in the affected structure?",
    "choices": [
      {
        "id": 1,
        "text": "K+"
      },
      {
        "id": 2,
        "text": "Na+"
      },
      {
        "id": 3,
        "text": "Na+ & Ca+"
      },
      {
        "id": 4,
        "text": "Cl-"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario of a 30-year-old man with <strong>hearing loss</strong> and pure tone audiometry showing a <strong>downsloping </strong>audiogram is suggestive of<strong> noise-induced hearing loss. K<sup>+</sup> ion</strong> is responsible for <strong>depolarising hair cells</strong> in the cochlea.</p>\n<p>Noise-induced hearing loss is a <strong>sensorineural </strong>hearing loss and is seen in chronic exposure to loud sounds in occupation. It is caused by irreversible damage to the <strong>outer hair cells</strong> in the organ of Corti. As the duration of noise exposure increases, the notch becomes deeper and wider, involving lower and higher frequencies.</p>\n<p>PTA showing noise-induced hearing loss as downsloping audiogram:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f7492eaccae448009e56466e5ce22623x1280x1623.JPEG"
    ]
  },
  {
    "text": "An elderly patient was diagnosed with ischemic heart disease and was started on beta-blockers. However, the patient continued to have symptoms despite its use. He was then started on ivabradine. This drug improves the symptoms of angina by which of the following mechanisms?",
    "choices": [
      {
        "id": 1,
        "text": "Decreasing the cardiac contractility"
      },
      {
        "id": 2,
        "text": "Decreasing the oxygen demand"
      },
      {
        "id": 3,
        "text": "Increasing the coronary blood flow"
      },
      {
        "id": 4,
        "text": "Decreasing the preload"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 261\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p class=\"p1\"><strong>Ivabradine</strong> decreases the automaticity in the sinoatrial node and thus <strong>reduces</strong> the <strong>heart rate </strong>improving the symptoms of angina. This reduction in the heart rate <strong>decreases the myocardial oxygen demand.</strong></p>\n<p class=\"p1\">The oxygen requirement of the heart mainly depends on the work done by the heart. This work mainly depends on cardiac output and peripheral resistance. An increase in these parameters will increase the oxygen requirement of the heart.</p>\n<p class=\"p1\">Important determinants of cardiac output are:</p>\n<p class=\"p1\"><strong>Stroke volume</strong>- It is the amount of blood pumped out of the heart during each heartbeat. This stroke volume increases whenever, there is <strong>increased venous</strong> return to the heart, increased end-diastolic volume (<strong>preload</strong>), and increased contractility. Contractility further depends on the <strong>initial length</strong> of the cardiac muscle fiber and the <strong>autonomic innervation.</strong></p>\n<p class=\"p1\"><strong>Heart rate</strong>- Increased heart rate increases the cardiac output which in turn increases the oxygen requirement. Heart rate\u00a0is controlled primarily by the autonomic nerves, with sympathetic stimulation increasing the rate and parasympathetic stimulation decreasing the rate.</p>\n<p class=\"p1\"><strong>Afterload-</strong> The tension at which the load is lifted is called afterload. As the afterload increases, the heart has to work more to pump blood to the organs. This in turn results in increased oxygen requirement. It is dependent on the <strong>peripheral resistance.\u00a0</strong></p>\n<p class=\"p1\">Drugs used in the management of angina either decrease the work done by the heart or increase the blood flow to the heart.</p>\n<ul>\n<li class=\"p1\"><strong>Nitrates</strong>- They increase the cGMP and cause vasodilation. It mainly results in an increase in venous capacitance and a decrease in the ventricular preload. They might also increase coronary flow in some areas and variant anginas.</li>\n<li class=\"p1\"><strong>Calcium channel blockers</strong>- Blocking the calcium channels leads to the relaxation of vascular smooth muscles and decreased impulses in the conduction system. This leads to decreased peripheral resistance,\u00a0decreased blood pressure, decreased contractility, decreased heart rate, and decreased oxygen requirement of the heart.</li>\n<li class=\"p1\"><strong>Beta-blockers</strong>- They decrease the oxygen requirement by decreasing the\u00a0heart rate, blood pressure, and contractility. Some drugs like carvedilol and nebivolol also cause vasodilation.</li>\n</ul>\n<p class=\"p1\"><strong>Newer antianginal drugs</strong></p>\n<ul>\n<li class=\"p1\"><strong>Ranolazine-\u00a0</strong>It inhibits the late sodium current and reduces the intracellular calcium concentration. It reduces diastolic tension, cardiac contractility, and work.</li>\n<li class=\"p1\"><strong>Trimetazidine</strong>- inhibits the fatty acid oxidation in the myocardium. It decreases the oxygen requirement of the heart.</li>\n<li class=\"p1\"><strong>Ivabradine-\u00a0</strong>decreases the heart rate and decreases oxygen requirement.</li>\n<li class=\"p1\"><strong>Fasudil-\u00a0</strong>It is a Rho kinase inhibitor. It is useful in coronary vasospasm.</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Oxytocin is released when the cervix is stretched by the fetal head, leading to uterine contractions. What is the control mechanism in the above reflex?",
    "choices": [
      {
        "id": 1,
        "text": "Negative feedback"
      },
      {
        "id": 2,
        "text": "Feed-forward control"
      },
      {
        "id": 3,
        "text": "Positive feedback"
      },
      {
        "id": 4,
        "text": "Adaptive control"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The reflex described is the <strong>parturition reflex</strong>, a <strong>positive feedback </strong>mechanism (option C).\u00a0</p>\n<p>A <strong>positive feedback</strong> mechanism is one in which the stimulus of the mechanism leads to enhancement and further continuation of the mechanism. In the <strong>parturition reflex</strong>, <strong>cervical stretch</strong> due to uterine contractions stimulates the <strong>release</strong> of <strong>oxytocin</strong>, which further <strong>increases</strong> the <strong>uterine contractions</strong>. Thus, there is increased cervical stretch and oxytocin release. A positive feedback loop is established. This continues till the expulsion of the products of conception.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3d765cf8530a4728812c0b04be3ce6b5x1077x1600.JPEG"
    ]
  },
  {
    "text": "A 32-year-old multipara at 40 weeks gestation developed water intoxication and hyponatremia following prolonged intravenous infusion with oxytocin by an inexperienced junior resident. This adverse effect is due to oxytocin's action on which of the following sites?",
    "choices": [
      {
        "id": 1,
        "text": "Vasopressin V2 receptors on basal surface of renal tubular cells"
      },
      {
        "id": 2,
        "text": "Vasopressin V2 receptors on apical surface of renal tubular cells"
      },
      {
        "id": 3,
        "text": "Vasopressin V1 receptors on basal surface of renal tubular cells"
      },
      {
        "id": 4,
        "text": "Vasopressin V1 receptors on apical surface of renal tubular cells"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Oxytocin</strong>\u00a0can bind to <strong>V2</strong> receptors on<strong>\u00a0</strong>the<strong> basal </strong>surface of renal tubular cells resulting in<strong> reduced free water clearance. </strong></p>\n<p>This is because oxytocin and vasopressin have structural similarities.\u00a0Oxytocin can have vasopressin <strong>(ADH) like activity </strong>at<strong> V2 receptors </strong>on the<strong> basal </strong>surface<strong> </strong>of <strong>principal cells </strong>that line the <strong>distal tubules</strong> and medullary <strong>collecting tubules </strong>of the kidney. The increase in water permeability occurs through the insertion of aquaporin-2 on the apical surface of the principal cells of the kidney which allows water to through the cell down the <strong>osmotic gradient</strong> created by the hypertonicity of the renal medulla.\u00a0</p>\n<p>Prolonged intravenous administration of oxytocin at <strong>high</strong> doses in conjunction with large volumes of <strong>hypotonic</strong> fluid may cause <strong>water intoxication</strong> associated with <strong>hyponatremia.</strong></p>\n<p>To avoid this complication, whenever high doses of oxytocin are administered over a long time:</p>\n<ul>\n<li>An electrolyte-containing diluent must be used (not dextrose).</li>\n<li>The volume of infused fluid should be kept low (by infusing oxytocin at a higher concentration).</li>\n<li>Fluid intake must be restricted, a fluid balance chart should be kept and serum electrolytes should be monitored.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-month-old infant is found to have a weak cry, paralysis, and loss of head control. The mother gives a recent history of feeding honey. A toxin screen of the stool identified the agent. This toxin blocks acetylcholine release by inhibiting which of the following proteins?",
    "choices": [
      {
        "id": 1,
        "text": "Megalin"
      },
      {
        "id": 2,
        "text": "Clathrin"
      },
      {
        "id": 3,
        "text": "Synaptobrevin"
      },
      {
        "id": 4,
        "text": "Desmin"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of the infant having a <strong>weak cry, paralysis, </strong>and <strong>loss of head control </strong>with a history of<strong> honey ingestion </strong>is suggestive of <strong>infant botulism. The botulinum toxin </strong>causes <strong>flaccid paralysis </strong>by blocking the release of acetylcholine\u00a0by<strong> inhibiting synaptobrevin.</strong></p>\n<p>Infant botulism is also called <strong>floppy baby syndrome</strong>. It is usually seen in infants less than 6 months. It is acquired by ingestion of foods like <strong>honey</strong> contaminated with <em>C. botulinum</em> spores. It gets established in the gut and produces toxins. Affected children usually present with paralysis, constipation, difficulty breathing, poor feeding, weakness, altered crying, and loss of head control.</p>\n<p>Diagnosis is confirmed by detecting <strong>toxins</strong> or <strong>spores</strong> in the stool. Gram staining shows <strong>gram-positive</strong>, sporing bacilli. It is managed by supportive care and assisted feeding only.</p>\n<p>The image given below shows gram staining of <em>Clostridium botulinum.</em></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a442984184ac4299bbe9d409716cea99x468x319.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/38607201281e4ab491a35b5f73ca5a66x1280x2234.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d5bc0e4f84e41c2af591374ce11eca2x720x580.JPEG"
    ]
  },
  {
    "text": "A 42-year-old male patient sustained a head injury in a road traffic accident. During the examination, the patient was unable to recall his name, the name of the place he lives in, or his date of birth. However, he was still able to remember the events such as his marriage. His non-declarative memory is intact. Which of the following areas of the brain is most likely to be affected?",
    "choices": [
      {
        "id": 1,
        "text": "Prefrontal cortex"
      },
      {
        "id": 2,
        "text": "Neocortex"
      },
      {
        "id": 3,
        "text": "Amygdala"
      },
      {
        "id": 4,
        "text": "Striatum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the above clinical scenario, the patient had a loss of memory associated with the <strong>facts (semantic memory),</strong> suggestive of injury to the <strong>prefrontal cortex</strong> or anterior/lateral temporal cortex.</p>\n<p><strong>Forms of memory</strong> are classified into two types, explicit and implicit.</p>\n<p><strong>Explicit/declarative memory</strong><strong>\u00a0</strong>is the memory of factual knowledge about people, places, things, and events. It is associated with consciousness/awareness.\u00a0They are of two types:</p>\n<ul>\n<li><strong>Semantic memory\u00a0</strong>(facts) e.g., knowing the capital of India, date of birth, names of people, etc. The parts of the brain involved are the lateral &amp; anterior temporal cortex and <strong>prefrontal cortex.</strong></li>\n<li><strong>Episodic memory\u00a0</strong>(events) e.g., recalling the events that occurred on the first day in college. The parts of the brain involved are the hippocampus, medial temporal lobe, and <strong>neocortex</strong>.\u00a0</li>\n</ul>\n<p><strong>Implicit memory/Non-declarative memory\u00a0</strong>does not involve consciousness or awareness. They are of 4 types:</p>\n<ul>\n<li><strong>Procedural memory\u00a0</strong>refers to skills and habits, which, once acquired, become unconscious and automatic, such as riding a bicycle or driving a car. It is processed in the <strong>striatum</strong>.</li>\n<li><strong>Priming\u00a0</strong>refers to the facilitation of the recognition of words or objects by prior exposure to them. It is dependent on the <strong>neocortex</strong>.</li>\n<li><strong>Non-associative learning\u00a0</strong>includes habituation and sensitization. It is dependent on various <strong>reflex</strong> pathways.</li>\n<li><strong>Associative learning </strong>includes\u00a0classical and operant conditioning in which one learns about the relationship between one stimulus and another. It is dependent on the <strong>amygdala</strong> for its emotional responses and the cerebellum for the motor responses.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You evaluate a 60-year-old man who presented with difficulty in forming words. He can make noises and give expressions as if he understood the questions asked. Which of the Brodmann areas is likely to be affected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "22"
      },
      {
        "id": 3,
        "text": "42"
      },
      {
        "id": 4,
        "text": "44"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of an elderly man with <strong>difficulty in forming words</strong> and <strong>intact comprehension</strong> is suggestive of<strong> Broca's aphasia</strong> in which the <strong>Brodmann area 44</strong> will be affected.</p>\n<p>In Broca's aphasia/motor aphasia/non-fluent aphasia, areas 44 and 45 in the prefrontal and premotor facial regions of the cerebral cortex are affected. The affected individuals will have <strong>difficulty forming verbal</strong> or<strong> written words.</strong>\u00a0The <strong>comprehension</strong> aspect of speech is <strong>preserved</strong> but the person cannot repeat or name the words and lacks fluency.</p>\n<p>Patients in whom the area is severely affected may have very few words to express all of their emotions.</p>\n<p>Other options:</p>\n<p>Option A:<strong> Area 4</strong> corresponds to the <strong>primary motor area\u00a0</strong>which is responsible for initiating and coordinating motor activities.</p>\n<p>Option B:<strong> Area 22</strong> corresponds to <strong>Wernicke's speech area</strong> which is responsible for the <strong>interpretation</strong> and understanding of verbal and written words. Lesions in this area will result in <strong>fluent aphasia</strong> in which the person talks with increased fluency with new words but is inappropriate to the context due to lack of interpretation.\u00a0</p>\n<p>Option C:<strong> Area 42</strong> corresponds to the<strong> primary auditory area </strong>responsible for the reception of various auditory stimuli.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man who was stuck inside a building that caught fire was rescued and brought to the hospital. His oxygen-hemoglobin dissociation curve was found to be shifted in the same direction as",
    "choices": [
      {
        "id": 1,
        "text": "Hyperthermia"
      },
      {
        "id": 2,
        "text": "Methemoglobin"
      },
      {
        "id": 3,
        "text": "Chronic anemia"
      },
      {
        "id": 4,
        "text": "Sulfhemoglobin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given scenario, the patient most likely has\u00a0<strong>carbon monoxide poisoning\u00a0</strong>due to smoke inhalation.\u00a0The O<sub>2</sub>\u2013Hb dissociation curve <strong>shifts to the left </strong>due to<strong> carboxyhemoglobin. </strong>The<strong> leftward </strong>shift is also seen with<strong>\u00a0methemoglobin,\u00a0</strong>fetal hemoglobin, hypothermia, alkalosis, decreased pCO<sub>2</sub>, and decreased 2,3- diphosphoglyceric acid (2,3-DPG).</p>\n<p><strong>Methemoglobin</strong> forms when hemoglobin is oxidized, causing the iron to shift from its normal ferrous (Fe\u00b2\u207a) state to the ferric (Fe\u00b3\u207a) state. When any of the four iron atoms in a hemoglobin molecule are in the ferric state, they can no longer bind oxygen. The presence of ferric iron induces <strong>allosteric</strong> changes in the hemoglobin structure, resulting in a leftward shift of the oxygen-dissociation curve. This shift <strong>increases the affinity</strong> of the remaining ferrous iron for oxygen, but it <strong>impairs oxygen release</strong> to tissues. Consequently, this disruption leads to reduced oxygen delivery and <strong>tissue hypoxia. </strong>Treatment of methemoglobinemia involves supportive care, cessation of offending drug, and reduction of methemoglobin to hemoglobin by intravenous <strong>methylene blue</strong>.</p>\n<p>In <strong>carbon monoxide poisoning</strong>, the affinity of Hb for CO is about 200 times more than that for O2, and hence, the <strong>carboxyhemoglobin</strong> releases the CO into the blood very slowly. <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Treatment of CO poisoning consists of ventilation with oxygen since oxygen hastens the dissociation of carboxyhemoglobin.\u00a0</span></p>\n<p>The other options such as <strong>hyperthermia, chronic anemia, </strong>and <strong>sulfhemoglobin</strong> will shift the oxygen-hemoglobin dissociation curve to the <strong>right</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d70303db18e9486ea1af8e03fc0831e4x1280x1379.JPEG"
    ]
  },
  {
    "text": "A young female patient is undergoing evaluation for infertility. The gynecologist collects the cervical mucus and spreads it on the microscope. It shows the following appearance. The patient had her periods 22 days back. Which of the following statements is true regarding this patient?",
    "choices": [
      {
        "id": 1,
        "text": "The patient has not ovulated"
      },
      {
        "id": 2,
        "text": "This finding occurs due to progesterone"
      },
      {
        "id": 3,
        "text": "She is in mid luteal phase"
      },
      {
        "id": 4,
        "text": "Associated with thick cervical mucus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>true statement</strong> regarding this patient is that she has <strong>not ovulated</strong>. The presence of a <strong>fern pattern</strong>\u00a0of cervical mucus on the 22nd day of her menstrual cycle indicates that she has not ovulated.\u00a0</p>\n<p><strong>Estrogen</strong> makes the\u00a0cervical mucus <strong>thinner</strong> and more alkaline to promote easy survival and transport of sperm. When the mucus is spread on the slide, it shows the <strong>fern pattern.\u00a0After ovulation</strong> and during pregnancy, the levels of <strong>progesterone</strong> rise and this hormone makes the cervical mucus <strong>thick</strong>. The ferning pattern will no longer be seen.\u00a0</p>\n<p>The mucus is thinnest at the time of ovulation due to the increased levels of estrogen. It can be\u00a0stretched into a long, thin thread that may be 8\u201312 cm or more in length. This is called\u00a0the <strong>spinnbarkeit phenomenon.</strong></p>\n<p><strong>Before ovulation</strong>, the phase is known as the <strong>preovulatory phase</strong> or the <strong>follicular phase</strong> of the cycle. The uterus is undergoing proliferative changes, hence it is also known as the <strong>proliferative phase</strong>. <strong>After ovulation</strong> occurs, the corpus luteum secretes estrogen and progesterone and this phase is known as the <strong>luteal phase</strong> or <strong>secretory phase</strong>. In this phase, the uterus is vascular, and edematous with coiled glands.</p>\n<p>\u00a0The tests for ovulation are:</p>\n<ul>\n<li>The <strong>body temperature</strong> decreases during ovulation and increases by <strong>1/2 to 1\u00b0F.\u00a0</strong>This is due to the thermogenic action of the <strong>progesterone.</strong></li>\n<li><strong>Endometrial biopsy</strong>- usually done 1-2 days before menstruation. The presence of secretory changes in the endometrium suggests that ovulation has occurred.\u00a0</li>\n<li><strong>Fern test</strong>- The appearance of a fern pattern is seen before ovulation. After ovulation, the progesterone thickens the cervical mucus leading to the loss of fern pattern.</li>\n<li><strong>Ultrasound</strong>- used to monitor the maturation of the Graffian follicle and ovulation.</li>\n<li>Hormonal studies -\u00a0Increased levels of <strong>plasma progesterone</strong> (~15 ng/mL) in the mid-luteal phase (22\u201323rd day) suggest that ovulation has occurred and determination of LH surge.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/09739390c82043cbae9a3a0a626d9dac.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77d12e6cd77343edb5cfad5eae2e562ex430x420.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fb15fd9f4de64d94a708c0519d96610fx600x655.JPEG"
    ]
  },
  {
    "text": "After hitting your elbow against the wall, rubbing the affected area seems to relieve the pain. The stimulation of which of the following fibers is responsible for this?",
    "choices": [
      {
        "id": 1,
        "text": "B fibers"
      },
      {
        "id": 2,
        "text": "A\u03b3 fibers"
      },
      {
        "id": 3,
        "text": "A\u03b2 fibers"
      },
      {
        "id": 4,
        "text": "C fibers"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The pain relief experienced after rubbing the affected area is due to the stimulation of\u00a0<strong>A\u03b2 sensory fibers.</strong></p>\n<p>The stimulation of <strong>large-type A\u03b2 sensory fibers</strong> from peripheral tactile receptors <strong>depresses pain signal transmission</strong> from the same body area. This occurs due to <strong>local lateral inhibition</strong> in the spinal cord.</p>\n<p>The activity of these cutaneous mechanosensitive afferents may reduce the responsiveness of dorsal horn neurons to the nociceptive input from afferent terminals.\u00a0It explains why rubbing the skin near painful areas offers pain relief, and also explains why the <strong>local application of liniments</strong> relieves pain.</p>\n<p>This is called the <strong>gate-control mechanism</strong> of pain modulation. It is the principle behind the use of <strong>transcutaneous electrical nerve stimulation (TENS)</strong> for pain relief. <strong>TENS</strong> uses electrodes to activate <strong>A\u03b1 and A\u03b2 fibers</strong> near the injury.</p>\n<p>Note:<br /><strong>Pain</strong> stimulus is transmitted by <strong>A\u03b4</strong>\u00a0(fast pain) and<strong> C fibers</strong> (slow pain).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/476e37f7c0914b53b02aad21b091c361x1280x1288.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf13d0cfd1e64bc4a81757b72bc4b57dx1280x1131.JPEG"
    ]
  },
  {
    "text": "A patient who consumes non-iodized salt presents with weight gain, constipation, hair loss, and fatigue for 3 months. On examination, the finding given below is seen. What is the reason for the presence of this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated plasma TSH levels"
      },
      {
        "id": 2,
        "text": "Wolff-Chaikoff effect"
      },
      {
        "id": 3,
        "text": "Stimulation by TSH receptor antibodies"
      },
      {
        "id": 4,
        "text": "Mucopolysaccharide deposition"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows the <strong>diffuse enlargement</strong> of the thyroid gland known as <strong>goiter</strong>. A patient who consumes <strong>non-iodized salt</strong> and has weight gain, constipation, hair loss, and fatigue has hypothyroidism due to <strong>iodine deficiency</strong>. The reason for the presence of goiter in this condition is<strong> elevated </strong>plasma<strong> TSH levels</strong>.</p>\n<p><strong>Goitre</strong> is the <strong>diffuse enlargement</strong> of the thyroid gland. It may be seen in hyperthyroidism, hypothyroidism, and euthyroidism as well. It is caused by the action of<strong> excess TSH </strong>or substances similar to TSH on the thyroid gland. This is due to the <strong>trophic action</strong> of <strong>TSH </strong>on the thyroid gland i.e. it causes<strong> hypertrophy</strong> and <strong>hyperplasia</strong> of the <strong>follicular cells.</strong></p>\n<p>In patients with <strong>iodine deficiency</strong>, the production of thyroid hormones is impaired and features of <strong>hypothyroidism</strong> develop. <strong>Decreased</strong> levels of the <strong>thyroid hormones</strong> result in <strong>increased TSH </strong>secretion from the anterior pituitary via negative feedback. TSH stimulates hypertrophy and hyperplasia of follicular cells and the secretion of large amounts of thyroglobulin. Thus, the thyroid gland enlarges. This condition is known as <strong>endemic goiter.</strong></p>\n<p>Other causes of <strong>hypothyroidism</strong> resulting in goiter are <strong>autoimmune thyroiditis, deiodinase deficiency</strong>, and disorders of iodide trapping, peroxidase, or coupling systems. Consumption of food containing <strong>goitrogenic</strong> <strong>substances</strong> (eg: turnips, cabbages) also results in goiter.</p>\n<p>Other options:</p>\n<p>Option B:<strong> Wolff-Chaikoff effect </strong>is the transient inhibition of the organification of iodide when<strong> large doses</strong> of<strong> iodide</strong> are consumed. This results in a decrease in thyroid hormone synthesis. \u00a0This effect will not be seen in this patient who consumes non-iodized salt.</p>\n<p>Option C: In <strong>Grave\u2019s disease</strong>,<strong> TSH-receptor antibodies</strong> are present. They act similar to TSH and stimulate excessive secretion of thyroid hormones. Patients with Grave\u2019s disease present with goiter, weight loss, exophthalmos, tremors, and tachycardia. \u00a0</p>\n<p>Option D: <strong>Mucopolysaccharide</strong> deposition is the mechanism of <strong>myxedema</strong> formation in <strong>hypothyroid </strong>patients. The deposition results in fluid filtration out of the capillaries and the formation of <strong>non-pitting edema.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4dee2237486f4ea49a104a0555c92993.JPEG"
    ],
    "explanation_images": []
  }
];
        let quizName = 'Integrated Mini Test 3 - Physiology';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>