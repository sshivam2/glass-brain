<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadaveric Images Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2023-24
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Choose the incorrect statement regarding the marked structure in the given image of the head.",
    "choices": [
      {
        "id": 1,
        "text": "It arises from the posteromedial aspect of the external carotid artery."
      },
      {
        "id": 2,
        "text": "It supplies the palatine tonsils."
      },
      {
        "id": 3,
        "text": "It contributes to the supply of the nasal septum."
      },
      {
        "id": 4,
        "text": "It give off branches in the cervical region."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 1029\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The structure marked in the given image, emerging on the edge of the mandible at the <strong>anteroinferior border of the masseter muscle</strong> is the <strong>facial artery</strong>.&nbsp;</p>\n<p>The facial artery is an <strong>anterior</strong> <strong>branch</strong> (option A) of the <strong>external carotid artery</strong>, given off in the neck region, just <strong>above</strong> <strong>the</strong> <strong>greater</strong> <strong>cornua</strong> of the hyoid bone.&nbsp;The artery is very sinuous throughout its course. This is so that the artery is able to adapt to the movements of the neck and the face during daily activities. It gives of four branches in the neck and four on the face.</p>\n<p>Its <strong>4 branches in the neck</strong> region are (option D):</p>\n<ul>\n<li><strong>Ascending palatine </strong>artery supplies the <strong>soft palate</strong> and the <strong>eustachain tube</strong>.&nbsp;</li>\n<li><strong>Tonsillar</strong> artery is the main arterial supply to the <strong>palatine tonsils</strong> (option B)</li>\n<li><strong>Submental</strong> artery is the <strong>largest</strong> <strong>cervical</strong> <strong>branch</strong> of facial artery. It supplies the overlying <strong>skin and muscles in the submental region</strong>.&nbsp;</li>\n<li><strong>Glandular</strong> branches supply the <strong>submandibular</strong> <strong>salivary</strong> <strong>gland</strong>.&nbsp;</li>\n</ul>\n<div class=\"page\" title=\"Page 956\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Its <strong>4 named branches on the face</strong> are:</p>\n<ul>\n<li><strong>Premasseteric </strong>artery is small and inconstant. When present, it goes upwards along the anterior border of masseter and supplies the surrounding area.</li>\n<li><strong>Inferior labial</strong> artery arises near the angle of the mouth. It runs between the orbicularis oris muscle and the mucous membrane. It supplies the <strong>glands</strong>, <strong>mucous membrane</strong> and the <strong>muscles</strong>.</li>\n<li><strong>Superior labial</strong> artery is larger and more tortuous than the inferior labial artery. It pursues a similar course along the superior labial margin, between the mucous membrane and orbicularis oris, anastomoses with its contralateral fellow, and supplies the <strong>upper lip</strong>. It gives off a <strong>septal branch</strong> that ramifies anteroinferiorly in the <strong>nasal septum</strong>. (option C)</li>\n<li><strong>Lateral nasal</strong> artery is given off by the side of the nose, supplies the <strong>dorsum and ala of the nose</strong>, and anastomoses with its contralateral fellow.&nbsp;</li>\n</ul>\n<p>The part of the artery distal to its terminal branch is called the angular artery.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5ea3810f80084dd686c5a5a04e8b3ed8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f59d8321436400d8928581850d0edc2x960x720.JPEG"
    ]
  },
  {
    "text": "All of the following pass deep to the marked structure, except?",
    "choices": [
      {
        "id": 1,
        "text": "Median nerve"
      },
      {
        "id": 2,
        "text": "Tendons of flexor digitorum superficialis"
      },
      {
        "id": 3,
        "text": "Tendons of flexor digitorum profundus"
      },
      {
        "id": 4,
        "text": "Palmar cutaneous branch of median nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The marked structure is the <strong>flexor retinaculum</strong> of the wrist. It can be identified by the <strong>palmaris longus</strong> <strong>tendon</strong> passing <strong>superficial</strong> to it and becoming the <strong>palmar aponeurosis</strong>. <strong>Palmar cutaneous</strong> branch of the <strong>median</strong> <strong>nerve</strong> passes <strong>superficial</strong> to the flexor retinaculum.\u00a0</p>\n<p>Structures lying <strong>superficial</strong> to flexor retinaculum are:</p>\n<ul>\n<li>Palmaris longus tendon</li>\n<li><strong>Palmar cutaneous branch of the median nerve</strong></li>\n<li>Palmar cutaneous branch of the ulnar nerve</li>\n<li><strong>Ulnar nerve</strong></li>\n<li>Ulnar vessels</li>\n</ul>\n<p>The structures lying <strong>deep</strong> to flexor retinaculum are:</p>\n<ul>\n<li>Lateral compartment:\n<ul>\n<li>Flexor carpi radialis</li>\n</ul>\n</li>\n<li>Medial compartment:\n<ul>\n<li><strong>Median nerve</strong></li>\n<li>Flexor pollicis longus</li>\n<li>4 tendons each of flexor digitorum <strong>superficialis</strong> and flexor digitorum <strong>profundus</strong></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/657e38d6750741f6a6cb0cf52f805ce8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e93cb02932524fc7931a0a4d1184a5aax960x720.JPEG"
    ]
  },
  {
    "text": "Identify the marked structure in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Claustrum"
      },
      {
        "id": 2,
        "text": "Globus pallidus"
      },
      {
        "id": 3,
        "text": "Internal capsule"
      },
      {
        "id": 4,
        "text": "Putamen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The structure marked in the given image of transverse section of basal ganglia is a <strong>gray matter structure</strong> known as <strong>claustrum</strong>. It is flanked by <strong>external capsule medially</strong> and <strong>extreme capsule and insular cortex laterally.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8501a37ab7c34d10888612e706de2219.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f44c35f8eb4f4a5d9700a30834046b43x1280x1047.JPEG"
    ]
  },
  {
    "text": "While dissecting the inguinal canal, the following structure is noted. Which of the following does not contribute to the coverings of the structure marked as 'A'?",
    "choices": [
      {
        "id": 1,
        "text": "External oblique"
      },
      {
        "id": 2,
        "text": "Transversalis fascia"
      },
      {
        "id": 3,
        "text": "Internal oblique"
      },
      {
        "id": 4,
        "text": "Transversus abdominis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked as 'A'<span data-preserver-spaces=\"true\">\u00a0is the <strong>spermatic cord.</strong>\u00a0External oblique aponeurosis, internal oblique, and transversalis fascia contribute to the three coverings of the spermatic cord. There is no contribution from the transversus abdominis muscle.\u00a0<br /></span></p>\n<p><span data-preserver-spaces=\"true\">The coverings of the spermatic cord are:</span></p>\n<ol>\n<li><span data-preserver-spaces=\"true\"><strong>External spermatic fascia</strong> is a continuation of the <strong>external</strong> <strong>oblique</strong> aponeurosis and is attached to the superficial inguinal ring.\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\"><strong>Cremasteric fascia</strong> and cremasteric muscle\u00a0are derived from the <strong>internal oblique</strong> muscle and form the middle covering of the spermatic cord. They are involved in the <strong>cremasteric reflex</strong>. Gently touching the skin around the anterior aspect of the thigh stimulates the <strong>ilioinguinal</strong> <strong>nerve</strong> (<strong>afferent</strong>). The sensory fibres enter the spinal cord at the L1 level. The <strong>efferent</strong> nerve is the <strong>genital</strong> branch of the <strong>genitofemoral</strong> <strong>nerve</strong> (L1, L2), which causes contraction of the cremasteric muscle and the elevation of the testis. The cremasteric reflex is more active in children and diminishes with age.\u00a0</span></li>\n<li><span data-preserver-spaces=\"true\"><strong>Internal spermatic fascia</strong> is derived from <strong>transversalis</strong> <strong>fascia\u00a0</strong>and is attached to the deep inguinal ring.\u00a0</span></li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/30c240853d3d493e9431b82cf28ff4c3.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c102e017a21498685ccaa80023493b4x1280x1093.JPEG"
    ]
  },
  {
    "text": "Which of the following veins accompanies the structure marked in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Veins of Thebasius"
      },
      {
        "id": 2,
        "text": "Middle cardiac vein"
      },
      {
        "id": 3,
        "text": "Great cardiac vein"
      },
      {
        "id": 4,
        "text": "Small cardiac vein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked in the given image is the <strong>left anterior descending artery</strong> located in the <strong>anterior</strong> <strong>interventricular</strong> <strong>groove</strong>. The vein which accompanies this artery is the <strong>great cardiac vein</strong>.\u00a0</p>\n<p>The great cardiac vein begins at the apex of the heart. It ascends in the <strong>anterior</strong> <strong>interventricular</strong> <strong>sulcus</strong>. At the coronary sulcus, the great cardiac vein turns to the left and lies at the base of the heart. Here, it is associated with the <strong>circumflex</strong> branch of the left coronary artery. In the coronary sulcus, the great cardiac vein enlarges to form the coronary sinus, which drains into the right atrium.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f982e85fb4b941b0b61f5ffae756d790.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d29195cb2afc40e69801b0a3763405a0x600x824.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a3bd0bfa10754542b265785398a23d04x600x820.JPEG"
    ]
  },
  {
    "text": "The following image depicts the dissection of the forearm. Identify structure marked by the red arrow.",
    "choices": [
      {
        "id": 1,
        "text": "Interosseus membrane"
      },
      {
        "id": 2,
        "text": "Flexor digitorum Profundus"
      },
      {
        "id": 3,
        "text": "Pronator quadratus"
      },
      {
        "id": 4,
        "text": "Flexor retinaculum"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The marked structure is the<strong> pronator quadratus muscle.</strong></p>\n<p>Pronator quadratus is a <strong>flat</strong>&nbsp;<strong>quadrilateral shaped muscle</strong>, that extends across the front of the distal ends of the radius and ulna. The muscle is supplied by the <strong>anterior interosseus artery</strong> and causes the&nbsp;<strong>pronation of the forearm.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f1e9474f7b524db7ae9922d035963d07.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fdcf14c295bb420a9fd56979b0aa747bx800x600.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles will be paralyzed if there is an injury to the nucleus underlying the marked structure?",
    "choices": [
      {
        "id": 1,
        "text": "Genioglossus"
      },
      {
        "id": 2,
        "text": "Orbicularis oculi"
      },
      {
        "id": 3,
        "text": "Lateral rectus"
      },
      {
        "id": 4,
        "text": "Cricothyroid"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows the <strong>floor</strong> of the <strong>fourth ventricle,</strong> and the<strong> facial colliculus</strong> is marked. The\u00a0<strong>abducens nucleus lies\u00a0underneath</strong> the facial colliculus. <strong>Injury</strong> to the abducens nucleus will lead to <strong>paralysis of</strong>\u00a0the\u00a0<strong>lateral rectus</strong> <strong>muscle</strong>.\u00a0</p>\n<p>The <strong>facial colliculus</strong> is present on the <strong>floor of the fourth ventricle</strong> at the<strong> level of the lower pontine tegmentum</strong>. This colliculus <strong>contains the abducens nerve nucleus</strong> and the <strong>fibers of the facial nerve</strong>, which form the <strong>internal genu</strong> as they travel around the abducens nerve nucleus. The abducens nerve (cranial nerve VI) then emerges from the brainstem between the pons and the medulla and runs through Dorello's canal. The abducens nerve enters the superior orbital fissure via the cavernous sinus and <strong>innervates the lateral rectus muscle</strong>.</p>\n<p><strong>Structures on the floor of the 4th ventricle (Rhomboid Fossa)</strong></p>\n<p>Ridges:</p>\n<ul>\n<li>Transverse fibers:\u00a0<strong>Striae medullares</strong></li>\n<li>Striae medullaris divides rhomboid fossa into 2 parts:\u00a0<strong>Rostral pontine and Caudal medullary</strong></li>\n</ul>\n<p>Medial to lateral in <strong>rostral pontine part</strong>:</p>\n<ul>\n<li>Midline longitudinal sulcus:\u00a0<strong>Median sulcus</strong></li>\n<li>Bilateral eminences:\u00a0<strong>Medial eminence</strong></li>\n<li>Bilateral longitudinal sulcus:\u00a0<strong>Sulcus limitans</strong></li>\n<li>Bilateral areas:\u00a0<strong>Vestibular area\u00a0</strong>(deeper to it is the vestibular nucleus)</li>\n</ul>\n<p>Upper and lower ends of sulcus:</p>\n<ul>\n<li>Bluish-colored, uppermost area where sulcus limitans ends:\u00a0<strong>Locus coeruleus</strong></li>\n<li>Depression, the upper area of sulcus limitans:\u00a0<strong>Superior fovea</strong></li>\n<li>Depression, the lower area of sulcus limitans:\u00a0<strong>Inferior fovea</strong></li>\n</ul>\n<p><strong>Cranial nerve nucleus elevations</strong>:</p>\n<ul>\n<li>Elevation on the medial eminence:\u00a0<strong>Facial colliculus</strong></li>\n<li>Elevations in the lowermost area in the shape of 2 triangles:\u00a0<strong>Hypoglossal and vagal triangles</strong></li>\n</ul>\n<p>Circumventricular organ:</p>\n<ul>\n<li>Between the vagal triangle and gracile tubercle below:\u00a0<strong>Area postrema</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a57ed491b114f80ada4ad97a7f86f97.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8d6458c4fc2a4486b63542b6efdb02cbx960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d2f31749f5904aa68b1e90de050f7cbdx1280x1427.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/728a34fe43224e968d44f48c855712d2x1279x1938.JPEG"
    ]
  },
  {
    "text": "Identify the marked structure in the given image and choose the incorrect statement about it.",
    "choices": [
      {
        "id": 1,
        "text": "It is the nerve of the sixth pharyngeal arch"
      },
      {
        "id": 2,
        "text": "Loops around the subclavian artery on the right side"
      },
      {
        "id": 3,
        "text": "Supplies cricopharyngeus muscle"
      },
      {
        "id": 4,
        "text": "Gives sensory supply to the larynx above the vocal folds"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked in the above image is the&nbsp;<strong>recurrent laryngeal nerve.&nbsp;</strong>The recurrent laryngeal nerve gives the sensory supply to the larynx <strong>below</strong> the vocal folds.</p>\n<p>The left and right recurrent laryngeal nerves arise from the respective side vagus nerves. The <strong>left</strong> recurrent laryngeal nerve loops around the <strong>arch</strong> <strong>of</strong> <strong>aorta</strong>, while the <strong>right</strong> recurrent laryngeal nerve loops around the <strong>right subclavian artery</strong>. Both of them ascend in the groove <strong>between</strong> the <strong>trachea</strong> and the <strong>esophagus</strong> and enter the larynx deep to the margin of the inferior constrictor muscle.&nbsp;They may pass medial to, lateral to, or through the lateral ligament of the thyroid gland, which attaches the thyroid gland to the trachea and lower part of the cricoid cartilage on each side. This relationship is important during surgery of the thyroid gland.&nbsp;</p>\n<div class=\"page\" title=\"Page 1085\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The recurrent laryngeal nerves give <strong>sensory</strong> supply to the larynx <strong>below</strong> the level of the <strong>vocal</strong> <strong>cord</strong> and <strong>motor</strong> supply to all the intrinsic muscles of the larynx <strong>except</strong> the <strong>cricothyroid</strong>. In addition, the <strong>cricopharyngeus</strong> part of the <strong>inferior</strong> <strong>constrictor</strong> muscle is also supplied by the recurrent laryngeal nerve.&nbsp;&nbsp;</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/666cd17e55bf47f7aab182a99fd7655d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4fc1c8875c3a403194e7ccb947c90e52x1280x1111.983062808751.JPEG"
    ]
  },
  {
    "text": "Choose the correct statement regarding the marked structure in the given image.",
    "choices": [
      {
        "id": 1,
        "text": "Causes extension at metacarpophalangeal joint"
      },
      {
        "id": 2,
        "text": "Originates from the the tendon of flexor digitorum profundus"
      },
      {
        "id": 3,
        "text": "Innervated by ulnar nerve"
      },
      {
        "id": 4,
        "text": "Bipennate structure"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The structure marked in the given image is the <strong>first lumbrical&nbsp;</strong>and it arises&nbsp;from the<strong> tendon of flexor digitorum profundus</strong>.</p>\n<p>There are<strong> four</strong> lumbrical muscles. They originate from the&nbsp;tendons of the&nbsp;<strong>flexor digitorum profundus</strong>&nbsp;(option B).<strong>&nbsp;</strong>They then pass to the radial side of the corresponding fingers and are&nbsp;<strong>inserted</strong> into the dorsal digital expansion of the <strong>extensor digitorum</strong>. While the <strong>first</strong> and <strong>second</strong> lumbricals are <strong>unipennate</strong> in nature(Option D), the <strong>third</strong> and the <strong>fourth</strong> are <strong>bipennate</strong>.</p>\n<p>The <strong>median&nbsp;nerve </strong>innervates the first and second lumbricals. The&nbsp;<strong>deep terminal branch</strong> of the <strong>ulnar nerve</strong> innervates the third and the fourth (option C). The action of lumbricals is <strong>flexion</strong> at the <strong>metacarpophalangeal joint</strong> and <strong>extension</strong> of interphalangeal joints (option A).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/96de48e78bc849f7abcc3d7e023ebfd7.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bdaee3063f1f4c859a4398c8fb0dfebex960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e901cf7bad9464986c1a00a985dc4ffx1280x1661.JPEG"
    ]
  },
  {
    "text": "Which nerve gives motor supply to the marked muscle of the gluteal region?",
    "choices": [
      {
        "id": 1,
        "text": "Branches from S1 and S2"
      },
      {
        "id": 2,
        "text": "Nerve to quadratus femoris"
      },
      {
        "id": 3,
        "text": "Nerve to obturator internus"
      },
      {
        "id": 4,
        "text": "Inferior gluteal nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked muscle in the given image is <strong>gemellus inferior</strong>. It is innervated by<strong> nerve to quadratus femoris</strong>.\u00a0</p>\n<p>Both the gemelli don't have their own specific nerve supply. While <strong>gemellus inferior</strong> is given motor supply by <strong>nerve to quadratus femoris</strong>, <strong>gemellus superior</strong> is innervated by <strong>nerve to obturator internus</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4d55c360fd04a3dafe143eb6c5ae26a.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53a6b150670646bba2811699088375c0x960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea7a79e67c784f41af3f6c7a55c030e1x1280x1598.JPEG"
    ]
  },
  {
    "text": "Which of the following gives rise to the structure marked in the given image of the liver?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal mesogastrium"
      },
      {
        "id": 2,
        "text": "Splanchnopleuric lateral plate mesoderm"
      },
      {
        "id": 3,
        "text": "Septum transversum"
      },
      {
        "id": 4,
        "text": "Gastrophrenic ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The marked structure is the <strong>falciform ligament</strong> of the liver. It is an embryological derivative of <strong>ventral mesentery</strong>, which itself arises from <strong>septum transversum</strong>.&nbsp;</p>\n<p>Septum transversum is the undifferentiated lateral plate mesoderm at the cranial end of the embryo. It gives rise to:</p>\n<ul>\n<li><strong>Central tendon</strong> of diaphragm</li>\n<li><strong>Fibrous</strong> <strong>pericardium</strong></li>\n<li>Liver stroma</li>\n<li><strong>Ventral mesogastrium</strong></li>\n</ul>\n<p>As the liver grows into the mesenchyme of the septum transversum, <strong>ventral mesentery</strong> is divided into two parts:</p>\n<ol>\n<li><strong>Lesser omentum</strong>, which<strong>&nbsp;</strong>extends&nbsp;from the lower portion of the esophagus, the stomach, and the upper portion of the duodenum to the liver (hepato-gastric and hepato-duodenal ligaments)</li>\n<li><strong>Ligaments of the liver: </strong>all ligaments of the liver <strong>except</strong> <strong>ligamentum</strong> <strong>teres</strong> are derived from the ventral mesentery. This includes&nbsp;<strong>falciform ligament</strong>, right and left triangular ligaments, and coronary ligaments.&nbsp;</li>\n</ol>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dfbc44ebabe447058e80e254da470957.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15884dd74c804f55a6fc796db8284154x960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/77736ba00b9e4829ade699b4f1897c51x1280x1280.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c2983c02cdff43d28456e84bdc54fea1x600x653.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50d6b74a5f114b76a3c532c82799ac3dx1280x2578.JPEG"
    ]
  },
  {
    "text": "What is the action of the marked structure?",
    "choices": [
      {
        "id": 1,
        "text": "Plantar flexion of the foot"
      },
      {
        "id": 2,
        "text": "Dorsiflexion and eversion of the foot"
      },
      {
        "id": 3,
        "text": "Extension of the great toe"
      },
      {
        "id": 4,
        "text": "Dorsiflexion and inversion of the foot"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked in the given image is the <strong>tibialis anterior</strong> muscle. Its action is <strong>dorsiflexion</strong> and <strong>inversion</strong> of the foot.</p>\n<p>Tibialis anterior can be identified as the <strong>most</strong> <strong>medial</strong> <strong>muscle</strong> of the <strong>anterior compartment</strong> of the leg. The order of the muscles in the anterior compartment of the leg is (medial to lateral): tibialis anterior, extensor hallucis longus, extensor digitorum longus and peroneus tertius. Tibialis anterior muscle is <strong>medial</strong> to <strong>extensor digitorum longus</strong> and is inserting towards the <strong>medial side</strong> of the <strong>foot</strong> and <strong>can</strong> be identified in the specimen.</p>\n<p>Tibialis anterior muscle <strong>originates</strong> from lateral condyle and <strong>lateral</strong> <strong>surface</strong> of the <strong>tibial</strong> <strong>shaft</strong> and the adjacent interosseus membrane. It is <strong>inserted</strong> into the medial and inferior surface of the <strong>medial</strong> <strong>cuneiform</strong> and the adjoining part of the base of the <strong>first</strong> <strong>metatarsal</strong>. It receives its innervation from the<strong> deep peroneal nerve</strong> (L4 and L5). Its actions include <strong>dorsiflexion</strong> and <strong>inversion</strong> of the foot. This muscle is most active during activities in which both of these movements are combined, such as walking.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d2ba11e0804a45219b54883e5a104379.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/633334538bb44a319abdb907b156b1a3x1280x1128.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ceb783a23ceb4929b391685d2afb001ex1280x2558.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a content of the highlighted triangle?",
    "choices": [
      {
        "id": 1,
        "text": "Spinal accessory nerve"
      },
      {
        "id": 2,
        "text": "Suprascapular nerve"
      },
      {
        "id": 3,
        "text": "Long thoracic nerve of bell"
      },
      {
        "id": 4,
        "text": "Nerve to subclavius"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The highlighted triangle is the<strong> supraclavicular (subclavian/omoclavicular/&nbsp;Ho's triangle) triangle. The spinal accessory nerve </strong>is not the content of this triangle.</p>\n<p>The supraclavicular triangle is the lower and smaller division of the posterior triangle of the neck.</p>\n<p>Boundaries :</p>\n<ul>\n<li>Superior - inferior belly of the omohyoid muscle</li>\n<li>Inferior - clavicle</li>\n<li>Anterior - posterior border of the sternocleidomastoid muscle</li>\n<li>Posterior - anterior border of the trapezius</li>\n</ul>\n<p>Contents:</p>\n<ul>\n<li><strong>Nerves</strong> - trunks of the<strong> brachial plexus</strong>, nerve to serratus anterior (<strong>long thoracic nerve </strong>of bell), <strong>suprascapular nerve, nerve to subclavius.</strong></li>\n<li><strong>Vessels</strong> - the third part of the <strong>subclavian artery and vein, suprascapular artery and vein, </strong>the origin of the <strong>transverse cervical artery,</strong> lower part of the <strong>external jugular vein</strong></li>\n<li>Lymph nodes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e7983550d7cb4b568e7576f47fd58c3d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e4a8fac4060a48cdba299c184ea7f93dx1280x1559.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/948bba086b2e4b20b7a4c8626a0868f8x960x720.JPEG"
    ]
  },
  {
    "text": "Identify the marked structure.",
    "choices": [
      {
        "id": 1,
        "text": "Optic nerve"
      },
      {
        "id": 2,
        "text": "Occulomotor nerve"
      },
      {
        "id": 3,
        "text": "Trigeminal nerve"
      },
      {
        "id": 4,
        "text": "Abducent nerve"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked structure is arising on the anterior surface of the midbrain and traversing <strong>between</strong> the <strong>posterior cerebral artery</strong> and the <strong>superior cerebellar artery</strong>, so it is likely to be <strong>oculomotor</strong> <strong>nerve</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b95f601b652d4bb2ae8864f0dcc1b8dc.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/96ce5b4ec58f41509ba09eb9bb94c6fex1280x1005.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bad277fba424462a970be5d96e05f46x1280x1425.JPEG"
    ]
  },
  {
    "text": "Which of the following muscles is not supplied by the marked structure?",
    "choices": [
      {
        "id": 1,
        "text": "Psoas major"
      },
      {
        "id": 2,
        "text": "Iliacus"
      },
      {
        "id": 3,
        "text": "Pectineus"
      },
      {
        "id": 4,
        "text": "Vastus medialis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image is of the<strong> femoral triangle</strong> and the marked structure, which lies <strong>lateral</strong> <strong>to the femoral vessels</strong>,<strong>&nbsp;</strong>is the <strong>femoral nerve</strong>. The iliacus, pectineus, and vastus medialis are all supplied by the femoral nerve. However, the <strong>psoas major muscle</strong> is supplied by branches from the <strong>anterior rami of L1 to L3.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5d4e61253aee46e7bb2fc04005769516.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c5f9ffbe3de74a9f808b0faea2fee71ex1279x1208.JPEG"
    ]
  },
  {
    "text": "Which of the following correctly describes the action of the marked muscle?",
    "choices": [
      {
        "id": 1,
        "text": "Elevation of the mandible only"
      },
      {
        "id": 2,
        "text": "Elevation and retraction of the mandible"
      },
      {
        "id": 3,
        "text": "Depression of the mandible only"
      },
      {
        "id": 4,
        "text": "Depression and protraction of the mandible"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked muscle which is <strong>inserting</strong> on the <strong>coronoid</strong> <strong>process</strong> <strong>and</strong> <strong>anterior ramus of the mandible</strong> is the <strong>temporalis</strong> muscle. Its action is to <strong>elevate</strong> <strong>and</strong> <strong>retract</strong> the mandible.&nbsp;</p>\n<p>Temporalis muscle originates from the bone of the <strong>temporal fossa</strong> and the <strong>temporal fascia</strong> and goes on to attach on the <strong>coronoid</strong> <strong>process</strong> and anterior ramus of the mandible. It is innervated by <strong>deep</strong> <strong>temporal</strong> <strong>nerves</strong> which originate from the anterior trunk of the <strong>mandibular</strong> <strong>nerve</strong>. Temporalis muscle <strong>elevates</strong> the mandible and so closes the mouth. The <strong>posterior</strong> <strong>fibers</strong> of the muscle <strong>retract</strong> the mandible after it has been protruded. These muscle fibers of temporalis are almost horizontal and are the <strong>only</strong> <strong>source</strong> <strong>of</strong> <strong>mandibular</strong> <strong>retraction</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/26a055f5791e4d52bdfe3827dc1ea935.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/392918341bb9444b9d279875ff361dfax960x720.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is true about the structure marked in the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Formed by retromandibular vein and facial vein"
      },
      {
        "id": 2,
        "text": "Great auricular nerve runs with it"
      },
      {
        "id": 3,
        "text": "Joins the brachiocephalic vein"
      },
      {
        "id": 4,
        "text": "Pierces the deep cervical fascia in the carotid triangle"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The marked structure in the given image is the&nbsp;<strong>external jugular vein.&nbsp;</strong>It runs with the <strong>great auricular nerve</strong>, lying posterior to its upper half.&nbsp;</p>\n<p>The formative tributaries of the external jugular vein are the&nbsp;<strong>p</strong><strong>osterior auricular vein</strong> and<strong>&nbsp;the posterior division of the retromandibular vein </strong>(option A). It descends from the angle of the mandible to the midpoint of the clavicle, running obliquely and superficial to the sternocleidomastoid muscle.&nbsp;It is covered by skin, superficial fascia, and platysma, and is separated from the sternocleidomastoid by the deep cervical fascia. At the root of the neck in the <strong>posterior</strong> <strong>triangle </strong>(option D), it pierces the deep cervical fascia and ends in the <strong>subclavian</strong> <strong>vein </strong>(option C).&nbsp; The vein crosses the transverse cutaneous nerve and lies <strong>parallel</strong> with the <strong>great auricular</strong> <strong>nerve</strong>, posterior to its upper half.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7f03e0b48fc54d869b02ee4115b1bd8b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c550c968b0204bb29b9a2e7b4cc1fcacx1280x1047.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/82ce8ff69f0c490e95c886791062a08ex600x577.JPEG"
    ]
  },
  {
    "text": "Which of the following connects the structures marked as 'A' and 'B'?",
    "choices": [
      {
        "id": 1,
        "text": "Aqueduct of Sylvius"
      },
      {
        "id": 2,
        "text": "Foramen of Monro"
      },
      {
        "id": 3,
        "text": "Foramen of Luschka"
      },
      {
        "id": 4,
        "text": "Foramen of Magendie"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The structure marked as 'A' in the given image is <strong>lateral ventricle</strong>, and 'B' is <strong>third ventricle</strong>. The structure connecting these two is <strong>foramen of Monro</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a77a7b9b78e742b982f78130ae6e57b8.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/551b392b34e14e168db70e7b99f084e0x960x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0f23cd9862fb4267a4c70cdfbdf1607dx1280x3447.057163020466.JPEG"
    ]
  },
  {
    "text": "Identify the marked structure.",
    "choices": [
      {
        "id": 1,
        "text": "Falx cerebri"
      },
      {
        "id": 2,
        "text": "Corpus callosum"
      },
      {
        "id": 3,
        "text": "Fornix"
      },
      {
        "id": 4,
        "text": "Pituitary gland"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the given <strong>coronal section</strong> of the brain, the marked structure is <strong>fornix</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a75b49c23c154ec0b282eaebba2c0927.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59037c1e35a34e5a8d3f886c0f21e2f5x1279x1007.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f288452d83734f378426145be6c0e820x1279x890.JPEG"
    ]
  },
  {
    "text": "Which of the following have no contribution in the embryological development of the marked structure?",
    "choices": [
      {
        "id": 1,
        "text": "Right umbilical vein"
      },
      {
        "id": 2,
        "text": "Right supracardinal vein"
      },
      {
        "id": 3,
        "text": "Right subcardinal vein"
      },
      {
        "id": 4,
        "text": "Right Hepato-cardiac vein"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked structure in the given image is the <strong>inferior vena cava</strong> <strong>(IVC)</strong>.&nbsp;</p>\n<p>The <strong>inferior vena cava</strong> is a composite vessel that develops from the remodeling of successive venous complexes. The veins contributing to the formation of IVC&nbsp;from below upwards are as follows:</p>\n<ol>\n<li>Common iliac veins</li>\n<li>Right posterior cardinal vein</li>\n<li>Postcardinal-supracardinal anastomosis</li>\n<li>Right supracardinal vein</li>\n<li>Supracardinal-subcardinal anastomosis</li>\n<li>Right subcardinal vein</li>\n<li>Cardiac termination of the right vitelline hepatocardiac vein (right hepatocardiac vein)</li>\n</ol>\n<p>The <strong>right</strong> <strong>umbilical vein</strong> <strong>atrophies</strong> during development. The left umbilical vein joins the right vitelline vein and their common termination is known as the <strong>right hepatocardiac</strong> vein, which forms the <strong>terminal</strong> part of the <strong>IVC</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0fe3cf3552cd42b9a048df7803d28403.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3098eee7b1e64f8aba457fb8f53e8c7ex1280x1029.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7aa29bc78dc14c6980f2c53edc1249d4x600x1025.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9592e8f9be9b466c94e32e423c306f4ex600x1025.JPEG"
    ]
  }
];
        let quizName = 'Cadaveric Images Mini Test - -Tmt';
        const quizFilename = 'cadaveric-images-mini-test-tmt-ef60bb4a.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2023-24"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>