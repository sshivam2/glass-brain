<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Hiv   Aids - Management And Prophylaxis - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Anti-retroviral therapy in HIV-infected individuals should be initiated at _______",
    "choices": [
      {
        "id": 1,
        "text": "CD4 count <200 cells/ul and/or WHO clinical stage 2/3"
      },
      {
        "id": 2,
        "text": "CD4 count <350 cells/ul and/or WHO clinical stage 3/4"
      },
      {
        "id": 3,
        "text": "CD4 count <250 cells/ul and/or WHO clinical stage 4"
      },
      {
        "id": 4,
        "text": "Any CD4 count regardless of WHO clinical stage"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Antiretroviral therapy (ART) is recommended for <strong>all</strong><strong>&nbsp;HIV patients, regardless of CD4</strong> <strong>T lymphocyte cell count</strong> or clinical stage.</p>\n<p>This is done to reduce the morbidity and mortality associated with HIV infection. A secondary goal of ART is to reduce the risk of HIV transmission.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about fourth-generation serological testing for HIV?",
    "choices": [
      {
        "id": 1,
        "text": "It is used to confirm the diagnosis of HIV"
      },
      {
        "id": 2,
        "text": "It detects HIV antibodies and antigen"
      },
      {
        "id": 3,
        "text": "It has a lower sensitivity compared to first-generation HIV testing"
      },
      {
        "id": 4,
        "text": "It cannot be used to detect HIV-2 antibodies"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The 4<sup>th&nbsp;</sup>generation HIV test combines the detection of <strong>antibodies against HIV-1 &amp; HIV-2</strong> with detection of the <strong>core p24 antigen</strong> <strong>of HIV-1</strong>. Inclusion of p24 antigen capture allows detection of <strong>HIV-1 infection</strong>&nbsp;even before seroconversion i.e., presence of antibodies in the blood.</p>\n<p>The approximate time to positivity following infection is 15 to 20 days. Consequently, the window period between infection and detection of the infection is shortened.</p>\n<p>Fourth-generation HIV testing is <strong>highly sensitive (99.9%)&nbsp;</strong>and is the CDC-recommended initial screening test for HIV. <strong>No further testing</strong> is required for specimens that are non-reactive on ELISA screening.</p>\n<table style=\"height: 334px;\" width=\"299\">\n<tbody>\n<tr style=\"height: 38px;\">\n<td style=\"text-align: center; width: 141.65px; height: 38px;\"><strong>Generation</strong></td>\n<td style=\"text-align: center; width: 141.35px; height: 38px;\"><strong>Serological test</strong></td>\n</tr>\n<tr style=\"height: 38px;\">\n<td style=\"width: 141.65px; height: 38px; text-align: left;\">First generation</td>\n<td style=\"width: 141.35px; height: 38px; text-align: left;\">IgG antibody</td>\n</tr>\n<tr style=\"height: 38px;\">\n<td style=\"width: 141.65px; height: 38px; text-align: left;\">Second generation</td>\n<td style=\"width: 141.35px; height: 38px; text-align: left;\">IgG antibody</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 141.65px; height: 36px; text-align: left;\">Third generation</td>\n<td style=\"width: 141.35px; height: 36px; text-align: left;\">IgM and IgG antibody</td>\n</tr>\n<tr style=\"height: 50.8333px;\">\n<td style=\"width: 141.65px; height: 50.8333px; text-align: left;\">Fourth generation</td>\n<td style=\"width: 141.35px; height: 50.8333px; text-align: left;\">IgM and IgG antibody and p24 antigen</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 46-year-old man, who is a chronic alcoholic, presented with acute dull and boring abdominal pain. His history is significant for ongoing treatment with ART. Serum lipase levels were noted to be grossly elevated. What is the most likely causative drug?",
    "choices": [
      {
        "id": 1,
        "text": "Nevirapine"
      },
      {
        "id": 2,
        "text": "Didanosine"
      },
      {
        "id": 3,
        "text": "Emtricitabine"
      },
      {
        "id": 4,
        "text": "Stavudine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Didanosine</strong> is the most likely causative drug. The clinical scenario, suggestive of <strong>pancreatitis,</strong> is a dose-limiting<strong> side effect</strong> of <strong>didanosine</strong> and occurs more frequently in alcoholic patients and those with hypertriglyceridemia.</p>\n<p>Option A:<strong>&nbsp;Nevirapine</strong> side-effects include severe liver problems, skin rash, and skin reactions.&nbsp;</p>\n<p>Option C: <strong>Emtricitabine</strong>&nbsp;is contraindicated in pregnancy and young children.</p>\n<p>Option D: <strong>Stavudine</strong>&nbsp;can cause peripheral neuropathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An HIV-positive patient is upset because he has a high viral load despite good compliance with ART. The physician decides to start him on a parenteral drug. Which of the following drugs will be helpful for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Emtricitabine"
      },
      {
        "id": 2,
        "text": "Elvitegravir"
      },
      {
        "id": 3,
        "text": "Enfuvirtide"
      },
      {
        "id": 4,
        "text": "Efavirenz"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Enfuvirtide</strong> is the antiretroviral drug administered <strong>parenterally,&nbsp;</strong>used only in the treatment of those who have evidence of HIV replication&nbsp;i.e., <strong>high</strong> <strong>viral load</strong>, despite ongoing antiretroviral therapy.&nbsp;</p>\n<p>Enfuvirtide <strong>prevents viral fusion </strong>and entry by binding to the gp41 subunit of the HIV-1 envelope. It is <strong>not active against HIV-2.</strong> It is administered as a twice-a-day <strong>subcutaneous </strong>injection.</p>\n<p>Note:&nbsp;<strong>Zidovudine</strong> is also available as a parenteral formulation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An HIV-positive patient has the following serology results. What is the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tenofovir + emtricitabine + abacavir"
      },
      {
        "id": 2,
        "text": "Tenofovir + lamivudine + dolutegravir"
      },
      {
        "id": 3,
        "text": "Lamivudine + emtricitabine + nevirapine"
      },
      {
        "id": 4,
        "text": "Tenofovir + lamivudine + efavirenz"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of&nbsp;an <strong>acute infection</strong> with <strong>hepatitis B</strong> virus. The preferred regimen in the management of HIV-1 and hepatitis B <strong>co-infection</strong> is <strong>tenofovir + lamivudine + dolutegravir.&nbsp;</strong></p>\n<p class=\"p1\">This regimen is also the first-line management in adults, adolescents, pregnant women, and&nbsp;HIV-TB co-infection.&nbsp;</p>\n<p>Antivirals that are effective against <strong>hepatitis C</strong> infection are&nbsp;<strong>sofosbuvir, grazoprevir</strong>&nbsp;and<strong> glecaprevir</strong>.</p>\n<p>*Note: Pearl attached below has been updated according to the NACO ART guidelines 2021. Efavirenz has been replaced by <strong>Dolutegravir</strong> as per the new guidelines.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following antiretroviral drugs is not used in HIV & hepatitis B co-infection?",
    "choices": [
      {
        "id": 1,
        "text": "Tenofovir"
      },
      {
        "id": 2,
        "text": "Abacavir"
      },
      {
        "id": 3,
        "text": "Lamivudine"
      },
      {
        "id": 4,
        "text": "Emtricitabine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Abacavir</strong> is <strong>not used</strong> in <strong>HIV and hepatitis-B co-infection</strong>. It is used in the <strong>first-line ART regimen</strong> for patients with <strong>abnormal serum creatinine</strong> values.</p>\n<p>Nucleoside reverse transcriptase inhibitor (NRTI) drugs like&nbsp;<strong>lamivudine,</strong>&nbsp;its closely related drug <strong>emtricitabine,</strong> and the nucleotide reverse transcriptase inhibitor (NRTI) <strong>t</strong><strong>enofovir</strong>&nbsp;have activity <strong>against hepatitis B virus</strong>.&nbsp;These drugs are preferred in combination with other antiretrovirals for the treatment of HIV &amp; HBV co-infections.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Screening of patients for HLA- B5701 is recommended before initiation of which of the following antiretroviral drugs?",
    "choices": [
      {
        "id": 1,
        "text": "Tenofovir"
      },
      {
        "id": 2,
        "text": "Abacavir"
      },
      {
        "id": 3,
        "text": "Zidovudine"
      },
      {
        "id": 4,
        "text": "Emtricitabine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Screening of patients for <strong>HLA-B5701</strong> is recommended before initiation of <strong>abacavir </strong>since it&nbsp;is associated with <strong>hypersensitivity.</strong></p>\n<p>The&nbsp;hypersensitivity syndrome includes&nbsp;fever, maculopapular rash, abdominal pain, gastrointestinal problems, malaise and fatigue. Hence, abacavir should only be used as a last resort and with close monitoring in patients who are HLA-B5701-positive.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Evaluation of a patient with uncontrolled type 2 diabetes mellitus and hypertension has revealed moderately increased albuminuria. He has recently been diagnosed with HIV infection. Combination ART preparations including which of the following drugs should be avoided?",
    "choices": [
      {
        "id": 1,
        "text": "Tenofovir"
      },
      {
        "id": 2,
        "text": "Lamivudine"
      },
      {
        "id": 3,
        "text": "Emtricitabine"
      },
      {
        "id": 4,
        "text": "Dolutegravir"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenerio is suggestive of early stages of diabetic and hypertensive kidney disease. So combinaton antiretroviral therapy (cART) preparations including <strong>tenfovir should not</strong> be prescribed to this patient.</p>\n<p><strong>Tenofovir</strong> is primarily eliminated by the kidneys and&nbsp;is<strong> contraindicated </strong>in patients with<strong> renal impairment</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 36-year-old HIV-positive man on cART is presented with the following finding. What is the most likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Abacavir"
      },
      {
        "id": 2,
        "text": "Entecavir"
      },
      {
        "id": 3,
        "text": "Nelfinavir"
      },
      {
        "id": 4,
        "text": "Adefovir"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of&nbsp;<strong>fat redistribution</strong> resulting in the classic <strong>buffalo hump</strong> appearance.&nbsp;<strong>Nelfinavir</strong> is the most likely cause.</p>\n<p class=\"p1\">It&nbsp;is a protease inhibitor and its&nbsp;<strong>chronic administration </strong>can result in fat redistribution and<strong>&nbsp;metabolic syndrome.&nbsp;</strong></p>\n<p class=\"p1\">Note: <strong>Atazanavir</strong> has the least propensity to cause lipodystrophy and metabolic syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6b659a4efa4d47d493572689970cb6ed.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 54-year-old HIV-positive woman has a Hb of 8gm/dl. Combination ART preparations including which of the following drugs should be avoided?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine"
      },
      {
        "id": 2,
        "text": "Tenofovir"
      },
      {
        "id": 3,
        "text": "Raltegravir"
      },
      {
        "id": 4,
        "text": "Emtricitabine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Zidovudine</strong> should be avoided in this patient because the primary toxicity of zidovudine is <strong>bone marrow suppression.&nbsp;</strong>It can lead to anemia and neutropenia, which may require transfusions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During his routine counselling, a war veteran on cART for the past 2 weeks tells his therapist that he wishes to discontinue his HIV treatment. He explains that since starting them, he has been having extreme dizziness and intense nightmares leading to repeated wakening in the night. What is the likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Tenofovir"
      },
      {
        "id": 2,
        "text": "Dolutegravir"
      },
      {
        "id": 3,
        "text": "Efavirenz"
      },
      {
        "id": 4,
        "text": "Lamivudine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient is most likely prescribed a cART regimen including <strong>efavirenz</strong>.</p>\n<p>Many patients treated with <strong>efavirenz</strong> note a feeling of light-headedness and <strong>dizziness</strong> following the initiation of therapy. They also complain of <strong>insomnia</strong>, <strong>vivid dreams</strong> and <strong>nightmares</strong>.</p>\n<p>These symptoms are self-limiting and tend to <strong>disappear&nbsp;gradually</strong> after several weeks of therapy. If the&nbsp;sleep problems are persistent, stopping the drug is the only solution.</p>\n<p>It is recommended to take efavirenz before bedtime to minimize side effects.</p>\n<p>The CNS/ <strong>psychiatric adverse effects</strong> seen with the use of <strong>efavirenz</strong> are:</p>\n<ul>\n<li>Frank psychosis (depression, hallucinations, and/or mania)&nbsp;</li>\n<li>Impaired concentration</li>\n<li>Dysphoria&nbsp;</li>\n<li>Dizziness</li>\n<li>Vivid dreams</li>\n<li>Insomnia</li>\n</ul>\n<p>*Note: Pearl attached below has been updated according to the NACO ART guidelines 2021. Efavirenz has been replaced by <strong>Dolutegravir</strong> as per the new guidelines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old man is tested for HIV and the following band pattern is seen on a standard western blot. Protein gp36 is present on the immunoblotting assay. To which class of antiretroviral drug would he be intrinsically resistant?",
    "choices": [
      {
        "id": 1,
        "text": "Nucleoside reverse transcriptase inhibitors"
      },
      {
        "id": 2,
        "text": "Nucleotide reverse transcriptase inhibitors"
      },
      {
        "id": 3,
        "text": "Non-nucleoside reverse transcriptase inhibitors"
      },
      {
        "id": 4,
        "text": "Integrase strand transfer inhibitors"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of&nbsp;<strong>HIV-2</strong>&nbsp;infection. It<strong>&nbsp;</strong>is <strong>intrinsically resistant</strong>&nbsp;to non-nucleoside reverse transcriptase inhibitors (<strong>NNRTI</strong>)&nbsp;and also to fusion inhibitor <strong>enfuvirtide</strong><strong>.&nbsp;</strong></p>\n<p class=\"p1\">Western blot has a <strong>high specificity.&nbsp;</strong>It detects specific antibodies against multiple proteins of all 3 major HIV genes - <strong><em>gag, pol, </em></strong>and<strong><em> env</em></strong>.&nbsp;</p>\n<p class=\"p1\">Persons with <strong>HIV-2</strong> will often have an <strong>indeterminate western blot pattern</strong>&nbsp;showing the presence of Gag bands and Pol bands, but an <strong>absence of Env bands</strong>. This pattern occurs because HIV-1 and HIV-2 share little similarity in the&nbsp;<strong><em>env</em>&nbsp;gene</strong>.&nbsp;Moreover, the presence of <strong>gp36</strong>&nbsp;points towards a diagnosis of<strong>&nbsp;</strong>HIV-2.</p>\n<p>In India, NACO provides western blot confirmatory testing <strong>only to resolve indeterminate results</strong> on previous serological testing and <strong>not</strong> for <strong>routine confirmation</strong> after a&nbsp;positive result on screening tests.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An individual positive for HIV-1 infection was started on a combination ART regimen of tenofovir\u2013emtricitabine\u2013efavirenz. After 6 months, failure of treatment was established and attributed to efavirenz resistance. Which drug of the same class can be used instead?",
    "choices": [
      {
        "id": 1,
        "text": "Delavirdine"
      },
      {
        "id": 2,
        "text": "Nevirapine"
      },
      {
        "id": 3,
        "text": "Nelfinavir"
      },
      {
        "id": 4,
        "text": "Etravirine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Etravirine</strong> can be used instead of efavirenz.</p>\n<p><strong>Etravirine</strong> is a non-nucleoside reverse transcriptase inhibitor <strong>(NNRTI)</strong> currently approved for the treatment of HIV infection in combination with other agents in <strong>treatment-experienced patients.</strong></p>\n<p>Options A, B: Etravirine is active against strains of HIV that are resistant to other NNRTIs such as&nbsp;<strong>delavirdine</strong>, <strong>nevirapine,</strong> and&nbsp;<strong>efavirenz</strong> which all exhibit <strong>cross-resistance</strong>. Rilpivirine, an NNRTI, is also effective across a broad range of NNRTI-resistant viruses but shares cross-resistance with etravirine.</p>\n<p>Option C: <strong>Nelfinavir</strong> is a protease inhibitor and hence, does not belong to the same class.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A woman is diagnosed to be positive for HIV in her first trimester. What is the appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Start ART immediately and continue till 6 weeks after delivery"
      },
      {
        "id": 2,
        "text": "Start ART after 1st trimester and continue life-long"
      },
      {
        "id": 3,
        "text": "Start ART immediately and continue life-long"
      },
      {
        "id": 4,
        "text": "Start ART after 1st trimester and continue till 6 weeks after delivery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>ART</strong> should be <strong>initiated immediately and&nbsp;continued lifelong</strong> in<strong>&nbsp;</strong>all <strong>pregnant </strong>and<strong> breastfeeding </strong>women with <strong>HIV. </strong>This is&nbsp;regardless of their WHO clinical stage and CD4 cell count.</p>\n<p>*Note: Pearl attached below has been updated according to the NACO ART guidelines 2021. Efavirenz has been replaced by <strong>Dolutegravir</strong> as per the new guidelines.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newly diagnosed HIV patient presented with fever, cough, and hemoptysis. His sputum sample showed acid-fast bacilli. What is the appropriate management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Start ART if CD4<200"
      },
      {
        "id": 2,
        "text": "Start ART and then ATT after 2 weeks"
      },
      {
        "id": 3,
        "text": "Start ATT and then ART after 2 weeks"
      },
      {
        "id": 4,
        "text": "Start ATT and ART simultaneously"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In a patient with HIV and TB <strong>start</strong> <strong>ATT first</strong> and <strong>then start ART</strong> as soon as ATT is tolerated (between <strong>2 weeks</strong> and 2 months) by the patient. This is done in order to avoid immune reconstitution inflammatory syndrome&nbsp;<strong>(IRIS)</strong>.&nbsp;</p>\n<p><strong>Immune Reconstitution Inflammatory Syndrome</strong> <strong>(IRIS):</strong></p>\n<p>Patients with HIV-related TB may experience a temporary <strong>paradoxical exacerbation</strong> of symptoms and radiographic manifestations of TB after starting ATT. This occurs as a result of <strong>immune reconstitution</strong> due to <strong>simultaneous</strong> administration of <strong>ART and ATT</strong>.</p>\n<p>It is characterized by high fever, lymphadenopathy, expanding intra-thoracic lesions, and worsening of chest X-ray findings. Diagnosis should be made only after ruling out treatment failure and other infections. For severe cases, <strong>prednisone</strong> 1-2mg/kg is used for 1-2 weeks and then gradually tapered.</p>\n<p>However, in patients with <strong>CD4 &lt;50/&mu;L,</strong> the benefits of administering ART immediately after initiating ATT outweigh the risks of IRIS, and therefore <strong>ART</strong> should be <strong>started</strong> as<strong> early </strong>as possible.</p>\n<p>Note: As per RNTCP guidelines, <strong>CBNAAT</strong> is the <strong>preferred</strong> diagnostic technique for testing <strong>TB in PLHIV&nbsp;</strong>(people living with HIV). Smear microscopy has poor sensitivity in detecting TB in PLHIV due to fewer organisms in sputum, and hence is not preferred.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the diagnostic test of choice for HIV in a baby born to an HIV-infected mother?",
    "choices": [
      {
        "id": 1,
        "text": "HIV DNA PCR"
      },
      {
        "id": 2,
        "text": "Cord blood ELISA"
      },
      {
        "id": 3,
        "text": "Western blot"
      },
      {
        "id": 4,
        "text": "Third generation ELISA"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a <strong>baby</strong> born to an <strong>HIV-infected mother</strong>, HIV infection is diagnosed using <strong>HIV DNA PCR</strong>. NACO recommends the use of a qualitative HIV-1 DNA PCR (NAT) in children aged &lt;18 months for <strong>Early Infant Diagnosis&nbsp;</strong>(EID).</p>\n<p><strong>Antibody assays</strong> (e.g., ELISA) are <strong>not reliable</strong> in infants and young children because of the persistence of transplacentally acquired maternal antibodies. For this reason, HIV virologic testing must be performed using tests that detect HIV DNA or RNA to diagnose HIV infection in children.</p>\n<p><strong>Scheduled repeated testing</strong> is necessary because test sensitivity increases with time from HIV virus exposure and very recent infection will not be detectable. The <strong>cord blood</strong> should <strong>not be used</strong> for testing because of the possibility of contamination of the sample with maternal blood.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 29-year-old HIV-positive woman presents to the OPD with fever, cough, and hemoptysis. Chest X-ray is given below. What is the diagnostic test for this condition in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Cartridge based nucleic acid amiplification test"
      },
      {
        "id": 2,
        "text": "Sputum microscopy & AFB staining"
      },
      {
        "id": 3,
        "text": "Interferon gamma release assay"
      },
      {
        "id": 4,
        "text": "Bronchoalveolar lavage fluid cytology"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of <strong>tuberculosis</strong>.&nbsp;Cartridge-based nucleic acid amiplification test (<strong>CBNAAT</strong>) is the diagnostic test for <strong>TB in HIV&nbsp;</strong>positive patients.&nbsp;</p>\n<p class=\"p1\">CBNAAT is a <strong>rapid</strong> molecular test that detects the <strong>DNA </strong>of TB bacteria in HIV-positive individuals. It uses sputum or any other biological specimen (except blood and blood-contaminated specimens). It can give a result in less than 2 hours. It can also detect the genetic <strong>mutations</strong> associated with <strong>resistance</strong> to the drug <strong>rifampicin</strong>.&nbsp;</p>\n<p>Sputum microscopy has poor sensitivity for detecting TB in HIV-infected individuals due to fewer organisms in sputum.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/99cd01362b8443a688d701311b3d05c4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old man was admitted for multiple episodes of seizures following 7 months of neurocognitive decline. He also had weight loss, paranoia, and delusions. Clinical workup revealed HIV infection along with the following findings on MRI. What is the ideal timing of steroid therapy in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1 day before performing a biopsy"
      },
      {
        "id": 2,
        "text": "Just before obtaining the sample for a biopsy"
      },
      {
        "id": 3,
        "text": "Only after obtaining a biopsy"
      },
      {
        "id": 4,
        "text": "There is no specific ideal timing"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p class=\"p1\">The given clinical scenario is suggestive of <strong>primary CNS lymphoma&nbsp;</strong>(PCNSL). In this condition, <strong>glucocorticoids</strong> should be administered only <strong>after </strong>a<strong> biopsy</strong> has been obtained. This is because steroids have a<strong> cytolytic effect </strong>on lymphoma cells and hence may lead to nondiagnostic tissue. &nbsp;</p>\n<p>On CT, PCNSL is identified as a hyperdense enhancing supratentorial mass. On MRI, vivid homogeneous enhancement, as well as restricted diffusion, is seen.&nbsp;</p>\n<p>PCNSL is a type of&nbsp;<strong>non-Hodgkin's lymphoma</strong>. The workup usually includes:</p>\n<ul>\n<li>HIV testing</li>\n<li>CSF analysis</li>\n<li>MRI spine&nbsp;</li>\n<li>PET/CT to assess the extent of the disease</li>\n<li>Bone marrow biopsy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/35488a35aa56417d9fdf10ff17c6a1e0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the WHO recommendation regarding the initiation of cotrimoxazole prophylaxis?",
    "choices": [
      {
        "id": 1,
        "text": "Any CD4 count or WHO clinical stage"
      },
      {
        "id": 2,
        "text": "CD4 count <500 and/or WHO stage 3/4"
      },
      {
        "id": 3,
        "text": "CD4 count <350 and/or WHO stage 3/4"
      },
      {
        "id": 4,
        "text": "CD4 count <150 and/or WHO stage 3/4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>WHO recommends cotrimoxazole prophylaxis at <strong>CD4 count &lt;350 and/or WHO stage 3/4</strong>.</p>\n<p>Only in settings where <strong>malaria or severe bacterial infections</strong> are highly prevalent, co-trimoxazole prophylaxis should be initiated regardless of WHO clinical stage or CD4 counts.</p>\n<p>Prophylaxis in HIV patients:</p>\n<div class=\"page\" title=\"Page 1476\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<table style=\"height: 102px; width: 405px;\">\n<tbody>\n<tr>\n<td style=\"width: 172px;\"><strong>Organism</strong></td>\n<td style=\"width: 106.453px;\"><strong>CD4 count below which prophylaxis is started</strong></td>\n<td style=\"width: 100.547px;\"><strong>Drug given</strong></td>\n</tr>\n<tr>\n<td style=\"width: 172px;\">\n<div class=\"page\" title=\"Page 1477\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Pneumocystis jirovecii</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 106.453px;\">\n<p>&lt;200/mm<sup>3</sup></p>\n<p><sup>&nbsp;</sup>(Acc to CDC)</p>\n<p>&lt;350 /mm<sup>3</sup></p>\n<p>(Acc to WHO and NACO)</p>\n</td>\n<td style=\"width: 100.547px;\">TMP-SMX (Cotrimoxazole)</td>\n</tr>\n<tr>\n<td style=\"width: 172px;\">\n<div class=\"page\" title=\"Page 1477\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Mycobacterium-avium complex</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 106.453px;\">&lt;50/mm<sup>3</sup></td>\n<td style=\"width: 100.547px;\">Azithromycin</td>\n</tr>\n<tr>\n<td style=\"width: 172px;\">\n<div class=\"page\" title=\"Page 1477\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Toxoplasma gondii</p>\n</div>\n</div>\n</div>\n</td>\n<td style=\"width: 106.453px;\">&lt;100/mm<sup>3</sup></td>\n<td style=\"width: 100.547px;\">TMP-SMX (Cotrimoxazole)</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A cachexic man presented with a non-productive cough and shortness of breath. He was diagnosed with HIV 6 months ago but is non-adherent to ART. Serum LDH is 350 U/L. Giemsa-stained smears are seen below. At what CD4 count should the prophylaxis be started according to the CDC recommendation to prevent this disease?",
    "choices": [
      {
        "id": 1,
        "text": "<100/mm3"
      },
      {
        "id": 2,
        "text": "<150/mm3"
      },
      {
        "id": 3,
        "text": "<400/mm3"
      },
      {
        "id": 4,
        "text": "<200/mm3"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Note : TMP-SMX also provides protection against toxoplasmosis and some bacterial respiratory pathogens. The prophylaxis is discontinued in those patients treated with ART who maintain good suppression of HIV (&lt;50 copies/mL) and CD4+ T-cell counts &gt;200/ \u03bcL for at least 3 months.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4519552dd7c43a9b4fdd6cbe7bc3642.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "You suffer a bleeding puncture wound on your finger while assisting with surgery on a patient infected with HIV. What regimen should you take in this situation?",
    "choices": [
      {
        "id": 1,
        "text": "Zidovudine + Lamivudine for 4 weeks"
      },
      {
        "id": 2,
        "text": "Lamivudine + Tenofovir + Efavirenz for 4 weeks"
      },
      {
        "id": 3,
        "text": "Lamivudine + Tenofovir + Dolutegravir for 4 weeks"
      },
      {
        "id": 4,
        "text": "Tenofovir + Lamivudine + Nevirapine for 4 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Recommended <strong>post-exposure prophylaxis&nbsp;</strong>(PEP) is a three-drug regimen that includes<strong>&nbsp;lamivudine,&nbsp;</strong><strong>tenofovir, and dolutegravir</strong>.</p>\n<p>A regimen for HIV post-exposure prophylaxis with two ARV drugs is effective, but three drugs are preferred. The PEP must be initiated <strong>ideally within 2 hours</strong> and certainly <strong>within 72 hours</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8115059da00d45c195c82188db4e14ccx1280x1488.JPEG"
    ]
  }
];
        let quizName = '100 Hiv   Aids - Management And Prophylaxis';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>