<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acls Bls Pals Atls Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "All are components of Basic Life Support (BLS), except:",
    "choices": [
      {
        "id": 1,
        "text": "Cardiac massage"
      },
      {
        "id": 2,
        "text": "Automated External Defibrillator"
      },
      {
        "id": 3,
        "text": "Bag with mask"
      },
      {
        "id": 4,
        "text": "Needle Cricothyrotomy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Needle cricothyrotomy is not a component of <strong>BLS</strong>. It is a component of Advanced Life Support (<strong>ALS</strong>).</p>\n<p>Components of BLS:</p>\n<ul>\n<li>Airway - Manual</li>\n<li>Breathing - Bag and Mask</li>\n<li>Circulation - Cardiac massage</li>\n<li>Defibrillation - Automated External Defibrillator/Public access Defibrillator</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While working out at the gymnasium, you witness a weightlifter collapse. What is the correct sequence to be followed to provide basic life support to this victim?",
    "choices": [
      {
        "id": 1,
        "text": "Verify scene safety, assess responsiveness, check for pulse, call the emergency response team, commence cardiopulmonary resuscitation (CPR)"
      },
      {
        "id": 2,
        "text": "Verify scene safety, call the emergency response team,  assess responsiveness, check for pulse, commence cardiopulmonary resuscitation(CPR)"
      },
      {
        "id": 3,
        "text": "Verify scene safety, assess responsiveness, call the emergency response team, check for pulse , commence cardiopulmonary resuscitation (CPR)"
      },
      {
        "id": 4,
        "text": "Verify scene safety, check for pulse,  assess responsiveness, call the emergency response team, commence cardiopulmonary resuscitation (CPR)"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Basic life support should be provided in the following sequence for a <strong>witnessed collapse</strong>:<strong> verify scene safety, assess responsiveness, call the emergency response team, check for pulse, and then commence cardiopulmonary resuscitation (CPR).</strong></p>\n<p>First, assess scene safety to ensure the environment is safe for the rescuers and the victim.</p>\n<p>The next step is to check for responsiveness. If unresponsive, activate the emergency response system and get the automated external defibrillator (AED) before starting CPR if you are alone. Otherwise, send someone to activate the response system and get the automated external defibrillator (AED).</p>\n<div class=\"elementor-element elementor-element-42a5f4c5 elementor-icon-list--layout-traditional elementor-list-item-link-full_width elementor-widget elementor-widget-icon-list\" data-id=\"42a5f4c5\" data-element_type=\"widget\" data-widget_type=\"icon-list.default\">\n<div class=\"elementor-widget-container\">\n<p>Check the patient for a carotid pulse for 5-10 seconds. If the patient has a pulse but no normal breathing or only gasping, p<span class=\"elementor-icon-list-text\">rovide 1 breath every 6 seconds or 10-12 rescue breaths /minute and recheck pulse every 2 minutes.</span></p>\n<p><span class=\"elementor-icon-list-text\">If the patient does not have a pulse and is not breathing, proceed to provide high-quality CPR.</span></p>\n<p><span class=\"elementor-icon-list-text\">Continuous chest compressions should be given on the lower 1/3rd of the patient's sternum by pushing hard and fast at the rate of <strong>100-120/minute</strong>, at a compression depth of <strong>at least 2 inches</strong> (5-6 cm) allowing complete chest recoil after every compression. Rescue breaths are given every 6 seconds or 10-12 breaths/minute.</span></p>\n<p>Effective chest compressions in a<strong> child older than 1 year and up to puberty </strong>should be at t<strong>he</strong> compression rate is <strong>100 - 120/min</strong>\u00a0 (30 compressions for every 15-18 sec), depth of\u00a0<strong>2 inches </strong>by pressing hard and fast. Allow for full chest recoil after every compression. Minimize interruptions in chest compression to less than 10 seconds.</p>\n<p>Analyze if it is a shockable rhythm when the AED arrives. If it is shockable, then give one shock and proceed with CPR. If it is a non-shockable rhythm then continue CPR immediately.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b200ea81b4c4699b14b325723a999abx1280x4216.JPEG"
    ]
  },
  {
    "text": "You are posted as a junior resident in the Emergency Medicine department, where you have to resuscitate an 11-month-old infant who is not breathing and you cannot get the pulse. According to the AHA 2020 guidelines for the pediatric basic and advanced life support, you would be correct to perform all of the following steps except:",
    "choices": [
      {
        "id": 1,
        "text": "Administer  at least 20-30 breaths/min"
      },
      {
        "id": 2,
        "text": "Use a cuffed endotracheal tube for intubating this child"
      },
      {
        "id": 3,
        "text": "Apply cricoid pressure  during endotracheal intubation"
      },
      {
        "id": 4,
        "text": "Administer the initial dose of epinephrine within 5 minutes from the start of chest compressions"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the AHA 2020 guidelines, routine use of cricoid pressure is <strong>not</strong> recommended during the endotracheal intubation of pediatric patients.</p>\n<p>It is reasonable to choose <strong>cuffed ETT</strong>s over uncuffed ETTs for intubating infants and children. When a cuffed ETT is used, attention should be paid to tube size, position, and cuff inflation pressure (usually &lt;20-25 cm H2O).</p>\n<p>For infants and children with a pulse but an absent or inadequate respiratory effort, it is reasonable to give 1 breath every 2 to 3 seconds <strong>(20-30 breaths/min)</strong>. For pediatric patients in any setting, it is reasonable to administer the<strong> initial dose of epinephrine within 5 minutes</strong> from the start of chest compressions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is incorrect about the appropriate use of an automated external defibrillator (AED) during resuscitation?",
    "choices": [
      {
        "id": 1,
        "text": "Does not deliver shock if asystole is detected"
      },
      {
        "id": 2,
        "text": "200 J biphasic waveform is delivered"
      },
      {
        "id": 3,
        "text": "CPR is continued during rhythm analysis"
      },
      {
        "id": 4,
        "text": "Pads are placed in anterior-lateral or anterior-posterior positions"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Cardiopulmonary</strong> <strong>resuscitation</strong> (CPR) should be <strong>paused</strong> during rhythm analysis as AEDs cannot recognize the shockable rhythms accurately<strong> </strong>if CPR is continued.\u00a0</p>\n<p>AED is a special medical device that is commonly used for recognizing the absence/presence of <strong>rapid ventricular tachycardia</strong> or <strong>ventricular</strong> <strong>fibrillation</strong>, hence<strong> </strong>identifying a shockable rhythm autonomously if present. Below is an image of an AED.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/baf3f864498e42b8915a54a767dc2bd9x849x1124.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/495bcbe7a00945f5a2f1b112ea242615x1013x1304.PNG"
    ]
  },
  {
    "text": "A 6-year-old child, weighing 20 kg presents to the emergency room with partial to full-thickness burns covering 20% of his total body surface area. As per the ATLS guidelines, the volume of fluids that need to be administered over 24 hours in this patient is?",
    "choices": [
      {
        "id": 1,
        "text": "0.8 L of ringer lactate"
      },
      {
        "id": 2,
        "text": "1.2 L of ringer lactate"
      },
      {
        "id": 3,
        "text": "1.6 L of ringer lactate"
      },
      {
        "id": 4,
        "text": "2.4 L of ringer lactate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p class=\"ng-binding\">The child needs fluid resuscitation with <strong>1.2 L of ringer lactate</strong>\u00a0in 24 hours.\u00a0</p>\n<p>According to the 10th Edition of ATLS (2018),\u00a0fluid resuscitation in a <strong>pediatric patient &lt; 14 years</strong> should begin at<strong> 3 ml of lactated Ringer\u2019s x % TBSA x patient\u2019s body weight in kg\u00a0</strong>for second\u00a0and third-degree burns.\u00a0</p>\n<p>In this case, 20 (% TBSA) x 20 (body weight in kg) x 3 = <strong>1200ml</strong></p>\n<p>Therefore, the <strong>total volume of RL to be given is 1.2 litres</strong>.</p>\n<p>Note:</p>\n<p>The superficial/1st-degree burns are not considered for the formula. Only the % TBSA of 2nd and 3rd-degree burns is calculated for the formula.</p>\n<p>The<strong> goal of resuscitation</strong> is to maintain a fine balance of adequate perfusion as <strong>indicated by urine output.</strong> It is important to understand that formulas provide a starting target rate; subsequently, the amount of fluids provided should be adjusted based on a urine output target of 0.5 mL/kg/hr for adults and 1 mL/kg/hr for children weighing less than 30 kg.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A victim of a road traffic accident is brought to the casualty department. Which of the following is a part of step 'D' under A-B-C-D-E of trauma care?",
    "choices": [
      {
        "id": 1,
        "text": "Cervical spine stabilization"
      },
      {
        "id": 2,
        "text": "GCS scoring for basic neurologic evaluation"
      },
      {
        "id": 3,
        "text": "Oxygenation"
      },
      {
        "id": 4,
        "text": "Hemorrhage control"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>GCS scoring for basic neurologic evaluation&nbsp;</strong>is a part of step D-<strong>Disability assessment&nbsp;</strong>of trauma care.</p>\n<p>Steps in the Advanced Trauma Life Support (ATLS):</p>\n<ul>\n<li><strong>Primary</strong> survey with simultaneous resuscitation &ndash; identify and treat what is killing the patient</li>\n<li><strong>Secondary</strong> survey &ndash; proceed to identify all other injuries</li>\n<li><strong>Definitive care</strong> &ndash; develop a definitive management plan</li>\n</ul>\n<p><strong>ABCDE</strong> of trauma care:</p>\n<ul>\n<li>Airway assessment and protection (maintain <strong>cervical spine stabilization</strong> when appropriate)</li>\n<li>Breathing and ventilation assessment (maintain adequate <strong>oxygenation</strong>)</li>\n<li>Circulation assessment (<strong>control hemorrhage</strong> and maintain adequate end-organ perfusion)</li>\n<li>Disability assessment (perform <strong>basic neurologic evaluation</strong>)</li>\n<li>Exposure, with environmental control (undress patient and search everywhere for possible injury, while preventing hypothermia)</li>\n</ul>\n<p><strong>Adjuncts</strong> to the primary survey:</p>\n<ul>\n<li><strong>Blood</strong>&nbsp;- FBC, urea and electrolytes, clotting screen, glucose, toxicology, cross-match</li>\n<li>ECG, pulse oximetry, ventilatory rate, capnography, ABG analysis</li>\n<li><strong>Two wide-bore cannulae</strong> for intravenous fluids</li>\n<li>Urinary and gastric catheters</li>\n<li>Radiographs of the chest and pelvis are done as a part of the primary survey preferably with a portable x-ray unit. When required, all these x-rays must also be done in pregnant women.</li>\n</ul>\n<p>Other more <strong>specialized</strong> forms of <strong>imaging,</strong> such as ultrasound, computerized tomography, angiography, and diagnostic peritoneal lavage, should be considered after the <strong>secondary survey</strong> and only when the patient is <strong>stable after initial resuscitation.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Arrange the following patients in descending order of treatment priority as per the triage system.",
    "choices": [
      {
        "id": 1,
        "text": "4>1>3>2"
      },
      {
        "id": 2,
        "text": "1>2>3>4"
      },
      {
        "id": 3,
        "text": "1>3>2>4"
      },
      {
        "id": 4,
        "text": "4>3>1>2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option C is the correct sequence of triage colour coding.</p>\n<ul>\n<li>A young man with tension pneumothorax - <strong>Red</strong> - Highest priority</li>\n<li>A middle-aged woman with a degloving injury of the left leg - <strong>Yellow</strong> - Medium priority</li>\n<li>A middle-aged man with a simple fracture of the ulna - <strong>Green</strong> - Low priority</li>\n<li>A teenage girl with severe brain injury and major chest wall and abdominal injuries - <strong>Black</strong> - Least priority</li>\n</ul>\n<p>Triage is used to <strong>classify the priority of treatment.\u00a0</strong>It is carried out at the disaster site to determine the <strong>priority for immediate medical attention</strong>, <strong>transportation</strong>, and <strong>admission</strong> to the hospital.</p>\n<p>Triage includes rapid classification of the injured based on their injuries and the chances of survival with prompt medical intervention. It provides maximum benefit to the greatest number of injured in a disaster situation. Higher priority is given to victims whose prognosis would be good with simple medical care. Lower priority is given to moribund patients who would have questionable benefits even with medical attention.</p>\n<table style=\"height: 489px; width: 544px;\">\n<tbody>\n<tr style=\"height: 17px;\">\n<td style=\"width: 76.625px; height: 17px;\"><strong>Priority</strong></td>\n<td style=\"width: 90.3516px; height: 17px;\"><strong>Color</strong></td>\n<td style=\"width: 90.938px; height: 17px;\"><strong>Medical need</strong></td>\n<td style=\"width: 229.898px; height: 17px;\"><strong>Clinical status</strong></td>\n</tr>\n<tr style=\"height: 69px;\">\n<td style=\"width: 76.625px; height: 69px;\">First (I)</td>\n<td style=\"width: 90.3516px; height: 69px;\">Red</td>\n<td style=\"width: 90.938px; height: 69px;\">Immediate</td>\n<td style=\"width: 229.898px; height: 69px;\">Critical, but likely to survive if the treatment is given early</td>\n</tr>\n<tr style=\"height: 52px;\">\n<td style=\"width: 76.625px; height: 52px;\">Second (II)</td>\n<td style=\"width: 90.3516px; height: 52px;\">Yellow</td>\n<td style=\"width: 90.938px; height: 52px;\">Urgent</td>\n<td style=\"width: 229.898px; height: 52px;\">Critical, likely to survive if the treatment is given within hours</td>\n</tr>\n<tr style=\"height: 47px;\">\n<td style=\"width: 76.625px; height: 47px;\">Third (III)</td>\n<td style=\"width: 90.3516px; height: 47px;\">Green</td>\n<td style=\"width: 90.938px; height: 47px;\">Non-urgent</td>\n<td style=\"width: 229.898px; height: 47px;\">Stable, likely to survive even if treatment is delayed for hours to days</td>\n</tr>\n<tr style=\"height: 73px;\">\n<td style=\"width: 76.625px; height: 73px;\">Last (0)</td>\n<td style=\"width: 90.3516px; height: 73px;\">Black</td>\n<td style=\"width: 90.938px; height: 73px;\">Unsalvageable</td>\n<td style=\"width: 229.898px; height: 73px;\">Not breathing, pulseless, so severely injured that no medical care is likely to help</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-month-old child who was unresponsive and cyanotic was brought to the emergency. Which of the following is the recommended site to check for pulselessness before initiating CPR?",
    "choices": [
      {
        "id": 1,
        "text": "Carotid artery"
      },
      {
        "id": 2,
        "text": "Brachial artery"
      },
      {
        "id": 3,
        "text": "Radial artery"
      },
      {
        "id": 4,
        "text": "Popliteal artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\">The <strong>brachial artery</strong> is palpated in <strong>infants</strong> to check for pulselessness before initiating CPR.</p>\n<p style=\"text-align: left;\">The pulse should be checked at the <strong>carotid </strong>artery for children aged <strong>one </strong>and <strong>above</strong>.\u00a0</p>\n<p style=\"text-align: left;\">The short neck of children &lt;1 year of age makes the rapid location of the carotid artery difficult. There is a <strong>risk</strong> of <strong>compressing</strong> the <strong>airway</strong> while attempting to palpate a carotid pulse in the infant\u2019s neck. Therefore, it is recommended to palpate the brachial pulse before initiating CPR in infants. The brachial pulse is palpated on the inside of the upper arm, between the infant\u2019s elbow and shoulder. The inside of the upper arm is pressed with the index and middle fingers gently for no more than 10 seconds.\u00a0</p>\n<p style=\"text-align: left;\">Chest compressions in infants are given by placing\u00a0<strong>two fingers</strong>, one between the nipple line and the other 1 cm below it if only one provider is available. The torso is encircled by the palms of both hands with the<strong>\u00a0thumbs</strong>\u00a0pointing cephalad and positioned 1 cm below the nipples over the sternum.</p>\n<p>The depth of compressions in infants should be\u00a0at least\u00a0<strong>1.5 inches or 1/3 the depth</strong>\u00a0of the infant\u2019s chest.</p>\n<p>Effective chest compressions in<strong>\u00a0infants (&lt;1 year):</strong></p>\n<ul>\n<li>100 to 120 compressions per minute (30 compressions for every 15-18 sec).</li>\n<li><strong>One provider: Place two fingers</strong>, one between the nipple line and the other 1 cm below the first finger</li>\n<li><strong>Two providers:</strong>\u00a0Encircle the infant's torso with both hands, thumbs pointing cephalad\u00a0and positioned 1cm below the nipples over the sternum.\u00a0</li>\n<li>Depth of compressions should be\u00a0at least\u00a0<strong>1.5 inches or 1/3 the depth</strong> in <strong>infants (&lt;1 year)</strong>.\u00a0</li>\n<li>Press hard and fast</li>\n<li>Allow for full chest recoil after every compression</li>\n</ul>\n<p>Effective chest compressions in a<strong>\u00a0child older than 1 year and up to puberty:</strong></p>\n<ul>\n<li style=\"text-align: left;\">The <strong>heel of the palm</strong> <strong>on the lower 1/3rd of the sternum</strong> is applied during chest compression</li>\n<li style=\"text-align: left;\">The depth of compression is <strong>2 inches or 1/3 the depth</strong> of the patient's chest.</li>\n</ul>\n<p>Ideally, there should be <strong>30 chest compressions </strong>and<strong> 2 breaths</strong> i.e.\u00a0100-120 compressions per minute (use 15:2 ratio if the second rescuer arrives).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/27c1ff8c42e94d16bec98aec3dd6cbc4x1280x4216.JPEG"
    ]
  },
  {
    "text": "A 65-year-old man was brought to the casualty unconscious and pale, with agonal respirations and without a pulse. He has a history of hypertension, hyperlipidaemia, 40 pack-years of cigarette smoking and was witnessed falling to the ground suddenly at home. He had not complained of any preceding symptoms. A cardiac monitor was connected and the following tracing was obtained. What is the next step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Defibrillation"
      },
      {
        "id": 2,
        "text": "Synchronized cardioversion"
      },
      {
        "id": 3,
        "text": "6 mg adenosine IV"
      },
      {
        "id": 4,
        "text": "1 mg epinephrine IV"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The patient is in cardiac arrest and the rhythm shown is <strong>ventricular fibrillation.</strong>&nbsp;The next step in management is <strong>immediate defibrillation.</strong></p>\n<p>It is of <strong>utmost necessity to defibrillate at the earliest</strong> because the chances of survival decrease by 7-10% every minute without defibrillation.</p>\n<p>Defibrillation involves delivering an electrical current between two pads placed on the chest so as to interrupt the disorganized cardiac activity and restore an organized cardiac rhythm. The energy that must be applied is</p>\n<ul>\n<li>Monophasic defibrillator: 360 J</li>\n<li>Biphasic defibrillator: 120-200 J</li>\n</ul>\n<p>Note - The management of ventricular fibrillation and pulseless ventricular tachycardia is the same. Chest compressions are to be started following defibrillation.</p>\n<p>Other options</p>\n<p>Option B - Synchronized <strong>cardioversion</strong> is used in <strong>unstable tachyarrhythmias</strong>. It is not used in cardiac arrests.</p>\n<p>Option C - <strong>Adenosine</strong> is used in regular <strong>narrow complex tachycardia</strong> and in stable <strong>wide complex tachycardia with monomorphic QRS complexes</strong>. It is not used in cardiac arrests.</p>\n<p>Option D - <strong>Epinephrine</strong> is used after administering defibrillation and also in <strong>non-shockable rhythms</strong> (asystole and pulseless electrical activity).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0b95b2211357489fba61e01484e673ce.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "An obese patient was brought to the casualty following a road traffic accident.  He was diagnosed with tension pneumothorax. An immediate needle thoracotomy was performed in spite of which the vitals did not improve. What will be your next best step in managing this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Refer the patient immediately to tertiary care centre"
      },
      {
        "id": 2,
        "text": "Perform a finger thoracostomy"
      },
      {
        "id": 3,
        "text": "Tracheostomy to secure airway"
      },
      {
        "id": 4,
        "text": "Perform an eFAST to confirm the diagnosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The next best step for this patient would be to perform a <strong>finger thoracostomy.</strong></p>\n<p>According to ATLS, due to the variable thickness of the chest wall (<strong>here the patient is obese</strong>), kinking of the catheter, and other technical or anatomic complications, needle decompression may not be successful always. In this case, <strong>finger thoracostomy </strong>is an alternative approach and<strong>\u00a0is recommended as the next best step.</strong></p>\n<p>Advantages of finger thoracostomy over needle thoracostomy:</p>\n<ul>\n<li>Not limited by needle length</li>\n<li>Observable signs confirming pleural access\n<ul>\n<li>Puncture sensation of parietal pleura with Kelly/finger</li>\n<li>Palpation of parietal pleura with finger</li>\n<li>Palpation of lung parenchyma with finger</li>\n</ul>\n</li>\n<li>If there is no pneumothorax, this will not puncture lung parenchyma and create a new pneumothorax</li>\n<li>No risk of catheter \"kinking\"</li>\n</ul>\n<p>Advantages of finger thoracostomy over tube thoracostomy:</p>\n<ul>\n<li>Simpler, quicker, easier, and requires less equipment</li>\n<li>No foreign body hence decreased risk of infection</li>\n</ul>\n<p>However, it is <strong>mandatory</strong> to perform a<strong> Tube thoracostomy</strong> after a successful needle or finger decompression of the chest.</p>\n<p>The RECENT UPDATE (Acc. to ATLS 10th edition):</p>\n<ul>\n<li>In <strong>adults,</strong> the needle<strong> thoracotomy</strong> location changed to the <strong>5th ICS mid-axillary line</strong> from the 2nd ICS midclavicular line.</li>\n<li>In the <strong>pediatric</strong> age group, the <strong>thoracotomy</strong> location remains at the <strong>2nd ICS midclavicular line.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the emergency department following a road traffic accident. He is found to be in hemorrhagic shock. As a part of the ATLS protocol, which of the following cannula should be preferred for fluid resuscitation in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "1"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to <strong>ATLS</strong> guidelines, a minimum of 2 large bore IV lines preferably of <strong>18 gauge (green)</strong>&nbsp;marked as \"1\" should be used for fluid <strong>resuscitation</strong> of <strong>trauma</strong> patients with large volume loss.</p>\n<p>For<strong>&nbsp;trauma patients</strong> who necessitate a high volume of fluid replacement and multiple blood transfers<strong> large-sized</strong>, <strong>wide-bored</strong> cannulas are preferred.</p>\n<div class=\"page\" title=\"Page 105\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The <strong>rate</strong> of <strong>flow</strong> is <strong>proportional</strong> to the fourth power of the <strong>radius</strong> of the cannula and <strong>inversely</strong> related to its <strong>length</strong>, as described in Poiseuille&rsquo;s law. Hence, short, large-caliber peripheral intravenous lines are preferred for the rapid infusion of fluid, rather than longer, thinner catheters. Higher the gauge of the cannula, lower the caliber of the cannula.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d4a8bd8184e34f67b5524480bf37b6ca.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "In which of the following cases of cardiac arrest the use of defibrillators is not recommended?",
    "choices": [
      {
        "id": 1,
        "text": "1 & 3"
      },
      {
        "id": 2,
        "text": "2 & 3"
      },
      {
        "id": 3,
        "text": "1 & 4"
      },
      {
        "id": 4,
        "text": "1, 3 & 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In cases of asystole and pulseless electrical activity the use of a defibrillator, during resuscitation for cardiac arrest, is not recommended.</p>\n<p><strong>Defibrillation</strong> involves the <strong>depolarization</strong> of the <strong>entire myocardium</strong> by the therapeutic use of electric current to eliminate cardiac rhythms associated with cardiac arrest. This <strong>resets</strong> the myocardium and <strong>normal sinus rhythm</strong> is restored.</p>\n<p><strong>Shockable rhythms</strong> of cardiac arrest include <strong>ventricular fibrillation</strong> and <strong>pulseless ventricular tachycardia</strong>. <strong>Non-shockable rhythms</strong> of cardiac arrest include <strong>asystole</strong> and <strong>pulseless electrical activity</strong>.</p>\n<p><strong>Asystole</strong> is the complete and sustained <strong>absence</strong> of <strong>electrical activity</strong>. It is usually seen as a terminal rhythm in a resuscitation attempt that started with another rhythm, or in a patient with unwitnessed or prolonged cardiac arrest. The prognosis for persistent asystole is poor. A <strong>pulseless electrical activity</strong> involves a heterogeneous group of <strong>cardiac rhythms</strong>, all <strong>without a pulse</strong>.</p>\n<p>The adult cardiac arrest algorithm according to the 2020 ACA guidelines is given in the pearl below.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A man presents to the ER with a gunshot wound to the abdomen as shown below. On examination, the peritoneum is breached. BP is 114/78 mmHg and HR is 80 bpm. Which of the following is the most appropriate next step?",
    "choices": [
      {
        "id": 1,
        "text": "Laparotomy"
      },
      {
        "id": 2,
        "text": "CT scan of the abdomen"
      },
      {
        "id": 3,
        "text": "FAST"
      },
      {
        "id": 4,
        "text": "Observation for the next 24 hours"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most appropriate management for a patient with a <strong>gunshot wound</strong> to the <strong>anterior abdominal wall</strong> with a <strong>breach of the peritoneum</strong> is <strong>laparotomy</strong>.</p>\n<p>The incidence of significant injury to the intraperitoneal organs increases manifold when there is a breach of the peritoneum due to any penetrating trauma injury.&nbsp;The <strong>indications for doing laparotomy</strong> in patients with penetrating abdominal wounds include:</p>\n<ul>\n<li><strong>Hemodynamic instability</strong></li>\n<li><strong>Gunshot wound</strong> which breaches the peritoneum</li>\n<li><strong>Evisceration</strong></li>\n<li>Bleeding from the stomach, rectum, or genitourinary tract following penetrating trauma</li>\n<li><strong>Peritonitis</strong></li>\n<li><strong>Free air in the peritoneal cavity</strong></li>\n<li><strong>Diagnostic peritoneal lavage</strong> has&nbsp;bile, gastrointestinal contents or&nbsp;<strong>&ge;10 cc of blood</strong></li>\n</ul>\n<p><strong>CT scan</strong> of the abdomen (option B) should be performed in patients with <strong>blunt or penetrating abdominal trauma</strong>, provided they are <strong>hemodynamically stable</strong> and have <strong>no indication for immediate laparotomy</strong>. The patient in question has a gunshot wound to the anterior abdominal wall with a peritoneal breach, which is an indication for exploratory laparotomy as it carries a high risk of organ injury. <strong>FAST</strong> (option C) is primarily indicated in patients with <strong>blunt abdominal trauma</strong> <strong>with or without hemodynamic instability</strong>. It is <strong>not a sensitive investigation</strong> to detect hollow visceral injury in patients with <strong>penetrating abdominal trauma</strong>. There is no role for observation (option D) in this patient.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d6e1c06cb9a74d5d86a33cf3e45522a5.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 57-year-old unresponsive male patient is brought to the hospital. He is pulseless and is not breathing. His lead II ECG rhythm strip is shown in the image below. Which of the following drugs will not be used in his management?",
    "choices": [
      {
        "id": 1,
        "text": "Verapamil"
      },
      {
        "id": 2,
        "text": "Amiodarone"
      },
      {
        "id": 3,
        "text": "Adrenaline"
      },
      {
        "id": 4,
        "text": "Lidocaine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The ECG with no identifiable P wave, QRS complexes, and irregular rhythm is\u00a0<strong>ventricular fibrillation </strong>(VF)\u00a0and the treatment is<strong> defibrillation</strong> followed by CPR and amiodarone, adrenaline, and lidocaine given alternatively as per the ACLS guidelines. Verapamil is not a part of the ACLS algorithm for the management of VF. (Option A)</p>\n<p>Ventricular fibrillation is a <strong>disorganized ventricular rhythm</strong>. In a heart with ventricular fibrillation, there is <strong>little to\u00a0no cardiac output </strong>as there is\u00a0irregular cardiac contraction. In patients outside the hospital, sustained ventricular tachycardias are a common cause leading to ventricular fibrillation.</p>\n<p>VF is a <strong>shockable</strong> <strong>rhythm.\u00a0</strong>Thus, defibrillation must be performed in order to restore normal sinus rhythm according to advanced cardiac life support (ACLS) guidelines.\u00a0In defibrillation, an electrical current is passed into the myocardium which 'resets' it by converting the dysrhythmia into a normal sinus rhythm.\u00a0</p>\n<p>Along with defibrillation, CPR should be given for 2 minutes and alternated with <strong>Epinephrine 1mg</strong> or <strong>Lidocaine/Amiodarone.</strong> At the same time, any reversible causes of Vfib should be treated.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/df952889a4404a779eb164bcbf9603bc.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a5c6dc40249847619f591f4b73697477x1280x654.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3bd02263e48f4c4397dc8d9432d7e288x918x523.JPEG"
    ]
  },
  {
    "text": "According to CRASH-2 trials, tranexamic acid has a role in the reduction of mortality in patients with trauma. Within how many hours of injury should it be administered to a patient with a history of trauma?",
    "choices": [
      {
        "id": 1,
        "text": "2 hours"
      },
      {
        "id": 2,
        "text": "3 hours"
      },
      {
        "id": 3,
        "text": "4 hours"
      },
      {
        "id": 4,
        "text": "8 hours"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Tranexamic acid needs to be administered <strong>within 3 hours of injury</strong>. It is an <strong>antifibrinolytic drug</strong> that reduces the risk of mortality from bleeding in both blunt and penetrating trauma.</p>\n<p><strong>1g\u00a0</strong>is given<strong> intravenously over 10 minutes</strong>, followed by a<strong> further 1 g</strong> dose<strong> over 8 hours</strong>. Tranexamic acid should be given to all trauma patients suspected to have a <strong>significant haemorrhage</strong>, including those with a <strong>systolic blood pressure of &lt;110 mmHg</strong> or a <strong>pulse of over 110 per minute</strong>.</p>\n<p>It is imperative to administer the treatment as early as possible, ideally within the initial hour following the injury. The initial dose <strong>should not be administered more than 3 hours</strong> after the injury occurred.</p>\n<p>The\u00a0<strong>CRASH-2 trial</strong>\u00a0has shown\u00a0<strong>mortality reduction</strong>\u00a0in\u00a0<strong>bleeding trauma patients</strong>\u00a0by early usage of\u00a0<strong>tranexamic acid.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old male patient was brought to the casualty after a road traffic accident and eFAST was performed on him. Which among the following statements is true regarding eFAST?",
    "choices": [
      {
        "id": 1,
        "text": "It detects free fluid in the abdomen or pericardium"
      },
      {
        "id": 2,
        "text": "It detects hollow viscus injury"
      },
      {
        "id": 3,
        "text": "It detects solid organ injury"
      },
      {
        "id": 4,
        "text": "It helps in assessment of retroperitoneum"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>eFAST/extended FAST</strong> helps in detecting <strong>free fluid in the abdomen and pericardium.</strong>\u00a0</p>\n<p><strong>Focused assessment with sonography for trauma\u00a0(FAST)</strong>\u00a0aims to identify<strong> intra-abdominal free fluid </strong>(assumed to be\u00a0hemoperitoneum\u00a0in the context of trauma)\u00a0allowing for an immediate transfer for surgery or for CT imaging and further workup.</p>\n<p><strong>The standard order of evaluation is:</strong></p>\n<ul>\n<li class=\"bulletIndent1\">Pericardial (subxiphoid)</li>\n<li class=\"bulletIndent1\">Right flank (perihepatic view or Morison's pouch)</li>\n<li class=\"bulletIndent1\">Left flank (perisplenic view)</li>\n<li class=\"bulletIndent1\">Pelvic (retrovesical views)</li>\n</ul>\n<p><strong>eFAST </strong>(Extended FAST) is used to assess\u00a0<strong>pleura</strong>l\u00a0(pneumothorax and hemothorax evaluation), <strong>pericardial</strong> region, <strong>right flank, left flank</strong>, and <strong>pelvic region</strong>. It is accurate in detecting &gt;100 ml of free blood. Hollow viscus injury and solid organ injury are difficult to diagnose. It is also unreliable in excluding injury in penetrating trauma. It is unreliable for the assessment of the retroperitoneum.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "How many healthcare providers are required to safely remove a helmet as per the ATLS guidelines?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "4"
      },
      {
        "id": 4,
        "text": "3"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Removing a helmet</strong> properly is a procedure that requires <strong>two individuals\u00a0</strong>as per ATLS 10th edition.</p>\n<p><strong>First-person</strong> <strong>restricts</strong> the <strong>cervical spine motion</strong> while the second person tries to expand the helmet laterally. Then, the <strong>second person gently removes</strong> the helmet, ensuring that the nose and occiput are cleared with ease. After the helmet is removed, the first person supports the weight of the patient\u2019s head and the second person takes over cervical spine motion restriction.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "National Emergency X-Radiography Utilization Study (NEXUS) criteria in a trauma patient are related to the ______ spine.",
    "choices": [
      {
        "id": 1,
        "text": "Cervical"
      },
      {
        "id": 2,
        "text": "Thoracic"
      },
      {
        "id": 3,
        "text": "Lumbar"
      },
      {
        "id": 4,
        "text": "Thoraco-lumbar"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>NEXUS criteria are related to the <strong>cervical</strong>\u00a0spine injury.</p>\n<p>In trauma patients, without the need for radiologic imaging, the decision to <strong>discontinue the cervical c-spine collar</strong> can be made using the clinical tools namely:</p>\n<ul>\n<li>National Emergency X-Radiography Utilization Study (NEXUS)</li>\n<li>Canadian C-spine rule (CCR)</li>\n</ul>\n<p><strong>NEXUS criteria: </strong>There are five criteria included under NEXUS. If a trauma patient meets all five criteria, then no radiography is required and the <strong>cervical c-spine collar</strong> may be removed. However, if any one of the criteria is met then radiography is done to evaluate further.</p>\n<p>The NEXUS criteria include:</p>\n<ol>\n<li>No posterior midline cervical spinal tenderness</li>\n<li>No evidence of intoxication</li>\n<li>A normal level of alertness</li>\n<li>No focal neurologic deficit</li>\n<li>No painful distracting injuries</li>\n</ol>\n<p><strong>Canadian C-spine rule: </strong>The rule is applicable to patients who are in an alert (Glasgow Coma Scale score of 15) and stable condition following trauma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are providing cardiopulmonary resuscitation to an unconscious adult patient. Which of the following statements correctly describes effective chest compressions?",
    "choices": [
      {
        "id": 1,
        "text": "Full chest recoil is avoided between 2 compressions"
      },
      {
        "id": 2,
        "text": "The chest is pressed to a depth of 4 inches"
      },
      {
        "id": 3,
        "text": "Given at lower half of the sternum"
      },
      {
        "id": 4,
        "text": "Rate of chest compressions is 50-80/min"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Effective chest compressions</strong> in BLS are given on the <strong>lower half </strong>of the patient's <strong>sternum\u00a0</strong>at a rate of\u00a0<strong>100-120 compressions per minute</strong> (30 compressions for every 15-18 sec).</p>\n<p>Adequate chest compressions create blood flow by increasing the intrathoracic pressure and directly compressing the heart.</p>\n<p>2015 AHA guidelines for <strong>cardiopulmonary resuscitation (CPR)</strong> recommend a chest compression of 100-120/min, a <strong>depth</strong> for adults of at least <strong>2 inches</strong>.\u00a0</p>\n<p>Components of high-quality CPR include compressing the chest at an adequate rate and depth. Allowing complete chest recoil after each compression. Minimizing interruptions in compressions and should avoid excessive ventilation.</p>\n<p>Effective chest compression in <strong>adults</strong>:</p>\n<ul>\n<li>Provide<strong>\u00a015 chest compressions </strong>at a rate of<strong> 100-120 per minute.</strong></li>\n<li>Place your arms, one over the other in the midline, on the <strong>lower half</strong> of the patient's sternum, and lock your arms.</li>\n<li>Use both arms to press the chest to a depth of<strong> 5- 6cm</strong></li>\n<li><strong>Allow</strong> for <strong>full chest recoil</strong> after every compression.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "As per ACLS, CPR can be considered to be of high quality when ETCO2 is _____.",
    "choices": [
      {
        "id": 1,
        "text": "5-10 mmHg"
      },
      {
        "id": 2,
        "text": "At least 10-20 mmHg"
      },
      {
        "id": 3,
        "text": "25-35 mm Hg"
      },
      {
        "id": 4,
        "text": "At least 35-45 mm Hg"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>As per ACLS, CPR can be considered to be of\u00a0<strong>high quality</strong> when <strong>ETCO<sub>2</sub> is\u00a0at least 10-20 mmHg</strong>.</p>\n<p>Failure to maintain ETCO<sub>2</sub> at &gt;10 mm\u2009Hg during adult CPR is a reflection of poor cardiac output and it is found to strongly predicts unsuccessful resuscitation.</p>\n<p>Monitoring ETCO<sub>2</sub> during CPR can be used to assess blood flow in 2 ways:</p>\n<ul>\n<li>To improve chest compression performance if ETCO<sub>2</sub> is &lt;10 mm\u2009Hg during CPR</li>\n<li>To consider an abrupt sustained increase to a normal value (35 to 40 mm\u2009Hg) as an indicator of ROSC</li>\n</ul>\n<p><strong>High-quality cardiopulmonary resuscitation (CPR):</strong></p>\n<ul>\n<li>Push hard (at least 5 cm) and fast (100\u2013120/min) and allow complete chest recoil.</li>\n<li>Minimize interruptions in compressions (10 seconds or less).</li>\n<li>Avoid excessive ventilation.</li>\n<li>Rotate the compressor every 2 minutes or earlier if fatigued.</li>\n<li>If no advanced airway, 30:2 compression- ventilation ratio.</li>\n<li>Quantitative waveform capnography\u2013 If PetCO<sub>2</sub> &lt;10 mm Hg, attempt to improve CPR quality.</li>\n<li>Intra-arterial pressure: If relaxation phase (diastolic) pressure &lt;20 mm Hg, attempt to improve CPR quality.</li>\n</ul>\n<p>Effective chest compression in\u00a0<strong>adults</strong>:</p>\n<ul>\n<li>Provide\u00a0<strong>100\u2013120 compressions per minute</strong>\u00a0(30 compressions for every 15-18 sec).</li>\n<li>Place your arms, one over the other in the midline, on the lower 1/3rd of the patient's sternum, and lock your arms.</li>\n<li>Use both arms to press the chest to a depth of<strong>\u00a05-6 cm</strong>\u00a0(2\u20132.4 inches)or more.</li>\n<li>Press hard and fast</li>\n<li>Allow for\u00a0<strong>full chest recoil</strong>\u00a0after every compression.</li>\n</ul>\n<p>Effective chest compressions in a<strong>\u00a0child older than 1 year and up to puberty:</strong></p>\n<ul>\n<li>The compression rate is 100\u2013120/min\u00a0 (30 compressions for every 15\u201318 sec).</li>\n<li><strong>One or both palms</strong>\u00a0are placed in the midline.</li>\n<li>Depth of compression is\u00a0<strong>2 inches.</strong></li>\n<li>Press hard and fast</li>\n<li>Allow for full chest recoil after every compression.</li>\n</ul>\n<p>Effective chest compressions in<strong>\u00a0infants (&lt;1 year):</strong></p>\n<ul>\n<li>100 to 120 compressions per minute (30 compressions for every 15\u201318 sec).</li>\n<li><strong>One provider: Place two fingers</strong>, one between the nipple line and the other 1 cm below.</li>\n<li><strong>Two providers:</strong>\u00a0Encircle the infant's torso with both hands with<strong>\u00a0both thumbs</strong>\u00a0pointing cephalic positioned 1 cm below the nipples over the sternum.\u00a0</li>\n<li>Depth of compressions should be\u00a0at least\u00a0<strong>1.5 inches or 1/3 the depth</strong>\u00a0of the infant\u2019s chest.</li>\n<li>Press hard and fast</li>\n<li>Allow for full chest recoil after every compression.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Acls Bls Pals Atls Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>