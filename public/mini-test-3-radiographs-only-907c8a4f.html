<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 3- Radiographs Only - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following studies shown in the image below is performed for peptic ulcers?",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Peptic ulcers</strong> can be visualized using<strong>&nbsp;barium meal study</strong>. This investigation is depicted in&nbsp;<strong>image 2-&nbsp;</strong>showing contrast medium filling the stomach and duodenum.</p>\n<p>Barium meal study is employed in conditions like gastric and peptic ulcers and gastric outlet obstruction.</p>\n<p>Other options:</p>\n<p>Image one shows a normal&nbsp;<strong>barium enema</strong> study. It is used in conditions like acute colitis, colonic fistula, colorectal cancer, ileocaecal tuberculosis, ulcerative colitis and ileocolic intussusception.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aabeda3f6ad24264bb374c25bcce4361.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f04f44424fcd40bf8dd26649f51e9420x387x450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cc424744c68446d933df7548bc7364dx720x1046.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d43eaa7abb194b02bab42b21e14999dex484x698.JPEG"
    ]
  },
  {
    "text": "Which of the following is true regarding the condition shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Bilateral in more than 50% of the cases"
      },
      {
        "id": 2,
        "text": "Associated with dysplastic renal tissue"
      },
      {
        "id": 3,
        "text": "Children usually present with stones"
      },
      {
        "id": 4,
        "text": "Affects males more often than females"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given&nbsp;intravenous urography (IVU) image depicts <strong>cobra head/adder head deformity</strong> which is a classic sign of ureterocele. It is associated with dysplastic renal tissue.</p>\n<p><strong>Ureterocele</strong>:</p>\n<p>A ureterocele is the cystic enlargement of the intramural ureter. It is thought to be caused due to ureteric orifice atresia. It is observed <strong>more in females </strong>than males in a 4:1 preponderance and is&nbsp;<strong>bilateral </strong>in about<strong> 10% </strong>of the cases. They are similar to ectopic ureters wherein the upper pole of the kidney is drained. This condition is typically <strong>associated with dysplastic and</strong> <strong>non-functional renal tissue</strong>.</p>\n<p>Clinical presentation:</p>\n<ul>\n<li><strong>Children</strong> with ureterocele usually present with <strong>infection.</strong></li>\n<li>Adults present with renal stones.</li>\n</ul>\n<p>Diagnosis:</p>\n<ul>\n<li>IVU shows a <strong>classical cobra head sign</strong> but is relatively infrequently performed these days.</li>\n<li>Cystoscopy shows a bulging, translucent swelling involving the ureteric orifice where there is urinary stasis. It is emptied by ureteric peristalsis.</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li>Surgical excision with re-implantation of the ureter is the treatment of choice for simple ureterocele.</li>\n<li>Renal stones associated with ureterocele are removed using an endoscopic incision</li>\n<li>An advanced disease that causes hydronephrosis or pyonephrosis is an indication for nephrectomy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b6ceffbeea1a438dabd3acd01d312c48.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old lady presents with abdominal pain for the past 2 weeks. Examination reveals mild tenderness in the right upper quadrant and icterus. She adopted a stray dog a few months back. CT scan revealed the following image. A skin test and ELISA are performed to confirm the diagnosis. What type of hypersensitivity reaction is the skin test that is performed based on?",
    "choices": [
      {
        "id": 1,
        "text": "Type I"
      },
      {
        "id": 2,
        "text": "Type II"
      },
      {
        "id": 3,
        "text": "Type III"
      },
      {
        "id": 4,
        "text": "Type IV"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette showing <strong>icterus</strong> and <strong>right upper quadrant pain</strong>, a history of recently adopting a street <strong>dog</strong>, and CT showing\u00a0a cyst in the left liver with a typical multivesicular image is highly suggestive of a\u00a0<strong>hydatid cyst.</strong>\u00a0It is confirmed by <strong>Casoni\u2019s intradermal test </strong>which\u00a0is a <strong>type I hypersensitivity </strong>reaction.</p>\n<p><strong>Casoni intradermal test</strong>: It involves the intradermal injection of 0.25 ml of sterilized fluid from hydatid cysts/human cysts on the forearm. An equal volume of saline is injected into the other forearm as a control. It is observed for the next 30 minutes and again after 1-2 days. The fluid used for the test is sterilized by <strong>Seitz</strong> <strong>filtration.\u00a0</strong>A <strong>wheal</strong> response at the injection site occurring within 20 minutes is considered <strong>positive. </strong>It is followed by a secondary reaction 8 hours later.</p>\n<p><strong>Hydatid Cysts</strong>:</p>\n<p><strong>Dogs</strong>\u00a0are the\u00a0<strong>definitive hosts</strong>\u00a0of Echinococcus granulosus.\u00a0<strong>Sheep</strong>\u00a0are the usual\u00a0<strong>intermediate hosts</strong>, but\u00a0<strong>humans are accidental intermediate hosts</strong>. Humans are end-stage hosts of the parasite since there is no human-to-human transmission.</p>\n<p>Primary hydatid cysts most commonly occur in the<strong> liver. </strong>The next\u00a0most common site is the <strong>lung</strong>, specifically the lower lobe of the right lung. Most patients are asymptomatic but when symptomatic, the patient presents with hepatomegaly, pain, and obstructive jaundice.</p>\n<p class=\"ng-binding\"><strong>Investigations:\u00a0</strong></p>\n<p><strong>Computed tomography</strong> (CT) scan is accurate for detecting<strong>\u00a0</strong>hydatid cysts. It shows the presence of a space-occupying lesion with a smooth outline and septae and demonstrates daughter cysts and extra-hepatic cysts. Sometimes, when there is disruption of the inner layers, it can present as/with:</p>\n<ul>\n<li>Air\u2013fluid level with a floating membrane -<strong> water lily sign/ camalote sign</strong>\u00a0</li>\n<li>A double-wall, dry cyst with crumpled membranes lying at its bottom - <strong>Rising sun sign/ Serpent</strong> sign</li>\n<li>When all the contents are removed -\u00a0<strong>empty cyst sign</strong></li>\n</ul>\n<p>Serology: Detection of serum antibodies against 8 and 16 kDa antigens using indirect hemagglutination (IHA),\u00a0indirect immunofluorescence, ELISA, and slide latex agglutination test can be used to support the clinical diagnosis.</p>\n<p><strong>Treatment</strong> :</p>\n<ul>\n<li>Early stages of the disease can be treated with puncture, aspiration, injection, and re-aspiration (PAIR).\u00a0Albendazole 4 days before the procedure, continued till 4 weeks afterward.</li>\n<li>Surgery is the treatment of choice when PAIR is not possible. The preferred surgical approach is pericystectomy. Since recurrence is common, pre and postoperative chemotherapy with albendazole for 2 years is recommended.</li>\n</ul>\n<p>The life cycle of\u00a0E. granulosus is as shown below :</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/730cc4e024b24d3a8fef21f3da4b7847.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea88810ec1ca4dd68a50e993896861f4x512x400.PNG"
    ]
  },
  {
    "text": "A 62-year-old man presents with cough and shortness of breath. He does not complain of fever. There is occasional sputum production on coughing. He has been smoking about one pack of cigarettes per day for the past 35 years. Physical examination shows crepitations in bilateral lung fields. His chest X-Ray is shown below. What is the diagnosis of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Emphysema"
      },
      {
        "id": 2,
        "text": "Acute respiratory distress syndrome"
      },
      {
        "id": 3,
        "text": "Atypical pneumonia"
      },
      {
        "id": 4,
        "text": "Pneumothorax"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette showing a chronic smoker with cough and dyspnea and chest x-ray showing&nbsp;signs of overinflation are suggestive of <strong>severe diffuse emphysema.</strong></p>\n<p><strong>Emphysema</strong>&nbsp;is is a chronic obstructive pulmonary disease that is characterized by irreversible enlargement of the airspaces distal to the terminal bronchiole, accompanied by destruction of their walls.</p>\n<p>Patients with emphysema were often described as&nbsp;<strong>pink</strong>&nbsp;<strong>puffers</strong>, as they are thin, non-cyanotic at rest, and prominently use the accessory muscles of respiration. On examination, the patient is&nbsp;<strong>barrel-chested</strong>&nbsp;and&nbsp;<strong>dyspneic,</strong>&nbsp;with&nbsp;<strong>prolonged expiration.&nbsp;</strong>The patient may sit forward in a <strong>tripod position</strong>.</p>\n<p>Radiological signs of overinflation are the best predictors of the presence and severity of emphysema. They include:</p>\n<ul>\n<li>Height of the right - &gt;29.9 cm,</li>\n<li>Location of the right hemidiaphragm at or below the anterior aspect of the seventh rib</li>\n<li>Flattening of the hemidiaphragm</li>\n<li>Enlargement of the retrosternal space (seen in lateral CXR)</li>\n<li>Widening of the sterno-diaphragmatic angle&nbsp;(seen in lateral CXR)</li>\n<li>Narrowing of the transverse cardiac diameter.</li>\n</ul>\n<p>Other options:</p>\n<p>Option B - Acute respiratory distress syndrome is clinically characterized by&nbsp;dyspnea and tachypnea which is usually followed by increasing respiratory failure, hypoxemia, and cyanosis unless medically intervened. Radiography shows the presence of&nbsp;diffuse bilateral infiltrates which is as shown below.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4749a1bb1a344a39ad0140bd819fe1b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6b3512f65a564d6c93ffdcaafcd545d4x751x600.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9b98530455784c67a7da5458f8cfe50ax1280x1088.JPEG"
    ]
  },
  {
    "text": "You are working as a junior resident in the ENT department when a patient brings the following X-Ray image. Which of the following structures is best visualized in this view?",
    "choices": [
      {
        "id": 1,
        "text": "Sphenoid  sinus"
      },
      {
        "id": 2,
        "text": "Frontal sinus"
      },
      {
        "id": 3,
        "text": "Maxillary sinus"
      },
      {
        "id": 4,
        "text": "Ethmoid sinus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;given image shows a radiographic image captured in the <strong>occipitofrontal view</strong> or <strong>Caldwell view</strong>. This is the best view for visualizing the <strong>frontal sinus</strong>.</p>\n<p>Caldwell's view is taken with the nose and forehead are touching the x-ray film. The X-ray beam is projected caudally at a 15-20 degree angle.</p>\n<p>Structures seen in&nbsp;<strong>Caldwell's view&nbsp;</strong>are:</p>\n<ul>\n<li><strong>Frontal sinuses (seen best)</strong></li>\n<li>Ethmoid sinuses</li>\n<li>Maxillary sinuses</li>\n<li>Frontal process of the zygoma and the zygomatic process of the frontal bone</li>\n<li>Superior margin of orbit and lamina papyracea</li>\n<li>Superior orbital fissure</li>\n<li>Foramen rotundum (inferolateral to superior orbital fissure)</li>\n</ul>\n<p>The image below shows the projection of the x-ray beams in relation to the position of the head.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/56ad43dfdf784251a111fa84f4ffc92b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a41eb4a50ecd4db0950685210d27314cx599x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a36d27ed845347a9ada6cd07e66e1b42x1280x1413.JPEG"
    ]
  },
  {
    "text": "A 7-year-old boy is brought to the casualty following a fall on an outstretched hand. He complains of pain in his left elbow. Examination reveals tenderness and swelling over his left elbow. An X-ray of the patient is given below. Which of the following statements is true with respect to this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Vascular injury commonly involves the brachial artery"
      },
      {
        "id": 2,
        "text": "Ulnar nerve  is most commonly injured in the extension-type"
      },
      {
        "id": 3,
        "text": "Almost all injuries are of the flexion-type"
      },
      {
        "id": 4,
        "text": "Cubitus valgus is the most common angular deformity"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical features and x-ray showing <strong>posterior fat pad sign</strong> are suggestive of <strong>supracondylar fracture</strong> of the humerus where vascular injury commonly involves the <strong>brachial artery</strong>.</p>\n<p><strong>Supracondylar fracture of humerus:</strong></p>\n<p>It is most commonly seen in children of 5-7 years. The extension type is seen in 98% of the cases while the rest are flexion type<strong>. </strong>The&nbsp;mechanism of injury involved is usually a fall on an outstretched hand with an elbow in full extension.&nbsp;<span class=\"s1\"><strong>Gartland classification</strong></span><span class=\"s1\">&nbsp;is used for the classification of supracondylar fractures and is of four types.</span></p>\n<p class=\"p1\">On examination:</p>\n<p>There may be an <strong>S-shaped</strong> deformity at the elbow. If the proximal fracture fragment is sharp and has penetrated the muscles and fascia, a dimple may be seen on the skin above the elbow (<strong>dimple sign</strong>).&nbsp;<strong>The three-point bony relationship is maintained</strong>&nbsp;in supracondylar fracture.</p>\n<p><strong>Radiology</strong>:&nbsp;&nbsp;</p>\n<ul>\n<li>An undisplaced&nbsp;fracture may show a <strong>triangular lucency&nbsp;</strong>like a sail of a yacht (<strong>sail sign</strong>), also called a&nbsp;<strong>fat pad sign</strong>. This is due to the fat pad around the elbow being pushed forward by hematoma.</li>\n<li><strong>Baumann&rsquo;s angle</strong>&nbsp;is the angle between the horizontal line of the elbow and the line drawn through the lateral epiphysis and long axis of the arm. It is normally less than 5 degrees and is checked with the other arm.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1f947e6b519f4ef6920928702b122a1b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0ef55603fcc47658d8b36539c16f865x1279x1357.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5392ce5d61824b2eb633d565a3165a69x1280x1602.JPEG"
    ]
  },
  {
    "text": "Which of the following is false about the condition shown in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Malunion can happen if this condition is not treated"
      },
      {
        "id": 2,
        "text": "The patient may be able to walk"
      },
      {
        "id": 3,
        "text": "Avascular necrosis is the most common complication"
      },
      {
        "id": 4,
        "text": "Shortening of limb is less than 1 inch"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The radiograph shows a&nbsp;<strong>fracture neck</strong> of the <strong>femur.&nbsp;Non-union</strong> is a complication of this fracture, not malunion.&nbsp;</p>\n<p><strong>Malunion</strong> is a complication of <strong>inter-trochanteric</strong> fractures.</p>\n<p><strong>Complications</strong> of fracture neck of the femur are:</p>\n<ul>\n<li>Avascular necrosis (most common)</li>\n<li>Non-union</li>\n<li>Osteonecrosis of the femoral head may lead to <strong>secondary osteoarthritis</strong> after many years</li>\n</ul>\n<p>Option B: In impacted fracture neck of femur, the patient may be able to walk.</p>\n<p>Option D: Shortening of the limb is less than 1 inch in fracture neck of femur.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3298c7ad3959403896098e117dcd4eea.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presenting with halitosis and regurgitation, underwent a barium swallow scan as shown below. Weakness located in which of the following muscles predisposes to the suspected condition\u200b?",
    "choices": [
      {
        "id": 1,
        "text": "Superior constrictor"
      },
      {
        "id": 2,
        "text": "Middle constrictor"
      },
      {
        "id": 3,
        "text": "Inferior constrictor"
      },
      {
        "id": 4,
        "text": "Palatopharyngeus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This clinical scenario of a patient with halitosis and regurgitation with the GIF of an X-ray showing the barium swallow filling a sac in the posterior pharyngeal wall is highly suggestive of<strong>\u00a0Zenker's diverticulum.</strong>\u00a0It protrudes through the <strong>Killian's dehiscence,</strong> a potential space present in the <strong>inferior constrictor muscle</strong>.</p>\n<p>The inferior constrictor muscle is made up of 2 parts: The upper<strong> thyropharyngeus</strong>\u00a0and the lower<strong> cricopharyngeus</strong>. The cricopharyngeus muscle is divisible into the superficial oblique component (<strong>pars oblique</strong>) and the deeper transverse component (<strong>pars fundiformis</strong>). These 2 components of the muscle have a potential space between them termed\u00a0<strong>Killian's dehiscence.\u00a0</strong>\u00a0</p>\n<p>As a result of the uncoordinated contraction between the cricopharyngeus and upper oesophagal sphincter, mucosal herniation through the Killian's dehiscence gives rise to\u00a0<strong>Zenker's diverticulum.\u00a0</strong>This diverticulum is a common site for food impaction and accumulation (halitosis, regurgitation) and may cause dysphagia in affected patients.\u00a0</p>\n<p><strong>Note -\u00a0</strong>Another potential site of diverticulum formation is the\u00a0<strong>Laimer's triangle,\u00a0</strong>situated below the cricopharyngeus and above the longitudinal fibres of the oesophagus.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b9cf638c4a944060a13ae9e9f1a941c8.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "An infant delivered at full-term by normal vaginal delivery, presented with respiratory distress immediately after birth. Chest X-ray showed the following picture. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hyaline membrane disease"
      },
      {
        "id": 2,
        "text": "Meconium aspiration syndrome"
      },
      {
        "id": 3,
        "text": "Congenital diaphragmatic hernia"
      },
      {
        "id": 4,
        "text": "Transient tachypnea of the newborn"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above X-ray chest shows <strong>intra-thoracic bowel shadows</strong> along with <strong>mediastinal shift</strong> suggestive of <strong>congenital diaphragmatic hernia</strong>.</p>\n<p>The common clinical presentation is as follows:</p>\n<ul>\n<li>Respiratory distress</li>\n<li>Dextrocardia</li>\n<li>Scaphoid abdomen</li>\n</ul>\n<p>Prenatal diagnosis is done by <strong>ultrasonography</strong>.&nbsp;<strong>Lung-to-head ratio</strong> (LHR) is used to assess severity in patients with left-sided CDH. An LHR value of <strong>&lt;1</strong>&nbsp;is associated with a very <strong>poor</strong> prognosis, whereas an LHR <strong>&gt;1.4</strong> predicts a more <strong>favourable</strong> outcome.</p>\n<p>Option A: <strong>Hyaline membrane disease</strong> is a syndrome in premature infants caused by developmental <strong>insufficiency</strong> of pulmonary <strong>surfactant</strong> production and structural immaturity in the lungs.</p>\n<p>Option B: <strong>Meconium aspiration syndrome</strong>&nbsp;is the aspiration of meconium-stained amniotic fluid, which can occur before, during or immediately after birth. Meconium is the first intestinal discharge from newborns, a viscous, dark-green substance composed of intestinal epithelial cells, lanugo, mucus, and intestinal secretions.</p>\n<p>Option D: During normal delivery, the compression of the rib cage while passing through the mother's vaginal canal helps to remove fluid from the lungs. However, newborns who are delivered via <strong>cesarean</strong> birth may have excess fluid in the lungs and therefore be <strong>hypoxic</strong> and develop <strong>transient tachypnea.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3cd9848c0e5442c590398c7914a49441.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You are asked to opine on the age of an adolescent boy allegedly involved in a crime. He claims to be a juvenile and pleads for a trial in the juvenile court. Based on the X-ray shown below, the likely age of the boy is:",
    "choices": [
      {
        "id": 1,
        "text": ">18 years"
      },
      {
        "id": 2,
        "text": "<17 years"
      },
      {
        "id": 3,
        "text": ">19 years"
      },
      {
        "id": 4,
        "text": "<10 years"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given X-ray shows the <strong>appearance </strong>of <strong>pisiform </strong>but<strong> no fusion</strong> of<strong> base </strong>of<strong> 1st metacarpal. </strong>Therefore, the age is<strong> more </strong>than<strong> 10 years</strong> and <strong>less</strong> than<strong> 17 years</strong>. Among the given options, the age of the boy is likely to be <strong>&lt;17 years</strong>.</p>\n<p>The <strong>base</strong> of <strong>all</strong>\u00a0<strong>metacarpals</strong> appears at 2-3 years of age and fuses at 15 -17 years of age. Since it is not fused in this case, the age is less than 17 years. If it has fused the likely age is more than 15 years.</p>\n<p><strong>Pisiform</strong> <strong>ossification</strong> center appears at <strong>10-12 years</strong> of age (options C and D). Since it is <strong>present</strong> in this case, the age of the child is<strong>\u00a0more than 10 years.\u00a0</strong>If it had not appeared, the likely age is &lt;12 years</p>\n<p style=\"text-align: left;\">The <strong>lower end</strong> of the <strong>radius</strong> appears at <strong>2 </strong>years of age and <strong>fuses</strong> at <strong>18-19</strong> years of age. The <strong>lower end</strong> of the <strong>ulna</strong> appears at <strong>5-6</strong> years of age and <strong>fuses</strong> at <strong>17-18</strong> years of age. Here, both remain unfused indicating further that the age is likely to be less than 18.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4b7350cbccf947868802bac6026e142f.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old patient was brought to the emergency department with complaints of severe headache, vomiting, and progressive weakness of the right upper and lower limb weakness. A CT image of the patient is shown. Which of the following drugs is best suited to reduce morbidity in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Nifedipine"
      },
      {
        "id": 2,
        "text": "Amlodipine"
      },
      {
        "id": 3,
        "text": "Nicardipine"
      },
      {
        "id": 4,
        "text": "Nimodipine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p style=\"text-align: justify;\">The given clinical scenario with the patient presenting with&nbsp;complaints of headache, vomiting, and paralysis and the CT image showing blood in the cistern is suggestive of&nbsp;<strong>subarachnoid haemorrhage (SAH)</strong> where&nbsp;<strong>nimodipine</strong>&nbsp;is best suited to reduce morbidity.</p>\n<p style=\"text-align: justify;\"><strong>Subarachnoid hemorrhage&nbsp;</strong>is the hemorrhage in the subarachnoid space between the arachnoid and pia mater, mixed with CSF.</p>\n<p style=\"text-align: justify;\">After head trauma, it is mostly caused as a result of the rupture of a saccular aneurysm. Other causes include&nbsp;bleeding from a vascular malformation such as arteriovenous malformation or dural arteriovenous fistula and an&nbsp;intracerebral hemorrhage extending into the subarachnoid space.</p>\n<p style=\"text-align: justify;\">Some SAHs may be limited to the&nbsp;perimesencephalic cisterns and is arterial in origin but there could be a venous or capillary source. Manifesting features are due to raised intracranial pressure.</p>\n<p style=\"text-align: justify;\"><strong>Nimodipine</strong> is indicated to<strong> relieve a neurological deficit</strong> occurring <strong>secondary to cerebral vasospasm</strong> following subarachnoid haemorrhage. It is a member of the dihydropyridine group of calcium channel blockers and causes vasodilation in cerebral blood vessels. It is lipid-soluble and has a high affinity for cerebral blood vessels and appears to reduce morbidity after subarachnoid haemorrhage.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6a624753b04b44ab83183ad574cd7717.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The plain x-ray shows a particular change in ribs. This is seen in which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Coarctation of aorta"
      },
      {
        "id": 2,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 3,
        "text": "Osteogenesis imperfecta"
      },
      {
        "id": 4,
        "text": "Rheumatoid arthritis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The x-ray depicts the&nbsp;<strong>inferior rib notching,&nbsp;</strong>which is a finding associated with&nbsp;<strong>coarctation of the aorta.</strong></p>\n<p>Coarctation of the aorta is the&nbsp;narrowing/constriction of the aorta most commonly occurring at origin of ductus arteriosis. It can also be seen preductal or post ductal and is associated with Turner syndrome.</p>\n<div class=\"page\" title=\"Page 4163\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Preductal </strong>or<strong> infantile</strong> type has severe coarctation&nbsp;become symptomatic as soon as the duct begins to close. Differential cyanosis and <strong>radial-femoral delay</strong> are classic signs.</p>\n</div>\n</div>\n</div>\n<p><strong>Adult</strong> or <strong>juxta ducta</strong>l is usually mild and goes unnoticed until adolescence. They present as weakness, pain or<strong> claudication</strong> in legs after exercise,&nbsp;hypertension in the upper extremities with&nbsp;weak pulses and hypotension in the lower extremities.</p>\n<div class=\"page\" title=\"Page 4164\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Roesler sign-Notching</strong> of the <strong>inferior margin</strong> of the ribs(4th-8th) from pressure erosion by enlarged <strong>collateral</strong> vessels is common by late childhood.&nbsp;</p>\n<p><strong>A figure of 3 sign </strong>(Reverse 3) is a contour abnormality of the aorta as shown below.</p>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3230e684758d432b980dff92cd9f001e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c30e24d3fd5147cfb198f30738c006e4x1024x1024.JPEG"
    ]
  },
  {
    "text": "A 24-year-old woman visits the infertility clinic. She gives a history of 3 spontaneous first-trimester abortions. Routine investigations were done along with hysterosalpingography and MR imaging of the uterus which revealed the following images. What is the diagnosis of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Bicorporeal uterus"
      },
      {
        "id": 2,
        "text": "Dysmorphic uterus"
      },
      {
        "id": 3,
        "text": "Hemi-uterus"
      },
      {
        "id": 4,
        "text": "Septate uterus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette showing recurrent first-trimester pregnancy losses and hysterosalpingography and MRI images are suggestive of<strong>\u00a0</strong>a <strong>septate uterus.</strong></p>\n<p>A <strong>septate uterus </strong>is one where the uterus has a normal outline with the presence of an internal indentation at the fundal midline exceeding 50% of the uterine wall thickness.\u00a0</p>\n<p>Obstetric outcomes in Septate uterus:</p>\n<ul>\n<li>Spontaneous abortion</li>\n<li>Preterm delivery</li>\n<li><strong>Repeated pregnancy loss</strong></li>\n<li>Intrauterine growth restriction</li>\n<li>Abnormal presentations</li>\n</ul>\n<p>Imaging modalities used for diagnosis:</p>\n<p><strong>Combined hysteroscopy</strong> and <strong>laparoscopy</strong> help to differentiate between a bicornuate uterus and a septate uterus. A septate uterus can be identified with the presence of a uterine fundus.</p>\n<p>Hysterosalpingography (HSG) cannot reliably differentiate between a septate and a bicornuate/arcuate uterus. If the <strong>angle of divergence</strong> between the two uterine cavities is <strong>&lt;75\u00b0</strong>, the defect will most likely be a <strong>septate uterus</strong>. If the divergence angle is<strong> &gt;75\u00b0 but &lt;105\u00b0</strong> a diagnosis cannot be made.</p>\n<p>Magnetic resonance imaging (MRI) is an accurate and noninvasive investigation to make a diagnosis of a septate uterus. If the septum extends to &gt;30% of the septal cavity, surgical resection is indicated.</p>\n<p><strong>Transcervical hysteroscopic resection </strong>of the<strong> septum</strong>\u00a0has the best obstetric outcome. The procedure involves the resection of the septum under <strong>hysteroscopic</strong> guidance. Hence, it doesn't scar the uterus and avoids the necessity of cesarean sections for future pregnancies.</p>\n<p>Other options:\u00a0</p>\n<p>Option A:\u00a0<strong>Bicorporeal uterus</strong> is a uterus where the <strong>outline</strong> of the<strong> fundus </strong>is <strong>abnormal</strong>. An indentation that exceeds 50% of the wall thickness of the uterus at the fundal midline is indicative of a bicorporeal uterus.</p>\n<p>Option B:\u00a0<strong>Dysmorphic uterus</strong> is one where the fundal outline of the uterus is preserved but the presence of an abnormal uterine cavity excluding a septum.</p>\n<p>Option C: A <strong>Hemi-uterus</strong> is one that is unilaterally formed due to development on only one side. The other side of the uterus is either incomplete or absent. The uterus that is present is fully functional.\u00a0</p>\n<p>The following image shows the anomalies mentioned with a diagrammatic representation:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/29af26f3676d4252950e726f10b1a2a2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04a4f91e25894da5b06d55b9c0c2f3bax1280x2027.JPEG"
    ]
  },
  {
    "text": "Match the following USG images with the conditions they are seen in.",
    "choices": [
      {
        "id": 1,
        "text": "1-B, 2-D, 3-A, 4-C"
      },
      {
        "id": 2,
        "text": "1-B, 2-A, 3-D, 4-C"
      },
      {
        "id": 3,
        "text": "1-C, 2-D, 3-A, 4-B"
      },
      {
        "id": 4,
        "text": "1-C, 2-A, 3-D, 4-B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The option matching the USG images with the associated condition is <strong>1-C, 2-D, 3-A, 4-B.</strong></p>\n<p>Image 1 shows the <strong>lambda</strong>\u00a0<strong>sign</strong>\u00a0(also known as the<strong> twin peak sign</strong>) in ultrasonography, seen in <strong>dichorionic diamniotic gestation</strong>. Its presence is highly suggestive of\u00a0<strong>dichorionicity</strong>.</p>\n<p><span class=\"s1\">Chorionicity of the placenta\u00a0</span>is best diagnosed by ultrasound at <strong>10\u201313 weeks</strong> of gestation.\u00a0In dichorionic twins, there is a\u00a0<span class=\"s1\">thick triangular projection of placental tissue\u00a0</span>between the two gestational sacs. This is known as the\u00a0<span class=\"s1\">lambda sign or twin peak\u00a0</span>sign.</p>\n<p>The image given below shows the lambda/twin peak.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/53b4279741c64b97a30d3d2c7f8fa101.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e59332ada6ae4c1b95b92dd8dd314769x1000x864.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a757deb253044f7b12a2bfc97774cd8x210x188.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04a773ab44974e5f8171e83603715227x1280x1623.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7bda395e23064cc89fecafb858a3649cx800x600.PNG"
    ]
  },
  {
    "text": "A 7-year-old boy presents with dyspnea on exertion and bluish discoloration of lips, which is relieved on squatting. A chest x-ray is taken and is shown below. Which of the following is the primary defect responsible for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anterior deviation of the infundibular septum"
      },
      {
        "id": 2,
        "text": "Pulmonary venous connection to the SVC"
      },
      {
        "id": 3,
        "text": "Downward displacement of tricuspid valve"
      },
      {
        "id": 4,
        "text": "Ostium secundum defect in the fossa ovalis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical vignette showing <strong>cyanotic spells</strong> and chest x-ray showing a <strong>boot-shaped</strong> cardiac silhouette are suggestive of the<strong> Tetralogy of Fallot</strong>. The primary defect is an <strong>anterior deviation of the infundibular septum</strong> (the muscular septum that separates the aortic and pulmonary outflows).</p>\n<p><strong>Tetralogy of Fallot (TOF)</strong>&nbsp;is a&nbsp;cyanotic congenital heart condition&nbsp;and has been classically characterized by the following&nbsp;components:</p>\n<ul>\n<li>Obstruction to right ventricular outflow (<strong>pulmonary stenosis</strong>)</li>\n<li>Malalignment type of ventricular septal defect (<strong>VSD</strong>)</li>\n<li>Dextroposition of the aorta so that it overrides the ventricular septum (<strong>overriding of the aorta</strong>), and</li>\n<li>Right ventricular hypertrophy (<strong>RVH</strong>)</li>\n</ul>\n<p><strong>Paroxysmal hypercyanotic attacks</strong> (hypoxic, &ldquo;blue,&rdquo; or &ldquo;tet&rdquo; spells) are a problem during the 1st year of life and&nbsp;may last from a few minutes to a few hours. The child can have&nbsp;shortness of breath and bluish discoloration of lips which is relieved on squatting. Short episodes are followed by generalized weakness and sleep. Severe spells may progress to unconsciousness and occasionally to convulsions or hemiparesis.</p>\n<p>Older children with tetralogy of Fallot characteristically<strong> increase pulmonary blood flow</strong> by <strong>squatting</strong>.&nbsp;Squatting&nbsp;is a compensatory mechanism, it increases&nbsp;<strong>peripheral vascular resistance (PVR)</strong>&nbsp;and thus decreases the magnitude of the right-to-left shunt across the&nbsp;<strong>ventricular septal defect (VSD)</strong>.</p>\n<p>Chest X-ray describes \"<strong>Coeur en sabot</strong>\" or&nbsp;<strong>boot-shaped heart</strong>, which is seen in the&nbsp;tetralogy of Fallot (TOF).</p>\n<ul>\n<li>\"Coeur en sabot\" is due to cardiac apex elevation as a result of&nbsp;<strong>right ventricular hypertrophy.&nbsp;</strong>The cardiac silhouette has been likened to that of a boot.</li>\n<li>The hilar areas and lung fields are relatively clear because of&nbsp;<strong>diminished pulmonary blood flow</strong>&nbsp;or the small size of the pulmonary arteries.</li>\n<li>The aorta is usually large.</li>\n</ul>\n<p>Other options:</p>\n<p>Option B - A <strong>pulmonary venous connection to the superior vena cava (SVC)</strong> is seen in <strong>total anomalous&nbsp;pulmonary venous return</strong> (TAPVR). It is a cyanotic congenital heart defect in which the pulmonary veins drain directly into the right atrium, coronary sinus, SVC, IVC, or ductus venosus.</p>\n<p>On chest x-ray, supracardiac TAPVR presents with the <strong>snowman appearance of the heart&nbsp;</strong>which is as shown below</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dbd50778463e4fd3b998c78dd00b373b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ce23f3a34ed842c08b637cf171dfe1d8x720x893.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a62677468177448caa2014bbfdf39028x625x549.PNG"
    ]
  },
  {
    "text": "A patient with a severe, treatment-resistant neuropsychiatric condition is referred to the neurosurgery OPD. The surgeon proposes a burr-hole procedure where the given sites are destroyed via thermocoagulation. Which of the following conditions is the patient likely to be suffering from?",
    "choices": [
      {
        "id": 1,
        "text": "Obsessive-compulsive disorder"
      },
      {
        "id": 2,
        "text": "Mania"
      },
      {
        "id": 3,
        "text": "Alzheimer's dementia"
      },
      {
        "id": 4,
        "text": "Antisocial personality disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image is that of<strong>&nbsp;anterior cingulotomy</strong> (ACING), which is a neurosurgical treatment for&nbsp;<strong>obsessive-compulsive disorder</strong>.&nbsp;Anterior cingulotomy involves creating&nbsp;bilateral lesions in the anterior cingulate cortex<strong>&nbsp;</strong>under stereotactic guidance.&nbsp;</p>\n<p><strong>Subcaudate tractotomy</strong> (capsulotomy) can also be used in the management of treatment-unresponsive OCD.</p>\n<p><strong>Prefrontal lobotomy</strong> was introduced by <strong>Egas Moniz</strong> as a method of psychosurgery for treatment-resistant mental disorders, particularly <strong>major depressive disorder </strong>and<strong> OCD.</strong></p>\n<p>Other indications for psychosurgery include:</p>\n<ul>\n<li>Chronic and <strong>incapacitating</strong>&nbsp;<strong>schizophrenia</strong> with <strong>severe depression</strong>&nbsp;not responding to all modes of treatment.</li>\n<li>Chronic and <strong>incapacitating</strong>&nbsp;<strong>anxiety disorder</strong>&nbsp;not responding to all modes of treatment.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aa238c6f54564eb89070cdc1975b62ab.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The given CT finding is associated with which of the following genodermal disorders?",
    "choices": [
      {
        "id": 1,
        "text": "Von- Hippel- Lindau syndrome"
      },
      {
        "id": 2,
        "text": "Sturge Weber syndrome"
      },
      {
        "id": 3,
        "text": "Tuberous sclerosis"
      },
      {
        "id": 4,
        "text": "Ataxia telangiectasia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The CT brain shows <strong>t</strong><strong>ram-track cortical calcifications,&nbsp;</strong>a characteristic feature of<strong> Sturge-Weber syndrome</strong>.</p>\n<p>It occurs due to<strong> leptomeningeal</strong> <strong>hemangioma,&nbsp;</strong>resulting in a <strong>vascular</strong> <strong>steal</strong>&nbsp;affecting the subjacent cortex and white matter producing localized ischemia and calcification.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/be9b2940237c423b8607eb8f47991247.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with chronic gout now presented to the emergency room after sustaining trauma to his left foot. Identify the abnormality in his X-ray given below.",
    "choices": [
      {
        "id": 1,
        "text": "Podagra"
      },
      {
        "id": 2,
        "text": "Martel's sign"
      },
      {
        "id": 3,
        "text": "Chopart's fracture"
      },
      {
        "id": 4,
        "text": "March fracture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given X-ray of a patient with <strong>chronic</strong> <strong>gout</strong> shows <strong>Martel's sign.</strong></p>\n<p>Martel's sign also known as the <strong>G</strong> <strong>sign, </strong>or<strong> rat-bite erosion,</strong>&nbsp;refers to<strong>&nbsp;</strong>the punched-out lytic lesion and overhanging margin of the new bone along the edge of erosion seen in chronic tophaceous gout.</p>\n<p>Option A: Podagra is the inflammation of the base of the great toe (metatarsophalangeal joint) during flares of gout. It is not a radiological sign.</p>\n<p>Option C: Chopart's fracture is a fracture between&nbsp;talonavicular and calcaneocuboid joints.</p>\n<p>Option D: March fracture is fracture neck of 2<sup>nd</sup>&nbsp;or 3<sup>rd</sup>&nbsp;metatarsal.</p>\n<p>X-ray showing Martel's sign:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/562c763a24f3463094b486cfa12a6fbf.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11c19f642a9a4ba69095241f3e137221x592x749.JPEG"
    ]
  },
  {
    "text": "A 26-year-old male patient presented with pain in the right knee region for the past three months. On examination, the right knee region is swollen and there is a reduced range of motion. An x-ray taken for further evaluation reveals the following. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Aneurysmal bone cyst"
      },
      {
        "id": 2,
        "text": "Osteochondroma"
      },
      {
        "id": 3,
        "text": "Osteoclastoma"
      },
      {
        "id": 4,
        "text": "Osteosarcoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario along with the x-ray showing an expansile, eccentric, sub-articular<strong> soap bubble appearance </strong>is&nbsp;suggestive of<strong> Giant cell tumor</strong>&nbsp;(GCT) or&nbsp;<strong>Osteoclastoma</strong>.</p>\n<p>Osteoclastoma usually affects young adults of age <strong>20 to 40 years</strong> with slight female predominance. It is seen exclusively in adults and affects the <strong>epiphysis</strong> of long bones,&nbsp;commonly in the <strong>distal end</strong> of the&nbsp;<strong>femur&nbsp;</strong>followed by the<strong> proximal tibia</strong>.&nbsp;Common presenting complaints are <strong>swelling</strong> and vague<strong> pain</strong>. Sometimes, the patient presents for the first time with a <strong>pathological fracture</strong> through the lesion.</p>\n<ul>\n<li><strong>Important x-ray features of a GCT</strong>\n<ul>\n<li>A <strong>solitary</strong>, possibly loculated, lytic lesion in the&nbsp;<strong>epiphysis.</strong></li>\n<li><strong>Eccentric</strong> location, most often subchondral.</li>\n<li>Expansion of the overlying cortex.</li>\n<li><strong>Soap bubble appearance - </strong>The tumor is homogeneously lytic with <strong>trabeculae </strong>of the<strong> remnants of bone</strong> traversing it, giving it a <strong>loculated appearance </strong>called soap bubble appearance.</li>\n<li>No calcification within the tumor.</li>\n<li>No or minimal reactive sclerosis around the tumor.</li>\n</ul>\n</li>\n</ul>\n<p>Histologically, GCTs consist&nbsp;of undifferentiated spindle cells profusely interspersed with <strong>multi-nucleated giant cells</strong>. The tumor stroma is well-vascularized with bands of cellular or collagenous fibrous tissue. The image below shows the histopathology of osteoclastoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/baf1f551d317466c80518404f1177b74.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2707a711e0184f4cb355bb20f3a26442x1280x1184.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df36ff24abd54fee8a8062ac8f0f0c1dx720x720.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/81203bf6d18b48b4ad333bac68159e38x720x1299.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3fe78f78b60407f9a80a5810769a6aex720x765.JPEG"
    ]
  },
  {
    "text": "A 40-year-old HIV patient presents with a productive cough with blood-stained sputum, evening rise of temperature, and weight loss for 3 weeks. His chest x-ray image is shown below.  What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Aspergilloma"
      },
      {
        "id": 2,
        "text": "Pulmonary tuberculosis"
      },
      {
        "id": 3,
        "text": "Loculated pleural effusion"
      },
      {
        "id": 4,
        "text": "Pneumocystis jirovecii pneumonia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario of an evening rise of temperature and productive cough for more than 2 weeks in an HIV patient and a chest x-ray image showing<strong> bilateral pulmonary infiltrates</strong>\u00a0and <strong>cavity\u00a0in the left apical region </strong>is highly<strong>\u00a0</strong>suggestive of <strong>reactivation</strong>\u00a0<strong>pulmonary tuberculosis (TB)</strong>.</p>\n<p>Pulmonary TB is caused by <em>Mycobacterium tuberculosis</em>.</p>\n<p>Pulmonary TB due to\u00a0exogenous (new infection) or\u00a0endogenous (reactivation of a dormant primary lesion) infection\u00a0in a sensitized individual is called\u00a0<strong>post-primary or reactivation or secondary or adult-type</strong> TB.</p>\n<p>The apical and posterior segments of the upper lobe and superior segments of the lower lobe are most commonly involved in post-primary TB due to increased ventilation in these segments than in the lower zones.</p>\n<p>Patients often present with fever, productive cough, blood-streaked sputum, night sweats, malaise, loss of appetite, and weight loss.</p>\n<p>Investigations:\u00a0</p>\n<ol>\n<li><strong>Sputum microscopy</strong>:\n<ul>\n<li>Ziehl-Neelsen staining - the presence of acid-fast bacilli</li>\n<li>Auramine fluorescence staining</li>\n</ul>\n</li>\n<li><strong>Sputum culture</strong>:\n<ul>\n<li>Sold media (Lowenstein-Jensen medium) or liquid media (MGIT)</li>\n</ul>\n</li>\n<li>Catridge-based nucleic acid amplification test (<strong>CB-NAAT</strong>) is currently the first-line <strong>preferred diagnostic test</strong>.</li>\n<li>Radiograph imaging - Chest x-ray and CT chest\u00a0</li>\n</ol>\n<p>Radiological findings include ill-defined opacification in the upper lobes, consolidation, collapse, and cavitation.</p>\n<ol>\n<li>Typically, the disease is parenchymal without nodal enlargement.</li>\n<li><strong>Cavitation</strong> is a distinguishing feature of post-primary TB;\n<ul>\n<li>Typical cavities are thick-walled and irregular.</li>\n<li>Air-fluid levels are uncommon in TB. The presence of air-fluid levels indicates superadded infections.</li>\n</ul>\n</li>\n<li>Upper-lobe involvement with cavitation and the absence of lymphadenopathy distinguishes post-primary TB from primary TB.</li>\n</ol>\n<p>Complications of pulmonary TB:</p>\n<ul>\n<li>Massive hemoptysis</li>\n<li>Cor pulmonale</li>\n<li>Fibrosis/emphysema</li>\n<li>Pleural effusion</li>\n<li>Lung/pleural calcification\u00a0</li>\n<li>Aspergilloma/chronic\u00a0aspergillosis</li>\n<li>Obstructive airways disease</li>\n<li>Bronchiectasis</li>\n<li>Bronchopleural fistula</li>\n</ul>\n<p>The image below shows chest x-ray findings of a post-primary TB with a cavity (black arrows) in the right upper lobe and bilateral pulmonary infiltrates (white triangles) in the apical regions.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bc175d0de68f425d9efb0846a5fc9086.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9a06ff8efb6249c4911fe53cc3a8f21dx590x542.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7665296352934fbf94cbfffd3966c057x704x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3842f833af034fe7a60cd266d7f20d3bx400x400.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0951e1c59bec49228fde30917f0667c3x463x552.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f08745756cb74228883211bcb212c47ax1013x444.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 3- Radiographs Only';
        const quizFilename = 'mini-test-3-radiographs-only-907c8a4f.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>