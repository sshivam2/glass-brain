<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>145 Ent Inicet 2022 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / ENT
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">14</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "CT scan of a patient with laryngeal carcinoma is shown below. What is the staging?",
    "choices": [
      {
        "id": 1,
        "text": "T1N0M0"
      },
      {
        "id": 2,
        "text": "T4N1M0"
      },
      {
        "id": 3,
        "text": "T2N1M0"
      },
      {
        "id": 4,
        "text": "T3N0M0"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Laryngeal cancer is more commonly seen in <strong>men</strong>. <strong>Alcohol</strong>,&nbsp;<strong>tobacco, and previous radiation to the neck region</strong>&nbsp;are some of the risk factors for the development of laryngeal cancer. The most common type is <strong>squamous cell</strong> carcinoma.</p>\n<p>Larynx is divided into three regions - supraglottis, glottis, and subglottis. In the TNM system: T indicates the extent of the tumor, N indicates lymph node involvement, and M indicates distant metastasis.</p>\n<p>TNM classification of laryngeal carcinoma:&nbsp;</p>\n<p>Tumor (T)</p>\n<ul>\n<li class=\"p1\">T1: Only <strong>one site</strong>/subsite is involved (one named structure) with both vocal cords <strong>mobile</strong>.\n<ul>\n<li class=\"p1\">T1a: Only <strong>one vocal cord</strong> involved</li>\n<li class=\"p1\">T1b: Involvement of <strong>both vocal cords</strong></li>\n</ul>\n</li>\n<li class=\"p1\">T2: Spread to adjacent sites/subsites\n<ul>\n<li class=\"p1\">T2a: Both vocal cords are mobile</li>\n<li class=\"p1\">T2b: Slight <strong>impairment</strong> in the mobility of vocal cord</li>\n</ul>\n</li>\n<li class=\"p1\">T3\n<ul>\n<li class=\"p1\"><strong>Fixed</strong> vocal cord</li>\n<li class=\"p1\">Involvement of <strong>pre-epiglottic</strong> space, <strong>para-glottic</strong> space, <strong>post-cricoid</strong> space, or inner cortex of thyroid</li>\n</ul>\n</li>\n<li class=\"p1\">T4a: Local invasion.\n<ul>\n<li class=\"p1\">Anteriorly: Thyroid cartilage, thyroid gland, strap muscles</li>\n<li class=\"p1\">Superiorly: Tongue muscles</li>\n<li class=\"p1\">Inferiorly: Trachea</li>\n<li class=\"p1\">Posteriorly: Esophagus</li>\n</ul>\n</li>\n<li class=\"p1\">T4b: Unresectable\n<ul>\n<li class=\"p1\">Involvement of <strong>prevertebral</strong> space, <strong>carotid</strong> sheath, or <strong>mediastinum</strong></li>\n</ul>\n</li>\n</ul>\n<p>Regional lymph nodes (N)</p>\n<ul>\n<li>Nx: Cannot be assessed</li>\n<li>No: No regional lymph node metastasis</li>\n<li>N1: Metastasis in a single ipsilateral lymph node,&nbsp;&le;3cm</li>\n<li>N2: Metastasis in a single ipsilateral lymph node, &gt;3cm but &lt;6cm or multiple ipsilateral lymph nodes or bilateral lymph nodes none more than 6cm</li>\n<li>N3: Metastasis in a lymph node more than 6cm&nbsp;</li>\n</ul>\n<p>Distant metastasis (M)</p>\n<ul>\n<li>Mx: Metastasis cannot be assessed</li>\n<li>Mo: No distant metastasis</li>\n<li>M1: Distant metastasis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0b91d97549a247f18497c9b620fd3464.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/15c57d1abdba4c40a2ab1dac03f42e51x870x724.PNG"
    ]
  },
  {
    "text": "Arrange the following in the sequence of auditory pathway:",
    "choices": [
      {
        "id": 1,
        "text": "1-2-3-4-5"
      },
      {
        "id": 2,
        "text": "5-4-3-2-1"
      },
      {
        "id": 3,
        "text": "2-1-3-4-5"
      },
      {
        "id": 4,
        "text": "3-4-5-1-2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct sequence of the auditory pathway is <strong>spiral ganglion</strong>&nbsp;(2) -<strong> cochlear nucleus</strong>&nbsp;(1) - <strong>superior olivary nucleus</strong>&nbsp;(3) -<strong> inferior colliculus</strong>&nbsp;(4) - <strong>medial geniculate body&nbsp;</strong>(5).&nbsp;</p>\n<p>The <strong>spiral ganglion</strong> contains <strong>bipolar cells</strong> whose dendrites form the <strong>afferent supply</strong> for inner and outer <strong>hair cells</strong>&nbsp;of the organ of Corti and whose axons form the <strong>cochlear</strong> division of <strong>CN VIII</strong> that <strong>end in</strong> the <strong>cochlear nuclei</strong>.</p>\n<p>The auditory pathway&nbsp;can be remembered with the mnemonic <strong>E.C.O.L.I.M.A</strong></p>\n<div><strong>E</strong>ighth nerve&nbsp;</div>\n<div><strong>C</strong>ochlear nuclei&nbsp;</div>\n<div><strong>O</strong>livary complex&nbsp;</div>\n<div><strong>L</strong>ateral lemniscus&nbsp;</div>\n<div><strong>I</strong>nferior colliculus&nbsp;</div>\n<div><strong>M</strong>edial geniculate body&nbsp;</div>\n<div><strong>A</strong>uditory cortex</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e41df44ff9ef4779a03d5417ecbc3668x1280x1441.JPEG"
    ]
  },
  {
    "text": "What is the grade of tympanic membrane retraction shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Grade 1"
      },
      {
        "id": 2,
        "text": "Grade 2"
      },
      {
        "id": 3,
        "text": "Grade 3"
      },
      {
        "id": 4,
        "text": "Grade 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Tympanic membrane can be divided into two parts.&nbsp;<strong>Pars tensa</strong> makes up most of the tympanic membrane. It is peripherally thickened to form <strong>annulus tympanicus</strong> (a fibrocartilaginous ring). It contains the cone of light. <strong>Pars flaccida</strong> (Shrapnell's membrane), is slightly pinkish and is located above the lateral process of malleus.</p>\n<p>Tympanic membrane retraction can be either in the pars tensa or pars flaccida.&nbsp;</p>\n<p><strong>Tos classification&nbsp;</strong>is<strong>&nbsp;</strong>used to grade the retraction in <strong>pars flaccida</strong> or&nbsp;<strong>attic retraction</strong></p>\n<ul>\n<li>Stage 1:&nbsp;The par flaccida is <strong>dimpled</strong> but not in touch with the malleus.</li>\n<li>Stage 2:&nbsp;The tympanic membrane is in contact with the <strong>neck of malleus</strong> and the <strong>entire extent</strong> of retraction can be visualized.</li>\n<li>Stage 3: The retraction is not visible fully, and there may be <strong>partial erosion</strong> of bony attic wall.&nbsp;</li>\n<li>Stage 4: The retraction is <strong>definite erosion</strong> of the bony attic wall and the full extent of retraction is not visible.</li>\n</ul>\n<p>Due to difficulty in distinguishing the latter two, they are grouped as stage 3/4.</p>\n<p><strong>Sade classification&nbsp;</strong>is used to grade the retraction in <strong>pars tensa</strong></p>\n<ul>\n<li>Stage 1: The tympanic membrane is retracted but not in touch with the incus</li>\n<li>Stage 2: The tympanic membrane is in contact with the<strong> long process of the incus</strong></li>\n<li>Stage 3:&nbsp;<strong>Middle ear atelectasis - </strong>the tympanic membrane is in contact with the <strong>promontory</strong>, but <strong>not adherent</strong>. It can be raised from the promontory with suction</li>\n<li>Stage 4:&nbsp;<strong>Adhesive otitis media - </strong>the tympanic membrane is <strong>adherent</strong> to the promontory</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4de51866aabd496c90210bd06b863c8c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ebe9580414104b278b49a4fa0f56be12x1280x1372.JPEG"
    ]
  },
  {
    "text": "A patient presents with vertigo associated with horizontal nystagmus. The slow component is towards the left. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Posterior canal BPPV"
      },
      {
        "id": 2,
        "text": "Superior canal BPPV"
      },
      {
        "id": 3,
        "text": "Right hypoactive labyrinth"
      },
      {
        "id": 4,
        "text": "Left hypoactive labyrinth"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most likely diagnosis for a patient presenting with <strong>horizontal nystagmus</strong> and <strong>fast</strong> component towards the <strong>right</strong> (slow component towards the left) is <strong>left hypoactive labyrinth</strong>.</p>\n<div class=\"page\" title=\"Page 200\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Nystagmus is an involuntary oscillatory movement of the eyes, which can occur in horizontal, vertical, or torsional directions. The <strong>direction of nystagmus</strong> is determined by the <strong>fast component</strong>.\u00a0</p>\n<p>In horizontal nystagmus, the <strong>direction</strong> of nystagmus (fast phase) is always <strong>away</strong> from the <strong>hypoactive</strong> lesions and <strong>towards</strong> the active or <strong>hyperactive</strong> lesions of the labyrinth.\u00a0Benign paroxysmal positional vertigo (<strong>BPPV)</strong> is a\u00a0<strong>hyperactive</strong> disease while <strong>vestibular neuronitis</strong>\u00a0and<strong> vestibular Schwanomma\u00a0</strong>are\u00a0<strong>hypoactive </strong>diseases.</p>\n<p>The involvement of the <strong>vertical semicircular canals</strong> (superior and posterior) leads to <strong>vertical</strong> or mixed vertical-torsional <strong>nystagmus</strong>, ruling out posterior canal BPPV (Option A) and superior canal BPPV (Option B).</p>\n<p>Alternatively, if the\u00a0<strong data-stringify-type=\"bold\">right hypoactive labyrinth\u00a0</strong>was one of the options, it could be considered as a differential for\u00a0<strong data-stringify-type=\"bold\">horizontal nystagmus</strong>\u00a0with the\u00a0<strong data-stringify-type=\"bold\">slow\u00a0</strong>component towards the\u00a0<strong data-stringify-type=\"bold\">right.</strong></p>\n<p><strong>BPPV</strong> is a condition characterized by recurrent episodes of <strong>transient vertigo </strong>(&lt;1 min)\u00a0triggered by <strong>changes in head position</strong> relative to gravity. It is caused by <strong>dislodged</strong> calcium carbonate crystals (<strong>otoconia</strong>) from the utricular macula into one of the semicircular canals, usually the posterior semicircular canal. A <strong>diagnosis</strong> of BPPV can be made by <strong>Dix-Hallpike</strong> test and the condition is <strong>treated</strong> by repositioning maneuvers for the otoconia such as the <strong>Epley maneuver</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the site of drainage of the marked structure?",
    "choices": [
      {
        "id": 1,
        "text": "Superior meatus"
      },
      {
        "id": 2,
        "text": "Middle meatus"
      },
      {
        "id": 3,
        "text": "Inferior meatus"
      },
      {
        "id": 4,
        "text": "Sphenoethmoidal recess"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The images below show the location of paranasal sinuses:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b3898418eeef469aa390e9a2d019c169.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/91e9cb9cab2042a591edc5fde1a0d411x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d6472e9d082942b49d35354e74bdae44x476x525.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fb7b994317094564829b68d7d0d948c6x435x509.JPEG"
    ]
  },
  {
    "text": "A 6-year-old boy presented with recurrent URTI, poor growth, high-arched palate, and impaired hearing. Tympanogram is given as follows. What would be the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Grommet insertion"
      },
      {
        "id": 2,
        "text": "Adenoidectomy with grommet insertion"
      },
      {
        "id": 3,
        "text": "Myringotomy with grommet insertion"
      },
      {
        "id": 4,
        "text": "Myringotomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;<strong>tuning fork test</strong>&nbsp;reveals a&nbsp;<strong>conductive type of hearing loss</strong>&nbsp;and&nbsp;<strong>audiometry</strong>&nbsp;reveals&nbsp;<strong>hearing loss in the range of 20&ndash;40 dB</strong>. The fluid accumulation in glue ear causes decreased mobility (compliance) of the tympanic membrane leading to a flat or dome-shaped curve or <strong>type B curve</strong> on a&nbsp;<strong>tympanogram</strong>.</p>\n<p>Treatment is mainly aimed at the&nbsp;<strong>removal of fluid</strong>&nbsp;and&nbsp;<strong>preventing recurrence</strong>.&nbsp;</p>\n<ul>\n<li><strong>Medical management</strong>&nbsp;includes&nbsp;decongestants, antihistamines, and antibiotics.</li>\n<li><strong>Surgical management</strong>&nbsp;is done if the condition cannot be controlled with medications. It&nbsp;includes&nbsp;<strong>myringotomy</strong>&nbsp;and&nbsp;aspiration of fluid<strong> with</strong>&nbsp;<strong>grommet insertion</strong>.&nbsp;<strong>Adenoidectomy</strong> and tonsillectomy may be required and are usually <strong>done at the time of myringotomy</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/43f950c937954d77b63785beae531068.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d20f24dd2e5d4b8ba33fb4a9f6dfd002x482x458.JPEG"
    ]
  },
  {
    "text": "A gentleman presents to the OPD with a saddle nose deformity. He gives a past history of cough, on/off fever, and hemoptysis. On examination, septal perforation is present with pale granuloma. His chest x-ray showed multiple cavitary lesions, and the biopsy showed granuloma, multinucleate giant cells, and caseous necrosis. What would be the probable cause?",
    "choices": [
      {
        "id": 1,
        "text": "Wegener's granulomatosis"
      },
      {
        "id": 2,
        "text": "Tuberculosis"
      },
      {
        "id": 3,
        "text": "Syphilis"
      },
      {
        "id": 4,
        "text": "Sarcoidosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A: <strong>Wegener's granulomatosis</strong>&nbsp;is characterized by <span style=\"font-size: 14px;\">vasculitis affecting </span><span style=\"font-size: 14px;\">small to&nbsp;</span><span style=\"font-size: 14px;\">medium-sized vessels. It affects</span><span style=\"font-size: 14px;\">&nbsp;the upper respiratory tract (</span><span style=\"font-size: 14px;\">ear, nose, sinuses, and throat), lower respiratory tract (</span><span style=\"font-size: 14px;\">lung), and kidney&nbsp;</span><span style=\"font-size: 14px;\">and is characterized by <strong>necrotizing granuloma</strong>&nbsp;which is <strong>non-caseating</strong>.<strong>&nbsp;</strong></span></p>\n<p><span style=\"font-size: 14px;\">Option C: Although&nbsp;nose deformity is seen in syphilis,&nbsp;<strong>gummatous </strong>lesions&nbsp;(<strong>caseating </strong>granulomas) are present in <strong>tertiary syphilis</strong> which is not seen in this patient. Fever, cough, and hemoptysis are not features of syphilis.</span></p>\n<p><span style=\"font-size: 14px;\">Option D: <strong>Sarcoidosis</strong> most commonly affects the lungs forming <strong>non-caseating granuloma</strong> with<strong> no central necrosis.&nbsp;</strong>Laminated calcium and protein-containing bodies called&nbsp;<strong>Schaumann bodies</strong> and star-shaped inclusions called&nbsp;<strong>asteroid bodies&nbsp;</strong>are also found in the giant cells of most of these granulomas. Chest x-ray would show <strong>interstitial fibrosis</strong> and<strong> hilar lymphadenopathy.</strong></span></p>\n<p><span style=\"font-size: 14px;\">The image below shows the characteristic non-caseating sarcoid granuloma:</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5bdf406eec534a9387cc27de8e17669fx1280x1137.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e21f5e88cbfc403f82cd77c0a1fcfd8bx669x452.PNG"
    ]
  },
  {
    "text": "Foreign body entry into the laryngeal inlet is prevented by the cough reflex. This reflex is sluggish in alcohol ingestion and some other conditions. Which nerve is likely injured?",
    "choices": [
      {
        "id": 1,
        "text": "Internal laryngeal nerve"
      },
      {
        "id": 2,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 3,
        "text": "External laryngeal nerve"
      },
      {
        "id": 4,
        "text": "Recurrent laryngeal nerve"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">The <strong>internal laryngeal nerve</strong> is the nerve implicated in the <strong>inhibition of the cough reflex</strong> in an alcoholic. Alcohol can cause chemical irritation of the nerve and it is also a potent inhibitor of the central nervous system.</p>\n<p class=\"p1\">The cough reflex is a<strong>&nbsp;</strong>protective mechanism&nbsp;of the larynx to expel irritants and keep the airway clear. Chemical or mechanical irritation of the respiratory mucosa stimulates the <strong>afferent</strong>&nbsp;<strong>internal laryngeal nerve</strong>, which is the branch of the superior laryngeal nerve of the&nbsp;<strong>vagus nerve.</strong></p>\n<p class=\"p1\">Internal laryngeal nerve supplies the <strong>mucosa </strong>of the larynx<strong> above the level of the vocal cords </strong>(supraglottis). Hence, any injury to the internal laryngeal nerve results in <strong>aspiration</strong> and <strong>depressed cough reflex</strong> with <strong>no change in voice</strong>.</p>\n<p class=\"p1\"><strong>Recurrent laryngeal nerve&nbsp;</strong>(Option D) gives sensory supply to the mucosa of the larynx at the level of vocal cords (glottis) and below the level of vocal cords (subglottis) and also motor supply to all the intrinsic muscles of the larynx except <strong>cricothyroid</strong>.</p>\n<p><strong>Unilateral</strong> injury to the recurrent laryngeal nerve (<strong>RLN</strong>) may cause minimal or no change in voice, but it does <strong>not</strong> lead to <strong>aspiration</strong> or <strong>airway</strong> <strong>obstruction</strong>.</p>\n<p><strong>Bilateral</strong> injury to <strong>RLN</strong> can result in <strong>dyspnea</strong> and <strong>stridor</strong> due to the median or paramedian position of the vocal cords, which narrows and obstructs the airway. However, the <strong>voice</strong> remains <strong>unaffected</strong>.</p>\n<p>The <strong>glossopharyngeal</strong> nerve (Option B) provides sensory supply to the oropharynx, posterior third of the tongue, and middle ear cavity. Damage to the glossopharyngeal nerve leads to the <strong>absence of the gag reflex</strong>.</p>\n<p>The <strong>external laryngeal nerve</strong> (Option C) innervates the cricothyroid muscle, which is responsible for adjusting the pitch of sound during speech. Paralysis of the external laryngeal nerve results in the inability to increase the <strong>pitch</strong> of sound.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/01db8c67ccfd4505ae52b2b0312f0ecdx1280x2954.JPEG"
    ]
  },
  {
    "text": "A woman presents with impaired hearing. Her tympanogram findings are given below. Pick the right combination of tuning fork test results that would be seen in this patient.",
    "choices": [
      {
        "id": 1,
        "text": "Left Rinne's test negative, Weber's test lateralized to right ear"
      },
      {
        "id": 2,
        "text": "Left Rinne's test negative, Weber's test lateralized to left ear"
      },
      {
        "id": 3,
        "text": "Left  Rinne's test positive, Weber's test lateralized to right ear"
      },
      {
        "id": 4,
        "text": "Left Rinne's test positive, Weber's test lateralized to left ear"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given tympanogram findings indicate <strong>sensorineural</strong> hearing loss in the <strong>left ear</strong>. Tuning fork tests in this patient would show <strong>left</strong><strong> Rinnie's positive </strong>and<strong> Weber lateralized to the right ear</strong>.</p>\n<p>In left sensorineural hearing loss, Rinne's test will be positive on both left and right ears, and Weber's test will be lateralized to the better ear, which is the right.</p>\n<p>Tuning fork tests are performed commonly with tuning forks of frequencies such as 128, 256, 512, 1024, etc. The tuning fork of <strong>512 Hz</strong> is considered ideal as forks of lower frequencies produce a sense of bone vibration, while those of higher frequencies have a shorter decay time.</p>\n<p><strong>Rinne&rsquo;s test</strong> is done by placing a vibrating tuning fork on the patient&rsquo;s mastoid and when he/she stops hearing, it is brought beside the external auditory meatus (EAC). If he/she still hears the sound, air conduction (AC) is better than bone conduction (BC).</p>\n<p><strong>Weber test </strong>is done by placing a&nbsp;vibrating tuning in the middle of the forehead or the vertex and the patient is asked in which ear the sound is better heard.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1a2f3727e1964190a6a66dd8cf994c4c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3fa3f86cc7e74fc3b274886bd12d3332x1279x1605.JPEG"
    ]
  },
  {
    "text": "A 35-year-old female patient presents with complaints of nasal obstruction and post-nasal drip. There is a past history of FESS for failed conservative management 5 years ago. Uncinectomy and maxillary ostium dilation was done during the previous FESS.  A DNE done now shows patent ostia and mucosal edema of the maxillary sinus lining. What is the next best step in management?",
    "choices": [
      {
        "id": 1,
        "text": "Repeat surgery"
      },
      {
        "id": 2,
        "text": "Macrolides for 4 months"
      },
      {
        "id": 3,
        "text": "Steroid irrigation and antihistamines"
      },
      {
        "id": 4,
        "text": "Biological therapy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span style=\"font-size: 12pt;\">The history of <strong>nasal obstruction</strong> and <strong>post-nasal drip</strong>\u00a0and endoscopy showing <strong>mucosal edema</strong> is suggestive of <strong>acute rhinosinusitis</strong>.\u00a0The next best step in management is symptomatic treatment with nasal <strong>steroid irrigation</strong>, decongestants, and <strong>antihistamines</strong>, regardless of the patient's past history of FESS operation.</span></p>\n<p><span style=\"font-size: 12pt;\">Acute viral rhinosinusitis\u00a0causes\u00a0<strong>mucosal edema</strong> which causes\u00a0<strong>obstruction of the sinus ostia</strong>. There is also reduced mucociliary transport in the sinuses resulting in stasis of secretions within the sinuses causing headache, facial pain, congestion, <strong>nasal obstruction</strong> or discharge,<strong> post-nasal drip</strong>, and hyposmia or anosmia.</span></p>\n<p><span style=\"font-size: 12pt;\"> If the sinuses remain obstructed or the mucociliary transport system does not return to normal, a <strong>bacterial infection</strong> can ensue, causing fever, <strong>purulent discharge,</strong> and <strong>persistent or worsening symptoms beyond 10 days</strong>.</span></p>\n<p><span style=\"font-size: 12pt;\">In the case of\u00a0<strong>bacterial sinusitis</strong>, <strong>antibiotics\u00a0</strong>like amoxicillin and macrolides (erythromycin) are used for a short course (Option B). </span></p>\n<p><span style=\"font-size: 12pt;\">Procedures like antral lavage and surgery (Option A) are done in cases not responding to medical therapy.</span></p>\n<p><span style=\"font-size: 12pt;\">Biological\u00a0therapy (Option D) is not used in the treatment of sinusitis.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tests cannot be used to assess nasal mucociliary clearance?",
    "choices": [
      {
        "id": 1,
        "text": "Saccharine test"
      },
      {
        "id": 2,
        "text": "Electron microscopy"
      },
      {
        "id": 3,
        "text": "Charcoal powder method"
      },
      {
        "id": 4,
        "text": "Scintigraphy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Among the given options, <strong>electron microscopy</strong> will be the<strong> least useful</strong> in assessing nasal mucociliary clearance. Other tests mentioned can be used in humans to detect mucociliary transit time and total nasal clearance in humans.</p>\n<div>Electron microscopy can be used to best <strong>assess</strong> the normalcy of <strong>cilia structure and its function</strong>, but it might not be able to detect any other abnormality that might interfere with nasal mucociliary clearance like any obstruction in the nasal cavity.</div>\n<p>Test for mucociliary clearance include:</p>\n<ul>\n<li><strong>Saccharine </strong>with or without color test in vivo (Option A)</li>\n<li><strong>Radioisotope transport </strong>testing in vivo</li>\n<li><strong>Measuring ciliary activity </strong>in vitro</li>\n<li>Nasal nitric oxide&nbsp;</li>\n<li><strong>Scintigraphy </strong>(Option D) is the nuclear medicine equivalent of the dye disappearance test to assess functional and anatomic obstruction</li>\n</ul>\n<p>The<strong> charcoal method </strong>(Option C)<strong>&nbsp;</strong>is a less commonly used method to detect nasal mucociliary clearance. In this method, a very small amount of charcoal is placed behind the head of the inferior turbinate. The pharynx is then observed to detect the presence of charcoal.</p>\n<p>Mucociliary clearance tests are used to diagnose inborn disorders of mucociliary transport such as <strong>primary ciliary dysfunction</strong> and <strong>cystic fibrosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following.",
    "choices": [
      {
        "id": 1,
        "text": "a-1, b-2, c-3, d-4"
      },
      {
        "id": 2,
        "text": "a-2, b-3, c-4, d-1"
      },
      {
        "id": 3,
        "text": "a-2, b-4, c-3, d-1"
      },
      {
        "id": 4,
        "text": "a-1, b-3, c-4, d-2"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct match for Wullstein's classification is a-2, b-4, c-3, d-1 (Option C).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What test is not used for testing olfaction?",
    "choices": [
      {
        "id": 1,
        "text": "Smell diskettes"
      },
      {
        "id": 2,
        "text": "Arnold stick test"
      },
      {
        "id": 3,
        "text": "UPSIT"
      },
      {
        "id": 4,
        "text": "CC-SIT"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Arnold stick test</strong> is not a test used for olfaction.</p>\n<p>Tests used for olfaction are as follows:</p>\n<ol>\n<li><strong>Smell diskettes</strong> are used as a screening test for olfaction. Reusable diskettes are used with the application of 8 different odorants. A questionnaire with illustrations is used to score the patient.</li>\n<li>The<strong> University of Pennsylvania smell identification test</strong>&nbsp;(UPSIT) is a commercially available, <strong>self-administered</strong> test used to assess the function of an individual's&nbsp;olfactory system via smell identification. It uses microencapsulated odorants, which are released on scratching standardized odor-impregnated test booklets.</li>\n<li>The 12-item version of UPSIT, also known as the <strong>cross-cultural smell identification test</strong>&nbsp;(CC-SIT),<strong>&nbsp;</strong>is useful for quantifying smell loss when less time is available. This test serves as a means to reliably assess olfactory function in <strong>less than 5 minutes</strong>.</li>\n<li>The<strong> Sniffin' sticks test </strong>is a new test of nasal chemosensory performance based on pen-like odor-dispensing devices.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following tests can be used if otoacoustic emissions is absent for screening?",
    "choices": [
      {
        "id": 1,
        "text": "2 and 4"
      },
      {
        "id": 2,
        "text": "1, 3, 4"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "2 and 3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A better <strong>objective test</strong> that could be used to diagnose<strong> retro-cochlear </strong>pathologies is brainstem auditory evoked response audiometry (<strong>BERA</strong>). It is a noninvasive test that can find any pathologies of central auditory pathways through the VIIIth nerve to pons and midbrain.</p>\n<p>Other options:</p>\n<p>1.<strong> Pure tone audiometry </strong>(Test 1)&nbsp;is a test that measures the threshold of hearing by air and bone conduction and thus the degree and type of hearing loss.&nbsp;Pure tone audiometry is a <strong>subjective test</strong> for hearing and is not employed in cases where OAE is absent when better objective tests such as tympanometry are available.</p>\n<p>3.&nbsp;<strong>Free field audiometry&nbsp;</strong>(Test 3), a part of behavior observational audiometry is used in the age group where children start localizing sounds when an auditory signal is presented. This test is not useful in this case as the possibility of hearing loss is already established with absent OAE.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e75c7e16b9045ad89595ed0ca1b4b06x1280x1416.JPEG"
    ]
  }
];
        let quizName = '145 Ent Inicet 2022';
        let hierarchy = ["Marrow", "PYQs", "ENT"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>