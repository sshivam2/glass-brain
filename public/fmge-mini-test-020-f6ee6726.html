<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fmge Mini Test - 020 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2022
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the correct order of layers of epidermis from deep to superficial?",
    "choices": [
      {
        "id": 1,
        "text": "Stratum basale, Stratum granulosum, Stratum spinosum, Stratum corneum"
      },
      {
        "id": 2,
        "text": "Stratum basale, Stratum spinosum, Stratum granulosum, Stratum corneum"
      },
      {
        "id": 3,
        "text": "Stratum corneum, Stratum spinosum, Stratum granulosum, Stratum basale"
      },
      {
        "id": 4,
        "text": "Stratum corneum, Stratum granulosum, Stratum spinosum, Stratum basale"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct order of the given layers from <strong>deep</strong> to <strong>superficial</strong> is stratum basale, stratum spinosum, stratum granulosum, stratum corneum.</p>\n<p>&nbsp;</p>\n<p>LAYERS OF SKIN (superficial to deep):</p>\n<table style=\"height: 216px; width: 394.171875px;\">\n<tbody>\n<tr style=\"height: 35px;\">\n<td style=\"width: 191px; text-align: center; height: 35px;\"><strong>Thin skin</strong></td>\n<td style=\"width: 202.171875px; text-align: center; height: 35px;\">\n<p><strong>Thick skin </strong></p>\n<p><strong>(glabrous skin)</strong></p>\n<p>palms, soles,&nbsp;flexor surfaces of digits</p>\n</td>\n</tr>\n<tr style=\"height: 62px;\">\n<td style=\"width: 191px; height: 62px;\">\n<ul>\n<li>stratum corneum</li>\n<li>stratum granulosum</li>\n<li>stratum spinosum</li>\n<li>stratum basale</li>\n</ul>\n</td>\n<td style=\"width: 202.171875px; height: 62px;\">\n<ul>\n<li>stratum corneum</li>\n<li><strong>stratum lucidum</strong></li>\n<li>stratum granulosum</li>\n<li>stratum spinosum</li>\n<li>stratum basale</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Mnemonic</strong> for skin layers (superficial to deep): <strong>C</strong>ome <strong>L</strong>et's <strong>G</strong>et<strong> So</strong>me<strong> B</strong>eer (Corneum, Lucidum, Granulosum, Spinosum, and Basale).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e25333309704ea0a11decbdd090ab7ax1080x854.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/297b9ad5b8064bf5bd65ba3182c477aex412x600.PNG"
    ]
  },
  {
    "text": "Tetanic contraction is due to the accumulation of _______ ions.",
    "choices": [
      {
        "id": 1,
        "text": "Na+"
      },
      {
        "id": 2,
        "text": "Ca2+"
      },
      {
        "id": 3,
        "text": "K+"
      },
      {
        "id": 4,
        "text": "Cl-"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Tetanic contraction occurs due to progressive accumulation of Ca<sup>2+</sup> ions with rapidly repeated stimulation of skeletal muscle.</strong></p>\n<ul>\n<li>With rapidly repeated stimulation, activation of the contractile mechanism occurs repeatedly before any relaxation has occurred, and the individual contractions fuse into one continuous contraction. Such a response is called a <strong>tetanus (tetanic contraction)</strong>.</li>\n<li>A single action potential releases sufficient Ca<sup>2+</sup> to cause a twitch contraction.</li>\n<li>However, the duration of this contraction is very short because Ca<sup>2+</sup> is very rapidly pumped back into the SR.</li>\n<li>If the muscle is stimulated a second time before the muscle is fully relaxed, there is progressive accumulation of Ca<sup>2+</sup> and the force of contraction increases. Thus, twitch forces are amplified as stimulus frequency increases.</li>\n<li>At a high level of stimulation, intracellular Ca<sup>2+</sup> increases and is maintained throughout the period of stimulation, and the amount of force developed greatly exceeds that seen during a twitch. The response is termed tetany.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/49e44474a0a543ac8d259fd1c2111709x763x314.JPEG"
    ]
  },
  {
    "text": "An adolescent male patient presented with pain in the calf muscles on exercise. On biopsy, an excessive amount of glycogen was found to be present in the muscle. What is the most likely enzyme deficiency?",
    "choices": [
      {
        "id": 1,
        "text": "Muscle-debranching enzyme"
      },
      {
        "id": 2,
        "text": "Phosphofructokinase 1"
      },
      {
        "id": 3,
        "text": "Glucose 6 phosphatase"
      },
      {
        "id": 4,
        "text": "Muscle glycogen phosphorylase"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical features are seen in <strong>McArdle's disease</strong>. This patient has <strong>muscle glycogen phosphorylase</strong>&nbsp;deficiency.</p>\n<p>The <strong>lack of muscle glycogen phosphorylase</strong> results in <strong>excess glycogen build-up in muscles</strong>, as seen in the biopsy.</p>\n<p><strong>Image</strong>: Vacuolar myopathy in McArdle's disease</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/86d16fb179ed440db5df3a0963d550bcx1280x948.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8296f8ac047546f2b52c591a7d639613x1280x841.JPEG"
    ]
  },
  {
    "text": "Which of the following stains is used for the detection of hemosiderin deposits?",
    "choices": [
      {
        "id": 1,
        "text": "Mason\u2013Fontana stain"
      },
      {
        "id": 2,
        "text": "Oil red O"
      },
      {
        "id": 3,
        "text": "Sudan black"
      },
      {
        "id": 4,
        "text": "Perl\u2019s prussian blue"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Perl's Prussian blue </strong>stain is used to detect&nbsp;<strong>H</strong><strong>emosiderin deposits.</strong></p>\n<p><strong>Hemosiderin&nbsp;</strong>is a hemoglobin-derived granular pigment that is golden yellow to brown. It accumulates in the tissues when there is a local or systemic excess of iron.</p>\n<p>Iron is normally stored within cells in association with the protein apoferritin, forming ferritin micelles. Large aggregates of these micelles are hemosiderin deposits seen both in light and electron microscopy.&nbsp;</p>\n<p><strong>Image 1: Hemosiderin deposits in tissue</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/27881cf505594da4a2ad9a049b52b69cx600x384.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/572a3bf434f0488ca1e0ff137586dfc9x803x603.PNG"
    ]
  },
  {
    "text": "A diabetic patient diagnosed with Covid 19 infection on steroid therapy presented with a black, foul-smelling discharge from the nose and redness of the right eye. There is significant visual impairment. On examination, there is a blackish necrotic mass filling the nasal cavity and eroding the septum and hard palate. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Atrophic rhinitis"
      },
      {
        "id": 2,
        "text": "Mucormycosis"
      },
      {
        "id": 3,
        "text": "Aspergillosis"
      },
      {
        "id": 4,
        "text": "Rhinosporidiosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical scenario is suggestive of</span><strong><span data-preserver-spaces=\"true\">&nbsp;mucormycosis.&nbsp;</span></strong></p>\n<p><strong>Invasive Mucormycosis</strong>&nbsp;has recently emerged as a life-threatening <strong>complication of COVID-19 in India</strong>. It is an <strong>opportunistic infection</strong> seen even in <strong>mild to moderate COVID patients</strong> with strong predisposing factors like <strong>hyperglycemia/uncontrolled diabetes.</strong> Diabetic patients receiving&nbsp;<strong>corticosteroids/ immunosuppressants for COVID-19</strong> treatment are exceptionally vulnerable to develop mucormycosis due to the risk of steroid-induced hyperglycemia.</p>\n<p><span style=\"text-decoration: underline;\">MUCORMYCOSIS:</span></p>\n<p><span data-preserver-spaces=\"true\">Mucormycosis is an opportunistic infection caused principally by species of <strong>rhizopus, mucor,</strong> and<strong> lichtheimia</strong>. Among them, the most prevalent species are&nbsp;<strong>Rhizopus oryzae </strong>and <strong>R. delemar. </strong>It is&nbsp;seen in patients with <strong>diabetes mellitus</strong>, leukemias, lymphomas, long-term corticosteroid use, severe burns, and immunodeficiencies. </span></p>\n<p><span data-preserver-spaces=\"true\">The common clinical form is <strong>rhino-orbital-cerebral mucormycosis</strong> in which there is an <strong>invasion of the blood vessels</strong> in the nasal cavity, eyes, and brain causing thrombosis, infarction, and necrosis. They invade tissues of patients with reduced host defense. From there, they enter the blood vessels and proliferate in the walls of blood vessels particularly paranasal sinuses and orbit.</span>&nbsp;<span data-preserver-spaces=\"true\">The <strong>blackish discoloration</strong> is due to arterial and venous <strong>thrombosis</strong> leading to gangrene.</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Diagnosis</strong>-&nbsp;</span>They can be stained with 10% potassium hydroxide and can be cultured.</p>\n<p>On Sabouraud agar at 30-37&deg;C<span class=\"s1\">, they appear as</span>&nbsp;<strong>grey-white&nbsp;colonies</strong> with a <strong>thick cottony<span class=\"s1\">, </span>fluffy surface</strong>.</p>\n<p>Under the microscope<span class=\"s1\">, they appear as&nbsp;</span><strong>nonseptate<span class=\"s1\">, irregularly branched&nbsp;</span>broad hyphae</strong> with aerial sporangiophores which end in a sporangium (a sac containing spores<span class=\"s1\">).&nbsp;</span></p>\n<p><span data-preserver-spaces=\"true\">The below image shows broad aseptate and irregularly branched hyphae seen in mucormycosis</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b86dff074a84104877d8f4aea65ae46x800x600.JPEG"
    ]
  },
  {
    "text": "An ECG revealed the following finding. Which of the following drugs would be most likely to cause this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lignocaine"
      },
      {
        "id": 2,
        "text": "Sotalol"
      },
      {
        "id": 3,
        "text": "Magnesium Sulfate"
      },
      {
        "id": 4,
        "text": "Digoxin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This ECG with a&nbsp;<strong>wide QRS complex with prolonged QT interval&nbsp;</strong>points towards the diagnosis of&nbsp;<strong>torsades de pointes.&nbsp;</strong><strong>Sotalol&nbsp;</strong>is most likely to cause Torsades de pointes.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p><strong>Torsades de pointes</strong> (French: twisting of points)-It is a life-threatening form of <strong>polymorphic ventricular tachycardia</strong> with rapid asynchronous complexes and an <strong>undulating baseline on ECG.</strong></p>\n<p><strong>Acute management - Magnesium&nbsp;</strong>and&nbsp;<strong>Isoproterenol</strong></p>\n<p><strong>Chronic management - Beta blockade</strong> and&nbsp;<strong>cardiac pacing</strong></p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a93eb80570304dadad080d2abffc7e39.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "The venom of a pit viper is:",
    "choices": [
      {
        "id": 1,
        "text": "Myotoxic"
      },
      {
        "id": 2,
        "text": "Vasculotoxic"
      },
      {
        "id": 3,
        "text": "Neurotoxic"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Vipers are <strong>vasculotoxic</strong>.&nbsp;</p>\n<p>The venom causes enzymatic destruction of cell walls and coagulation disorders.</p>\n<p>The main site of action are&nbsp;endothelial cells of blood vessels. There is hemolysis of red blood cells as well.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements is true regarding serous otitis media?",
    "choices": [
      {
        "id": 1,
        "text": "Fluid is sterile."
      },
      {
        "id": 2,
        "text": "Adenoid hypertrophy is the most common cause in children causing bilateral serous otitis media"
      },
      {
        "id": 3,
        "text": "Tumors of nasopharynx is most common cause in adults causing unilateral serous otitis media"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All the given statements are true.</p>\n<p><strong>Serous otitis media:&nbsp;</strong></p>\n<p>The fluid is nearly sterile and the causes are :</p>\n<p><strong> Malfunctioning of eustachian tube:</strong></p>\n<ul>\n<li>Adenoid hyperplasia in children.</li>\n<li>Benign and malignant tumors of nasopharynx. This&nbsp;cause should always be excluded in unilateral serous&nbsp;otitis media in an adult.</li>\n</ul>\n<p><strong>Other causes include</strong></p>\n<ul>\n<li>Interference with ET&nbsp;opening like in<strong> cleft lip and cleft palate</strong> and enlarged tonsils</li>\n<li>Otitic <strong>barotrauma</strong></li>\n<li>Increased middle ear secretions like in an&nbsp;<strong>allergy</strong>.</li>\n<li>Persistent effusion of ASOM due&nbsp;to <strong>inadequate treatment</strong> dose or duration</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the diagnosis from the image given below ?",
    "choices": [
      {
        "id": 1,
        "text": "Pinguecula"
      },
      {
        "id": 2,
        "text": "Concretions"
      },
      {
        "id": 3,
        "text": "Pterygium"
      },
      {
        "id": 4,
        "text": "Bitots spots"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The diagnosis from the above image is<strong> pterygium</strong>.&nbsp;</p>\n<p><strong>Pterygium</strong>:</p>\n<p>It is a <strong>subconjunctival fibrovascular tissue</strong> encroaching the cornea.</p>\n<p>It is a <strong>degenerative condition</strong> of the sub-conjunctival tissue.</p>\n<p>It is a connective tissue disorder and is&nbsp;<strong>never inflammatory.&nbsp;</strong></p>\n<p>It is made up of three parts:</p>\n<ul>\n<li>a \"cap\" (an avascular halo-like zone at the advancing edge),</li>\n<li>a head,</li>\n<li>a body.</li>\n</ul>\n<p>Occurs due to exposure to radiation:&nbsp;<strong>UV-B</strong>.</p>\n<p>The most common site is <strong>nasal</strong>.</p>\n<p>Clinical features:</p>\n<ul>\n<li><strong>Astigmatism with the rule, </strong>usually</li>\n<li><strong>Stocker's line -&nbsp;</strong>deposition of iron on the advancing edge.</li>\n<li><strong>Fuchs islets&nbsp;</strong>are small, discrete,&nbsp;<strong>whitish flecks</strong> consisting of <strong>clusters of pterygial epithelial cells,</strong> often present <strong>at the advancing edge</strong>.</li>\n</ul>\n<p>Treatment:<strong>&nbsp;Excision</strong></p>\n<p>To prevent recurrence:</p>\n<p>Mitomycin C or 5 fluorouracil</p>\n<ul>\n<li><strong>Auto-grafting</strong>:<strong> Conjunctival limbal autograft (CLAG) </strong>from the<strong> superior</strong> limbal conjunctiva is the<strong>&nbsp;best method.</strong></li>\n<li>Bare sclera technique<strong> has high recurrence rate</strong>&nbsp;of<strong>&nbsp;30 to 80%</strong>.</li>\n<li>PERFECT surgery (<span class=\"st\"><strong>P</strong>terygium<strong> E</strong>xtended <strong>R</strong>emoval <strong>F</strong>ollowed by <strong>E</strong>xtended <strong>C</strong>onjunctival<strong> T</strong>ransplant)</span>&nbsp;has<strong> zero </strong>rate of<strong>&nbsp;</strong>recurrence.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/77155548766d4be28eb065f1783acbe6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child is brought to the PHC with acute diarrhoea. The doctor, based on history,  suspects that the child maybe suffering from an infection due to Shigella over cholera and proceeds to give ciprofloxacin as the antibiotic. Which of the following points on history, apart from bloody stools, favour the doctor's suspicion?",
    "choices": [
      {
        "id": 1,
        "text": "Absence of rectal pain"
      },
      {
        "id": 2,
        "text": "Presence of abdominal cramps"
      },
      {
        "id": 3,
        "text": "Presence of vomiting"
      },
      {
        "id": 4,
        "text": "Presence of fever"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Among the options given, <strong>the presence of fever</strong> favours the suspicion towards <strong>Shigella</strong> as the infectious agent, for which <strong>ciprofloxacin is the drug of choice.</strong></p>\n<p>The <strong>presence of vomiting</strong> and <strong>absence of rectal pain</strong> favour<strong> cholera</strong> and abdominal pain is present in both the diseases.</p>\n<p>Symptomatic differential diagnosis of shigella and cholera:</p>\n<table style=\"height: 273px; width: 388.474px;\">\n<tbody>\n<tr>\n<td style=\"width: 122px;\"><strong>Symptoms</strong></td>\n<td style=\"width: 124px;\"><strong>Cholera</strong></td>\n<td style=\"width: 125.474px;\"><strong>Shigella</strong></td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Diarrhoea</strong></td>\n<td style=\"width: 124px;\">Acute watery</td>\n<td style=\"width: 125.474px;\">Acute bloody</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Fever</strong></td>\n<td style=\"width: 124px;\">No</td>\n<td style=\"width: 125.474px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Abdominal cramps</strong></td>\n<td style=\"width: 124px;\">Yes</td>\n<td style=\"width: 125.474px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Vomiting</strong></td>\n<td style=\"width: 124px;\">Yes</td>\n<td style=\"width: 125.474px;\">No</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Rectal pain</strong></td>\n<td style=\"width: 124px;\">No</td>\n<td style=\"width: 125.474px;\">Yes</td>\n</tr>\n<tr>\n<td style=\"width: 122px;\"><strong>Stool</strong></td>\n<td style=\"width: 124px;\">&gt;3 loose stools per day, watery like rice water</td>\n<td style=\"width: 125.474px;\">&gt; 3 stools/day, with blood or pus.</td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following compounds is predominantly responsible for the disinfecting property of bleaching powder?",
    "choices": [
      {
        "id": 1,
        "text": "Hypochlorite ion"
      },
      {
        "id": 2,
        "text": "Hydrochloric acid"
      },
      {
        "id": 3,
        "text": "Hypochlorous acid"
      },
      {
        "id": 4,
        "text": "Chloride ion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The disinfectant property of bleaching powder is predominantly due to the action of <strong>hypochlorous acid.</strong></p>\n<p>Bleaching powder, also known as <strong>chlorinated lime (CaOCl2)</strong>, has <strong>33 per cent of chlorine</strong> in it. When chlorine is added to water, there is the formation of hydrochloric and hypochlorous acids. The hydrochloric acid is neutralized by the alkalinity of the water. The hypochlorous acid ionizes to form hydrogen ions and hypochlorite ions, as follows:</p>\n<p>H<sub>2</sub>O + Cl<sub>2</sub>&nbsp;&rarr; HCl + HOCl</p>\n<p><strong>HOCl &rarr; H + OCl</strong></p>\n<p>The disinfecting action of chlorine is mainly due to <strong>hypochlorous acid.</strong>&nbsp;It is <strong>70-80 times</strong> more effective than&nbsp;Hypochlorite ion.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes with a \u200bhistory of clean-cut injury which is not lacerated. He says that he received his last dose of tetanus vaccination about 10 years ago. What should be given next?",
    "choices": [
      {
        "id": 1,
        "text": "Full course of tetanus vaccination"
      },
      {
        "id": 2,
        "text": "Single dose tetanus toxoid"
      },
      {
        "id": 3,
        "text": "Tetanus toxoid + immunoglobulin"
      },
      {
        "id": 4,
        "text": "No vaccination needed"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A<strong> single dose&nbsp;</strong>of<strong> tetanus toxoid</strong> is given as the <strong>wound</strong> is <strong>clean</strong> and the&nbsp;<strong>last dose</strong> was<strong>&nbsp;</strong>received&nbsp;more than<strong> 10 years ago.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The clinical triad of pheochromocytoma includes all of the following symptoms except:",
    "choices": [
      {
        "id": 1,
        "text": "Headache"
      },
      {
        "id": 2,
        "text": "Hypertension"
      },
      {
        "id": 3,
        "text": "Profuse sweating"
      },
      {
        "id": 4,
        "text": "Palpitation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical<strong> triad</strong> of <strong>pheochromocytoma</strong> includes the following&nbsp;<strong>symptoms</strong>:</p>\n<ul>\n<li>Headache</li>\n<li>Profuse sweating</li>\n<li>Palpitation (due to tachycardia)</li>\n</ul>\n<p>Hypertension is the most predominant<strong> sign</strong> of pheochromocytoma. Though <strong>intermittent</strong> <strong>hypertension</strong> is a classical feature, sustained hypertension is also common.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  45-year old male presents with bilateral flank pain, gross hematuria. He has a family history of autosomal polycystic kidney disease. How many cysts should be present in the kidneys to diagnose him with ADPKD?",
    "choices": [
      {
        "id": 1,
        "text": "At least 2 cysts in each kidney"
      },
      {
        "id": 2,
        "text": "At least 3 cysts in each kidney"
      },
      {
        "id": 3,
        "text": "At least 4 cysts in each kidney"
      },
      {
        "id": 4,
        "text": "Even a single cyst in each kidney"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>2 cysts in each kidney should be present to make the diagnosis of ADPKD.</p>\n<p>Since the <strong>genetic analysis is not known </strong>here<strong>&nbsp;</strong>but has a family history , diagnosis of <strong>ADPKD based on</strong> USG findings is generally made using the <strong>unified criteria</strong>&nbsp;by Pei et al in 2009:</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Age (in years)</strong></td>\n<td><strong>Imaging findings</strong></td>\n</tr>\n<tr>\n<td>15 - 39&nbsp;</td>\n<td>Total of &ge;3 cysts, unilateral or bilateral</td>\n</tr>\n<tr>\n<td>40 - 59</td>\n<td>&ge;2 cysts in each kidney</td>\n</tr>\n</tbody>\n</table>\n<div>&nbsp;</div>\n<div>\n<p>The age of the person is 45 and hence 2 cysts should be present in the kidney to make the diagnosis of ADPKD.</p>\n<p>If the <strong>genetic analysis is known</strong>, then ultrasonographic diagnostic criteria for <strong>ADPKD1</strong>&nbsp;is based on&nbsp;<strong>Ravine criteria:</strong></p>\n<ul>\n<li>\n<div class=\"topbullet\">At least <strong>2 cysts in 1 kidney or 1 cyst in each kidney</strong> in an at-risk patient<strong> less than 30 years</strong></div>\n</li>\n<li>\n<div class=\"topbullet\">At least<strong> 2 cysts in each kidney</strong> in an at-risk patient aged <strong>30-59 years</strong></div>\n</li>\n<li>\n<div class=\"topbullet\">At least <strong>4 cysts</strong> in each kidney for an at-risk patient aged <strong>60 years or older</strong></div>\n</li>\n</ul>\n<div class=\"topbullet\">&nbsp;</div>\n<div id=\"ads-pos-c8_3\" class=\"inContentAd\">&nbsp;<strong>Adult polycystic kidney disease (ADPKD)</strong></div>\n</div>\n<div>\n<p>Inherited as an autosomal dominant trait with a mutation in the genes&nbsp;<em>PKD1</em>&nbsp;(chromosome 16p, produces a protein called polycystin1) and&nbsp;<em>PKD2</em>&nbsp;(chromosome 4q, polycystin 2).</p>\n<p><strong>ADPKD</strong></p>\n<ul>\n<li><strong>Autosomal dominant trait</strong>&nbsp;</li>\n<li><strong>Mutations in PKD1 and PKD2</strong>, which, respectively, code for polycystin-1 (PC1) and polycystin-2 (PC2). It is</li>\n<li>Characterized by the progressive <strong>bilateral</strong> <strong>formation</strong> of renal cysts.</li>\n<li>Many patients are asymptomatic until the <strong>fourth to fifth decade</strong> of life.</li>\n<li>Kidney stones with<strong>&nbsp;</strong>more than half of the stones&nbsp; composed of <strong>uric</strong> <strong>acid</strong>.</li>\n<li>Intracranial aneurysm (ICA) occurs four to five times more frequently in ADPKD patients.</li>\n</ul>\n<p><strong>Clinical features:&nbsp;</strong>The disease does not usually manifest before the age of 30 years, and in some patients, it is never diagnosed.</p>\n<ul>\n<li><strong>Hypertension (most common)</strong></li>\n<li>Irregular upper quadrant mass</li>\n<li>Loin pain</li>\n<li>Hematuria</li>\n<li>Infection</li>\n<li>Uremia</li>\n</ul>\n<p>&nbsp;<strong>Extrarenal cysts in ADPKD:</strong></p>\n<ul>\n<li>Hepatic cysts</li>\n<li>Pancreatic cysts</li>\n<li>Seminal vesicle cysts</li>\n<li>Arachnoid membrane cysts</li>\n</ul>\n<p>ADPKD is an important cause of&nbsp;<strong>renal failure</strong>,&nbsp;affecting&nbsp;<strong>10-15%</strong>&nbsp;of the patients who receive haemodialysis.</p>\n<p>In autosomal dominant polycystic kidney disease(<strong>ADPKD</strong>), cysts are&nbsp;<strong>least likely</strong>&nbsp;to be present in the <strong>lungs.</strong></p>\n<p>&nbsp;</p>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Diagnose the given ECG.",
    "choices": [
      {
        "id": 1,
        "text": "Anterior wall MI"
      },
      {
        "id": 2,
        "text": "Inferior wall MI"
      },
      {
        "id": 3,
        "text": "Posterior wall  MI"
      },
      {
        "id": 4,
        "text": "Anteroseptal MI"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Inferior wall MI</strong>&nbsp; is the diagnosis.</p>\n<p><strong>ST-elevation</strong> is present in<strong> II, III and aVF</strong> leads which represent the<strong> Inferior wall&nbsp;</strong> and thus it is Inferior wall MI.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/32b2ee54d7744ca2b6a3d906381de00e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3025f15bdbef485eb7f4edc5806e5c42x1280x1979.JPEG"
    ]
  },
  {
    "text": "Which is the characteristic pattern seen in Brown Sequard syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Contralateral loss of joint sense and position"
      },
      {
        "id": 2,
        "text": "Contralateral loss of pain sensation"
      },
      {
        "id": 3,
        "text": "Ipsilateral loss of complete sensory functions"
      },
      {
        "id": 4,
        "text": "Contralateral deep tendon reflex"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Brown\u2013Sequard syndrome presents with <strong>contralateral\u00a0loss of pain sensation</strong>.</p>\n<p>Lateral hemisection of the spinal cord produces the Brown\u2013S\u00e9quard syndrome.</p>\n<p>Clinical features</p>\n<ul>\n<li>Ipsilateral weakness (corticospinal tract involvement)\u00a0</li>\n<li>Ipsilateral loss of joint position and vibratory sense (posterior column involvement)</li>\n<li>Contralateral loss of pain and temperature sense (spinothalamic tract involvement) one or two levels below the lesion</li>\n<li>Ipsilateral segmental signs like radicular pain, muscle atrophy, or loss of a deep tendon reflex</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which is not true regarding the given image?",
    "choices": [
      {
        "id": 1,
        "text": "Seen at squamocolumnar junction"
      },
      {
        "id": 2,
        "text": "Associated with reflux disease"
      },
      {
        "id": 3,
        "text": "Circular ring in the proximal esophagus"
      },
      {
        "id": 4,
        "text": "Respond to dilatation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows <strong>Schatzki&rsquo;s ring</strong> which is a circular ring seen in the distal esophagus.</p>\n<ul>\n<li>It is usually present at the squamocolumnar junction.</li>\n<li>The cause is obscure but it is strongly associated with reflux disease.</li>\n<li>It may be associated with dysphagia and respond to dilatation along with medical anti-reflux therapy.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a758aa2fff554fccb0acb46adc0bbe57.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/84d7029f621840e59b209a008ec37785x388x448.JPEG"
    ]
  },
  {
    "text": "A 38-year-old male patient presented to surgery OPD with a history of serous discharge from an external opening located in the perianal region. On examination, the location of the external opening was at 8\u2019O clock position. What is the location of the internal opening?",
    "choices": [
      {
        "id": 1,
        "text": "3\u2019O clock"
      },
      {
        "id": 2,
        "text": "8\u2019O clock"
      },
      {
        "id": 3,
        "text": "6\u2019O clock"
      },
      {
        "id": 4,
        "text": "4\u2019O clock"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given case scenario is diagnostic of Fistula-in-ano with external opening at 8&rsquo;O clock position which implies that the external opening of the fistula is lying posterior to the midline.</p>\n<p>According to the Goodsall rule, fistulas with an external opening posteriorly track in a curvilinear fashion to the posterior midline (6&rsquo;O clock position). Hence, the fistulous tract opens internally at 6&rsquo;O clock position.</p>\n<p><strong>Goodsall&rsquo;s rule:</strong></p>\n<ul>\n<li>Fistulas with an external opening anteriorly connect to the internal opening by a short, radial tract.</li>\n<li>Fistulas with an external opening posteriorly track in a curvilinear fashion to the posterior midline.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/085a257b1d9f41239a318b9c57562b9ax266x360.JPEG"
    ]
  },
  {
    "text": "The image shows plain CT of a patient with head injury. The diagnosis is ____.",
    "choices": [
      {
        "id": 1,
        "text": "Extradural hematoma (EDH)"
      },
      {
        "id": 2,
        "text": "Subdural hematoma (SDH)"
      },
      {
        "id": 3,
        "text": "Subarachnoid hemorrhage (SAH)"
      },
      {
        "id": 4,
        "text": "Intraparenchymal bleed"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above CT scan shows a large extradural hematoma (<strong>hyperdense</strong>&nbsp;<strong>biconvex/lentiform shape</strong>) with mass effect.</p>\n<p><strong>Extradural hematoma (EDH)</strong></p>\n<ul>\n<li>EDH is the accumulation of blood between the skull and the dura. It usually results from <strong>arterial disruption</strong>, especially of the <strong>middle meningeal artery</strong> (<strong>pterion</strong>&nbsp;is the&nbsp;thinnest part of the&nbsp;skull and overlies middle meningeal artery).</li>\n<li>The patient is initially unconscious from the concussive aspect of the head trauma. The patient then awakens and has a &ldquo;<strong>lucid interval</strong>,&rdquo; while the hematoma sub-clinically expands. As the volume of the hematoma grows, intracranial pressure (ICP) increases, and the patient rapidly becomes lethargic and herniates.</li>\n<li><strong>Uncal herniation</strong> from an EDH classically causes <span style=\"text-decoration: underline;\"><em>ipsilateral third nerve palsy and contralateral hemiparesis</em></span>. Sometimes, herniation may be associated with a <strong>false localising ipsilateral hemiparesis</strong>, known as the <strong>Kernohan-Woltman notch phenomenon</strong>, in which the free edge of the tentorium compresses the contralateral crus cerebri in the midbrain.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ab4191954a0b4e3e89efd35ab99c0191.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "After a surgery, the surgeon asked the intern to remove the Foley's catheter but he/she could not do it. The surgeon himself tried to remove it but he was unsuccessful as well. What should be the next step of action?",
    "choices": [
      {
        "id": 1,
        "text": "CT-guided rupture of bulb of Foley's"
      },
      {
        "id": 2,
        "text": "Inject ether to dissolve the balloon and pull it out"
      },
      {
        "id": 3,
        "text": "Inject water to overdistend the balloon until it bursts and Foley's can be removed"
      },
      {
        "id": 4,
        "text": "Use ultrasound guidance to locate and prick the balloon after inflating with 20ml water"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The best technique in this situation is ultrasound-guided rupture of the balloon percutaneously after inflating it with 20ml water. It is important subsequently to cystoscope the patient to ensure that any fragments are removed before they can form a foreign body calculus.</p>\n<div class=\"page\" title=\"Page 1457\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>A retained Foley catheter is usually caused by blockage of the channel that connects the balloon to the side arm. Cutting off the side arm and attempting to clear the channel with a wire is only occasionally successful.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 38-year-old pregnant woman with obstetric score G2P2L1 at 10 weeks of gestation presents with third degree uterine prolapse. Which of the following is the best management for her?",
    "choices": [
      {
        "id": 1,
        "text": "Fothergill repair"
      },
      {
        "id": 2,
        "text": "Sling operation"
      },
      {
        "id": 3,
        "text": "Ring pessary"
      },
      {
        "id": 4,
        "text": "Shirodkar Procedure"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>For prolapse during pregnancy or puerperiem, a ring pessary is used until delivery after which an operative procedurre is considered.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Placenta accreta means:",
    "choices": [
      {
        "id": 1,
        "text": "Villi penetrate through myometrium to the serosa"
      },
      {
        "id": 2,
        "text": "Villi invade myometrium"
      },
      {
        "id": 3,
        "text": "Villi are attached to myometrium"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Placenta accreta is when the<strong>&nbsp;villi&nbsp;are attached to the&nbsp;myometrium.</strong></p>\n<p>Placenta accreta syndromes&nbsp;describe the abnormally implanted, invasive, or adhered placenta. The abnormally firm adherence to the&nbsp;myometrium&nbsp;is due to the partial&nbsp;or total absence of the&nbsp;decidua&nbsp;basalis&nbsp;and&nbsp;imperfect development of the <strong>Nitabuch</strong> layer.&nbsp;&nbsp;</p>\n<p><strong>Nitabuch layer</strong>-A <span class=\"hvr\">layer</span> of <span class=\"hvr\">fibrin</span> <span class=\"hvr\">between</span> <span class=\"hvr\">the</span> &nbsp;<span class=\"hvr\">compact</span> <span class=\"hvr\">endometrium</span> <span class=\"hvr\">and</span> <span class=\"hvr\">the</span> <span class=\"hvr\">cytotrophoblastic</span> <span class=\"hvr\">shell</span> in <span class=\"hvr\">the&nbsp;</span><span class=\"hvr\">placenta.</span>This layer is<strong> absent in placenta accreta.</strong></p>\n<table style=\"width: 387px;\">\n<tbody>\n<tr>\n<td style=\"width: 128px;\">\n<p>Types</p>\n</td>\n<td style=\"width: 251px;\">\n<p>Definition</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 128px;\">\n<p>Placenta&nbsp;accreta&nbsp;&nbsp;</p>\n</td>\n<td style=\"width: 251px;\">\n<p>Villi&nbsp;are attached to the&nbsp;myometrium.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 128px;\">\n<p>Placenta&nbsp;increta&nbsp;</p>\n</td>\n<td style=\"width: 251px;\">\n<p>Villi invade the&nbsp;myometrium.&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 128px;\">\n<p>Placenta&nbsp;percreta&nbsp;</p>\n</td>\n<td style=\"width: 251px;\">\n<p>Villi&nbsp;penetrate through the&nbsp;myometrium&nbsp;and to or through the&nbsp;serosa.&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>These three variants are encountered in an approximate ratio of 80:15:5, respectively.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0579b843d6f448d4a8ee250d6d389ed3x1280x1352.JPEG"
    ]
  },
  {
    "text": "You are working as a Junior Resident in the department of pathology. You receive a specimen from Gynecology OT following resection of a lateral adnexal mass. You see the following marked structures on light microscopy. This is a distinct feature of which cell?",
    "choices": [
      {
        "id": 1,
        "text": "Granulosa cell"
      },
      {
        "id": 2,
        "text": "Discus proligerus"
      },
      {
        "id": 3,
        "text": "Theca cell"
      },
      {
        "id": 4,
        "text": "Leydig cell"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The formation of <strong>Call-Exner bodies</strong> is a distinct feature of <strong>granulosa cells.</strong></p>\n<p>The mature graffian follicle is spheroidal or ovoid in shape and contains pent-up secretion, the liquor folliculi. The lining consists of two layers: (i)<strong> Theca interna</strong> and (ii) <strong>Granulosa layer</strong>.</p>\n<p>Within the theca interna layer lies the granulosa cell layer, which consists of cells that have a characteristic appearance. The cells are 8&ndash;10 &mu; in diameter. The nuclei always stain deeply and the cells contain relatively little cytoplasm.</p>\n<p>Scattered <strong>amongst the granulosa cells,</strong> particularly in the vicinity of the discus proligerus, are small spherical globules around which the granulosa cells are arranged radially. These structures form Call-Exner bodies. These are pathognomic for granulosa cell tumors. They are distinguished by their \"coffee bean\" nuclei.</p>\n<p>In one area, the granulosa cells are collected together to form a projection into the cavity of the graffian follicle called the discus proligerus or cumulus oophorus.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cdc5f715487741e6b805014b9bd4880f.jpeg"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following symbol denotes identical twins in a pedigree chart?",
    "choices": [
      {
        "id": 1,
        "text": "Option A"
      },
      {
        "id": 2,
        "text": "Option B"
      },
      {
        "id": 3,
        "text": "Option C"
      },
      {
        "id": 4,
        "text": "Option D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option<strong> A</strong>&nbsp; denotes <strong>monozygotic (identical) twins in a pedigree chart.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c97f14aa01e4486783831acf418bc051.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the emergency department after he fell on his outstretched hand. An X-ray was performed and is given below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Colle's fracture"
      },
      {
        "id": 2,
        "text": "Rolando's fracture"
      },
      {
        "id": 3,
        "text": "Galeazzi fracture"
      },
      {
        "id": 4,
        "text": "Montegia fracture"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The&nbsp; X-ray reveals&nbsp;an oblique <strong>fracture in the lower third of the radius</strong> and there is <strong>dislocation of the distal radio-ulnar joint</strong>, which is diagnostic of&nbsp;<strong>Galeazzi fracture-dislocation</strong>.</p>\n<p>The patient with Galeazzi fracture-dislocation presents with pain, swelling and deformity at the lower end of the radius.&nbsp;On clinical examination, the disruption of the radio-ulnar joint can be elicited by pressing the lower end of the ulna. The ulna moves down and comes back like the key of a piano (<strong>piano-key sign</strong>).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/594bfce174274459a7b634eff0249c66.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A cystic lesion in the suprasellar region with calcification is seen on the MRI. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Craniopharyngioma"
      },
      {
        "id": 2,
        "text": "Pituitary adenoma"
      },
      {
        "id": 3,
        "text": "Meningioma"
      },
      {
        "id": 4,
        "text": "Oligodendroglioma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>A&nbsp;cystic lesion in the suprasellar region with calcification is suggestive of <strong>craniopharyngioma.</strong>&nbsp;It is derived from <strong>Rathke&rsquo;s pouch</strong> and arises near the pituitary stalk, commonly extending into the suprasellar cistern.</p>\n<p>Craniopharyngiomas are&nbsp;<strong>benign masses</strong>&nbsp;usually presenting the&nbsp;<strong>suprasellar region</strong>&nbsp;arising near the pituitary stalk and can produce&nbsp;<strong>functional impairment</strong>&nbsp;of the hypophysis due to&nbsp;<strong>mass effect</strong>. They can be&nbsp;<strong>clinically aggresive</strong>&nbsp;due to their&nbsp;<strong>tendency to recur</strong>.&nbsp;<strong>Adamantinomatous (children)</strong>&nbsp;and&nbsp;<strong>Papillary (adult)</strong>&nbsp;are two variants of craniopharyngioma.<strong>&nbsp;Calcification</strong>&nbsp;is characteristic of the&nbsp;<strong>adamantinomatous&nbsp;</strong>variety (found in&nbsp;<strong>childhood</strong>). Wet keratin nodules are the characteristic histologic feature of adamantinomatous type.</p>\n<p>These tumors are usually large and heterogeneous, displaying&nbsp;<strong>both solid and cystic components</strong>, and occur within the&nbsp;<strong>suprasellar&nbsp;</strong>area<strong>.&nbsp;</strong>The<strong>&nbsp;cysts&nbsp;</strong>contain a<strong>&nbsp;cholesterol rich,&nbsp;</strong>thick brownish yellow fluid that is compared to \"<strong>machine oil</strong>\".</p>\n<ul>\n<li>Patients usually come to attention due to a&nbsp;<strong>headache</strong>&nbsp;and visual changes including&nbsp;<strong>decreased acuity&nbsp;</strong>or visual field abnormalities<strong>&nbsp;(</strong><strong>bitemporal hemianopia).</strong></li>\n<li>These children also have endocrinologic abnormalities such as&nbsp;<strong>growth failure</strong>&nbsp;and&nbsp;<strong>delayed sexual maturation</strong>&nbsp;due to&nbsp;<strong>pituitary hypofunction</strong>&nbsp;and GH deficiency.&nbsp;</li>\n<li>There can be evidence of&nbsp;<strong>mental retardation</strong>&nbsp;also.&nbsp;</li>\n<li>They are&nbsp;<strong>minimally invasive</strong>, adhere to adjacent brain parenchyma, and engulf normal brain structures</li>\n<li>CT may show&nbsp;<strong>calcifications</strong>&nbsp;associated with the solid and cystic wall components.</li>\n<li><strong>MRI:</strong></li>\n<ul>\n<li><strong>Cysts</strong>\n<ul>\n<li><strong>T1:</strong>&nbsp;iso- to hyperintense to brain (due to high protein content \"machinery oil cysts\")</li>\n<li><strong>T2:M</strong>ostly hyperintense</li>\n</ul>\n</li>\n<li><strong>Solid component</strong>\n<ul>\n<li><strong>T1 C+ (Gd):</strong>&nbsp;vivid enhancement</li>\n<li><strong>T2:</strong>&nbsp;variable or mixed&nbsp;</li>\n</ul>\n</li>\n</ul>\n</ul>\n<p>Usually treated by&nbsp;<strong>trans-sphenoidal</strong>&nbsp;or&nbsp;<strong>trans-cranial resection</strong>&nbsp;followed by&nbsp;<strong>adjuvant radiation</strong>&nbsp;therapy.&nbsp;</p>\n<p>Other options:</p>\n<p>Option B: Pituitary adenomas are seen in the sellar region. Microadenomas are best shown on contrast-enhanced images. Marcoadenomas are seen as snowman or figure of eight appearance</p>\n<p>Option C: Meningioma is a supratentorial tumor, mainly in the parasagittal region.</p>\n<p>Option D: Oligodendroglioma is exclusively found in the cerebral hemispheres, most commonly in the frontal lobes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/649fc66af9fa4163b401a00b01cb7f41.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man is diagnosed with amnesia. Which of the following will not be impaired in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Melody of favourite song"
      },
      {
        "id": 2,
        "text": "Route navigation"
      },
      {
        "id": 3,
        "text": "Ability to drive a bicycle"
      },
      {
        "id": 4,
        "text": "Name of pet bird growing up"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The ability to drive a bicycle will <strong>not</strong> be impaired in this patient with <strong>amnesia</strong>.</p>\n<p>The ability to drive a bicycle is a <strong>non-declarative memory</strong> and non-declarative memory is preserved in amnesia.</p>\n<p><strong>Non-declarative memory</strong> includes:</p>\n<ul>\n<li>Skill learning</li>\n<li>Habit learning</li>\n<li>Simple forms of conditioning</li>\n</ul>\n<p><strong>Declarative memory\u00a0</strong>supports the conscious recollection of facts and events.</p>\n<ul>\n<li>Memory for routes, lists, faces, melodies, objects</li>\n<li>Memory for other verbal and nonverbal material</li>\n</ul>\n<p>Memory of the melody of his favourite song, name of pet bird growing up and route navigation are all types of declarative memory.This is impaired in amnesia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old man who underwent surgery for appendicitis was given a high dose of opioids postoperatively to relieve the pain. But within few hours,  a fall in SpO2 and respiratory rate were noted. Which of the following drugs has been accepted as standard therapy in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Naloxone"
      },
      {
        "id": 2,
        "text": "Sevoflurane"
      },
      {
        "id": 3,
        "text": "Barbiturate"
      },
      {
        "id": 4,
        "text": "Diazepam"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of&nbsp;<strong>opioid-induced respiratory depression&nbsp;</strong>and&nbsp;<strong>Naloxone</strong> has been accepted as standard therapy in this patient.</p>\n<p>Opioid-induced respiratory depression is mediated by the action on <strong>&micro; receptors (&micro;2) </strong>in the brainstem respiratory centers.&nbsp;Naloxone is an <strong>opioid antagonist,</strong> which can <strong>reverse</strong> the respiratory depression induced by opioids.</p>\n<p>Respiratory depression can be prolonged when opioids are taken with other CNS depressant substances like alcohol, barbiturates, benzodiazepines, inhalational anesthetics, and other sedative-hypnotics.</p>\n<p>However, <strong>droperidol, scopolamine, and clonidine</strong>&nbsp;<strong>do not enhance the respiratory depressant effects</strong> of fentanyl&nbsp;or other opioids.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young girl comes to the opd with complaints of nodules on her hair shafts as seen in the image below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Black piedra"
      },
      {
        "id": 2,
        "text": "White piedra"
      },
      {
        "id": 3,
        "text": "Tinea capitis"
      },
      {
        "id": 4,
        "text": "Tinea nigra"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows irregular white nodules along the hair shafts suggestive of <strong>white piedra</strong>.</p>\n<p>Piedra is a superficial fungal infection of the hair shaft. It is of two types:</p>\n<ul>\n<li><strong>White piedra: </strong>It is characterized by the presence of soft, white or light brown transparent nodules that are easily detached from the hair. It affects pubic, axillary, facial hair more commonly than scalp hair. It is caused by Trichosporon beigelii.</li>\n<li><strong>Black piedra:</strong> It is characterized by the presence of firmly adherent, black, gritty, hard nodules along the hair shaft. It affects the scalp hair most often. It is caused by Piedraia hortae.</li>\n</ul>\n<p>It is usually asymptomatic<strong>. </strong>Management involves cutting off the affected hair and usage of topical antifungals.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/829e36c041eb4636a27f2ee3fca67e90.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44a2dda46db842c290d17ba96ee155d2x238x238.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/aa6734e0a4d448eb91a932fe8a19751bx216x216.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1cb4208930db4a3fa0b84df914856db3x273x204.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8c647f2fe8e14097bc781f193c377056x283x212.JPEG"
    ]
  },
  {
    "text": "The clinical application of the effect shown below is -",
    "choices": [
      {
        "id": 1,
        "text": "Imaging for abdominal pathology"
      },
      {
        "id": 2,
        "text": "Radiotherapy for CNS malignancies"
      },
      {
        "id": 3,
        "text": "Imaging for CNS pathology"
      },
      {
        "id": 4,
        "text": "Both B and C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>Bragg peak effect</strong> is pronounced for protons.&nbsp;Proton therapy therefore allows to <strong>target tumors</strong> inside the body, precisely <strong>localize the radiation dosage</strong> and <strong>spare the patient&rsquo;s healthy cells</strong>, offering a much less invasive alternative to treat cancer.</p>\n<p><strong>Protons and the Bragg peak effect:</strong></p>\n<p>The Bragg curve plots the energy loss of ionizing radiation during its travel through matter.</p>\n<p>The proton is a heavy and charged particle that gradually loses its speed as it interacts with human tissue. It is easily controlled and delivers its maximum dose at a precise depth and can go as far as 32 cm. The proton is very fast when it enters the patient&rsquo;s body and deposits only a small dose on its way. The absorbed dose increases very gradually with greater depth and lower speed, suddenly rising to a peak when the proton is ultimately stopped. This is known as the Bragg peak. The behavior of the proton can be precisely determined and the beam can be directed so the Bragg peak occurs exactly within the tumor site. Immediately after this burst of energy, the proton completely stops to irradiate and the particles come to rest.&nbsp;</p>\n<p>Proton therapy therefore allows to <strong>target tumors</strong> <strong>inside the body,</strong> <strong>precisely localize the radiation dosage</strong> and <strong>spare the patient&rsquo;s healthy cells</strong>, offering a much less invasive alternative to treat cancer.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e64a2553bff0433e802fdc4734d24070.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62c4f6d692354217afdc5a9e9ef3ce48x1280x901.JPEG"
    ]
  }
];
        let quizName = 'Fmge Mini Test - 020';
        const quizFilename = 'fmge-mini-test-020-f6ee6726.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2022"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>