<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>001 Anatomy Aiims 2017 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Anatomy
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Nucleus pulposus is derived from ____________.",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Nucleus pulposus</strong> is derived from the <strong>notochord&nbsp;</strong>(marked as 1).</p>\n<p>The other labelled structures are</p>\n<p>2 - Ectoderm<br />3 - Endoderm<br />4 - Intraembryonic mesoderm</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d74387d8592a4c6c80bca98e01cf6b98.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the origin of the fibers marked by the arrow?",
    "choices": [
      {
        "id": 1,
        "text": "Hippocampus"
      },
      {
        "id": 2,
        "text": "Habenular"
      },
      {
        "id": 3,
        "text": "Mamillary body"
      },
      {
        "id": 4,
        "text": "Amygdala"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The arrow indicates the <strong>fornix</strong>. It arises <strong>from the hippocampus</strong> and <strong>ends in the mamillary body </strong>of the hypothalamus.</p>\n<p><strong>Fornix</strong> is an example of <strong>association fiber</strong>.&nbsp;It is supplied by the <strong>anterior cerebral artery.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3d59da4b62e5451bb4fab3ddddb335c0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Among the following, what is the function of the marked muscles?",
    "choices": [
      {
        "id": 1,
        "text": "Depression"
      },
      {
        "id": 2,
        "text": "Protrusion"
      },
      {
        "id": 3,
        "text": "Elevation"
      },
      {
        "id": 4,
        "text": "Retraction"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The muscle marked in the above image is the<strong> lateral pterygoid</strong> muscle and its <strong>primary</strong> function is\u00a0<strong>depression</strong> of the mandible (opening of the mouth).\u00a0</p>\n<p><strong>Bilateral contraction</strong> of the <strong>lateral pterygoid alone</strong> causes <strong>depression</strong> of the mandible (making it the primary function) whereas, <strong>protrusion</strong> is the result of bilateral contraction of both the <strong>medial and lateral pterygoid</strong> muscles.\u00a0</p>\n<p>The lateral pterygoid has the following actions:</p>\n<ol>\n<li><strong>Opening of the jaw (depression)</strong>:\u00a0Lateral pterygoid has a <strong>specialized role in mandibular opening</strong>\u00a0mediated by its <strong>horizontal fibres</strong>.\u00a0When left and right lateral pterygoid muscles contract together, the mandibular condyle is pulled forwards and slightly downwards. This protrusive movement alone has little or no function except in assisting the <strong>opening of the jaw\u00a0</strong>(Gray's Anatomy 41st edition).</li>\n<li><strong>Side-to-side movement</strong>: When the lateral pterygoid contracts unilaterally along with the adjacent medial pterygoid the jaw is pulled medially. This is used for grinding food between teeth of the same side. This action is mediated by the <strong>inferior head of the lateral pterygoid</strong>.\u00a0\u00a0</li>\n</ol>\n<p>\u00a0</p>\n<table>\n<tbody>\n<tr>\n<td width=\"179\"><strong>Muscles of mastication\u00a0</strong></td>\n<td width=\"196\">\n<p><strong>Nerve supply</strong></p>\n</td>\n<td width=\"249\">\n<p><strong>Action (On mandible)</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Temporalis</p>\n</td>\n<td width=\"196\">\n<p>Mandibular nerve (CN V3)</p>\n</td>\n<td width=\"249\">\n<p>Elevation</p>\n<p>Retraction (posterior fibers)</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Masseter</p>\n</td>\n<td width=\"196\">\n<p>Mandibular nerve (CN V3)</p>\n</td>\n<td width=\"249\">\n<p>Elevation</p>\n<p>Protrusion (superficial fibers)</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Lateral pterygoid</p>\n</td>\n<td width=\"196\">\n<p>Mandibular nerve (CN V3)</p>\n</td>\n<td width=\"249\">\n<p>Depression</p>\n<p>Swinging of Jaw(unilaterally)</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Medial pterygoid</p>\n</td>\n<td width=\"196\">\n<p>Mandibular nerve (CN V3)</p>\n</td>\n<td width=\"249\">\n<p>Elevation</p>\n<p>Protrusion</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p><strong>Suprahyoid muscles</strong></p>\n</td>\n<td width=\"196\">\n<p><strong>\u00a0</strong></p>\n</td>\n<td width=\"249\">\n<p><strong>\u00a0</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Digastric</p>\n</td>\n<td width=\"196\">\n<p>Facial nerve (CN VII),</p>\n<p>Mandibular nerve (CN V3)</p>\n</td>\n<td width=\"249\">\n<p>Depression of mandible and elevation of hyoid bone</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Stylohyoid</p>\n</td>\n<td width=\"196\">\n<p>Facial nerve (CN VII)</p>\n</td>\n<td width=\"249\">\n<p>Elevation of hyoid bone</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Mylohyoid</p>\n</td>\n<td width=\"196\">\n<p>Mandibular nerve (CN V3)</p>\n</td>\n<td width=\"249\">\n<p>\u00a0Elevation of hyoid bone</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Geniohyoid</p>\n</td>\n<td width=\"196\">\n<p>Nerve to geniohyoid</p>\n</td>\n<td width=\"249\">\n<p>Depression of mandible and elevation of hyoid bone</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p><strong>Infrahyoid muscles</strong></p>\n</td>\n<td width=\"196\">\n<p><strong>\u00a0</strong></p>\n</td>\n<td width=\"249\">\n<p><strong>\u00a0</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Omohyoid</p>\n</td>\n<td width=\"196\">\n<p>Ansa cervicalis (C1-C3)</p>\n</td>\n<td width=\"249\">\n<p>Fixes or depresses hyoid bone</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Sternohyoid</p>\n</td>\n<td width=\"196\">\n<p>Ansa cervicalis (C1-C3)</p>\n</td>\n<td width=\"249\">\n<p>Fixes or depresses hyoid bone</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Sternothyroid</p>\n</td>\n<td width=\"196\">\n<p>Ansa cervicalis (C1-C3)</p>\n</td>\n<td width=\"249\">\n<p>Draws thyroid cartilage downwards</p>\n</td>\n</tr>\n<tr>\n<td width=\"179\">\n<p>Thyrohyoid</p>\n</td>\n<td width=\"196\">\n<p>C1 via hypoglossal nerve (CN XII)</p>\n</td>\n<td width=\"249\">\n<p>Fixes or depresses hyoid bone</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68e81ea0b9f8487e92568c4eadab3522.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the marked foramen does the mandibular division of the trigeminal nerve pass through?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>mandibular nerve</strong> passes through the <strong>foramen ovale</strong> which is marked as A in the above image.&nbsp;</p>\n<p>Other foramina marked in the above image:</p>\n<p>B - Foramen spinosum</p>\n<p>C - Internal acoustic meatus</p>\n<p>D - Jugular foramen</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/afe1220251a8474da41fc3734d19261b.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The structure marked  with the asterisk in the electron micrograph indicates _____________.",
    "choices": [
      {
        "id": 1,
        "text": "Mitochondria"
      },
      {
        "id": 2,
        "text": "Golgi bodies"
      },
      {
        "id": 3,
        "text": "Secretory vesicles"
      },
      {
        "id": 4,
        "text": "Ribosomes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Ribosomes</strong> may be attached to the membrane of the rough endoplasmic reticulum (as shown in the image below), or else, they may exist as monosomes or as a chain of granular structures called <strong>polyribosomes&nbsp;</strong>associated with mRNA.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ed668b1c5cd7482aa4c00cd8cd71a443.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/077963b672064b52b0fbffe2ddf2ab80x1280x1167.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e62db2275ce4fa7a4c1cdfcd5d21bb6x1280x764.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/680a3f8672f148c5af58380f88796b7cx1280x817.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/04c52c4313b54d90adaa5735df80391cx1280x1996.JPEG"
    ]
  },
  {
    "text": "In the image given below, identify the muscle responsible for the opening of the mouth.",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given image the structure marked B represents the <strong>lateral pterygoid</strong> muscle which is&nbsp;responsible for the<strong> opening of the mouth.</strong></p>\n<p><strong>Lateral pterygoid:</strong></p>\n<ul>\n<li>Origin -\n<ul>\n<li>Upper head - Infratemporal surface and infratemporal crest of the greater wing of the sphenoid bone.</li>\n<li>Lower head - <strong>L</strong><strong>ateral surface</strong>&nbsp;of the&nbsp;<strong>lateral pterygoid plate.&nbsp;</strong></li>\n</ul>\n</li>\n<li>Insertion - It is inserted into the pterygoid fovea, capsule of the temporomandibular joint, and the articular disc.</li>\n<li>Nerve supply - Lateral pterygoid nerve which is a branch of the <strong>trigeminal nerve</strong>.</li>\n</ul>\n<p>Other structures marked:</p>\n<p>A - Temporalis</p>\n<p>C - Masseter</p>\n<p>D -&nbsp;Medial pterygoid</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cf50347e68964cd0901cbe0f38029669.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3227ac422404c6786295982bb2c744bx1280x1401.JPEG"
    ]
  },
  {
    "text": "Identify the structure passing through the foramen marked.",
    "choices": [
      {
        "id": 1,
        "text": "Abducens nerve"
      },
      {
        "id": 2,
        "text": "Spinal accessory nerve"
      },
      {
        "id": 3,
        "text": "Ophthalmic artery"
      },
      {
        "id": 4,
        "text": "Middle meningeal artery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked foramen is the&nbsp;<strong>superior orbital fissure </strong>and&nbsp;the<strong> a</strong><strong>bducens nerve</strong> passes through it.</p>\n<p>The abducens nerve is the <strong>6th cranial nerve</strong>&nbsp;and arises from the brainstem at the <strong>pontomedullary</strong> junction. It runs through the <strong>Dorello's canal</strong> which is present at the medial most end of the petrous ridge and then enters the cavernous sinus where it lies lateral to the internal carotid artery. It enters the orbit through the <strong>superior orbital fissure</strong> within the common tendinous ring and supplies the <strong>lateral rectus</strong>.</p>\n<p>&nbsp;</p>\n<p>Other options:</p>\n<p><strong>Spinal accessory nerve&nbsp;</strong>passes through the&nbsp;<strong>foramen magnum&nbsp;</strong>along with the&nbsp;<strong>medulla oblongata&nbsp;</strong>and the&nbsp;<strong>verterbral arteries</strong></p>\n<p><strong>Ophthalmic artery&nbsp;</strong>passes through the&nbsp;<strong>optic canal&nbsp;</strong>along with the&nbsp;<strong>optic nerve.</strong></p>\n<p><strong>Middle meningeal artery&nbsp;</strong>and vein&nbsp;pass through the&nbsp;<strong>foramen spinosum&nbsp;</strong>along with the&nbsp;<strong>meningeal branch of mandibular nerve.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2c46783e8f6946c28787b328366d789d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The talocalcaneonavicular joint is a ________type of joint.",
    "choices": [
      {
        "id": 1,
        "text": "Ball and Socket"
      },
      {
        "id": 2,
        "text": "Saddle type"
      },
      {
        "id": 3,
        "text": "Plane"
      },
      {
        "id": 4,
        "text": "Ellipsoid"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The talocalcaneonavicular joint is a <strong>ball and socket joint</strong>.</p>\n<ul>\n<li>The <strong>ball</strong> part is formed by the&nbsp;rounded<strong> head</strong> of the<strong> talus</strong>.</li>\n<li>The <strong>socket</strong> is formed by 3 structures:\n<ul>\n<li>Posterior surface of the<strong> navicular</strong></li>\n<li>Anterior articular surface of the<strong> calcaneus</strong></li>\n<li>Upper surface of the<strong> plantar calcaneonavicular ligament</strong> (spring ligament).</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/97e73a759036440fab353f3632d95573x599x490.JPEG"
    ]
  },
  {
    "text": "Which of the following is connected to the structure marked as A in the image below?",
    "choices": [
      {
        "id": 1,
        "text": "Orbital cortex"
      },
      {
        "id": 2,
        "text": "Hippocampus"
      },
      {
        "id": 3,
        "text": "Striate cortex"
      },
      {
        "id": 4,
        "text": "Optic chiasma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked A is the&nbsp;<strong>splenium of the corpus callosum </strong>and it is connected to the&nbsp;<strong>striate cortex.</strong></p>\n<p>The <strong>body </strong>of the corpus callosum arches posteriorly and ends as the thickened posterior portion called the <strong>splenium.&nbsp;</strong>The fibers from the splenium form the&nbsp;<strong>forceps major</strong> and arch backward into the <strong>occipital lobe (striate cortex).</strong></p>\n<p>The <strong>hippocampus </strong>is&nbsp;not connected directly to the<strong> splenium, </strong>but situated&nbsp;<strong>inferior </strong>to the splenium.</p>\n<p>The image given below shows the parts of the corpus callosum.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3f02994eb244448ea875cd193d33a013.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/549704a53dcd4aa58d4d753824d47523x1280x1056.JPEG"
    ]
  },
  {
    "text": "The structure passing through the central tendon of the diaphragm is:",
    "choices": [
      {
        "id": 1,
        "text": "Oesophagus"
      },
      {
        "id": 2,
        "text": "Aorta"
      },
      {
        "id": 3,
        "text": "Inferior vena cava"
      },
      {
        "id": 4,
        "text": "Sympathetic Chain"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>inferior vena cava</strong> passes through the <strong>central tendon of the diaphragm</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53e0cadbe05649db9d15da8a233616d8x1279x1382.JPEG"
    ]
  },
  {
    "text": "Shape of Trapezius muscle is ________________",
    "choices": [
      {
        "id": 1,
        "text": "Triangular"
      },
      {
        "id": 2,
        "text": "Quadrilateral"
      },
      {
        "id": 3,
        "text": "Pentagonal"
      },
      {
        "id": 4,
        "text": "Linear"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The trapezius is a broad, flat and triangular muscle</p>\n<p>Trapezius muscle shape:</p>\n<ul>\n<li>considering left or right side - triangular shape&nbsp;</li>\n<li>considering both sides together - diamond shaped, hence named&nbsp;&ldquo;trapezius&rdquo;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/99f0db210a07405b92791bb9a07a8385x380x599.PNG"
    ]
  },
  {
    "text": "All of the following are true about grey rami communicantes except:",
    "choices": [
      {
        "id": 1,
        "text": "Unmyelinated"
      },
      {
        "id": 2,
        "text": "Connected to spinal nerve"
      },
      {
        "id": 3,
        "text": "Preganglionic"
      },
      {
        "id": 4,
        "text": "Present medial to white rami communicantes"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> grey rami communicantes </strong>are not preganglionic fibers. They are <strong>postganglionic fibers</strong>.</p>\n<p>The sympathetic trunks on either side of the vertebral columns consist of a series of ganglia. They are connected to the spinal nerves by white and grey rami communicantes. The cell bodies of the <strong>preganglionic sympathetic neurons</strong> are located in the lateral horn in the spinal grey matter. They leave the cord in the ventral nerve roots to form <strong>spinal nerves</strong>. These fibers enter the sympathetic trunk in <strong>white rami communicantes. </strong>They synapse with the <strong>postganglionic sympathetic neurons</strong> in the sympathetic ganglia. The axons of the postganglionic neurons\u00a0return to the spinal nerve through the\u00a0<strong>grey rami communicantes.\u00a0</strong></p>\n<table style=\"height: 252px; width: 425px;\">\n<tbody>\n<tr>\n<td style=\"width: 120px;\">Fibers</td>\n<td style=\"width: 126px;\"><strong>White rami communicantes</strong></td>\n<td style=\"width: 157px;\"><strong>Grey rami communicantes</strong></td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Location</td>\n<td style=\"width: 126px;\">Preganglionic</td>\n<td style=\"width: 157px;\">Postganglionic</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Myelination</td>\n<td style=\"width: 126px;\">Myelinated</td>\n<td style=\"width: 157px;\">Unmyelinated</td>\n</tr>\n<tr>\n<td style=\"width: 120px;\">Principal neurotransmitter</td>\n<td style=\"width: 126px;\">Acetylcholine</td>\n<td style=\"width: 157px;\">Noradrenaline</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6e25b56bd7a44f719f16657175a3d5a2x1280x1459.JPEG"
    ]
  },
  {
    "text": "Which of the following represents a holocrine gland?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The histopathological image marked <strong>&lsquo;B&rsquo;</strong> represents the <strong>sebaceous gland,</strong> which is a type of <strong>holocrine gland</strong>.</p>\n<p>Holocrine secretions are produced in the cytoplasm of the cell and released by the rupture of the plasma membrane, which <strong>destroys the cell</strong> and results in the secretion of the product into the lumen.</p>\n<p>Examples of holocrine glands are</p>\n<ul>\n<li><strong>Sebaceous glands</strong> of the skin and</li>\n<li><strong>Meibomian glands</strong> of the eyelid</li>\n</ul>\n<p>Image A: Sweat glands - Eccrine/merocrine glands; glands remain intact</p>\n<p>Image C: Mammary gland - Apocrine gland; apical part sheds to secrete</p>\n<p>Image D: Ceruminous gland - Apocrine glands</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fbf528c363fd447cb259d01600b35653.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following structures marked in the below image gives rise to the heart in an adult?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "C"
      },
      {
        "id": 3,
        "text": "B"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The structure marked &lsquo;<strong>C</strong>&rsquo; in the above image depicts the <strong>heart bulge.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/be3ef8e0b4ef43febf15e8047bd469b6.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/46c9d3d0e48a4c8d94efe51c32b7970bx1024x768.JPEG"
    ]
  },
  {
    "text": "A 58-year-old woman was undergoing cholecystectomy. During the procedure, the resident accidentally advanced the scissors along the superior border of the epiploic foramen causing injury. Which of the following structures is likely to be injured?",
    "choices": [
      {
        "id": 1,
        "text": "Right lobe of liver"
      },
      {
        "id": 2,
        "text": "Quadrate lobe of liver"
      },
      {
        "id": 3,
        "text": "Caudate lobe of liver"
      },
      {
        "id": 4,
        "text": "Fundus of gall bladder"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Clinical note: <strong>Pringle maneuver </strong>(as shown below) is a technique where the free margin of the lesser omentum is compressed to obtain rapid control of <strong>bleeding</strong> from the <strong>hepatic artery </strong>and<strong> portal vein</strong> in liver trauma and surgery.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8622b23884d94d68936bea98ab57fb1ex720x569.GIF"
    ]
  },
  {
    "text": "Which of the following structures does the cell pointed in arrow inhibit?",
    "choices": [
      {
        "id": 1,
        "text": "Vestibular nuclei"
      },
      {
        "id": 2,
        "text": "Anterior horn of spinal"
      },
      {
        "id": 3,
        "text": "Basal ganglia"
      },
      {
        "id": 4,
        "text": "Deep nuclei of cerebellum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows a histopathological section of the <strong>cerebellum.</strong>&nbsp;The cells marked with the arrow are<strong> Purkinje cells </strong>and they&nbsp;<strong>inhibit deep nuclei</strong> of the cerebellum.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e940abf2e54740389ec12805f147a230.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "The image below shows the insertion of transversus abdominis muscle. Identify the conjoint tendon:",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked C is the conjoint tendon.</p>\n<p>The <strong>conjoint tendon</strong> is formed from the lower fibres of <strong>internal oblique</strong> and the lower part of the <strong>aponeurosis of transversus</strong> <strong>abdominis</strong>. It is attached to the pubic crest and extends to a variable extent along the pectineal line.</p>\n<p>Transversus Abdominis muscle&nbsp;</p>\n<p>Origin: internal surface of 7th -12th costal cartilages, thoracolumbar fascia, iliac crest, connective tissue deep to lateral third of inguinal ligament.</p>\n<p>Insertion: Linea Alba with aponeurosis of internal oblique, pubic crest, and pecten pubis<strong> via the conjoint tendon.</strong></p>\n<p>A: Lumbar fascia <br />B: Transversus Abdominis<br />D: Inguinal Ligament</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d51a9f09fa53465780d64d0b7d25d32a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What represents the marked area in the given histology of lymph node?",
    "choices": [
      {
        "id": 1,
        "text": "Marginal zone"
      },
      {
        "id": 2,
        "text": "Paracortical zone"
      },
      {
        "id": 3,
        "text": "Germinal center"
      },
      {
        "id": 4,
        "text": "Mantle zone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The area marked in the image is the <strong>m</strong><strong>antle zone</strong> of a lymph node.</p>\n<p>Lymph node has primary follicle composed of small, quiescent lymphocytes, and a secondary follicle with&nbsp;<strong>germinal centre</strong> composed mainly of antigen-stimulated B cells.</p>\n<p>The <strong>mantle zone</strong> is produced as surrounding cells are marginalised by the rapidly growing germinal centre. It is populated by mainly quiescent B cells with condensed heterochromatic nuclei and little cytoplasm (hence the<strong> deeply basophilic staining</strong> of this region in routine preparations), a few helper T cells, Follicular Dendritic cells and macrophages.</p>\n<p>In peripheral lymph nodes, the <strong>marginal zone</strong>&nbsp;are often inapparent because they are mixed with the mantle zone cells. And often not well developed in lymph nodes.</p>\n<p>The <strong>paracortex</strong> lies between the cortical follicles and the medulla and is populated mainly by T cells, which are not organised into follicles</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4d5d9d12be56430a9eed62165cb8fb3d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7b5bb3486ec41b4bc2f4fd1285bdb5ax1060x843.JPEG"
    ]
  },
  {
    "text": "A young patient presented with hypoparathyroidism, absent thymus and tetany. Which of the following marked areas in the picture is defective in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>DiGeorge syndrome</strong> is a complex embryopathy that is caused by the hemizygous interstitial deletion of <strong>chromosome 22</strong>. It is characterized by&nbsp;multiple developmental defects, including conotruncal defects, hypoparathyroidism, and dysmorphic syndrome. It is also known as <strong>velocardiofacial syndrome </strong>(palate, facial, and cardiac defects).</p>\n<p>It has variable presentations including<strong> C</strong>left palate, <strong>A</strong>bnormal facies, <strong>T</strong>hymic aplasia leading to T-cell deficiency, <strong>C</strong>ardiac defects, and <strong>H</strong>ypocalcemia secondary to parathyroid aplasia&nbsp;(<strong>CATCH-22</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3370bdf51c104570aa5589ddedc3fd25.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2b24f18f032e41228225ae8a98781baax1280x1407.JPEG"
    ]
  },
  {
    "text": "A patient came with complaints of inability to move his 4th and 5th digit, cannot hold a pen and he was not able to hold a paper between fingers. Which of the following sites given below is the probable cause of injury to the nerve in question?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Option A: It is the <strong>radial groove</strong> where <strong>radial nerve</strong> runs along with profunda brachii artery.</p>\n<p>Option D: It is the <strong>neck of humerus</strong> where <strong>axillary nerve</strong> runs around.</p>\n<p>Option B: It is the <strong>lateral epicondyle</strong>. Fracture of this part may lead to <strong>tardy ulnar nerve palsy</strong>, but incidence is less.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49925339e6fc47d8bae1fbac41054488.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/688511e3b2d44422b868a4d982e79576x1280x1359.JPEG"
    ]
  },
  {
    "text": "Which of the following structures of the scapula is palpable in the infraclavicular fossa?",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The part of the scapula marked as \"<strong>A</strong>\" in this image is <strong>palpable</strong> and it is the <strong>coracoid process.</strong></p>\n<p>The apex of the coracoid process lies approximately <strong>2.5cm below</strong> the <strong>clavicle,</strong> immediately lateral to the infraclavicular fossa <strong>(deltopectoral triangle).&nbsp;</strong>Hence, the coracoid process can be palpated below the clavicle.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/05739eab342443de87b2a0f32f27c86a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/513cc844f1b14e08a1acb4ec45330d50x1280x1348.JPEG"
    ]
  },
  {
    "text": "Identify the pelvic diaphragm in the picture given below.",
    "choices": [
      {
        "id": 1,
        "text": "A"
      },
      {
        "id": 2,
        "text": "B"
      },
      {
        "id": 3,
        "text": "C"
      },
      {
        "id": 4,
        "text": "D"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Levator ani is formed by:</p>\n<ul>\n<li>Pubococcygeus</li>\n<li>Iliococcygeus</li>\n<li>Puborectalis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7226644810354f00be60c6cca24a4010.PNG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/bc64c2e8918341d08037fe8aa2c5515cx536x351.JPEG",
      "https://cdn1.dailyrounds.org/uploads/6dd2fbc2e4d44809aa905459c6d0a868x682x412.JPEG"
    ]
  },
  {
    "text": "What is the root value of cremasteric reflex?",
    "choices": [
      {
        "id": 1,
        "text": "L1,L2"
      },
      {
        "id": 2,
        "text": "L3,L4"
      },
      {
        "id": 3,
        "text": "S1,S2"
      },
      {
        "id": 4,
        "text": "T8,T9"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<table style=\"height: 394px; width: 391px;\">\n<tbody>\n<tr>\n<td style=\"width: 176px;\"><strong>Deep reflexes</strong></td>\n<td style=\"width: 199px;\"><strong>Superficial reflexes</strong></td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Biceps - <strong>C5</strong>, C6</td>\n<td style=\"width: 199px;\">Corneal - CN V(A) - CN VII(E) - Pons</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Brachioradialis - C5, C6</td>\n<td style=\"width: 199px;\">Conjunctival - CN V (A) - CN VII(E) - Pons</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Triceps - C6, C7</td>\n<td style=\"width: 199px;\">Scapular - C5, T1</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Finger flexion - C8</td>\n<td style=\"width: 199px;\">Abdominal - T7-T12</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Knee jerk - L3, <strong>L4</strong></td>\n<td style=\"width: 199px;\">Anal - S3, S4</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Ankle - <strong>S1</strong>, S2</td>\n<td style=\"width: 199px;\">&nbsp;Cremastric - <strong>L1</strong>, L2</td>\n</tr>\n<tr>\n<td style=\"width: 176px;\">Jaw jerk - CN V (Pons)</td>\n<td style=\"width: 199px;\">&nbsp;Plantar - L5&nbsp;<strong>S1</strong></td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '001 Anatomy Aiims 2017';
        let hierarchy = ["Marrow", "PYQs", "Anatomy"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>