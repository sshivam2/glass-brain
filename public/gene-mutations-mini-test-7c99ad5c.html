<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gene Mutations Mini Test - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / FMGE Mini Test Series / 2025
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "An 8-year-old boy was brought for psychiatric evaluation for intellectual disability. On examination, his IQ was 45. He has a long face, large ears, and macroorchidism. What is the trinucleotide repeat mutation associated with this syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "CGG"
      },
      {
        "id": 2,
        "text": "GAA"
      },
      {
        "id": 3,
        "text": "CAG"
      },
      {
        "id": 4,
        "text": "CTG"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above clinical vignette is suggestive of <strong>Fragile X syndrome. </strong>The specific trinucleotide repeat sequence in Fragile X syndrome is <strong>CGG.</strong></p>\n<p>Fragile X syndrome is the most common genetic cause of <strong>intellectual disability</strong> after Down's syndrome. It is due to the mutation in the familial mental retardation 1 gene <strong>(FMR1)</strong> located on the long arm of the<strong> X chromosome</strong>. When cells are cultured in a folate-deficient medium, the cytogenetic alteration was observed as a breach in the staining on the long arm of chromosome X. Since the chromosome appears as broken, it is termed fragile X.</p>\n<p>It is associated with the phenomenon of anticipation, where the disease phenotype worsens over generations within a family. The <strong>affected</strong> males are <strong>intellectually disabled,</strong> with an IQ in the range of <strong>20 to 60.</strong> Neuropsychiatric features include aggressive behaviour, autism spectrum disorder, epilepsy, and anxiety/hyperactivity disorders.</p>\n<p>The characteristic phenotypic features include the following:</p>\n<ul>\n<li><strong>Long face</strong> with a <strong>large mandible</strong></li>\n<li><strong>Large everted ears</strong></li>\n<li><strong>Macro-orchidism (large testicles)</strong></li>\n<li>Hyperextensible joints</li>\n<li>High-arched palate</li>\n<li>Mitral valve prolapse</li>\n</ul>\n<p>The given image shows the facial features of Fragile X syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/383007449453411fbf1b0b514c8aa86bx1200x887.JPEG"
    ]
  },
  {
    "text": "A patient presented with reduced levels of high-density lipoprotein, and ABCA1 mutation. On examination, tonsils appeared as shown in the image. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tangier's disease"
      },
      {
        "id": 2,
        "text": "Abetalipoproteinemia"
      },
      {
        "id": 3,
        "text": "Hyperlipoproteinemia"
      },
      {
        "id": 4,
        "text": "Wolman's disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The diagnosis in this case with\u00a0reduced levels of high-density lipoprotein (HDL),\u00a0<strong>ABCA1 mutation,</strong> and\u00a0<strong>orange tonsils </strong>on examination is\u00a0<strong>Tangier's disease.</strong>\u00a0It is caused by a defect in ABCA1 receptors.</p>\n<p>ABCA1 plays a role in the <strong>efflux of cholesterol</strong> from <strong>peripheral cells</strong> of<strong> HDL</strong>. LCAT (lecithin cholesterol acyltransferase) converts cholesterol to cholesterol esters, which accumulate in the core of HDL. Thus, defective ABCA1 will lead to low levels of HDL in the blood.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>Abetalipoproteinemia</strong> is a hypolipoproteinemia caused by a defect in the MTP gene. Here, loading apolipoprotein B with lipids is defective. Hence, few very low density-lipoproteins (VLDLs) or chylomicrons are formed, leading to the accumulation of\u00a0<strong>triacylglycerols</strong>\u00a0in the liver and intestine.</p>\n<p>Option C:\u00a0<strong>Hyperlipoproteinemia</strong> is a disorder that causes the body to metabolize lipids incorrectly. This results in hyperlipidemia and can lead to the development of multiple small xanthomas in the skin.</p>\n<p>Option D:<strong>\u00a0Acid lipase\u00a0deficiency</strong> can lead to\u00a0<strong>Wolman's disease</strong>\u00a0which is a lysosomal storage disease. The pathognomic feature of this condition is\u00a0<strong>adrenal calcification</strong>. So patients generally present with adrenal insufficiency and are neonates.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1cbe321588284db490d821ff2befcb73.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old female presented with low Hb, platelet count of 25000/mm3, raised PT and aPTT. Peripheral smear findings are given below. Which of the following fusion genes is affected?",
    "choices": [
      {
        "id": 1,
        "text": "BCR ABL"
      },
      {
        "id": 2,
        "text": "IGH NSD2"
      },
      {
        "id": 3,
        "text": "RUNX1 RUNX1T1"
      },
      {
        "id": 4,
        "text": "PML RARA"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image showing numerous <strong>Auer rods</strong> and the lab findings pointing towards <strong>DIC</strong> are suggestive of acute myeloid leukaemia - <strong>M3</strong> or <strong>acute promyelocytic leukaemia</strong>. The pathogenesis behind this is the <strong><em>PML-RARA</em> fusion gene or translocation t(15,17).</strong></p>\n<p>AML-M3, or acute promyelocytic leukemia, is a <strong>subtype </strong>of acute myeloid leukemia associated with PML-RAR\u0251 fusion gene or t(15;17). The patient presents with <strong>fever, fatigue,</strong> and <strong>weight loss</strong>. On examination, findings consistent with<strong> anemia (pallor)</strong> and <strong>thrombocytopenia (easy bruising)</strong> are seen. This is due to the accelerated destruction of RBC and platelet precursors in the bone marrow.\u00a0</p>\n<p>Histopathology of the bone marrow aspirate reveals <strong>numerous Auer rods</strong> (needle-like azurophilic granules) in the cytoplasm of the promyelocytes. Sometimes, multiple Auer rods cluster together within a single cell resembling a bundle of sticks. Such cells have been termed <strong>faggot cells </strong>(faggot in French means bundle of sticks).</p>\n<p>The condition is associated with a high incidence of <strong>disseminated intravascular coagulation (DIC).</strong></p>\n<p>Treatment includes the administration of <strong>all-trans retinoic acid.</strong></p>\n<p>Other options:</p>\n<p>Option A:<strong> CML</strong> is a myeloproliferative neoplasm. It is caused by <strong>BCR (on chromosome 22)</strong> - <strong>ABL (on chromosome 9)</strong> fusion gene translocation mutation. It results in the formation of the <strong>Philadelphia chromosome.</strong></p>\n<p>Option B: <strong>Multiple myeloma</strong> patients are affected by the <strong>translocation t(4;14)</strong> resulting in the<strong> IGH::NSD2</strong> fusion.</p>\n<p>Option C: <strong>AML</strong> with<strong> t(8:21)</strong> shows the <strong>RUNX1/RUNXT1</strong> fusion gene.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8ba1cfb326f14da9a286b15ae8e7a3f6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man is recently diagnosed and treated for familial adenomatous polyposis syndrome. He has a 9-year-old child. The family has been counseled and has agreed for the screening of the child. What is the initial step in screening the child?",
    "choices": [
      {
        "id": 1,
        "text": "Genetic testing for APC gene mutation"
      },
      {
        "id": 2,
        "text": "Genetic testing for MSH-6 gene mutation"
      },
      {
        "id": 3,
        "text": "Routine flexible sigmoidoscopy starting from 10 years of age"
      },
      {
        "id": 4,
        "text": "Routine flexible colonoscopy starting from 20 years of age"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The initial step in screening the child for familial adenomatous polyposis syndrome is to perform<strong> genetic testing</strong> for <strong>APC gene mutation.\u00a0</strong>If screening is positive, <strong>flexible sigmoidoscopy </strong>or colonoscopy is\u00a0done annually starting from<strong> 10 years of age.</strong></p>\n<p>If the APC testing is <strong>negative,</strong> then the risk of developing colorectal carcinoma in the relative is similar to the general population. Hence the screening can be started from <strong>50 years </strong>of age.</p>\n<p>FAP is an <strong>autosomal dominant</strong> condition and is caused due to a mutation in the <strong>APC</strong> gene located on <strong>chromosome 5</strong>. Clinically, patients develop hundreds to thousands of adenomatous polyps in the colon and rectum. <strong>More than 100 colonic adenomas </strong>are diagnostic of FAP. Some patients may also develop duodenal adenomas. The lifetime risk of developing colorectal carcinoma in these patients is 100%.\u00a0</p>\n<p>The extracolonic manifestations of FAP are:</p>\n<ul>\n<li><strong>Endodermal</strong> drerivatives\n<ul>\n<li><strong>Adenomas</strong> and carcinomas of the stomach, duodenum, small intestine, thyroid, and biliary tree</li>\n<li>Fundic gland polyps</li>\n<li>Hepatoblastoma</li>\n</ul>\n</li>\n<li><strong>Ectodermal</strong> derivatives\n<ul>\n<li><strong>Epidermoid cyst</strong></li>\n<li>Pilomatrixoma</li>\n<li>Congenital hypertrophy of the retinal pigment epithelium</li>\n<li>Brain tumors</li>\n</ul>\n</li>\n<li><strong>Mesodermal</strong> derivatives\n<ul>\n<li><strong>Desmoid tumors</strong></li>\n<li><strong>Osteomas</strong></li>\n<li>Dental problems</li>\n</ul>\n</li>\n</ul>\n<p>The treatment of the FAP includes <strong>total proctocolectomy</strong> <strong>with ileal pouch-anal anastomosis (IPAA).</strong></p>\n<p>Variants of FAP are:</p>\n<ul>\n<li><strong>Gardner's syndrome-</strong> it is an <strong>autosomal dominant</strong> variant of FAP. In addition to colonic polyps, the patients will have\n<ul>\n<li>Osteomas of the mandible or skull</li>\n<li>Epidermal cysts</li>\n<li>Soft tissue tumors like desmoid tumor</li>\n</ul>\n</li>\n<li><strong>Turcot's syndrome-</strong> in addition to the colonic polyps the patients will have <strong>central nervous system tumors</strong> (primary brain tumors).</li>\n</ul>\n<p>Note: Hereditary nonpolyposis colorectal cancer <strong>(HNPCC)</strong> syndrome, or <strong>Lynch syndrome</strong> occurs due to defects in DNA mismatch repair genes (MLH1, MSH2, <strong>MSH6,</strong> and PMS2)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Mutation that leads to lung cancer in non smokers_________",
    "choices": [
      {
        "id": 1,
        "text": "KRAS"
      },
      {
        "id": 2,
        "text": "EGFR"
      },
      {
        "id": 3,
        "text": "MYC"
      },
      {
        "id": 4,
        "text": "CDKN2A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p class=\"p1\"><span class=\"s1\"><strong>Lung cancer</strong> in <strong>non-smokers</strong> is more likely due to&nbsp;<strong>EGFR mutation.</strong></span></p>\n<p class=\"p1\"><strong>Adenocarcinoma</strong> is the&nbsp;<strong>most common</strong>&nbsp;subtype in&nbsp;<strong>non-smokers&nbsp;</strong>and&nbsp;is associated with the loss of function of <strong>EGFR</strong>, ALK, ROS1, MET, or RET genes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Type II MSUD results from the mutation in the genes encoding _____.",
    "choices": [
      {
        "id": 1,
        "text": "\u03b1-Ketoacid decarboxylase"
      },
      {
        "id": 2,
        "text": "Dihydrolipoyl transacylase"
      },
      {
        "id": 3,
        "text": "Dihydrolipoamide dehydrogenase"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Type II maple syrup urine disease</strong> (MSUD) results from a mutation in the genes encoding <strong>dihydrolipoyl</strong> <strong>transacylase.</strong></p>\n<p>Maple Syrup Urine Disease is due to the impaired function of various components of the <strong>\u03b1 ketoacid decarboxylase complex.</strong></p>\n<p>There are <strong>4 known types of Maple Syrup Urine Disease:</strong></p>\n<ul>\n<li>Type IA and IB MSUD arise from mutations in the <strong>E1\u03b1 and E1b gene</strong>, which encode the enzyme <strong>\u03b1-Ketoacid decarboxylase.</strong></li>\n<li><strong>Type II</strong> arises from <strong>mutations</strong> in the <strong>E2 gene</strong>, which encodes <strong>dihydrolipoyl</strong> <strong>transacylase</strong>.</li>\n<li>Type III arises from mutations in the <strong>E3 gene</strong>, which encodes <strong>dihydrolipoamide dehydrogenase.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman in the casualty with right leg pain, swelling, and erythema is diagnosed with a DVT. She had a pulmonary embolism six months ago and was treated with warfarin, which was recently stopped. Coagulation assays show insensitivity to activated protein C. What is the likely finding upon further evaluation?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated homocysteine"
      },
      {
        "id": 2,
        "text": "Factor V mutation"
      },
      {
        "id": 3,
        "text": "Prothrombin mutation"
      },
      {
        "id": 4,
        "text": "Antithrombin III deficiency"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient\u2019s presentation of <strong>DVT </strong>and history of<strong> pulmonary embolism</strong>, along with <strong>insensitivity to activated protein C</strong>, strongly suggests a <strong>Factor V Leiden</strong> mutation.</p>\n<p>The mutation occurs in the <strong>Factor V gene</strong> and leads to the production of a Factor V protein that is resistant to inactivation by <strong>activated protein C</strong> (APC). Normally, APC degrades Factor V to prevent excessive clotting, but in individuals with Factor V Leiden, this process is impaired, leading to a higher risk of forming abnormal blood clots.</p>\n<p>Factor V Leiden mutation is the most common<strong> inherited thrombophilia</strong>, which follows an <strong>autosomal dominant</strong> inheritance pattern. <strong>Heterozygous </strong>carriers have a 3 to 8 times increased risk of venous thromboembolism (VTE), while <strong>homozygous</strong> individuals have a significantly higher risk, approximately 50 to 100 times greater.</p>\n<p>Patients with Factor V Leiden are at increased risk for conditions like<strong> deep vein thrombosis</strong> (DVT) and <strong>pulmonary embolism</strong> (PE). The risk is further elevated in situations such as<strong> pregnancy</strong>, <strong>oral contraceptive use</strong>,\u00a0and<strong> prolonged immobilization</strong>.</p>\n<p>The diagnosis is typically confirmed through <strong>genetic testing</strong> for the Factor V Leiden mutation. <strong>Coagulation assays</strong> showing <strong>APC resistance </strong>are also indicative of this condition.</p>\n<p>Management of patients with Factor V Leiden involves <strong>anticoagulation</strong> therapy during episodes of thrombosis. <strong>Long-term anticoagulation</strong> may be considered in patients with<strong> recurrent thrombotic</strong> events or significant <strong>risk factors</strong>. Preventive measures are crucial for high-risk situations to reduce the likelihood of thromboembolic events.</p>\n<p>Other options:</p>\n<p>Option A: While elevated <strong>homocysteine </strong>can increase the risk of thrombosis, it does not cause APC resistance.</p>\n<p>Option C: The <strong>prothrombin gene mutation (G20210A)</strong> increases <strong>prothrombin levels</strong>, leading to a higher risk of clotting, but it does not involve APC resistance.</p>\n<p>Option D: This condition leads to reduced inhibition of <strong>thrombin</strong> and other clotting factors, increasing clotting risk, but it is not associated with APC resistance.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old boy complains of bony pain and swelling in his left upper arm for 3 months. On plain X-ray, the following findings were seen. What is the most likely gene mutation involved in this disease?",
    "choices": [
      {
        "id": 1,
        "text": "RAS gene"
      },
      {
        "id": 2,
        "text": "p53 gene"
      },
      {
        "id": 3,
        "text": "APC gene"
      },
      {
        "id": 4,
        "text": "PTEN gene"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the X-ray findings of sunray appearance\u00a0are suggestive of <strong>osteosarcoma.\u00a0</strong>\u00a0The most likely gene mutation is<strong> p53 mutation.</strong></p>\n<p><strong>p53</strong> and<strong> RB</strong> gene mutations are involved in osteosarcoma and sporadic cases have also been associated with mutations in the CHEK2 gene.</p>\n<p>RAS, APC, PTEN gene mutations do not have a strong association with osteosarcoma.</p>\n<p>Osteosarcoma is a primary malignant bone tumor, osteosarcoma has a bimodal age distribution, in adolescence (10\u201314 years) and again in the seventh decade. Osteosarcoma typically <strong>metaphyseal or metadiaphyseal</strong>, the majority present at the distal femur, proximal tibia, proximal femur, and humerus<br />Radiological features of osteosarcoma:</p>\n<ul>\n<li><strong>Irregular destruction</strong> in the metaphysis overshadowed by the formation of new bone</li>\n<li><strong>Lifting </strong>of the <strong>periosteum</strong> due to the formation of new bone</li>\n<li>Bone formation along the blood vessels within the tumor centrifugally gives rise to \u2018<strong>sunburst appearance\u2019</strong>\u00a0</li>\n<li>Other forms of periosteal reaction commonly seen are<strong>\u00a0Codman\u2019s triangle.</strong></li>\n</ul>\n<p><strong>Limb salvage</strong> <strong>surgeries</strong> are preferred over amputation. <strong>Neoadjuvant chemotherapy</strong> followed by <strong>surgical resection</strong> and <strong>adjuvant chemotherapy</strong> is the preferred treatment. The principal first-line chemotherapeutic agents used in osteosarcoma are doxorubicin, cisplatin, ifosfamide, and methotrexate.</p>\n<p>The image shows sunray appearance seen in osteosarcoma.<strong><br /></strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/16dfa9d330604a3ca98b8a87800ca8e4.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a60147377a26425fa202acbb20102ab0x720x765.JPEG"
    ]
  },
  {
    "text": "A 55-year-old man presents with vague abdominal pain since the last 6 months. He also noticed spontaneously appearing and disappearing tender nodules (clots) under the skin, at different locations. His blood investigations reveal elevated serum levels of CEA and CA 19-9. Which of the following genetic mutations is the most frequently inactivated tumor suppressor gene associated with this pancreatic mass?",
    "choices": [
      {
        "id": 1,
        "text": "BRCA -2"
      },
      {
        "id": 2,
        "text": "CDKN2A"
      },
      {
        "id": 3,
        "text": "K-RAS"
      },
      {
        "id": 4,
        "text": "SPINK1"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The presence of abdominal pain, migratory thrombophlebitis, and elevated serum levels of tumour markers like CEA and CA 19-9 in an elderly man point to a diagnosis of<strong> pancreatic cancer </strong>with<strong> Trousseau syndrome</strong>.\u00a0The <strong>CDKN2A</strong> gene present on chromosome 9p, is the <strong>most frequently inactivated tumour-suppressor gene</strong> in these tumours.</p>\n<p><em><strong>K-RAS</strong></em> is the <strong>most frequently\u00a0altered oncogene</strong> associated mutation with pancreatic cancer.</p>\n<div class=\"page\" title=\"Page 899\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Migratory thrombophlebitis,</strong> known as the <strong>Trousseau syndrome</strong>, occurs in about 10% of patients and is attributable to the elaboration of platelet-activating factors and procoagulants from the carcinoma or its necrotic products.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 897\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Molecular alterations in pancreatic carcinogenesis:</strong></p>\n<p>Pancreatic adenocarcinomas\u00a0arise from well-defined non-invasive precursor lesions in small ducts referred to as <strong>pancreatic intraepithelial neoplasia (PanIN).</strong></p>\n</div>\n</div>\n</div>\n<ul>\n<li>The <em><strong>K-RAS </strong></em><strong>gene </strong>(chromosome 12p) is the <strong>most frequently altered oncogene</strong> in pancreatic cancer. This oncogene is activated by the point mutation in 90% to 95% of pancreatic cancers.</li>\n<li>The <em><strong>CDKN2A</strong></em> gene (chromosome 9p) is inactivated in 30% of pancreatic cancers, making it the <strong>most frequently inactivated tumour-suppressor gene</strong> in these tumours. This complex locus encodes two tumour-suppressor proteins:p16 /INK4a and ARF.</li>\n<li>Inactivation of the <em><strong>TP53</strong></em> tumour-suppressor gene (chromosome 17p) occurs in 70% to 75% of pancreatic cancers.</li>\n<li><em><strong>SMAD4</strong></em> tumour-suppressor gene (chromosome 18q) is inactivated in 55% of pancreatic cancers.</li>\n</ul>\n<p>Following genes are associated with an inherited predisposition to pancreatic cancer:</p>\n<ul>\n<li><em><strong>BRCA2</strong></em> mutation: some pancreatic cancer, breast cancer, prostate cancer,\u00a0and ovarian cancers.</li>\n<li><em><strong> PRSS1 </strong></em>mutation: Pancreatic carcinoma starting early in life secondary to hereditary pancreatitis.</li>\n<li><em><strong> SPINK1 </strong></em>is only associated with <strong>hereditary pancreatitis,\u00a0</strong>but <strong>not pancreatic cancer.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child presents with hepatitis and progressive neurological degeneration. A slit-lamp examination of a patient showed the following picture. Which of the following is the molecular defect seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "CFTR"
      },
      {
        "id": 2,
        "text": "ABCC2"
      },
      {
        "id": 3,
        "text": "ATP7A"
      },
      {
        "id": 4,
        "text": "ATP7B"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image depicts<strong> the Kayser\u2013Fleischer (KF) ring</strong>, which is seen in <strong>Wilson's disease</strong>. <strong>ATP7B</strong> is the\u00a0molecular defect seen in this patient.\u00a0</p>\n<p>Wilson's disease is an <strong>autosomal recessive</strong> disorder caused by loss of function mutation of the <strong>ATP7B gene,</strong> which codes for the enzyme copper-transporting ATPase present on the hepatocyte canalicular membrane.</p>\n<p>In general, the free copper is taken up by hepatocytes and incorporated to form <strong>ceruloplasmin</strong> gets released into the bloodstream, and accounts for 90% to 95% of plasma copper. Excess hepatic copper gets transported into the bile and eventually excreted in the faeces.</p>\n<p>The defect in the ATP7B gene impairs copper transport into the bile, its incorporation into ceruloplasmin, and secretion of ceruloplasmin into the blood. This results in a<strong> decrease in circulating ceruloplasmin</strong> levels <strong>(&lt;20 mg/dL)</strong>\u00a0and increased levels of hepatic copper. Total<strong> serum copper level</strong> may be decreased due to the deficiency in ceruloplasmin.</p>\n<p>The excessive accumulation of copper injures the hepatocytes. This in turn releases the non-ceruloplasmin-bound copper into the bloodstream, which later gets deposited in tissues like the <strong>basal ganglia</strong> of the brain and the cornea. This results in behavioural disturbances as well as <strong>extrapyramidal</strong> symptoms and the characteristic KF ring that is seen on slit-lamp examination. There is a marked compensatory urinary copper excretion. However, these levels do not suffice to prevent the deposition of copper in tissues.</p>\n<p>Clinical features of Wilson disease:</p>\n<ul>\n<li>Hepatomegaly (with or without splenomegaly)</li>\n<li>Acute/subacute/chronic hepatitis</li>\n<li>Cirrhosis, ascites, portal hypertension</li>\n<li>Tremor, dystonia, parkinsonism, behavioral, and psychiatric changes</li>\n<li><strong>Kayser-Fleischer ring</strong></li>\n<li><strong>Coomb's negative hemolytic anemia</strong>\u00a0(due to large amounts of copper released from damaged hepatocytes)</li>\n<li>Renal Fanconi syndrome</li>\n<li>Endocrinopathies</li>\n</ul>\n<p>Important molecule defect and disease:</p>\n<table style=\"width: 314px; height: 249px;\">\n<tbody>\n<tr>\n<td style=\"width: 153.391px; text-align: center;\"><strong>ATP7A</strong> (Option C)</td>\n<td style=\"width: 132.016px; text-align: center;\"><strong>Menke\u2019s</strong>\u00a0<strong>disease</strong>\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 153.391px; text-align: center;\">ATP7B</td>\n<td style=\"width: 132.016px; text-align: center;\">Wilson disease\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 153.391px; text-align: center;\"><strong>CFTR</strong> (Option A)</td>\n<td style=\"width: 132.016px; text-align: center;\"><strong>Cystic fibrosis</strong>\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 153.391px; text-align: center;\">SERPINA 1\u00a0</td>\n<td style=\"width: 132.016px; text-align: center;\">\u03b1-1 antitrypsin deficiency\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 153.391px; text-align: center;\"><strong>ABCC2</strong> (MRP2 protein defect- Option B)</td>\n<td style=\"width: 132.016px; text-align: center;\"><strong>Dubin</strong>\u00a0<strong>Johnson syndrome</strong>\u00a0</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0a20f35a31a04de28f36d74d126e2688.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A neurodegenerative disease causing UMN as well as LMN weakness, affecting the green areas on the spinal cord is shown in the image. Which of the following gene mutation is responsible for the disease?",
    "choices": [
      {
        "id": 1,
        "text": "SMN 1 gene mutation"
      },
      {
        "id": 2,
        "text": "SOD 1 gene mutation"
      },
      {
        "id": 3,
        "text": "APP gene mutation"
      },
      {
        "id": 4,
        "text": "ATM gene mutation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image and clinical scenario is of <strong>Amyotrophic Lateral Sclerosis,</strong>\u00a0which is caused due to <strong>SOD 1 gene mutation. </strong>The image has the<strong> anterior horn </strong>of the <strong>spinal cord</strong> and the <strong>corticospinal tracts</strong> highlighted in <strong>green</strong>, representing the areas of the spinal cord <strong>affected by</strong> amyotrophic lateral sclerosis <strong>(ALS).</strong></p>\n<p>The pathologic hallmark of ALS is the<strong> death of the affected </strong>lower motor neurons<strong> (LMN)</strong> consisting of the anterior horn cells of the spinal cord and their homologs in the brainstem, upper motor neurons <strong>(UMN) </strong>consisting of the corticospinal tract and corticobulbar tract originating in the motor cortex.\u00a0The hereditary forms of ALS have <strong>mutations in the genes</strong> encoding for <strong>superoxide dismutase (SOD 1) </strong>present on<strong> chromosome 21.</strong></p>\n<p>Patients with ALS present with <strong>insidious </strong>onset <strong>asymmetric bilateral weakness </strong>of the distal part of the <strong>lower limbs.</strong> There may be a history of cramping, particularly early in the morning. Lower motor neuron death causes<strong> muscle atrophy</strong> and <strong>fasciculations. </strong>Upper motor neuron involvement presents as <strong>exaggerated tendon reflexes</strong> and <strong>spasticity</strong>.</p>\n<p>The involvement of the corticobulbar fibers leads to exaggerated expressions of emotion, such as excessive weeping or laughing. This is called the pseudobulbar affect. Some patients also tend to develop frontotemporal dementia. However, <strong>sensory, bowel, and bladder functions </strong>and<strong> cognition</strong> are <strong>preserved</strong>, even in the late stages of the disease.</p>\n<p>Other options:</p>\n<p>Option A: <strong>SMN1 mutation</strong>- <strong>Spinal muscular atrophy</strong>: The SMN1 (<strong>Survival Motor Neuron 1</strong>) gene produces a protein crucial for motor neuron survival. Mutations in this gene result in spinal muscular atrophy (SMA), a genetic disorder characterized by <strong>progressive muscle weakness and atrophy</strong> due to loss of motor neurons in the spinal cord.</p>\n<p>Option C: <strong>APP mutation</strong>- <strong>Alzheimer's disease</strong>: The APP (<strong>Amyloid Precursor Protein</strong>) gene is associated with Alzheimer\u2019s disease. Mutations in this gene can lead to the abnormal <strong>accumulation of beta-amyloid plaques</strong> in the brain, which are hallmarks of Alzheimer\u2019s and contribute to neurodegeneration and cognitive decline.</p>\n<p>Option D: <strong>ATM mutation</strong>- <strong>Cancer protection gene</strong>: The ATM (<strong>Ataxia-Telangiectasia Mutated</strong>) gene plays a role in <strong>DNA repair</strong> and cellular response to damage. Mutations in this gene are linked to ataxia-telangiectasia, a condition with increased <strong>cancer risk.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/63208cc339714a69b60e16d9c46f89a6.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most common genetic alteration of this thyroid tumor?",
    "choices": [
      {
        "id": 1,
        "text": "RET-PTC fusion"
      },
      {
        "id": 2,
        "text": "BRAF mutation"
      },
      {
        "id": 3,
        "text": "p53 mutation"
      },
      {
        "id": 4,
        "text": "RAS mutation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the presence of empty nuclei, also called <strong>Orphan Annie eye nuclei</strong> which is characteristic of <strong>papillary carcinoma</strong> of the <strong>thyroid</strong>. The most common is<strong> </strong>the <strong>BRAF V600E mutation</strong>.</p>\n<p>BRAF V600E mutation is also seen in</p>\n<ul>\n<li>Langerhans cell histiocytosis</li>\n<li>Hairy cell leukemia</li>\n<li>Colon adenocarcinoma</li>\n<li>Melanoma</li>\n</ul>\n<p>Other chromosomal rearrangements in papillary thyroid carcinoma:</p>\n<ul>\n<li>RET-PTC fusion (option A) - seen in sporadic papillary cancers; uncommon</li>\n<li>NTRK1 mutation</li>\n</ul>\n<p>Microscopic features of papillary thyroid carcinoma include:</p>\n<ul>\n<li><strong>Branching papillae</strong> with <strong>fibrovascular stalk</strong></li>\n<li>Covering epithelium is simple or stratified cuboidal</li>\n<li><strong>Orphan Annie eye nuclei</strong> - \u00a0\n<ul>\n<li><strong>Empty-appearing</strong> nuclei due to <strong>dispersed chromatin</strong></li>\n<li>They are diagnostic, regardless of papillary architecture</li>\n</ul>\n</li>\n<li><strong>Psammoma</strong> <strong>bodies</strong> - concentric calcified structures</li>\n<li>Foci of lymphatic invasion\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/249ee60ecc71401a8399aa6398aee784.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a91495940f4f4437840356f87c3954efx1280x1159.JPEG"
    ]
  },
  {
    "text": "A 32-year-old male patient was referred to you with features of pituitary adenoma and testicular tumor. While going through his radiological reports, you saw the presence of parathyroid adenoma, and his chromosomal studies show a mutation in the CDKN1B gene. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Multiple endocrine neoplasia  type 4"
      },
      {
        "id": 2,
        "text": "Multiple endocrine neoplasia type 3"
      },
      {
        "id": 3,
        "text": "Multiple endocrine neoplasia type 2A"
      },
      {
        "id": 4,
        "text": "Multiple endocrine neoplasia type 1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical presentation of <strong>pituitary adenoma, parathyroid adenoma, testicular tumor,</strong> and a mutation in the<strong> CDKN1B</strong> gene is suggestive of <strong>multiple endocrine neoplasia\u00a0type 4\u00a0(MEN 4)</strong>.</p>\n<p>MEN 4 is an <strong>autosomal dominant</strong> endocrine tumor syndrome. It occurs due to the germline mutation in the <strong>CDKN1B</strong> gene in<strong> chromosome 12</strong>.</p>\n<p>MEN 4 often presents with parathyroid adenoma, pituitary adenoma, reproductive organ tumors like testicular cancer, or neuroendocrine cervical cancer with adrenal or renal tumors.\u00a0</p>\n<p>The clinical presentation in MEN 4 is almost<strong> similar to MEN1</strong>. The <strong>difference</strong> between MEN1 and MEN4 is in the<strong> germline mutation</strong>, where MEN 1 occurs due to the mutation of the MEN1 gene.</p>\n<p>Multiple endocrine neoplasia (MEN) is a group of autosomal dominant disorders characterized by tumors involving two or more endocrine glands. Depending on the chromosomal location of germline mutation they are divided into <strong>four major forms</strong> as <strong>MEN 1</strong>, MEN 2A, MEN 2B (MEN 3), and MEN 4. MEN 1 is the most common among the four types.\u00a0</p>\n<p>Other Options:</p>\n<p>Option B-\u00a0<strong>MEN 3</strong> is also known as<strong> MEN 2B</strong>. It occurs due to a mutation of the RET gene. It is associated with medullary thyroid carcinoma, pheochromocytoma, <strong>mucosal neuroma</strong>, <strong>marfanoid</strong> features. In contrast with MEN2A, parathyroid hyperplasia is not seen in MEN 2B.</p>\n<p>Option C- <strong>MEN 2A</strong>\u00a0is also known as <strong>Sipple's syndrome</strong>. It occurs due to a mutation of the RET gene. It is associated with medullary carcinoma thyroid, pheochromocytoma, and <strong>parathyroid adenoma</strong>.</p>\n<p>Option D- <strong>MEN 1</strong> is also known as <strong>Wermer's syndrome</strong>. It occurs due to a mutation in the MEN 1 gene. It is associated with\u00a0<strong>parathyroid adenoma, pancreatic tumors,</strong> and<strong> pituitary tumors.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A couple comes to a hospital for genetic counselling and upon further evaluation, the husband is found to have Marfan syndrome. The inheritance pattern and mutation associated with this condition are:",
    "choices": [
      {
        "id": 1,
        "text": "Autosomal dominant, mutation in FBN-1 gene"
      },
      {
        "id": 2,
        "text": "Autosomal recessive, mutation in FBN-1 gene"
      },
      {
        "id": 3,
        "text": "Autosomal dominant, mutation in FBN-2 gene"
      },
      {
        "id": 4,
        "text": "Autosomal recessive, mutation in FBN-2 gene"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The inheritance pattern and the mutation in Marfan syndrome are that it is <strong>autosomal dominant</strong> and is associated with a mutation in <strong>FBN-1</strong> gene.</p>\n<div class=\"page\" title=\"Page 157\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Marfan syndrome</strong> is an autosomal dominant disorder affecting connective tissues\u00a0associated chiefly with cardiovascular, ocular, and musculoskeletal abnormalities, although involvement of other organ systems like the central nervous system, respiratory system and skin has also been observed. It results from an inherited defect in an extracellular glycoprotein called <strong>Fibrillin-1</strong>.</p>\n<div class=\"page\" title=\"Page 157\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Fibrillin occurs in two homologous forms, fibrillin-1 and fibrillin-2, encoded by two separate genes, FBN-1 and FBN-2, located on long arms of chromosomes 15 and 5, respectively. <strong>Mutations of FBN-1 give rise to Marfan syndrome</strong> while mutations of the related FBN2 gene give rise to congenital contractural arachnodactyly, an autosomal dominant disorder characterized by skeletal abnormalities, which is less common.\u00a0</p>\n<p>Fibrillin-1 is a regulator of TGF-\u03b2 which is responsible for inflammation, fibrosis, and activation of specific matrix metalloproteinases (MMPs), particularly MMP-2 and MMP-9.</p>\n<p>Patients with Marfan syndrome are tall and have an\u00a0<strong>decreased\u00a0upper to lower segment ratio\u00a0</strong>with<strong>\u00a0long arms, hands,</strong>\u00a0and\u00a0<strong>fingers</strong>. Deformities of the chest wall, vertebral column, and foot arches may be present.</p>\n<p>Associated cardiovascular abnormalities include mitral valve prolapse leading to<strong>\u00a0mitral regurgitation\u00a0</strong>and dilatation of aortic root/sinuses of Valsalva leading to\u00a0<strong>aortic regurgitation,</strong>\u00a0aortic dissection, and rupture.</p>\n<p><strong>Ocular Features</strong> include <strong>ectopia lentis,</strong> cataract, refractive errors like myopia due to <strong>increased axial length</strong> and retinal detachment</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old boy has been observed by his parents to be increasingly clumsy for the past 6 months. On physical examination, there is a cauliflower-like growth in the left eye along with leukocoria and an absent red reflex. The microscopic appearance of the specimen shows Flexner-Wintersteiner rosettes. Which is the causative gene in the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Rb gene"
      },
      {
        "id": 2,
        "text": "COL5A1 gene"
      },
      {
        "id": 3,
        "text": "Rhodopsin gene"
      },
      {
        "id": 4,
        "text": "NOTCH1"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical history and\u00a0histology point toward a diagnosis of <strong>retinoblastoma</strong> which occurs\u00a0due to a\u00a0<strong>mutation in the Rb gene</strong>\u00a0located on\u00a0<strong>chromosome 13q14.</strong></p>\n<p><strong>Retinoblastoma</strong>\u00a0is the\u00a0<strong>most common</strong>\u00a0<strong>intraocular malignancy</strong>\u00a0in\u00a0<strong>children</strong>.\u00a0<strong>White pupillary reflex</strong>\u00a0or\u00a0<strong>leukocoria</strong>\u00a0is the most common presenting feature, followed by a squint which is usually convergent. Rarely, the child may present with nystagmus and defective vision.</p>\n<p>Clinical features of retinoblastoma:</p>\n<ul>\n<li>Present\u00a0within the first two years of life</li>\n<li><strong>Leukocoria\u00a0</strong></li>\n<li>Strabismus</li>\n<li>Painful red eye with secondary glaucoma</li>\n<li>Orbital inflammation mimicking orbital or pre-septal cellulitis.</li>\n<li>Orbital invasion or visible extraocular growth may occur in neglected cases.</li>\n<li>Metastatic disease involving regional lymph nodes and the brain before the detection of ocular involvement is rare.</li>\n</ul>\n<p>Signs:</p>\n<ul>\n<li>An intraretinal tumor is a homogeneous, dome-shaped white lesion\u00a0that becomes irregular, often with white flecks of\u00a0<strong>calcification.</strong></li>\n<li>An endophytic tumor projects into the\u00a0<strong>vitreous\u00a0</strong>as a white mass that may\u00a0<strong>\"seed\"\u00a0</strong>into the gel.</li>\n<li>An exophytic tumor forms multilobular\u00a0<strong>subretinal white masses\u00a0</strong>and causes an overlying\u00a0<strong>retinal detachment.</strong></li>\n</ul>\n<p>Investigations:</p>\n<ul>\n<li><strong>Red reflex testing\u00a0</strong>with a direct ophthalmoscope is a simple screening test for leukocoria.</li>\n<li>Dilated fundus examination using\u00a0<strong>indirect ophthalmoscope</strong></li>\n<li><strong>MRI\u00a0of the orbit + brain</strong>\u00a0is the investigation of choice.</li>\n</ul>\n<p>\u00a0The HPE image below shows\u00a0<strong>Flexner-Wintersteiner rosettes</strong>, the clustering of small blue cuboidal or short columnar cells around a central lumen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8699f4a0600542008aa1eb084b75433fx640x890.JPEG"
    ]
  },
  {
    "text": "An elderly female patient presented with complaints of abdominal pain, weight loss, and early satiety for 2 years. Endoscopy was suggestive of gastric cancer. A biopsy of the same is shown below. Which of the following molecular pathophysiological features may be seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "p53 activation"
      },
      {
        "id": 2,
        "text": "Decreased E-cadherin"
      },
      {
        "id": 3,
        "text": "Gain-of-function mutations in CDH1"
      },
      {
        "id": 4,
        "text": "Mutation in APC gene"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image showing <strong>signet ring cells</strong> is suggestive of <strong>diffuse-type</strong>&nbsp;gastric cancer, which has <strong>decreased E-cadherin</strong> expression.&nbsp;Cells in&nbsp;diffuse-type&nbsp;gastric cancer have large mucin vacuoles that expand the cytoplasm and push the nucleus to the periphery, which creates a signet-ring cell.</p>\n<p><strong>Lauren's system&nbsp;</strong>classifies gastric cancer into the following types based on differences in etiology, epidemiology, and pathology:</p>\n<ul>\n<li>Type I - intestinal</li>\n<li><strong>Type II - diffuse</strong></li>\n</ul>\n<p>Molecular pathologies seen in&nbsp;the<strong>&nbsp;intestinal type </strong>are as follows:</p>\n<ul>\n<li aria-level=\"1\"><strong>L</strong><strong>oss-of-function mutations&nbsp;</strong>in the<em><strong> APC</strong></em> <strong>gene</strong> or in &beta;-catenin</li>\n<li aria-level=\"1\">Inactivation of <strong><em>p53</em>&nbsp;</strong>(tumor-suppressor gene)<strong>&nbsp;</strong>and <em><strong>p16</strong></em> (cyclin-dependent kinase inhibitor)</li>\n<li aria-level=\"1\">Microsatellite instability</li>\n</ul>\n<p>Molecular pathologies seen in<strong> diffuse-type </strong>are as follows:&nbsp;</p>\n<ul>\n<li aria-level=\"1\"><strong>Loss-of-function </strong>mutations in <strong><em>CDH1</em>,</strong> leading to<strong> d</strong><strong>ecreased E-cadherin</strong></li>\n<li aria-level=\"1\"><strong>Inactivation</strong> of <em><strong>p53</strong></em> and <em><strong>p16</strong></em></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/420bd80e9e4c4f5db740b9c79aa890ec.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 52-year-old male presenting with abdominal pain and melena is diagnosed with a Gastrointestinal Stromal Tumor (GIST) following an upper GI endoscopy. Which mutation is associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "KIT"
      },
      {
        "id": 2,
        "text": "KRAS"
      },
      {
        "id": 3,
        "text": "PHEX"
      },
      {
        "id": 4,
        "text": "AFP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical condition is diagnosed as gastrointestinal stromal tumour(<strong>GIST</strong>) and it occurs due to\u00a0<strong>gain-of-function mutations</strong> in receptor tyrosine kinase <strong>KIT</strong> (~75%)</p>\n<p><strong>GIST </strong>is the<strong> most common mesenchymal tumour </strong>of the abdomen, with the most common site being the<strong> stomach(50%)</strong>. However, it can arise from any part of the git. The tumour arises from the<strong> interstitial cells of Cajal </strong>or pacemaker cells of the gastrointestinal muscularis propria.</p>\n<p>Most GISTs occur due to <strong>gain-of-function mutations</strong> in receptor <strong>tyrosine kinase KIT</strong> (~75%) or <strong>PDGRF-\u0251</strong> (~8%).\u00a0</p>\n<p>The tumour peaks at<strong>\u00a060 years</strong> of age. It is often associated with the\u00a0<strong>Carney triad</strong>,\u00a0a nonhereditary condition characterized by<strong> GIST, paraganglioma,</strong> and<strong> pulmonary chondroma</strong>. GIST also has a higher incidence in individuals with <strong>neurofibromatosis I.</strong></p>\n<p>Patients typically present with <strong>anaemia</strong> (blood loss caused by mucosal ulceration) and symptoms of <strong>mass effect</strong>. However, GISTs may also be discovered incidentally during imaging or surgery.</p>\n<p>Microscopically, GIST can be of two patterns:</p>\n<ol>\n<li><strong>Spindle cell type</strong>: The tumour is composed of thin elongated cells.</li>\n<li><strong>Epitheloid type</strong>: The tumour is composed of plump epithelial-like cells.</li>\n</ol>\n<p>Mixed patterns may also be seen.</p>\n<p>The most useful immunohistochemical marker is<strong> KIT</strong> (<strong>CD117</strong>) detectable in Cajal cells.</p>\n<p>The prognosis depends on <strong>tumour size, mitotic index, </strong>and<strong> location</strong> (GISTs arising in the stomach are less aggressive than those arising in the small intestine). <strong>Complete surgical resection</strong> is the mainstay treatment. For unresectable, recurrent, or metastatic GISTs, <strong>imatinib</strong>, a tyrosine kinase inhibitor, can be used.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>KRAS</strong> is an oncogene that encodes a <strong>GTPase protein</strong> involved in the<strong> RAS/MAPK</strong> signalling pathway, regulating cell growth and proliferation. <strong>Mutations </strong>in KRAS are commonly associated with cancers like <strong>colorectal, lung, and pancreatic cancers.</strong></p>\n<p>Option C: The <strong>PHEX</strong> gene (<strong>ph</strong>osphate-regulating <strong>e</strong>ndopeptidase on <strong>X</strong> chromosome) is associated with <strong>X-linked hypophosphatemic rickets. </strong>Mutation of PHEX leads to increased <strong>phosphatonin (FGF 23)</strong> levels, and hence, the <strong>excretion of phosphorous </strong>is increased.</p>\n<p>Option D: <strong>Alpha-fetoprotein (AFP)</strong> is a glycoprotein produced primarily by the <strong>fetal liver and yolk sac</strong>, serving as a marker for<strong> fetal development.</strong> Elevated AFP levels in adults are associated with conditions like <strong>hepatocellular carcinoma </strong>and <strong>germ cell tumours.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old postmenopausal woman presented to the clinic with a history of a lump in her right breast for six months. Radiological examination showed an irregular spiculated lesion of 8 mm with microcalcification. A biopsy was taken, and the immunohistochemistry results revealed that the cell membrane was stained brown. Identify the pathophysiological mechanism of the underlying condition.",
    "choices": [
      {
        "id": 1,
        "text": "ERBB2 gene amplification"
      },
      {
        "id": 2,
        "text": "Point mutation of JAK2 receptor gene"
      },
      {
        "id": 3,
        "text": "Point mutation of EGFR tyrosine kinase"
      },
      {
        "id": 4,
        "text": "N-myc amplification"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mechanism of neoplasia(underlying condition) here is due to the <strong>amplification</strong> of the <strong>ERBB2</strong> gene, resulting in <strong>abnormal</strong> <strong>HER2neu</strong> <strong>receptors</strong>.</p>\n<p>The given clinical stem is suggestive of\u00a0<strong>invasive breast carcinoma</strong>. The radiological imaging with irregular, spiculated margins and microcalcifications is an indication for biopsy for further assessment. In the <strong>immunohistochemistry studies,\u00a0</strong>the cell membrane is stained <strong>brown</strong>, indicating a <strong>HER2neu</strong>-<strong>positive tumour.</strong> <strong>Fluorescent in situ hybridisation (FISH)</strong> can be used adjunctively to confirm the diagnosis. HER2-positive is the second most common molecular subtype of invasive breast cancer.</p>\n<p>HER2 receptors (also known as ERBB2) is a receptor tyrosine kinase that promotes cell proliferation and opposes apoptosis by stimulating the RAS- and PI3K-AKT signalling pathways.\u00a0</p>\n<p><strong>Immunohistochemistry staining of breast carcinoma -\u00a0</strong></p>\n<ul>\n<li>The <strong>Estrogen receptor (ER)</strong> and<strong> Progesterone receptor (PR)</strong> are nuclear receptors, and the <strong>nucleus</strong> is stained brown.</li>\n<li>The<strong> human epidermal growth factor receptor type 2 (HER2)</strong> is a membrane receptor. Hence, the <strong>cell membrane</strong> is stained brown if positive.</li>\n</ul>\n<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>The image below shows positive and negative staining for ER, PR, and HER2.</p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/73585e3f88ba4281aaf80a529428b930x243x199.JPEG"
    ]
  },
  {
    "text": "A 3-month-old baby boy presents with recurrent bacterial infections, and a history of bloody diarrhoea and eczema since the first month of life. Peripheral smear shows small-sized platelets. Which gene is defective in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "BTK"
      },
      {
        "id": 2,
        "text": "BAFF"
      },
      {
        "id": 3,
        "text": "ATM"
      },
      {
        "id": 4,
        "text": "WASP"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario suggests\u00a0<strong>Wiskott\u2013Aldrich syndrome </strong>and the defective gene is<strong> </strong>the<strong> WASP gene.</strong></p>\n<p><strong>Wiskott\u2013Aldrich syndrome</strong> is an <strong>X-linked recessive </strong>disease characterized by <strong>thrombocytopenia </strong>and\u00a0<strong>small-sized platelets</strong>. Patients often present in infancy with bruising, bloody diarrhoea, eczema, and susceptibility to<strong> recurrent infection</strong>s. It occurs due to mutations in the gene located at <strong>Xp11.23</strong> that encodes the <strong>Wiskott-Aldrich syndrome protein</strong> (WASP).</p>\n<p>Along with microthrombocytopenia, peripheral smear shows loss of T lymphocytes. Patients can also not produce antibodies to antigens, thereby making them <strong>immunocompromised</strong>. As a result, there is also an increased risk of autoimmune disorders and cancers like B-cell lymphomas.</p>\n<p><strong>Splenectomy</strong> improves platelet counts in these patients since increased platelet destruction in the spleen is prevented. However, the only definitive treatment is <strong>hematopoietic stem cell transplantation</strong>.</p>\n<p>Other options:</p>\n<p>Option A: The <strong>Bruton tyrosine kinase </strong>(BTK)<strong> gene</strong> is mutated in <strong>X-linked agammaglobulinemia</strong>. It occurs because the<strong> B-cells</strong> fail to undergo maturation. All lines of immunoglobulins are found to be low in this disease. Since it is an X-linked disorder, it is most commonly seen in young males. They present after the age of 6 months with <strong>recurrent respiratory tract infections.</strong></p>\n<p>Option B: \u00a0<strong>BAFF gene</strong> mutation leads to <strong>common variable immunodeficiency</strong>. Patients usually have persistent diarrhoea caused by<strong> G. lamblia</strong>, recurring sinopulmonary pyogenic infections, and potentially serious <strong>enterovirus infections</strong> that cause <strong>meningoencephalitis.</strong> Symptoms appear later in childhood or adolescence than in X-linked\u00a0agammaglobulinemia.</p>\n<p>Option C:<strong> Ataxia telangiectasia</strong> is caused due to mutation of the<strong> ATM gene.</strong> This gene is involved in the repair of double-strand DNA breaks. This defect in DNA repair leads to <strong>impaired Ig isotype switching</strong> and the formation of antigen receptors. As a result, the patient is<strong> immunodeficient </strong>with partial T cell deficiency, and hence live vaccines are avoided.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man has the following lesion over the face. The patient is apprehensive about history of brain tumors and similar skin pathologies in the family. On examination he had scoliosis and Chest X ray  revealed bifid ribs. Which of the following  gene mutation can be expected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "PTEN gene"
      },
      {
        "id": 2,
        "text": "VHL gene"
      },
      {
        "id": 3,
        "text": "PTCH gene"
      },
      {
        "id": 4,
        "text": "APC gene"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given family histories <strong>brain tumours</strong>, with the image showing an ulcer over the face with pearly, rolled-out borders suggestive<strong> basal cell carcinoma</strong> and association of <strong>bifid ribs </strong>and<strong> vertebral anomalies</strong>\u00a0likely points to the diagnosis of <strong>Gorlin syndrome</strong>. Mutation of <strong>PTCH gene </strong>is seen in this condition.</p>\n<p><strong>Gorlin syndrome</strong> also known as <strong>nevoid basal cell carcinoma \u00a0syndrome</strong> is an <strong>autosomal dominant </strong>condition caused by mutations in the <strong>PTCH gene</strong> which codes for <strong>PATCHED protiens</strong>. In the absence of PATCHED proteins, there is unopposed Hedgehog signaling that increases the expression of a number of pro-growth genes. It is associated with a high risk of <strong>basal cell carcinoma </strong>and<strong> medulloblastoma.</strong></p>\n<p>Other\u00a0features that can be seen associated are:</p>\n<ul>\n<li>Highly characteristic facies (with large forehead)</li>\n<li><strong>Bifid or misshapen ribs</strong></li>\n<li>Vertebral and other skeletal anomalies (Scoliosis)</li>\n<li><strong>Pits of the skin of the palms and soles</strong></li>\n<li>Dysgenesis of the corpus callosum</li>\n<li>Calcification of the falx cerebri (at an earlier age than is seen in non\u2010affected individuals)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3f64277004dc40cdb55e9d1a0f45c42b.JPEG"
    ],
    "explanation_images": [
      "https://media.springernature.com/lw685/springer-static/image/art%3A10.1186%2F1746-160X-7-2/MediaObjects/13005_2009_Article_194_Fig1_HTML.jpg?as=webp"
    ]
  }
];
        let quizName = 'Gene Mutations Mini Test';
        const quizFilename = 'gene-mutations-mini-test-7c99ad5c.html';
        let hierarchy = ["Marrow", "FMGE Mini Test Series", "2025"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>