<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27 Pediatric Nephrology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Pediatrics
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Hematuria in children is defined as the presence of at least ______ RBCs per high power field in uncentrifuged urine.",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "4"
      },
      {
        "id": 3,
        "text": "5"
      },
      {
        "id": 4,
        "text": "6"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hematuria</strong> in children is defined as the presence of <strong>at least</strong> <strong>5 RBCs/HPF</strong><strong>&nbsp;</strong>(high power field) in <strong>uncentrifuged </strong>urine.</p>\n<p>When using commercially available<strong> dipsticks</strong> (capable of detecting 3-5 RBCs / HPF of urine), the presence of <strong>10-50 RBCs/&mu;L</strong> suggests an underlying pathology.</p>\n<p><strong>False-negative</strong> results can occur in the presence of</p>\n<ul>\n<li>Formalin</li>\n<li>High urinary concentrations of ascorbic acid</li>\n</ul>\n<p><strong>False-positive</strong> results, on the other hand, may be seen</p>\n<ul>\n<li>With alkaline urine (pH &gt; 8)</li>\n<li>Contamination with oxidizing agents such as hydrogen peroxide (used to clean the perineum before obtaining a specimen)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 11-year-old child was brought to the hospital by his mother with complaints of multiple episodes of passing blood in the urine. Which of the following condition is not associated with this symptom?",
    "choices": [
      {
        "id": 1,
        "text": "Berger\u2019s disease"
      },
      {
        "id": 2,
        "text": "Hemolytic uremic syndrome"
      },
      {
        "id": 3,
        "text": "Hereditary nephritis"
      },
      {
        "id": 4,
        "text": "Idiopathic hypercalciuria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hemolytic uremic syndrome (HUS)</strong> presents with acute-onset <strong>microscopic</strong> hematuria not recurrent gross hematuria.</p>\n<p>Causes of recurrent gross hematuria:</p>\n<ul>\n<li>Alport&rsquo;s syndrome:&nbsp;<strong>hereditary nephritis</strong></li>\n<li>Thin glomerular basement membrane disease</li>\n<li>IgA nephropathy:&nbsp;<strong>Berger&rsquo;s disease&nbsp;</strong></li>\n<li><strong> Idiopathic hypercalciuria</strong>/hyperuricosuria</li>\n<li>Sickle cell nephropathy (papillary necrosis)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old girl with urinary complaints was brought to the hospital by her parents. On further enquiry, they mention a history of skin lesions 5 weeks back. Low C3 levels are found during her investigations. Immunofluorescence microscopy reveals a \u201clumpy-bumpy\u201d pattern of immunoglobulin and complement deposits on the glomerular basement membrane. Which of the following is not typically associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cola colored urine"
      },
      {
        "id": 2,
        "text": "Frothy urine"
      },
      {
        "id": 3,
        "text": "Oliguria"
      },
      {
        "id": 4,
        "text": "Hypertension"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Urinary complaints with a history of skin lesions (pyoderma) point towards a likely diagnosis of <strong>glomerulonephritis.</strong> Results of complement study and immunofluorescence microscopy also correlate with this diagnosis.&nbsp;<strong>Frothy urine</strong> is due to proteinuria, which is a feature of<strong> nephrotic syndrome</strong>.&nbsp;</p>\n<p><strong>Classic features </strong>of nephritic syndrome/glomerulonephritis:</p>\n<ul>\n<li>Cola coloured urine (hematuria)</li>\n<li>Oliguria</li>\n<li>Hypertension</li>\n<li>Facial or body edema</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Akshay, accompanied by his father, presents to the OPD with complaints of cola-coloured urine and facial puffiness for 3 days. He has a history of fever with a sore throat that resolved 2 weeks back. Which of the following findings is consistent with the diagnosis of post-streptococcal glomerulonephritis?",
    "choices": [
      {
        "id": 1,
        "text": "C3 level increases and ASO level increases"
      },
      {
        "id": 2,
        "text": "C3 level decreases and ASO level  increases"
      },
      {
        "id": 3,
        "text": "C3 level decreases and ASO level  decreases"
      },
      {
        "id": 4,
        "text": "C3 level  increases and  ASO level  decreases"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>C3 level decreases</strong> and <strong>ASO level increases</strong> in acute post-streptococcal glomerulonephritis (PSGN).</p>\n<p>Acute PSGN is a classic example of an acute nephritic syndrome characterized by the sudden onset of gross hematuria, oedema, hypertension, and renal insufficiency. It follows infection of the throat or skin by certain <strong>nephritogenic strains of group A \u03b2-hemolytic streptococci-</strong></p>\n<ul>\n<li>1 to 2 weeks after an antecedent streptococcal <strong>pharyngitis</strong> or</li>\n<li>3 to 6 weeks after streptococcal <strong>pyoderma</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a characteristic feature of hematuria associated with glomerulonephritis?",
    "choices": [
      {
        "id": 1,
        "text": "Dysmorphic RBC in urine"
      },
      {
        "id": 2,
        "text": "RBC cast in urine"
      },
      {
        "id": 3,
        "text": "Painful hematuria"
      },
      {
        "id": 4,
        "text": "Cola-colored urine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hematuria</strong> associated with glomerulonephritis is typically <strong>painless.</strong></p>\n<p>Hematuria from within the glomerulus is often associated with brown-, cola-, or tea-colored urine. Urine analysis reveals RBC casts and deformed urinary RBCs (particularly acanthocytes).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old boy presents with decreased urine output for 3 days. He has a history of sore throat 2 weeks back. On examination, he is hypertensive with pitting pedal oedema. The diagnosis is concluded as post-streptococcal glomerulonephritis. Which of the following is true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Serum triglyceride levels are elevated."
      },
      {
        "id": 2,
        "text": "Microscopic hematuria resolves in 4 weeks."
      },
      {
        "id": 3,
        "text": "Serum C3 levels are normal."
      },
      {
        "id": 4,
        "text": "Renal biopsy is indicated in severe impairment of renal function."
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette of oliguria, pedal edema and hypertension point towards glomerulonephritis.&nbsp;&nbsp;<strong>Severe impairment</strong> <strong>of renal functions</strong> in a background of post-streptococcal glomerulonephritis is an <strong>indication for&nbsp;renal biopsy.&nbsp;</strong></p>\n<p>Indications for renal biopsy in&nbsp;<strong>glomerulonephritis</strong>:</p>\n<ul>\n<li>Presence of acute renal failure or nephrotic syndrome</li>\n<li>Absence of evidence of streptococcal infection</li>\n<li>Presence of normal complement levels</li>\n<li>Persistence&nbsp;of hematuria and proteinuria, diminished renal function, and/or a low C3 level for more than 2 months after the disease onset&nbsp;&nbsp;</li>\n</ul>\n<p>Serum triglycerides&nbsp; (Option A) are elevated in<strong> nephrotic syndrome,</strong> not in nephritic syndrome.</p>\n<p>The acute phase generally resolves within 6 to 8 weeks. Although urinary protein excretion and hypertension usually normalize by 4-6 wk after onset, <strong>microscopic hematuria&nbsp; </strong>(Option B)<strong>&nbsp;</strong>can persist for <strong>1 to 2 years </strong>after the initial presentation<strong>.</strong></p>\n<p>The serum <strong>C3 level </strong>(Option C) is significantly<strong> reduced </strong>in &gt;90% of patients in the acute phase<strong>,</strong> and returns to normal 6-8 weeks after onset.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old boy with a previously diagnosed renal disorder is brought to your OPD with the following reports for a second opinion. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Post-streptococcal glomerulonephritis"
      },
      {
        "id": 2,
        "text": "Rapidly progressive glomerulonephritis"
      },
      {
        "id": 3,
        "text": "Focal segmental glomerulonephritis"
      },
      {
        "id": 4,
        "text": "Minimal change disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Other options:</p>\n<p><strong>Idiopathic rapidly progressive glomerulonephritis:</strong></p>\n<ul>\n<li>Light microscopy: Crescents develop in several forms of glomerulonephritis (are a characteristic response to the deposition of fibrin in Bowman&rsquo;s space)</li>\n<li>Electron microscopy: No deposits</li>\n</ul>\n<p><strong>Focal segmental glomerulonephritis:</strong></p>\n<ul>\n<li>Light microscopy: Focal sclerotic lesions</li>\n<li>Electron microscopy: Foot process fusion</li>\n</ul>\n<p><strong>Minimal change disease:</strong></p>\n<ul>\n<li>Light microscopy: Normal</li>\n<li>Electron microscopy Effacement of foot process</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f3bdae22bc241a0878effb6a6c08e52x1279x1050.JPEG"
    ]
  },
  {
    "text": "An 8-year-old boy presented with cola-coloured urine, decreased urine output, and facial puffiness for 3 days. He had a history of skin infection 4 weeks back. On examination, he is found to be hypertensive. His serum C3 levels are low and ASO levels are increased. What is the appropriate step in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Renal biopsy"
      },
      {
        "id": 2,
        "text": "Supportive therapy"
      },
      {
        "id": 3,
        "text": "Steroids"
      },
      {
        "id": 4,
        "text": "Cyclosporine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The features of hematuria, oliguria, facial oedema present with a history of skin infection points towards the diagnosis of&nbsp;<strong>post-streptococcal glomerulonephritis (PSGN). </strong>Results of complement study and ASO levels also support this diagnosis. <strong>Supportive conservative therapy </strong>is the best step in the&nbsp;management of&nbsp;PSGN.</p>\n<p>Management of PSGN is directed at treating the acute effects of renal insufficiency (sodium restriction and prescribing diuretics - usually with intravenous furosemide) and hypertension.&nbsp;&nbsp;</p>\n<p>Although a 10-day course of systemic antibiotic therapy with penicillin is recommended to limit the spread of the nephritogenic organisms, antibiotic therapy does not a\ufb00ect the natural history of acute PSGN.</p>\n<p><strong>Note</strong>: Steroids and cyclosporine are not used in the management of PSGN.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sarthak, a 7-year-old boy, was brought to the emergency department by his parents with complaints of blurred vision and severe headache since today morning. They mentioned an episode of fits 2 hours back following which they rushed him to the hospital. On further enquiry, it was elicited that the child had decreased urine output for 5 days with cola coloured urine. He was hypertensive with bilateral pitting pedal oedema. The doctor remembered that Sarthak has a glomerular disorder warranting him multiple prior ward admissions and his existing condition could be a possible complication of the same.  All of the following are commonly seen as a complication of this disorder except-",
    "choices": [
      {
        "id": 1,
        "text": "Left ventricular failure"
      },
      {
        "id": 2,
        "text": "Hypertensive encephalopathy"
      },
      {
        "id": 3,
        "text": "Hyperkalemia"
      },
      {
        "id": 4,
        "text": "Bleeding diasthesis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given features of oliguria, hematuria, pedal edema and hypertension are likely of <strong>glomerulonephritis</strong>. The complication of hypertensive encephalopathy is seen in this case due to symptoms of seizure, blurred vision and severe headache. Hyperkalemia and left ventricular failure are also common complications of&nbsp;glomerulonephritis while <strong>bleeding diasthesis</strong> is <strong>not a complication</strong> of glomerulonephritis.</p>\n<p>Acute complications of glomerulonephritis result from hypertension and acute renal dysfunction-</p>\n<ul>\n<li>Hypertension is seen in 60% of patients and is sometimes associated with <strong>hypertensive encephalopathy</strong> and intracranial bleeding.</li>\n<li><strong>Acute renal failure</strong> can occur, which may require treatment with dialysis.</li>\n</ul>\n<p>Other potential complications include the following:</p>\n<ul>\n<li><strong>Heart failure</strong></li>\n<li><strong>Hyperkalemia</strong></li>\n<li>Hyperphosphatemia&nbsp;</li>\n<li>Hypocalcemia&nbsp;</li>\n<li>Hyponatremia</li>\n<li>Acidosis</li>\n<li>Seizures</li>\n<li>Uremia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old boy presents with gross hematuria 2 days after an episode of diarrhoea. The serum C3 levels are normal. Light microscopy demonstrates focal and segmental mesangial proliferation and increased mesangial matrix in the glomerulus. What is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Berger's disease"
      },
      {
        "id": 2,
        "text": "PSGN"
      },
      {
        "id": 3,
        "text": "Microangiopathic hemolytic anemia"
      },
      {
        "id": 4,
        "text": "None of the above"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Gross hematuria following a gastrointestinal infection, associated with normal C3 levels, in a male&nbsp;patient is suggestive of&nbsp;<strong>immunoglobulin A nephropathy (Berger nephropathy)</strong>.</p>\n<ul>\n<li>IgA nephropathy is the most common chronic glomerular disease in children.</li>\n<li><strong>Focal and segmental mesangial proliferation and increased mesangial matrix</strong> are seen in the glomerulus.</li>\n<li>It is characterized by a predominance of IgA within mesangial glomerular deposits in the absence of systemic disease.</li>\n<li>It is seen more often in males.</li>\n<li>Gross hematuria occurs within 1-2 days of onset of an upper respiratory or gastrointestinal infection (in contrast to the long latency period observed in acute post-streptococcal glomerulonephritis).</li>\n<li>It can be associated with<strong> loin pain.</strong></li>\n<li><strong>Normal serum levels of C3</strong> in IgA nephropathy (help to distinguish this disorder from PSGN).</li>\n<li>Serum IgA levels have no diagnostic value because they are elevated in only a few paediatric patients.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child developed dark coloured urine and flank pain 2 days after an upper respiratory tract infection. The physician suspects IgA nephropathy. What is the location of cellular injury in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Epithelial cell"
      },
      {
        "id": 2,
        "text": "Basement membrane"
      },
      {
        "id": 3,
        "text": "Endothelial cell"
      },
      {
        "id": 4,
        "text": "Mesangial cell"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The location of cellular injury in&nbsp;<strong>IgA nephropathy</strong> (Berger nephropathy) is the deposition of IgA antibodies in the&nbsp;<strong>mesangial cell</strong>.</p>\n<p>Mesangial cells are directly exposed to the circulation; therefore, they are affected in diseases characterized by the deposition of immune complexes.</p>\n<p><strong>Mesangial cell diseases:</strong></p>\n<ul>\n<li>IgA nephropathy</li>\n<li>IgM nephropathy</li>\n<li>Mesangioproliferative glomerulonephritis</li>\n<li>Class II lupus nephritis</li>\n<li>Diabetic nephropathy</li>\n</ul>\n<p>Note: In <strong>IgA nephropathy</strong> gross hematuria often occurs within <strong>1-2 days</strong> of onset of an upper respiratory or gastrointestinal infection. In contrast, a longer latency period of about <strong>1-2 weeks</strong> is observed in acute <strong>postinfectious glomerulonephritis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ANCA-positive , pauci-immune glomerulonephritis include-",
    "choices": [
      {
        "id": 1,
        "text": "Wegener`s granulomatosis"
      },
      {
        "id": 2,
        "text": "Microscopic polyangiitis"
      },
      {
        "id": 3,
        "text": "Churg-Strauss syndrome"
      },
      {
        "id": 4,
        "text": "All of the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Anti-neutrophil cytoplasmic antibodies </strong>(ANCA)-associated vasculitis is categorized into 3 distinct forms:&nbsp;</p>\n<ul>\n<li>Granulomatosis with polyangiitis (GPA; formerly <strong>Wegener granulomatosis</strong>)</li>\n<li><strong>Microscopic polyangiitis</strong> (MPA)</li>\n<li>Eosinophilic granulomatosis with polyangiitis, formerly called <strong>Churg&ndash;Strauss syndrome</strong> (CSS)&nbsp;</li>\n</ul>\n<p>Kidney biopsies typically demonstrate <strong>crescentic glomerulonephritis</strong> with little or <strong>no immune complex deposition.</strong>&nbsp;</p>\n<p>ANCA-associated vasculitis (AAV) comprises a group of multi-systemic diseases affecting small-to-medium-sized vessels. It is characterized by the presence of ANCA with specificity for either proteinase-3 (PR3) or myeloperoxidase (MPO).</p>\n<p>Absence or paucity of immune complex deposits in vessel walls is very characteristic, hence the name &ldquo;<strong>pauci-immune vasculitis.</strong>&rdquo;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 8-year-old girl presented with complaints of cough, hemoptysis and swelling of both legs. Urinalysis was notable for hematuria and proteinuria. Serum anti-GBM antibodies were positive. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "IgA nephropathy"
      },
      {
        "id": 2,
        "text": "Minimal change disease"
      },
      {
        "id": 3,
        "text": "Goodpasture disease"
      },
      {
        "id": 4,
        "text": "Membranous nephropathy"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The diagnosis is<strong>&nbsp;Goodpasture disease (anti-GBM&nbsp;antibody&nbsp;disease).</strong><strong>&nbsp;</strong>Anti&ndash;glomerular basement membrane<strong> (anti-GBM) antibodies</strong>&nbsp;are diagnostic.</p>\n<p><strong>\"Goodpasture syndrome\"</strong> is characterized by pulmonary haemorrhage and glomerulonephritis and<strong>&nbsp;\"Goodpasture disease\"</strong> is used for those patients with glomerulonephritis, pulmonary hemorrhage, and anti-GBM antibodies.<strong>&nbsp;</strong>It is caused due to autoantibodies directed against <strong>type IV collagen</strong>, which is present in the alveoli and glomerular basement membrane. Currently, the preferred term for both conditions is &ldquo;<strong>anti-GBM&nbsp;antibody&nbsp;disease</strong>&rdquo;.</p>\n<p>Other options along with the pathogenesis of glomerular diseases:</p>\n<ul>\n<li><strong>IgA nephropathy-</strong>&nbsp;mesangial cell disease due to immune complex deposition</li>\n<li><strong>Minimal change disease-</strong>&nbsp;epithelial cell disease due to flattening of podocytes</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 9-year-old boy has swelling of knee joints and non-blanching rashes as seen in the picture. Urine examination reveals hematuria +++ and proteinuria +. Microscopic analysis of his renal biopsy specimen is most likely to show which of the following finding?",
    "choices": [
      {
        "id": 1,
        "text": "Tubular necrosis"
      },
      {
        "id": 2,
        "text": "Visceral podocyte fusion"
      },
      {
        "id": 3,
        "text": "Mesangial deposits of IgA"
      },
      {
        "id": 4,
        "text": "Basement membrane thickening"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The boy in this clinical scenario has characteristic features of <strong>Henoch&ndash;Schonlein purpura (HSP).</strong></p>\n<p>The renal biopsy in this patient will show mesangial proliferation with<strong> mesangial deposition of IgA</strong></p>\n<ul>\n<li>HSP is a common <strong>small-vessel vasculitis</strong> in childhood.</li>\n<li>It is characterized by a <strong>purpuric rash</strong> and commonly accompanied by <strong>arthritis</strong> and<strong> abdominal pain</strong>.</li>\n<li>About half the patients with HSP develop <strong>renal manifestations</strong>, which vary from asymptomatic microscopic hematuria to severe, progressive glomerulonephritis.</li>\n<li>The nephritis associated with HSP usually follows the&nbsp;onset of the rash</li>\n<li>The pathogenesis of HSP nephritis appears to be mediated by the deposition of polymeric immunoglobulin A<strong> (IgA) in glomeruli</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6b2dc1df287a44ccb5149f47beeb0ca3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "All are features of Alport syndrome except-",
    "choices": [
      {
        "id": 1,
        "text": "Anterior lenticonus"
      },
      {
        "id": 2,
        "text": "Conductive hearing loss"
      },
      {
        "id": 3,
        "text": "Gross hematuria"
      },
      {
        "id": 4,
        "text": "Proteinuria"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Bilateral <strong>sensorineural</strong> hearing loss (<strong>not</strong> <strong>conductive</strong> hearing loss) is a feature of <strong>Alport syndrome (AS)</strong>.</p>\n<p>AS or hereditary nephritis is a genetic disease (most have X-linked inheritance) caused by mutations in the genes coding for<strong> type IV collagen</strong>, a major component of the basement membranes.</p>\n<p>Clinical features of Alport syndrome:</p>\n<ul>\n<li><strong>Hematuria:</strong> All patients have asymptomatic microscopic hematuria. Recurrent episodes of gross hematuria may be seen 1-2 days after an upper respiratory infection.</li>\n<li>Bilateral sensorineural hearing loss (not conductive)</li>\n<li>Ocular abnormalities:<strong> anterior lenticonus</strong>, macular flecks, corneal erosions</li>\n<li><strong>Proteinuria</strong>: Progressive proteinuria, often exceeding 1 g/ 24 hrs, is common by the 2<sup>nd</sup> decade of life.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 16-year-old boy presented with dark coloured urine. Urinalysis was notable for macroscopic hematuria and heavy proteinuria. His father is a known case of Alport syndrome. What defect is responsible for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Fibrillin"
      },
      {
        "id": 2,
        "text": "Type IV collagen"
      },
      {
        "id": 3,
        "text": "Amyloid"
      },
      {
        "id": 4,
        "text": "Tau"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>defect in type IV collagen</strong>, a major component of the basement membrane, is responsible for <strong>Alport syndrome.</strong></p>\n<p>Alport syndrome&nbsp;is a genetically heterogeneous disease, <strong>85% is X-linked</strong> and the rest may be autosomal recessive or autosomal dominant.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following syndromes are associated with renal disease except _______.",
    "choices": [
      {
        "id": 1,
        "text": "Lowe syndrome"
      },
      {
        "id": 2,
        "text": "Denys-Drash syndrome"
      },
      {
        "id": 3,
        "text": "Alport syndrome"
      },
      {
        "id": 4,
        "text": "Sinding-Larsen-Johansson syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Sinding&ndash;Larsen&ndash;Johansson syndrome is an insertional periostitis at the inferior pole of the patella (<strong>not&nbsp;associated with Renal disease</strong>).</p>\n<table>\n<tbody>\n<tr>\n<td><strong>Lowe syndrome&nbsp;</strong></td>\n<td>\n<p><strong>Oculocerebrorenal&nbsp;syndrome</strong>:&nbsp;Hypotonia,&nbsp;renal disease&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td><strong><strong>Denys</strong></strong><strong>&ndash;Drash&nbsp;Syndrome</strong>&nbsp;</td>\n<td>\n<p>Associated&nbsp;with&nbsp;<strong>Wilm's&nbsp;tumor</strong>:&nbsp;</p>\n<p>Early-onset renal failure with renal mesangial sclerosis, male&nbsp;pseudohermaphroditism&nbsp;</p>\n</td>\n</tr>\n<tr>\n<td><strong>Alport&nbsp;syndrome&nbsp;</strong></td>\n<td>Bilateral sensorineural<strong>&nbsp;hearing loss,&nbsp;renal&nbsp;disease</strong>&nbsp;</td>\n</tr>\n<tr>\n<td><strong><strong>Sinding</strong></strong><strong><strong>&ndash;Larsen</strong></strong><strong>&ndash;Johansson syndrome&nbsp;</strong></td>\n<td><strong>Periostitis</strong>&nbsp;at the inferior pole of the patella&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Microalbuminuria is defined as a urinary albumin excretion rate of _______.",
    "choices": [
      {
        "id": 1,
        "text": "30-300 mg/ 24 hrs"
      },
      {
        "id": 2,
        "text": "> 300 mg/ 24 hrs"
      },
      {
        "id": 3,
        "text": "> 150 mg/ 24 hrs"
      },
      {
        "id": 4,
        "text": "> 300 \u00b5g/ 24 hrs"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Microalbuminuria is defined as a urinary albumin excretion rate of <strong>30&ndash;300 mg/24 hrs</strong>.</p>\n<p>Here, the presence of albumin in the urine is above the normal level but below the detectable range for the urine-dipstick methods. It is commonly associated with <strong>glomerular hyperfiltration and blood pressure elevation</strong>.&nbsp;</p>\n<p>In <strong>adults</strong>,&nbsp;persistent microalbuminuria indicates <strong>diabetic nephropathy</strong> and is also a predictor of cardiovascular and renal disease.</p>\n<p>In<strong> children</strong>,&nbsp;microalbuminuria is associated with <strong>obesity</strong> and predicts the development of<strong> diabetic nephropathy</strong> in type 1 diabetes mellitus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy presents with facial puffiness and frothy urine. Upon investigating, his urine was positive for proteins with no hematuria and no RBC casts. To conclude the diagnosis of nephrotic syndrome, the range of proteinuria is defined as >_____ mg/m2/hr and urine protein:creatinine ratio of >________.",
    "choices": [
      {
        "id": 1,
        "text": "40 and 2"
      },
      {
        "id": 2,
        "text": "30 and 1.5"
      },
      {
        "id": 3,
        "text": "3.5 and 2"
      },
      {
        "id": 4,
        "text": "4 and 1.5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>&nbsp;The currently accepted definitions of&nbsp; &ldquo;<strong>nephrotic range proteinuria</strong>&rdquo; include:</p>\n<ul>\n<li>Urine protein: creatinine ratio<strong> &gt; 2</strong></li>\n<li>Urine protein<strong> &gt; 40 mg/m2/hr</strong></li>\n<li>Urine protein 3+ or 4+ in dipstick test</li>\n</ul>\n<p>As a consequence of the large urinary loss of protein, the patient develops hypoalbuminemia (&lt; 2.5 g/dL) and gross edema.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "It is expected to see all of the following clinical features in a 5-year-old boy with nephrotic syndrome except-",
    "choices": [
      {
        "id": 1,
        "text": "Hypoalbuminemia"
      },
      {
        "id": 2,
        "text": "Hyperlipidemia"
      },
      {
        "id": 3,
        "text": "Hematuria"
      },
      {
        "id": 4,
        "text": "Edema"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hematuria</strong> is not a usual feature of nephrotic syndrome. It is a&nbsp;feature of <strong>nephritic syndrome. </strong>However, occasionally it is seen in the FSGS variant of nephrotic syndrome as well.</p>\n<p>Classic features of <strong>nephrotic syndrome</strong>:</p>\n<ul>\n<li>Nephrotic range proteinuria ( &gt;40mg/m2/hr urine protein: creatinine ratio &gt;2)&nbsp;</li>\n<li>Hypoalbuminemia<strong> (&lt;2.5 g/dL) </strong></li>\n<li>Edema</li>\n<li>Hyperlipidemia <strong>(cholesterol &gt; 200 mg/dL)</strong></li>\n<li>Hypercoagulability</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of nephrotic syndrome in children?",
    "choices": [
      {
        "id": 1,
        "text": "Minimal change disease"
      },
      {
        "id": 2,
        "text": "Membranous nephropathy"
      },
      {
        "id": 3,
        "text": "IgA nephropathy"
      },
      {
        "id": 4,
        "text": "Alport syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The <strong>commonest cause</strong> of nephrotic syndrome in children is <strong>minimal change disease</strong>. (85% of cases).</p>\n<p>The glomeruli appear almost normal on microscopy, hence the name. Immunofluorescence microscopy are negative, and electron microscopy shows effacement of the epithelial cell foot processes.</p>\n<p><strong>Treatment:</strong> Steroids; 95% of patients respond.</p>\n<p>Other options:</p>\n<ul>\n<li><strong>Membranous nephropathy</strong> is the most common cause of nephrotic syndrome in the <strong>elderly</strong>; it is a rare cause of nephrotic syndrome in children.</li>\n<li><strong>Alport syndrome</strong> or hereditary nephritis: All patients have asymptomatic hematuria; progressive proteinuria is common only by the 2nd decade of life and can be severe enough to cause nephrotic syndrome. This nephrotic syndrome is&nbsp;<strong>not common</strong> in children.</li>\n<li><strong>IgA nephropathy</strong> presents more commonly as an acute nephritic syndrome or with asymptomatic hematuria. It presents with nephrotic syndrome quite <strong>rarely</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A  5-year-old child was brought to the hospital with complaints of progressive swelling around the eyes, abdomen and feet for 2 weeks. On investigating, his urine was positive for 4+ proteinuria with absent hematuria. A spot urine protein: creatinine ratio was reported to be 2.5. His serum albumin was 2.3 g/dL and serum creatinine was 0.5 mg/dL. Serum cholesterol and triglyceride levels were also elevated. A diagnosis of nephrotic syndrome was concluded. Which of the following correctly mentions the aetiology of its most common variant in children?",
    "choices": [
      {
        "id": 1,
        "text": "Flattening of podocytes"
      },
      {
        "id": 2,
        "text": "Immune complex deposition"
      },
      {
        "id": 3,
        "text": "Anti\u2013GBM antibodies"
      },
      {
        "id": 4,
        "text": "Endothelial cell disease"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<ul>\n<li>Here, the glomeruli appear normal or show a minimal increase in mesangial cells and matrix.</li>\n<li>It is the most common cause of nephrotic syndrome in children.</li>\n<li>Epithelial cells, in conjunction with the basement membrane, allow the filtration of plasma solutes but block the passage of cells and plasma proteins. Hence, this epithelial cell disease, <strong>disrupts the filtration barrier</strong>, resulting in <strong>proteinuria</strong>.</li>\n<li>More than 95% of children with minimal change disease<strong> respond to corticosteroid therapy</strong>.</li>\n</ul>\n<p><strong>Causes of epithelial cell injury:&nbsp;</strong></p>\n<ul>\n<li>Minimal change disease</li>\n<li>Membranous nephropathy</li>\n<li>Focal segmental glomerulosclerosis</li>\n<li>Class V lupus nephritis</li>\n<li>Diabetic nephropathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/37160e17765c44448c06fe828b0385b6x1280x1222.PNG"
    ]
  },
  {
    "text": "Which of the following is not a cause of hypercoagulability in nephrotic syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Vascular stasis due to hemoconcentration and intravascular volume depletion"
      },
      {
        "id": 2,
        "text": "Increase in hepatic production of fibrinogen"
      },
      {
        "id": 3,
        "text": "Urinary loss of antithrombin III and protein S"
      },
      {
        "id": 4,
        "text": "Decreased platelet number and aggregability"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Increased&nbsp;</strong>(and not decreased)<strong>&nbsp;</strong>platelet number and aggregability cause hypercoagulability in <strong>nephrotic syndrome</strong>.<br /><br />Hypercoagulability in nephrotic syndrome is due to all of the following factors:</p>\n<ul>\n<li><strong>Vascular stasis</strong> due to hemoconcentration and intravascular volume depletion</li>\n<li>Increase in hepatic production of <strong>fibrinogen</strong></li>\n<li>Urinary <strong>loss of antithrombin III and protein S</strong></li>\n<li><strong>Increased </strong>platelet number and aggregability</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old boy presents with facial oedema that has now progressed to total body swelling involving the face, abdomen, scrotum, and feet. Urinalysis revealed protein 4+ and serum cholesterol was also elevated. What is the initial treatment of choice?",
    "choices": [
      {
        "id": 1,
        "text": "Prednisolone"
      },
      {
        "id": 2,
        "text": "Cyclophosphamide"
      },
      {
        "id": 3,
        "text": "Levamisole"
      },
      {
        "id": 4,
        "text": "Cyclosporine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical picture and investigations are highly suggestive of <strong>minimal change nephrotic syndrome</strong> and the initial treatment of choice is corticosteroids such as <strong>prednisolone.</strong></p>\n<p>Minimal change nephrotic syndrome is the <strong>most common cause of nephrotic syndrome</strong>. It is seen in <strong>ages 2-6 years</strong> with a clinical picture of nephrotic syndrome, that is, heavy proteinuria, oedema, hypoalbuminemia and hyperlipidemia. They may be asymptomatic or can present with <strong>peripheral oedema</strong>. Renal biopsy is not required for confirmation and treatment can be initiated if the child fits the standard clinical picture of nephrotic syndrome.</p>\n<p>They show <strong>excellent response to steroid</strong> therapy with prednisone or prednisolone. A daily dose of 2mg/kg (max 60mg) for 6 weeks followed by an alternate dose of 1.5mg/kg (max 40mg) for the next 6-8 weeks is recommended.</p>\n<p>Alternative drugs used in steroid-dependent patients, frequent relapsers, steroid-resistant patients, and those with severe corticosteroid toxicity are as follows:</p>\n<ul>\n<li>Cyclophosphamide</li>\n<li>Calcineurin inhibitors: Cyclosporine and Tacrolimus</li>\n<li>Mycophenolate</li>\n<li>Levamisole</li>\n<li>Rituximab (chimeric monoclonal antibody against CD20)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Steroid-resistant nephrotic syndrome is defined as failure to achieve remission after _____ weeks of corticosteroid therapy.",
    "choices": [
      {
        "id": 1,
        "text": "12"
      },
      {
        "id": 2,
        "text": "8"
      },
      {
        "id": 3,
        "text": "6"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Steroid-resistant nephrotic syndrome is defined as failure to achieve remission after <strong>6</strong><strong>\u00a0weeks</strong> of corticosteroid therapy.</p>\n<p>According to the latest Indian Society of Pediatric nephrology(ISPN) guidelines, it is defined as the absence of remission\u00a0despite 6-weeks therapy with prednisolone at daily dose of 60mg/m<sup>2\u00a0\u00a0</sup></p>\n<div class=\"page\" title=\"Page 3\">\u00a0</div>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child suffering from steroid-dependent nephrotic syndrome is brought to the OPD for vaccination. Which of the following is true about vaccination in this child?",
    "choices": [
      {
        "id": 1,
        "text": "All live vaccines under NIS can be given as per schedule"
      },
      {
        "id": 2,
        "text": "All killed vaccines under NIS can be given"
      },
      {
        "id": 3,
        "text": "Only pneumococcal vaccine should be given to the child in acute phase"
      },
      {
        "id": 4,
        "text": "Live vaccines are contraindicated in the child\u2019s sibling"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In a child with steroid-dependent nephrotic syndrome, <strong>all</strong> <strong>killed vaccines</strong> can be given.</p>\n<p>Option A:<strong> Live virus</strong> vaccines are <strong>administered with caution</strong> in children receiving <strong>corticosteroid therapy</strong>. They can be given to patients in whom the prednisone<strong> dose is below</strong> <strong>1mg/kg daily</strong> or <strong>2mg/kg on alternate days</strong>. If the patient is receiving <strong>corticosteroid-sparing agents</strong> (cyclophosphamide, cyclosporine), <strong>live virus vaccines</strong> are <strong>contraindicated</strong>.\u00a0</p>\n<p>Option C: Only live vaccines are contraindicated in this child. Full <strong>pneumococcal</strong> vaccination (with the 13-valent conjugate vaccine and 23-valent polysaccharide vaccine) and <strong>influenza</strong> vaccination can be given <strong>annually</strong> to the <strong>child</strong> and their <strong>household contacts</strong>.</p>\n<p>Option D: <strong>Immunization</strong> of<strong> siblings/healthy household contacts</strong> with <strong>live vaccines</strong> is <strong>necessary</strong> to reduce the risk of infection transmission to the immunosuppressed child.\u00a0Direct exposure to the gastrointestinal/respiratory secretions of the household contacts is avoided for about 3-6 weeks after vaccination.\u00a0</p>\n<p><strong>Minimal change</strong> nephrotic syndrome is the\u00a0<strong>most common cause of nephrotic syndrome</strong>. It is\u00a0characterized by heavy <strong>proteinuria</strong>, <strong>edema</strong>, <strong>hypoalbuminemia</strong>, and <strong>hyperlipidemia</strong>.\u00a0The diagnosis is confirmed by performing a urinalysis and urine protein: creatinine ratio. Nephrotic range proteinuria is<strong> proteinuria greater than 3.5 g per 24 hours</strong> (3+ or 4+) or a <strong>urine protein : creatinine ratio</strong> exceeding<strong> 2</strong>.</p>\n<p>The recommended initial treatment for nephrotic syndrome is a <strong>daily dose of 2mg/kg</strong> (max 60mg) of <strong>prednisolone</strong> for <strong>6 weeks</strong> followed by an <strong>alternate dose of 1.5mg/kg</strong> (max 40mg) for the <strong>next 6-8 weeks</strong>.\u00a0</p>\n<p>Definitions regarding the course of nephrotic syndrome:\u00a0</p>\n<ul>\n<li><strong>Frequently relapsing</strong> nephrotic syndrome: \u22652 relapses in 6 months or 3 or more relapses in 12 months.</li>\n<li><strong>Steroid-dependent</strong> nephrotic syndrome: Relapse during steroid tapering or within 2 weeks of discontinuation.</li>\n<li><strong>Steroid resistance</strong>: Failure to achieve remission despite therapy with daily prednisolone for 6 weeks\u00a0</li>\n</ul>\n<p><strong>Alternative drugs</strong> used in steroid-dependent patients, frequent relapsers, steroid-resistant patients, and those with severe corticosteroid toxicity are cyclophosphamide, calcineurin inhibitors: cyclosporine and Tacrolimus, mycophenolate, levamisole, and rituximab (a chimeric monoclonal antibody against CD20).\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Congenital nephrotic syndrome is defined as nephrotic syndrome manifesting ______.",
    "choices": [
      {
        "id": 1,
        "text": "At birth"
      },
      {
        "id": 2,
        "text": "At birth or within 3 months of life"
      },
      {
        "id": 3,
        "text": "At birth or within 6 months of life"
      },
      {
        "id": 4,
        "text": "At birth or within 1 year of life"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Congenital nephrotic syndrome</strong> is defined as nephrotic syndrome manifesting <strong>at birth or within 3 months of life</strong>.</p>\n<p>It may be</p>\n<ul>\n<li><strong>Primary</strong>:&nbsp;Due to inherited disorders caused by mutations in <em>NPHS 1</em>, <em>NPHS 2</em>, <em>WT1</em>, or <em>LAMB2</em>.</li>\n<li><strong>Secondary</strong>:&nbsp;Due to in utero infections like cytomegalovirus infection, toxoplasmosis, syphilis, HIV infection, hepatitis B virus or&nbsp;hepatitis C virus HCV infection, infantile systemic lupus erythematosus (SLE), or mercury exposure.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 11-year-old boy with a chronic hepatitis B infection develops nephrotic syndrome. What would be the most likely pathology encountered in renal biopsy of this child?",
    "choices": [
      {
        "id": 1,
        "text": "Focal Segmental Glomerular Sclerosis"
      },
      {
        "id": 2,
        "text": "Membrano proliferative Glomerulonephritis"
      },
      {
        "id": 3,
        "text": "Anti GBM disease"
      },
      {
        "id": 4,
        "text": "Membranous nephropathy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario suggests that the pathology would be <strong>membranous nephropathy</strong>. Membranous&nbsp;nephropathy can be secondarily caused&nbsp;by <strong>Hepatitis B</strong> infection.</p>\n<p><strong>Membranous nephropathy:</strong></p>\n<p>Membranous nephropathy is a rare cause of <strong>nephrotic syndrome</strong> in children.</p>\n<ul>\n<li>It is classified as the primary, idiopathic form, where there is an isolated renal disease, or secondary, where nephropathy is associated with other identifiable systemic diseases or medications</li>\n<li>In children, secondary form is far more common. The most common etiologies of secondary form are <strong>systemic lupus erythematosus</strong> or chronic infections. Among the latter, chronic hepatitis B infection and <strong>congenital syphilis</strong> are the best characterized and recognized causes.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Finnish-type congenital nephrotic syndrome is caused by a mutation in the _____ gene.",
    "choices": [
      {
        "id": 1,
        "text": "NPHS 1 (nephrin)"
      },
      {
        "id": 2,
        "text": "NPHS 2 (podocin)"
      },
      {
        "id": 3,
        "text": "WT 1 (Wilms tumor suppressor gene)"
      },
      {
        "id": 4,
        "text": "LMX1B"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Finnish type congenital nephrotic syndrome</strong> is a steroid-resistant nephrotic syndrome caused by a&nbsp;mutation in the<strong> nephrin</strong> gene (<strong>NPHS 1</strong>).</p>\n<ul>\n<li>Affected infants usually present at birth with edema caused by massive proteinuria.</li>\n<li>They are delivered with a large placenta (&gt;25% of the infant&rsquo;s weight).</li>\n<li>There is severe hypoalbuminemia, hyperlipidemia,&nbsp;and hypogammaglobulinemia.</li>\n<li>Prenatal diagnosis can be made by elevated maternal and amniotic &alpha;-fetoprotein levels.</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td><strong>Gene</strong>&nbsp;</td>\n<td><strong>Name</strong></td>\n<td><strong>Inheritance</strong></td>\n<td><strong>Renal disease</strong></td>\n</tr>\n<tr>\n<td><em>NPHS1</em></td>\n<td>Nephrin</td>\n<td>Recessive</td>\n<td>Finnish-type congenital nephrotic syndrome</td>\n</tr>\n<tr>\n<td><em>NPHS2</em></td>\n<td>Podocin</td>\n<td>Recessive</td>\n<td>Focal segmental glomerulosclerosis (FSGS)</td>\n</tr>\n<tr>\n<td><em>WT1</em></td>\n<td>Wilms&nbsp;tumor-suppressor gene</td>\n<td>Dominant</td>\n<td>Denys&ndash;Drash&nbsp;syndrome with diffuse mesangial sclerosis Frasier syndrome with FSGS</td>\n</tr>\n<tr>\n<td><em>LMX1B</em></td>\n<td>LIM-homeodomain protein</td>\n<td>Dominant</td>\n<td>Nail&ndash;patella syndrome</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "FSGS is caused by mutations in the _____ gene.",
    "choices": [
      {
        "id": 1,
        "text": "NPHS 1 (nephrin)"
      },
      {
        "id": 2,
        "text": "NPHS 2 (podocin)"
      },
      {
        "id": 3,
        "text": "WT 1 (Wilms tumor suppressor gene)"
      },
      {
        "id": 4,
        "text": "LMX1B"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<ul>\n<li>focal segmental glomerulosclerosis (FSGS) is caused by mutation in <strong><em>NPHS2</em> (podocin) gene</strong>.</li>\n<li>Steroid resistant nephrotic syndrome is usually caused by FSGS (in 80% of cases).</li>\n<li>In FSGS, glomeruli show lesions of mesangial cell proliferation and segmental scarring that are both focal (present only in a proportion of glomeruli) and segmental (localized to &ge;1 intraglomerular tufts).</li>\n<li>FSGS is associated with a 50% risk for end-stage kidney disease.</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td><strong>Gene</strong>&nbsp;</td>\n<td><strong>Name</strong></td>\n<td><strong>Inheritance</strong>&nbsp;</td>\n<td><strong>Renal disease </strong></td>\n</tr>\n<tr>\n<td><em>NPHS1</em></td>\n<td>Nephrin</td>\n<td>Recessive</td>\n<td>Finnish-type congenital nephrotic syndrome</td>\n</tr>\n<tr>\n<td><em>NPHS2</em></td>\n<td>Podocin</td>\n<td>Recessive</td>\n<td>Focal segmental glomerulosclerosis (FSGS)</td>\n</tr>\n<tr>\n<td><em>WT1</em></td>\n<td>Wilms&nbsp;tumor-suppressor gene</td>\n<td>Dominant</td>\n<td>Denys&ndash;Drash&nbsp;syndrome with diffuse mesangial sclerosis Frasier syndrome with FSGS</td>\n</tr>\n<tr>\n<td><em>LMX1B</em></td>\n<td>LIM-homeodomain protein</td>\n<td>Dominant</td>\n<td>Nail&ndash;patella syndrome</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '27 Pediatric Nephrology';
        const quizFilename = '27-pediatric-nephrology-b483fb27.html';
        let hierarchy = ["Marrow", "qBank", "Pediatrics"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>