<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Test 4 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2021-22
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A farmer was rushed to the emergency after sustaining a sting on his right calf. The patient is conscious and oriented with stable vitals. On local examination of the wound, there is a hole in the center of a reddened area along with edema, pain, and reddening of the limb. There is no history of nausea, vomiting, or seizures. The agent responsible for the sting is shown below. Which of the following snakebites is similar to this organism's sting?",
    "choices": [
      {
        "id": 1,
        "text": "King cobra"
      },
      {
        "id": 2,
        "text": "Sea snake"
      },
      {
        "id": 3,
        "text": "Russell's Viper"
      },
      {
        "id": 4,
        "text": "Common krait"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The clinical stem with the image showing a scorpion points to a scorpion sting. The clinical findings of edema and pain of the limb with no neurological symptoms are consistent with <strong>hemolytic venom</strong> which is similar to that of <strong>Russel's viper</strong>.</p>\n<p>Scorpions are\u00a0eight-legged arthropods that have a hollow sting in the last joint of their tail, which secretes poison on stinging. The venom is a clear, colorless toxalbumen and is generally classified as either <strong>hemolytic</strong> or <strong>neurotoxic</strong>.\u00a0</p>\n<p>The venom causes autonomic stimulation resulting in the release of massive amounts of catecholamines from the adrenals. It also has a direct effect on the myocardium.</p>\n<p>It can present as neurotoxicity with\u00a0nausea, vomiting, extreme restlessness, fever, various types of paralysis, cardiac arrhythmias, convulsions, coma and cyanosis, respiratory depression, and death that occurs as a result of pulmonary edema or cardiac failure. This is similar to that of a cobra bite.</p>\n<p>If the scorpion has hemolytic venom it mimics a viper bite where the reaction is mainly local, with edema, pain, and reddening. This usually lasts for one to two hours.\u00a0</p>\n<p>Diagnosis is confirmed with ELISA.</p>\n<p><strong>Treatment</strong>:</p>\n<ul>\n<li>The limb involved is immobilized and a tourniquet is secured above the level of sting.\u00a0</li>\n<li>The sting is packed in ice and the wound is washed with a weak solution of ammonia, borax, or potassium permanganate after incision and suction</li>\n<li>Local anesthetics may be used for pain relief</li>\n<li>Specific antivenin is administered if species are identified.</li>\n<li>Local swelling is controlled with the use of calcium gluconate</li>\n<li>Restlessness and seizures are controlled with the use of barbiturates. The use of morphine is contraindicated.</li>\n<li>Atropine is used for the prevention of pulmonary edema.</li>\n<li><strong>Prazosin\u00a0</strong>can counteract the alpha-adrenergic effects of autonomic stimulation, such as hypertension</li>\n</ul>\n<p>Other options :</p>\n<p>Options A and D - The <strong>king cobra</strong> and the <strong>common krait</strong> have a venom that is <strong>neurotoxic</strong>. They present with nausea, vomiting, restlessness, fever, arrhythmias, and seizures.</p>\n<p>Option B - <strong>Sea snake</strong> which is <strong>myotoxic</strong>. The main presentation is generalized rhabdomyolysis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a3848ef8f2804a9abff37ee51fcaec64.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following pairs is incorrect?",
    "choices": [
      {
        "id": 1,
        "text": "Rosenbach sign - Pulsations of the liver"
      },
      {
        "id": 2,
        "text": "Traube's sign - Pulsations of the spleen"
      },
      {
        "id": 3,
        "text": "Becker's sign - Retinal artery pulsation"
      },
      {
        "id": 4,
        "text": "Muller sign - Systolic pulsations of uvula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The incorrect pair is Traube's sign - Pulsations of the spleen.\u00a0<strong>Traube's</strong> sign is a\u00a0<strong>pistol shot</strong> sound heard over <strong>femoral arteries</strong>.\u00a0</p>\n<p><strong>Aortic regurgitation (AR)</strong>.\u00a0</p>\n<p>Aortic regurgitation (AR) is a valvular disease of the aortic valve caused by primary valve disease, aortic root disease or their combination.</p>\n<p>Auscultatory findings in AR are:</p>\n<ul>\n<li>Soft S1 - due to the early closure of the mitral valve</li>\n<li><strong>Diminished or absent A2</strong></li>\n<li>S3 - due to increased left ventricular (LV) end-diastolic volume. The presence of S3 may be a sign of impaired LV function.</li>\n<li><strong>Early diastolic murmur -</strong>\n<ul>\n<li><strong>High-pitched</strong>, blowing, decrescendo,\u00a0<strong>early diastolic murmur</strong></li>\n<li>Best heard in the left third intercostal space</li>\n<li>Heard with the patient sitting up and leaning forward, with breath held in forced expiration</li>\n<li><strong>Duration</strong>\u00a0of the murmur best correlates with the severity</li>\n</ul>\n</li>\n<li>Systolic ejection murmur - It is heard due to increased LV stroke volume and ejection rate.</li>\n<li><strong>Austin Flint murmur\u00a0</strong>- a\u00a0<strong>low-pitched</strong>, mid to late diastolic murmur. It is caused due to the large volume of regurgitant blood, hitting the anterior leaflet of the mitral valve or LV wall.</li>\n</ul>\n<p>Other signs :</p>\n<ul>\n<li><strong>Pulsations</strong> of the <strong>spleen</strong>,\u00a0detected in the presence of splenomegaly are called\u00a0<strong>Gerhardt\u2019s sign.</strong> (Option B)</li>\n<li><strong>Rosenbach sign</strong>\u00a0is seen in AR where<strong>\u00a0</strong>pulsations are felt over the <strong>liver </strong>(Option A)</li>\n<li><strong>Becker's sign </strong>is the presence of<strong> retinal artery </strong>pulsation on fundoscopy<strong>.</strong> (Option C)</li>\n<li><strong>Systolic pulsations of uvula </strong>is known as<strong>\u00a0Muller's sign. </strong>(Option D)</li>\n</ul>\n<p>Treatment of aortic regurgitation:</p>\n<ul>\n<li>In non-severe AR, periodic monitoring can be done. The symptoms of dyspnea and decreased cardiac output can be managed by diuretics and vasodilators.</li>\n<li>In severe AR, surgery is indicated in the following conditions:\n<ul>\n<li>The patient is symptomatic</li>\n<li>The patient is asymptomatic, but the LV ejection fraction is less than 50% or LV end-diastolic diameter is more than 65mm.</li>\n<li>The patient is asymptomatic and undergoing other cardiac surgeries.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the type of Mapleson\u2019s circuit shown in the image below.",
    "choices": [
      {
        "id": 1,
        "text": "Type A"
      },
      {
        "id": 2,
        "text": "Type B"
      },
      {
        "id": 3,
        "text": "Type C"
      },
      {
        "id": 4,
        "text": "Type D"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above image shows <strong>Mapleson\u2019s Type B</strong> breathing circuit. There is the presence of a corrugated tube, and the fresh gas flow and valve are located near the patient.</p>\n<p><strong>Mapleson\u2019s breathing systems</strong> are used for delivering <strong>oxygen</strong> and <strong>anesthetic agents</strong> and eliminating <strong>carbon dioxide</strong>\u00a0during anesthesia. They consist of different <strong>components</strong>: Fresh gas flow, reservoir bag, breathing tubes, expiratory valve, and patient connection.</p>\n<p>There are six types of Mapleson\u2019s circuits denoted by A \u2013 F.</p>\n<p>Other options:</p>\n<p>Option A - In Mapleson type A circuits, the <strong>fresh gas flow</strong> enters through the <strong>opposite end</strong> of the circuit near the reservoir bag. They have a spring-loaded pop-off <strong>valve</strong> located near the <strong>patient. </strong>It is the most efficient for\u00a0<strong>spontaneous ventilation</strong>.</p>\n<p>Option C - Type C Mapleson circuits are similar to Type B circuits, but they do not have the corrugated tube.</p>\n<p>Option D - Type D\u00a0 circuits have <strong>fresh gas flow</strong> is near the <strong>patient end</strong>, and excess gas is vented off at the opposite end of the circuit. It is the most efficient for\u00a0<strong>controlled ventilation.</strong></p>\n<div class=\"page\" title=\"Page 74\">\u00a0</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3d2ed41322034d9a89be8253638d34fc.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A radiology consultant advises you to use a water-soluble contrast media having an iodine particle ratio of 6:1 in a patient referred for a radiological investigation. Which of the following contrast media will you prefer?",
    "choices": [
      {
        "id": 1,
        "text": "Ionic monomer"
      },
      {
        "id": 2,
        "text": "Ionic dimer"
      },
      {
        "id": 3,
        "text": "Non-ionic monomer"
      },
      {
        "id": 4,
        "text": "Non-ionic Dimer"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Non-ionic Dimers</strong>&nbsp;have an Iodine: particle ratio of <strong>6:1</strong></p>\n<p>Contrast agents can be divided into water-soluble (iodine-containing) and non-water-soluble (barium) compounds.</p>\n<p><strong>Classification of iodinated contrast:</strong></p>\n<ul>\n<li>Ionic &ndash; Monomer and dimer</li>\n<li>Non-ionic&ndash; Monomer and dimer</li>\n</ul>\n<p>Other options:</p>\n<ul>\n<li><strong>Ionic monomers</strong>&nbsp;have an Iodine: particle ratio of <strong>3:2</strong></li>\n<li><strong>Ionic Dimers</strong>&nbsp;have an Iodine: particle ratio of <strong>6:2 or 3:1</strong></li>\n<li><strong>Non-ionic monomers</strong>&nbsp;have an Iodine: particle ratio of <strong>3</strong><strong>:1</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old man comes to the psychiatric outpatient department complaining of depression and loneliness. History taking reveals that he does not engage in any social activity because he\u2019s afraid of being rejected. Identify the likely personality disorder in this patient:",
    "choices": [
      {
        "id": 1,
        "text": "Avoidant personality disorder"
      },
      {
        "id": 2,
        "text": "Paranoid personality disorder"
      },
      {
        "id": 3,
        "text": "Schizoid personality disorder"
      },
      {
        "id": 4,
        "text": "Antisocial personality disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given scenario is suggestive of&nbsp;<strong>avoidant personality disorder,</strong> as the patient does not engage in social activities due to <strong>fear of being rejected.</strong></p>\n<p>Avoidant personality disorder is characterized by extreme sensitivity to rejection leading to socially withdrawn lives, <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">low levels of energy, easy fatigability, lack of enthusiasm, and inability to enjoy life.</span></p>\n<p><strong>Other options</strong>:</p>\n<p>Option B<strong>: </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>Paranoid personality disorder</strong> is characterized by unwarranted suspicion, hypersensi&shy;tivity, jealousy, envy, rigidity, excessive self-importance, and a tendency to blame and ascribe evil motives to others.</span></p>\n<p>&nbsp;Option C<strong>: </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>Schizoid personality disorder</strong> is characterized by shyness, oversensitivity, seclusive&shy; ness, avoidance of close or competitive relationships, eccentric&shy;ity, no loss of capacity to recognize reality, daydreaming, and an ability to express hostility and aggression.</span></p>\n<p>&nbsp;Option D: <span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"><strong>Antisocial personal&shy;ity disorder</strong> covers persons in conflict with society. They are incapable of loyalty, selfish, callous, irresponsible, impulsive, and unable to feel guilt or learn from experience; they have low levels of frustration tolerance and a tendency to blame others.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following lesions in tuberous sclerosis show hyperplastic blood vessels and sebaceous glands of immature hair follicles on histopathological examination?",
    "choices": [
      {
        "id": 1,
        "text": "Ash leaf macules"
      },
      {
        "id": 2,
        "text": "Angiofibroma"
      },
      {
        "id": 3,
        "text": "Koenen\u2019s tumor"
      },
      {
        "id": 4,
        "text": "Shagreen patches"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Angiofibromas</strong> show <strong>hyperplastic blood vessels</strong> and <strong>sebaceous glands of immature hair follicles</strong> on histopathological examination.</p>\n<p>The characteristic findings of various lesions of tuberous sclerosis are as follows:</p>\n<p><strong>Ash leaf macules: </strong>They are <strong>ovoid </strong>or<strong> leaf-shaped hypopigmented</strong> macules.&nbsp;Histopathology will show abnormal melanocytes that have reduced tyrosinase activity. Electron microscopy would reveal defective melanization of melanosomes.</p>\n<p>The following image shows an ash-leaf macule:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/499bbe0a6638489198cb4c4ad738c4afx512x669.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4d0d33e95eb04b839d642442e698a151x720x416.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f6a704594b64b30aa6a559ded5c8eedx1279x747.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8bc02be8db4a4234bc744e17e4843dbdx1280x1100.JPEG"
    ]
  },
  {
    "text": "The given image depicts Brown-Sequard syndrome. The part marked as 1 is the site of the lesion. Which of the following is inappropriately matched?",
    "choices": [
      {
        "id": 1,
        "text": "2 - loss of proprioception"
      },
      {
        "id": 2,
        "text": "1 - hemisection of cord"
      },
      {
        "id": 3,
        "text": "3 - loss of discriminative touch"
      },
      {
        "id": 4,
        "text": "2  - paralysis of muscles"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The part marked 3 is incorrectly matched.<strong> Discriminative touch (also known as fine touch)</strong> is lost on the <strong>ipsilateral side </strong>of the lesion in Brown Sequard syndrome.</p>\n<p>The part marked as 1 is the site of the lesion, at which <strong>hemisection</strong> of the cord is seen.</p>\n<p>The part marked as 2 is the <strong>ipsilateral side</strong> of the lesion, which has the following features.</p>\n<ul>\n<li>Loss of proprioception and vibration</li>\n<li>Loss of discriminative touch</li>\n<li>Weakness and spastic type of paralysis in certain muscle groups</li>\n</ul>\n<p>The part marked as 3 is the <strong>contralateral side</strong> of the lesion and exhibits the following features</p>\n<ul>\n<li>Loss of pain and temperature beginning one or two segments below the side of the lesion</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ccd22dd1257341de85148ba5016cbf44.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "With respect to the Lineweaver- Burk plot shown for a given enzyme and inhibitor, which of the following happens on increasing inhibitor concentration?",
    "choices": [
      {
        "id": 1,
        "text": "Decrease in binding affinity of substrate to enzyme"
      },
      {
        "id": 2,
        "text": "Decrease in the Km value of the enzyme"
      },
      {
        "id": 3,
        "text": "Decrease in the slope of red line"
      },
      {
        "id": 4,
        "text": "Decrease in the maximum number of product molecules catalyzed per second"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>The red line</strong>\u00a0in the graph represents a reaction with a\u00a0<strong>noncompetitive inhibitor</strong>. Increasing inhibitor concentration will lead to a decrease in the maximum number of product molecules catalyzed per second.</p>\n<p>In non-competitive inhibition, the inhibitor binds the enzyme other than the active site. It causes a change in the activity of enzymes, as a result of which reaction is not catalyzed. The total number of products hence formed are lesser. It however <strong>does not affect </strong>the <strong>affinity</strong> (represented by Km value) of the enzyme to bind the substrate.</p>\n<p>This can be plotted on a graph. 1/v<sub>0</sub> is plotted versus 1/[S] and a straight line is obtained. This plot can be used to calculate K<sub>m</sub> and V<sub>max</sub> as well as to determine the mechanism of action of enzyme inhibitors where\u00a0v<sub>0</sub> is the reaction velocity and [S] is the substrate concentration.</p>\n<p>In non-competitive inhibition, <strong>V<sub>max</sub> decreases</strong> (or 1/V<sub>max</sub> increases) but <strong>K<sub>m</sub> is unchanged.\u00a0</strong>Hence\u00a0the graphs of inhibited and uninhibited reactions have the <strong>same x-intercepts</strong> (converge at -1/K<sub>m</sub>) but <strong>different y-intercepts.</strong></p>\n<p>On increasing the inhibitor concentration, the slope of the red line (1/V vs 1/S) increases, or in other words Vmax decreases.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b821dab32115413599446c8f2c560528.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7187f911d2c5404f83a485541b950554x710x280.GIF"
    ]
  },
  {
    "text": "The test below depicts the presence of which of the following defects of the left eye?",
    "choices": [
      {
        "id": 1,
        "text": "Exotropia"
      },
      {
        "id": 2,
        "text": "Esophoria"
      },
      {
        "id": 3,
        "text": "Esotropia"
      },
      {
        "id": 4,
        "text": "Exophoria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The test shown is the <strong>cover - uncover test. </strong>There is<strong> abduction of the eye</strong> with suspected deviation (left eye) on covering the fixing eye (right eye) which suggests <strong>left</strong> <strong>esotropia</strong>.</p>\n<p>This test consists of two parts:</p>\n<ul>\n<li>Cover test</li>\n<li>Uncover test</li>\n</ul>\n<p><strong>Cover Test</strong>: This is used to detect <strong>heterotropia (manifest squint</strong>). Light is first shone and corneal reflections are observed. This is done to assess fixation in the deviating eye. The procedure for testing using an accommodative target and for distance is as follows.</p>\n<ul>\n<li>The patient is asked to fixate on a target straight ahead.</li>\n<li>The eye in which deviation is not suspected is covered first. For example, if a right eye deviation is suspected, the left eye is covered.</li>\n<li>Any movement of the right eye to take up fixation is noted.</li>\n<li>The following are the possible results:</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Movement of the eye</strong></td>\n<td style=\"text-align: center;\"><strong>Suspected defect</strong></td>\n</tr>\n<tr>\n<td>No movements</td>\n<td>Orthotropia/Heterotropia of the covered eye</td>\n</tr>\n<tr>\n<td>Adduction</td>\n<td>Exotropia</td>\n</tr>\n<tr>\n<td>Abduction</td>\n<td>Esotropia</td>\n</tr>\n<tr>\n<td>Downward movement</td>\n<td>Hypertropia</td>\n</tr>\n<tr>\n<td>Upward movement</td>\n<td>Hypotropia</td>\n</tr>\n</tbody>\n</table>\n<p>The test is then repeated for the opposite eye.</p>\n<p><strong>Uncover test:</strong> This is used to detect <strong>heterophoria </strong>(<strong>latent squint</strong>). The test is performed for both near and distant as follows.</p>\n<ul>\n<li>The patient fixates a distant target&nbsp;straight ahead.</li>\n<li>The examiner covers an eye for 2-3 seconds and the cover is then removed.</li>\n<li>If the covered eye had deviated, a re-fixation movement is observed on being uncovered.</li>\n<li>The following are the possible results based on the <strong>re-fixation movements</strong> of the eye.</li>\n</ul>\n<table>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>Movement of the eye</strong></td>\n<td style=\"text-align: center;\"><strong>Suspected defect</strong></td>\n</tr>\n<tr>\n<td>No movements</td>\n<td>Orthophoria</td>\n</tr>\n<tr>\n<td>Adduction (Nasal recovery)</td>\n<td>Exophoria</td>\n</tr>\n<tr>\n<td>Abduction</td>\n<td>Esophoria</td>\n</tr>\n<tr>\n<td>Downward/Upward movement</td>\n<td>Vertical phoria</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>The speed and smoothness of the recovery is noted as well as evidence of the strength of motor fusion.</li>\n<li>The test is then repeated for the opposite eye.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0a0ce5a5a09942bfa80851d3d69fb276.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A teenager comes to the emergency room with profuse bleeding from the nose. On examination, the bleed was found to be from the Kiesselbach\u2019s plexus. Which part of the septum is it located in?",
    "choices": [
      {
        "id": 1,
        "text": "Posterosuperior"
      },
      {
        "id": 2,
        "text": "Posteroinferior"
      },
      {
        "id": 3,
        "text": "Anterosuperior"
      },
      {
        "id": 4,
        "text": "Anteroinferior"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>Kiesselbach&rsquo;s plexus</strong> is the <strong>vascular anastomosis </strong>situated at <strong>Little&rsquo;s area</strong> which is present at the<strong>&nbsp;anteroinferior part</strong> of the septum.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e6ef1ca610ca40cfbde47151d28569a4x1280x1994.JPEG"
    ]
  },
  {
    "text": "A  45-year-old male patient presents to the outpatient department with complaints of increasing pain in his right hand over the past few months. On examination, there is a palpable lump over the thumb and an X-ray was done which is given below. Which of the following is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Osteosarcoma"
      },
      {
        "id": 2,
        "text": "Enchondroma"
      },
      {
        "id": 3,
        "text": "Osteoclastoma"
      },
      {
        "id": 4,
        "text": "Chondrosarcoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical presentation at this age and the radiograph showing<strong> popcorn</strong> <strong>calcification</strong> are suggestive of <strong>chondrosarcoma.</strong></p>\n<p>Chondrosarcoma is the <strong>second most common</strong> <strong>nonhematological</strong> primary malignancy of the bone(Osteosarcoma is the commonest). It can be primary or secondary. Secondary chondrosarcomas develop at the site of a previously existing benign cartilage lesion.</p>\n<p>Primary chondrosarcomas are commonly seen at <strong>40-60 years</strong> of age whereas the age group for secondary chondrosarcoma is 25-45 years.</p>\n<p>Clinical features:</p>\n<ul>\n<li>Pelvis, proximal femur, and proximal humerus are the common locations.</li>\n<li>The hand is a rare location. However, it is the most common primary bone malignancy in the hand.</li>\n<li>Primary chondrosarcoma usually presents with <strong>increasing pain and a palpable lump.</strong></li>\n<li>Asymptomatic radiological abnormality is a common presentation in enchondromas but is not seen in chondrosarcomas.</li>\n</ul>\n<p>Radiological findings:</p>\n<ul>\n<li>It arises from the medullary cavity and shows irregular matrix calcification.</li>\n<li><strong>Characteristic calcification</strong> pattern is described as \"<strong>popcorn\", \"punctate\", or \"comma-shaped</strong>\"</li>\n<li>Bone destruction, cortical erosion, and periosteal reaction may be seen.</li>\n<li>CT or MRI is used to identify the presence of secondary chondrosarcomas.</li>\n<li>Secondary chondrosarcoma is suspected of the cartilage cap of the lesion is more than 2 cm in a skeletally mature patient.</li>\n</ul>\n<p>Conditions that can cause secondary chondrosarcoma includes:</p>\n<ul>\n<li>Multiple enchondromas and multiple hereditary exostoses.</li>\n<li><strong>Ollier disease</strong>(multiple enchondromas)</li>\n<li><strong>Maffucci syndrome</strong>(multiple enchondromas with soft-tissue hemangiomas).</li>\n<li>Synovial chondromatosis</li>\n<li>Periosteal chondroma</li>\n<li>Chondroblastoma</li>\n<li>Previous radiation treatment</li>\n<li>Fibrous dysplasia</li>\n<li>Chondromyxoid fibroma</li>\n</ul>\n<p>Treatment:</p>\n<ul>\n<li><strong>Extended curettage</strong> with intraoperative adjuvant treatments is considered for<strong> low-grade lesions confined to the medullary canal.</strong></li>\n<li>Low-grade lesions with soft tissue extensions and <strong>high-grade</strong> lesions are managed with <strong>wide or radical resection or amputation</strong>.</li>\n<li>Chemotherapy is not indicated for conventional chondrosarcoma but is used for mesenchymal or dedifferentiated variants.</li>\n<li>Radiotherapy is only used as a palliative measure for surgically inaccessible tumors.</li>\n</ul>\n<p>Other options:</p>\n<p>Osteosarcoma:</p>\n<p>It is the\u00a0<strong>most common non-hematologic primary malignancy</strong>\u00a0of bone. It occurs most commonly in the\u00a0<strong>second decade</strong>\u00a0of life. It is typically\u00a0<strong>metaphyseal</strong>. The distal femur, proximal tibia, and proximal humerus are the common sites.\u00a0</p>\n<p>Radiographic findings:\u00a0The periosteal reaction is the typical finding<strong>\u00a0</strong>and it may take the form of a \"<strong>Codman's triangle\"</strong>\u00a0or it may have a \"<strong>sunburst (sunray) appearance\"</strong>\u00a0on X-ray.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f14d03c683824fdd841630c4312ef35a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ed7bb4b194074bf594b9538f1326a9eex720x765.JPEG",
      "https://cdn1.dailyrounds.org/uploads/227864ea55164471bdfa40d253356f9d.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ad4a930d9d54475789620cc809f4e743x720x912.JPEG"
    ]
  },
  {
    "text": "Which of the following structures are present in the plane marked as 1?",
    "choices": [
      {
        "id": 1,
        "text": "2, 4 and 5"
      },
      {
        "id": 2,
        "text": "1, 3, and 5"
      },
      {
        "id": 3,
        "text": "1 and 3"
      },
      {
        "id": 4,
        "text": "1 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The structure marked \"1\" in the image is <strong>transpyloric plane </strong>that passes through the<strong>\u00a0lower border of L1</strong>.\u00a0The origin of the portal vein, the lower limit of the spinal cord in adults, and the origin of the superior mesenteric artery are present on this plane.</p>\n<p>The transpyloric plane (<strong>Addison's plane</strong>)<strong>\u00a0</strong>passes <strong>midway</strong> between the\u00a0<strong>suprasternal notch</strong> of the manubrium and the <strong>upper border </strong>of the<strong> pubic</strong> <strong>symphysis</strong>. This approximately corresponds to midway between the xiphisternal joint and the umbilicus.</p>\n<p><strong>Posteriorly</strong>, this plane passes through the lower half of the body of the first lumbar vertebra <strong>(lower border of L1)</strong>.\u00a0</p>\n<p><strong>Anteriorly</strong>, it intersects the\u00a0costal margin at the <strong>ninth costal cartilage.</strong></p>\n<p>Structures present in the transpyloric plane:</p>\n<table style=\"height: 202px; width: 462px;\" width=\"909\">\n<tbody>\n<tr>\n<td style=\"width: 216.703px;\"><strong>Organs\u00a0</strong></td>\n<td style=\"width: 216.703px;\"><strong>Neurovascular structures</strong>\u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 216.703px;\">Pylorus of stomach</td>\n<td style=\"width: 216.703px;\">Origin of the superior mesenteric artery</td>\n</tr>\n<tr>\n<td style=\"width: 216.703px;\">Neck of the pancreas</td>\n<td style=\"width: 216.703px;\">Origin of the renal artery</td>\n</tr>\n<tr>\n<td style=\"width: 216.703px;\">Duodenojejunal flexure</td>\n<td style=\"width: 216.703px;\">Origin of the portal vein (behind the neck of the pancreas)</td>\n</tr>\n<tr>\n<td style=\"width: 216.703px;\">Fundus of the gallbladder</td>\n<td style=\"width: 216.703px;\">Lower limit of the spinal cord in adults</td>\n</tr>\n<tr>\n<td style=\"width: 216.703px;\">Hilum of the left kidney (right kidney is slightly lower)</td>\n<td style=\"width: 216.703px;\">\u00a0Cisterna chyli</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0Other options:</p>\n<ul>\n<li>The origin of the <strong>celiac trunk</strong> is at <strong>T12</strong> level and</li>\n<li>The lower limit of the <strong>spinal cord</strong> in <strong>newborn</strong> is at <strong>L3</strong> level.\u00a0</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a4dc678dfd4041a492703025fb7af608.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bbdd8c31b1934eb18fcd718816b66b7cx600x867.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2bce7a6e27a1482fae7bfa12da143a9ax600x872.JPEG"
    ]
  },
  {
    "text": "Identify the following method of testing antibiotic sensitivity.",
    "choices": [
      {
        "id": 1,
        "text": "Kirby\u2013Bauer method"
      },
      {
        "id": 2,
        "text": "Stokes method"
      },
      {
        "id": 3,
        "text": "E-test"
      },
      {
        "id": 4,
        "text": "Agar dilution"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given image shows<strong>&nbsp;</strong>an<strong> E-test (epsilometer)</strong>&nbsp;which is a <strong>diffusion </strong>and<strong> dilution method</strong> of testing antibiotic sensitivity.</p>\n<p>It&nbsp;is a <strong>quantitative</strong> technique for determining antimicrobial susceptibility&nbsp;and minimum inhibitory concentration <strong>(MIC).</strong></p>\n<ol>\n<li>An <strong>absorbent strip</strong> containing a&nbsp;<strong>predefined gradient</strong>&nbsp;(serial dilution) of antibiotic concentration immobilized&nbsp;along its length is placed on a <strong>lawn inoculum</strong> of a bacterium.</li>\n<li>An <strong>elliptical zone of inhibition</strong> is produced surrounding the strip.&nbsp;</li>\n<li>\n<div>The antibiotic concentration at which the ellipse edge&nbsp;intersects the strip is taken as the MIC value.</div>\n</li>\n</ol>\n<p>The given image shows another E-test.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ddd305d505aa44a39dc34f91e4e7561e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c8f8bb4ec8f406886e11d148cd2379fx220x209.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a4b9dc41a70e4ed29d4a846e5fa569d4x600x450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bb798dbfab5249a48a76e3ac5704ddf6x691x518.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/70b5d439a7f148be9cc32e15bb112517x672x599.JPEG"
    ]
  },
  {
    "text": "A 75-year-old man who is a known case of diabetes mellitus and chronic kidney disease visits the fever clinic with a history of high-grade fever, fatigue, and loss of appetite for the past 5 days. He has been diagnosed with moderate COVID 19 disease. The monoclonal antibody bamlanivimab is administered. Which part of the virus is it directed against?",
    "choices": [
      {
        "id": 1,
        "text": "Membrane protein"
      },
      {
        "id": 2,
        "text": "Nucleocapsid protein"
      },
      {
        "id": 3,
        "text": "Spike protein"
      },
      {
        "id": 4,
        "text": "Envelope protein"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient who is diagnosed with moderate COVID-19 disease in a non-hospitalised set-up with a high risk of progression (DM, CKD and \u226565 years of age) can be treated with <strong>bamlanivimab</strong>.<strong>\u00a0</strong>It is directed against the Sars-CoV-2 <strong>Spike protein</strong>.</p>\n<p><strong>Bamlanivimab</strong> is a monoclonal antibody directed against the <strong>spike (S) surface protein</strong> of SARS-CoV-2, designed to block the virus\u2019s attachment and entry into human cells. Possible side effects include anaphylaxis and infusion-related reactions, nausea, diarrhea, dizziness, headache, itching, and vomiting.\u00a0<strong>Etesevumab</strong> is a monoclonal antibody directed against the SARS-CoV-2 surface spike protein\u2019s receptor binding domain.</p>\n<p><strong>Casirivimab\u202f</strong>and\u202f<strong>imdevimab</strong> consist of two antibodies that bind to different regions of the SARS-CoV-2 spike protein receptor-binding domain.</p>\n<p>Among ambulatory care patients, IDSA guidelines suggest the use of bamlanivimab/etesivimab in patients with mild to moderate COVID-19 who are at high risk for progression to severe disease. High-risk\u202fpatients are those\u202fmeeting\u202fat least one of the following criteria:\u00a0\u00a0</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Have a body mass index \u226535</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Have chronic kidney disease</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Have diabetes</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Have immunosuppressive disease</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Are currently receiving immunosuppressive treatment\u202f\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Are \u226565 years of age\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Are \u226555 years of age and have cardiovascular disease, or hypertension or chronic obstructive pulmonary disease/other chronic respiratory diseases\u202f\u00a0</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Are 12\u201317 years of age and have BMI \u226585th percentile for their age and gender,\u202for sickle cell disease, or congenital or acquired heart disease, or neurodevelopmental disorders, for example, cerebral palsy or asthma, reactive airway or other chronic respiratory diseases that requires daily medication for control</li>\n</ul>\n<p>The following image shows the management algorithm:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb75cfd855b44c038580c0db816bcd7cx1280x3808.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4b01381dd0f54b1baf26a8e38081f345x1280x595.JPEG"
    ]
  },
  {
    "text": "A 30-year-old woman presents with left side hemiplegia, right side facial palsy and right side lateral rectus weakness. Which of the following will be the likely cause for her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal pontine syndrome"
      },
      {
        "id": 2,
        "text": "Gradenigo's syndrome"
      },
      {
        "id": 3,
        "text": "Ventral pontine syndrome"
      },
      {
        "id": 4,
        "text": "Balint's syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Ipsilateral 6th cranial nerve (abducens nerve) weakness and ipsilateral 7th cranial nerve (facial nerve) palsy with contralateral hemiplegia are seen in <strong>ventral pontine syndrome/ Millard\u2013Gubler syndrome.</strong></p>\n<table style=\"width: 408px;\">\n<tbody>\n<tr>\n<td style=\"width: 191.672px;\">CNS lesion\u00a0\u00a0</td>\n<td style=\"width: 188.18px;\">Effects</td>\n</tr>\n<tr>\n<td style=\"width: 191.672px;\"><strong>Millard\u2013Gubler Syndrome/Ventral pontine syndrome</strong></td>\n<td style=\"width: 188.18px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ipsilateral abducens nerve weakness</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ipsilateral facial nerve palsy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Contralateral hemiplegia</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 191.672px;\"><strong>Gradenigo\u2019s Syndrome</strong></td>\n<td style=\"width: 188.18px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ipsilateral abducens nerve palsy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Mastoiditis</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Deafness, Ear pain</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 191.672px;\"><strong>Foville\u2019s Syndrome/ Dorsal pontine syndrome\u00a0</strong></td>\n<td style=\"width: 188.18px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Lateral gaze palsy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ipsilateral facial nerve palsy</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Contralateral hemiparesis</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td style=\"width: 191.672px;\"><strong>Balint's syndrome</strong></td>\n<td style=\"width: 188.18px;\">\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Optic ataxia</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Ocular apraxia- difficulty in initiating voluntary eye movements</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Visuospatial disorientation</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Note:</p>\n<p>In Millard-Gubler syndrome, there is a ventral pontine injury (lesion in <strong>abducens fascicle</strong>) that causes <strong>lateral rectus weakness</strong>. In Foville's syndrome, there is a dorsal pontine injury (lesion in the <strong>abducens nucleus</strong>) that causes <strong>lateral gaze palsy</strong>.</p>\n<p>Abducens nucleus contains interneurons to the medial rectus subnucleus of the contralateral eye. Therefore, an <strong>abducens nuclear lesion</strong> produces a <strong>complete lateral gaze palsy</strong> from weakness of both the ipsilateral lateral rectus and the contralateral medial rectus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman in her second trimester comes for a routine antenatal check-up. During ultrasound examination of the fetus, the radiologist notices fractures of the long bones. The fetal head is compressible by the ultrasound probe and the echogenicity of the cranium is low. Which subtype of this condition is suspected in this fetus?",
    "choices": [
      {
        "id": 1,
        "text": "Type I"
      },
      {
        "id": 2,
        "text": "Type II"
      },
      {
        "id": 3,
        "text": "Type III"
      },
      {
        "id": 4,
        "text": "Type IV"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The\u00a0ultrasound findings of intrauterine fractures, compressible fetal head and low echogenicity of the cranium is suggestive of<strong>\u00a0</strong>the<strong> type II variant</strong> of <strong>osteogenesis imperfecta (OI)</strong>. It is uniformly<strong> fatal in utero</strong> or during the perinatal period.</p>\n<p>Osteogenesis imperfecta (Brittle bone disease) is caused by deficiencies in the synthesis of <strong>type I collagen</strong>.\u00a0OI principally affects bone, but it also impacts other tissues rich in type I collagen (joints, eyes, ears, skin, and teeth). It is caused by mutations in genes encoding the \u03b11 and \u03b12 chains of type I collagen. These mutations result in misfolding of collagen polypeptides and defective assembly of higher-order collagen chains.</p>\n<p>It can be separated into <strong>four major clinical subtypes</strong> that vary widely in severity. The severity of the disease is based on the location of the mutation within the protein.</p>\n<p>Individuals with type I OI have a normal life span, but experience childhood fractures that decrease in frequency following puberty.</p>\n<p>The type II variant, which is uniformly fatal in utero or during the perinatal period, is characterized by\u00a0extraordinary bone fragility and <strong>multiple intrauterine fractures.</strong></p>\n<p><strong>Major clinical features include:\u00a0</strong></p>\n<ul>\n<li>Death in utero or within days of birth</li>\n<li>Skeletal deformity with excessive fragility and multiple fractures</li>\n<li>Blue sclera</li>\n</ul>\n<p>The prognosis is poor and lethal during the perinatal period.</p>\n<p>The following image shows blue sclera that is commonly seen in osteogenesis imperfecta:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2a074d6332cc428dbb32f23a19b21bc3x720x336.JPEG"
    ]
  },
  {
    "text": "You are a part of the team spearheading a new experimental treatment modality for a rare type of cancer. When it is time for conducting human trials, ethical guidelines must be followed according to which of the following declarations?",
    "choices": [
      {
        "id": 1,
        "text": "Declaration of Geneva"
      },
      {
        "id": 2,
        "text": "Declaration of Helsinki"
      },
      {
        "id": 3,
        "text": "Declaration of Sydney"
      },
      {
        "id": 4,
        "text": "Declaration of Istanbul"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>Declaration of Helsinki</strong> gives a set of ethical principles directed to the medical community for <strong>human experimentation</strong>.</p>\n<p>Other options :</p>\n<table style=\"width: 371px;\">\n<tbody>\n<tr>\n<td style=\"width: 84px;\"><strong>Declaration</strong></td>\n<td style=\"width: 281px;\"><strong>Significance</strong></td>\n</tr>\n<tr>\n<td style=\"width: 84px;\"><strong>Geneva</strong></td>\n<td style=\"width: 281px;\">\n<p>Physician&rsquo;s dedication to the <strong>humanitarian goals of medicine</strong>. It is known as the modern Hippocratic oath.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 84px;\"><strong>Sydney</strong></td>\n<td style=\"width: 281px;\">\n<p>It describes about the determination of death and recovery of organs. It stated that the <strong>determination of death</strong> &ldquo;will be based on clinical judgment, supplemented if necessary by a number of diagnostic aids&rdquo;, emphasizing the EEG. Nonetheless, it asserted that &ldquo;the overall judgment of the physician&rdquo; could not be replaced by any ancillary test.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 84px;\"><strong>Istanbul</strong></td>\n<td style=\"width: 281px;\">It addresses the urgent and growing problems of&nbsp;<strong>organ sales, transplant tourism</strong> and <strong>trafficking</strong> in organ donors&nbsp;in the context of the global shortage of organs.</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old primigravida presents to the antenatal care clinic at 30 weeks of gestation. You are asked to perform a detailed physical examination on her and document the findings in the case sheet. Which of the following cardiovascular findings would be specific to a pathological cardiac condition, if documented?",
    "choices": [
      {
        "id": 1,
        "text": "Pedal edema"
      },
      {
        "id": 2,
        "text": "Grade 2 ejection systolic murmur"
      },
      {
        "id": 3,
        "text": "Grade 4 early diastolic murmur"
      },
      {
        "id": 4,
        "text": "Prominent S3"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Grade 4 early diastolic murmur</strong>&nbsp;documented is<strong> specific </strong>to a&nbsp;<strong>pathologic cardiac condition&nbsp;</strong>in a pregnant&nbsp;female.&nbsp;Any diastolic murmur is never a part of the physiological change in pregnancy.&nbsp;</p>\n<p><strong>Physiological changes in pregnancy</strong></p>\n<p>Cardiac output remains elevated throughout (maximum in the immediate postpartum period)</p>\n<p><strong>Clinical examination</strong></p>\n<ul>\n<li>Pulse rate: Increases</li>\n<li><strong>Pedal edema:</strong>&nbsp;although it can be a sign of cardiac disease, it is also a <strong>normal physiological change</strong> in pregnancy. <strong>(Option A)</strong></li>\n<li class=\"p1\">The resting pulse rate increases by&nbsp;<strong>10 beats</strong>/<strong>min</strong></li>\n<li><strong>Diastolic BP: Decreases</strong></li>\n<li>Jugular venous distension and venous hum</li>\n<li>The heart is displaced upwards and to the left</li>\n<li><strong>Mammary souffl&eacute;:</strong> Continuous murmur at 2<sup>nd</sup>&nbsp;to 4<sup>th</sup>&nbsp;intercostal space</li>\n<li>S1 M increased and widely split</li>\n<li>S2 P increased; S2 split</li>\n<li>Occasional but <strong>prominent S3</strong> at <strong>mitral area</strong> <strong>(Option D)</strong></li>\n<li>Murmurs\n<ul>\n<li><strong>Ejection systolic murmur</strong>&nbsp;at the left sternal border. <strong>(Option B)</strong></li>\n<li><strong>Continuous murmur</strong>&nbsp;at 2nd-4th intercostal space (known as mammary souffle)</li>\n</ul>\n</li>\n</ul>\n<p><strong>ECG changes</strong></p>\n<ul>\n<li>Left axis deviation (due to elevation of the diaphragm)</li>\n<li>T wave inversion, biatrial enlargement.</li>\n<li>Mild ST changes in the inferior leads.</li>\n<li>Premature atrial and ventricular contractions are relatively frequent.</li>\n</ul>\n<p><strong>Electrocardiography</strong></p>\n<ul>\n<li>T wave inversion, biatrial enlargement</li>\n<li>Dysrhythmias</li>\n<li>As the diaphragm is elevated in advancing pregnancy, there is a<strong>&nbsp;</strong>left-axis deviation&nbsp;in the electrocardiogram (ECG), and mild ST changes may be seen.</li>\n<li>Atrial and ventricular premature contractions are relatively frequent</li>\n<li>Tricuspid regurgitation</li>\n<li>Increased left atrial end-diastolic dimension&nbsp;</li>\n<li>Increased left ventricular mass</li>\n</ul>\n<p><strong>X-ray:</strong></p>\n<p>X-ray shows a larger cardiac silhouette (due to benign pericardial effusion and shifted apex).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A newborn is being assessed for his gestational age. Which of the following is not a component of the neuromuscular criteria for maturity according to the expanded New Ballard score?",
    "choices": [
      {
        "id": 1,
        "text": "Square window"
      },
      {
        "id": 2,
        "text": "Scarf sign"
      },
      {
        "id": 3,
        "text": "Cubital angle"
      },
      {
        "id": 4,
        "text": "Arm recoil"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The cubital angle\u00a0is <strong>not</strong> a component of the neuromuscular criteria for maturity according to the expanded new Ballard score.</p>\n<p>The<strong>\u00a0expanded New Ballard score</strong>\u00a0is used to assess the\u00a0<strong>physical </strong>and <strong>neuromuscular maturity</strong>\u00a0of the newborn and thereby calculate the\u00a0<strong>gestational age</strong>.</p>\n<ul>\n<li>There are\u00a0six criteria each to assess physical maturity and neuromuscular maturity.</li>\n<li>The physical maturity and neurologic maturity scores are added to calculate the gestational age.</li>\n<li>The minimum score is <strong>-10</strong> and the maximum score is <strong>50</strong>.</li>\n<li>It is accurate to within 2 wk of actual gestational age</li>\n<li>Premature infants have low scores while post dated infants have higher scores.</li>\n</ul>\n<p><strong>Neuromuscular criteria for maturity</strong> (according to the expanded New Ballard score):</p>\n<ol>\n<li>Posture</li>\n<li><strong>Square window</strong> (wrist)</li>\n<li><strong>Arm recoil</strong></li>\n<li><strong>Popliteal angle</strong></li>\n<li><strong>Scarf sign</strong></li>\n<li>Heel to ear</li>\n</ol>\n<p><strong>Physical\u00a0criteria for maturity</strong> (according to the expanded New Ballard score):</p>\n<ol>\n<li>Skin</li>\n<li>Lanugo</li>\n<li>Plantar surface</li>\n<li>Breast</li>\n<li>Eye/ear</li>\n<li>Genitals - male or female</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4933713e9c61418686643e15d114666bx1280x1317.JPEG"
    ]
  },
  {
    "text": "A 50-year-old male patient, during his routine annual checkup, is found to have an abdominal aortic aneurysm measuring 40 mm in diameter on USG. Which of the following is true about the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Urgent endovascular aneurysm repair"
      },
      {
        "id": 2,
        "text": "Surgery is indicated if aneurysmal diameter is >55mm"
      },
      {
        "id": 3,
        "text": "Urgently wheel the patient to OT for surgery"
      },
      {
        "id": 4,
        "text": "Surgery is indicated only if aneurysm is >77mm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Surgery is indicated in an asymptomatic abdominal aortic aneurysm (AAA) only if its diameter is <strong>more than 55 mm&nbsp;</strong>in a&nbsp;<strong>male patient.&nbsp;</strong></p>\n<p>If the diameter is less than <strong>55 mm</strong>, regular <strong>ultrasound monitoring</strong> is required. This is because <strong>elective open surgery</strong> has a <strong>higher rate of mortality</strong> when compared to conservative management for aneurysms of size &lt; 55 mm.</p>\n<p>Indications for surgery in abdominal aortic aneurysm:</p>\n<ul>\n<li>Size &gt;5.5 cm in <strong>males&nbsp;</strong></li>\n<li>Size &gt;5 cm in <strong>females&nbsp;</strong></li>\n<li>Expansion of <strong>&gt;1 cm in one year</strong>&nbsp;</li>\n<li><strong>Painful</strong> tender aneurysm&nbsp;</li>\n<li><strong>Thrombosed</strong> aneurysm; aneurysm with <strong>distal emboli</strong></li>\n</ul>\n<p><strong>Management</strong> of aortic aneurysm: AAA is surgically managed by <strong>dacron graft repair</strong>. It can be either <strong>open or EVAR </strong>(endovascular aneurysm repair)&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Open surgical repair</strong> is done by exposing the aorta through a mid-sternal incision and graft replacement. To expose the aorta the <strong>descending colon should be mobilized medially</strong> and this is known as <strong>left</strong> <strong>visceral rotation</strong> or <strong>Mattox procedure</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>EVAR</strong>&nbsp;is a <strong>minimally</strong> <strong>invasive</strong> procedure in which an aortic stent graft is placed on the n<strong>onaneurysmal</strong> aortoiliac segment.</li>\n</ul>\n<p><strong>Complications</strong>&nbsp;following an AAA repair are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Cardiovascular (ischemia and infarction)</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Respiratory (atelectasis or consolidation).</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Colonic ischemia.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Renal failure.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Aortoduodenal fistula</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">spinal cord ischemia</li>\n</ul>\n<p>The given image below shows the technique of EVAR:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02286229034b4dbaaedbd1adec51e8c3x400x401.JPEG"
    ]
  }
];
        let quizName = 'Mini Test 4';
        const quizFilename = 'mini-test-4-1fb94bd5.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2021-22"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>