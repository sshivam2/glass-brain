<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 2 - Anatomy - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 40-year-old patient had undergone prolonged surgery in a  prone position with his hip extended. Post-operatively he complained of pain, numbness, and paresthesia along the anterolateral aspect of the thigh. What is the root value of the nerve involved in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "L1, L2"
      },
      {
        "id": 2,
        "text": "L2, L3"
      },
      {
        "id": 3,
        "text": "L1, L2, L3"
      },
      {
        "id": 4,
        "text": "L2, L3, L4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical scenario of a patient with a history of&nbsp;<strong>prolonged surgery</strong> in prone position with <strong>hip extended</strong> and symptoms of<strong> paresthesia</strong> over the <strong>anterolateral aspect of the thigh</strong> is suggestive of <strong>meralgia paresthetica.</strong> It is due to <strong>compression</strong> neuropathy or neuroma of the lateral femoral cutaneous nerve of the thigh. The root value of the lateral cutaneous nerve of the thigh is<strong> L2 and L3.</strong></span></p>\n<p><span data-preserver-spaces=\"true\">The lateral cutaneous nerve of the thigh&nbsp;arises from the <strong>posterior divisions</strong> of the ventral rami of L2 and L3, and it supplies the skin of the <strong>anterior</strong> and <strong>lateral surfaces</strong> of the<strong> thigh up to the knee.</strong></span></p>\n<p><span data-preserver-spaces=\"true\">It is prone to injury especially as it leaves the pelvis deep to the inguinal ligament just medial to the anterior superior iliac spine.&nbsp;</span>The angulation of the nerve <strong>as it crosses the iliac crest</strong> makes it vulnerable to compression during hip extension which may increase angulation and tension on the nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/953656d28b6f4070bf7fdc199d55efb2x1280x1540.JPEG"
    ]
  },
  {
    "text": "The MR angiography of a patient is shown below. Which of the following structures is predominantly supplied by the artery marked in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Thalamus"
      },
      {
        "id": 2,
        "text": "Medulla oblongata"
      },
      {
        "id": 3,
        "text": "Midbrain"
      },
      {
        "id": 4,
        "text": "Corpus callosum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The artery marked in the image of MR angiography is the\u00a0<strong>anterior cerebral artery.</strong>\u00a0It predominantly supplies the <strong>corpus callosum</strong>.</p>\n<p><strong>Circle of Willis</strong>\u00a0is a large arterial anastomosis that unites the <strong>internal carotid</strong> and <strong>vertebrobasilar systems</strong>. It lies in the subarachnoid space within the basal cisterns surrounding the\u00a0optic chiasma\u00a0and infundibulum.\u00a0\u00a0</p>\n<p>The images below show the MR angiography and the cadaveric image of the Circle of Willis, respectively.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d573a170a7444cab9b96da0ed4f3fbd0.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9dc3fb904b404ec8a51b884e14be7bc0x1280x1236.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e392eaed76b241609e72b163ab048836x1279x965.JPEG"
    ]
  },
  {
    "text": "A 17-year-old male patient is suggested to undergo surgery for shoulder dislocation. Which of the following nerve block is recommended?",
    "choices": [
      {
        "id": 1,
        "text": "Supraclavicular block"
      },
      {
        "id": 2,
        "text": "Infraclavicular block"
      },
      {
        "id": 3,
        "text": "Interscalene block"
      },
      {
        "id": 4,
        "text": "Axillary block"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Interscalene block</strong> is recommended for the surgical procedures involving the <strong>shoulder</strong>.</p>\n<p>In interscalene block, the <strong>blockade</strong> occurs at the level of the <strong>superior and middle trunks</strong> of <strong>brachial plexus</strong>.\u00a0It is performed by injecting a local anesthetic to the nerves of the brachial plexus as it passes through the <strong>groove between the anterior</strong> and <strong>middle scalene muscles</strong>, at the level of the <strong>cricoid cartilage.</strong></p>\n<p><strong>Advantages</strong> of this block include rapid blockade of the <strong>shoulder region</strong>, and relatively easily palpable anatomical landmarks.</p>\n<p><strong>Disadvantages</strong> of this block include <strong>inadequate anesthesia</strong> in the distribution of the <strong>ulnar nerve</strong>, which makes this an unreliable block for operations involving the forearm and hand.</p>\n<p>Image below depicts an interscalene block.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/02cbf39cbf6940b4893edd93163fbc6dx308x625.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/05c2f7a8a6644465b03a7de6c025f95cx720x753.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8e6df97903de4ae18126eb951d8fb7c9x1280x1409.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df9301148e7b46098e58a082735865b8x720x845.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ec247e56196747008a42a3a838012525x1280x1409.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3e783ff669f4fd7af04a7f77c47f407x800x338.JPEG"
    ]
  },
  {
    "text": "A young man presents to the physician with a history of erosions on the scalp, face, and chest for the past 6 months. He says that initially, the lesions were like fluid-filled blisters, which later ruptured to form erosions. On examination, multiple lesions are seen over the scalp, face, chest, and also oral cavity. Nikolsky's sign is positive. This disease is caused due to a defect in which of the following layers?",
    "choices": [
      {
        "id": 1,
        "text": "4"
      },
      {
        "id": 2,
        "text": "3"
      },
      {
        "id": 3,
        "text": "2"
      },
      {
        "id": 4,
        "text": "1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical features of flaccid blisters over the skin and mucosa in a young man, along with a positive Nikolsy sign, are suggestive of <strong>pemphigus vulgaris.\u00a0</strong>It mainly affects the <strong>epidermis,</strong> which is marked as <strong>1</strong> in the above slide.</p>\n<p>Pemphigus vulgaris is caused by the autoantibodies that are directed mainly against <strong>desmoglein 3</strong>. This is present in the <strong>epidermis.\u00a0</strong>Other intraepidermal immunobullous disorders are pemphigus foliaceous, endemic pemphigus, and paraneoplastic pemphigus.</p>\n<p>Examples of subepidermal immunobullous disorders are bullous pemphigoid, linear IgA disease, pemphigoid gestationis, epidermolysis bullosa acquisita, etc.</p>\n<p><strong>Structure</strong> of skin: <br /><br />The <strong>epidermis</strong> is the outermost layer of skin and is made up of five layers, or strata, of different cell types. It is made of stratified squamous keratinised epithelium and consists of the following layers.\u00a0</p>\n<ul>\n<li><strong>Stratum basale </strong>- It is the deepest layer of the epidermis and is made of a single layer of columnar cells. It contains keratinocytes and is also called stratum germinativum.\u00a0</li>\n<li><strong>Stratum spinosum </strong>- Contains several layers of polygonal keratinocytes. These cells are connected with the help of desmosomes. This is also called the prickle cell layer.</li>\n<li><strong>Stratum granulosum </strong>- These are made up of flattened cells that have deeply staining granules in their cytoplasm. The granules contain keratohyalin.</li>\n<li><strong>Stratum lucidum </strong>- It lies superficial to the stratum granulosum. The cell boundaries are indistinct, and this layer appears homogenous.</li>\n<li><strong>Stratum corneum </strong>- It is the most superficial layer of the epidermis. This layer is acellular. It is made up of flattened scale-like elements (squames) containing keratin filaments within a protein. The squames are held together by a glue-like material that contains lipids and carbohydrates.</li>\n</ul>\n<p>The <strong>dermis</strong> is divided into two layers:</p>\n<ul>\n<li>The <strong>papillary dermis</strong> is the superficial layer of the dermis and contains dense connective tissue of dermal papillae. The papillae are best developed in the thick skin of the <strong>palms and sole</strong>s. Each papilla contains a capillary loop.</li>\n<li>The <strong>reticular layer</strong> is the deeper layer of the dermis and consists of thick bundles of <strong>collagen</strong> fibres. It also has some elastic fibres.\u00a0</li>\n</ul>\n<p>The dermis rests on subcutaneous tissue. The subcutaneous layer is called <strong>panniculus adiposus</strong>. It is responsible for giving a smooth contour to the skin. It is absent in the superficial fascia of the <strong>eyelids</strong>, the <strong>scrotum</strong> and the <strong>penis.</strong>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e4324635c0544525b2418df0468a9318.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/010c6e663dd248619cc3d1956fe3a779x1280x993.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4fa85bd13d7b46f2a682a65a1914c2dex412x600.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/162d9372169147158a229053522a5194x450x600.JPEG"
    ]
  },
  {
    "text": "A 75-year-old cachexic man presents with nagging back pain in the lumbar region that shoots down his right leg. He was diagnosed with prostate cancer 2 months back. Which of the following movements is anatomically restricted in the lumbar region?",
    "choices": [
      {
        "id": 1,
        "text": "Flexion"
      },
      {
        "id": 2,
        "text": "Extension"
      },
      {
        "id": 3,
        "text": "Lateral flexion"
      },
      {
        "id": 4,
        "text": "Rotation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Rotation</strong> is anatomically restricted in the lumbar region.</p>\n<p>The given clinical vignette is suggestive of <strong>carcinoma prostate</strong>, which has <strong>metastasised</strong> to the <strong>lumbar spine</strong>. Anatomically, the lumbar region of the vertebral column has a <strong>restricted</strong> range for<strong> rotational</strong> movements.</p>\n<p>Movements of the vertebral column:</p>\n<ul>\n<li><strong><strong>Flexion\u00a0</strong></strong>of the spine is accompanied by relaxation of the anterior longitudinal ligament and compression of the anterior parts of the intervertebral discs. Flexion is <strong>effectively absent</strong> in the <strong>thoracic </strong>region.\u00a0Flexion movements are greater than extension or lateral flexion in the lumbar region.</li>\n<li><strong>Extension\u00a0</strong>is <strong>marked</strong> in <strong>cervical</strong> and <strong>lumbar</strong> regions. It is significantly less at thoracic levels as their discs are thinner and because of the ribs and chest musculature.</li>\n<li><strong>Lateral flexion</strong> is flexion combined with coupled axial rotation. Lateral movements occur in all parts of the column but are the\u00a0<strong>greatest </strong>in the<strong> cervical </strong>and<strong> lumbar </strong>regions.</li>\n<li><strong>Axial rotation</strong>\u00a0is the <strong>highest </strong>in the<strong> cervical </strong>region, 50% of which occurs at the atlantoaxial joint. All the other spine segments below the cervical have only a slight range of rotation, among which the thoracolumbar junction has the most. The remainder of the <strong>lumbar region</strong> has <strong>very little rotation</strong>.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "During a thyroidectomy, the surgeon accidentally damages the nerve marked in the image below. Which of the following is true about the postoperative course in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Requires immediate surgical management"
      },
      {
        "id": 2,
        "text": "Vocal cords assume cadaveric position"
      },
      {
        "id": 3,
        "text": "Difficulty in breathing"
      },
      {
        "id": 4,
        "text": "Initial hoarseness in voice which may improve with time"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The structure marked in the above image is the\u00a0<strong>left recurrent laryngeal nerve.\u00a0</strong>Unilateral recurrent laryngeal nerve paralysis will lead to <strong>initial hoarseness</strong>\u00a0<strong>of voice,</strong> which may<strong> improve</strong> with time.</p>\n<p>Recurrent laryngeal nerve paralysis can be unilateral or bilateral. Unilateral palsy is more common on the <strong>left side</strong> because of the long course of the nerve. They are more commonly injured during\u00a0<strong>thyroid surgeries</strong>, neck trauma, thyroid disease, and<strong> bronchogenic carcinoma.</strong></p>\n<p>The recurrent laryngeal nerve supplies all the muscles of the larynx except for the <strong>cricothyroid.</strong> Therefore, in unilateral recurrent laryngeal nerve palsy, these muscles are paralysed. The affected vocal cord lies in the <strong>paramedian position </strong>(option B).</p>\n<p>Postoperatively, the injury can go <strong>unnoticed,</strong> or the patient may complain of <strong>mild hoarseness in the voice</strong>. This hoarseness is because the paralysed muscle cannot close the glottis during phonation.</p>\n<p>Hoarseness might <strong>improve</strong> over time because the unaffected muscle compensates and closes the glottis by hyperadduction of the cord. The patient will not have difficulty in breathing or stridor (option C).</p>\n<p>Generally, <strong>no treatmen</strong>t is required (option A). Laryngoplasty type I is needed if there is no compensation from the normal muscle.</p>\n<p>In <strong>bilateral recurrent laryngeal nerve palsy, </strong>both the vocal cords are paralysed and assume the paramedian position. Because the vocal cords are close to the midline, the <strong>phonation</strong> can be<strong> normal</strong>. However, since these vocal cords cannot abduct, the patients will have <strong>stridor</strong> and<strong> breathing difficulty.</strong> This condition requires an <strong>emergency tracheostomy</strong> to maintain the patient's airway.</p>\n<p>The image given below shows the nerves of the neck.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/023f66c6318842b693f7fb9b21dd7c57.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4fc1c8875c3a403194e7ccb947c90e52x1280x1111.983062808751.JPEG"
    ]
  },
  {
    "text": "A patient is suspected to have had an iatrogenic injury to the pharyngeal plexus during surgery. All of the soft palate muscles would be affected by the injury except?",
    "choices": [
      {
        "id": 1,
        "text": "Palatoglossus"
      },
      {
        "id": 2,
        "text": "Levator veli palitini"
      },
      {
        "id": 3,
        "text": "Palatopharyngeus"
      },
      {
        "id": 4,
        "text": "Tensor veli palatini"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Except for Tensor veli palatini, all the other muscles can be affected in the given scenario. All the soft palate muscles are<strong>\u00a0</strong>supplied by the<strong> pharyngeal plexus</strong>,<strong> </strong>except <strong>tensor veli palatini,</strong> which is supplied by the <strong>nerve to the medial pterygoid</strong>, a branch of the <strong>mandibular nerve</strong>.</p>\n<p>All <strong>soft palate muscles</strong> are derived from the <strong>4th pharyngeal arch</strong> and are supplied by the vagal plexus/<strong>pharyngeal plexus</strong>, except<strong> tensor veli palatini,</strong> which is derived from the <strong>1st pharyngeal arch</strong> and supplied by the <strong>mandibular nerve</strong>.</p>\n<p>The\u00a0<strong>pharyngeal plexus</strong>\u00a0is formed by the pharyngeal branches of the\u00a0<strong>glossopharyngeal nerve</strong>\u00a0and the\u00a0<strong>vagus nerve</strong>\u00a0with contributions from the\u00a0<strong>superior cervical sympathetic ganglion.\u00a0</strong>It supplies:</p>\n<ul>\n<li>All muscles of the\u00a0<strong>soft palate</strong>, except <strong>tensor veli palatini</strong> which is supplied by the <strong>mandibular nerve</strong></li>\n<li>All the muscles of the\u00a0<strong>pharynx</strong>, except the <strong>stylopharyngeus</strong> which is supplied by the <strong>glossopharyngeal nerve</strong>.</li>\n</ul>\n<p>Note:</p>\n<ul>\n<li>All <strong>tongue muscles</strong> are supplied by the <strong>hypoglossal nerve</strong>\u00a0except the <strong>palatoglossus</strong> (supplied by the vagus nerve through the <strong>pharyngeal plexus</strong>).</li>\n<li>All the <strong>muscles </strong>of the<strong> pharynx </strong>are supplied by the <strong>pharyngeal plexus</strong>, except the<strong> stylopharyngeus</strong> (supplied by the <strong>glossopharyngeal nerve</strong>)\u00a0</li>\n<li>All <strong>larynx muscles</strong> are supplied by the <strong>recurrent laryngeal nerve</strong>, except the <strong>cricothyroid </strong>(supplied by the <strong>external laryngeal nerve</strong>).</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man who had fractured his left humerus previously now does not feel pain in his left little finger. On examination, the following deformity is observed. Which of the nerves is most likely to have been involved?",
    "choices": [
      {
        "id": 1,
        "text": "Radial nerve"
      },
      {
        "id": 2,
        "text": "Medial cutaneous nerve of forearm"
      },
      {
        "id": 3,
        "text": "Median nerve"
      },
      {
        "id": 4,
        "text": "Ulnar nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The deformity shown is <strong>cubitus valgus</strong>. This, along with the patient\u2019s history of previous <strong>humerus fracture</strong> followed by <strong>loss </strong>of<strong> sensation</strong> over the\u00a0<strong>little finger,</strong> points to the involvement of the\u00a0<strong>ulnar nerve</strong>.</p>\n<p>Cubitus valgus can occur as a late complication of <strong>nonunion </strong>of fracture of the <strong>lateral condyle</strong> of the<strong> humerus</strong>.\u00a0The cubitus valgus deformity leads to the stretching of the\u00a0<strong>ulnar nerve,</strong> resulting in classic neuropathic symptoms, which is termed\u00a0<strong>tardy ulnar nerve palsy</strong>. <strong>Paresthesia</strong> in the ulnar nerve distribution with <strong>atrophy</strong> of the <strong>intrinsic</strong> <strong>hand</strong> <strong>muscles</strong> can be seen. It can be treated with ulnar nerve transposition and cubitus valgus correction.</p>\n<p>The\u00a0<strong>ulnar nerve</strong>\u00a0supplies the\u00a0<strong>medial two lumbricals</strong>\u00a0in the hand. The lumbricals have a combined action on metacarpophalangeal (MCP) joint flexion and interphalangeal (IP) joint extension (glass holding posture).\u00a0In ulnar nerve injury, since the medial lumbricals are not functional, the forearm muscles are unopposed. Hence, there is <strong>hyperextension</strong> at\u00a0<strong>MCP</strong>\u00a0joints\u00a0and <strong>flexion</strong> at\u00a0<strong>IP</strong>\u00a0joints<strong>.\u00a0</strong>This causes <strong>claw hand</strong> deformity. There is also <strong>numbness</strong> in the <strong>medial one-and-a-</strong><strong>half fingers</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1de8c4b81e624948b8e4d63a991f2d85.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 23-year-old female patient with a previous history of cesarean section presented with 8 weeks of delayed periods, vaginal spotting, and sharp abdominal pain. The urine pregnancy test is positive. A transvaginal ultrasound revealed an empty uterine cavity. Based on the findings, identify the most common location of implantation for the underlying condition.",
    "choices": [
      {
        "id": 1,
        "text": "Ovary"
      },
      {
        "id": 2,
        "text": "Isthmus of fallopian tube"
      },
      {
        "id": 3,
        "text": "Prior cesarean scar"
      },
      {
        "id": 4,
        "text": "Ampulla of fallopian tube"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The underlying condition based on the given clinical scenario of a young female with delayed periods, vaginal spotting, and sharp abdominal pain with positive UPT and empty uterine cavity on TVS is suggestive of <strong>ectopic</strong> <strong>pregnancy</strong>. The most common location of implantation in ectopic pregnancy is the <strong>tubal ampulla</strong>.\u00a0</p>\n<p>Almost <strong>95% of ectopic pregnancies</strong> implant within the fallopian tube. Within the fallopian tube, the <strong>ampulla</strong> is the most commonly affected location in 70% of the cases. The remaining implant is in the <strong>isthmus</strong> (12%), <strong>fimbria</strong> (11%), and <strong>interstitial tub</strong>e (2%).\u00a0</p>\n<p>The other sites of implantations are the <strong>ovary</strong> (Option A), peritoneal cavity, <strong>cervix</strong> (Option B), or prior cesarean <strong>scar</strong> (Option C).\u00a0</p>\n<p>The classic <strong>triad</strong> of symptoms for an ectopic pregnancy is\u00a0<strong>delayed menstrual cycle, abdominal pain, </strong>and<strong> vaginal bleeding.\u00a0</strong></p>\n<p>The examination may reveal <strong>abdominal tenderness</strong>, pain in cervical motion,<strong> a bulging posterior vaginal fornix</strong>, boggy mass next to the uterus. <strong>Vaginal bleeding</strong> or spotting may be present. Ruptured ectopic will lead to intraabdominal haemorrhage, leading to reciprocal changes in vital signs.\u00a0</p>\n<p>Investigations used to diagnose ectopic pregnancy include a <strong>positive beta-human chorionic gonadotropin</strong> to diagnose a pregnancy. Transvaginal ultrasound can be used to identify the gestational sac or determine if the case is a pregnancy of an unknown location. In an ectopic pregnancy, the endometrial stripe will appear as a <strong>trilaminar pattern</strong>\u00a0and anechoic fluid collections may be present.\u00a0</p>\n<p>Medical management of ectopic pregnancy involves the use of <strong>methotrexate</strong>, a folic acid antagonist. Surgical management depends on whether the patient is hemodynamically stable (laparoscopy versus laparotomy) and whether she desires future fertility (salpingectomy versus salpingostomy).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following marked structures is blocked as labour analgesia during 2nd stage of labour?",
    "choices": [
      {
        "id": 1,
        "text": "3"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "1"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>pudendal nerve block</strong> is used for labour analgesia during <strong>2nd stage of labour, </strong>and the <strong>pudendal</strong> <strong>nerve</strong> corresponds to the marked structure '<strong>2</strong>' in the image above.</p>\n<p>The pudendal nerve crosses the greater sciatic foramen to rest <strong>on</strong> <strong>the</strong> <strong>ischial</strong> <strong>spine </strong>(where the block is given), then crosses the lesser sciatic foramen to enter the perineum.\u00a0<br /><br />Other structures in the above image are as follows:<br /><br />1 - Superior gluteal nerve and vessels<br />3 - Posterior cutaneous nerve of thigh\u00a0<br />4 - Sciatic nerve\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4b60c2357bab484f9433b06e4e50fba3.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old male patient presents with complaints of right flank pain for the past 2 months. His blood counts, urinalysis and renal function tests were normal. Abdominal ultrasound showed right hydronephrosis. A retrograde ureteropyelogram showed a right-sided fish-hook ureter with hydronephrosis. Which of the following embryological abnormality is responsible for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Incomplete fusion of the urethral folds"
      },
      {
        "id": 2,
        "text": "Failure of  fusion of the paramesonephric duct"
      },
      {
        "id": 3,
        "text": "Two ureteric buds arising from mesonephric duct"
      },
      {
        "id": 4,
        "text": "Persistence of the posterior cardinal vein"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical features and a right-sided fish hook ureter are suggestive of the <strong>retrocaval ureter</strong>, and it is due to the <strong>persistence of the posterior cardinal vein.</strong></p>\n<p><strong>The circumcaval ureter</strong>, or <strong>retrocaval ureter</strong>, is a <strong>developmental anomaly of the inferior vena cava (IVC)</strong>. This congenital abnormality occurs due to the persistence of<strong>\u00a0the posterior cardinal vein,\u00a0</strong>and<strong>\u00a0</strong>the ureter passes<strong> posterior </strong>to the inferior vena cava. The anomaly always appears on the <strong>right side</strong>, as this is the side of the normal IVC.</p>\n<p>This condition occurs in 1 in 1500 individuals. Most commonly, it does not produce any clinical manifestations, but rarely, it can cause upper ureteric obstruction. Even though it is a congenital anomaly, the clinical manifestations are not seen until 3rd and 4th decades of life. The clinical manifestations are a result of right-sided hydronephrosis, which can be due to kinking of the ureter, an adynamic ureteric segment, or compression of the ureter against the psoas muscle.</p>\n<p>The classical appearance of the retrocaval ureter is termed a <strong>fish-hook ureter. </strong>As the right ureter hooks behind the IVC, it has also been referred to as an <strong>S-shaped ureter.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bdd2737ada04e02aed43525a6628701x502x643.PNG"
    ]
  },
  {
    "text": "Identify the structure marked \"A\" in the CT scan of the thorax shown below.",
    "choices": [
      {
        "id": 1,
        "text": "Descending aorta"
      },
      {
        "id": 2,
        "text": "Superior vena cava"
      },
      {
        "id": 3,
        "text": "Ascending aorta"
      },
      {
        "id": 4,
        "text": "Right pulmonary artery"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The structure marked \"A\" in the CT Thorax is the <strong>ascending aorta.</strong></p>\n<p>In a CT study, X-rays are applied in a circular motion and body tissue slices are recreated mathematically. Different tissues are seen with different intensities, depending on the proportion of attenuation of the X-rays that pass through them.</p>\n<ul>\n<li><strong>Air</strong>\u00a0and\u00a0<strong>water</strong>\u00a0are displayed as\u00a0<strong>low-intensity (dark appearance) areas</strong>\u00a0because they produce only little attenuation.</li>\n<li><strong>Bone</strong>\u00a0is displayed as a\u00a0<strong>high-intensity structure (bright appearance</strong>) because of its significant attenuation.</li>\n<li><strong>High density</strong>\u00a0is seen in the presence of\u00a0<strong>hyperemia, freshly clotted blood, and contrast agents</strong>.</li>\n<li><strong>Edema</strong>\u00a0and\u00a0<strong>necrosis</strong>\u00a0are seen as\u00a0<strong>low-intensity</strong>\u00a0areas.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2d01ab8c16fa494d8120ed9b9fde4b7c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b5f5adf74c834012affd52151888d55bx531x478.JPEG"
    ]
  },
  {
    "text": "A male patient was diagnosed with a submandibular gland tumour and posted for surgical removal of the gland along with its duct. Following surgery, he developed a loss of general sensation in the anterior two-thirds of the tongue. However, the taste sensations are present. Which of the following nerves is likely to be injured?",
    "choices": [
      {
        "id": 1,
        "text": "Chorda tympani"
      },
      {
        "id": 2,
        "text": "Glossopharyngeal nerve"
      },
      {
        "id": 3,
        "text": "Inferior alveolar nerve"
      },
      {
        "id": 4,
        "text": "Lingual nerve"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>General sensation from the anterior 2/3rd of the tongue is carried by the\u00a0<strong>lingual\u00a0</strong>nerve, which is likely to be injured in this case.</p>\n<p>In the<strong> anterior</strong> two-thirds of the tongue,</p>\n<ul>\n<li><strong>General sensation</strong> is carried by the <strong>lingual nerve</strong>.</li>\n<li><strong>Taste sensation</strong> is carried by the <strong>chorda tympani</strong> branch of the facial nerve.</li>\n</ul>\n<p>In the posterior one-third of the tongue, both general and taste sensations are carried by the <strong>glossopharyngeal\u00a0</strong>nerve.</p>\n<p>Valleculae are supplied by the internal laryngeal branch of the <strong>vagus</strong> nerve.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/df01af91445a4c84a365d0c92b53e55cx461x419.PNG"
    ]
  },
  {
    "text": "A gynecologist is examining a 28-year-old female patient. On performing a per vaginal examination, the lowest part of the cervix that can be palpated is the anterior lip. What information does that convey about the position of the uterus and cervix?",
    "choices": [
      {
        "id": 1,
        "text": "External os is directed forwards and downwards"
      },
      {
        "id": 2,
        "text": "Uterus is flexed backwards on cervix"
      },
      {
        "id": 3,
        "text": "External os is directed backwards and downwards"
      },
      {
        "id": 4,
        "text": "Uterus is directed backwards and downwards"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>If the examining fingers palpate the anterior lip as the lowest part of the cervix, it means that the uterus is <strong>anteverted</strong> and <strong>the external os is directed downwards and backwards.</strong></p>\n<p>The <strong>normal</strong> position of the uterus is <strong>antiflexed and anteverted</strong>, ie the body of the uterus is flexed forwards on the cervix and the external os is directed downwards and backwards.</p>\n<p>In a <strong>retroverted uterus</strong>, the external os of the cervix is directed <strong>downwards </strong>and<strong> forwards.</strong>\u00a0The lowest part of the cervix palpated is\u00a0the <strong>posterior lip.\u00a0</strong>The body of the uterus may also be flexed backwards in a retroverted uterus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b3850989856740139f18dcdc0a181b17x1280x2450.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a2abc9c5bfe446739364959735fbc873x1280x1921.JPEG"
    ]
  },
  {
    "text": "During a laparoscopic cholecystectomy, the surgeon is attempting to identify the Calot\u2019s triangle. All of the following structures identified by the surgeon are the boundaries of the Calot's triangle except?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>inferior surface of the liver</strong> marked as 4 does not form the boundary of Calot\u2019s triangle. It forms the superior boundary of the hepatobiliary triangle.</p>\n<p>The boundaries of <strong>Calot\u2019s triangle</strong> are <strong>3C</strong>'s</p>\n<ul>\n<li>Medially \u2013 <strong>Common hepatic duct</strong></li>\n<li>Inferiorly \u2013 <strong>Cystic duct</strong></li>\n<li>Superior \u2013 <strong>Cystic artery</strong></li>\n</ul>\n<p>Clinical importance: Identification of Calot\u2019s triangle is important during laparoscopic cholecystectomy for safe ligation and division of cystic duct and cystic artery.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d78f5af514d34b6795939a1b794202aa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/801e4f37534d4562a5f3943fbdf4a42ex1280x1611.JPEG"
    ]
  },
  {
    "text": "While assisting in an abdomino-perineal resection, the surgery resident injures the anorectal ring. Which muscle is not likely to be injured in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Puborectalis"
      },
      {
        "id": 2,
        "text": "Internal anal sphincter"
      },
      {
        "id": 3,
        "text": "External anal sphincter"
      },
      {
        "id": 4,
        "text": "Rectal longitudinal muscle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The muscular ring at the anorectal junction is called the anorectal ring. The anorectal ring is not formed by the rectal longitudinal muscle, but rather by the fusion of the <strong>puborectalis, </strong>deep fibres of the <strong>external anal sphincter,</strong> and the <strong>internal anal sphincter.</strong>\u00a0</p>\n<p>The <strong>rectal longitudinal muscle</strong>\u00a0fuses with the puborectalis to form a<strong> </strong>conjoint longitudinal coat that goes between the external and internal sphincter and, at the level of the white line, becomes a <strong>fibroblastic septum</strong> which pierces the external sphincter and is attached to the peri-anal skin as the <strong>corrugator cutis ani.</strong></p>\n<p>The<strong> </strong>anorectal ring may be felt posterolaterally during a digital per-rectal examination but is deficient anteriorly where the puborectalis is not present. <strong>Injury</strong> or division of the anorectal ring may lead to <strong>faecal incontinence.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5d54eac3a35046bf88def0315997ac41x600x602.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fcdd9247ff1a4ee29c2f46e29a1ddd69x1280x2281.JPEG"
    ]
  },
  {
    "text": "A young boy who was driving a motorcycle at a high speed collided with a tree and was thrown on his right shoulder.  An X-ray of the patient is given below. Which of the following nerves is affected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Lower lateral cutaneous nerve of the arm"
      },
      {
        "id": 2,
        "text": "Medial cutaneous nerve of the arm"
      },
      {
        "id": 3,
        "text": "Upper lateral cutaneous nerve of the arm"
      },
      {
        "id": 4,
        "text": "Posterior cutaneous nerve of the arm"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The X-ray indicates that this is a case of <strong>anterior shoulder dislocation,</strong> and the structure <strong>most commonly injured</strong> here is the <strong>axillary nerve</strong>. The <strong>upper\u00a0lateral cutaneous nerve of the arm</strong> is a branch of the axillary nerve.\u00a0</p>\n<p>It supplies the skin over the lower half of the deltoid.</p>\n<p><strong>The course of Axillary nerve:</strong></p>\n<ul>\n<li><strong>Origin</strong> -\u00a0<strong>Posterior cord</strong> of brachial plexus in the axilla. In the lower part of the axilla, it runs behind the third part of the axillary artery, where it lies on the subscapularis and is medial to the median nerve</li>\n<li>In<strong> Axilla </strong>- Exits the axilla\u00a0through the <strong>quadrangular space</strong> to enter the arm accompanied by the posterior circumflex humeral vessels.</li>\n</ul>\n<p>Axillary nerve divides as anterior and posterior branches at the deltoid and supplies the following structures</p>\n<ul>\n<li>Anterior branch - deltoid and skin over anteroinferior part</li>\n<li>Posterior branch - teres minor and posterior part of the deltoid; continues as the<strong> upper lateral cutaneous nerve of the arm</strong></li>\n</ul>\n<p><strong>Axillary nerve injury:\u00a0</strong></p>\n<p>It is mostly due to a <strong>fracture of the surgical neck of the humerus</strong>, <strong>inferior dislocation of the humerus,</strong> and <strong>inadvertent IM injection.</strong></p>\n<p><strong>Anterior dislocation</strong></p>\n<p>It\u00a0is the<strong>\u00a0most common</strong>\u00a0shoulder dislocation. It is caused by<strong>\u00a0trauma from behind</strong>\u00a0the shoulder pushing the head out anteriorly. It may also be caused due to\u00a0<strong>falling on an outstretched hand</strong> in an abducted and externally rotated shoulder. Associated findings include tearing of the capsule, producing avulsion of the glenoid labrum (the <strong>Bankart lesion</strong>) or a crushed posterolateral part of the head, giving rise to a <strong>Hill\u2013Sachs lesion</strong>.</p>\n<p>The patients present with extreme pain and wish to avoid being examined. On examination, the<strong> lateral outline of the shoulder</strong> may be<strong> flattened out</strong>, and there is an inability to touch his/her opposite shoulder (Duga's test).\u00a0<strong>X-ray confirms</strong>\u00a0the diagnosis and shows overlapping shadows of the humeral head and glenoid fossa in AP view and a humeral head out of line with the socket in a lateral view.</p>\n<p>Other options:\u00a0</p>\n<p>Option A: The <strong>lower lateral cutaneous nerve</strong> of the arm is a branch of the radial nerve. Supplies the skin of the lateral side of the arm\u00a0</p>\n<p>Option B: The <strong>medial cutaneous nerve</strong> of the arm is a branch of the medial cord.\u00a0\u00a0Supplies the skin on the medial side of the inferior half of the arm, posterior to the basilic vein.\u00a0</p>\n<p>Option D:\u00a0 The <strong>posterior cutaneous nerve</strong> of the arm is a branch of the radial nerve.\u00a0\u00a0Supplies the skin of the back of the arm from the insertion of the deltoid to the olecranon.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1320a2eca6084b6ab4e2ec590a023ffc.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0345c858e20549ac997b8e3ada3e5eeex1280x1846.JPEG"
    ]
  },
  {
    "text": "A 30-year-old presents to the casualty with a history of blunt trauma to the head. MRI shows injury to the cranial nerve present in the dorsal aspect of the brainstem. Which of the following eye movements will be compromised in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Elevation"
      },
      {
        "id": 2,
        "text": "Adduction"
      },
      {
        "id": 3,
        "text": "Intorsion"
      },
      {
        "id": 4,
        "text": "Lateral rotation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>trochlear nerve</strong> is the only nerve that exits the<strong> brainstem</strong> on the<strong> dorsal</strong>\u00a0surface<strong>\u00a0</strong>and thus can be injured in this patient. It supplies the <strong>superior oblique muscle</strong> whose actions are <strong>intorsion(medial rotation), depression, </strong>and<strong> abduction. </strong>Therefore <strong>intorsion</strong> will be compromised in this patient.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/20a5f71341754bf6bf0e4e8fd32c9831x1280x1196.JPEG"
    ]
  },
  {
    "text": "A patient with a splenic artery aneurysm is undergoing embolisation of the splenic artery. Following this procedure, blood flow will be reduced in all the following vessels except?",
    "choices": [
      {
        "id": 1,
        "text": "Dorsal pancreatic artery"
      },
      {
        "id": 2,
        "text": "Left gastroepiploic artery"
      },
      {
        "id": 3,
        "text": "Greater pancreatic artery"
      },
      {
        "id": 4,
        "text": "Superior pancreaticoduodenal artery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Embolisation</strong> of the <strong>splenic</strong> <strong>artery</strong> would <strong>not lead</strong> to <strong>reduced blood</strong> <strong>flow</strong> in the <strong>superior pancreaticoduodenal arteries</strong> as superior pancreaticoduodenal arteries <strong>arise</strong> <strong>from</strong> the <strong>gastroduodenal artery.</strong>\u00a0</p>\n<p>There are<strong> two superior pancreaticoduodenal arteries</strong>:</p>\n<ul>\n<li>The <strong>anterior</strong> superior pancreaticoduodenal artery <strong>descends</strong> in the <strong>anterior</strong> <strong>groove</strong> between<strong> </strong>the<strong> </strong>second<strong> </strong>part of the duodenum and the head of the pancreas. It supplies branches to the first and second parts of the duodenum and the head of the pancreas and then <strong>anastomoses</strong> with the anterior<strong> </strong>inferior pancreaticoduodenal artery.</li>\n<li>The <strong>posterior</strong> superior pancreaticoduodenal artery <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">runs posterior</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> to the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">head</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">of</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">pancreas</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> and <strong>anastomoses</strong> with the posterior</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">inferior</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">pancreaticoduodenal</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">artery</span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">.</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> It supplies branches to the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">head</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">of</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">pancreas</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">, the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">first</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> and </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">second</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> parts of the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">duodenum</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">, and several branches to the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">distal</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">part</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> of the </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">common</span><strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span></strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">bile</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> </span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">duct</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3b13e7fbcdbf46c39e9c9f7888b95df6x600x586.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/78a21f0a6d2844768ef262f49f208b5dx1280x1342.JPEG"
    ]
  },
  {
    "text": "A patient with breast cancer underwent the dissection of lymph nodes which are shown in the image below. Lymphatic drainage of which body part will not be affected?",
    "choices": [
      {
        "id": 1,
        "text": "Breast"
      },
      {
        "id": 2,
        "text": "Infraumbilical anterolateral body wall"
      },
      {
        "id": 3,
        "text": "Supraumbilical anterolateral body wall"
      },
      {
        "id": 4,
        "text": "Upper limb"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>infra umbilical anterolateral body wall</strong>\u00a0does not drain into the axillary lymph nodes. All the remaining options listed drain into them.</p>\n<p><strong>Axillary</strong> lymph<strong> nodes</strong> collectively drain the <strong>entire upper limb, breast,</strong> and <strong>trunk above</strong> the <strong>umbilicus.</strong></p>\n<p>Axillary nodes can be divided into<strong> 5</strong> <strong>groups</strong>:</p>\n<ul>\n<li>Lateral/humeral</li>\n<li>Anterior/pectoral</li>\n<li>Posterior/subscapular</li>\n<li>Central</li>\n<li>Apical</li>\n</ul>\n<p>Given below is a diagrammatic representation and details about the individual axillary groups of lymph nodes.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/843a934af8d14a8f82621672368f7b32.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/06713116171c4c3297e01b4912fe57f0x600x672.JPEG"
    ]
  }
];
        let quizName = 'Integrated Mini Test 2 - Anatomy';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>