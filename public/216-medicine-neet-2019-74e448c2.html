<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>216 Medicine Neet 2019 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 65-year-old female patient is brought to the emergency department in a state of unconsciousness. Her BP is 70/50 mm of Hg. Her ECG is shown below. What is the next best step in the management of her condition?",
    "choices": [
      {
        "id": 1,
        "text": "IV verapamil"
      },
      {
        "id": 2,
        "text": "IV adenosine"
      },
      {
        "id": 3,
        "text": "Carotid massage"
      },
      {
        "id": 4,
        "text": "DC cardioversion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Options A, B, and C are all used in stable cases. Vagal maneuvers like carotid massage or Valsalva are tried first followed by IV Adenosine. If these are ineffective, IV Verapamil, Diltiazem, or Beta blockers are used.</p>\n<table style=\"height: 592px;\" width=\"476\">\n<tbody>\n<tr>\n<td style=\"width: 236.172px;\">Synchronized cardioversion</td>\n<td style=\"width: 227.5px;\">Defibrillation</td>\n</tr>\n<tr>\n<td style=\"width: 236.172px;\">\n<p>Used in sustained VT<br />Used in <strong>SVT (unstable cases)</strong>, atrial flutter/fibrillation</p>\n</td>\n<td style=\"width: 227.5px;\">Used in VT and VF without a pulse</td>\n</tr>\n<tr>\n<td style=\"width: 236.172px;\">The shock delivered in <strong>sync with R wave</strong> (in absolute refractory period)</td>\n<td style=\"width: 227.5px;\">The shock is delivered at any time during cardiac cycle</td>\n</tr>\n<tr>\n<td style=\"width: 236.172px;\">\n<p>Characteristics of QRS complex:<br />Narrow and regular - 50 to 100J<br />Narrow and irregular - 120 to 200J<br />Wide and regular - 100J <br />Wide and irregular - No synchronised cardioversion</p>\n</td>\n<td style=\"width: 227.5px;\">\n<p>Wide and irregular QRS complex <br />Monophasic: 360 J<br />Biphasic:1 20-200 J</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6edcf84b58e7436c8d29d57b32d7c111.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc8abf258fe54dd0a7ab09a274501279x1280x1845.JPEG"
    ]
  },
  {
    "text": "Nasal polyps are commonly associated with:",
    "choices": [
      {
        "id": 1,
        "text": "Intrinsic asthma"
      },
      {
        "id": 2,
        "text": "Brittle asthma"
      },
      {
        "id": 3,
        "text": "Extrinsic asthma"
      },
      {
        "id": 4,
        "text": "Exercise-induced asthma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Nasal polyps</strong> are associated with <strong>intrinsic asthma</strong>.</p>\n<p>Intrinsic asthma is characterized by the presence of <strong>asthma</strong> with <strong>negative skin prick tests</strong> for common antigens. The association of nasal polyps with asthma is described by <strong>Samter&rsquo;s triad</strong> (intrinsic asthma + aspirin hypersensitivity + nasal polyposis). Asthma is usually severe, persistent, and <strong>adult-onset</strong>.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Brittle asthma</strong> refers to a <strong>severe</strong> variant of asthma where patients have very serious and often, <strong>life-threatening attacks</strong> despite appropriate therapy.</p>\n<p>Option C: <strong>Extrinsic asthma</strong> is also referred to as atopic asthma. It is <strong>allergen</strong> mediated.</p>\n<p>Option D: <strong>Exercise-induced asthma</strong> is airway narrowing due to <strong>strenuous physical activity</strong>. Symptoms typically start after the exercise has ended and last for around 30 minutes. </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are AIDS defining illnesses except:",
    "choices": [
      {
        "id": 1,
        "text": "Encephalopathy attributed to HIV"
      },
      {
        "id": 2,
        "text": "Invasive cervical cancer"
      },
      {
        "id": 3,
        "text": "Mycobacterium tuberculosis of any site"
      },
      {
        "id": 4,
        "text": "Oral candidiasis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Oral candidiasis</strong>, although seen in AIDS patients, is <strong>not</strong> an <strong>AIDS-defining</strong> illness. <strong>Candidiasis</strong> of the <strong>esophagus</strong>, <strong>trachea</strong>, <strong>bronchi,</strong> and <strong>lungs</strong> are AIDS-defining illnesses.&nbsp;</p>\n<p>AIDS-defining illnesses are specific <strong>opportunistic</strong> illnesses in patients with <strong>AIDS</strong>, which signify an advanced stage of illness (<strong>Stage 3</strong>).</p>\n<p>A case of HIV can be classified into five stages as per current CDC guidelines (0, 1, 2, 3, and unknown).</p>\n<table style=\"border-collapse: collapse; width: 100.025%; height: 166.368px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3924px;\">\n<td style=\"width: 32.2899%; height: 22.3924px;\">\n<p><strong>Stage</strong></p>\n</td>\n<td style=\"width: 32.2899%; height: 22.3924px;\"><strong>Criteria</strong></td>\n<td style=\"width: 32.2906%; height: 22.3924px;\"><strong>CD4+ count (&gt;5 years)</strong></td>\n</tr>\n<tr style=\"height: 54.3924px;\">\n<td style=\"width: 32.2899%; height: 54.3924px;\">\n<p>0</p>\n</td>\n<td style=\"width: 32.2899%; height: 54.3924px;\">A negative HIV test within 6 months of first diagnosis</td>\n<td style=\"width: 32.2906%; height: 54.3924px;\">NA</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 32.2899%; height: 22.3958px;\">1</td>\n<td style=\"width: 32.2899%; height: 22.3958px;\">Based on CD4+ count</td>\n<td style=\"width: 32.2906%; height: 22.3958px;\">&gt;=500</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 32.2899%; height: 22.3958px;\">2</td>\n<td style=\"width: 32.2899%; height: 22.3958px;\">Based on CD4+ count</td>\n<td style=\"width: 32.2906%; height: 22.3958px;\">200-499</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 32.2899%; height: 22.3958px;\">3</td>\n<td style=\"width: 32.2899%; height: 22.3958px;\"><strong>AIDS-defining opportunistic illness</strong></td>\n<td style=\"width: 32.2906%; height: 22.3958px;\">&lt;200</td>\n</tr>\n<tr style=\"height: 22.3958px;\">\n<td style=\"width: 32.2899%; height: 22.3958px;\">unknown</td>\n<td style=\"width: 32.2899%; height: 22.3958px;\">Unavailable CD4+ counts</td>\n<td style=\"width: 32.2906%; height: 22.3958px;\">unknown</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 47-year-old man with a diagnosis of acute myeloid leukemia with a blood type O negative blood group presents to the transplant clinic to discuss proceeding with an allogeneic stem cell transplant. Which of the following would be an optimal donor?",
    "choices": [
      {
        "id": 1,
        "text": "His identical twin brother"
      },
      {
        "id": 2,
        "text": "Umbilical cord transplant"
      },
      {
        "id": 3,
        "text": "His HLA identical 50-year-old brother who is otherwise healthy and is blood type O+"
      },
      {
        "id": 4,
        "text": "An HLA identical matched unrelated donor who is blood type O\u2013"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the case of acute myeloid leukemia (AML), <strong>allogeneic</strong> stem cell transplants are the <strong>treatment of choice</strong>. His<strong> HLA identical 50-year-old brother</strong> who is blood type <strong>O positive</strong> would be the <strong>best choice</strong>.</p>\n<p>Other options:</p>\n<p>Option A: An <strong>identical twin brother</strong> would <strong>not</strong> be the donor of choice. The therapeutic benefit of stem cell transplant in hematological malignancies is due to the <strong>graft-versus-leukemia (GvL)</strong>. Donor T lymphocytes attack malignant hematopoietic stem cells of the recipient that remain after high-dose chemotherapy. Despite having a <strong>low rate of graft versus host disease</strong> (GvHD), stem cells from an identical twin <strong>do not have</strong> a desirable degree of <strong>GvL effect</strong>, leading to <strong>higher</strong> rates of <strong>recurrence</strong> post-transplant.&nbsp;</p>\n<p>Option B: <strong>Autologous</strong> (umbilical cord transplant) is <strong>not recommended</strong> as <strong>higher</strong> rates of <strong>relapse</strong> have been reported.</p>\n<p>Option D: An <strong>HLA identical sibling</strong> is <strong>preferred over</strong> an <strong>unrelated HLA identical donor </strong>because there is a greater chance of matching for <strong>minor histocompatibility complex</strong> (mHC). This <strong>reduces</strong> the risk of <strong>GvHD</strong>. ABO compatibility is also important to consider, but a minor ABO mismatch (Rh mismatch) doesn't have any impact on hemolysis, graft-versus-host disease, or survival.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old HIV-positive man presents with fever for 3 weeks, dry cough, and significant weight loss. He complains of retrosternal chest pain that is worse on inspiration. His chest X-ray is given below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcal pneumonia"
      },
      {
        "id": 2,
        "text": "Pneumococcal pneumonia"
      },
      {
        "id": 3,
        "text": "Tuberculosis"
      },
      {
        "id": 4,
        "text": "Pneumocystis jirovecii pneumonia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option B: Patients with <strong>pneumococcal pneumonia</strong> also present with fever, dyspnea, and productive cough. Imaging usually shows <strong>lobar involvement</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fe6edf02cce04da288395f5d7c1e757b.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d075b38874ad44148e298a12b0a83e44x720x308.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1c3da642bd62464d9de3dc72d4f3c2bfx720x540.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f2199be14db44c50be08edf2982583ebx720x573.PNG"
    ]
  },
  {
    "text": "All are true about Guillain-Barre syndrome except:",
    "choices": [
      {
        "id": 1,
        "text": "Inflammatory condition"
      },
      {
        "id": 2,
        "text": "Descending paralysis is seen"
      },
      {
        "id": 3,
        "text": "Plasmapheresis is a treatment method"
      },
      {
        "id": 4,
        "text": "Demyelinating disorder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ascending</strong>&nbsp;(not descending)<strong>&nbsp;paralysis</strong> is seen in <strong>Guillain-Barre syndrome </strong>(GBS). It generally begins in the bilateral lower limbs (rubbery legs) affecting both proximal and distal muscles and ascends to involve the trunk and upper limbs.</p>\n<p>GBS is an acute, autoimmune, <strong>inflammatory</strong>, <strong>demyelinating</strong> polyneuropathy. The usual presentation is symmetrical, ascending paralysis evolving over hours to a few days. There is usually no progression beyond <strong>4 weeks</strong>. The legs are usually more affected than the arms. It is associated with <strong>autonomic dysfunction</strong> with or without sensory involvement. The most commonly involved cranial nerve is the&nbsp;<strong>facial nerve</strong> (50%). Lower cranial nerves are also frequently involved, causing bulbar weakness and difficulty in maintaining an airway and handling secretions.&nbsp;<strong>Deep tendon reflexes</strong> diminish or disappear within the initial days of symptom onset. <strong>Bladder dysfunction</strong> may occur in severe cases but is typically transient and <strong>not a prominent feature</strong>.</p>\n<p>70% of GBS cases occur within 1-3 weeks after an acute<strong> infectious process</strong>, commonly respiratory or gastrointestinal infections.&nbsp;<strong><em>Campylobacter jejuni</em></strong>,&nbsp;human herpes viruses, and&nbsp;<em>Mycoplasma pneumoniae&nbsp;</em> have been implicated.</p>\n<p>The diagnosis is based on <strong>Brighton criteria</strong>. It includes a combination of clinical, electrophysiologic, and CSF findings.&nbsp;<strong>Cytoalbuminologic dissociation</strong> (elevated CSF protein level AND CSF total white cell count &lt;50 cells/&mu;L) is characteristic of GBS.</p>\n<p>Treatment should ideally commence as early as possible. <strong>Intravenous immunoglobulin</strong> (2g/kg bodyweight over 5 days) and <strong>plasmapheresis</strong>&nbsp;are both viable treatment options, with similar efficacy for typical GBS. Approximately 30% of GBS patients require <strong>ventilatory assistance</strong>.&nbsp;<strong>Glucocorticoids</strong> have <strong>not shown efficacy</strong> in GBS management.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the best treatment for the relapse of immune thrombocytopenic purpura?",
    "choices": [
      {
        "id": 1,
        "text": "IV immunoglobulins"
      },
      {
        "id": 2,
        "text": "Steroids"
      },
      {
        "id": 3,
        "text": "Splenectomy"
      },
      {
        "id": 4,
        "text": "Blood transfusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Splenectomy</strong> is the treatment of choice in a case of <strong>immune thrombocytopenic purpura</strong> (ITP) relapse after <strong>first line therapy</strong> with <strong>glucocorticoids</strong>. The relapse usually occurs once they are tapered. <strong>Vaccination</strong> against encapsulated organisms (pneumococcus, meningococcus, H. influenzae) is advised before splenectomy is performed.</p>\n<p>It is important to note that in some patients <strong>ITP resolves by itself,</strong> and observation along with intermittent <strong>IV immunoglobulins</strong> and <strong>anti - Rh(D)</strong> administration or administration of a <strong>thrombopoietin receptor agonist</strong> (eltrombopag, romiplostim) can be a viable option before splenectomy is considered.</p>\n<p>The treatment of ITP is as follows:</p>\n<table style=\"height: 469px; width: 477px;\">\n<tbody>\n<tr>\n<td style=\"width: 34.8281px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 218.266px; text-align: center;\">Clinical features</td>\n<td style=\"width: 201.906px; text-align: center;\">Management</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">\n<p>1. &nbsp;&nbsp;</p>\n</td>\n<td style=\"width: 218.266px;\">\n<p>Minor bleeding manifestations (and/or)</p>\n<p>Platelet count &gt; 5000/&nbsp;&mu;L</p>\n</td>\n<td style=\"width: 201.906px;\">\n<p><strong>Prednisone</strong> (OR)</p>\n<p><strong>Anti-D immunoglobulin therapy</strong> - effective only in Rh-positive patients (OR)</p>\n<p>Intravenous immunoglobulin (IVIG)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">\n<p>2. &nbsp;</p>\n</td>\n<td style=\"width: 218.266px;\">\n<p>Severe ITP (any of the following):</p>\n<ul>\n<li>Significant GI / intracranial bleeding</li>\n<li>Platelet count &lt; 5000/&mu;L</li>\n<li>Signs of impending bleeding (retinal or large oral mucosal bleeds)</li>\n</ul>\n</td>\n<td style=\"width: 201.906px;\">\n<p>Platelet transfusion (AND)</p>\n<p>High-dose glucocorticoids (AND)</p>\n<p>IVIG / Anti-D immunoglobulins + Rituximab</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">3. &nbsp;</td>\n<td style=\"width: 218.266px;\">Relapse after first-line therapy</td>\n<td style=\"width: 201.906px;\"><strong>Splenectomy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">4. &nbsp;&nbsp;</td>\n<td style=\"width: 218.266px;\">Unresponsive to all other therapy or relapse after splenectomy</td>\n<td style=\"width: 201.906px;\">Thrombopoietin receptor agonists - <strong>romiplostim</strong> (subcutaneous), <strong>eltrombopag</strong> (oral)</td>\n</tr>\n</tbody>\n</table>\n<p>ITP is an <strong>acquired</strong> disorder characterized by the <strong>immune-mediated</strong> destruction of platelets and possibly inhibition of platelet release from the megakaryocyte. Secondary causes of ITP include systemic lupus erythematosus (<strong>SLE</strong>), <strong>HIV-AIDS</strong>, and <strong>Hepatitis C</strong>.</p>\n<p>ITP usually presents with <strong>mucocutaneous bleeding</strong>, <strong>very low platelet count</strong>, and normal peripheral blood cells. Patients typically exhibit ecchymoses and petechiae or they may incidentally discover thrombocytopenia during a routine complete blood count.&nbsp;Rarely, life-threatening bleeding may occur. The presence of <strong>wet purpura</strong> (blood blisters in the mouth) and <strong>retinal hemorrhages</strong> can serve as <strong>warning signs</strong> of potentially life-threatening bleeding.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cardiac chambers is enlarged in mitral stenosis on chest X-ray initially?",
    "choices": [
      {
        "id": 1,
        "text": "Left atrium"
      },
      {
        "id": 2,
        "text": "Right atrium"
      },
      {
        "id": 3,
        "text": "Left ventricle"
      },
      {
        "id": 4,
        "text": "Right ventricle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Left atrium</strong> (LA) is the <strong>first cardiac chamber</strong> to get enlarged in mitral stenosis (MS). It is due to the pressure overload of LA. It can be appreciated on the lateral and left anterior oblique views.</p>\n<p>Other radiographic changes seen in MS are <strong>straightening of the upper left border</strong> of the cardiac silhouette, posterior displacement of the esophagus by an enlarged LA, and <strong>Kerley B lines</strong> due to distention of interlobular septae and lymphatics with edema.</p>\n<p><strong>Severe MS</strong> causing <strong>pulmonary hypertension</strong> leads to enlargement of the pulmonary artery, <strong>right ventricle</strong>, and <strong>right atrium</strong>. <strong>Left ventricle&nbsp;</strong>remains <strong>unaffected</strong> in isolated MS.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is false?",
    "choices": [
      {
        "id": 1,
        "text": "Components of MELD (Model for end stage liver disease) scoring system are creatinine, bilirubin, International normalized ratio (INR), serum sodium (mEq/L)."
      },
      {
        "id": 2,
        "text": "Components of CTP(Child Turcotte Pugh) score are albumin, bilirubin, INR, ascites, encephalopathy"
      },
      {
        "id": 3,
        "text": "Components of CTP (Child Turcotte Pugh ) are creatinine, bilirubin, International normalized ratio (INR)"
      },
      {
        "id": 4,
        "text": "MELD score is used to assess and prioritize patients awaiting liver transplantation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>Child Turcotte Pugh</strong> (CTP) score <strong>does not</strong> include <strong>creatinine</strong>.</p>\n<p>The <strong>components of&nbsp;</strong>the<strong> CTP score </strong>are:</p>\n<ul>\n<li>Albumin</li>\n<li>Bilirubin</li>\n<li>International normalized ratio (INR)</li>\n<li>Ascites</li>\n<li>Encephalopathy</li>\n</ul>\n<p>The <strong>Model for End-stage liver disease</strong>&nbsp;(MELD 3.0) is used to&nbsp;<strong>prioritize patients awaiting liver transplantation&nbsp;</strong>and&nbsp;includes:</p>\n<ul>\n<li><strong>Female sex</strong></li>\n<li>Bilirubin</li>\n<li><strong>Albumin</strong></li>\n<li>Serum sodium (mEq/L)</li>\n<li>INR (International Normalized ratio)</li>\n<li>Creatinine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the false statement about the bundle of Kent.",
    "choices": [
      {
        "id": 1,
        "text": "It is faster than AV nodal pathway"
      },
      {
        "id": 2,
        "text": "It is slower than AV nodal pathway"
      },
      {
        "id": 3,
        "text": "Leads to short PR interval"
      },
      {
        "id": 4,
        "text": "Leads to prolonged QRS duration"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> bundle of Kent</strong> is the <strong>accessory pathway</strong> of conduction between the atria and ventricle in <strong>Wolff-Parkinson-White syndrome</strong>. It conducts impulses&nbsp;<strong>faster than the AV nodal pathway</strong> and&nbsp;<strong>avoids AV nodal delay</strong>, leading to <strong>shortened PR interval</strong>. <strong>QRS is prolonged</strong>&nbsp;because of the AV nodal impulse reaching the ventricles after the aberrant impulse.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male patient came to ED with complaints of weakness, paresthesia, and breathing difficulty. Relevant investigations were done. The ECG obtained is suggestive of :",
    "choices": [
      {
        "id": 1,
        "text": "Hypokalemia"
      },
      {
        "id": 2,
        "text": "Hyperkalemia"
      },
      {
        "id": 3,
        "text": "Hypocalcemia"
      },
      {
        "id": 4,
        "text": "Hypercalcemia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option C: <strong>Hypocalcemia</strong> causes <strong>prolongation</strong> of the <strong>QT interval</strong>. There is a <strong>lengthening</strong> of the <strong>ST segment</strong>, while the <strong>T wave</strong> (which correlates with the time for repolarization) remains <strong>unaltered</strong>.</p>\n<p>Option D: <strong>Hypercalcemia</strong> causes <strong>shortening </strong>of the<strong> QT interval</strong> and a <strong>decrease</strong> in the <strong>ST segment duration</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4be120b48ee84610944b9b914589c798.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/09d37f9b803c4884b212dd2ecf00f5d1x579x242.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/43d8e68f32034b5f89f8fc630832db5ax1160x1999.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9098e14050d0450e930ed8a0748d75eex1279x1256.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fabdf24ece0045a798a8cd7ec4a3785dx1280x1158.PNG"
    ]
  },
  {
    "text": "Osborn waves in ECG are seen in:",
    "choices": [
      {
        "id": 1,
        "text": "Hypothyroidism"
      },
      {
        "id": 2,
        "text": "Hypothermia"
      },
      {
        "id": 3,
        "text": "Hypocalcemia"
      },
      {
        "id": 4,
        "text": "Hypokalemia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Osborn wave can also be seen in:</p>\n<ul>\n<li>Hypercalcemia</li>\n<li>Brain injury</li>\n<li>Subarachnoid hemorrhage</li>\n<li>Vasospastic angina</li>\n<li>Cardiopulmonary arrest from oversedation</li>\n<li>Idiopathic ventricular fibrillation</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9d5ab690bb354af0b8b037e6150f8c4bx478x478.GIF"
    ]
  },
  {
    "text": "The production of which of the following hormones is increased in obesity?",
    "choices": [
      {
        "id": 1,
        "text": "Insulin"
      },
      {
        "id": 2,
        "text": "Thyroxine"
      },
      {
        "id": 3,
        "text": "Growth hormone"
      },
      {
        "id": 4,
        "text": "Adiponectin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Insulin levels are increased in <strong>obesity</strong>. It stimulates the <strong>synthesis of fatty acids</strong> and <strong>TAG</strong> and <strong>decreases</strong> the rate of <strong>lipolysis</strong>. <strong>Thyroxine</strong>, <strong>growth hormone</strong>, and <strong>adiponectin</strong> have <strong>lipolytic effects</strong>, hence their levels are <strong>reduced</strong> in obesity.</p>\n<p><strong>Hyperinsulinemia</strong> and <strong>insulin resistance</strong> are consistent features of obesity. Insulin resistance is more strongly linked to intra-abdominal fat than to fat in other areas. </p>\n<p><strong>Adiponectin</strong> (Option D) is an <strong>anti-inflammatory cytokine</strong> that is produced by adipocytes. It performs vital functions that are reduced in obesity - like, <strong>increasing insulin sensitivity</strong> and the <strong>inhibition of gluconeogenic enzymes</strong>. It also enhances <strong>fatty acid oxidation</strong>. </p>\n<p><strong>Insulin resistance</strong> in obesity occurs as a result of the following:</p>\n<ul>\n<li>Insulin <strong>receptor downregulation</strong></li>\n<li><strong>Increased FFA</strong> (free fatty acids) and capable of impairing insulin action</li>\n<li>Intracellular lipid accumulation</li>\n<li><strong>Circulating peptides</strong> produced by adipocytes such as <strong>TNF-&alpha;</strong>, <strong>IL-6</strong>,<strong> RBP4</strong>, and <strong>resistin</strong> modify insulin action.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the diagnosis of this patient from the ECG shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Normal ECG"
      },
      {
        "id": 2,
        "text": "Ventricular fibrillation"
      },
      {
        "id": 3,
        "text": "Ventricular tachycardia"
      },
      {
        "id": 4,
        "text": "Misplaced leads"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Ventricular fibrillation (Option B) would not show discreet QRS complexes, and hence is not the answer in this case.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/24692db0f660497cbbc53a7599250a3e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/130beaa3b3b0476d8c21af66e5ee33f9x1280x184.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/44acec8550be4ce0b208549b2e07bd54x800x179.PNG"
    ]
  },
  {
    "text": "All are true about patients with trigeminal neuralgia except:",
    "choices": [
      {
        "id": 1,
        "text": "More common in females"
      },
      {
        "id": 2,
        "text": "Pain along V2 and V3 division of trigeminal nerve"
      },
      {
        "id": 3,
        "text": "Deep seated pain"
      },
      {
        "id": 4,
        "text": "No objective signs of sensory loss"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Note: It is important to note that <strong>trigeminal neuralgia</strong> and <strong>trigeminal autonomic cephalalgia</strong> (TAC) are <strong>different</strong> entities. <strong>TAC</strong> is a group of <strong>primary headaches</strong> that include - <strong>cluster headaches</strong>, <strong>paroxysmal hemicrania</strong>, short-lasting unilateral neuralgiform headache attacks with conjunctival injection and tearing (SUNCT)/short-lasting unilateral neuralgiform headache attacks with cranial autonomic symptoms (SUNA), and hemicrania continua.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are features of Crohn\u2019s disease except:",
    "choices": [
      {
        "id": 1,
        "text": "Transmural involvement"
      },
      {
        "id": 2,
        "text": "Lead pipe appearance"
      },
      {
        "id": 3,
        "text": "Rectal sparing"
      },
      {
        "id": 4,
        "text": "Perianal fistula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lead pipe appearance</strong> is seen in <strong>ulcerative colitis</strong> (not Crohn's disease). This appearance is due to the<strong> loss of haustra</strong> in the diseased colonic segment.</p>\n<p>The image below shows the lead pipe appearance of the colon on barium enema: </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8499810b84f6457c9cbb9ff6bc8f2518x1280x1562.PNG"
    ]
  },
  {
    "text": "Which of the following is the most common type of Guillian-Barre syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Acute motor axonal neuropathy"
      },
      {
        "id": 2,
        "text": "Acute inflammatory demyelinating polyneuropathy"
      },
      {
        "id": 3,
        "text": "Acute motor sensory axonal neuropathy"
      },
      {
        "id": 4,
        "text": "Miller Fisher syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Acute inflammatory demyelinating</strong> <strong>polyneuropathy (AIDP)</strong> is the most common type of GBS.</p>\n<p>There are several <strong>types of Guillain&ndash;Barre syndrome,</strong> which are recognized by electrodiagnostic studies and pathological distinctions. These include:</p>\n<p>A. Demyelinating</p>\n<ul>\n<li><strong>Acute inflammatory demyelinating polyneuropathy</strong> (AIDP) - most common</li>\n</ul>\n<p>B. Axonal</p>\n<ul>\n<li><strong>Acute motor axonal neuropathy</strong> (AMAN)</li>\n<li><strong>Acute motor&ndash;sensory axonal neuropathy</strong> (AMSAN)</li>\n</ul>\n<p>C. Regional GBS syndromes</p>\n<ul>\n<li><strong>Miller&ndash;Fisher syndrome</strong> (MFS)</li>\n<li>Pure sensory forms</li>\n<li>Ophthalmoplegia with anti-GQ1b antibodies as part of severe motor-sensory GBS</li>\n<li>GBS with severe bulbar and facial paralysis</li>\n<li>Acute pandysautonomia</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Cushing\u2019s ulcers are seen in",
    "choices": [
      {
        "id": 1,
        "text": "Burns"
      },
      {
        "id": 2,
        "text": "Stress"
      },
      {
        "id": 3,
        "text": "Head injury"
      },
      {
        "id": 4,
        "text": "Cell necrosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Cushing&rsquo;s ulcers</strong> are seen in patients with <strong>head injury</strong>. They can also be seen in cases of <strong>space-occupying lesions</strong>, such as <strong>intracranial tumors</strong>. The most common areas affected are the <strong>acid-producing areas</strong> of the <strong>stomach</strong> <strong>(fundus and body)</strong>.</p>\n<p><strong>Stress ulcers</strong> observed in severe <strong>burns</strong> patients are called <strong>Curling&rsquo;s ulcers</strong>. They are usually seen in the <strong>duodenal mucosa</strong> and are related to reduced perfusion and ischemia.</p>\n<p>Stress-related gastric ulcers are seen in patients with massive burns, severe shock, sepsis, or head injury. Inflammatory mediators released in these conditions result in gastric mucosal inflammation. The most <strong>common presentation</strong> is minimal <strong>GI bleeding</strong>. </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about paroxysmal nocturnal hemoglobinuria?",
    "choices": [
      {
        "id": 1,
        "text": "Inherited defect in PIG \u2013A"
      },
      {
        "id": 2,
        "text": "Extravascular hemolysis"
      },
      {
        "id": 3,
        "text": "Deficiency of CD 55 and CD 59"
      },
      {
        "id": 4,
        "text": "Microcytic anaemia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Deficiency of <strong>CD55</strong> and <strong>CD59</strong> is seen in <strong>paroxysmal nocturnal hemoglobinuria</strong> (PNH).</p>\n<p>It is due to an <strong>acquired mutation</strong> in the <strong>X-linked</strong> phosphatidylinositol class A <strong>PIG-A gene</strong> (Option A) causing a <strong>deficiency</strong> of <strong>GPI anchor proteins</strong>. GPI is a glycolipid that <strong>anchors membrane protective factors</strong> such as CD59 and CD55 to the membrane. The deficiency of CD55 and CD59 makes the <strong>RBC </strong>sensitive to <strong>complement-mediated intravascular hemolysis</strong>(Option B). The <strong>anemia</strong> is usually <strong>normo-macrocytic</strong> (Option D).</p>\n<p><strong>Hemolysis</strong> tends to occur at <strong>night</strong> due to a slight <strong>decrease in blood pH</strong> during sleep, which triggers complement activity (nocturnal hemoglobinuria). <strong>PNH</strong> is characterized by <strong>hemolytic anemia</strong>, <strong>pancytopenia</strong>, and <strong>venous thrombosis</strong>.</p>\n<p>PNH is diagnosed using <strong>flow cytometry</strong>. The drugs of choice for treatment are <strong>Eculizumab</strong> or <strong>Ravulizumab</strong> which work against <strong>complement C5</strong>. Supportive management of PNH includes <strong>folic acid</strong> and <strong>iron supplementation</strong>. Bone marrow transplantation is another option for the treatment of this condition. </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with rheumatoid arthritis is being treated with methotrexate and low-dose corticosteroids for the past 4 months. However, the disease is still progressing. What would be your recommendation for the further management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Stop oral methotrexate and start parenteral methotrexate"
      },
      {
        "id": 2,
        "text": "Add sulfasalazine and hydroxychloroquine"
      },
      {
        "id": 3,
        "text": "Continue corticosteroids and methotrexate"
      },
      {
        "id": 4,
        "text": "Start only anti-TNF alpha agents"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Other options:</p>\n<p>Option A: Changing the route of administration of methotrexate from oral to parenteral is not a part of step up&nbsp;</p>\n<p>Option C: Priority is given to minimising the duration the patient is on steroids.</p>\n<p>Option D: <strong>Anti -TNF agents</strong> (adalimumab, etanercept) are <strong>not recommended</strong> as a <strong>monotherapy</strong>, and are reserved for treatment in <strong>combination with DMARDs</strong>. This is due to the fact that the <strong>efficacy of monotherapy</strong> is <strong>lesser than</strong> that of <strong>DMARDs</strong>, and the adverse effects include increased risk of serious infections, re-activation of latent TB and opportunistic fungal infections. They are reserved for cases where there is a lack of response with the first line agents.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lady presents with fever, oral ulcers, photosensitivity, and rashes on her face as shown below. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Dermatomyositis"
      },
      {
        "id": 2,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 3,
        "text": "Rosacea"
      },
      {
        "id": 4,
        "text": "Melasma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>According to the <strong>Systemic Lupus International Collaborating Clinics</strong> (SLICC) criteria, at least <strong>4 out of 11</strong> of the above criteria must be positive with at least <strong>one clinical</strong> and <strong>one immunological criteria</strong> well <strong>documented</strong> to <strong>diagnose SLE</strong>. However, if a <strong>renal biopsy</strong> is suggestive of <strong>lupus nephritis</strong> and <strong>lupus autoantibodies are positive</strong>, other criteria are not required.</p>\n<p><strong>Life-threatening</strong> manifestations include - <strong>lupus nephritis</strong> leading to end-stage renal disease, <strong>myocarditis</strong>, <strong>venous and arterial thrombosis</strong> (including stroke and myocardial infarction), <strong>ARDS</strong>, and <strong>vasculitis</strong> involving the gastrointestinal vasculature - leading to ischemia, bleeding, and sepsis.</p>\n<p>NOTE: There are two classifications systems used to diagnose SLE:</p>\n<ul>\n<li><strong>SLICC criteria</strong>, which mentions the clinical features is easier to use for clinical diagnosis.</li>\n<li><strong>EULAR/ACR criteria</strong> which apply weightage to each clinical manifestation. The patient must have a <strong>positive ANA antibody titre of &gt;1:80</strong> by <strong>immunofluorescence</strong>, and a score of 10 to be diagnosed. The EULAR criteria is more recent and is commonly used for clinical studies.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a5c9c1e2f54d4cc4887154176f62bab6.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following murmur increases on standing?",
    "choices": [
      {
        "id": 1,
        "text": "HOCM"
      },
      {
        "id": 2,
        "text": "MR"
      },
      {
        "id": 3,
        "text": "MS"
      },
      {
        "id": 4,
        "text": "VSD"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The murmur of hypertrophic cardiomyopathy (HOCM) <strong>increases with standing</strong>, as there is a reduction in preload. In conditions of reduced preload, there is lesser end diastolic volume in the left ventricle, leading to a narrower outflow tract, and a louder murmur is heard.</p>\n<p>The <strong>murmur</strong> heard in <strong>HOCM</strong> is a <strong>mid-systolic&nbsp;murmur</strong>, which is <strong>loudest</strong> along the <strong>left sternal border</strong>. It <strong>increases</strong> in conditions of <strong>decreased preload and afterload</strong> (standing, valsalva, vagal maneuvers) or conditions of <strong>increased contractility</strong> (inotropic stimulation) and <strong>decreases</strong> when <strong>preload and afterload</strong> are <strong>increased</strong> (squatting, vasopressors).</p>\n<p>Most murmurs decrease in intensity with reduced preload and afterload except HOCM and mitral valve prolapse (MVP). </p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On performing a pulmonary function test, reduction in FEV1/FVC is characteristic of:",
    "choices": [
      {
        "id": 1,
        "text": "Restrictive disease"
      },
      {
        "id": 2,
        "text": "Obstructive disease"
      },
      {
        "id": 3,
        "text": "Normal lung function"
      },
      {
        "id": 4,
        "text": "Interstitial lung disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>FVC</strong> is <strong>reduced</strong> in both <strong>obstructive</strong> and <strong>restrictive lung diseases</strong>. In <strong>obstructive</strong> diseases, the slope of FVC is <strong>steady</strong>, therefore the <strong>FEV1</strong> value is <strong>low</strong> and the <strong>FEV1/FVC ratio decreases</strong>. In <strong>restrictive</strong> diseases, the airflow is fast in the beginning leading to a <strong>higher value of FEV1</strong> and <strong>FEV1/FVC ratio increases</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8358ea027fde4213a61adf85ac982f84x1280x1110.JPEG"
    ]
  },
  {
    "text": "Calcitonin levels are increased in:",
    "choices": [
      {
        "id": 1,
        "text": "Hyperthyroidism"
      },
      {
        "id": 2,
        "text": "Hypoparathyroidism"
      },
      {
        "id": 3,
        "text": "Hyperparathyroidism"
      },
      {
        "id": 4,
        "text": "Cushing's syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Other options</p>\n<p>Option A: In <strong>hyperthyroidism</strong>, the direct effect of thyroid hormones can lead to bone resorption and <strong>mild hypercalcemia</strong>. However, hyperparathyroidism is a better answer.</p>\n<p>Options B and D: <strong>Hypoparathyroidism</strong> and <strong>Cushing&rsquo;s syndrome</strong> will have <strong>low serum calcium</strong> and hence, will not have <strong>increased calcitonin</strong> levels.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following does not lead to ARDS (Acute Respiratory Distress Syndrome) at the blood-lung interface?",
    "choices": [
      {
        "id": 1,
        "text": "Pneumonia"
      },
      {
        "id": 2,
        "text": "Fat embolism syndrome following femur shaft fracture"
      },
      {
        "id": 3,
        "text": "Sepsis"
      },
      {
        "id": 4,
        "text": "Transfusion-related lung injury"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>ARDS</strong> is a clinical syndrome of <strong>rapid onset severe dyspnea</strong> within one week of known clinical insult, <strong>hypoxemia,</strong> and <strong>diffuse pulmonary infiltrates</strong> leading to respiratory failure.</p>\n<p>The recommended therapies in ARDS with clinical or supportive evidence include:</p>\n<ul>\n<li><strong>Low tidal volume ventilation</strong> (LTVV) strategy (4&ndash;6 mL/kg of ideal body weight) is recommended to maintain adequate ventilation and avoid ventilator-induced lung injury by barotrauma and volume trauma.</li>\n<li><strong>High positive end-expiratory pressure</strong> (PEEP) or open lung mechanical ventilation improves arterial oxygenation by improving ventilation perfusion mismatch.</li>\n<li>Prone position</li>\n<li><strong>Extracorporeal membrane oxygenation</strong> (ECMO)</li>\n<li>The routine use of <strong>glucocorticoids</strong> is <strong>not beneficial</strong>.</li>\n</ul>\n<p>The following X-ray shows bilateral alveolar infiltrates as seen in ARDS:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/abf9b3cc423140adb9e42a00cfe5a3a5x1280x1023.PNG"
    ]
  }
];
        let quizName = '216 Medicine Neet 2019';
        let hierarchy = ["Marrow", "PYQs", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>