<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>46 Burns - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which among the following are indications to shift a patient to the burn center?",
    "choices": [
      {
        "id": 1,
        "text": "2,5"
      },
      {
        "id": 2,
        "text": "3,4"
      },
      {
        "id": 3,
        "text": "1,2,5"
      },
      {
        "id": 4,
        "text": "1,3,4,5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>&gt; 5% BSA burnt is not an indication to send a patient to the burns center.</p>\n<p><strong>Guidelines for referral to a burn center:</strong></p>\n<ul>\n<li>Partial-thickness burns <strong>greater than 10%</strong>&nbsp;body surface area (BSA).</li>\n<li>Burns involving the face, hands, feet, genitalia, perineum, or major joints.</li>\n<li><strong>Third-degree burns</strong> in any age group.</li>\n<li>Electrical burns, including lightning injury.</li>\n<li>Chemical burns.</li>\n<li>Inhalation injury.</li>\n<li>Burn injury in patients with complicated pre-existing medical disorders.</li>\n<li>Patients with burns and <strong>concomitant trauma</strong> in which the burn is the greatest risk. If the trauma is the greater immediate risk, the patient may be stabilized in a trauma center before transfer to a burn center.</li>\n<li><strong>Burned children</strong> in hospitals without qualified personnel for the care of children.</li>\n<li>Burn injury in patients who will require special social, emotional, or rehabilitative intervention.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are false regarding first-degree burns?",
    "choices": [
      {
        "id": 1,
        "text": "Pain is the chief symptom"
      },
      {
        "id": 2,
        "text": "Has minimal blister formation"
      },
      {
        "id": 3,
        "text": "Protective functions of the skin are intact"
      },
      {
        "id": 4,
        "text": "No residual scar after injury heals"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>First-degree burns involve only the <strong>epidermis</strong>, are <strong>painful</strong>, but <strong>do not blister</strong>, protective functions of the skin are <strong>intact </strong>and <strong>heals without a scar</strong>.</p>\n<p>Second-degree burns have <strong>dermal</strong> involvement and are <strong>extremely painful</strong>&nbsp;and<strong>&nbsp;blister</strong>.</p>\n<p>Third-degree burns are <strong>leathery,</strong>&nbsp;<strong>painless</strong>, and <strong>non-blanching</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0bedfc41617a41c78872309bd58f17a3x1280x2560.JPEG"
    ]
  },
  {
    "text": "A man accidentally took a bath with overheated water. A few hours later, he developed the given lesion on his shoulders and chest. Following spontaneous rupture 3 days later, the base of the lesion was erythematous and blanches on touch. What is the time taken by these wounds to heal?",
    "choices": [
      {
        "id": 1,
        "text": "1 week"
      },
      {
        "id": 2,
        "text": "2 weeks"
      },
      {
        "id": 3,
        "text": "3 weeks"
      },
      {
        "id": 4,
        "text": "4 weeks"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario is suggestive of <strong>second-degree superficial burns.</strong> They usually heal with minimal scarring in <strong>10&ndash;14 days</strong> unless they become infected.</p>\n<p>Second-degree burns&nbsp;are divided into <strong>two types</strong>:&nbsp;</p>\n<ul>\n<li><strong>Superficial Dermal </strong>burns are erythematous and painful, blanch to touch, and often blister. They heal in 10&ndash;14 days.</li>\n<li><strong>Deep dermal </strong>burns involve the reticular dermis, appear more pale with erythmatous regions, do not blanch to touch, but remain painful to pinprick. They heal in 4&ndash;8 weeks.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/4e224f1b521b4f31930040d7481d7b71.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which layer is involved in blister formation in a superficial partial thickness burn?",
    "choices": [
      {
        "id": 1,
        "text": "Epidermis"
      },
      {
        "id": 2,
        "text": "Subcutaneous tissue"
      },
      {
        "id": 3,
        "text": "Papillary dermis"
      },
      {
        "id": 4,
        "text": "Reticular dermis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>papillary dermis</strong> is involved in <strong>blister</strong> formation in a <strong>superficial partial-thickness burn</strong>.</p>\n<p>First-degree burns involve only the epidermis, with pain, redness, and mild swelling.&nbsp;</p>\n<p><strong>Second-degree (partial thickness) burns</strong> involve the epidermis and some parts of the dermis (also known as partial-thickness burns). Further divided into:</p>\n<ul>\n<li><strong>Superficial </strong>second-degree burns - involves the upper part of the <strong>dermis (papillary)</strong> and shows pain, <strong>blisters</strong>, and severe swelling.</li>\n<li><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">Deep </strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">second-degree burns - extends up to the </span><strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">reticular layer of the dermis</strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\"> and appears more <strong>pale and mottled</strong>, does not blanch to touch, but remains painful to pinprick.</span></li>\n</ul>\n<p>Third-degree or full-thickness burns involve the full thickness of the dermis and subcutaneous tissue.</p>\n<p>Fourth-degree burns involve deep structures such as muscle and bone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has presented to you with a burn wound as seen in the image below. With regards to Jackson's zones of tissue injury, which of the following statements is false?",
    "choices": [
      {
        "id": 1,
        "text": "Area 2 is the most severely burned portion"
      },
      {
        "id": 2,
        "text": "The outer area of a burn is called the zone of hyperemia"
      },
      {
        "id": 3,
        "text": "Vasodilation is seen in the area 3"
      },
      {
        "id": 4,
        "text": "Area 1 heals with minimal or no scarring"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Vasoconstriction</strong> (not vasodilation) is seen in red region or\u00a0<strong>zone of stasis </strong>(marked zone 3).</p>\n<p>Jackson zones of tissue injury following burns has three zones:</p>\n<ul>\n<li>The <strong>zone of coagulation</strong>\u00a0is the most <strong>severely burned</strong> portion and is typically in the <strong>center</strong> of the wound.</li>\n<li>Peripheral to that is a <strong>zone of stasis</strong>, with variable degrees of <strong>vasoconstriction</strong> and resultant ischemia.</li>\n<li>The last, outermost area of a burn is called the <strong>zone of hyperemia</strong>, which will heal with minimal or no scarring and is most like a <strong><strong>superficial or first-degree burn.\u00a0</strong></strong>It is characterized by vasodilation from inflammation surrounding the burn wound.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5caedd0dc94d4ee3b3c44832ee2efe47.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f540dc8cb5ec491eb3d813871a22f4c6x1280x2160.JPEG"
    ]
  },
  {
    "text": "While examining the burns on this patient, you find a lack of sensation and capillary refill at the burnt site. What is the degree of burn?",
    "choices": [
      {
        "id": 1,
        "text": "Fourth degree burns"
      },
      {
        "id": 2,
        "text": "Superficial Second degree burns"
      },
      {
        "id": 3,
        "text": "Deep Second degree burns"
      },
      {
        "id": 4,
        "text": "Third degree burns"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The characteristic features of <strong>full-thickness </strong>burns (<strong>third-degree</strong> burns) are <strong>lack of sensation </strong>in the burned skin, <strong>lack of capillary refill,</strong> and a<strong> leathery texture</strong> that is unlike normal skin.</p>\n<p>Deep dermal and full-thickness burns require <strong>excision with skin grafting</strong> for the patient to heal the wounds properly.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/509052ead0c34fc5b832f39cd84aef9e.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A chemical engineer burnt his fingers as shown in the image while working with hydrofluoric acid. What is the most appropriate way to manage this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Topical application of calcium gluconate gel along with ECG monitoring"
      },
      {
        "id": 2,
        "text": "Irrigation with Dakin's solution followed by surgical excision of the burn site"
      },
      {
        "id": 3,
        "text": "Immediate intrarterial injection of calcium gluconate"
      },
      {
        "id": 4,
        "text": "Copious irrigation with normal saline and application of mafenide acetate"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Following irrigation of the burn site, <strong>topical application of calcium gluconate gel along with ECG monitoring</strong> is the most appropriate management.</p>\n<p>Hydrofluoric acid is the strongest inorganic acid and it can cause <strong>liquefaction necrosis of deeper tissues </strong>(since the acid is highly lipophilic).&nbsp;<strong>Pain out of proportion</strong> to physical examination is a hallmark finding in HF burns.&nbsp;Systemic absorption of <strong>fluoride ions</strong> can result in <strong>intravascular chelation</strong> of calcium causing <strong>hypocalcemia.&nbsp;</strong></p>\n<p>Depletion of calcium causes inhibition of the sodium-potassium ATPase pump, leading to <strong>hyperkalemia</strong> and subsequent life-threatening arrhythmias. Therefore<strong> ECG monitoring</strong> is imperative.&nbsp;ECG abnormalities that can occur include <strong>prolonged QTc</strong> (from hypocalcemia) and&nbsp;<strong>QRS widening</strong> (from hyperkalemia).</p>\n<p>Following <strong>copious irrigation</strong> of the burn site with water, the mainstay of treatment is with topical application of&nbsp;<strong>calcium gluconate gel.&nbsp;</strong>If the pain does not subside, or if systemic signs ensue, an <strong>intraarterial</strong> injection of <strong>calcium gluconate</strong> can be given in the affected extremity.&nbsp;&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bbfa57b504c7494b8b5c5b331ff3c819.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "20% of a patient's total body surface area was burnt from an overhead electric supply line. What is leading cause of death in such burns?",
    "choices": [
      {
        "id": 1,
        "text": "Acute kidney injury"
      },
      {
        "id": 2,
        "text": "Cardiac arrest"
      },
      {
        "id": 3,
        "text": "Internal haemorrhage"
      },
      {
        "id": 4,
        "text": "Internal burns"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The leading cause of death in electrical injuries is <strong>cardiac arrest</strong>. This is because alternating current injuries interfere with normal cardiac pacing.\u00a0</p>\n<p>The electricity itself does not usually cause significant underlying myocardial damage. So resuscitation, if successful, should be lasting.</p>\n<p>The domestic electricity supply comprises a low voltage alternating current.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ABG of a patient with extensive burns shows pH: 7.29, pCO2: 38mmHg, HCO3: 16.5, and elevated lactate of 5mmol/L. As part of initial fluid resuscitation, which fluid would be the best to initiate in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Normal saline"
      },
      {
        "id": 2,
        "text": "Ringer lactate"
      },
      {
        "id": 3,
        "text": "Hypertonic saline"
      },
      {
        "id": 4,
        "text": "Human albumin solution"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>best fluid</strong> used for burns is <strong>Ringer&rsquo;s lactate</strong> or Hartmann&rsquo;s solution.</p>\n<p>Ringer lactate (crystalloid) is a mixture of sodium chloride, sodium lactate, potassium chloride, and calcium chloride in water. It <strong>prevents metabolic acidosis</strong> that may occur in burns.</p>\n<p>Crystalloids are said to be as effective as colloids for maintaining intravascular volume and are given during the initial 24 hours.</p>\n<p>Option A: Normal saline may be used, but <strong>large quantities of saline</strong> can cause <strong>hyperchloremic metabolic acidosis</strong>, <strong>worsening</strong> this patient's <strong>existing acidosis</strong>.</p>\n<p>Option D: <strong>Human albumin</strong> solution is a colloid. <strong>Colloids</strong> should be ideally be given <strong>after</strong> the <strong>first 12 hours</strong> of burn because before this period, the massive fluid shifts cause proteins to leak out of the cells.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An adult whose both lower limbs are charred along with genitalia has ____ burns.",
    "choices": [
      {
        "id": 1,
        "text": "10%"
      },
      {
        "id": 2,
        "text": "19%"
      },
      {
        "id": 3,
        "text": "36%"
      },
      {
        "id": 4,
        "text": "37%"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Using Wallace&rsquo;s Rule of 9,</strong> the % total burn surface area:</p>\n<ul>\n<li>One lower limb =&nbsp; Thigh (9%) + leg (9%) = 18%</li>\n<li>Genitals = 1%</li>\n</ul>\n<p>Hence, in this patient, one lower limb+ other lower limb + genital =&nbsp; 18% + 18% + 1% = <strong>37%.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old is brought with superficial and deep second degree burns on his chest. What is the most accurate method to assess the total body surface area involved ?",
    "choices": [
      {
        "id": 1,
        "text": "Parkland's formula"
      },
      {
        "id": 2,
        "text": "Lund and Browder chart"
      },
      {
        "id": 3,
        "text": "Using the child's  palm as reference"
      },
      {
        "id": 4,
        "text": "Wallace's rule"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Lund and Browder</strong> chart gives a more accurate accounting of the true burn size in <strong>children</strong>.</p>\n<p>Unlike the Wallace rule of nines, the Lund and Browder chart takes into consideration the&nbsp;<strong>age of the person</strong>, by decreasing percentage BSA (Body Surface Area) for the head and increasing percentage BSA for the legs as the child ages, making it more useful in pediatric burns.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/da31fa50605041cfbd3005e0b8ca9604.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/23c8f9f5a6a3479b96051b82388ad219x1280x2317.JPEG"
    ]
  },
  {
    "text": "A patient comes to your clinic with a superficial partial-thickness burn. Which of the following statements regarding the management is false?",
    "choices": [
      {
        "id": 1,
        "text": "Superficial burns generally do not require the use of topical antibiotics"
      },
      {
        "id": 2,
        "text": "Blisters on second degree burns should not be burst"
      },
      {
        "id": 3,
        "text": "All topical antibiotics retard wound healing"
      },
      {
        "id": 4,
        "text": "Facial burns of the same degree will require a hydrocolloid dressing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Facial burns do not require a hydrocolloid dressing. <strong>Exposure therapy</strong> (no dressings are applied over the wound) is typically used on the <strong>face and head</strong>.</p>\n<p>All topical antibiotics <strong>retard wound healing</strong> to some extent so they are used only in second or third-degree burns or wounds, which have a high risk of infection.</p>\n<p>Blisters on second-degree burns should not be burst as they may cause an infection.</p>\n<p><strong>Topical treatment</strong> of deep burns:</p>\n<ul>\n<li>1% silver sulphadiazine cream</li>\n<li>0.5% silver nitrate solution</li>\n<li>Mafenide acetate cream</li>\n<li>Silver nitrate, silver sulphadiazine and cerium nitrate</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a19415023ce749a5b1c252e790ca7ee5.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "While starting fluid resuscitation on a patient with burns, it is important to keep in mind that all of the following parameters will be decreased, except:",
    "choices": [
      {
        "id": 1,
        "text": "1 and 4"
      },
      {
        "id": 2,
        "text": "4 and 5"
      },
      {
        "id": 3,
        "text": "3 and 5"
      },
      {
        "id": 4,
        "text": "2 and 4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 531\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Capillary permeability</strong> and <strong>afterload</strong> is <strong>increased</strong> after severe <strong>burns</strong>.</p>\n<p>Significant burns is associated with <strong>massive release of inflammatory mediators</strong>, both in the wound and in other tissues. These mediators produce vasoconstriction and vasodilation, <strong>increased capillary permeability</strong>, and edema locally and in distant organs.</p>\n<p>Cellular and humoral immunity are decreased in burns (increased risk of infection).</p>\n</div>\n</div>\n</div>\n</div>\n<p>Changes in various systems in burns:</p>\n<p><strong>CVS</strong></p>\n<ul>\n<li>Massive edema</li>\n<li>Increased afterload</li>\n<li>Decreased venous return</li>\n<li>Decreased cardiac output</li>\n</ul>\n<p><strong>Renal</strong></p>\n<ul>\n<li>Low volume concentrated urine</li>\n<li>Decreased urinary sodium</li>\n<li>Myoglobinuria</li>\n<li>Renal ischemia</li>\n<li>Acute tubular necrosis</li>\n<li>Acute renal failure</li>\n</ul>\n<p><strong>GI</strong></p>\n<ul>\n<li>Reflex Ileus</li>\n<li>GI Ulcers (<strong>Curling&rsquo;s Ulcer</strong>)</li>\n</ul>\n<p><strong>Endocrine and Metabolism</strong></p>\n<ul>\n<li>Increased glucagon, cortisol</li>\n<li>Protein catabolism</li>\n<li>Ureagenesis</li>\n<li>Lipolysis</li>\n<li>Increased gluconeogenesis</li>\n<li>Lactic acidosis</li>\n</ul>\n<p><strong>Hematological</strong></p>\n<ul>\n<li>Anaemia</li>\n<li>Initial thrombocytopenia then thrombocytosis</li>\n<li>Decreased capacity of neutrophil phagocytosis</li>\n<li>Overall lymphopenia</li>\n<li>Relative increase in T-Suppressor Cells</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has rushed to your clinic after she spilled hot tea on her hand. What should be the ideal temperature of the water used to cool her injuries?",
    "choices": [
      {
        "id": 1,
        "text": "0-4 degrees"
      },
      {
        "id": 2,
        "text": "15 degrees"
      },
      {
        "id": 3,
        "text": "20 degrees"
      },
      {
        "id": 4,
        "text": "25 degrees"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In temperate climates, cooling should be at about <strong>15 \u00b0C,</strong> and hypothermia must be avoided. Moreover, studies show that ice cold water increases tissue damage.</p>\n<p>Water at <strong>15 \u00b0C</strong>\u00a0provides <strong>analgesia</strong> and <strong>delays the microvascular damage</strong> in burns.</p>\n<p>It should occur for a minimum of 20 minutes and is effective up to 1 hour after the burn injury.</p>\n<p>Particularly important in scalds.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5f29d6e897c6482fa64368b874df4838.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "While fixing faulty wiring, an electrician sustains the given burn. Which of the following is false?",
    "choices": [
      {
        "id": 1,
        "text": "Electric burns are usually third degree burns"
      },
      {
        "id": 2,
        "text": "Urine output should be monitored for volume and deposits"
      },
      {
        "id": 3,
        "text": "ECG should be monitored even in low voltage burns"
      },
      {
        "id": 4,
        "text": "Fluid requirement is less as compared to other burns"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Fluid requiremen</strong>t is <strong>more</strong> as compared to other burns. All electric burns are managed by resuscitation at <strong>4mL/Kg/%TBSA&nbsp;</strong>(which means 4mL for every Kg for every %TBSA). This is <strong>double</strong>&nbsp;what the ATLS guidelines advise for other burns as electrical burns may cause<strong> myoglobinuria</strong> and <strong>acute kidney injury.</strong></p>\n<p>Most of the electrical burns are of <strong>severe</strong> degree and cause third-degree burns.</p>\n<p>The fluid resuscitation is done to ensure <strong>urine output</strong> of <strong>100 mL/hr in adults</strong> and <strong>1&ndash;1.5 mL/kg/hr in children &lt; 30 kg,&nbsp;</strong>until the urine clears from pigmentation. The IV fluid is then titrated down to ensure the urine output of 0.5 mL/Kg/hr.</p>\n<p>Electrical injuries are usually divided into low and high-voltage injuries.</p>\n<ul>\n<li><strong>Low voltage injuries</strong> cause small, localized, deep burns.</li>\n<li><strong>High voltage injuries</strong> damage by flash (External burn) and conduction (Internal burn)</li>\n</ul>\n<p>The myocardium may be directly damaged without pacing interruption. Thus, ECG must be monitored for arrhythmias.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/be4fd08acfbe4a769f483febde3daf52.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A man with severe burn injuries is admitted to the ward. Proton-pump inhibitors are started. Which ulcer is being prevented?",
    "choices": [
      {
        "id": 1,
        "text": "Curling\u2019s ulcer"
      },
      {
        "id": 2,
        "text": "Cushing\u2019s ulcer"
      },
      {
        "id": 3,
        "text": "Marjolin\u2019s ulcer"
      },
      {
        "id": 4,
        "text": "Buruli\u2019s ulcer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Proton pump inhibitors are used in burns patients to <strong>prevent Curling's ulcer</strong>. It is an <strong>acute gastric erosion</strong>&nbsp;that is a complication from severe burns when reduced plasma volume leads to<strong>&nbsp;ischemia</strong> and <strong>cell</strong>&nbsp;<strong>necrosis </strong>of the<strong> gastric mucosa.</strong></p>\n<p>Marjolin&rsquo;s Ulcer is <strong>squamous cell carcinoma</strong> occurring in a long-standing burn scar or any chronic ulcer.</p>\n<p><strong>Cushing&rsquo;s ulcer</strong> is a gastric ulcer occurring in <strong>elevated intracranial pressure</strong>.</p>\n<p><strong>Buruli's Ulcer </strong>is an infectious disease caused by <em>Mycobacterium ulcerans</em>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 34-year-old electrician sustains electrical burns while at work. On arrival he is hemodynamically stable, and he is placed on ECG monitoring and initial fluid resuscitation is initiated. His urine is collected for routine labs and appears as below. Which of the following lab abnormalities may be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Elevated unconjugated bilirubin"
      },
      {
        "id": 2,
        "text": "Elevated RBC count in urine"
      },
      {
        "id": 3,
        "text": "Elevated creatinine kinase"
      },
      {
        "id": 4,
        "text": "Low platelet count"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The<strong> tea-colored urine</strong> in the clinical vignette in the setting of an <strong>electrical injury</strong> is suggestive of <strong>rhabdomyolysis</strong> following electrical burns.<strong> Elevated creatine kinase</strong> is seen in rhabdomyolysis.</p>\n<p><strong>AC</strong> injuries are more commonly seen and this current <strong>creates tetany</strong> within the muscles. This<strong> sustained contraction</strong> can lead to muscle injury and resulting in rhabdomyolysis and <strong>myoglobinuria</strong>, presenting as tea-colored urine.</p>\n<p>Damage to the underlying muscles in the affected limb can also cause the rapid onset of compartment syndrome. The release of the myoglobins will cause myoglobinuria and subsequent <strong>renal dysfunction.</strong> Therefore, during the <strong>resuscitation</strong> of these patients, efforts must be made to <strong>maintain a high urine output</strong> of up to <strong>2 mL/kg body weight</strong> per hour.</p>\n<p>Biochemical features of rhabdomyolysis are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Elevated CPK, BUN, Cr</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Hyperkalemia, hyperphosphatemia, hypocalcemia.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/f/f7/RhabdoUrine.JPG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman, weighing 58 kg, has second-degree burns covering 20% of the total body surface area.  Which of the following formulae would you use to calculate the amount of fluid to be given?",
    "choices": [
      {
        "id": 1,
        "text": "Percentage of burns \u00d7 weight (kg) \u00d7 2 = volume in mL"
      },
      {
        "id": 2,
        "text": "Percentage of burns \u00d7 weight (kg)/2 =  volume in mL"
      },
      {
        "id": 3,
        "text": "Percentage of burns \u00d7 weight (kg) \u00d7 4 = volume in mL"
      },
      {
        "id": 4,
        "text": "Weight + 1500 ml/m2\u00d7BSA burnt = volume in mL"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p class=\"p1\">According to the <strong>latest ATLS</strong> (Advanced Trauma Life Support) 10th edition 2018<strong>, </strong>resuscitation formula for second and third-degree <strong>thermal burns</strong> in the <strong>first 24 hours</strong>&nbsp;is given by the following equation:</p>\n<p class=\"p1\">Total percentage body surface area burned &times; weight (kg) &times;<strong> 2&nbsp;</strong>= volume (mL).</p>\n<p class=\"p1\"><strong>Half this volume</strong> is given in the first <strong>8 hours</strong> and the second half is given in the subsequent <strong>16 hours.&nbsp;</strong>This has been recommended to reflect concerns about over-resuscitation when using the traditional Parkland formula.&nbsp;</p>\n<p class=\"p1\">Adequacy of fluid resuscitation is assessed by monitoring for a urine output of<strong>&nbsp;0.5-1.0 mL/kg/hr.</strong></p>\n<p class=\"p1\">However, in cases of <strong>electrical burns</strong>, the formula is:&nbsp;</p>\n<p class=\"p1\">Total percentage body surface area burned&times; weight (kg) <strong>&times; 4&nbsp;</strong>= volume (mL).</p>\n<p class=\"p3\"><strong>Parkland and Modified Parkland formula:</strong></p>\n<ul>\n<li class=\"p1\">Parkland's formula for resuscitation in the <strong>initial 24 hours</strong> is given by =<span class=\"Apple-converted-space\">&nbsp; T</span>otal percentage body surface area &times; weight (kg) &times; 4&nbsp;= volume (mL).</li>\n<li class=\"p3\">Modified&nbsp;Parkland's formula&nbsp;provides more specific recommendations for the <strong>second 24 hours</strong>, advising colloid&nbsp;infusion of 5% albumin at the amount of 0.3-1.0/mL/kg/%BSA/hr. The management of the <strong>first 24 hours remains the same</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following formulas will you use to calculate the amount of albumin to be administered to a patient with burns?",
    "choices": [
      {
        "id": 1,
        "text": "Parkland formula"
      },
      {
        "id": 2,
        "text": "Muir and barclay formula"
      },
      {
        "id": 3,
        "text": "Evan\u2019s formula"
      },
      {
        "id": 4,
        "text": "Wallace formula"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most commonly used colloid-based formula is the<strong> Muir and Barclay</strong> formula:</p>\n<ul>\n<li>0.5 &times; percentage body surface area burnt &times; weight =<strong> one portion</strong></li>\n<li>A total of six portions are given in 36 hours&nbsp;\n<ul>\n<li><strong>Three portions:</strong> One portion for every 4 hours in 12 hours.</li>\n<li><strong>Two portions:&nbsp;</strong>One portion for every 6 hours in the next 12 hours.</li>\n<li><strong>One portion:</strong>&nbsp;Remaining one portion in the last 12 hours.</li>\n</ul>\n</li>\n</ul>\n<p>Colloid-based resuscitation using the Muir-Barclay formula results in the administration of lower volumes of fluid than Parklands formula and carries a <strong>lower risk of complications from over-resuscitation.</strong>&nbsp;However, colloids (4.5% Albumin) are&nbsp;<strong>deferred for the first 8 hours</strong> when <strong>capillary permeability is highest</strong> and the benefit is questionable. So, the 36-hours schedule of the Muir and Barclay formula would begin after the first 8 hours of burn.</p>\n<p>Options A and C: Parkland formula and Evan's formula are used to calculate the <strong>crystalloid volume</strong> to be given in the first 24 hours.&nbsp;</p>\n<p>Option D: Wallace's rule of nine is used to calculate the <strong>percentage of the burnt body surface area</strong> (%TBSA).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient was brought to the hospital after being rescued from a burning house where he was trapped for 4 hours. The patient has a few minor burns but is coughing extensively. His voice is hoarse and he is able to drink water with some difficulty. What is the safest strategy of management?",
    "choices": [
      {
        "id": 1,
        "text": "Start him on CPAP"
      },
      {
        "id": 2,
        "text": "O2 therapy with well-fitting face mask"
      },
      {
        "id": 3,
        "text": "Elective cricothyroidotomy"
      },
      {
        "id": 4,
        "text": "Elective endotracheal intubation"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>For a patient who presents with a history or suspicion of inhalational burn injury, <strong>elective endotracheal intubation</strong> is the <strong>safest strategy</strong>.</p>\n<p>Delay can make intubation very difficult because of airway&nbsp;edema and can lead to airway obstruction. One should be ready to perform an emergency cricothyroidotomy if intubation is delayed.</p>\n<p><strong>Recognition of the potentially burned airway:</strong></p>\n<ul>\n<li>A history of being trapped in the presence of smoke or hot gases</li>\n<li>Burns on the palate or nasal mucosa, or loss of all the hairs in the nose</li>\n<li>Deep burns around the mouth and neck</li>\n</ul>\n<p><strong>American Burn Life Support (ABLS) indications for early intubation include:</strong></p>\n<div class=\"page\" title=\"Page 224\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ul>\n<li>Signs of airway obstruction (hoarseness, stridor, accessory respiratory muscle use, sternal retraction)</li>\n<li>The extent of the burn (TBSA &gt; 40%&ndash;50%)</li>\n<li>Extensive and deep facial burns</li>\n<li>Burns inside the mouth or difficulty swallowing</li>\n<li>Significant edema or risk for edema</li>\n<li>Signs of respiratory compromise: Inability to clear secretions, respiratory fatigue, poor oxygenation or ventilation</li>\n<li>Decreased level of consciousness where airway protective reflexes are impaired</li>\n<li>Anticipated patient transfer of large burn with airway issue without qualified personnel to intubate en route&nbsp;&nbsp;</li>\n</ul>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 12-year-old boy presented to the OPD with a scald injury of his arm. The lesion was pink, oozing, and painful to moving air and touch. Which of the following is the most appropriate management?",
    "choices": [
      {
        "id": 1,
        "text": "Silver sulphadiazine cream dressing"
      },
      {
        "id": 2,
        "text": "Excision and grafting"
      },
      {
        "id": 3,
        "text": "Paraffin gauze dressing"
      },
      {
        "id": 4,
        "text": "Collagen dressing"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Scald</strong> injury (damage from contact with hot liquids) that appears pink in colour, has oozing, and pain is suggestive of a <strong>2nd-degree burn </strong>(i.e.&nbsp;<strong>p</strong><strong>artial-thickness burn</strong>).&nbsp;<span dir=\"ltr\" role=\"presentation\"><strong>Collagen dressing</strong> is the</span><span dir=\"ltr\" role=\"presentation\">&nbsp;most appropriate management for this injury.</span></p>\n<p>The <strong>best dressing</strong> for burn wounds is <strong>skin; collagen</strong>&nbsp;is a good substitute for skin, especially in <strong>partial-thickness burns</strong>. For <strong>full-thickness&nbsp;burns</strong>, sequential <strong>excision </strong>and<strong> grafting</strong> should be considered.</p>\n<p>Initial treatment for burns includes<strong> cleaning</strong>&nbsp;<strong><span dir=\"ltr\" role=\"presentation\">burnt areas </span></strong><span dir=\"ltr\" role=\"presentation\">and removing&nbsp;</span><span dir=\"ltr\" role=\"presentation\">loose dead skin</span><span dir=\"ltr\" role=\"presentation\">.</span><strong><span dir=\"ltr\" role=\"presentation\"> Blisters </span></strong><span dir=\"ltr\" role=\"presentation\">are </span><strong><span dir=\"ltr\" role=\"presentation\">de-</span><span dir=\"ltr\" role=\"presentation\">roofed</span><span dir=\"ltr\" role=\"presentation\">&nbsp;</span></strong><span dir=\"ltr\" role=\"presentation\">and </span> <span dir=\"ltr\" role=\"presentation\">an </span><span dir=\"ltr\" role=\"presentation\">appropriate dressing </span><span dir=\"ltr\" role=\"presentation\">is applied.<strong>&nbsp;</strong></span></p>\n<p><span dir=\"ltr\" role=\"presentation\"><strong>Biological dressing </strong>(collagen dressings, amniotic membrane, etc.) is the preferred dressing material, especially in partial thickness burns.&nbsp;</span></p>\n<p><span dir=\"ltr\" role=\"presentation\">If this is not available then a non-adhesive dressing like <strong>paraffin gauze</strong> impregnated with <strong>silver sulfadiazine&nbsp;(SSD) cream</strong>, colloidal silver, ionic silver cream, or silver nitrate cream can be applied. Since increased&nbsp;resistance to SSD has recently emerged, it should be <strong>judiciously used</strong> and reserved&nbsp;for <strong>deep dermal, full thickness, infected,&nbsp;</strong>and <strong>old neglected burns</strong>.</span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/74510e75cc6845ff89d59e0319a190d5x1280x1307.JPEG"
    ]
  },
  {
    "text": "Which of the following antibiotics will be most appropriate for managing the burn wound in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Mafenide acetate"
      },
      {
        "id": 2,
        "text": "Neomycin"
      },
      {
        "id": 3,
        "text": "Silver nitrate"
      },
      {
        "id": 4,
        "text": "Silver sulfadiazine"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a burn <strong>eschar</strong>. Among the given topical antibiotics, only <strong>mafenide acetate </strong>penetrates burn eschar to reach the interface with the patient's viable tissue.</p>\n<p>This agent has the disadvantage that it is <strong>quite painful </strong>on any partial thickness areas, and it is a carbonic anhydrase inhibitor and can potentially cause <strong>metabolic acidosis.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9daad2392cd64f30bca89362a60f4c5b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old homeless man was brought to a PHC in Himachal Pradesh during late winter. He was found unresponsive. His rectal temperature was 23 degrees C, pulse was not measurable, heart rate was 30 per minute and respiratory rate was 6. Rewarming with an electric blanket was started. Which organ is most susceptible to dysfunction in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Brain"
      },
      {
        "id": 2,
        "text": "Heart"
      },
      {
        "id": 3,
        "text": "Liver"
      },
      {
        "id": 4,
        "text": "Kidney"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>hypothermia</strong>. The <strong>heart</strong> is the organ <strong>most sensitive</strong> to cold and is subject to <strong>ventricular fibrillation or asystole</strong> when the temperature drops to 21&ndash;24 &deg;C.</p>\n<p>Hypothermia affects the dissociation of oxygen from hemoglobin, so less oxygen is released to the tissues. Other complications are coagulopathies and disseminated intravascular coagulation (DIC), pancreatitis, and acute renal failure.</p>\n<p>Classification of hypothermia:</p>\n<table>\n<tbody>\n<tr>\n<td width=\"208\">\n<p><strong>&nbsp;</strong></p>\n</td>\n<td width=\"208\">\n<p><strong>Trauma</strong></p>\n</td>\n<td width=\"208\">\n<p><strong>Accidental</strong></p>\n</td>\n</tr>\n<tr>\n<td width=\"208\">\n<p><strong>Mild</strong></p>\n</td>\n<td width=\"208\">\n<p>36-34&nbsp;<sup>o</sup>C</p>\n</td>\n<td width=\"208\">\n<p>35-32&nbsp;<sup>o</sup>C</p>\n</td>\n</tr>\n<tr>\n<td width=\"208\">\n<p><strong>Moderate</strong></p>\n</td>\n<td width=\"208\">\n<p>34-32&nbsp;<sup>o</sup>C</p>\n</td>\n<td width=\"208\">\n<p>32-28&nbsp;<sup>o</sup>C</p>\n</td>\n</tr>\n<tr>\n<td width=\"208\">\n<p><strong>Severe</strong></p>\n</td>\n<td width=\"208\">\n<p>&lt;32&nbsp;<sup>o</sup>C</p>\n</td>\n<td width=\"208\">\n<p>&lt;28&nbsp;<sup>o</sup>C</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Sweating is usually absent in _____",
    "choices": [
      {
        "id": 1,
        "text": "Heat cramp"
      },
      {
        "id": 2,
        "text": "Heat exhaustion"
      },
      {
        "id": 3,
        "text": "Classic heat stroke"
      },
      {
        "id": 4,
        "text": "Heat syncope"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Sweating</strong> is usually <strong>absent</strong> in classic (epidemic) <strong>heatstroke</strong> (CHS).</p>\n<p><strong>Heatstroke</strong>&nbsp;occurs as a result of an imbalance between heat production and heat dissipation (sweating). The skin is pink or ashen and sometimes, paradoxically,<strong> dry </strong>and <strong>hot. </strong>Dry skin in the presence of <strong>hyperpyrexia</strong> is virtually pathognomonic. It is of 2 types:</p>\n<ul>\n<li><strong>Exertion-induced</strong>&nbsp;<strong>heat stroke</strong> is&nbsp;seen in people with prolonged exposure to or physical exertion in high temperatures, usually without adequate training.</li>\n<li><strong>Sedentary&nbsp;heatstroke</strong> (CHS) is a disease of elderly or infirm people whose cardiovascular systems are&nbsp;<strong>unable to adapt</strong>&nbsp;to the stress of a hot environment and release sufficient heat such that body temperature rises.</li>\n</ul>\n<p><strong>Heat Cramps:</strong></p>\n<ul>\n<li>These are painful spasms of voluntary muscles which follow strenuous work in a hot atmosphere.</li>\n<li>Caused by loss of water and salt in <strong>profuse sweating.</strong></li>\n</ul>\n<p><strong>Heat exhaustion/heat prostration:</strong></p>\n<ul>\n<li>Collapse <strong>without</strong> any <strong>elevation of body temperature</strong></li>\n<li>Occurs due to exposure to high temperature in closed environment</li>\n<li>Precipitated by muscular exercise and unsuitable clothing</li>\n<li>Extreme exhaustion with peripheral vascular collapse with <strong>scanty sweating.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A marathon runner was training on a hot afternoon when he experienced leg cramps and dizziness. He fainted and was taken indoors by his coach. His temperature was 104.8 F, pulse 126 per minute and  BP 90/60 mm of Hg. Despite an hour of rest and cold sponging, he did not improve. Which of the following is false regarding his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Is a result of imbalance between heat production and heat dissipation"
      },
      {
        "id": 2,
        "text": "The patient should be cooled rapidly"
      },
      {
        "id": 3,
        "text": "Only occurs during exertion"
      },
      {
        "id": 4,
        "text": "Body temperature is measured rectally"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The heat stroke may be either <strong>exertion induced</strong> or <strong>sedentary heatstroke</strong>.</p>\n<p><strong>Heat stroke</strong> occurs as a result of an imbalance between heat production and heat dissipation.</p>\n<ul>\n<li><strong>Exertion-induced</strong>&nbsp;heat stroke is&nbsp;seen in people with prolonged exposure to or physical exertion in high temperatures, usually without adequate training.</li>\n<li><strong>Sedentary </strong>heat stroke is a disease of elderly or infirm people whose cardiovascular systems are <strong>unable to adapt</strong> to the stress of a hot environment and release sufficient heat such that body temperature rises.</li>\n</ul>\n<p>The body temperature must be measured rectally.</p>\n<p>Treatment is <strong>rapid cooling </strong>by spraying the patient with water at 15 &deg;C.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '46 Burns';
        const quizFilename = '46-burns-1c640adb.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>