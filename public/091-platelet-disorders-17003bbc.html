<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>091 Platelet Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the lifespan of a platelet?",
    "choices": [
      {
        "id": 1,
        "text": "24 hours"
      },
      {
        "id": 2,
        "text": "5 days"
      },
      {
        "id": 3,
        "text": "7 days"
      },
      {
        "id": 4,
        "text": "2 weeks"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The average <strong>lifespan</strong> of <strong>platelets</strong> in circulation is <strong>7&ndash;10 days</strong>.</p>\n<p>Thrombopoietin <strong>(TPO)</strong> is the regulator of platelet production. A reduction in platelet and megakaryocyte mass increases the level of TPO, which then stimulates platelet production.</p>\n<p>The shelf life of donor platelets is 5 days. It is stored on a special agitator at 20-24 &deg;C.&nbsp;The half-life of transfused platelets is 3-5 days.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following would you not expect to see in patients with a platelet disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Petechiae"
      },
      {
        "id": 2,
        "text": "Ecchymosis"
      },
      {
        "id": 3,
        "text": "Hemarthrosis"
      },
      {
        "id": 4,
        "text": "Gastrointestinal bleeds"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Hemarthrosis</strong> is highly suggestive of a <strong>coagulation disorder,&nbsp;</strong>not a platelet disorder.</p>\n<p>Bleeding diathesis can occur due to:</p>\n<ul>\n<li>Platelet disorders - mucocutaneous bleeding like <strong>petechiae</strong>, purpura, <strong>ecchymoses</strong>, epistaxis, menorrhagia, gastrointestinal (<strong>GI</strong>) <strong>bleeds</strong></li>\n<li>Coagulation disorders - hemarthrosis, muscle hematomas, and bleeding into soft tissues</li>\n<li>Disorders of the vessel wall (Henoch-Sch&ouml;nlein purpura, scurvy) - purpura and ecchymosis&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/98bceb172651412e82d9eab512b76b04x1280x2210.JPEG"
    ]
  },
  {
    "text": "Which of the following is a disorder of platelet adhesion?",
    "choices": [
      {
        "id": 1,
        "text": "Glanzmann\u2019s thrombasthenia"
      },
      {
        "id": 2,
        "text": "Bernard Soulier syndrome"
      },
      {
        "id": 3,
        "text": "Wiskott Aldrich syndrome"
      },
      {
        "id": 4,
        "text": "Hermansky Pudlak syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bernard Soulier </strong>syndrome is a disorder of <strong>platelet adhesion</strong>.&nbsp;It occurs due to an inherited defect in the <strong>GPIb-IX</strong> complex.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/56f11346987e42ae8a45ab9a221cab9dx1280x2203.JPEG"
    ]
  },
  {
    "text": "Patients with which of the following conditions would have a low platelet count?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet storage pool disorder"
      },
      {
        "id": 2,
        "text": "Wiskott-Aldrich syndrome"
      },
      {
        "id": 3,
        "text": "Henoch-Schonlein purpura"
      },
      {
        "id": 4,
        "text": "Hemophilia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Thrombocytopenia</strong> is a feature of&nbsp;<strong>Wiskott-Aldrich</strong> syndrome.</p>\n<p>It is an <strong>X-linked</strong> recessive condition caused by mutations in the&nbsp;<strong>WASP </strong>gene. It affects <strong>T-cells </strong>and<strong> platelets</strong> and presents with the following features:&nbsp;</p>\n<ul>\n<li><strong>Eczema</strong></li>\n<li><strong>Thrombocytopenia</strong>&nbsp;- along with&nbsp;decreased platelet size, impaired platelet aggregation response</li>\n<li><strong>Immunodeficiency</strong>&nbsp;- low IgM, high IgE, defective regulatory T cells causing recurrent bacterial infections.</li>\n</ul>\n<p>Option A: Platelet storage pool disorder is a disorder of defective platelet granule formation.</p>\n<p>Option C: Henoch-Schonlein purpura is a type of small vessel&nbsp;vasculitis in children and young adults.</p>\n<p>Option D: Hemophilia is a coagulation disorder, hence the platelet count is not affected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Immune-mediated destruction of platelets is seen in patients with which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Bernard-Soulier syndrome"
      },
      {
        "id": 2,
        "text": "Hermansky-Pudlak syndrome"
      },
      {
        "id": 3,
        "text": "Thrombotic thrombocytopenic purpura"
      },
      {
        "id": 4,
        "text": "Drug-induced thrombocytopenia"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Immune-mediated destruction</strong> of platelets is seen in <strong>drug-induced</strong>&nbsp;<strong>thrombocytopenia.</strong>&nbsp;Common drugs that cause this are quinidine, heparin, sulfa compounds.&nbsp;</p>\n<p>Drug-dependent antibody binding can only be demonstrated in the presence of the drug in the laboratory assays. The thrombocytopenia normally occurs within 21 days of initial exposure and usually gets resolved after 7-10 days once the drug is stopped.&nbsp;</p>\n<p>Immune-mediated destruction of platelets is seen in:</p>\n<ul>\n<li><strong>Drug-induced</strong> thrombocytopenia</li>\n<li><strong>Infection-induced</strong> thrombocytopenia</li>\n<li>Idiopathic/ immune thrombocytopenic purpura&nbsp;(ITP)</li>\n</ul>\n<p>Option A:&nbsp;Bernard-Soulier syndrome is a disorder of platelet adhesion. There are no autoantibodies against platelets.</p>\n<p>Option B: Hermansky-Pudlak syndrome is an&nbsp;inherited disorder with defective&nbsp;granule formation in platelets. It affects platelet activation and aggregation.</p>\n<p>Option C: Thrombotic microangiopathies like thrombotic thrombocytopenic purpura (TTP) and hemolytic uremic syndrome&nbsp;(HUS) lead to thrombocytopenia due to increased platelet consumption.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man comes to you with complaints of bleeding gums and the following skin rash. He reports that he had diarrhea last week after eating at a roadside eatery. History is significant for deep vein thrombosis 6 months ago that was treated with heparin. His CBC report revealed a platelet count of 15,000/\u00b5L, normal RBC and WBC count. His peripheral smear was normal. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hemolytic uremic syndrome"
      },
      {
        "id": 2,
        "text": "Thrombotic thrombocytopenic purpura"
      },
      {
        "id": 3,
        "text": "Immune thrombocytopenic purpura"
      },
      {
        "id": 4,
        "text": "Heparin-induced thrombocytopenia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario and image showing <strong>petechiae</strong>\u00a0are suggestive of\u00a0<strong>immune thrombocytopenic purpura</strong>.</p>\n<p><strong>Immune thrombocytopenic purpura\u00a0</strong>(ITP) is an acquired disorder with <strong>autoantibodies</strong> against platelet membrane glycoproteins<strong> IIb-IIIa</strong> or <strong>Ib-IX</strong>. It can either be primary (idiopathic) or secondary to autoimmune conditions like SLE or infections like HIV and hepatitis C.</p>\n<p>It presents with features of <strong>mucocutaneous</strong> <strong>bleeding</strong>. CBC shows isolated thrombocytopenia and peripheral smear does not reveal any hemolysis.\u00a0</p>\n<table style=\"height: 263px; width: 346px;\">\n<tbody>\n<tr style=\"height: 40px;\">\n<td style=\"width: 161.172px; height: 40px;\"><strong>Acute ITP</strong></td>\n<td style=\"width: 168.828px; height: 40px;\"><strong>Chronic ITP</strong></td>\n</tr>\n<tr style=\"height: 40px;\">\n<td style=\"width: 161.172px; height: 40px;\">Common in children</td>\n<td style=\"width: 168.828px; height: 40px;\">Common in adults (females &gt; males)</td>\n</tr>\n<tr style=\"height: 58px;\">\n<td style=\"width: 161.172px; height: 58px;\">Associated with an antecedent viral infection</td>\n<td style=\"width: 168.828px; height: 58px;\">Not associated with antecedent infection</td>\n</tr>\n<tr style=\"height: 66.5625px;\">\n<td style=\"width: 161.172px; height: 66.5625px;\">Spontaneous remission in 80% cases</td>\n<td style=\"width: 168.828px; height: 66.5625px;\">Spontaneous remission is not usually seen</td>\n</tr>\n</tbody>\n</table>\n<p>Options <strong>A</strong> and <strong>B</strong>: HUS and TTP are microangiopathies. They are associated with <strong>hemolysis and schistocytes</strong> on peripheral smear.\u00a0</p>\n<p>Option <strong>D:</strong>\u00a0Heparin-induced thrombocytopenia typically presents <strong>within 5-10 days of treatment</strong>. Hence, it is not the likely diagnosis in this patient.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b9f86e5242b74faaaab53f43357ffe24.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1839d0a0b6d64631b0d4aca0475d0791x1280x2203.JPEG"
    ]
  },
  {
    "text": "Two weeks after an upper respiratory tract infection, a 5-year-old presents with ecchymosis and petechiae all over the body. Abdominal examination revealed no hepatosplenomegaly. The platelet count is 15,000/\u00b5L and the coagulation profile is normal. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Peripheral blood smear is normal"
      },
      {
        "id": 2,
        "text": "Bone marrow biopsy shows increased megakaryocytes"
      },
      {
        "id": 3,
        "text": "Bleeding into the joints is a common manifestation"
      },
      {
        "id": 4,
        "text": "The condition resolves spontaneously in 80% patients"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This scenario is suggestive of <strong>acute immune thrombocytopenic purpura</strong>. Bleeding into the joints is seen in coagulation disorders and is not a manifestation&nbsp;of this condition.</p>\n<p>Immune thrombocytopenic purpura or&nbsp;idiopathic thrombocytopenic purpura&nbsp;<strong>(ITP)</strong> &nbsp;is an acquired disorder in which there is an immune-mediated destruction of platelets. It can be acute or chronic.</p>\n<p><strong>Acute ITP&nbsp;</strong>is common in children and is usually <strong>preceded</strong> by <strong>viral</strong> infection. It presents with mucocutaneous bleeding (epistaxis, petechiae, ecchymosis).&nbsp;Hepatomegaly, splenomegaly, lymphadenopathy, fever and jaundice are absent. The following laboratory features are seen:</p>\n<ul>\n<li>Thrombocytopenia (commonly&nbsp;&lt;20,000 / &mu;L)</li>\n<li>Bleeding time - prolonged</li>\n<li>PT/aPTT/INR - normal</li>\n<li>Bone marrow - normal/increased megakaryocytes</li>\n<li>Peripheral smear - normal</li>\n</ul>\n<p>This condition <strong>resolves</strong> <strong>spontaneously</strong> in 80% of the cases. Treatment is as follows:</p>\n<ul>\n<li>Platelet count &lt; 30,000 with risk factors for bleeding (antiplatelet drugs/anticoagulants or concomitant bleeding disorders): <strong>Oral glucocorticoids</strong> or <strong>IVIG</strong>&nbsp;</li>\n<li>Severe bleeding symptoms:&nbsp;<strong>IV methylprednisolone</strong>&nbsp;&plusmn;&nbsp;IVIG&nbsp;</li>\n<li>Life-threatening&nbsp;bleeding (like intracranial hemorrhage):&nbsp;<strong>platelet transfusion</strong> +&nbsp;IV methylprednisolone +&nbsp;IVIG&nbsp;</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old woman comes to the ER after developing a spontaneous nosebleed. Over the past 1 week, she has noticed blood on her toothbrush while brushing her teeth. She was diagnosed with hepatitis C three months ago. Investigations reveal a platelet count of 32,000/ \u00b5L and a bleeding time of 9 minutes . Which of the following is false regarding the treatment of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "She requires regular platelet transfusions until platelet count is normalized"
      },
      {
        "id": 2,
        "text": "Prednisone  or anti-D immunoglobulins can be used as the first-line treatment"
      },
      {
        "id": 3,
        "text": "Splenectomy may be done if she relapses after medical management"
      },
      {
        "id": 4,
        "text": "Romiplostim and eltrombopag can be used if there is no response to splenectomy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This clinical scenario in an <strong>adult</strong> patient is suggestive of <strong>chronic ITP</strong> (idiopathic thrombocytopenic purpura). She does not require <strong>platelet transfusion</strong>.&nbsp;It is recommended only for patients with <strong>severe bleeding </strong>manifestations&nbsp;(intracranial/ gastrointestinal) or platelet count<strong> &lt; 5000&nbsp;&mu;L.</strong></p>\n<p>Chronic ITP can either be <strong>primary</strong> (idiopathic) or <strong>secondary</strong> to autoimmune conditions like SLE or infections like HIV and <strong>hepatitis C</strong>. Depending on the clinical features, the management is as follows:</p>\n<table style=\"height: 469px; width: 477px;\">\n<tbody>\n<tr>\n<td style=\"width: 34.8281px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 218.266px; text-align: center;\"><strong>Clinical features</strong></td>\n<td style=\"width: 201.906px; text-align: center;\"><strong>Management</strong></td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">\n<p>1. &nbsp;&nbsp;</p>\n</td>\n<td style=\"width: 218.266px;\">\n<p>Minor bleeding manifestations (and/or)</p>\n<p>Platelet count &gt; 5000/&nbsp;&mu;L</p>\n</td>\n<td style=\"width: 201.906px;\">\n<p><strong>Prednisone</strong> (OR)</p>\n<p><strong>Anti-D</strong> <strong>immunoglobulin</strong> therapy - effective only in Rh-positive patients (OR)</p>\n<p>Intravenous immunoglobulin (<strong>IVIG</strong>)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">\n<p>2. &nbsp;</p>\n</td>\n<td style=\"width: 218.266px;\">\n<p>Severe ITP (any of the following):</p>\n<ul>\n<li>Significant GI / intracranial bleeding</li>\n<li>Platelet count &lt; 5000/&mu;L</li>\n<li>Signs of impending bleeding (retinal or large oral mucosal bleeds)</li>\n</ul>\n</td>\n<td style=\"width: 201.906px;\">\n<p>Platelet transfusion (AND)</p>\n<p>High-dose glucocorticoids (AND)</p>\n<p>IVIG / Anti-D immunoglobulins + Rituximab</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">3. &nbsp;</td>\n<td style=\"width: 218.266px;\">Relapse after first-line therapy</td>\n<td style=\"width: 201.906px;\"><strong>Splenectomy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">4. &nbsp;&nbsp;</td>\n<td style=\"width: 218.266px;\">Unresponsive to all other therapy or relapse after splenectomy</td>\n<td style=\"width: 201.906px;\">Thrombopoietin receptor agonists - <strong>romiplostim</strong> (subcutaneous), <strong>eltrombopag</strong> (oral)</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the best treatment for the relapse of immune thrombocytopenic purpura?",
    "choices": [
      {
        "id": 1,
        "text": "IV immunoglobulins"
      },
      {
        "id": 2,
        "text": "Steroids"
      },
      {
        "id": 3,
        "text": "Splenectomy"
      },
      {
        "id": 4,
        "text": "Blood transfusion"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Splenectomy</strong> is the treatment of choice in a case of <strong>immune thrombocytopenic purpura</strong> (ITP) relapse after <strong>first line therapy</strong> with <strong>glucocorticoids</strong>. The relapse usually occurs once they are tapered. <strong>Vaccination</strong> against encapsulated organisms (pneumococcus, meningococcus, H. influenzae) is advised before splenectomy is performed.</p>\n<p>It is important to note that in some patients <strong>ITP resolves by itself,</strong> and observation along with intermittent <strong>IV immunoglobulins</strong> and <strong>anti - Rh(D)</strong> administration or administration of a <strong>thrombopoietin receptor agonist</strong> (eltrombopag, romiplostim) can be a viable option before splenectomy is considered.</p>\n<p>The treatment of ITP is as follows:</p>\n<table style=\"height: 469px; width: 477px;\">\n<tbody>\n<tr>\n<td style=\"width: 34.8281px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 218.266px; text-align: center;\">Clinical features</td>\n<td style=\"width: 201.906px; text-align: center;\">Management</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">\n<p>1. &nbsp;&nbsp;</p>\n</td>\n<td style=\"width: 218.266px;\">\n<p>Minor bleeding manifestations (and/or)</p>\n<p>Platelet count &gt; 5000/&nbsp;&mu;L</p>\n</td>\n<td style=\"width: 201.906px;\">\n<p><strong>Prednisone</strong> (OR)</p>\n<p><strong>Anti-D immunoglobulin therapy</strong> - effective only in Rh-positive patients (OR)</p>\n<p>Intravenous immunoglobulin (IVIG)</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">\n<p>2. &nbsp;</p>\n</td>\n<td style=\"width: 218.266px;\">\n<p>Severe ITP (any of the following):</p>\n<ul>\n<li>Significant GI / intracranial bleeding</li>\n<li>Platelet count &lt; 5000/&mu;L</li>\n<li>Signs of impending bleeding (retinal or large oral mucosal bleeds)</li>\n</ul>\n</td>\n<td style=\"width: 201.906px;\">\n<p>Platelet transfusion (AND)</p>\n<p>High-dose glucocorticoids (AND)</p>\n<p>IVIG / Anti-D immunoglobulins + Rituximab</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">3. &nbsp;</td>\n<td style=\"width: 218.266px;\">Relapse after first-line therapy</td>\n<td style=\"width: 201.906px;\"><strong>Splenectomy</strong></td>\n</tr>\n<tr>\n<td style=\"width: 34.8281px;\">4. &nbsp;&nbsp;</td>\n<td style=\"width: 218.266px;\">Unresponsive to all other therapy or relapse after splenectomy</td>\n<td style=\"width: 201.906px;\">Thrombopoietin receptor agonists - <strong>romiplostim</strong> (subcutaneous), <strong>eltrombopag</strong> (oral)</td>\n</tr>\n</tbody>\n</table>\n<p>ITP is an <strong>acquired</strong> disorder characterized by the <strong>immune-mediated</strong> destruction of platelets and possibly inhibition of platelet release from the megakaryocyte. Secondary causes of ITP include systemic lupus erythematosus (<strong>SLE</strong>), <strong>HIV-AIDS</strong>, and <strong>Hepatitis C</strong>.</p>\n<p>ITP usually presents with <strong>mucocutaneous bleeding</strong>, <strong>very low platelet count</strong>, and normal peripheral blood cells. Patients typically exhibit ecchymoses and petechiae or they may incidentally discover thrombocytopenia during a routine complete blood count.&nbsp;Rarely, life-threatening bleeding may occur. The presence of <strong>wet purpura</strong> (blood blisters in the mouth) and <strong>retinal hemorrhages</strong> can serve as <strong>warning signs</strong> of potentially life-threatening bleeding.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "It is your first day as an intern in the medicine ward. The senior resident tells you to check the platelet count of a patient who is being monitored for thrombocytopenia. He was started on a new medication the previous night. What drug was most likely prescribed?",
    "choices": [
      {
        "id": 1,
        "text": "Phenytoin"
      },
      {
        "id": 2,
        "text": "Ampicillin"
      },
      {
        "id": 3,
        "text": "Abciximab"
      },
      {
        "id": 4,
        "text": "Amiodarone"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Abciximab</strong> can cause a drop in platelet count&nbsp;within<strong> 24 hours</strong> of initial exposure. Hence, these patients must be monitored for <strong>thrombocytopenia.</strong>&nbsp;This is due to naturally-occurring <strong>antibodies</strong> that cross-react with the drug bound to the platelets.</p>\n<p>Thrombocytopenia due to <strong>other drugs</strong> typically occurs <strong>several days</strong> after exposure (average 21 days) and resolves in 7-10 days after drug withdrawal. &nbsp;Drug-induced thrombocytopenia can occur due to the following mechanisms:</p>\n<ul>\n<li>Bone&nbsp;marrow suppression - chemotherapeutic drugs</li>\n<li>Drug dependent antibodies that react with platelet surface antigens - quinine and sulfonamides</li>\n<li>Naturally occurring antibodies that cross-react with drugs bound to the platelets - platelet Gp IIb/IIIa inhibitors</li>\n</ul>\n<p>Some of the drugs that cause thrombocytopenia are:</p>\n<ul style=\"list-style-type: circle;\">\n<li>Antibiotics - <strong>ampicillin</strong>, cephalosporins, piperacillin, vancomycine</li>\n<li>Analgesics - ibuprofen, acetaminophen</li>\n<li>Anti-epileptics - <strong>phenytoin</strong>, carbamazepine</li>\n<li>Heparin</li>\n<li><strong>Amiodarone</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Patients with all of the following usually present with bleeding except:",
    "choices": [
      {
        "id": 1,
        "text": "Heparin-induced thrombocytopenia"
      },
      {
        "id": 2,
        "text": "Drug-induced thrombocytopenia"
      },
      {
        "id": 3,
        "text": "Inherited thrombocytopenia"
      },
      {
        "id": 4,
        "text": "Infection-induced thrombocytopenia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Heparin-induced thrombocytopeni</strong>a (HIT) is not associated with bleeding. On the contrary, it is associated with an increased risk of <strong>thrombosis</strong>.</p>\n<p>This condition&nbsp;occurs due to&nbsp;the production of <strong>antibodies </strong>against<strong>&nbsp;</strong>the<strong> heparin-PF4 complex</strong> (platelet factor 4, a platelet-specific protein). These antibodies can <strong>activate platelets</strong> and result in thrombosis. It is seen 5-14 days after exposure to heparin.</p>\n<p>These antibodies can be detected using ELISA or serotonin release assay. This condition is managed by <strong>discontinuing heparin</strong> and using alternative anticoagulants.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cannot be used in the treatment of patients with heparin-induced thrombocytopenia?",
    "choices": [
      {
        "id": 1,
        "text": "Danaparoid"
      },
      {
        "id": 2,
        "text": "Lepirudin"
      },
      {
        "id": 3,
        "text": "Argatroban"
      },
      {
        "id": 4,
        "text": "Enoxaparin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Low molecular weight heparin (LMWH) such as <strong>enoxaparin</strong> cannot be used in the treatment of&nbsp;heparin-induced thrombocytopenia (HIT). This is because <strong>HIT antibodies</strong> (against anti-PF4-heparin complex) may&nbsp;<strong>cross-react</strong> with LMWH.</p>\n<p>HIT can occur following exposure to unfractionated heparin and less commonly with LMWH.</p>\n<p>The treatment of HIT is as follows:</p>\n<ul>\n<li><strong>Discontinue</strong><strong>&nbsp;heparin</strong></li>\n<li>Anticoagulation with <strong>non-heparin anticoagulants</strong> even in the absence of thrombosis, since there&nbsp;is a high risk of thrombosis.\n<ul>\n<li>Direct thrombin inhibitors: Argatroban, lepirudin, bivalirudin</li>\n<li>Danaparoid (heparinoid)</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The CBC of a 33-year-old woman revealed a low platelet count. However, further evaluation revealed this to be an in vitro sampling error. Which of the following is the likely cause of this finding?",
    "choices": [
      {
        "id": 1,
        "text": "EDTA"
      },
      {
        "id": 2,
        "text": "Sodium citrate"
      },
      {
        "id": 3,
        "text": "Heparin"
      },
      {
        "id": 4,
        "text": "Finger stick sample"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>When a low platelet count is obtained with an EDTA sample, the peripheral blood smear should be evaluated. The platelet count must also be determined in blood collected in&nbsp;<strong>sodium citrate </strong>or<strong> heparin&nbsp;</strong>collection tubes&nbsp;or fresh<strong> fingerstick</strong>&nbsp;blood <strong>sample.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4f203d48f03b432f94a70bab3cd4348fx750x600.JPEG"
    ]
  },
  {
    "text": "Which of the following is false regarding patients with Bernard-Soulier syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet aggregation tests with epinephrine and ADP are normal"
      },
      {
        "id": 2,
        "text": "Ristocetin aggregation test is normal"
      },
      {
        "id": 3,
        "text": "Peripheral smear shows large platelets"
      },
      {
        "id": 4,
        "text": "Mild thrombocytopenia is seen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> ristocetin aggregation</strong> test is <strong>abnormal</strong>&nbsp;(no aggregation) in patients with <strong>Bernard-Soulier</strong>&nbsp;(BS) syndrome.</p>\n<p>It is an inherited disorder of platelet function or <strong>qualitative</strong>&nbsp;platelet disorder due to deficiency of the&nbsp;<strong>Gp&nbsp;Ib-IX </strong>receptor. This is the platelet membrane receptor&nbsp;for the von Willebrand factor (vWF). The binding of&nbsp;the <strong>vWF</strong> to the GpIb-IX-V complex on the platelet membrane is essential for <strong>platelet adhesion</strong> to the vessel wall.</p>\n<p>This condition presents with <strong>mild&nbsp;thrombocytopenia</strong> and peripheral&nbsp;smear shows <strong>large platelets</strong>.</p>\n<p>Platelet aggregation tests are performed to measure platelet activation and aggregation in vitro. Various platelet agonists like ADP, epinephrine, collagen, and ristocetin can be used to perform these tests. In&nbsp;Bernard-Soulier syndrome, the following responses are seen:</p>\n<ul>\n<li>With ristocetin - No response/no aggregation, as <strong>ristocetin&nbsp;</strong>specifically <strong>binds</strong> to the platelet membrane via the&nbsp;<strong>Gp Ib-IXa </strong>receptor</li>\n<li>With <strong>ADP</strong> or <strong>epinephrine</strong> - <strong>Normal response</strong>, as Gp IIb-IIIa receptor is not involved in this process</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the most common inherited bleeding disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Hemophilia A"
      },
      {
        "id": 2,
        "text": "Hemophilia B"
      },
      {
        "id": 3,
        "text": "Immune thrombocytopenia purpura"
      },
      {
        "id": 4,
        "text": "Von Willebrand disease"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Von Willebrand disease</strong> (vWD) is the most common inherited bleeding disorder.</p>\n<p>vWD occurs due to deficient or abnormal von Willebrand&nbsp;factor (vWF).&nbsp;vWF is synthesized by endothelial cells and megakaryocytes (gene located on chromosome 12p). It is then stored in endothelial storage vesicles, <strong>Weibel-Palade bodies.&nbsp;</strong>Metalloprotease <strong>ADAMTS13</strong>&nbsp;cleaves ultra-large multimers of VWF which are responsible for platelet adhesion.</p>\n<p>The functions of vWF and the corresponding symptoms include:</p>\n<ul>\n<li><strong>Adhesion</strong> of&nbsp;the <strong>platelets</strong>&nbsp;to the exposed subendothelium - symptoms of both platelet and bleeding disorders</li>\n<li>Prolongs the half-life&nbsp;of<strong>&nbsp;factor VIII</strong>&nbsp;by binding to it in circulation - hemophilia A like symptoms (rare)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is called autosomal hemophilia?",
    "choices": [
      {
        "id": 1,
        "text": "Type 2M von Willebrand disease"
      },
      {
        "id": 2,
        "text": "Type 2N von Willebrand disease"
      },
      {
        "id": 3,
        "text": "Type 2A von Willebrand disease"
      },
      {
        "id": 4,
        "text": "Type 2B von Willebrand disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Autosomal hemophilia</strong>&nbsp;is also called <strong>type 2N </strong>von Willebrand disease (<strong>vWD</strong>), as the clinical presentation is similar to hemophilia.</p>\n<p>The types of vWD are:</p>\n<table style=\"height: 169px; width: 459.8125px;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 85px; text-align: center;\"><strong>Type</strong></td>\n<td style=\"width: 47px; text-align: center;\"><strong>Inheritance</strong></td>\n<td style=\"width: 412px; text-align: center;\"><strong>Mechanism</strong></td>\n<td style=\"width: 81.8125px; text-align: center;\"><strong>Important characteristics</strong></td>\n</tr>\n<tr>\n<td style=\"width: 85px; text-align: center;\">1</td>\n<td style=\"width: 47px; text-align: center;\">AD</td>\n<td style=\"width: 412px; text-align: center;\">Partial quantitative deficiency of VWF</td>\n<td style=\"width: 81.8125px; text-align: center;\"><strong>Most common</strong> type</td>\n</tr>\n<tr>\n<td style=\"width: 85px; text-align: center;\">3</td>\n<td style=\"width: 47px; text-align: center;\">AR</td>\n<td style=\"width: 412px; text-align: center;\">Complete quantitative deficiency</td>\n<td style=\"width: 81.8125px; text-align: center;\">Most severe&nbsp;VWD</td>\n</tr>\n<tr>\n<td style=\"width: 85px; text-align: center;\">2A</td>\n<td style=\"width: 47px; text-align: center;\">AD</td>\n<td style=\"width: 412px; text-align: center;\">Loss of VWF multimers (increased cleavage by ADAMS13)</td>\n<td style=\"width: 81.8125px; text-align: center;\">Platelet adhesion defect</td>\n</tr>\n<tr>\n<td style=\"width: 85px; text-align: center;\">2B</td>\n<td style=\"width: 47px; text-align: center;\">AD</td>\n<td style=\"width: 412px; text-align: center;\">Increased binding of VWF to platelets causing VWF-platelet complex destruction</td>\n<td style=\"width: 81.8125px; text-align: center;\">Thrombocytopenia</td>\n</tr>\n<tr>\n<td style=\"width: 85px; text-align: center;\">2M</td>\n<td style=\"width: 47px; text-align: center;\">AD</td>\n<td style=\"width: 412px; text-align: center;\">Decreased affinity of VWF to platelets</td>\n<td style=\"width: 81.8125px; text-align: center;\">Platelet adhesion defect, very rare</td>\n</tr>\n<tr>\n<td style=\"width: 85px; text-align: center;\">2N</td>\n<td style=\"width: 47px; text-align: center;\"><strong>AR</strong></td>\n<td style=\"width: 412px; text-align: center;\">Decreased affinity of VWF to Factor VIII</td>\n<td style=\"width: 81.8125px; text-align: center;\"><strong>Autosomal hemophilia</strong></td>\n</tr>\n</tbody>\n</table>\n<p>In pseudo vWD,&nbsp;the vWF is normal. However, platelets have an increased affinity for vWF. It presents similar to vWD 2B with thrombocytopenia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following patients has Heyde's syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "A man with aortic stenosis with gastrointestinal bleeding"
      },
      {
        "id": 2,
        "text": "A woman with aortic stenosis with intracranial bleed"
      },
      {
        "id": 3,
        "text": "A man with aortic regurgitation with gastrointestinal bleeding"
      },
      {
        "id": 4,
        "text": "A woman with aortic regurgitation with intracranial bleed"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Heyde&rsquo;s</strong> syndrome is<strong>&nbsp;aortic stenosis</strong> with <strong>gastrointestinal bleeding,&nbsp;</strong>due to&nbsp;<strong>angiodysplasia </strong>of the gastrointestinal tract.</p>\n<p>The shear stress on blood passing through the stenotic aortic valve&nbsp;produces a change in the von Willebrand factor making it susceptible to serum proteases. Hence, large multimer forms are lost, leading to an <strong>acquired type 2 </strong>von Willebrand disease (<strong>vWD</strong>).&nbsp;The condition is reversed with the replacement of the aortic valve.</p>\n<p>Other causes of <strong>acquired</strong> <strong>vWD</strong> include:</p>\n<ul>\n<li>Multiple myeloma</li>\n<li>Non-Hodgkin's lymphoma</li>\n<li>Polycythemia vera</li>\n<li>Systemic lupus erythematosus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following laboratory findings is seen in a patient with von Willebrand's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Normal ristocetin aggregation test"
      },
      {
        "id": 2,
        "text": "Increased bleeding time"
      },
      {
        "id": 3,
        "text": "Increased prothrombin time"
      },
      {
        "id": 4,
        "text": "Decreased activated partial thromboplastin time"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bleeding time</strong> is <strong>increased</strong> in von Willebrand&nbsp;disease (<strong>vWD</strong>). It is a combination of a&nbsp;platelet adhesion defect with factor VIII deficiency.</p>\n<p>The laboratory findings in vWD include:&nbsp;</p>\n<ul>\n<li>Platelet count is normal (except type 2B)</li>\n<li>Bleeding time&nbsp;is prolonged&nbsp;</li>\n<li><strong>Ristocetin aggregation </strong>is<strong> abnormal</strong></li>\n<li>Other platelet aggregation tests are normal</li>\n<li>Prothrombin time (PT) is normal</li>\n<li><strong>aPTT </strong>is<strong> prolonged</strong></li>\n<li>VWF activity is decreased</li>\n<li>Factor VIII activity is decreased</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 28-year-old woman is being evaluated for prolonged bleeding following a tooth extraction. She also reports heavy bleeding during menses and recurrent gum bleeds. Labs show increased aPTT, normal PT, and increased bleeding time. Which of the following is the first-line treatment for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Tranaxemic acid"
      },
      {
        "id": 2,
        "text": "Factor VIII concentrate"
      },
      {
        "id": 3,
        "text": "Von Willebrand factor concentrate"
      },
      {
        "id": 4,
        "text": "Desmopressin"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical scenario is suggestive of <strong>von Willebrand's disease</strong>. The preferred first-line treatment is <strong>desmopressin\u00a0</strong>(DDAVP).</p>\n<p>This drug acts on endothelial<strong> V2 receptors</strong> causing the <strong>release</strong> of <strong>VWF</strong> and <strong>factor VIII</strong> from endothelial stores.\u00a0DDAVP can be given intravenously or by an intranasal spray. The side effects include\u00a0tachyphylaxis and hyponatremia.\u00a0</p>\n<p><strong>VWF</strong> <strong>concentrate</strong> and <strong>factor VIII</strong> <strong>concentrate</strong> are reserved for patients with <strong>severe disease</strong> or prior to major procedures.\u00a0Antifibrinolytic therapy (tranexamic acid or\u00a0\u03b5-aminocaproic acid) may be used for the prevention and treatment of mucosal bleeding.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following features is not seen in patients with Glanzmann\u2019s thrombasthenia?",
    "choices": [
      {
        "id": 1,
        "text": "Abnormal platelet aggregation on adding ADP"
      },
      {
        "id": 2,
        "text": "Decreased platelet count"
      },
      {
        "id": 3,
        "text": "Normal von Willebrand  factor levels"
      },
      {
        "id": 4,
        "text": "Normal platelet aggregation to ristocetin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Thrombocytopenia is not seen in <strong>Glanzmann&rsquo;s</strong> <strong>thrombasthenia</strong>.</p>\n<p>Glanzmann&rsquo;s thrombasthenia is a <strong>primary defect</strong> of platelet function (<strong>aggregation</strong>). It occurs due to congenital <strong>absence</strong> of the <strong>GpIIb/IIIa&nbsp;</strong>receptor. It presents as superficial mucocutaneous bleeding with normal platelet count and single <strong>isolated platelets</strong> without clumping on peripheral smear.&nbsp;The levels of <strong>vWF</strong> are <strong>normal</strong>.</p>\n<p>Normally, release of ADP causes platelets to change shape and bind to fibrinogen through the GpIIb/IIIa receptor. In Glanzmann&rsquo;s thrombasthenia, absence of the receptor causes <strong>abnormal</strong> <strong>aggregation</strong>&nbsp;(absent or reduced) on adding <strong>ADP</strong>. However, aggregation in response to <strong>ristocetin</strong> is <strong>normal</strong>, as it is dependent on GpIb and vWF.</p>\n<p>Secondary platelet dysfunction can be seen in the following conditions:</p>\n<ul style=\"list-style-type: circle;\">\n<li>Uremia</li>\n<li>Paraproteinemia</li>\n<li>Myeloproliferative disorders</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A physician decides to start a patient with stroke on antiplatelet medication. All of the following drugs would be effective except:",
    "choices": [
      {
        "id": 1,
        "text": "Clopidogrel"
      },
      {
        "id": 2,
        "text": "Ticlopidine"
      },
      {
        "id": 3,
        "text": "Ticagrelor"
      },
      {
        "id": 4,
        "text": "Pagoclone"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Pagoclone is an anxiolytic medication. It is not an antiplatelet drug.</p>\n<p>The thienopyridine drugs are ADP receptor or&nbsp;<strong>P2Y12 antagonists</strong>&nbsp;that inhibit ADP mediated platelet aggregation. They include the following drugs:</p>\n<ul>\n<li><strong>Clopidogrel</strong> - commonly used</li>\n<li><strong>Ticagrelor</strong> -&nbsp;reversible drug with a shorter t<sub>1/2</sub>, does not require activation, may cause mild, self-limited dyspnea&nbsp;</li>\n<li>Prasugrel -&nbsp;10 times more potent than clopidogrel, rapid onset of action, better absorption, more predictable&nbsp;</li>\n<li><strong>Ticlopidine</strong></li>\n</ul>\n<p>Clopidogrel and prasugrel are prodrugs that require <strong>activation</strong> by <strong>cytochrome P450</strong> enzymes.&nbsp;CYP2C19 polymorphisms can cause&nbsp;reduced platelet inhibition with clopidogrel and increased risk of cardiovascular events.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 24-year-old woman underwent evaluation for bleeding manifestations and severe anemia. Investigations revealed combined autoimmune hemolytic anemia and idiopathic thrombocytopenic purpura. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Evans syndrome"
      },
      {
        "id": 2,
        "text": "May-Hegglin anomaly"
      },
      {
        "id": 3,
        "text": "Fechtner syndrome"
      },
      {
        "id": 4,
        "text": "Rosenthal syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Combined autoimmune hemolytic anemia (<strong>AIHA</strong>) and idiopathic thrombocytopenic purpura (<strong>ITP</strong>) is called <strong>Evans syndrome</strong>.</p>\n<p>Options B and C: May-Hegglin anomaly and Fechtner syndrome are autosomal dominant hereditary conditions presenting with bleeding, sensorineural hearing loss, glomerulonephritis, and/or eye abnormalities.&nbsp;The severity of the bleeding symptoms is out of proportion to the moderately decreased platelet count.</p>\n<p>Option D: Rosenthal syndrome or hemophilia C&nbsp;refers to factor XI deficiency.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common side effect experienced by patients taking enteric-coated aspirin?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrointestinal symptoms"
      },
      {
        "id": 2,
        "text": "Aspirin sensitivity"
      },
      {
        "id": 3,
        "text": "Aspirin tolerance"
      },
      {
        "id": 4,
        "text": "Medication overuse headache"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common side effect of <strong>aspirin</strong> is <strong>gastrointestinal</strong> symptoms. The use of enteric-coated aspirin does not reduce these side effects.</p>\n<p>Aspirin irreversibly acetylates and <strong>inhibits</strong> platelet cyclooxygenase <strong>(COX)-1,&nbsp;</strong>which causes reduced synthesis of <strong>thromboxane A2. </strong>At high doses, it also inhibits <strong>COX-2</strong>,&nbsp;which results in the <strong>anti-inflammatory</strong>&nbsp;effects of aspirin.</p>\n<p>The major GI side effects include&nbsp;dyspepsia, erosive gastritis, peptic ulcers with bleeding and perforation.&nbsp;The overall risk of <strong>major bleeding</strong> with aspirin is 1&ndash;3% per year, which increases 2-3 fold if there is concurrent use of&nbsp;other antiplatelet drugs or anticoagulants. The risk of bleeding can be <strong>reduced</strong> by <strong>eradication</strong> of <strong><em>Helicobacter pylori</em></strong> infection and giving proton pump inhibitors (<strong>PPIs</strong>).</p>\n<p><strong>Aspirin sensitivity&nbsp;</strong>refers to&nbsp;bronchospasm or urticaria/angioedema seen immediately after administration of aspirin. It is also called <strong>Samter's</strong> <strong>triad</strong> (asthma, recurrent nasal polyps, aspirin sensitivity).&nbsp;In patients with&nbsp;<strong>aspirin resistance,</strong>&nbsp;there is failure of aspirin to produce its normal platelet inhibitory functions.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect about the mechanism of action of dipyridamole?",
    "choices": [
      {
        "id": 1,
        "text": "Increases levels of cyclic AMP in platelets"
      },
      {
        "id": 2,
        "text": "Blocks the reuptake of adenosine"
      },
      {
        "id": 3,
        "text": "Inhibits phosphodiesterase-mediated cyclic AMP degradation"
      },
      {
        "id": 4,
        "text": "Increases intracellular adenosine levels"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Dipyridamole is a weak antiplatelet used in combination with aspirin for the prevention of stroke in patients with TIA.</p>\n<p>Side effects include gastrointestinal and vasodilatory complaints (headache, flushing, dizziness, hypotension).&nbsp;Due to it's vasodilatory effects, it is contraindicated in patients with symptomatic coronary artery disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/83f105195b784a118f2d762379820034x1280x1308.JPEG"
    ]
  },
  {
    "text": "A 62-year-old man diagnosed with myocardial infarction is planned for percutaneous intervention. He was diagnosed with diabetic nephropathy 2 months ago. The cardiologist decides to start him on aspirin and an additional antiplatelet drug. Which of the following can be used for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Abciximab only"
      },
      {
        "id": 2,
        "text": "Abciximab or eptifibatide"
      },
      {
        "id": 3,
        "text": "Tirofiban or eptifibatide"
      },
      {
        "id": 4,
        "text": "Tirofiban only"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Abciximab</strong> is <strong>safe</strong> in patients with <strong>renal impairment</strong>. It belongs to the&nbsp;group of&nbsp;<strong>GpIIb-IIIa</strong> receptor antagonists. These are&nbsp;parenteral drugs that are used in the management of patients with acute coronary syndrome.</p>\n<p>There are three important drugs in this group:</p>\n<table style=\"height: 149px;\" width=\"604\">\n<tbody>\n<tr style=\"height: 17px;\">\n<td style=\"width: 144px; height: 17px; text-align: center;\"><strong>Feature</strong></td>\n<td style=\"width: 144px; height: 17px; text-align: center;\"><strong>Abciximab</strong></td>\n<td style=\"width: 144px; height: 17px; text-align: center;\"><strong>Eptifibatide</strong></td>\n<td style=\"width: 144.667px; height: 17px; text-align: center;\"><strong>Tirofiban</strong></td>\n</tr>\n<tr style=\"height: 35px;\">\n<td style=\"width: 144px; height: 35px; text-align: center;\">Gp IIb/IIIa antagonist</td>\n<td style=\"width: 144px; height: 35px; text-align: center;\">&nbsp;Non-specific</td>\n<td style=\"width: 144px; height: 35px; text-align: center;\">Specific</td>\n<td style=\"width: 144.667px; height: 35px; text-align: center;\">Specific</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 144px; height: 17px; text-align: center;\">Plasma half-life</td>\n<td style=\"width: 144px; height: 17px; text-align: center;\">Short (min)</td>\n<td style=\"width: 144px; height: 17px; text-align: center;\">Long (2.5 h)</td>\n<td style=\"width: 144.667px; height: 17px; text-align: center;\">Long (2.0 h)</td>\n</tr>\n<tr style=\"height: 25.3333px;\">\n<td style=\"width: 144px; height: 25.3333px; text-align: center;\">Platelet-bound half-life</td>\n<td style=\"width: 144px; height: 25.3333px; text-align: center;\">Long (days)</td>\n<td style=\"width: 144px; height: 25.3333px; text-align: center;\">Short (s)</td>\n<td style=\"width: 144.667px; height: 25.3333px; text-align: center;\">Short (s)</td>\n</tr>\n<tr style=\"height: 17px;\">\n<td style=\"width: 144px; height: 17px; text-align: center;\">Renal clearance</td>\n<td style=\"width: 144px; height: 17px; text-align: center;\">No</td>\n<td style=\"width: 144px; height: 17px; text-align: center;\">Yes</td>\n<td style=\"width: 144.667px; height: 17px; text-align: center;\">Yes</td>\n</tr>\n</tbody>\n</table>\n<p>Immune-mediated <strong>thrombocytopenia</strong> and bleeding are the most common side effects. Thrombocytopenia can occur <strong>within 24 hours</strong> of initiation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Plasmapheresis is the mainstay of treatment in patients with which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Autoimmune hemolytic anemia"
      },
      {
        "id": 2,
        "text": "Disseminated intravascular coagulation"
      },
      {
        "id": 3,
        "text": "Thrombotic thrombocytopenic purpura"
      },
      {
        "id": 4,
        "text": "Hemolytic uremic syndrome"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Plasmapheresis</strong> is the mainstay of the treatment of patients with thrombotic thrombocytopenic purpura (<strong>TTP</strong>).</p>\n<p>The best response to this therapy is seen in patients with\u00a0<strong>ADAMTS13</strong> <strong>autoantibodies</strong>. Plasmapheresis is continued until the resolution of platelet count and signs of hemolysis for at least 2 days.</p>\n<p>Option A: The first line of treatment of autoimmune hemolytic anemia is glucocorticoids. The second line includes rituximab and splenectomy.</p>\n<p>Option B: Treatment of disseminated intravascular coagulation is primarily supportive with measures to treat the underlying cause.</p>\n<p>Option D: Treatment of HUS is primarily supportive<strong>.</strong> Dialysis is usually required. In some varients of HUS plasma infusion/exchange can be effective by replasing the complement-regulatory proteins.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not seen in patients with thrombotic thrombocytopenic purpura?",
    "choices": [
      {
        "id": 1,
        "text": "Hemolytic anemia"
      },
      {
        "id": 2,
        "text": "Focal neurological deficits"
      },
      {
        "id": 3,
        "text": "Venous thromboembolism"
      },
      {
        "id": 4,
        "text": "Elevated serum creatinine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Large vessel arterial or venous thromboemboli are not seen in&nbsp;thrombotic thrombocytopenic purpura (<strong>TTP</strong>). This condition is associated with&nbsp;<strong>microvascular</strong> thrombosis.</p>\n<p><strong>TTP</strong>&nbsp;occurs due to deficiency or autoantibodies against the metalloprotease <strong>ADAMTS13</strong>, which normally cleaves multimers of vWF. In this condition, the vWF molecules&nbsp;persist causing pathogenic platelet adhesion and aggregation. This causes&nbsp;localized<strong> platelet thrombi </strong>and<strong> fibrin deposits</strong>&nbsp;at various sites.</p>\n<p>It presents with the following pentad of clinical features:</p>\n<ol>\n<li>Microangiopathic <strong>hemolytic anemia</strong> -&nbsp;mechanical shearing of RBCs as they pass through platelet rich-microthrombi</li>\n<li>Thrombocytopenia -&nbsp;deposition of platelets in microthrombi</li>\n<li><strong>Renal failure</strong> -&nbsp;microthrombi in the renal vasculature</li>\n<li>Neurologic findings -&nbsp;headache, confusion, transient <strong>focal neurologic deficits</strong></li>\n<li>Fever</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrect regarding patients with thrombotic thrombocytopenic purpura?",
    "choices": [
      {
        "id": 1,
        "text": "Clinical features overlap with hemolytic uremic syndrome"
      },
      {
        "id": 2,
        "text": "PT and aPTT are prolonged"
      },
      {
        "id": 3,
        "text": "It is common in patients with HIV infection"
      },
      {
        "id": 4,
        "text": "It can be associated with use of quinine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In patients with thrombotic thrombocytopenic purpura (<strong>TTP</strong>), the <strong>PT</strong> and <strong>aPTT</strong> are <strong>normal</strong>, as consumptive coagulopathy is not seen.</p>\n<p>TTP and <strong>HUS</strong> are thrombotic microangiopathies with overlapping clinical features. TTP can be primary (ADAMTS13 deficiency) or secondary (associated with infections like <strong>HIV</strong> and drugs like <strong>quinine</strong>).</p>\n<p>Note: In disseminated intravascular coagulation (<strong>DIC</strong>),&nbsp;thrombocytopenia and microangiopathy are seen. It is associated with consumption of clotting factors and fibrinogen resulting in prolonged PT and aPTT.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common genetic abnormality seen in patients with recurrent history of venous thrombosis?",
    "choices": [
      {
        "id": 1,
        "text": "Factor V Leiden mutation"
      },
      {
        "id": 2,
        "text": "Prothrombin mutation"
      },
      {
        "id": 3,
        "text": "Protein C deficiency"
      },
      {
        "id": 4,
        "text": "Antithrombin III deficiency"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Factor V Leiden</strong> mutation is the most common <strong>inherited</strong> cause of venous thrombosis.&nbsp;Venous thrombosis typically manifests as deep vein thrombosis and pulmonary thromboembolism.&nbsp;</p>\n<p>Hypercoagulable states or thrombophilias can be inherited or acquired:</p>\n<ul>\n<li><strong>Inherited causes</strong>&nbsp;in decreasing order of prevalence are as follows:\n<ul>\n<li>Factor V Leiden mutation</li>\n<li>Prothrombin mutation</li>\n<li>Protein C deficiency</li>\n<li>Protein S deficiency</li>\n<li>Antithrombin III deficiency</li>\n</ul>\n</li>\n<li><strong>Acquired causes</strong>&nbsp;include:\n<ul>\n<li>Surgery</li>\n<li>Malignancy</li>\n<li>Antiphospholipid syndrome</li>\n<li>Trauma</li>\n<li>Pregnancy</li>\n<li>Long-haul travel</li>\n<li>Obesity</li>\n<li>Oral contraceptives/hormone replacement</li>\n<li>Myeloproliferative disorders</li>\n<li>Polycythemia vera</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following qualitative platelet disorders are inherited as autosomal dominant?",
    "choices": [
      {
        "id": 1,
        "text": "Glanzman thrombasthenia"
      },
      {
        "id": 2,
        "text": "Bernard Soulier syndrome"
      },
      {
        "id": 3,
        "text": "Chediak-Higashi syndrome"
      },
      {
        "id": 4,
        "text": "Platelet storage pool syndrome"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Bernard Soulier syndrome,&nbsp;Glanzman thrombasthenia, and&nbsp;Chediak-Higashi syndrome are inherited as<strong> autosomal recessive</strong> traits.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9d84bfdb468e467b9f06e8f391a6bf7ex1280x2203.JPEG"
    ]
  }
];
        let quizName = '091 Platelet Disorders';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>