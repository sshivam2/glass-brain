<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>061 Valvular Heart Diseases - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "What is the most common cause of valvular heart disease in developing countries?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatic fever"
      },
      {
        "id": 2,
        "text": "Infective endocarditis"
      },
      {
        "id": 3,
        "text": "Congenital"
      },
      {
        "id": 4,
        "text": "Idiopathic"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common cause of valvular heart disease in developing countries is <strong>rheumatic fever</strong>. This is mainly due to the repeated infections with rheumatogenic streptococci and inadequate coverage of antibiotics. It mainly affects&nbsp;the <strong>mitral valve</strong>.</p>\n<p>In developed countries, degenerative or inflammatory processes are the most common cause of valvular heart diseases.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the normal range for the mitral valve area in an adult?",
    "choices": [
      {
        "id": 1,
        "text": "4-6 sq mm"
      },
      {
        "id": 2,
        "text": "4-6 sq cm"
      },
      {
        "id": 3,
        "text": "6-8 sq mm"
      },
      {
        "id": 4,
        "text": "6-8 sq cm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The size of the mitral orifice in a normal adult is&nbsp;<strong>4-6 sq cm.&nbsp;</strong></p>\n<p>Depending on the area of <strong>mitral valve opening&nbsp;</strong>(MVA), mitral stenosis can be classified as:</p>\n<ul>\n<li>Progressive MS - MVA &gt; 1.5 sq cm</li>\n<li>Severe MS - MVA&nbsp;&le; 1.5 sq cm</li>\n<li>Very severe MS -&nbsp;&le; 1 sq cm</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old woman is diagnosed with mitral stenosis. Which of the following features is least likely to be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary artery hypertension"
      },
      {
        "id": 2,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 3,
        "text": "Right ventricular hypertrophy"
      },
      {
        "id": 4,
        "text": "Left ventricular hypertrophy"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Left ventricular hypertrophy is not seen in mitral stenosis. On the contrary, <strong>right ventricle hypertrophy&nbsp;</strong>is seen.</p>\n<p>Mechanism of mitral stenosis (MS):</p>\n<p>In a normal mitral valve, there is no obstruction to the flow of blood from the left atrium(LA) to the left ventricle. Therefore a small LA pressure is sufficient to empty the blood into the ventricle.</p>\n<p>When the MVA is &lt;~2 sq cm, blood flows from the left atrium to the left ventricle, propelled by a mildly elevated atrial pressure. Hence, patients are usually&nbsp;<strong>asymptomatic</strong> and may develop <strong>dyspnea</strong> only when the <strong>heart rate increases,</strong> as seen in exertion, excitement, fever, etc. All these conditions:</p>\n<ul>\n<li>&nbsp;<strong>Increase</strong> the rate of <strong>blood flow</strong> across the mitral orifice, resulting in further elevation of the LA pressure</li>\n<li>&nbsp;<strong>Decrease</strong> the <strong>diastolic</strong> filling time, resulting in a reduction in cardiac output</li>\n</ul>\n<p>The image below explains the mechanism of mitral stenosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/352c332d48124852aa00a568747835a7x1280x1782.JPEG"
    ]
  },
  {
    "text": "A 45-year-old male patient comes to the clinic with 3 months history of breathlessness. After Evaluation, the patient is diagnosed with mitral stenosis. Which of the following is least likely to be heard on auscultation?",
    "choices": [
      {
        "id": 1,
        "text": "Diastolic murmur"
      },
      {
        "id": 2,
        "text": "Mid systolic click"
      },
      {
        "id": 3,
        "text": "Opening snap"
      },
      {
        "id": 4,
        "text": "Pansystolic murmur"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Mid-systolic click</strong> is least likely to be heard in a patient with mitral stenosis. It is seen in a patient with <strong>mitral valve prolapse</strong>.</p>\n<table style=\"height: 283px; width: 385.034px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 165.034px; height: 18px; text-align: center;\" colspan=\"2\"><strong>Important clinical features of Mitral stenosis</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 80px; height: 18px; text-align: center;\">Findings</td>\n<td style=\"width: 85.0341px; height: 18px; text-align: center;\">Cause</td>\n</tr>\n<tr style=\"height: 33px;\">\n<td style=\"width: 165.034px; height: 33px; text-align: center;\" colspan=\"2\"><strong>Inspection</strong></td>\n</tr>\n<tr style=\"height: 38px;\">\n<td style=\"width: 80px; height: 38px;\">Malar flush, pinched and blue facies</td>\n<td style=\"width: 85.0341px; height: 38px;\">Decreased cardiac output and increased pulmonary artery hypertension leads to retention of CO<sub>2&nbsp;</sub>and vasodilation</td>\n</tr>\n<tr style=\"height: 38px;\">\n<td style=\"width: 80px; height: 38px;\">Precordial bulge</td>\n<td style=\"width: 85.0341px; height: 38px;\">&nbsp;</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 165.034px; height: 34px; text-align: center;\" colspan=\"2\"><strong>Palpation</strong></td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 80px; height: 18px;\">Parasternal lift</td>\n<td style=\"width: 85.0341px; height: 18px;\">Enlarged right ventricle</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 80px; height: 18px;\">Palpable P2</td>\n<td style=\"width: 85.0341px; height: 18px;\">Pulmonary hypertension</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 80px; height: 18px;\">Diastolic thrill</td>\n<td style=\"width: 85.0341px; height: 18px;\">Increased intensity of diastolic murmur</td>\n</tr>\n<tr style=\"height: 34px;\">\n<td style=\"width: 165.034px; height: 34px; text-align: center;\" colspan=\"2\"><strong>Auscultation</strong></td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 80px; height: 36px;\">Loud S1</td>\n<td style=\"width: 85.0341px; height: 36px;\">It is seen in <strong>initial stages</strong> when the mitral valve is flexible.</td>\n</tr>\n<tr style=\"height: 183px;\">\n<td style=\"width: 80px; height: 183px;\">Opening snap (OS)</td>\n<td style=\"width: 85.0341px; height: 183px;\">\n<p>It is caused due to the sudden opening of thickened leaflets.</p>\n<p>It follows A2. As the disease progresses, the <strong>duration</strong> between A2 and OS <strong>decreases</strong>.</p>\n<p>It is best audible at the apex and with the diaphragm of the stethoscope</p>\n</td>\n</tr>\n<tr style=\"height: 233px;\">\n<td style=\"width: 80px; height: 233px;\">Diastolic murmur</td>\n<td style=\"width: 85.0341px; height: 233px;\">\n<p><strong>Low</strong> pitched rumbling murmur heard with the <strong>bell</strong> of the stethoscope.</p>\n<p>It follows OS and best heard at <strong>apex</strong> with left lateral recumbent position. When it is loud, may radiate to left axilla.&nbsp;</p>\n<p>The duration of murmur correlates with the severity of stenosis</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 80px; height: 18px;\">Loud P2</td>\n<td style=\"width: 85.0341px; height: 18px;\">Pulmonary artery hypertension</td>\n</tr>\n<tr style=\"height: 29.3507px;\">\n<td style=\"width: 165.034px; height: 29.3507px; text-align: center;\" colspan=\"2\">Other Auscultatory Findings</td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 80px; height: 19px;\">Pansystolic murmur</td>\n<td style=\"width: 85.0341px; height: 19px;\">Due to functional tricuspid regurgitation in severe pulmonary hypertension</td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 80px; height: 19px;\">Graham Steell murmur</td>\n<td style=\"width: 85.0341px; height: 19px;\">\n<p>It is a <strong>diastolic</strong> murmur due to pulmonary regurgitation</p>\n<p>Caused due to the dilation of the pulmonary valve ring in severe pulmonary hypertension</p>\n</td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 165.034px; height: 19px; text-align: center;\" colspan=\"2\"><strong>JVP</strong></td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 80px; height: 19px;\">Prominent a waves</td>\n<td style=\"width: 85.0341px; height: 19px;\">Atrial systole</td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 165.034px; height: 19px; text-align: center;\" colspan=\"2\"><strong>ECG</strong></td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 80px; height: 19px;\">Tall and peaked P waves</td>\n<td style=\"width: 85.0341px; height: 19px;\">Right atrial enlargement</td>\n</tr>\n<tr style=\"height: 19px;\">\n<td style=\"width: 80px; height: 19px;\">Right axis deviation</td>\n<td style=\"width: 85.0341px; height: 19px;\">Right ventricular hypertrophy</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old female patient was admitted to the hospital in view of severe dyspnea. History revealed that the dyspnea was exertional initially and later worsened to breathlessness during normal daily activities. She died on the 3rd day following admission. The image of the autopsy of the heart is shown below. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Mitral stenosis"
      },
      {
        "id": 2,
        "text": "Mitral regurgitation"
      },
      {
        "id": 3,
        "text": "Tricuspid stenosis"
      },
      {
        "id": 4,
        "text": "Tricuspid regurgitation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image is of <strong>mitral stenosis</strong> showing <strong>fish mouth</strong> or <strong>buttonhole</strong> appearance.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/605ccf70079548dc8de82f986d56f830.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 62-year-old woman presents with breathlessness for 5 months. She is unable to carry out her daily activities and has difficulty sleeping. On examination, she has a parasternal heave. On auscultation, opening snap (OS) is heard followed by a low pitched rumbling diastolic murmur. Which of the following findings is suggestive of increased severity of the given condition?",
    "choices": [
      {
        "id": 1,
        "text": "Loud S1"
      },
      {
        "id": 2,
        "text": "Soft P2"
      },
      {
        "id": 3,
        "text": "Decreased A2-OS interval"
      },
      {
        "id": 4,
        "text": "Increased A2-OS interval"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of <strong>mitral stenosis</strong>. The more severe the thickening, the earlier the opening snap occurs in diastole. Hence, the&nbsp;<strong>decreased interval</strong> between <strong>A2</strong> and opening snap <strong>(OS)</strong> indicates <strong>increased</strong> <strong>severity</strong> of the stenosis.</p>\n<p>The auscultatory findings which are suggestive of increased severity of murmur are:</p>\n<ul>\n<li>Decreased interval between A2 and OS</li>\n<li>Increased duration of the diastolic murmur</li>\n</ul>\n<p>Loud S1 is seen in the initial stages of MS when the mitral leaflets are flexible. When there is further thickening and calcification of the leaflets, they become immobile, and the amplitude of S1 decreases.</p>\n<p>Increased severity of the stenosis increases the left atrial pressure. This increase in left atrial pressure can increase pulmonary artery pressure which leads to loud P2 on auscultation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following cardiac chambers is enlarged in mitral stenosis on chest X-ray initially?",
    "choices": [
      {
        "id": 1,
        "text": "Left atrium"
      },
      {
        "id": 2,
        "text": "Right atrium"
      },
      {
        "id": 3,
        "text": "Left ventricle"
      },
      {
        "id": 4,
        "text": "Right ventricle"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Left atrium</strong> (LA) is the <strong>first cardiac chamber</strong> to get enlarged in mitral stenosis (MS). It is due to the pressure overload of LA. It can be appreciated on the lateral and left anterior oblique views.</p>\n<p>Other radiographic changes seen in MS are <strong>straightening of the upper left border</strong> of the cardiac silhouette, posterior displacement of the esophagus by an enlarged LA, and <strong>Kerley B lines</strong> due to distention of interlobular septae and lymphatics with edema.</p>\n<p><strong>Severe MS</strong> causing <strong>pulmonary hypertension</strong> leads to enlargement of the pulmonary artery, <strong>right ventricle</strong>, and <strong>right atrium</strong>. <strong>Left ventricle&nbsp;</strong>remains <strong>unaffected</strong> in isolated MS.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with mitral stenosis presented with worsening dyspnea and fatigue which are now present at rest. He also complained of a feeling of heavy pounding in the chest with recurrent chest pain. You decided to evaluate the patient using echocardiography. When would you advise the patient to undergo a valvotomy?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral orifice is  < 0.8 sq cm"
      },
      {
        "id": 2,
        "text": "Mitral orifice is  < 1 sq cm"
      },
      {
        "id": 3,
        "text": "Mitral orifice is  < 1.5 sq cm"
      },
      {
        "id": 4,
        "text": "In all patients who are symptomatic"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Mitral valvotomy</strong> is indicated in symptomatic (NYHA Functional Class II-IV)&nbsp;patients with mitral stenosis (MS) with orifice <strong>&lt; 1.5 cm<sup>2</sup> </strong>in normal-sized adults or &lt;1 cm<sup>2</sup>/m<sup>2 </sup>body surface area.</p>\n<p>Treatment of mitral stenosis:</p>\n<ul>\n<li>Administration of <strong>warfarin</strong> in patients with MS who develop <strong>atrial fibrillation.</strong></li>\n<li>Surgical treatment includes:\n<ul>\n<li><strong>Mitral valvotomy:</strong> It is done in symptomatic patients whose mitral orifice is less than&nbsp;<strong>1.5 cm<sup>2</sup>.&nbsp;</strong>This can be either percutaneous mitral valvotomy or open surgical valvotomy.</li>\n<li><strong>Mitral valve replacement:</strong> This is done in patients whose mitral valve is severely distorted.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old woman undergoing evaluation for panic disorder was referred to the physician for complaints of palpitations and breathlessness. Detailed history revealed the presence of chest pain, which was substernal and not related to exercise. On auscultation, mid-systolic clicks were audible. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Unstable angina"
      },
      {
        "id": 2,
        "text": "Aortic stenosis"
      },
      {
        "id": 3,
        "text": "Mitral valve prolapse"
      },
      {
        "id": 4,
        "text": "Mitral regurgitation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario is suggestive of <strong>mitral valve prolapse</strong>.</p>\n<p>It is caused due to the <strong>myxomatous degeneration</strong> of the mitral valve. It may be associated with Marfan's syndrome, osteogenesis imperfecta, and Ehlers-Danlos syndrome. It is more common in <strong>females</strong> of the age group of&nbsp;<strong>15- 30 years.</strong></p>\n<p>Most patients are usually <strong>asymptomatic</strong>. However, some patients may present with symptoms such as&nbsp;<strong>palpitations,</strong>&nbsp;syncope due to arrhythmias (premature ventricular contractions, ventricular tachycardia, and atrial fibrillation), non-specific chest pain, and dyspnea</p>\n<p>Auscultation reveals&nbsp;<strong>mid-systolic clicks. </strong>If there is associated mitral regurgitation, a systolic murmur might also be heard. The duration of the murmur of MVP&nbsp;decreases&nbsp;on squatting and increases on standing. Whereas the duration of the murmur of MR increases on squatting and decreases on standing.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Carvallo\u2019s sign is associated with the murmur of which valvulopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral stenosis"
      },
      {
        "id": 2,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 3,
        "text": "Pulmonary regurgitation"
      },
      {
        "id": 4,
        "text": "Aortic stenosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Carvallo&rsquo;s sign</strong> refers to the <strong>increase </strong>in the<strong> intensity</strong> of systolic <strong>murmur</strong> of <strong>tricuspid regurgitation </strong>with<strong> inspiration.</strong></p>\n<p>During inspiration, the venous return to the heart increases due to the negative intrathoracic pressure. This increases the leak from the right ventricle to the right atrium making the murmur louder.</p>\n<p>In general, the <strong>right-sided</strong> heart murmurs <strong>increase</strong> in intensity with <strong>inspiration</strong> and <strong>decrease</strong> in intensity with <strong>expiration,</strong>&nbsp;while the opposite is true for left-sided heart murmurs. Pulmonic ejection sound is the only right-sided acoustic event that decreases in intensity with inspiration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The severity of mitral regurgitation can be assessed by:",
    "choices": [
      {
        "id": 1,
        "text": "Intensity of murmur"
      },
      {
        "id": 2,
        "text": "Ejection click"
      },
      {
        "id": 3,
        "text": "Wide split of S2"
      },
      {
        "id": 4,
        "text": "Loud S1"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Note: The intensity of murmur does not always correlate with the severity of the murmur. Intensity may be diminished in severe MR caused by LV dysfunction, acute MI and periprosthetic valve regugitation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old male patient presented with chest pain, exertional dyspnea and syncope. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 2,
        "text": "Aortic regurgitation"
      },
      {
        "id": 3,
        "text": "Mitral stenosis"
      },
      {
        "id": 4,
        "text": "Aortic stenosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most likely diagnosis is <strong>aortic stenosis.</strong></p>\n<p>Aortic stenosis is the narrowing of the aortic valve. It may be caused due to the <strong>calcification</strong> of the normal aortic valve, calcification of congenital bicuspid valve, and rheumatic heart disease.</p>\n<p>Three <strong>cardinal</strong> clinical <strong>features</strong> of aortic stenosis are:</p>\n<ol>\n<li><strong>Exertional dyspnea -</strong>&nbsp;this occurs due to the left ventricular (LV) diastolic dysfunction. Raised end-diastolic LV volume and reduced LV compliance lead to increased LV pressure, leading to elevation of pulmonary capillary wedge pressure.</li>\n<li><strong>Angina pectoris -</strong>&nbsp;it occurs due to the&nbsp;combination of the increased O<sub><span class=\"s1\">2 </span></sub>needs of hypertrophied myocardium and reduction of O<sub><span class=\"s1\">2 </span></sub>delivery.</li>\n<li><strong>Syncope -</strong>&nbsp;it occurs due to the combination of decreased cardiac output and systemic arterial dilation which lead to a reduction of cerebral perfusion.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On auscultation of a patient, a murmur was heard which is depicted by the following phonocardiogram. Which of the given conditions is most likely to produce this murmur?",
    "choices": [
      {
        "id": 1,
        "text": "Mitral stenosis"
      },
      {
        "id": 2,
        "text": "Mitral regurgitation"
      },
      {
        "id": 3,
        "text": "Aortic stenosis"
      },
      {
        "id": 4,
        "text": "Aortic regurgitation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The phonocardiogram given above is of an <strong>ejection systolic murmur,</strong> which is seen in <strong>aortic stenosis</strong>. It is also heard in pulmonary stenosis. They are differentiated based on the difference in symptoms, site of murmur, etc.</p>\n<p>\u00a0<strong>Clinical findings</strong> in aortic stenosis:</p>\n<ul>\n<li>Pulse - slow rising and late peaking pulse which is known as <strong>pulsus parvus et tardus</strong>. A carotid thrill may also be palpated over these arteries.</li>\n<li>Apical impulse - A double apical impulse may be recognized, and in the later stages, it may be displaced laterally.</li>\n</ul>\n<p><strong>Auscultation\u00a0</strong>findings in aortic stenosis:</p>\n<ul>\n<li><strong>Early systolic ejection sound -\u00a0</strong>heard in early stages,\u00a0disappears when the valve becomes calcified and rigid</li>\n<li><strong>Paradoxical splitting of S2 -\u00a0</strong>With worsening of stenosis, delayed closure of the aortic valve occurs. This leads to <strong>narrowing of S2</strong> sound, and in severe cases, leads to paradoxical splitting of S2.</li>\n<li><strong>S4 and S3</strong> - heard in severe cases</li>\n<li><strong>Ejection systolic murmur</strong> - starts after S1, increases in intensity to reach the peak, and ends before A2. It radiates to the neck and base of the heart. It is augmented by squatting and reduced by the strain of the Valsalva maneuver.</li>\n</ul>\n<p>The image below shows phonocardiograms of normal and abnormal heart sounds.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ee74341748944fe399a382cef7e13e93.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cf3af64542444f4b88acecf816f28bc3x1280x2348.JPEG"
    ]
  },
  {
    "text": "A patient presented with breathlessness on exertion and chest pain. Auscultation revealed an ejection systolic murmur heard best at the base of the heart. Echocardiography showed reduced left ventricular ejection fraction and left ventricular hypertrophy. Which of the following features does not signify a severe form of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Pulsus parvus et tardus"
      },
      {
        "id": 2,
        "text": "Single S2"
      },
      {
        "id": 3,
        "text": "Late peaking of murmur"
      },
      {
        "id": 4,
        "text": "Wide splitting of S2"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above features point to a diagnosis of <strong>aortic stenosis</strong>. Wide splitting of S2 is not a feature of severe aortic stenosis. On the contrary, there might be single S2 or paradoxical splitting of S2.</p>\n<p><strong>Features</strong> of <strong>severe</strong> aortic stenosis are:</p>\n<ul>\n<li>Pulsus parvus et tardus</li>\n<li>Palpable carotid thrill</li>\n<li>Louder and <strong>late peaking</strong> of systolic murmur</li>\n<li>Single S2 or <strong>paradoxical splitting of S2</strong></li>\n<li>Presence of S3 and S4 heart sounds</li>\n<li>Signs of right and left ventricular failure</li>\n<li>Left ventricular hypertrophy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is not associated with aortic regurgitation?",
    "choices": [
      {
        "id": 1,
        "text": "Ankylosing spondylitis"
      },
      {
        "id": 2,
        "text": "Marfan syndrome"
      },
      {
        "id": 3,
        "text": "Acute myocardial infarction"
      },
      {
        "id": 4,
        "text": "Bicuspid aortic valve"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Acute myocardial infarction is not associated with aortic regurgitation.</p>\n<p><strong>Aortic regurgitation</strong> is the backflow of the blood from the aorta to the left ventricle.</p>\n<p>It may be caused either due to the <strong>defect</strong> in the <strong>valve</strong> or defect in the<strong> aortic root</strong> (dilation of the aortic annulus).</p>\n<p>Conditions that affect valves are:</p>\n<ul>\n<li>Congenital</li>\n<li>Endocarditis</li>\n<li>Rheumatic fever</li>\n<li>Myxomatous (prolapse)</li>\n<li>Traumatic</li>\n<li>Syphilis</li>\n<li><strong>Ankylosing spondylitis</strong></li>\n</ul>\n<p>Conditions that affect aortic root&nbsp;are:</p>\n<ul>\n<li>Aortic dissection</li>\n<li>Cystic medial degeneration</li>\n<li><strong>Marfan&nbsp;syndrome</strong></li>\n<li><strong>Bicuspid aortic valve</strong></li>\n<li>Hypertension</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old male patient presents to the hospital with palpitations. On examination, a diastolic murmur is heard in the left third intercostal space and pistol shot sound is heard over the femoral arteries. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Aortic regurgitation"
      },
      {
        "id": 2,
        "text": "Aortic stenosis"
      },
      {
        "id": 3,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 4,
        "text": "Mitral regurgitation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The presence of a <strong>diastolic</strong> <strong>murmur</strong> along with the <strong>pistol</strong> <strong>shot</strong> sound over the <strong>femoral</strong> is most likely to be due to&nbsp;<strong>aortic regurgitation.</strong></p>\n<p>The image below explains the mechanism of aortic regurgitation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2963fd3672f3474aa841f68362712e0ax1280x1895.JPEG"
    ]
  },
  {
    "text": "A 58-year-old man presented with exertional dyspnea and angina. On examination, the pulse was characterized by abrupt distention and quick collapse. Auscultation revealed an early diastolic murmur. Which of the following is a feature of this murmur with respect to the likely diagnosis in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Crescendo-decrescendo murmur"
      },
      {
        "id": 2,
        "text": "Best heard in inspiration"
      },
      {
        "id": 3,
        "text": "High pitched murmur"
      },
      {
        "id": 4,
        "text": "Severity correlates with intensity of murmur"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical features are suggestive of <strong>aortic regurgitation</strong>. An early diastolic murmur is a <strong>high-pitched</strong>&nbsp;<strong>decrescendo</strong> diastolic murmur.</p>\n<p>Auscultatory findings in AR are:</p>\n<ul>\n<li>Soft S1 - due to the early closure of the mitral valve</li>\n<li><strong>Diminished or absent A2</strong></li>\n<li>S3 - due to increased left ventricular (LV) end-diastolic volume. The presence of S3 may be a sign of impaired LV function.</li>\n<li><strong>Early diastolic murmur -</strong>\n<ul>\n<li><strong>High-pitched</strong>, blowing, decrescendo, <strong>early diastolic murmur</strong></li>\n<li>Best heard in the left third intercostal space</li>\n<li>Heard with the patient sitting up and leaning forward, with breath held in forced expiration</li>\n<li><strong>Duration</strong> of the murmur best correlates with the severity</li>\n</ul>\n</li>\n<li>Systolic ejection murmur - It is heard due to increased LV stroke volume and ejection rate.</li>\n<li><strong>Austin Flint murmur&nbsp;</strong>- a <strong>low-pitched</strong>, mid to late diastolic murmur. It is caused due to the large volume of regurgitant blood, hitting the anterior leaflet of the mitral valve or LV wall.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the criteria for severe aortic regurgitation, in transthoracic doppler echocardiography?",
    "choices": [
      {
        "id": 1,
        "text": "Effective regurgitant orifice <0.3 sq. cm"
      },
      {
        "id": 2,
        "text": "Regurgitant volume >60mL/ beat"
      },
      {
        "id": 3,
        "text": "Regurgitant fraction more than 60%"
      },
      {
        "id": 4,
        "text": "Vena contracta <0.6 cm"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Regurgitant volume &gt;60mL/ beat</strong>&nbsp;is the criteria for <strong>severe</strong> <strong>aortic regurgitation,</strong> in transthoracic doppler echocardiography <strong>(TTE).</strong></p>\n<p>Doppler echocardiography can be used to assess the severity of aortic regurgitation. According to this, AR is considered to be severe when:</p>\n<ul>\n<li>Central jet width is more than 65% of left ventricular outflow tract</li>\n<li>Vena contracta width &gt;6mm</li>\n<li>Regurgitant fraction &gt;50%</li>\n<li>Regurgitant volume &gt;60mL/beat</li>\n<li>Effective regurgitant orifice &gt;0.3cm<sup>2</sup></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the treatment of choice in symptomatic acute severe aortic regurgitation?",
    "choices": [
      {
        "id": 1,
        "text": "Beta blockers"
      },
      {
        "id": 2,
        "text": "Aortic valve replacement"
      },
      {
        "id": 3,
        "text": "Periodic monitoring"
      },
      {
        "id": 4,
        "text": "Diuretics"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The treatment of choice in symptomatic acute severe AR is <strong>aortic valve replacement</strong>&nbsp;(AVR).</p>\n<p>Treatment of aortic regurgitation:</p>\n<ul>\n<li>In <strong>non-severe</strong>&nbsp;AR, periodic monitoring can be done. The symptoms of dyspnea and decreased cardiac output can be managed by <strong>diuretics</strong> and <strong>vasodilators</strong>.</li>\n<li>In <strong>severe</strong> AR, <strong>surgery&nbsp;</strong>(AVR) is indicated in the following conditions:\n<ul>\n<li>The patient is symptomatic.</li>\n<li>The patient is asymptomatic, but the LV ejection fraction is less than 50% or LV end-diastolic diameter is more than 65mm.</li>\n<li>The patient is asymptomatic and undergoing other cardiac surgeries.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient has enlarged neck veins, hepatomegaly and a holosystolic murmur along the lower left sternal margin. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Tricuspid regurgitation"
      },
      {
        "id": 2,
        "text": "Mitral regurgitation"
      },
      {
        "id": 3,
        "text": "Left heart failure"
      },
      {
        "id": 4,
        "text": "Right heart failure"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most likely diagnosis in the above clinical scenario is <strong>tricuspid regurgitation</strong>.</p>\n<p><strong>Clinical features</strong> of tricuspid regurgitation are:</p>\n<ul>\n<li><strong>Distended neck veins</strong> with <strong>prominent c-v waves</strong></li>\n<li>Hepatomegaly with systolic pulsations</li>\n<li><strong>Positive hepatojugular reflex</strong> - the distension of the jugular vein when firm pressure is applied over the liver</li>\n<li>Blowing <strong>holosystolic murmur</strong> along the lower left sternal margin</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "On auscultation of a patient, a murmur was heard which is depicted by the following phonocardiogram. Which of the given conditions is most likely to produce this murmur?",
    "choices": [
      {
        "id": 1,
        "text": "2,5"
      },
      {
        "id": 2,
        "text": "2,3"
      },
      {
        "id": 3,
        "text": "1,4"
      },
      {
        "id": 4,
        "text": "3,5"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given phonocardiogram is of a <strong>pansystolic</strong>/holosystolic <strong>murmur</strong>. It is heard in mitral regurgitation <strong>(MR)</strong>, tricuspid regurgitation <strong>(TR),</strong> and ventricular septal defect <strong>(VSD)</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2d8973c45052468498058ef4ae75c611.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c7adc6b1a1644a59d50083ff2d2fec4x1280x2348.JPEG"
    ]
  },
  {
    "text": "A patient has a right upper limb BP of 180/95 mm Hg and a left upper limb BP of 130/90 mm Hg. He also has an early diastolic murmur in right 2nd intercostal space. Which of the following is least likely to be associated with these findings?",
    "choices": [
      {
        "id": 1,
        "text": "Supravalvular aortic stenosis"
      },
      {
        "id": 2,
        "text": "Coarctation of aorta"
      },
      {
        "id": 3,
        "text": "Takayasu arteritis"
      },
      {
        "id": 4,
        "text": "Aortic dissection"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>So the single best answer would be <strong>Supravalvular AS &gt; Coarctation of the aorta.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Barlow\u2019s syndrome refers to which of the following?",
    "choices": [
      {
        "id": 1,
        "text": "Carcinoid of heart"
      },
      {
        "id": 2,
        "text": "Mitral valve prolapse"
      },
      {
        "id": 3,
        "text": "Aortic regurgitation"
      },
      {
        "id": 4,
        "text": "Hypertrophic cardiomyopathy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Barlow&rsquo;s syndrome refers to <strong>mitral valve prolapse</strong>.</p>\n<p>Mitral valve prolapse syndrome is also called as systolic click-murmur syndrome, Barlow&rsquo;s syndrome or floppy valve syndrome. It is the most common abnormality leading to primary mitral regurgitation.</p>\n<p>Note: Infantile scurvy is referred to as Barlow's disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '061 Valvular Heart Diseases';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>