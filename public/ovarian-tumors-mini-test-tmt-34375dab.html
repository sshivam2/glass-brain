<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ovarian Tumors Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 55-year-old postmenopausal woman came with complaints of irregular postmenopausal bleeding, breast tenderness, and abdominal pain. Abdominopelvic ultrasound revealed an adnexal mass. A biopsy from the mass revealed the following picture. Which of the following statement is false regarding the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Activating mutation in KIT-gene"
      },
      {
        "id": 2,
        "text": "Usually unilateral"
      },
      {
        "id": 3,
        "text": "Inhibin B is used as its tumor marker"
      },
      {
        "id": 4,
        "text": "Coffee bean nuclei are seen on microscopy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario along with the biopsy findings is suggestive of the diagnosis as <strong>g</strong><strong>ranulosa cell tumor</strong>.\u00a0Activating mutations of the KIT gene\u00a0are seen in patients with <strong>dysgerminoma </strong>and\u00a0not seen in granulosa cell tumors.</p>\n<p>The biopsy image given shows <strong>small, distinctive, glandlike structures filled with an acidophilic material</strong>\u00a0similar to immature follicles known as <strong>Call-Exner bodies.</strong> The presence of such findings is <strong>diagnostic</strong> of granulosa cell tumors.</p>\n<p><strong>Granulosa cell tumors</strong> are ovarian <strong>sex-cord stromal tumors</strong> made up of cells that resemble the <strong>granulosa cells</strong> of the ovarian follicle.\u00a0The most <strong>common driver mutations</strong> found are in the <strong>FOXL2 gene</strong>, which encodes a transcription factor important for granulosa cell development.</p>\n<p>It <strong>most commonly</strong> presents in <strong>adult women aged over 55years</strong> (postmenopausal women) and occurs less commonly in pre-pubertal girls. The clinical presentation varies as follows:</p>\n<ul>\n<li class=\"p1\">In <strong>prepubertal girls</strong> estrogen secreted from the granulosa cell tumor results in <strong>pseudo-precocious puberty</strong>. There is hypertrophy of the breasts and myohyperplasia of the uterus.</li>\n<li>In\u00a0<strong>adult women</strong>, they may be associated with proliferative breast disease, postmenopausal irregular bleeding, breast tenderness, endometrial hyperplasia, and endometrial carcinoma. Abdominal pain and distension can occur due to enlarging tumor.</li>\n<li>Occasionally, granulosa cell tumors produce androgens, masculinizing the patient</li>\n</ul>\n<p class=\"p1\">Gross examination: These are usually <strong>unilateral</strong> tumors. The cut section is soft and has a yellowish appearance due to intracellular lipids.</p>\n<p class=\"p1\">Microscopic examination:\u00a0<strong>Call- Exner bodies</strong>\u00a0which are small, distinctive, glandlike structures filled with an acidophilic material similar to immature follicles are diagnostic. Granulosa cells with pale, grooved, <strong>\u201ccoffee bean\u201d nuclei</strong> are seen. These\u00a0are small, cuboidal to polygonal cells that grow in anastomosing cords, sheets, or strands. Occasionally a thecoma component may be present as\u00a0clusters or sheets of cuboidal to polygonal cells.</p>\n<p class=\"p1\">Detection and measurement of <strong>inhibin B</strong> are useful in diagnosing granulosa cell tumors and behave as a <strong>tumor marker</strong>. Measurement of <strong>inhibin B</strong> is <strong>more accurate</strong> than <strong>inhibin A.</strong></p>\n<p class=\"p1\">Given below is a histopathological image depicting the Call-Exner bodies:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/32822caa61934932ada289370e0b3206.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/81b74e0011164f88890495944947e6c7x852x450.PNG"
    ]
  },
  {
    "text": "A 10-year-old girl presents with an ovarian mass. Her serum biomarkers are normal except for elevated AFP. Identify the most likely diagnosis.",
    "choices": [
      {
        "id": 1,
        "text": "Dysgerminoma"
      },
      {
        "id": 2,
        "text": "Endodermal sinus tumour"
      },
      {
        "id": 3,
        "text": "Mucinous cystadenocarcinoma"
      },
      {
        "id": 4,
        "text": "Granulosa cell tumour"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above given findings are suggestive of <strong>endodermal sinus tumor.</strong> <strong>Alpha- fetoprotein</strong> is commonly produced by these tumors. It is also called yolk sac tumour.\u00a0</p>\n<p>It is an <strong>aggressive</strong> malignant germ cell tumor of ovaries. It occurs in ovaries or testes and sacrococcygeal area in <strong>young children</strong>. \u00a0</p>\n<p>On appearance these tumors are yellow, friable (hemorrhagic), solid mass. \u00a0</p>\n<p>50% of the tumors have <strong>Schiller-Duval bodies.</strong> This structure consists of a central capillary surrounded by tumor cells, present within a cystic space that may be lined by flat to cuboidal tumor cells. They are <strong>pathognomonic</strong> when present. <strong>\u00a0</strong></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/01149796575b4d17b61267667cd28089x572x424.PNG"
    ]
  },
  {
    "text": "A 20-year-old nulligravida presented with right flank pain. MRI evaluation revealed a solid, enhancing  5\u00d713\u00d77 cm right ovarian mass. Salpingo-oophorectomy was successfully done and microscopic examination of the tumor cells showed a close resemblance to primordial germ cells. It was also noticed that the tumor appeared histologically identical to a testicular seminoma. Which of the following is not secreted by this tumor?",
    "choices": [
      {
        "id": 1,
        "text": "Sex hormones"
      },
      {
        "id": 2,
        "text": "Lactate dehydrogenase"
      },
      {
        "id": 3,
        "text": "Placental alkaline phosphatase"
      },
      {
        "id": 4,
        "text": "Beta human chorionic gonadotropin"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>An ovarian tumor in a <strong>young woman</strong> which consists of primordial germ cells and is histologically similar to seminoma&nbsp;suggests a diagnosis of an <strong>ovarian</strong>&nbsp;<strong>dysgerminoma. </strong>It <strong>does not</strong> secrete <strong>sex hormones</strong>.</p>\n<p>Dysgerminoma usually arises in young women or in children, with an average incidence at the age of 20. It is the most common malignant germ cell tumour diagnosed during pregnancy.</p>\n<p>The tumor is neutral and does not secrete either male or female sex hormones. It <strong>secretes</strong> placental alkaline phosphatase (<strong>ALP</strong>), lactate dehydrogenase (<strong>LDH</strong>) and <strong>&beta;-hCG</strong>.&nbsp;Serum<strong> LDH</strong> and the isoenzymes LDH-1 and LDH-2 may be used in <strong>monitoring individuals or disease recurrence</strong>.</p>\n<p>Dysgerminomas are primitive neoplasms that do not have the potential for further differentiation. They are the only germ cell malignancy with a<strong> significant rate of bilateral ovarian involvement (15-20%).</strong></p>\n<p>Microscopically, there is a monotonous proliferation of large, rounded, polyhedral clear cells that are rich in cytoplasmic glycogen and contain uniform central nuclei with one or a few prominent nucleoli. The tumor cells are <strong>histologically identical</strong> to the <strong>seminoma</strong> of the testis. The counterpart of seminoma in females is dysgerminoma.&nbsp;</p>\n<p>Treatment involves <strong>fertility-sparing surgery</strong> with <strong>unilateral salpingo-oophorectomy</strong>. It is highly radiosensitive and has a good prognosis.</p>\n<p>The image below shows the histopathology of a dygerminoma, characterized by uniform cells resembling primordial germ cells separated by fibrous septa with lymphocytes.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0181b6c0f17c44279adc176ec6f8b13bx1280x853.JPEG"
    ]
  },
  {
    "text": "The most common ovarian tumor in women less than 20 years of age is _____.",
    "choices": [
      {
        "id": 1,
        "text": "Epithelial tumor"
      },
      {
        "id": 2,
        "text": "Germ cell tumor"
      },
      {
        "id": 3,
        "text": "Gonadoblastoma"
      },
      {
        "id": 4,
        "text": "Sex-cord stromal tumor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Germ cell tumors </strong>are the <strong>most common </strong>ovarian tumor in women aged<strong> less than 20 years</strong>.</p>\n<p>Epithelial tumours are the commonest tumours. It accounts for 80% of all ovarian malignant tumours.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A histopathological study of a patient with a suspected ovarian mass is given below. Based on the findings, identify the incorrect statement about this tumour and its management.",
    "choices": [
      {
        "id": 1,
        "text": "Alpha-fetoprotein is used for post-treatment surveillance"
      },
      {
        "id": 2,
        "text": "Common in the premenarchal age group"
      },
      {
        "id": 3,
        "text": "Only stage III and IV tumours require chemotherapy"
      },
      {
        "id": 4,
        "text": "This tumour is highly malignant"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Histopathological study shows the characteristic <strong>Schiller Duval body</strong> consistent with a diagnosis of <strong>yolk sac tumour </strong>(endodermal sinus tumour). Here, Option C is a false statement because all the patients having this tumour are treated with <strong>chemotherapy irrespective of stage</strong> as it is <strong>highly malignant.</strong></p>\n<p>Yolk sac tumours:</p>\n<ul>\n<li>Account for about 10 to 20 percent of all malignant ovarian germ cell tumours</li>\n<li><strong>A third</strong> of all patients are <strong>pre-pubertal</strong> at the time of diagnosis.\u00a0It is usually <strong>unilateral</strong> and highly malignant. (Option C)</li>\n<li>The most common presentation is abdominal pain. The pain may be severe and be misdiagnosed as appendicitis</li>\n<li>These tumors are usually associated with raised levels of AFP and alpha-1 antitrypsin</li>\n<li>Grossly, these tumours are yellow, friable, solid masses</li>\n<li>Histological features reveal cystic spaces lined by flattened epithelium. Vascular tufts are seen within the space - <strong>Schiller</strong> <strong>Duval</strong> <strong>body</strong>.</li>\n<li>All patients are treated with chemotherapy irrespective of stage because it is highly malignant (Option D)</li>\n<li><strong>Alpha-fetoprotein </strong>is commonly produced and it is used for <strong>post-treatment surveillance</strong>. (Option A)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/5efee211c6bf411faa49ffe122b61cf2.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "What is the most common mode of spread in ovarian malignancies?",
    "choices": [
      {
        "id": 1,
        "text": "Lymphatics"
      },
      {
        "id": 2,
        "text": "Hematogenous"
      },
      {
        "id": 3,
        "text": "Transcoelomic"
      },
      {
        "id": 4,
        "text": "Direct infiltration"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>transcoelomic route</strong> is the most common and the <strong>earliest mode</strong> of spread in ovarian malignancies.</p>\n<p>By this route, tumor cells spilled<strong>\u00a0</strong>into the peritoneal cavity follow the path of the peritoneal fluid during respiration and get deposited in areas such as the paracolic gutter, cul-de-sac (pouch of Douglas), hemidiaphragm, mesenteries of the intestine, and the liver capsule.</p>\n<p><strong>Lymphatics</strong> is the next common mode of spread, especially in the advanced stages of the disease. The common sites involved are the para-aortic and pelvic nodes.</p>\n<p><strong>Hematogenous</strong> spread is uncommon and can seed a nidus in the parenchyma of organs such as the lung and the liver. <strong>Right pleural effusion</strong> is a common finding. This mode of spread mostly occur in survivors of the malignancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young lady presents with lower abdominal pain, abdominal fullness, and bloating sensation. On examination,  a large mass is palpable in the lower abdomen. Ultrasound shows a unilocular ovarian cyst of 7 cm with a solid component and 2 papillary projections. Which of the following is true regarding the reporting of her ultrasound?",
    "choices": [
      {
        "id": 1,
        "text": "O-RAD 5"
      },
      {
        "id": 2,
        "text": "O-RAD 3"
      },
      {
        "id": 3,
        "text": "O-RAD 4"
      },
      {
        "id": 4,
        "text": "O-RAD 6"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario of an ovarian cyst with ultrasound showing 7 cm cyst with a solid component and 2 papillary projections can be classified as <strong>O-RAD 4</strong> according to the Ovarian-Adnexal Reporting and Data System (O-RADS).</p>\n<p>O-RAD score is used to standardize the description of ovarian and adnexal pathology and helps in having a uniform terminology for describing the imaging characteristics of ovarian masses. It is used as a risk stratification classification for follow-up and management in clinical settings and also to determine the malignancy risk.</p>\n<p><strong>Ovarian-Adnexal Reporting and Data System (O-RADS)</strong></p>\n<table style=\"border-collapse: collapse; width: 74.5009%; height: 316.578px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 25.3984px;\">\n<td style=\"width: 7.43902%; height: 25.3984px; text-align: center;\">SCORES</td>\n<td style=\"width: 24.1382%; height: 25.3984px; text-align: center;\">RISK CATEGORY</td>\n<td style=\"width: 68.3009%; height: 25.3984px; text-align: center;\">DESCRIPTION</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 7.43902%; height: 44.7969px; text-align: center;\">0</td>\n<td style=\"width: 24.1382%; height: 44.7969px;\">Incomplete evaluation</td>\n<td style=\"width: 68.3009%; height: 44.7969px;\">Lesion features relevant to risk stratification cannot be accurately characterized due to technical factors.</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 7.43902%; height: 22.3984px; text-align: center;\">1</td>\n<td style=\"width: 24.1382%; height: 22.3984px;\">Normal Ovary</td>\n<td style=\"width: 68.3009%; height: 22.3984px;\">Physiologic category: Size &lt;3 cms - Ovarian follicle, corpus luteum.</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 7.43902%; height: 44.7969px; text-align: center;\">2</td>\n<td style=\"width: 24.1382%; height: 44.7969px;\">Almost certainly benign (&lt;1% risk of malignancy)</td>\n<td style=\"width: 68.3009%; height: 44.7969px;\">Cysts <strong>&gt;3 cm</strong> and <strong>&lt;10 cm</strong> - Dermoid cyst, hemorrhagic cyst, endometrioma, etc.</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 7.43902%; height: 44.7969px; text-align: center;\">3</td>\n<td style=\"width: 24.1382%; height: 44.7969px;\">Low risk of malignancy (1% to &lt;10%)</td>\n<td style=\"width: 68.3009%; height: 44.7969px;\">\n<ul>\n<li>Unilocular cyst<strong>\u00a0&gt;10 cm</strong>.</li>\n<li>Multilocular cyst &lt;10 cm smooth inner wall with colour score 1-3</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 67.1953px;\">\n<td style=\"width: 7.43902%; height: 67.1953px; text-align: center;\">4\u00a0</td>\n<td style=\"width: 24.1382%; height: 67.1953px;\">Intermediate risk of malignancy (10% to &lt;50%)</td>\n<td style=\"width: 68.3009%; height: 67.1953px;\">\n<ul>\n<li>Unilocular cyst with <strong>solid components</strong>, and <strong>papillary projections</strong><strong>(1-3)</strong>.</li>\n<li>Multilocular cyst with solid component, any size, colour score 1-2</li>\n</ul>\n</td>\n</tr>\n<tr style=\"height: 67.1953px;\">\n<td style=\"width: 7.43902%; height: 67.1953px; text-align: center;\">5</td>\n<td style=\"width: 24.1382%; height: 67.1953px;\">High risk of malignancy (\u226550%)</td>\n<td style=\"width: 68.3009%; height: 67.1953px;\">\n<ul>\n<li>Unilocular cyst, \u22654 papillary projections</li>\n<li>Bi/multilocular cyst with a solid component, colour score 3 to 4</li>\n<li>Presence of ascites, peritoneal nodularity</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes with pain in her right lower quadrant for the last 2 weeks. On ultrasound, ovarian multiple thin echogenic bands are seen with no vascularity on doppler. Which of the following is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Serous cystadenocarcinoma"
      },
      {
        "id": 2,
        "text": "Mature teratoma"
      },
      {
        "id": 3,
        "text": "Yolk sac tumour"
      },
      {
        "id": 4,
        "text": "Granulosa cell tumour"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>An<strong> ovarian mass</strong> consisting of with USG findings of multiple <strong>thin echogenic bands</strong> with no <strong>vascularity</strong> on doppler is suggestive of a <strong>mature </strong><strong>teratoma</strong>.\u00a0</p>\n<p>The thin <strong>echogenic</strong> bands are seen due to the <strong>hair</strong> present in the <strong>teratoma</strong> while the lack of <strong>vascularity</strong> indicates a <strong>benign</strong> lesion. Other findings seen on USG include <strong>echogenic foci</strong> due to the <strong>sebaceous material</strong> and <strong>spotty calcifications</strong> due to <strong>teeth</strong> and <strong>bones.</strong>\u00a0</p>\n<p>Teratomas are <strong>germ cell tumors</strong>. They contain <strong>embryonic tissues</strong> leading to the differentiation of cells along these pathways.\u00a0<strong>Mature cystic teratoma</strong>,\u00a0also known as <strong>dermoid cysts</strong>\u00a0are <strong>unilocular</strong> in structure and have a <strong>smooth</strong> <strong>surface</strong>. They usually are lined by<strong> squamous epithelium</strong> with hair follicles leading to the formation of <strong>sebaceous material</strong> and <strong>hair</strong>. Other structures like<strong> teeth, bone,</strong> cartilage, thyroid tissue, and mucous membranes can also be found.\u00a0</p>\n<p>Patients may have symptoms because of the mass size of the teratoma. In other patients, ovarian teratomas can result in <strong>torsion</strong> of the <strong>ovary</strong>. Other rare complications include rupture of the cyst and spillage of contents into the abdominal cavity.\u00a0Treatment of mature teratomas involves <strong>excision</strong> in order to prevent complications. Otherwise, mature teratomas are generally innocent.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lady in her late 40s came to the hospital with chief complaints of discomfort in the pelvic area, abdominal bloating, and quickly feeling full when eating. She also had a history of weight loss,  changes in bowel habits such as constipation, and a frequent need to urinate. An abnormality associated with the BRCA gene is suspected. Identify the false statement about the BRCA genes related to the underlying condition.",
    "choices": [
      {
        "id": 1,
        "text": "BRCA 2 is more carcinogenic than BRCA 1"
      },
      {
        "id": 2,
        "text": "BRCA 2 gene is on chromosome 13q"
      },
      {
        "id": 3,
        "text": "BRCA 1 gene is on chromosome 17q"
      },
      {
        "id": 4,
        "text": "BRCA 1 is associated with hereditary breast ovarian cancer syndrome"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option A is a false statement because <strong>BRCA 1 </strong>is<strong> more carcinogenic</strong> than BRCA 2, not vice-versa.</p>\n<p>The underlying condition based on the given non-specific clinical features is <strong>ovarian carcinoma</strong> which is considerably more common and tends to develop at an earlier age in women with a germline BRCA1 pathogenic variant as compared to women with a germline BRCA2 pathogenic variant.\u00a0</p>\n<ul>\n<li>5\u201310% of malignant ovarian tumours are genetic.</li>\n<li>BRCA 1 gene is\u00a0on chromosome <strong>17q.</strong></li>\n<li>BRCA 2 gene is on chromosome <strong>13q</strong>.</li>\n<li>BRCA 1 is associated with <strong>hereditary breast ovarian cancer syndrome.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 49-year-old woman presented with dull pain over the right lower abdomen. CT scan revealed a multiloculated adnexal mass. Exploratory laparotomy showed the following mass, which on microscopy showed multiloculated cysts lined by a single layer of mucin-containing epithelium. CA-125 levels were not elevated. Which of the following is incorrect regarding the condition?",
    "choices": [
      {
        "id": 1,
        "text": "Can cause pseudomyxoma peritonei"
      },
      {
        "id": 2,
        "text": "Most common epithelial ovarian cancer"
      },
      {
        "id": 3,
        "text": "Majority are unilateral"
      },
      {
        "id": 4,
        "text": "They can undergo spontaneous rupture"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario, gross image, and microscopy findings are suggestive of\u00a0<strong>mucinous cystadenoma</strong>. <strong>Serous cystadenocarcinomas </strong>are the\u00a0<strong>most common epithelial</strong> <strong>ovarian cancer </strong>(option B is incorrect).\u00a0</p>\n<p><strong>Mucinous cystadenomas</strong> are mostly <strong>benign</strong>. They are usually present during the third to sixth decade of life and the majority of them are <strong>unilateral</strong>.</p>\n<p>They are usually<strong> multilocular</strong>, thick-walled, and have a smooth surface. Histology shows multiple cysts and glands liner by <strong>simple non-stratified</strong> <strong>mucinous epithelium</strong>. The epithelium may resemble gastric foveolar type or intestinal epithelium containing goblet cells.\u00a0</p>\n<p>Complications of mucinous cystadenoma of the ovary include torsion, <strong>spontaneous rupture</strong>,<strong>\u00a0pseudomyxoma peritonei</strong>, and secondary malignancies.\u00a0<strong>Secondary malignancy </strong>occurs in 5-10% of mucinous cystadenomas.\u00a0</p>\n<p>In<strong> pseudomyxoma peritonei</strong>, the peritoneal cavity is filled with coagulated mucinous martial adherent to the omentum and intestines. During laparotomy, the lesions resemble boiled sago pudding. It is frequently associated with<strong> mucinous cystadenoma </strong>of the ovary but are <strong>also seen</strong> with <strong>mucocele of the appendix</strong> and <strong>carcinoma of the large intestine</strong> in men.\u00a0</p>\n<p>Cystectomy is the adequate treatment for ovarian cystadenoma but recurrence may be seen in patients treated with cystectomy.</p>\n<p>Note- Serous cystadenocarcinomas account for 40-50% of malignant epithelial ovarian tumors.\u00a0Microscopically, tumor cells show severe nuclear atypia and anaplasia. Malignant ovarian tumors are associated with elevated CA-125 levels.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/7ff7bab38d9249258133ab6a25352249.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is incorrectly paired?",
    "choices": [
      {
        "id": 1,
        "text": "Brenner tumors - Sex cord stromal tumor"
      },
      {
        "id": 2,
        "text": "Immature teratoma - Germ cell tumor"
      },
      {
        "id": 3,
        "text": "Sertoli cell tumor - Sex cord stromal tumor"
      },
      {
        "id": 4,
        "text": "Non-gestational choriocarcinoma - Germ cell tumor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Brenner</strong> tumor/ <strong>transitional cell tumor</strong> is an <strong>epithelial</strong> tumor not a sex cord-stromal tumor</p>\n<p><strong>Brenner tumors</strong>\u00a0are uncommon tumors of the ovary. They are typically small to moderate-sized tumors and are mostly benign. However, rarely, if tumors are seen with\u00a0benign Brenner nests admixed with malignant tumor cells, they are known as malignant Brenner tumors. If it has\u00a0greater than 50% malignant transitional type epithelium, then it is known as transitional cell carcinomas of the ovary.</p>\n<p>Clinically, they may present with vague abdominopelvic pain in postmenopausal women and are mostly detected incidentally as in this patient. Histopathologically, they are characterized by\u00a0<strong>fibrous tissue</strong>\u00a0with interspersed\u00a0<strong>nests</strong>\u00a0of\u00a0<strong>transitional epithelium</strong>. These cells may have\u00a0<strong>nuclei</strong>\u00a0with a characteristic\u00a0<strong>longitudinal groove</strong>.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old female patient presented with mild pain in the lower abdomen. She has had 2 full-term normal deliveries earlier. Her last menstrual period was 3 weeks back. On pelvic examination, you find a palpable mass in the adnexa. On the USG pelvis, you find a 6 cm ovarian cyst, which is clear and unilocular. What should be your next best step?",
    "choices": [
      {
        "id": 1,
        "text": "Measure CA 125 levels"
      },
      {
        "id": 2,
        "text": "Follow-up for cyst after 2\u20133 months"
      },
      {
        "id": 3,
        "text": "Laparoscopy"
      },
      {
        "id": 4,
        "text": "CT pelvis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>clear ovarian cyst </strong>detected<strong>&nbsp;</strong>at&nbsp;3 weeks after the last menstrual period,<strong>&nbsp;</strong>with minimal symptoms and a size of <strong>6&nbsp;cm,</strong> in a woman of<strong> reproductive age group</strong> is most likely to be a&nbsp;<strong>functional ovarian cyst.&nbsp;</strong>The next best step in the management of this case is to observe&nbsp;and <strong>follow up for the cyst after 2&ndash;3 months.</strong></p>\n<div class=\"page\" title=\"Page 323\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Functional cysts may be follicular cysts, lutein cysts, multiple functional cysts, or corpus luteal cysts. The size of the cysts should be <strong>at least 3 cm</strong> but <strong>not more than 7 cm</strong>.</p>\n</div>\n</div>\n</div>\n<ul>\n<li>Follicular cysts: They can be single or multiple. They may vary in size but generally do not exceed 5.0 cm in diameter. They form as a result of the failure of absorption of the fluid in an incompletely developed follicle or anovulation. They are usually asymptomatic unless there is a hemorrhage in the cyst. Most follicular cysts disappear spontaneously within 4-8 weeks.</li>\n<li class=\"page\" title=\"Page 323\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>There are 2 types of Lutein cysts:</p>\n<ul>\n<li>Corpus luteum/ Granulosa lutein cysts: They are functional and non-neoplastic. Persistent corpus luteum cysts may cause local pain, tenderness, or delayed menstruation. These cysts are often palpable clinically.</li>\n<li>Theca lutein cysts: These cysts can sometimes enlarge to several centimeters in diameter. They are usually bilateral and filled with straw-colored fluid.</li>\n</ul>\n</div>\n</div>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5c4621a5c89b40359d9e4fe7e3efa57bx1280x1246.JPEG"
    ]
  },
  {
    "text": "Which of the following is a glomerulus-like structure composed of a central blood vessel enveloped by tumor cells within a space that is also lined by tumor cells?",
    "choices": [
      {
        "id": 1,
        "text": "Call-Exner body"
      },
      {
        "id": 2,
        "text": "Schiller-Duval body"
      },
      {
        "id": 3,
        "text": "Walthard cell rests"
      },
      {
        "id": 4,
        "text": "Hobnail cells"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The Schiller-Duval body is a\u00a0<strong>glomerulus-like structure</strong>\u00a0composed of a central blood vessel enveloped by tumor cells within a space that is also lined by tumor cells.</p>\n<p>The image below shows\u00a0<strong>Schiller-Duval body</strong>, which is<strong>\u00a0</strong>pathognomic of <strong>endodermal sinus tumor.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c8bd415747714a86be9568b6c2c0448ax969x994.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/331aab6949e3469da307e8da9fef0af1x852x450.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/737efa060bdf43af94c3ecb045e03700x800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8568a2bbb38749f3a95c3ef9a6730245x1024x683.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/860fef764b4c42d0a08b63d6dfb25452x800x450.JPEG"
    ]
  },
  {
    "text": "A 56-year-old patient presents with bleeding per vaginum. She has had intermittent spotting for the last 3 months. Menopause occurred 8 years ago.  Serum estradiol levels are elevated. Which of the following options can be likely etiologies of her symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Fibroma, Thecoma"
      },
      {
        "id": 2,
        "text": "Granulosa cell tumour, Thecoma"
      },
      {
        "id": 3,
        "text": "Granulosa cell tumour, Fibroma"
      },
      {
        "id": 4,
        "text": "Fibroma, Teratoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient is presenting with <strong>postmenopausal bleeding.</strong> The presence of an <strong>elevated estradiol</strong> level makes an <strong>ovarian malignancy</strong> likely.<strong> Ovarian thecoma </strong>and<strong> granulosa cell tumors </strong>are associated with increased estrogen production and are likely to cause this patient's symptoms.\u00a0</p>\n<p>Granulosa cell tumors are low-grade malignant tumors that have cells similar to the cells of the <strong>Graafian follicle</strong> and <strong>theca</strong> interna cells. <strong>Thecoma</strong> is a <strong>benign</strong> tumor of the theca cells. Both these cells produce <strong>estrogen</strong> due to them arising from cells that are responsible for <strong>estrogen production</strong> in the body. The estrogen causes <strong>unopposed growth</strong> of the <strong>endometrium</strong> and leads to <strong>breakthrough bleeding</strong> which can cause postmenopausal bleeding.\u00a0</p>\n<p><strong>Vaginal bleeding</strong> occurring <strong>after 6 months</strong>\u00a0of <strong>amenorrhoea</strong> in women of menopausal age group should be considered as <strong>postmenopausal bleeding</strong> and investigated.\u00a0This must be done irrespective of a previous diagnosis of menopause.</p>\n<p>All postmenopausal women with unexpected uterine bleeding should be evaluated for <strong>endometrial carcinoma</strong>. Even in those women who are perimenopausal, endometrial carcinoma must be suspected if they fall under the above-mentioned clinical category.</p>\n<p>An <strong>abdominal ultrasound</strong> should be done to evaluate for causes of <strong>post-menopausal</strong> bleeding.\u00a0</p>\n<p>Other Options:</p>\n<p><strong>Fibromas</strong> are usually <strong>non-functional</strong> and do not produce hormones</p>\n<p><strong>Teratomas</strong> contain all three types of cells of embryonic origin, and in some cases the differentiated thyroid tissue can be functional and produces thyroid hormone. This is known as <strong>struma ovarii.</strong> They do not produce estrogen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Histopathological examination of a specimen received after staging laparotomy for an ovarian mass revealed the following. Which of the following tumor is associated with this finding?",
    "choices": [
      {
        "id": 1,
        "text": "Dermoid tumor"
      },
      {
        "id": 2,
        "text": "Serous tumor"
      },
      {
        "id": 3,
        "text": "Mucinous tumor"
      },
      {
        "id": 4,
        "text": "Clear cell tumor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given histological finding denotes<strong> Psammoma bodies</strong> which are histopathological findings of ovarian papillary<strong> serous cystadenoma and cystadenocarcinoma</strong>.</p>\n<p>They are <strong>concentrically calcified basophilic structures</strong> seen in areas of cellular degeneration. Its presence per se does not denote malignancy.</p>\n<p>Psammoma bodies are commonly seen in certain tumors such as:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Papillary thyroid carcinoma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Papillary renal cell carcinoma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Ovarian tumors:</strong> Papillary serous cystadenoma and cystadenocarcinoma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Meningiomas, in the central nervous system</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Peritoneal and Pleural Mesothelioma</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Prolactinoma of the pituitary</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Lung Adenocarcinoma</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/786e27ac85f542ca83c1ffbd870fa734.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 26-year-old nulliparous woman is diagnosed with early-stage ovarian cancer. Which surgery should be done in her case?",
    "choices": [
      {
        "id": 1,
        "text": "Unilateral oophorectomy"
      },
      {
        "id": 2,
        "text": "Bilateral oophorectomy"
      },
      {
        "id": 3,
        "text": "Hysterectomy with bilateral oophorectomy"
      },
      {
        "id": 4,
        "text": "Debulking surgery"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Unilateral oophorectomy </strong>is preferred in a <strong>young woman </strong>who has <strong>not completed</strong> her <strong>family </strong>in case of early-stage disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 63-year-old woman presented with complaints of pelvic and abdominal pain, and significant weight loss. A CT scan of the pelvis showed bilateral ovarian tumors and a CT scan of the chest showed pleural effusion. Pleural fluid analysis showed positive cytology for ovarian tumor cells. What FIGO stage does this belong to?",
    "choices": [
      {
        "id": 1,
        "text": "Stage III-A1"
      },
      {
        "id": 2,
        "text": "Stage III-B"
      },
      {
        "id": 3,
        "text": "Stage IV-A"
      },
      {
        "id": 4,
        "text": "Stage IV-B"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the\u00a0<strong>FIGO</strong>\u00a0staging of carcinoma of the ovary, fallopian tube, and primary peritoneal carcinoma, the presence of <strong>pleural</strong> <strong>effusion</strong> with <strong>positive</strong> <strong>cytology</strong> is classified as\u00a0<strong>stage IV-A.</strong></p>\n<p>Other options:</p>\n<p>Option A:\u00a0<strong>Stage</strong>\u00a0<strong>III-A1\u00a0</strong>is defined as a tumor involving <strong>one</strong> or <strong>both</strong> ovaries with <strong>positive retroperitoneal lymph nodes</strong> <strong>only.</strong></p>\n<p>Option B:\u00a0<strong>Stage\u00a0</strong><strong>III-B\u00a0</strong>is defined as a tumor involving <strong>one</strong> or <strong>both</strong> ovaries with <strong>macroscopic</strong>,<strong> extrapelvic</strong>, and <strong>peritoneal metastasis \u22642cm \u00b1 positive retroperitoneal nodes</strong> with extension to the <strong>capsule</strong> of the\u00a0<strong>liver</strong> or <strong>spleen</strong>.</p>\n<p>Option D:\u00a0<strong>Stage IV-</strong><strong>B\u00a0</strong>is defined as <strong>hepatic</strong> <strong>and/or</strong> <strong>splenic</strong> <strong>parenchymal</strong> metastasis, metastasis to extra-abdominal organs including <strong>inguinal</strong> <strong>lymph</strong> <strong>nodes</strong> and lymph nodes outside of the abdominal cavity.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young girl presents with gradually progressive abdominal distension, cough, breathlessness, and pleural effusion on the right side. USG showed an edematous right ovary with a large cyst and disruption in adnexal flow on Doppler. The mass is removed and its contents are shown below. What is the likely cause of her ascites and pleural effusion?",
    "choices": [
      {
        "id": 1,
        "text": "Meigs syndrome"
      },
      {
        "id": 2,
        "text": "Pseudo-Meigs syndrome"
      },
      {
        "id": 3,
        "text": "Pseudo-pseudo Meigs syndrome"
      },
      {
        "id": 4,
        "text": "Fitz-Hugh-Curtis syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>An<strong> ovarian mass</strong> consisting of\u00a0<strong>hair</strong>,<strong> bone</strong>, and <strong>sebaceous material</strong> is suggestive of\u00a0<strong>teratoma</strong>. The triad of <strong>teratoma</strong> with <strong>ascites</strong> and <strong>pleural effusion</strong> points towards the likely diagnosis of\u00a0<strong>pseudo-Meigs syndrome</strong>.</p>\n<p><strong>Pseudo-Meigs syndrome</strong>\u00a0presents with<strong>\u00a0ascites\u00a0</strong>and\u00a0<strong>pleural effusion</strong>\u00a0in association with<strong> benign ovarian tumors </strong>(other than ovarian fibromas) such as <strong>teratoma</strong>,<strong> struma ovarii</strong>,\u00a0<strong>mucinous cystadenoma,</strong>\u00a0etc. Other causes include\u00a0<strong>fibroids/leiomyoma</strong>, and <strong>secondary metastatic tumors</strong> to the ovary.</p>\n<p>The<strong> pleural effusions </strong>are usually<strong>\u00a0right-sided</strong>, even though the left-sided and bilateral effusions are possible.<strong> Resolution</strong>\u00a0of ascites and pleural effusion is seen after the\u00a0<strong>removal</strong>\u00a0of the tumor.\u00a0</p>\n<p>Teratomas are <strong>germ cell tumors</strong>. They contain <strong>embryonic tissues</strong> leading to the differentiation of cells along these pathways. Mature cystic teratoma, also known as dermoid cysts are <strong>unilocular</strong> in structure and have a <strong>smooth surface</strong>. They usually are lined by <strong>squamous epithelium</strong> with <strong>hair follicles</strong> leading to the formation of <strong>sebaceous material</strong> and hair. Other structures like <strong>teeth</strong>, <strong>bone</strong>, <strong>cartilage</strong>, thyroid tissue, and mucous membranes can also be found.\u00a0</p>\n<p>Patients may have symptoms because of the mass size of the teratoma. In other patients, ovarian teratomas can result in <strong>torsion</strong> of the ovary. Other rare complications include rupture of the cyst and spillage of contents into the abdominal cavity. Treatment of mature teratomas involves excision to prevent complications. Otherwise, mature teratomas are generally innocent.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Meigs syndrome</strong><strong>\u00a0</strong>is also characterized by a\u00a0<strong>triad </strong>of <strong>ovarian tumors</strong>, <strong>ascites</strong>, and\u00a0<strong>pleural effusion</strong>.\u00a0<strong>Ovarian fibroma</strong>\u00a0was originally described in the triad of\u00a0<strong>True Meigs syndrome</strong>. The other causes include granulosa cell tumor, Brenner tumor, or thecoma.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/bd7f26feb9d646679fdccbbdc9012719.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman presenting with deepening of the voice, coarse hair on the upper lip, bitemporal hair thinning was found to have a unilateral pelvic mass. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Granulosa cell tumour"
      },
      {
        "id": 2,
        "text": "Sertoli-Leydig cell Tumor"
      },
      {
        "id": 3,
        "text": "Endodermal sinus tumour"
      },
      {
        "id": 4,
        "text": "Choriocarcinoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical picture of <strong>hirsutism</strong> (coarse hair over upper lip), <strong>male</strong> <strong>pattern</strong> <strong>baldness</strong> (bitemporal hair thinning) and <strong>deepening</strong> <strong>of</strong> <strong>voice</strong> along with a unilateral <strong>pelvic mass </strong>in a reproductive aged female\u00a0is suggestive of a <strong>virilizing</strong> <strong>tumour</strong> <strong>of</strong> <strong>the</strong> <strong>ovary</strong>. <strong>Arrhenoblastoma or Sertoli-Leydig</strong> <strong>cell</strong> <strong>tumour</strong>\u00a0of the ovary is a<strong> </strong>virilizing tumour of the ovary.\u00a0</p>\n<p><strong>Sertoli</strong>-<strong>Leydig</strong> <strong>cell</strong> <strong>tumours</strong> are a type of <strong>sex</strong>-<strong>cord</strong> <strong>stromal</strong> ovarian tumor. It is most commonly seen in <strong>women</strong> of <strong>reproductive</strong> <strong>age</strong> <strong>group</strong>. These produce <strong>excess</strong> <strong>androgens</strong> and are hence known as <strong>virilizing</strong> <strong>tumours</strong>.<strong> </strong>Menstrual irregularities and signs of virilization like hirsutism and deepening of the voice are common presenting complaints. Microscopy reveals Sertoli cells and Leydig cells. Treatment is surgical excision.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 50-year-old female patient has been diagnosed with an ovarian tumor. Histopathological examination of tumor specimen reveals sheets of mucin-producing signet ring cells as seen below.  Identify the true statement regarding this ovarian tumor.",
    "choices": [
      {
        "id": 1,
        "text": "Capsular infiltration is seen"
      },
      {
        "id": 2,
        "text": "Normal shape of ovary is retained"
      },
      {
        "id": 3,
        "text": "Ovary is attached to nearby viscera and becomes immobile"
      },
      {
        "id": 4,
        "text": "They are usually unilateral"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario with histopathology showing\u00a0<strong>signet ring cells</strong>\u00a0is suggestive of\u00a0<strong>Krukenberg tumor </strong>and\u00a0in this ovarian tumor, the normal shape of the ovary is retained.</p>\n<p><strong>Krukenberg tumor</strong>: These are secondary growth in the ovary and most often arise from a primary carcinoma of the stomach (70%), large bowel (15%), and breast (6%).</p>\n<p>Features:</p>\n<ul>\n<li>Usually\u00a0<strong>bilateral\u00a0</strong>(Option D)</li>\n<li>Have a\u00a0<strong>smooth surface</strong></li>\n<li>They retain the shape of the normal ovary.</li>\n<li>There is <strong>no tendency to form adhesions</strong> with neighboring viscera and they are <strong>freely movable</strong> in the pelvis. (Option C)</li>\n<li>There is <strong>no infiltration</strong> through the capsule (Option A)</li>\n<li>Have a waxy consistency</li>\n</ul>\n<p><strong>Histologically, Numerous signet-ring cells</strong> with pale cytoplasm are seen.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/371b8affc9054a2ea9e67a0ed34774cd.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f6429d7a5d7d449b9d77b0a579847a6fx1280x960.JPEG"
    ]
  }
];
        let quizName = 'Ovarian Tumors Mini Test - -Tmt';
        const quizFilename = 'ovarian-tumors-mini-test-tmt-34375dab.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>