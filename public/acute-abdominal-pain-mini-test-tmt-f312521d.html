<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acute Abdominal Pain Mini Test - -Tmt - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 3-year-old child is brought with complaints of severe abdominal pain.  He consumes a balanced diet and vaccination is up to date. Laboratory studies show a Hb of 9gm/dl and elevated serum lactate. USG abdomen shows a bull's eye sign. Which of the following tests will help ascertain the potential etiology of his underlying condition?",
    "choices": [
      {
        "id": 1,
        "text": "Radionuclide pertechnetate scan"
      },
      {
        "id": 2,
        "text": "CT angiography abdomen"
      },
      {
        "id": 3,
        "text": "Serum WBC counts"
      },
      {
        "id": 4,
        "text": "Serum lead levels"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"ng-star-inserted\">\n<div class=\"table-responsive font-weight-light answer-scroll ng-star-inserted\">\n<p>An acute abdomen with a <strong>bull's eye lesion</strong> on USG is likely to be an <strong>intussusception</strong> in this patient's age group. This patient's <strong>Hemoglobin</strong> is <strong>reduced,</strong> despite consuming an adequate diet indicating a nondietary cause of <strong>anemia. Meckel's diverticulum</strong> could be a likely cause of his anemia and a potential cause of the intussusception and should be evaluated for with a <strong>radionuclide pertechnetate scan.</strong>\u00a0</p>\n<p>Intussusception occurs when a portion of the bowel is<strong>\u00a0telescoped</strong>\u00a0into an adjacent segment.<strong> </strong>Patients present with <strong>cramping abdominal pain</strong>, <strong>palpable sausage-shaped abdominal mass</strong>, and passage of <strong>red currant jelly stools</strong>. <strong>Vomiting </strong>may not begin later and with time, <strong>may be bile-stained.\u00a0</strong></p>\n<p><strong>Meckel's diverticulum</strong> is a portion of the <strong>vitelline duct</strong> that persists as an <strong>outpouching</strong> of the <strong>ileum</strong>. The diverticulum is usually asymptomatic unless it contains <strong>heterotopic pancreatic</strong> or <strong>gastric mucosa,</strong> which may lead to <strong>bleeding, ulceration,</strong> or <strong>perforation.</strong> Usually, the bleeding goes unnoticed and only comes to light on routine exams which shows anemia and is evaluated further. A Technitium 99 pertechnetate scan is used for the evaluation of Meckels diverticulum.\u00a0</p>\n<p>Intussusception is one of the common causes of intestinal obstruction in a paediatric patient.<strong> Ileo-colic junction </strong>is the most common site of involvement. The condition may arise due to the presence of <strong>lead points</strong> as seen in\u00a0enlarged submucosal <strong>Payer's patch</strong>, <strong>Meckel's diverticulum </strong><strong>,</strong>intestinal polyp, inflamed appendix, submucosal hemorrhage seen in <strong>Henoch-Schonlein purpura</strong>, and intestinal duplication cysts.</p>\n<p>Diagnosis is confirmed by <strong>abdominal ultrasound </strong>which shows the pathognomonic<strong> t</strong><strong>arget sign/bull's eye sign </strong>(shown below).<strong>\u00a0</strong></p>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d81d8af7dc2c42c1847e0212ef827ddfx720x598.JPEG"
    ]
  },
  {
    "text": "A patient presents with complaints of sudden onset central abdominal pain, fever, vomiting, and several episodes of bloody diarrhea. He has a past history of hypertension. After a detailed workup, he was diagnosed with acute mesenteric ischemia. Which of the following tests should be done further in this patient to evaluate the underlying cause?",
    "choices": [
      {
        "id": 1,
        "text": "Doppler of the lower limbs"
      },
      {
        "id": 2,
        "text": "CT Chest"
      },
      {
        "id": 3,
        "text": "2D Echo"
      },
      {
        "id": 4,
        "text": "ESR"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient is presenting with <strong>acute abdominal pain</strong> secondary to <strong>acute mesenteric ischemia(AMI).</strong> An <strong>arterial embolic</strong> clot is the most common cause of <strong>AMI</strong> and the most common source of this clot is the left <strong>atrium/ventricle due to atrial fibrillation.</strong> Thus a <strong>2D echo</strong> must be done in this patient to check for clots in the heart as they need to be treated soon to prevent a stroke.\u00a0</p>\n<p>Mesenteric ischemia may be acute or chronic. The <strong>superior mesenteric artery</strong> (SMA) is most likely affected. An embolus is the most common cause of SMA occlusion. Possible sources for SMA emboisation include:</p>\n<ul>\n<li>Left atrium in atrial fibrillation</li>\n<li>The left ventricle after mural <strong>myocardial infarction</strong></li>\n<li>Vegetations on mitral and aortic valves associated with endocarditis and</li>\n<li>An atheromatous plaque from an aortic aneurysm.</li>\n</ul>\n<p>Other causes of mesenteric ischemia include:</p>\n<ul>\n<li><strong>Atherosclerosis</strong> of mesenteric vessels</li>\n<li>Vasculitides</li>\n<li><strong>Venous thrombosis</strong> in factor V Leiden mutation</li>\n<li>Non-occlusive mesenteric ischemia due to alterations in splanchnic blood flow.</li>\n</ul>\n<p class=\"p1\">The most important clue to an early diagnosis of acute mesenteric ischemia is the <strong>sudden </strong>onset of <strong>severe abdominal pain</strong> in a patient with atrial fibrillation or <strong>atherosclerosis</strong>. The pain is typically in the <strong>central abdomen</strong> and out of proportion to the physical findings.</p>\n<p class=\"p1\">Associated clinical features include nausea, vomiting, diarrhea, abdominal distension, peritonitis, and the passage of bloody stools.</p>\n<p>The <strong>gold standard</strong> for the diagnosis of acute mesenteric ischemia is <strong>angiography</strong>, and management is <strong>laparotomy</strong>.\u00a0The goal of operative exploration is to <strong>resect the compromised bowel</strong> and restore blood supply via\u00a0<strong>embolectomy</strong>.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Doppler of the lower limbs</strong> is used to evaluate for deep vein thrombosis. However, a DVT causes pulmonary infarctions. Arterial thrombosis usually occurs due to an embolus originating in the left chamber of the heart.\u00a0</p>\n<p>Option B: <strong>CT chest</strong> is not a sensitive test to evaluate for a clot in the heart chambers.\u00a0</p>\n<p>Option D: <strong>ESR</strong> offers no diagnostic value in this patient.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old female at 24 weeks gestation with obstetric score G4P1L0A2 presents with acute abdominal pain. An urgent CT scan is done and shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Renal infarction"
      },
      {
        "id": 2,
        "text": "Budd Chiari syndrome"
      },
      {
        "id": 3,
        "text": "Splenic infarction"
      },
      {
        "id": 4,
        "text": "Ascending cholangitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario along with the CT scan showing a <strong>hypointensity</strong> in the <strong>spleen</strong> indicates a <strong>splenic infarction.</strong> The likely cause of infarction in this patient is <strong>thrombosis secondary</strong> to <strong>antiphospholipid syndrome (recurrent pregnancy losses).</strong></p>\n<p><strong>Antiphospholipid syndrome</strong> (APS) is an <strong>autoantibody-mediated</strong> acquired thrombophilia characterized by recurrent arterial or venous thrombosis and/or pregnancy morbidity. It primarily affects females. APS may either be <strong>primary</strong> or <strong>secondary</strong> to other <strong>autoimmune diseases,</strong> mainly SLE (secondary). The diagnosis of APS should be seriously considered in cases of <strong>thrombosis, cerebral vascular accidents</strong> in individuals <strong>&lt;55</strong> <strong>years of age</strong>, or <strong>pregnancy morbidity</strong> in the presence of livedo reticularis or thrombocytopenia. Laboratory criteria for APS include <strong>lupus anticoagulant</strong> (LA), <strong>anticardiolipin</strong> (aCL) antibody assay, and Aanti-\u03b22GPI (glycoprotein 1) antibodies assay.</p>\n<p>Clinical and Laboratory Criteria for Diagnosis of Antiphospholipid Antibody Syndrome:</p>\n<p>Clinical criteria:</p>\n<p>Obstetric</p>\n<ul>\n<li><strong>Three</strong> or more <strong>unexplained consecutive spontaneous</strong> abortions before 10 weeks</li>\n<li>One or more <strong>deaths</strong> of a <strong>morphologically normal fetus</strong> at or beyond 10 weeks</li>\n<li>Severe pre-eclampsia necessitating delivery before 34 weeks</li>\n<li>Vascular: One or more episodes of arterial, venous, or small vessel thrombosis in any tissue or organ.</li>\n</ul>\n<p>Laboratory criteria:</p>\n<ul>\n<li>Presence of <strong>lupus anticoagulant</strong></li>\n<li>Presence of <strong>IgG</strong> or <strong>IgM anti-cardiolipin</strong> antibodies</li>\n<li>Presence of IgG or IgM <strong>anti-beta-2 glycoprotein</strong> <strong>I antibodies</strong></li>\n<li>At least one clinical and one laboratory criterion has to be present for a diagnosis to be made.</li>\n</ul>\n<p>Management: Women are treated with <strong>low-dose aspirin</strong> (50 mg/day) and <strong>heparin</strong> (5,000 units SC twice daily) for up to <strong>34 weeks. Unfractionated heparin</strong> and <strong>low molecular weight heparin</strong> (LMWH) are equally effective and safe.</p>\n<p>\u00a0Fetal loss in APLA is due to fetal hypoxia</p>\n<p>Note: The new <strong>2023 ACR/EULAR criteria </strong>is\u00a0an update from the revised Sapporo criteria with clinical criteria divided into 6 domains and each metric in the clinical and laboratory value adding a weighted score. This has increased the <strong>specificity </strong>in diagnosing APS.\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a604ebb3a47e48dda637e9ae2be5dd1e.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient presented\u00a0with abdominal pain, and\u00a0elevated AST and\u00a0ALT levels,\u00a0one day after undergoing emergency abdominal aortic aneurysm repair. When his right upper quadrant is palpated he winces in pain. The incision is healthy and has a serous discharge. USG reveals no abnormal fluid collection. What is the likely etiology of his pain?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatic laceration"
      },
      {
        "id": 2,
        "text": "Subhepatic abscess"
      },
      {
        "id": 3,
        "text": "Hepatic vein thrombosis"
      },
      {
        "id": 4,
        "text": "Ischemic necrosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This patient has developed <strong>abdominal pain</strong> and elevations in his <strong>AST</strong> <strong>and ALT levels, </strong>1\u00a0day after an <strong>emergency abdominal aneurysm repair.</strong> The likely diagnosis is <strong>shock liver due to ischemic necrosis</strong> secondary to <strong>hypotension</strong> due to <strong>exsanguination</strong>.</p>\n<p>Perioperative hypotension is also a known complication of the surgery.\u00a0</p>\n<p><strong>Ischemic hepatitis</strong>, known by different terms such as ischemic hepatopathy, hypoxic hepatitis, shock liver, or acute cardiogenic liver injury, is a condition that arises from a <strong>sudden decrease</strong> in <strong>cardiac output</strong> caused by acute <strong>myocardial</strong> <strong>infarction</strong>, <strong>arrhythmia</strong>, or septic or hemorrhagic <strong>shock</strong>. Typically, it occurs in patients with <strong>passive congestion </strong>of the liver.\u00a0</p>\n<p>The presence or observation of clinical hypotension may be lacking or not documented. In some cases, the triggering event is arterial hypoxemia related to respiratory failure, sleep apnea, severe anaemia, heat stroke, carbon monoxide poisoning, cocaine usage, or bacterial endocarditis. <strong>Administration of statin medication before</strong> hospital <strong>admission</strong> has the potential to confer <strong>protection</strong> <strong>against</strong> the occurrence of<strong> ischemic hepatitis</strong>.</p>\n<p>Elevations in blood alkaline phosphatase and bilirubin levels are typically of a modest nature; nevertheless, the <strong>presence of jaundice</strong> is indicative of more <strong>unfavourable outcomes</strong>. The <strong>prolongation of prothrombin time</strong> may lead to the development of <strong>encephalopathy</strong> or <strong>hepatopulmonary</strong> <strong>syndrome</strong>. The mortality rate associated with the underlying disease is notably elevated, especially among patients undergoing vasopressor therapy or experiencing septic shock, acute kidney disease, or coagulopathy. However, in patients who successfully recover, the<strong> levels of aminotransferase return to their normal state rapidly</strong>, typically <strong>within a week</strong>, which stands in contrast to the prolonged normalization period observed in cases of viral hepatitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man developed severe pain abdomen and fever 3 days after undergoing surgery for bowel perforation. There is no dehiscence or discharge from the sutured wound seen. The intra-abdominal pressure was measured to be 25mm Hg. Which of the following physiological changes will not be seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Decreased cardiac output"
      },
      {
        "id": 2,
        "text": "Decreased glomerular filtration"
      },
      {
        "id": 3,
        "text": "Decreased central venous pressure"
      },
      {
        "id": 4,
        "text": "Increased systemic vascular resistance"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<div class=\"page\" title=\"Page 327\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The above scenario with an intra-abdominal pressure (IAP)<strong>\u00a020 mm Hg</strong> or<strong> greater</strong>\u00a0is\u00a0suggestive of an<strong> abdominal compartment syndrome (ACS).</strong>\u00a0It is associated with an <strong>increased central venous pressure.</strong></p>\n<p>The\u00a0<strong>normal IAP</strong>\u00a0is\u00a0<strong>5-7 mmHg</strong>. When the IAP is\u00a0<strong>&gt; 12 mmHg</strong>, it is termed\u00a0intra-abdominal hypertension<strong> (IAH)</strong>.\u00a0ACS develops when <strong>IAP is 20 mmHg or greater, </strong>with or without abdominal perfusion pressure less than 50 mm Hg it is associated with <strong>failure of one or more organ systems.</strong></p>\n<p>Diagnosis is made by\u00a0measuring IAP using a\u00a0<strong>urinary bladder\u00a0</strong>(Foley catheter) or\u00a0<strong>gastric catheter</strong>. CT scan, abdominal perfusion pressure and renal filtration gradient are some of the tests done to check organ dysfunction.</p>\n<p>The primary goal of management is to reduce the IAP. So\u00a0<strong>rapid decompression</strong>\u00a0is done by opening the abdomen and performing a temporary closure of the abdominal wall using a mesh or a plastic bag\u00a0<strong>(Bogota bag).</strong>\u00a0After the resuscitation and management of the specific causes, a\u00a0<strong>definite closure</strong>\u00a0of the abdomen can be done by\u00a0<strong>vacuum-assisted closure\u00a0</strong>(VAC), split-skin graft, or prosthetic mesh.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "You are in the casualty observing your resident perform a test on a road traffic accident patient with acute abdominal pain. The patient winces in pain as the resident releases his hand after palpating his abdomen. What is the likely course for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Spontaneous recovery"
      },
      {
        "id": 2,
        "text": "Emergency surgery"
      },
      {
        "id": 3,
        "text": "Recovery after IV antibiotics"
      },
      {
        "id": 4,
        "text": "Recovery after blood transfusion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This patient presenting with <strong>tenderness</strong> on <strong>releasing</strong> the <strong>hand</strong> rather than on applying pressure has <strong>rebound tenderness.</strong> This sign is referred to as <strong>Blumberg's</strong> sign. This is an indication that the patient has <strong>peritoneal irritation,</strong> likely <strong>secondary</strong> to a <strong>hollow viscus perforation.</strong> He will most likely need an <strong>emergency laparotomy</strong> after a <strong>preliminary FAST</strong> scan.</p>\n<p><strong>Rebound tenderness</strong> is an indicator of <strong>peritoneal irritation</strong> and the most common <strong>cause</strong> of this in the case of a <strong>road traffic accident</strong> would be a <strong>hollow viscus perforation.</strong> Such patients are only evaluated with a FAST scan as their vitals will be unstable requiring emergent surgery. If the <strong>vitals</strong> are <strong>stable,</strong> a <strong>CT scan</strong> of the <strong>abdomen</strong> can be done to find the <strong>site</strong> of <strong>perforation.</strong>\u00a0</p>\n<p>Other options:</p>\n<p>Option A: <strong>Spontaneous recovery</strong> after a hollow viscous perforation is <strong>unlikely</strong>, almost all patients require emergent surgery.</p>\n<p>Option C: <strong>IV antibiotics</strong> are used to treat <strong>non-traumatic</strong> peritonitis, but if there is a history of trauma, a hollow viscus perforation should be strongly suspected.</p>\n<p>Option D: While this patient might need a <strong>blood transfusion</strong> for unstable vitals, surgery will still be the main management.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to the casualty 2 days after a high-speed car collision due to increasing abdominal pain and vomiting. On examination, he has a bruise on his abdomen that corresponds to the car seat belt. Below is his CT scan with contrast. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Duodenal hematoma"
      },
      {
        "id": 2,
        "text": "Intraperitoneal bladder leak"
      },
      {
        "id": 3,
        "text": "Traumatic pancreatitis"
      },
      {
        "id": 4,
        "text": "Hepatic hematoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient following a <strong>car collision</strong> and <strong>bruises</strong> corresponding to the <strong>car seat belt</strong> has suffered a <strong>contusion</strong> <strong>of the abdomen.</strong> The <strong>CT scan</strong> shows <strong>contrast enhancement</strong> in the<strong> wall of the duodenum</strong> indicating a <strong>duodenal hematoma.</strong> This can cause pain and partial gastric construction, thus explaining his symptoms.\u00a0</p>\n<p>Duodenal hematoma occurs after high-speed collisions which cause <strong>blunt impact</strong> on the abdomen. This leads to a <strong>compression of the duodenum</strong> <strong>against the vertebrae</strong> and leads to an injury, allowing for a slow bleed and hematoma formation.</p>\n<p>These patients are usually managed <strong>conservatively</strong> by <strong>nasogastric decompression</strong> and <strong>IV fluids</strong> till the <strong>hematoma resolves</strong> on its own. If the hematoma is <strong>huge</strong> or it <strong>ruptures,</strong> then <strong>surgical management</strong> will be required.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: An <strong>intraperitoneal bladder leak </strong>can lead to<strong> chemical peritonitis</strong> and a more toxic presentation. However, the CT scan showing blood in the duodenal wall makes a duodenal hematoma more likely.</p>\n<p>Option C: <strong>Pancreatitis</strong> would present with <strong>abdominal pain radiating towards the back</strong>, and <strong>vomiting</strong>. However, the CT scan showing blood in the duodenal wall makes a duodenal hematoma more likely.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c46119e2c9304a94a66bcf2479b0014b.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 3-year-old boy is brought with complaints of abdominal pain. Physical examination shows a mass in the left upper quadrant. Laboratory tests show a Hb of 6mg/dl and glucose 70mg/dl. 3 months ago his Hb was 12mg/dl. He has a past history of recurrent painful swellings of his fingers. Which among the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Splenic sequestration crisis"
      },
      {
        "id": 2,
        "text": "Nephroblastoma"
      },
      {
        "id": 3,
        "text": "Neuroblastoma"
      },
      {
        "id": 4,
        "text": "Juvenile rheumatoid arthritis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This child presented with complaints of <strong>abdominal pain</strong> with a <strong>mass in the left upper quadrant</strong> of the abdomen. He also has a <strong>rapid reduction</strong> in <strong>serum Hb</strong> concentration (12 to 6mg/dl). This combined with a history of <strong>recurrent painful finger swelling</strong> likely indicates <strong>dactylitis</strong> secondary to <strong>sickle cell disease.</strong> This patient has developed a <strong>splenic sequestration crisis,</strong> a feared complication of sickle cell disease.\u00a0</p>\n<p>Splenic sequestration occurs when areas of <strong>sickled cells</strong> in <strong>red pulp obstruct</strong> a <strong>major vein,</strong> leading to a <strong>propagation</strong> effect with <strong>further sickling</strong> and <strong>reduced oxygen tension.</strong> As more and more RBCs get <strong>trapped</strong> in the spleen, it can lead to massive splenomegaly. This is usually <strong>triggered</strong> by underlying conditions like <strong>infections,</strong> or <strong>acute hypoxia.</strong> This condition is usually seen in individuals <strong>below</strong> the age of <strong>5</strong> as patients <strong>older</strong> than this usually have <strong>auto-infarcted</strong> their spleen.</p>\n<p>It presents as abrupt pallor, abdominal pain and distention.\u00a0</p>\n<p>Patients are usually diagnosed clinically, but other causes of anemias should be ruled out first. CT abdomen with contrast can be done if necessary.</p>\n<p>Treatment:</p>\n<ul>\n<li>Rapid <strong>blood transfusion</strong> to correct the <strong>hypovolemia.</strong> This <strong>corrects</strong> the <strong>hypoxia</strong> and releases the trapped RBCs.</li>\n<li><strong>Splenic size</strong> should be <strong>monitored</strong> for <strong>reduction</strong> in size.\u00a0</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The following abdominal x-ray finding is noted in a 40-year-old male patient with a history of peptic ulcer disease. Which of the following is unlikely to be observed on clinical examination of the patient?",
    "choices": [
      {
        "id": 1,
        "text": "Board-like abdominal rigidity"
      },
      {
        "id": 2,
        "text": "Tachycardia"
      },
      {
        "id": 3,
        "text": "Patient twisting and turning in pain"
      },
      {
        "id": 4,
        "text": "Pain referred to the shoulder tip"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The x-ray showing <strong>free air under the diaphragm</strong> in a patient with an underlying history of peptic ulcer disease is indicative of <strong>peptic ulcer perforation.</strong> The patient is likely to be seen lying still with<strong> minimal movements </strong>rather twisting and turning in pain<strong> as movement aggravates pain in peritonism</strong>.</p>\n<p>The classical description of a patient with a perforated peptic ulcer is described in three stages:</p>\n<ul>\n<li><strong>Stage of peritonism</strong>: Initial 6 hours - patient presents with an <strong>acute burning epigastric pain </strong>with or without <strong>vomiting. </strong>Leakage of gastric acid into the peritoneal cavity causes diaphragmatic irritation which may lead to<strong> pain referred to the shoulder tip </strong>(Option D) and tracking of fluid in the right para-colic gutter may lead to <strong>right iliac fossa pain</strong>. <strong>Abdominal guarding</strong> with <strong>diminished abdominal movements on respiration</strong> is noted and the patient avoids movement to prevent pain.<strong> Tachycardia </strong>(Option B) is noted but pyrexia does not set in.</li>\n<li><strong>Stage of reaction</strong>: the <strong>symptoms temporarily subside</strong> due to the dilution of the exudate in the peritoneal cavity but <strong>abdominal rigidity remains</strong> (Option A)<strong>.</strong></li>\n<li><strong>Stage of diffuse peritonitis</strong>: sunken face, hollow cheeks, dry mucous membranes (<strong>facies hippocratica</strong>) with <strong>fever, tachycardia, low volume pulse</strong> and increasing <strong>abdominal distension.</strong></li>\n</ul>\n<p>Initial management includes<strong> intravenous (IV) fluid therapy, cessation of oral intake</strong>, and administration of <strong>broad-spectrum antibiotics</strong>. Perforation is an indication for <strong>surgical exploration.</strong> Perforations less than 1 cm can be <strong>closed primarily with an omental patch repair</strong>, while larger perforations may require a <strong>distal gastrectomy with a roux-en-y reconstruction</strong>.\u00a0Patients require<strong> prolonged PPI therapy postoperatively.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3a64bfb098a24fe79b991cb074152e47.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly male presents with a 2-day history of abdominal pain. He denies any trauma. On examination, there is a tender mass in the left iliac area. The pain increases and the mass becomes more prominent on abdominal tensing. He has a history of deep vein thrombosis for which he takes anticoagulants. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Rectus sheath hematoma"
      },
      {
        "id": 2,
        "text": "Divarication of recti"
      },
      {
        "id": 3,
        "text": "Spigelian hernia"
      },
      {
        "id": 4,
        "text": "Umbilical hernia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This elderly patient presenting with a <strong>2-day history</strong> of <strong>abdominal pain</strong> and a <strong>mass</strong> with <strong>concurrent</strong> use of <strong>anticoagulation</strong> has most likely developed a <strong>rectus sheath hematoma.</strong>\u00a0</p>\n<p>A rectus sheath hematoma occurs due to the <strong>accumulation</strong> of <strong>blood</strong> in the <strong>rectus sheath.</strong> This is usually <strong>spontaneous</strong> in <strong>old patients</strong> due to <strong>weakness</strong> of the <strong>rectus sheath.</strong> Anticoagulants further increase the risk of a bleed. Other risk factors include <strong>trauma, previous surgery, abdominal</strong> strain, coughing , pregnancy etc. It usually occurs in the <strong>lower abdomen.</strong>\u00a0</p>\n<p>It presents as a <strong>painful lower abdominal mass</strong> and does <strong>not cross</strong> the <strong>midline.</strong> Imaging is done to confirm the diagnosis but is not required unless it's an expanding hematoma.\u00a0</p>\n<p><strong>Treatment: Conservative management</strong> is preferred, only if there's <strong>no hemodynamic compromise.</strong> If this fails, surgery will be required.\u00a0</p>\n<p>Other options:</p>\n<p>Option B: <strong>Divarication</strong> of <strong>recti</strong> is the thinning of the <strong>linea alba</strong> in the epigastrium with protrusion of the abdominal wall with prominent edges of both recti. It becomes prominent on lifting the head from the bed. No treatment is required in the divarication of recti.</p>\n<p>Option C: <strong>Spigelian hernias</strong> arise from a defect in the Spigelian fascia, which is the <strong>aponeurosis</strong> of the <strong>transversus abdominis</strong> muscle. The fascia extends between the transversus muscle and the lateral border of the rectus sheath from the costal margin to the groin, where it blends into the conjoint tendon. This patients lesion is not consistent with the location of a spigelian hernia.\u00a0</p>\n<p>Option D: In adults, <strong>umbilical hernias</strong> are typically acquired, with a <strong>greater incidence</strong> observed among <strong>females.</strong> Various factors, including <strong>pregnancy, obesity,</strong> and <strong>liver illness</strong> accompanied by cirrhosis and ascites, can lead to the <strong>elongation</strong> and <strong>attenuation</strong> of the <strong>midline raphe</strong> (linea alba), hence increasing the likelihood of reoccurrence of the umbilical defect.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 68-year-old male complains of abdominal distension and pain 2 days. He is diagnosed with colonic pseudobstruction. Which of the following are risk factors associated with the development of this disease?",
    "choices": [
      {
        "id": 1,
        "text": "1,2,4"
      },
      {
        "id": 2,
        "text": "1,3,5"
      },
      {
        "id": 3,
        "text": "3,4,5"
      },
      {
        "id": 4,
        "text": "1,2,5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Prolonged fasting</strong> and <strong>adhesions</strong> are <strong>not risk factors</strong> for the development of a colonic pseudo-obstruction.</p>\n<p>Psuedo-obstruction can present in <strong>acute</strong> or<strong> chronic forms</strong>. <strong>The acute form</strong> is seen in medically ill patients and <strong>affects the colon.</strong> <strong>The chronic form</strong> affects <strong>other parts of the gastrointestinal tract</strong> and presents with recurring subacute and partial intestinal obstruction.</p>\n<p>Risk factors for developing <strong>pseudo obstructions</strong> are usually conditions that usually cause a <strong>decrease</strong> in <strong>colonic motility. Psychiatric conditions</strong> are a <strong>risk factor</strong> due to the <strong>medications</strong> used to treat them having <strong>anticholinergic</strong> side effects which can precipitate this condition after prolonged use. <strong>Recent surgery</strong> and <strong>opioid use</strong> also leads to <strong>paralytic</strong> ileus and a <strong>reduction</strong> in motility respectively.</p>\n<p>Diagnosis is by <strong>abdominal X-rays</strong> which show <strong>distended colon</strong> with the <strong>right</strong> and <strong>transverse segment of colon</strong> affected majorly. A <strong>transition point</strong> is often present, usually <strong>at or near the splenic flexure</strong>.</p>\n<p>The most useful investigation is a <strong>water-soluble enema</strong>. Contrast enema differentiates mechanical obstruction and pseudo-obstruction</p>\n<p>Initial treatment is by <strong>nasogastric decompression, fluid deficit replacement,</strong> and<strong> electrolyte abnormality correction</strong>. Medications that inhibit bowel movements should be discontinued. Most patients improve with this regimen and\u00a0<strong>conservative treatment</strong> with<strong> serial X-rays</strong> or<strong> USG.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the type of acute abdominal pain with the most likely diagnosis",
    "choices": [
      {
        "id": 1,
        "text": "1-a, 2-c, 3-b, 4-e, 5-d"
      },
      {
        "id": 2,
        "text": "1-c, 2-b, 3-a,4-d,5-d"
      },
      {
        "id": 3,
        "text": "1-b, 2-a, 3-c, 4-e, 5-d"
      },
      {
        "id": 4,
        "text": "1-e, 2-a, 3-c, 4-b, 5-d"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The correct answer is 1-b, 2-a, 3-c, 4-e, 5-d</p>\n<p>Diagnosis of many conditions can be aided by the typical pattern of abdominal pain.</p>\n<p><strong>Pancreatitis</strong> causes abdominal pain that <strong>radiates</strong> to the <strong>back</strong> as it is a <strong>retroperitoneal</strong> <strong>organ</strong>.\u00a0</p>\n<p><strong>Appendicitis</strong> initially causes <strong>periumbilical pain</strong> as the pain is transmitted along the <strong>T10 dermatome</strong> before getting <strong>localized</strong> to <strong>McBurney's</strong> point.</p>\n<p><strong>Diverticulitis</strong> occurs due to an <strong>inflammation</strong> of a <strong>diverticulum</strong> in the large bowel, and these <strong>diverticula</strong> are usually in the <strong>left descending</strong> colon. Hence there is left lower quadrant pain.</p>\n<p><strong>Diffuse abdominal pain</strong> is seen in <strong>mesenteric atherosclerosis.</strong> It is also termed <strong>angina</strong> of the <strong>abdomen</strong> and occurs due to a <strong>supply-demand</strong> mismatch <strong>leading</strong> to <strong>pain</strong> in the abdomen <strong>diffusely.</strong> It classically presents as <strong>pain out of proportion to the findings.</strong></p>\n<p><strong>Colicky pain</strong> is seen in the <strong>passage</strong> of <strong>renal stones</strong> through the ureter in a <strong>loin-to-groin</strong> distribution.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child is brought to you with abdominal pain after he ingested something. Ingestion of which of the following objects requires urgent intervention?",
    "choices": [
      {
        "id": 1,
        "text": "Coin"
      },
      {
        "id": 2,
        "text": "Magnets"
      },
      {
        "id": 3,
        "text": "Gold ring"
      },
      {
        "id": 4,
        "text": "Small round plastic bead"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Out of the given options, <strong>ingestion of magnets</strong> requires <strong>urgent intervention</strong>, as there is no way to ascertain how many the child has ingested. They can <strong>stick to each other</strong> <strong>through different loops</strong> and can <strong>cause pressure necrosis </strong>of the bowel wall and <strong>perforation</strong>. Thus they <strong>need urgent intervention to prevent complications.\u00a0</strong></p>\n<p>All the other options are examples of inert objects that are usually allowed to be excreted via stools if they have passed into the stomach as they will have cleared the narrowest part of the GI tract.\u00a0</p>\n<p><strong>Foreign bodies</strong> commonly ingested by children are <strong>coins, disk batteries,</strong> and <strong>small toy</strong> items. In adults, it is usually a food bolus (mostly meat) that gets lodged. Initial symptoms are choking, gagging, and coughing followed by excessive salivation, dysphagia, food refusal, vomiting, or pain in the neck and throat.\u00a0</p>\n<p>Imaging with <strong>chest</strong> and <strong>abdominal X-rays</strong> should be performed in <strong>AP</strong> and <strong>lateral positions.</strong> <strong>Chest CT</strong> should always be performed<strong> if oesophageal perforation is suspected.</strong></p>\n<p><strong>Endoscopic removal</strong> of the <strong>esophageal</strong> foreign body is the <strong>procedure of choice</strong>. It should be performed:</p>\n<ul>\n<li><strong>Immediately</strong> in <strong>esophageal obstruction, disk batteries, </strong>and<strong> sharp pointed objects</strong>.</li>\n<li><strong>Within 12-24 hours</strong> in non-pointed objects, pointed objects in the stomach, and coins in the esophagus if they're not passed spontaeneously.</li>\n<li><strong>Non-urgent removal</strong> in objects in stomach &gt;2.5cm in diameter, and disk battery in the stomach (up to 48h)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 65-year-old lady comes to the hospital due to a 1-hour history of epigastric pain and diaphoresis. Examination shows no abdominal tenderness. Her ECG recording is shown below. Which of the following concomitant findings would be likely in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Diffuse abdominal tenderness"
      },
      {
        "id": 2,
        "text": "Facial flushing"
      },
      {
        "id": 3,
        "text": "Raised JVP"
      },
      {
        "id": 4,
        "text": "Haematochezia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>This patient with epigastric abdominal pain and ECG with ST-segment elevation in leads II, III, and aVF is suggestive of an <strong>inferior wall myocardial infarction</strong>. <strong>Raised JVP</strong> is seen in an inferior wall MI as it causes build-up of blood in the right heart and thus transmits back pressure to the right jugular vein.</p>\n<p><strong>Myocardial infarction</strong> (MI) occurs when there is an <strong>occlusion</strong> of one or more arteries supplying the heart. This leads to an <strong>imbalance</strong> between myocardial oxygen <strong>demand</strong> and <strong>supply,</strong> leading to <strong>myocardial ischemia</strong> and <strong>death.</strong> An <strong>inferior wall MI</strong> can present <strong>atypically</strong> with <strong>abdominal pain</strong> in women and diabetics, so any patient with a high degree of suspicion for an MI presenting with epigastric pain should be evaluated for it via ECG.\u00a0</p>\n<p>Treatment of MI primarily involves <strong>control of discomfort</strong>, <strong>fibrinolysis</strong>, and <strong>reperfusion</strong> <strong>therapy</strong>. Reperfusion therapy includes both <strong>PCI</strong> and <strong>coronary artery bypass grafting</strong> (CABG).\u00a0</p>\n<p>In PCI, a <strong>stent</strong> or <strong>balloon</strong> is inserted into the occluded artery to restore blood flow. It is done under local anaesthesia and mild sedation. In CABG, a <strong>vessel</strong> is <strong>grafted</strong> from a different part of the body and is used to restore blood flow by <strong>bypassing</strong> the <strong>occlusion</strong>. It is a <strong>surgical</strong> procedure. CABG is generally preferred for <strong>severe left main</strong> and <strong>three-vessel disease</strong>.\u00a0</p>\n<p>Reperfusion therapy should be done as soon as possible, within a few hours of the onset of symptoms. It has better short-term and long-term outcomes when compared to fibrinolysis alone.\u00a0</p>\n<p>Other options:\u00a0</p>\n<p>Options A and D: <strong>Diffuse abdominal tenderness</strong> is seen in a <strong>perforated peptic ulcer</strong> and <strong>hematochezia</strong>\u00a0can be expected in a case of a <strong>bleeding peptic ulcer.</strong> This patients patient's ECG shows ST elevations in leads II, III and aVF, indicating an inferior wall MI.\u00a0</p>\n<p>Option C: <strong>Facial flushing</strong> can be seen in <strong>superior sulcus tumours</strong> and <strong>carcinoid syndromes,</strong> but the ECG findings here make MI more likely.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b37153487a6e4e78ac9585bec7178eae.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An air conditioner technician presents with acute abdominal pain and diarrhea. He also has a dry cough and malaise. Serum electrolytes show hyponatremia. What is the likely causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Bacillus cereus"
      },
      {
        "id": 2,
        "text": "Legionella pneumophila"
      },
      {
        "id": 3,
        "text": "Vibrio cholerae"
      },
      {
        "id": 4,
        "text": "Vibro vulnificus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the electrolyte studies showing <strong>hyponatremia</strong> point toward the diagnosis of <strong>Legionnaire's disease. </strong>This is caused by <strong>Legionella pneumophila.</strong></p>\n<p class=\"p1\">They are found in lakes, streams, and other water bodies. Infection is mostly <strong>spread</strong> by <strong>inhalation</strong> of the bacteria from <strong>aerosols</strong> produced by <strong>contaminated air conditioners,</strong> humidifiers, nebulizers, etc.</p>\n<p>It presents mostly <strong>asymptomatically</strong> under the age of <strong>55 years</strong>. Infection is usually severe in <strong>immunocompromised patients</strong>. It may present as a severe, rapidly progressive disease with <strong>high fever, chills, hypoxia, diarrhea,</strong> and <strong>delirium</strong>. On chest x-ray, <strong>patchy</strong>, often <strong>multilobar consolidation</strong> is seen. <strong>Pleural effusion</strong> may also occur. <strong>Hyponatremia</strong> is a feature <strong>typical</strong> of this infection too.\u00a0</p>\n<p>A milder form of a clinical syndrome known as <strong>P</strong><strong>ontiac fever,\u00a0</strong>which is usually <strong>self-limiting</strong> and only has mild symptoms of fever, myalgia, and headache.</p>\n<p><strong>Microscopy</strong> of the sputum samples shows <strong>numerous leucocytes without any organism</strong>. Gram staining of the sterile sites like pleural fluid and lung tissues show <strong>faint gram-negative bacilli</strong>. They require a <strong>counterstain</strong> of <strong>basic fuschin</strong> as <strong>safranin</strong> stains the bacteria very poorly. They are a group of <strong>fastidious</strong>, <strong>aerobic gram-negative</strong> bacteria. They can be grown on a <strong>buffered charcoal yeast extract (BCYE) agar</strong>.</p>\n<p><strong>Diagnosis</strong> is established with the help of <strong>direct fluorescent antibody tests</strong> and <strong>BCYE culture specimens</strong>. <strong>Urine antigen tests</strong> and <strong>molecular assays</strong> may also be used.</p>\n<p>The below image shows the\u00a0Direct Fluorescent Antibody Test.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/42499ea21b4548eaa2d90349c3ab1a9dx700x491.JPEG"
    ]
  },
  {
    "text": "A 3-year-old child is brought with complaints of abdominal pain. He has not passed stools in 2 days. His mother informs that his last stool was pebble-shaped and hard. He recently started preschool. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Somatization disorder"
      },
      {
        "id": 2,
        "text": "Functional constipation"
      },
      {
        "id": 3,
        "text": "Irritable bowel syndrome"
      },
      {
        "id": 4,
        "text": "Hirschprung disease"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>This child presenting with complaints of <strong>abdominal pain</strong> and <strong>no stool</strong> passage since <strong>2</strong> days and a history of starting preschool recently likely has <strong>functional constipation.</strong>\u00a0</p>\n<p>Functional constipation is a clinical diagnosis. It occurs when a child starts a <strong>new activity</strong> like <strong>toilet training</strong> or starting preschool which requires <strong>withholding</strong> behavior. This is still a social stressor for them and can lead to maladaptive responses leading to constipation.\u00a0</p>\n<p>The condition is benign and usually resolves on its own. <strong>Disimpaction</strong> can be done in severe cases but otherwise the mode of treatment is just with <strong>laxatives</strong> and <strong>behavioral</strong> approaches.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old child presented with colicky abdominal pain, arthralgia, and purpuric rash on the thighs after an upper respiratory tract infection. Which of the additional features can be seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Oral ulcers"
      },
      {
        "id": 2,
        "text": "Hemoptysis"
      },
      {
        "id": 3,
        "text": "Thrombocytopenia"
      },
      {
        "id": 4,
        "text": "Glomerulonephritis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>This clinical vignette points to a diagnosis of <strong>Henoch Schonlein purpura</strong>(HSP). The<strong> </strong>additional clinical feature that can be seen is <strong>glomerulonephritis</strong> in severe cases of HSP.</p>\n<p>Henoch schonlein purpura is also known as<strong> IgA vasculitis.</strong></p>\n<p>It is a small vessel vasculitis characterized by <strong>palpable purpura, arthralgias, gastrointestinal signs and symptoms, and glomerulonephritis.</strong></p>\n<p>Gastrointestinal manifestations are<strong> colicky abdominal pain</strong>, nausea, vomiting, diarrhea, constipation, and passage of blood in stools.</p>\n<p>It is more commonly seen in children aged <strong>4-7 years</strong>. Some of the factors that trigger the development of HSP include upper respiratory infections, drugs, foods, insect bites, and immunizations.</p>\n<p><strong>Skin biopsy</strong> is used to confirm the diagnosis by demonstrating the <strong>leukocytoclastic vasculitis</strong> with <strong>IgA</strong> and <strong>C3 deposition</strong> by <strong>immunofluorescence</strong>.</p>\n<p>Henoch Schonlein purpura has an <strong>excellent prognosis</strong>. Patients with rapidly progressive glomerulonephritis are treated with glucocorticoids.</p>\n<p>Other options:</p>\n<p>Option A: <strong>Bechet's</strong> <strong>syndrome</strong> is characterized by recurrent genital ulcers,<strong> oral ulcers</strong>, skin lesions, eye lesions, or a positive pathergy test. Some of the patients have HLA B*51 positivity. <strong>Oral ulcers</strong> are usually the first manifestation of the disease.</p>\n<p>Option B: <strong>Microscopic polyangiitis</strong> affects small and medium-sized arteries with a predilection to involve the capillaries and venules Glomerulonephritis and <strong>hemoptysis due to alveolar hemorrhage</strong> can also occur.\u00a0</p>\n<p>Option C: Thrombocytopenia is not a feature of Henoch Schonlein purpura. Laboratory findings of HSP include mild leukocytosis, <strong>normal platelet count,</strong> and eosinophilia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 44-year-old woman presenting with acute abdominal pain had previously been diagnosed with uterine fibroids. Which of the following complications is most unlikely to have occurred here?",
    "choices": [
      {
        "id": 1,
        "text": "Hemorrhage into the fibroid"
      },
      {
        "id": 2,
        "text": "Hyaline degeneration"
      },
      {
        "id": 3,
        "text": "Red degeneration"
      },
      {
        "id": 4,
        "text": "Sarcomatous change"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Hyaline degeneration</strong> of fibroids is unlikely here as it is <strong>usually painless</strong> and presents as an abdominal mass causing distension and heaviness.</p>\n<p><strong>Acute pain in fibroids</strong> is seen in the case of:&nbsp;</p>\n<ul>\n<li>Fibroid torsion</li>\n<li>Hemorrhage into the fibroid</li>\n<li>Red degeneration</li>\n<li>Sarcomatous change - seen in postmenopausal women.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presenting with acute abdomen was found to have elevated serum amylase levels. Which of the following should be part of your differential diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3, 4"
      },
      {
        "id": 2,
        "text": "1 and 5"
      },
      {
        "id": 3,
        "text": "2, 3, 4"
      },
      {
        "id": 4,
        "text": "1, 2, 3, 4, 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All the above conditions should be part of the differential diagnosis in patients with <strong>acute abdominal pain</strong> and <strong>elevated serum amylase levels.</strong></p>\n<p>Conditions associated with <strong>elevated serum amylase levels:</strong></p>\n<ul>\n<li>Burns</li>\n<li>Pregnancy</li>\n<li>Pancreatitis</li>\n<li><strong>Cholecystitis</strong></li>\n<li><strong>Diabetic ketoacidosis</strong></li>\n<li><strong>Ruptured ectopic pregnancy</strong></li>\n<li><strong>Aortic aneurysm</strong></li>\n<li>Renal failure</li>\n<li>Renal transplantation</li>\n<li>Chronic liver disease</li>\n<li><strong>Intestinal obstruction</strong></li>\n<li>Drugs like morphine</li>\n<li>Salivary gland involvement: mumps, calculus, maxillofacial surgery</li>\n<li>Tumors of the lungs, esophagus, breast, or ovary (LEBO)</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old woman presents with complaints of abdominal pain, bloody stools, and generalized muscle pain. Her blood pressure is 200/110 mmHg. She was diagnosed with polyarteritis nodosa (PAN). What are the histopathological changes seen on biopsy?",
    "choices": [
      {
        "id": 1,
        "text": "Fragmentation of the internal elastic lamina"
      },
      {
        "id": 2,
        "text": "Adventitial mononuclear infiltrates and intimal hyperplasia"
      },
      {
        "id": 3,
        "text": "Segmental transmural necrotizing inflammation with aneurysms"
      },
      {
        "id": 4,
        "text": "Segmental fibrinoid necrosis of the capillaries"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The histopathological changes seen on biopsy in PAN are <strong>segmental transmural necrotizing inflammation</strong> with<strong> aneurysms.</strong></p>\n<p><strong>Polyarteritis nodosa\u00a0</strong>(PAN) is a systemic vasculitis affecting the small-medium-sized arteries. PAN characteristically involves the <strong>renal</strong> and<strong> visceral</strong> vessels and <strong>spares</strong> the <strong>pulmonary vasculature</strong>.\u00a0There is <strong>no</strong> association with antineutrophilic cytoplasmic antibody (<strong>ANCA)</strong>, but a third of the patients are <strong>positive</strong> for <strong>hepatitis B</strong>.\u00a0</p>\n<div class=\"page\" title=\"Page 2628\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The<strong>\u00a0</strong>commonly\u00a0involved organs in PAN are the\u00a0<strong>kidney, heart, liver, and gastrointestinal tract</strong>. Inadequate perfusion results in ischemia, ulcerations, infarcts, or hemorrhage.</p>\n<p>It classically presents as <strong>rapidly accelerating hypertension, acute abdominal pain, bloody stools, diffuse myalgias, and motor peripheral neuropathy</strong>. The diagnosis is based on a biopsy showing\u00a0segmental necrotizing transmural inflammation of\u00a0small-medium-sized\u00a0arteries with aneurysms and thrombosis of the vessels involved, as shown below.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e172221e46cd4bada404ef5fa4f34f9ex720x552.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5e22688059bb4f6295fee60dc80a9f9bx720x855.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/319ee4f60268461ba9f29b158f2c6957x1280x950.JPEG"
    ]
  }
];
        let quizName = 'Acute Abdominal Pain Mini Test - -Tmt';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>