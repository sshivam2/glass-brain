<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet  Mini - 5 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "A 40-year-old lady presented with a midline thyroid swelling which has been gradually increasing in size for the last 3 years. On examination, a hard, solitary nodule with irregular borders was palpable. A fine-needle aspiration biopsy was performed and showed multiple layers of well-differentiated cuboidal epithelium covering the papillae and optically clear appearing cells without nuclei. Which gene mutation is not involved in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "RET"
      },
      {
        "id": 2,
        "text": "BRAF"
      },
      {
        "id": 3,
        "text": "NTRK1"
      },
      {
        "id": 4,
        "text": "TP53"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<div class=\"page\" title=\"Page 924\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The condition described here is <strong>papillary thyroid carcinoma</strong>, and it is <strong>not</strong> associated with mutations of the TP53 gene.\u00a0Mutations involving the inactivation of TP53 are restricted to anaplastic carcinomas and contribute to their aggressive behavior.</p>\n<p>The presence of empty appearing nuclei, also called\u00a0<strong>Orphan</strong>\u00a0<strong>Annie</strong>\u00a0<strong>eye</strong>\u00a0<strong>nuclei</strong>\u00a0as seen in the above image is diagnostic of\u00a0<strong>papillary</strong>\u00a0<strong>carcinoma of the thyroid.</strong></p>\n<p>Microscopic features of papillary thyroid carcinoma:</p>\n<ul>\n<li>The carcinoma shows\u00a0<strong>branching papillae</strong>\u00a0with fibrovascular stalk covered with simple or stratified cuboidal epithelium.</li>\n<li>On high power, the nuclei appear optically clear or empty as the\u00a0chromatin is dispersed. These empty appearing nuclei are called\u00a0<strong>Orphan Annie eye nuclei.</strong></li>\n<li>Concentric calcified structures called\u00a0<strong>psammoma</strong>\u00a0<strong>bodies</strong>\u00a0are usually seen.</li>\n<li>Foci of lymphatic invasion by the tumour are usually present.</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<p>Chromosomal rearrangements in papillary thyroid carcinoma include:</p>\n<ul>\n<li>Mutations involving <strong>RET</strong>\u00a0proto-oncogene: Results in<sup>\u00a0</sup>RET<em>\u00a0</em>fusion proteins RET/PTC which are involved in 40% of papillary thyroid carcinomas.\u00a0The frequency of RET/PTC rearrangements is significantly higher in cases with a history of radiation exposure.</li>\n<li>Mutations involving <strong>NTRK1:</strong>\u00a0These genetic events also produce constitutively active NTRK1 fusion proteins.\u00a0They\u00a0are present in 5% to 10% of papillary thyroid cancers.</li>\n<li><strong>BRAF: </strong>One-third to half of the papillary thyroid carcinomas involve a gain-of-function mutation in the BRAF gene. The presence of BRAF mutations in papillary carcinomas correlates with poorer prognostic factors like metastasis extrathyroidal extension.</li>\n</ul>\n<div class=\"page\" title=\"Page 1098\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>\u00a0</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/38a99789338946afb1978fd4262b41b4.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 6-year-old, otherwise healthy girl developed fever and a mild respiratory illness. A week later, a diffuse erythematous rash appeared on her face, as shown in the image below. The rash progressed to involve the trunk and extremities, sparing the palms and soles. Which is the true statement about the management of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Children with rash and arthropathy should be excluded from school till symptoms subside"
      },
      {
        "id": 2,
        "text": "Infected children with transient red cell aplasia should be given specific antiviral therapy"
      },
      {
        "id": 3,
        "text": "Infected children with transient red cell aplasia should be isolated during treatment"
      },
      {
        "id": 4,
        "text": "IVIG should be given as post exposure prophylaxis to infected children"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical vignette with fever, mild respiratory illness, and rash as described point to a diagnosis of&nbsp;<strong>erythema infectiosum (Fifth disease) </strong>caused by<strong> parvovirus B19</strong>, and infected children with red cell aplasia should be isolated during the treatment. The image shows the classical slapped cheek appearance.</p>\n<p>Children with B19-induced RBC aplasia have a <strong>higher viral load</strong> and are infectious on presentation. They usually require transfusions and supportive care. They should be isolated in the hospital during their treatment to prevent spread to susceptible patients and staff. Isolation should be continued for at least <strong>1 week and after resolution of fever.</strong></p>\n<p>Erythema infectiosum presents as a prodrome of low-grade fever, headache, and a mild upper respiratory tract infection after an incubation period of 4-28 days. A characteristic rash occurs in 3 stages:</p>\n<ul>\n<li>Erythematous facial flushing causing a slapped cheek appearance in the 1st stage</li>\n<li>Diffuse macular erythema spreads to the trunk and proximal extremities in the 2nd stage.</li>\n<li>Central clearing of the macular lesions, giving the rash a lacy, reticulated appearance in the 3rd stage.</li>\n</ul>\n<p>The rash is more prominent on extensor surfaces and spares the palms and soles. At this stage, affected children are afebrile and do not appear ill.&nbsp; Children with erythema infectiosum are not likely to be infectious at presentation. <strong>Isolation</strong> and exclusion from school are&nbsp;<strong>unnecessary</strong> and ineffective after diagnosis as&nbsp;the rash and arthropathy are immune-mediated, postinfectious phenomena.</p>\n<p>Complications of the disease include:</p>\n<ul>\n<li>Arthralgias or arthritis</li>\n<li>Transient Aplastic Crisis: A transient arrest of erythropoiesis and absolute reticulocytopenia in serum hemoglobin in individuals with chronic hemolytic conditions like sickle cell anemia</li>\n<li>Thrombocytopenic purpura</li>\n<li>Myocarditis</li>\n<li>A papular-purpuric &ldquo;gloves-and-socks&rdquo; syndrome&nbsp;</li>\n<li>Neurological: Aseptic meningitis, encephalitis, and peripheral neuropathy, stroke in children with sickle cell disease&nbsp;</li>\n<li>Infection-associated hemophagocytic syndrome in immunocompromised patients</li>\n<li>Maternal infection is associated with nonimmune fetal hydrops and intrauterine fetal demise</li>\n</ul>\n<p>There is no data to support the use of IVIG for postexposure prophylaxis, however, it has been used with some success to treat B19-related episodes of anemia and bone marrow failure in immunocompromised children. There is no specific antiviral therapy for B19 infection.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/ef757272336a43f28a6a45411fe3ac17.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "An elderly man presents with halitosis and regurgitation of food for the past 7 months. He mentions that he often feels like food is stuck in his throat. A barium swallow was performed and the findings are shown below. Which of the following procedures is used to treat this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Heller\u2019s myotomy"
      },
      {
        "id": 2,
        "text": "Dohlman procedure"
      },
      {
        "id": 3,
        "text": "Ramsted\u2019s pyloromyotomy"
      },
      {
        "id": 4,
        "text": "Nissen fundoplication"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">The given clinical scenario and barium swallow are suggestive of&nbsp;</span><strong><span data-preserver-spaces=\"true\">Zenker's diverticulum</span></strong><span data-preserver-spaces=\"true\">. The procedure used for the treatment of this condition is </span><strong><span data-preserver-spaces=\"true\">Dohlman's procedure</span></strong><span data-preserver-spaces=\"true\">.</span></p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">The pharyngeal pouch or&nbsp;</span><strong><span data-preserver-spaces=\"true\">Zenker's diverticulum</span></strong><span data-preserver-spaces=\"true\">&nbsp;is a protrusion of the mucosa through&nbsp;</span><strong><span data-preserver-spaces=\"true\">Killian's dehiscence&nbsp;</span></strong><span data-preserver-spaces=\"true\">a weak area of the posterior pharyngeal </span><span data-preserver-spaces=\"true\">wall between the oblique fibres of the thyropharyngeus and the transverse fibres of the cricopharyngeus. </span></p>\n<p style=\"text-align: left;\"><span data-preserver-spaces=\"true\">It presents at around 60 years of age and is more common in men than women. The patients usually experience&nbsp;</span><strong><span data-preserver-spaces=\"true\">regurgitation</span></strong><span data-preserver-spaces=\"true\">&nbsp;of foul-smelling, undigested food,<strong> halitosis</strong> and recurrent cough. The diagnosis is usually made by a&nbsp;</span><strong><span data-preserver-spaces=\"true\">lateral barium swallow</span></strong>.</p>\n<p><span data-preserver-spaces=\"true\">The treatment is either endoscopic or open surgery. The endoscopic treatment of Zenker's diverticulum is also called the&nbsp;</span><strong><span data-preserver-spaces=\"true\">Dohlman technique.&nbsp;</span></strong><span data-preserver-spaces=\"true\">It is a transoral endoscopic approach in which the septum between the diverticulum and the cervical esophagus is ablated using laser, electrocautery, or stapler devices. It can be used for diverticula between</span><strong><span data-preserver-spaces=\"true\">&nbsp;2 </span></strong>and<strong><span data-preserver-spaces=\"true\"> 5 cm</span></strong><span data-preserver-spaces=\"true\">&nbsp;in size.</span></p>\n<p style=\"text-align: justify;\"><span data-preserver-spaces=\"true\">Other options:</span></p>\n<p style=\"text-align: justify;\"><span data-preserver-spaces=\"true\">Option A: <strong>Heller myotomy</strong> is used for the treatment of <strong>achalasia cardia.</strong></span></p>\n<p style=\"text-align: justify;\"><span data-preserver-spaces=\"true\">Option C: <strong>Ramstedt's pyloromyotomy</strong> is used to treat infantile <strong>pyloric stenosis.</strong></span></p>\n<p style=\"text-align: justify;\">Option D: <strong>Nissen's fundoplication</strong> is used to treat <strong>gastroesophageal reflux disease</strong> (GERD) and <strong>hiatal hernia</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/58d2fcfef5ed44ebac1db70f29838657.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 58-year-old woman presents to the orthopedic OPD with an injury to her wrist after falling on an outstretched hand 2 days ago. She complains of pain in the radial aspect of her wrist. On examination, there is fullness and tenderness in the anatomic snuffbox. An X-ray was taken but it appeared to be normal.  In addition to the standard X-ray views used, which among the following can be used for further assessment of the suspected fracture?",
    "choices": [
      {
        "id": 1,
        "text": "Kelly view"
      },
      {
        "id": 2,
        "text": "Ziter view"
      },
      {
        "id": 3,
        "text": "Broden view"
      },
      {
        "id": 4,
        "text": "Ball catcher view"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario with fullness and tenderness in the anatomical snuffbox following a fall on outstretched hand is a case of <strong>scaphoid fracture</strong>, and the <strong>Ziter view</strong> is used for further assessment.</p>\n<p>Ziter view, also called <strong>banana view</strong> is a <strong>posteroanterior view</strong> of the wrist in <strong>ulnar deviation</strong> with <strong>20-degree tube angulation</strong> to the elbow. The X-ray beam will be at right angles to the long axis of the bone. It aids in the identification of scaphoid waist fractures. However, fractures that are oblique to the x-ray beam are not well identified.</p>\n<p>Four standard views used for assessment of scaphoid fractures are:</p>\n<ul>\n<li>Neutral posteroanterior (PA) view&nbsp;</li>\n<li>Neutral lateral view&nbsp;</li>\n<li>45-degree radial oblique view (semi supinated) - detects proximal pole fractures, humpback deformities, and avulsion fractures</li>\n<li>45-degree ulnar oblique view (semipronated) -&nbsp;Detects oblique sulcal, displaced waist fractures, and tubercle fractures</li>\n</ul>\n<p>Neutral PA and lateral views can determine carpal alignment and perilunate fracture-dislocations, but they are poor at fracture detection, especially with the tubercle overhang found on the neutral PA view.</p>\n<p>Soft tissue signs of a scaphoid fracture on plain X-rays include the <strong>scaphoid fat pad sign</strong> (obliteration or lateral displacement of the normal scaphoid fat pad) and the<strong> pronator fat pad/stripe sign</strong> (prominent fat pad of pronator quadrates over the volar aspect of the wrist)</p>\n<p>If the initial X-rays appear normal, treat the clinical diagnosis and immobilize the wrist in a cast. Repeat X-rays may be needed after 2 weeks (and sometimes even later) before the fracture line shows.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dcd57b647c0f4e3988794926aeae1a4cx1280x1114.JPEG"
    ]
  },
  {
    "text": "A 37-year-old woman undergoing surgery was intubated after administering rocuronium for neuromuscular blockade. Before anesthesia induction, a mechanosensor was incorporated with electrodes, as shown in the image below. The contraction of which muscle does it assess to monitor neuromuscular activity?",
    "choices": [
      {
        "id": 1,
        "text": "Adductor pollicis"
      },
      {
        "id": 2,
        "text": "Flexor pollicis brevis"
      },
      {
        "id": 3,
        "text": "Palmaris brevis"
      },
      {
        "id": 4,
        "text": "Flexor carpi ulnaris"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<div class=\"page\" title=\"Page 1876\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The <strong>mechanosensor</strong> with <strong>electrodes</strong> is placed over the region of the\u00a0<strong>ulnar nerve</strong>, thus assessing the contraction of the\u00a0<strong>adductor pollicis</strong> muscle to monitor neuromuscular activity.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"page\" title=\"Page 567\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Monitoring of neuromuscular blockade is required to <strong>monitor the blockade intraoperatively</strong>,\u00a0ensure its complete reversal postoperatively, and <strong>prevent residual blockade</strong>. To monitor the neuromuscular function, a peripheral motor nerve is supramaximally stimulated and the response of the muscle is assessed.</p>\n<p>The most commonly assessed nerve-muscle unit is the\u00a0<strong>ulnar nerve-adductor pollicis muscle</strong>. This is because it is easily accessible, has the lowest risk of direct muscle stimulation, and the response can be evaluated tactilely, visually, or by objective methods.\u00a0To stimulate the ulnar nerve, the electrodes are best applied to the <strong>volar</strong> <strong>aspect</strong> of the wrist.</p>\n<p>Other nerve-muscle units that can be assessed include:</p>\n<ul>\n<li><strong>Posterior tibial </strong>nerve-<strong>flexor hallucis brevis</strong> muscle</li>\n<li>Facial nerve-orbicularis oculi muscle</li>\n<li>Facial nerve-corrugator supercilii muscle</li>\n</ul>\n<p>Many methods can be used for objective monitoring of neuromuscular function:</p>\n<ul>\n<li>Mechanomyography (MMG)</li>\n<li>Electromyography (EMG)</li>\n<li>Acceleration of the muscle response (AMG)</li>\n<li>Kinemyography (KMG)</li>\n<li>Cuff pressure modality (CPM)</li>\n<li>Compressomyography (CMG)</li>\n<li>Phonomyography (PMG)</li>\n</ul>\n<p>The image shows <strong>AMG</strong>, which is based on Newton\u2019s second law: force = mass \u00d7 acceleration. It measures the <strong>isotonic acceleration</strong> of the stimulated muscle.\u00a0</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/64f7a21583904b528646b3b455c1140a.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 2-year-old female child, who appeared normal at birth was brought to the OPD when the parents noticed dryness of the skin with scaly lesions on the child\u2019s body. They mention that skin lesions improve when the weather is more humid. On examination, you notice scaling as shown in the image below, present on the extensor surfaces of the body, sparing the groin and large flexures. Identify the true statement(s) about the condition.",
    "choices": [
      {
        "id": 1,
        "text": "2, 4, 5"
      },
      {
        "id": 2,
        "text": "1, 2, 5"
      },
      {
        "id": 3,
        "text": "1, 3, 5"
      },
      {
        "id": 4,
        "text": "3, 4 and 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical scenario and image point to a diagnosis of&nbsp;<strong>ichthyosis vulgaris </strong>and statements 2, 4, and 5 are true about this condition.</p>\n<p>Ichthyosis Vulgaris is a mild scaling disorder characterized by the presence of excessive amounts of dry thickened scaly skin. It is due to <strong>filaggrin mutations (FLG)</strong>, which are inherited as an <strong>autosomal semi-dominant trait</strong> and immunohistological studies show an <strong>absent or markedly reduced filaggrin</strong> signal.</p>\n<p>Ichthyosis Vulgaris is <strong>not present at birth</strong> but develops during the first months of life. Patients present with light grey fish-like scales mainly on the <strong>extensor surfaces</strong> and the trunk, sparing the groin and larger flexural surfaces. The <strong>palmar and plantar creases</strong> are frequently <strong>accentuated</strong> in this condition.</p>\n<p>Patients benefit from ointments that hydrate the stratum corneum. Creams containing glycerol, urea, or lactic acid work well in this condition.&nbsp;</p>\n<p>Other options: A&nbsp;<strong>recessive X\u2010linked ichthyosis</strong> (RXLI) is caused by mutations in the <strong>STS gene</strong> leading to deficiency of <strong>steroid sulfatase.</strong>&nbsp;It usually presents <strong>before 3 months</strong> of age with large thick <strong>dark brown to yellow\u2010brown hyperkeratoses</strong> covering the trunk, the extremities, and the neck. Flexural surfaces, palms, and soles are spared.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/c4f95a4e92654199be51173c58122e9d.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient experienced chest tightness, and breathlessness after going on a pilgrimage site which was at an altitude of 3574 m above sea level. He had ascended to that height in one day. During the initial period of acclimatization period, which of the following changes is most likely to occur?",
    "choices": [
      {
        "id": 1,
        "text": "Respiratory alkalosis"
      },
      {
        "id": 2,
        "text": "Decreased sympathetic tone"
      },
      {
        "id": 3,
        "text": "Decreased erythropoietin levels"
      },
      {
        "id": 4,
        "text": "Shift of the O2-Hb dissociation curve to the right"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>During the <strong>initial process</strong> of <strong>acclimatization</strong> to high altitudes, <strong>respiratory alkalosis</strong> occurs as a result of <strong>hyperventilation</strong>.&nbsp;</p>\n<p>The symptoms of chest tightness and breathlessness following rapid ascent indicate <strong>acute mountain/altitude sickness</strong>, which can be prevented by <strong>gradual ascent</strong> with sufficient time for acclimatization.</p>\n<p>Following are the <strong>physiological</strong> <strong>changes</strong> that occur during acclimatization:</p>\n<ul>\n<li>Immediate exposure to low PO<sub>2</sub>&nbsp;at higher altitudes stimulates the arterial chemoreceptors, and this stimulation&nbsp;<strong>increases alveolar ventilation </strong>(<strong>hyperventilation</strong>).<strong>&nbsp;</strong>This immediate increase in pulmonary ventilation upon rising to a high altitude blows off large quantities of CO<sub>2</sub>, reducing the PCO<sub>2</sub> and&nbsp;increasing the pH&nbsp;of the body fluids causing&nbsp;respiratory alkalosis. The <strong>initial</strong> state of <strong>alkalosis</strong>&nbsp;shifts the&nbsp;<strong>oxygen&ndash;hemoglobin dissociation curve</strong> to the <strong>left,&nbsp;</strong>which in&nbsp;<strong>later stages</strong>&nbsp;of acclimatization shifts to <strong>right</strong> due to <strong>increased 2,3 - DPG.</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Increased erythropoietin</strong> secretion, leading to an increase in circulating red blood cells</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased number of mitochondria</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased myoglobin to facilitate the movement of O<sub>2</sub> into the tissues</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Increased tissue cytochrome oxidase</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Increased sympathetic tone</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Renal suppression of carbonic anhydrase and excretion of dilute alkaline urine brings the pH of the blood to normal</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">Decreased maximal exercise capacity (by ~1% for every 100 m gained above 1500 m)&nbsp;</li>\n</ul>\n<p>On the ascent to high altitudes, the low partial pressure of oxygen leads to hypoxia and systemic arteriolar dilatation. Consequently, the capillary pressure rises with increased transudation of fluid into the brain tissue, and the following symptoms are seen:</p>\n<ul>\n<li>Headache</li>\n<li>Irritation</li>\n<li>Insomnia</li>\n<li>Breathlessness</li>\n<li>Nausea and vomiting</li>\n</ul>\n<p><strong>Treatment</strong> involves the administration of <strong>oxygen, descent</strong> to a lower altitude, and administration of<strong> acetazolamide</strong>. Acetazolamide counteracts hypoxia by stimulating respiration and also reduces the formation of cerebrospinal fluid, thereby reducing intracranial tension.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old female patient presented with fever, productive cough, and night sweats of 3 weeks duration. A history of contact with a TB patient is present. CBNAAT confirms the diagnosis on the sputum sample. Drug susceptibility shows Rifampicin resistance. Bedaquiline based regimen is started as per recent NTEP guidelines. Given below are five statements with regards to Bedaquiline. Which among the given statements is/are false about the drug?",
    "choices": [
      {
        "id": 1,
        "text": "1 and 3"
      },
      {
        "id": 2,
        "text": "2 and 4"
      },
      {
        "id": 3,
        "text": "1 and 5"
      },
      {
        "id": 4,
        "text": "3 and 5"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><span data-preserver-spaces=\"true\">The incorrect statements is</span><strong><span data-preserver-spaces=\"true\">\u00a01 and 3. </span></strong>Bedaquiline is bactericidal and has a poor CNS penetration.\u00a0</p>\n<p><strong>Bedaquiline:</strong></p>\n<p><span data-preserver-spaces=\"true\">Bedaquiline is one of the recent drugs approved for the treatment of <strong>MDR/ XDR TB</strong>. </span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">It is a <strong>bactericidal</strong> agent and acts by inhibiting the proton pump activity of the\u00a0<strong>Mycobacterial 5' ATP synthase</strong> enzyme. </span></li>\n<li><span data-preserver-spaces=\"true\">It has a great volume of distribution and is <strong>lipid-soluble</strong>. High-fat food increases its absorption. </span></li>\n<li><span data-preserver-spaces=\"true\">It has very <strong>poor CNS penetration</strong>. </span></li>\n<li><span data-preserver-spaces=\"true\">It is principally metabolized by the<strong> CYP3A4</strong> enzyme system and is eliminated by the fecal route. </span></li>\n<li><span data-preserver-spaces=\"true\">The most common side effect of the drug is GI disturbance (nausea) while the most fatal, for which a<strong> black-box warning</strong> was issued by US-FDA is <strong>QTc prolongation </strong>and<strong>\u00a0</strong>should be used with caution with people having cardiac conduction anomalies. It is hepatotoxic and may cause hyperuricemia.</span></li>\n<li><span data-preserver-spaces=\"true\">Resistance to this drug is mediated by a two-point mutation of <strong>D32V and A63P genes</strong>. <strong>Cross-resistance</strong> is seen with <strong>Clofazimine</strong> due to mutation of the <strong>efflux pump MmpL</strong>.\u00a0</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A multiparous non-lactating obese lady seeks contraception advice. She has deranged blood glucose levels from her last pregnancy. She had an ectopic pregnancy 3 years back. Which oral contraceptive pill is best suited for her?",
    "choices": [
      {
        "id": 1,
        "text": "Mini pills"
      },
      {
        "id": 2,
        "text": "Progesterone-Only-Pills"
      },
      {
        "id": 3,
        "text": "Triphasic Combined Oral Contraceptives"
      },
      {
        "id": 4,
        "text": "Monophasic Combined Oral Contraceptives"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The oral contraceptive pill best suited for this patient is a<strong>\u00a0triphasic combined oral contraceptive pill (OCP). </strong>It\u00a0has no adverse effect on carbohydrate and lipid metabolism and has a <strong>good safety profile</strong> in <strong>diabetic</strong> women.\u00a0</p>\n<p>Triphasic combined oral contraceptive pills are those with estrogen and progesterone <strong>dosages varying</strong> in three different phases of the same cycle.\u00a0</p>\n<p>These are preparations of <strong>Ethinyl estradiol</strong> (EE2) and <strong>levonorgestrel</strong> (LNG) given as<strong> 3 phases</strong> in a menstrual cycle with different dosages-\u00a0</p>\n<ul>\n<li>First 6 days- 30mcg EE2 + 50mcg LNG</li>\n<li>Next 5 days- 40mcg EE2 + 75mcg LNG</li>\n<li>For the next 10 days- 30mcg EE2 + 125mcg LNG\u00a0</li>\n<li>Followed by a 1-week drug-free interval\u00a0</li>\n</ul>\n<p>These triphasic OCPs can be safely used in those at risk of myocardial infarction. These are<strong> as effective </strong>as <strong>monophasic pills\u00a0</strong>but are not used in cases with menorrhagia.</p>\n<div class=\"page\" title=\"Page 149\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>During contraceptive use, if<strong> one dose</strong> is missed, that day\u2019s pill plus the missed pill should be taken as soon as remembered and the remaining pack is then completed as usual. If <strong>several doses</strong> are missed, then two pills are taken with an <strong>additional effective barrier technique</strong> for the next 7 days or a new pack can be started with an additional barrier method.</p>\n<p>Other options:</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Progesterone-only pills</strong>\u00a0/<strong>mini-pills</strong> can be given for diabetes, but the <strong>failure rate</strong> is higher in <strong>obese</strong> women. There is a high risk of <strong>ectopic pregnancy</strong> (up to 10% of pregnancies reported in clinical studies) in progestin-only oral contraceptive users. Since this woman already has a history of ectopic, this may not be a preferable method.\u00a0</p>\n<p><strong>Monophasic pills</strong> comprise a <strong>constant dose</strong> of progestin and estrogen throughout the cycle. It causes derangement of lipid and carbohydrate metabolism and thus is <strong>contraindicated</strong> in <strong>diabetes mellitus.\u00a0</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old woman with immune thrombocytopenic purpura is undergoing elective splenectomy. During the procedure, injury to which of the following ligaments can lead to a complication of pancreatitis?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrosplenic ligament"
      },
      {
        "id": 2,
        "text": "Splenocolic ligament"
      },
      {
        "id": 3,
        "text": "Splenorenal ligament"
      },
      {
        "id": 4,
        "text": "Splenophrenic ligament"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Injury to the <strong>splenorenal ligament\u00a0</strong>during splenectomy can lead to pancreatitis as it contains the <strong>tail of pancreas</strong>.<strong> </strong>Other complications include <strong>bleeding</strong> and <strong>pancreatic fistula</strong> formation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4a57d6a911974d4fa1af0f5d46b80d39x1280x1550.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/837fd93282b149eca5d99c5d23bbed47x1280x1609.JPEG"
    ]
  },
  {
    "text": "A 13-year-old boy presented with right hip pain. On examination, his BMI is 29 and there is a shortening of the limb with limitation of abduction, flexion, and internal rotation. Which among the following lines is drawn on the X-ray for the diagnosis of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "2 - Red line"
      },
      {
        "id": 2,
        "text": "3 - Green line"
      },
      {
        "id": 3,
        "text": "4- Blue line"
      },
      {
        "id": 4,
        "text": "1- Yellow line"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The condition described is <strong>slipped capital femoral epiphysis (SCFE)</strong> and the line used to diagnose it is <strong>Klein\u2019s line</strong> - marked in green. </span></p>\n<p><span data-preserver-spaces=\"true\">Klein's line is a line drawn on the A-P view or frog lateral view of the hip X-ray along the superior border of the neck of the femur. Failure of Klein\u2019s line to intersect with the epiphysis results in a <strong>positive Trethowan sign</strong>- seen in SCFE.</span><span data-preserver-spaces=\"true\"> Klein\u2019s line is less sensitive for diagnosis in the pre-slip stage.</span></p>\n<p><span data-preserver-spaces=\"true\">A modification of this measurement is that if the maximal width of the epiphysis lateral to Klein's line is 2 mm or more than that in the contralateral hip, it is considered as a slip.</span></p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e03631e4d2cc40feadd8f9f60c967a9e.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eb806a1137c9410eab09d552d9501baax934x704.JPEG"
    ]
  },
  {
    "text": "Given below are five statements regarding the process of glycogen synthesis and glycogenolysis. Which of the following statements are not correct?",
    "choices": [
      {
        "id": 1,
        "text": "1, 3 and 5"
      },
      {
        "id": 2,
        "text": "2, 4, and 5"
      },
      {
        "id": 3,
        "text": "2 and 4 only."
      },
      {
        "id": 4,
        "text": "1 and 3 only."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The incorrect statements are 2 and 4 only. In liver, epinephrine promotes&nbsp;</span><strong><span data-preserver-spaces=\"true\">cAMP-independent</span></strong><span data-preserver-spaces=\"true\">&nbsp;glycogenolysis and Nor-epinephrine</span><strong><span data-preserver-spaces=\"true\">&nbsp;promotes&nbsp;</span></strong><span data-preserver-spaces=\"true\">the breakdown of glycogen</span><strong><span data-preserver-spaces=\"true\">.&nbsp;</span></strong></p>\n<div>cAMP-independent glycogenolysis is also activated by nor-epinephrine, vasopressin, oxytocin, and angiotensin II.</div>\n<p>Other statements:</p>\n<p>Statement 1:<strong><span data-preserver-spaces=\"true\"> Phosphoglucomutase </span></strong><span data-preserver-spaces=\"true\">is involved in&nbsp;</span><strong><span data-preserver-spaces=\"true\">both glycogenesis &amp; glycogenolysis.&nbsp;</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Statements 3:&nbsp;The activities of the enzymes glycogen synthase and glycogen phosphorylase are reciprocally regulated<strong>.</strong>&nbsp;Both<strong>&nbsp;</strong>phosphorylase and glycogen synthase exists in both phosphorylated and nonphosphorylated states, and the effect of phosphorylation seen in glycogen synthase is the reverse of that seen in glycogen phosphorylase. <strong>Phosphorylation</strong> <strong>activates glycogen phosphorylase</strong> whereas <strong>inactivates glycogen synthase.</strong></span></p>\n<p>Statement 5: <strong><span data-preserver-spaces=\"true\">Low-insulin/glucagon ratio </span></strong>indicates low insulin and high glucagon levels, which are observed in the <strong><span data-preserver-spaces=\"true\">fasting state. </span>G</strong><span data-preserver-spaces=\"true\"><strong>lucagon</strong> mediates phosphorylation of glycogen phosphorylase and glycogen synthase. Phosphorylation <strong>activates phosphorylase</strong> and deactivates synthase.&nbsp;</span>Hence <strong>glycogenolysis</strong> is increased in fasting states.&nbsp;<span data-preserver-spaces=\"true\"><strong>Glycogen</strong>&nbsp;<strong>synthesis</strong>&nbsp;occurs in the liver and skeletal muscle, in the fed state, under the effect of<strong>&nbsp;insulin.</strong></span></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young man met with a bike accident. He lost all his motor, sensory, and autonomic functions of the spinal cord below the level of the lesion. However, vibration and position sensations are preserved. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Central cord syndrome"
      },
      {
        "id": 2,
        "text": "Anterior spinal artery syndrome"
      },
      {
        "id": 3,
        "text": "Foramen Magnum syndrome"
      },
      {
        "id": 4,
        "text": "Brown-S\u00e9quard syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<div class=\"page\" title=\"Page 3564\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The probable diagnosis of the patient is\u00a0<strong>Anterior spinal artery (ASA) syndrome.\u00a0</strong></p>\n<p><strong>ASA infarct</strong> typically presents as loss of motor function and\u00a0<span class=\"nowrap\">pain/temperature</span>\u00a0sensation, with <strong>relative sparing of proprioception </strong>and <strong>vibratory</strong> <strong>sense</strong> below the level of the lesion. Since the <strong>dorsal</strong> column is located in the <strong>posterior</strong> or <strong>dorsal</strong> <strong>aspect</strong> of the spinal cord, it is <strong>spared</strong>.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/630f2145c3d8493cb318ddb82937b538x536x938.PNG"
    ]
  },
  {
    "text": "A third-year medical student was asked the draw the Ohngren\u2019s line. The line drawn by him is as shown in the below image(dotted line) where \"A\" and \"B\"  represents maxillary tumour growth\nbelow and above the Ohngren\u2019s line. Which of the following option is true regarding the prognosis of maxillary tumour?",
    "choices": [
      {
        "id": 1,
        "text": "Both A and B has poor prognosis"
      },
      {
        "id": 2,
        "text": "Both A and B has Good prognosis"
      },
      {
        "id": 3,
        "text": "A has Poor prognosis and B has Good prognosis"
      },
      {
        "id": 4,
        "text": "A has Good prognosis and B has Poor prognosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>\"A\" has Good prognosis and \"B\" has Poor prognosis is the true statement.</p>\n<p><strong>Ohngren&rsquo;s line</strong> is an<strong> imaginary line</strong> passing through <strong>medial canthus of eye </strong>and <strong>angle of mandible</strong>.</p>\n<p>It is used for <strong>classification of maxillary carcinoma.</strong></p>\n<ul>\n<li>Growth situated <strong>above</strong> the plane - Suprastructure<strong> - Poor Prognosis</strong></li>\n<li>Growth situated <strong>below</strong> the plane - Infrastructure<strong> - Good Prognosis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9e720cc6b75443dcb7155e1f0b51b4e4.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A study was conducted in which 10,000 women participated in the cervical smear tests. 1,500 had positive smears, of which 1000 later tested positive with the gold standard biopsy test. 50 women who had a negative smear also tested positive on biopsy. What is the best term that can describe these 50 women cases?",
    "choices": [
      {
        "id": 1,
        "text": "False positives"
      },
      {
        "id": 2,
        "text": "True positives"
      },
      {
        "id": 3,
        "text": "False negatives"
      },
      {
        "id": 4,
        "text": "True negatives"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><span data-preserver-spaces=\"true\">The women who tested positive on biopsy(the gold standard), but identified as negative by the cervical smear (screening test) are</span><strong><span data-preserver-spaces=\"true\">&nbsp;False-negatives,&nbsp;</span></strong>i.e.<strong><span data-preserver-spaces=\"true\">&nbsp;</span></strong><span data-preserver-spaces=\"true\">they are sick identified wrongly as healthy.</span></p>\n<p><span data-preserver-spaces=\"true\">The number of cases identified correctly as sick -&nbsp;</span><strong><span data-preserver-spaces=\"true\">True positive</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Healthy cases identified as healthy -&nbsp;</span><strong><span data-preserver-spaces=\"true\">True negative&nbsp;</span></strong></p>\n<p><span data-preserver-spaces=\"true\">Healthy cases identified as sick -</span><strong><span data-preserver-spaces=\"true\">&nbsp;False positive</span></strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A male patient came to the dermatology clinic with complaints of brittle beard hair with the presence of soft, white nodules loosely adherent along the hair shaft. Pruritus is absent. What is the most probable causative agent?",
    "choices": [
      {
        "id": 1,
        "text": "Trichosporon beigelii"
      },
      {
        "id": 2,
        "text": "Hortaea werneckii"
      },
      {
        "id": 3,
        "text": "Piedraia hortae"
      },
      {
        "id": 4,
        "text": "Malassezia furfur"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The presence of brittle beard hair with the presence of soft, white nodules loosely adherent along the hair shaft is suggestive of <strong>white\u00a0piedra\u00a0</strong>and\u00a0the causative agent is <em><strong>Trichosporon beigelii.</strong></em></p>\n<p>Piedra is a superficial fungal infection of the hair shaft. It is of\u00a0two types:\u00a0<strong>white piedra</strong>\u00a0and<strong>\u00a0black piedra.</strong>\u00a0</p>\n<p>White piedra is caused by <em>Trichosporon beigelii. </em>It is<em>\u00a0</em>characterized by the presence of <strong>soft, white</strong>, or light brown transparent <strong>nodules</strong> that are easily detached from the hair. It affects pubic and <strong>facial hair</strong> more commonly than scalp hair. It is<strong>\u00a0</strong>seen in the culture as <strong>nodules</strong> in the form of a sheath extending around the hair shaft. Arthroconidia and blastoconidia are seen.</p>\n<p>Black piedra\u00a0is characterized by the presence of firmly adherent, black, gritty, hard nodules along the hair shaft. Scalp hair is most often affected. It is\u00a0caused by\u00a0<strong>Piedraia hortae </strong>(option C). On microscopy, they appear as <strong>brown, thick-walled </strong>with<strong> septate hyphae</strong> and chlamydoconidia.</p>\n<p>Shaving or cutting off the affected hair is useful in managing both black and white piedra. In black piedra, topical benzoic acid and terbinafine is helpful while topical antifungals, azoles, and allylamines can be useful in white piedra.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d5f2bbf0e2d945828c6c79496af906fex1280x1280.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6203193f24a2449c8087510638183378x1280x1280.JPEG"
    ]
  },
  {
    "text": "A 32-year-old woman working in a night-shift call center presents with complaints of generalized weakness and fatigue for the past 3 months that has progressively become worse. She says it gets worse towards the morning, and she feels better in the evenings after a period of rest. She has unilateral ptosis with hypotropia in the right eye. Following evaluation, she is started on tablet edrophonium for the treatment of her condition.  Which of the following autoantibody is not associated with her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-AChR"
      },
      {
        "id": 2,
        "text": "Anti-MuSK"
      },
      {
        "id": 3,
        "text": "Anti-LRP4"
      },
      {
        "id": 4,
        "text": "Anti-C1q"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong><span data-preserver-spaces=\"true\">Anti-C1q antibodies</span></strong><span data-preserver-spaces=\"true\">\u00a0are associated with systemic lupus erythematosus (SLE) and membrane proliferative glomerulonephritis (MPGN) but\u00a0</span><strong><span data-preserver-spaces=\"true\">not</span></strong><span data-preserver-spaces=\"true\">\u00a0with\u00a0</span><strong><span data-preserver-spaces=\"true\">myasthenia gravis.</span></strong></p>\n<p><span data-preserver-spaces=\"true\">The patient experiences generalized weakness, which progresses and becomes worse after exertion. The presence of unilateral ptosis with hypotropia in the right eye along with generalized weakness is suggestive of a diagnosis of myasthenia gravis.</span></p>\n<p><span data-preserver-spaces=\"true\">Treatment for myasthenia gravis involves:</span></p>\n<ul>\n<li><strong><span data-preserver-spaces=\"true\">Symptomatic treatment</span></strong><span data-preserver-spaces=\"true\">: Anticholinesterase agents\u2013</span><strong><span data-preserver-spaces=\"true\">Pyridostigmine</span></strong><span data-preserver-spaces=\"true\">\u00a0is the\u00a0</span><strong><span data-preserver-spaces=\"true\">initial therapy of choice</span></strong><span data-preserver-spaces=\"true\">.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Chronic immunomodulating therapy</span></strong><span data-preserver-spaces=\"true\">: Glucocorticoids (</span><strong><span data-preserver-spaces=\"true\">prednisone</span></strong><span data-preserver-spaces=\"true\">) and immunosuppressive drugs (azathioprine, mycophenolate mofetil, cyclosporine) implemented in patients significantly symptomatic on pyridostigmine.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Rapid immunomodulating treatment</span></strong><span data-preserver-spaces=\"true\">: IVIG and therapeutic plasma exchange\u2014Used to tide over severe illness (myasthenic crisis) and as 'bridge' therapy before surgery, or starting chronic immunomodulating treatment.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Surgical approach</span></strong><span data-preserver-spaces=\"true\">: Thymectomy</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">Preferred drug for\u00a0</span><strong><span data-preserver-spaces=\"true\">diagnosis</span></strong><span data-preserver-spaces=\"true\">:\u00a0</span><strong><span data-preserver-spaces=\"true\">Edrophonium</span></strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following condition commonly has an appearance of watered silk on fundoscopy?",
    "choices": [
      {
        "id": 1,
        "text": "Myopia"
      },
      {
        "id": 2,
        "text": "Hypermetropia"
      },
      {
        "id": 3,
        "text": "Squint"
      },
      {
        "id": 4,
        "text": "Presbyopia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">On fundus examination,</span><strong><span data-preserver-spaces=\"true\">&nbsp;the Hypermetropic eye</span></strong><span data-preserver-spaces=\"true\">&nbsp;has a bright reflex suggesting the appearance of watered silk.</span></p>\n<p><span data-preserver-spaces=\"true\">Signs of hypermetropia include the following:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\">Size of the eyeball:&nbsp;</span><strong><span data-preserver-spaces=\"true\">small</span></strong><span data-preserver-spaces=\"true\">.</span></li>\n<li><span data-preserver-spaces=\"true\">The cornea may be slightly smaller.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">Short</span></strong><span data-preserver-spaces=\"true\">&nbsp;anteroposterior length of the eyeball.</span></li>\n<li><span data-preserver-spaces=\"true\">Fundus picture:</span></li>\n<ul>\n<li class=\"ql-indent-1\"><strong><span data-preserver-spaces=\"true\">Pseudopapillitis -&nbsp;</span></strong><span data-preserver-spaces=\"true\">characterized by a&nbsp;</span><strong><span data-preserver-spaces=\"true\">small optic disc, hypervascular,</span></strong><span data-preserver-spaces=\"true\">&nbsp;with ill-defined margins and without disc edema</span></li>\n<li class=\"ql-indent-1\"><strong><span data-preserver-spaces=\"true\">Watered silk appearance -&nbsp;</span></strong><span data-preserver-spaces=\"true\">The retina, as a whole, may shine due to the greater brilliance of light reflections.</span></li>\n</ul>\n</ul>\n<p><strong>The convex lens</strong> (<strong>plus</strong> lens) is used for the correction&nbsp;of hypermetropia.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/b3003843ee294308bdb1cf5797fa3e7cx391x312.PNG"
    ]
  },
  {
    "text": "A 24-year-old woman is brought to the emergency department after a violent attack. The patient has injuries over her forearm and elbow. On examination, she has injuries over her breasts and inner thighs. Pelvic examination reveals lacerations in the vaginal mucosa. On enquiring about the injuries, the patient is unable to remember the violent incident. Which of the following defense mechanism best explains this phenomenon?",
    "choices": [
      {
        "id": 1,
        "text": "Repression"
      },
      {
        "id": 2,
        "text": "Suppression"
      },
      {
        "id": 3,
        "text": "Denial"
      },
      {
        "id": 4,
        "text": "Blocking"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's history and examination are suggestive of rape, and the patient is <strong>repressing</strong> the memory of the incident as a means of coping with the anxiety.</p>\n<p><strong>Repression</strong> is a type of psychological defense mechanism that involves keeping certain thoughts, feelings, or urges out of conscious awareness. The goal of this form of defense is to keep unacceptable desires or thoughts out of the conscious mind in order to <strong>prevent</strong> or <strong>minimize</strong> feelings of <strong>anxiety.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which among the following is the active principle present in the dried fruit shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Calotropin"
      },
      {
        "id": 2,
        "text": "Semicarpol"
      },
      {
        "id": 3,
        "text": "Abrin"
      },
      {
        "id": 4,
        "text": "Ricin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows the<strong>&nbsp;seeds</strong>&nbsp;of&nbsp;<em><strong>Semecarpus anacardium</strong></em>, and its active principles are <strong>semicarpol </strong>and <strong>bhilawanol.</strong></p>\n<p><strong>Common names&nbsp;</strong>are<strong>&nbsp;</strong>marking nut,&nbsp;<strong>bhilwan</strong>, bibva, bhela, and oriental cashew.</p>\n<p>The juice&nbsp;when applied&nbsp;<strong>locally</strong>&nbsp;to the skin produces irritation,<strong>&nbsp;painful blisters,&nbsp;</strong>itching, and eczematous eruption. The&nbsp;seeds are used to produce an&nbsp;<strong>artificial bruise</strong>. Symptoms such as pain, fever, and painful passage of&nbsp;<strong>brownish urine&nbsp;</strong>may be seen.</p>\n<p>A large dose taken orally can produce blisters in the mouth and throat, with gastroenteritis. It also produces dyspnea, cyanosis, tachycardia, coma, and death. The<strong>&nbsp;fatal&nbsp;period&nbsp;</strong>is<strong>&nbsp;</strong><strong>12 to 24 hours</strong>.</p>\n<p><strong>Medicolegal importance&nbsp;</strong>is the use of&nbsp;the juice by malingerers&nbsp;to&nbsp;<strong>fabricate wounds.&nbsp;</strong>Instilled in the eyes it can cause<strong>&nbsp;conjunctivitis&nbsp;</strong>or<strong>&nbsp;ophthalmia&nbsp;</strong>due to its local irritant effect.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cdebaef4e68a4367a697fdb87b4e99bf.JPEG"
    ],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/0414f02227364a42aca943f79a834f56x705x491.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/70f4806c504a49b886cb7794ba407ed8x991x742.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5b041271ef4d438daa89a38de2fc0808x640x509.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3f8117410e1f4947a1bed88f4f3c5d17x640x640.PNG"
    ]
  }
];
        let quizName = 'Neet  Mini - 5 (20 Q)';
        const quizFilename = 'neet-mini-5-20-q-b454712b.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>