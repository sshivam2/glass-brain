<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ini-Cet  Mini - 9 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Arrange the following in the correct sequence of completion of events after transection of a nerve -",
    "choices": [
      {
        "id": 1,
        "text": "1-2-3-4"
      },
      {
        "id": 2,
        "text": "4-3-2-1"
      },
      {
        "id": 3,
        "text": "3-2-1-4"
      },
      {
        "id": 4,
        "text": "1-4-3-2"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Among the given options, the correct sequence is <strong>1-2-3-4</strong>&nbsp;(option A)</p>\n<p>Wallerian degeneration&nbsp;is a type of <strong>orthograde</strong> <strong>degeneration</strong> triggered by an injury to the axon. These changes occur <strong>from the point of injury</strong> in the neuron&nbsp;and <strong>move towards the nerve terminal</strong>, thereby interrupting the functional neural transmission.&nbsp;</p>\n<p>The sequence of changes that occur:</p>\n<ul>\n<li>Myelin sheath degeneration distal to the injury.</li>\n<li>Proximal axon degeneration (retrograde - from the axon to the cell body)</li>\n<li><strong>Chromatolysis reaction-&nbsp;</strong>Swelling of the cell body, eccentrically placed nucleus, and fragmentation of the rough endoplasmic reticulum</li>\n<li><strong>Regenerative sprouting</strong> - neurons regrow projecting multiple small, branches.&nbsp;</li>\n<li>Sometimes when a motor nerve is injured, there is a marked proliferation of the nicotinic receptors making them extremely sensitive. This is known as<strong> denervation hypersensitivity.&nbsp;</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc57d8758ede4e1da2f332be26ab6755x1280x2040.JPEG"
    ]
  },
  {
    "text": "During your internship, you observe a resident doctor examining the thyroid gland using the method shown in the video below. Identify the method.",
    "choices": [
      {
        "id": 1,
        "text": "Crile's method"
      },
      {
        "id": 2,
        "text": "Lahey's method"
      },
      {
        "id": 3,
        "text": "Kocher's method"
      },
      {
        "id": 4,
        "text": "Pizillo's method"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above video shows<strong> Crile's method</strong> of thyroid palpation.</p>\n<p><strong>Crile's Method</strong>: The patient is asked to swallow while palpating the gland with the thumb. This method helps to identify mild enlargements and for detecting the presence of nodules.</p>\n<p>Other options:</p>\n<p>Option B: <strong>Lahey's Method</strong>: The lobes are pushed to one side for palpation. For palpating the left lobe, the examiner should push the lobe laterally with the left hand and the lobe is palpated with the right hand.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1ed731664e614f178524bbf5655f2e59.GIF"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25d353c14baf429da355eb42b6d6cb6dx720x1012.GIF"
    ]
  },
  {
    "text": "The structure marked by the red arrow arises from",
    "choices": [
      {
        "id": 1,
        "text": "Lateral Cord"
      },
      {
        "id": 2,
        "text": "Medial Cord"
      },
      {
        "id": 3,
        "text": "Posterior cord"
      },
      {
        "id": 4,
        "text": "Trunk"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The marked structure is the <strong>musculocutaneous nerve</strong>. Its root value is C5, C6, C7 and it arises<strong> from the lateral cord</strong>.<br />The structure can be identified as a <strong>musculocutaneous nerve</strong> as it <strong>pierces the coracobrachialis muscle</strong> in its course and also supplies the <strong>biceps brachii.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/93940dd573c14f6d8cfb8bb7f9c13069.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/67fbac84dc1d440d906ff068b0bdc8fbx960x720.JPEG"
    ]
  },
  {
    "text": "Match the following curves to show the plasma effect with the corresponding insulins.\n\n(Here, B indicates breakfast, L lunch, S supper, and HS bedtime. An upward arrow shows insulin administration at mealtime)",
    "choices": [
      {
        "id": 1,
        "text": "1-c, 2-b, 3-a, 4-d"
      },
      {
        "id": 2,
        "text": "1-c, 2-a, 3-b, 4-d"
      },
      {
        "id": 3,
        "text": "1-c, 2-d, 3-b, 4-a"
      },
      {
        "id": 4,
        "text": "1-b, 2-a, 3-c, 4-d"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct match is\u00a01-c, 2-a, 3-b, 4-d.</p>\n<table style=\"width: 276px;\">\n<tbody>\n<tr>\n<td style=\"width: 149px;\">Yellow curve</td>\n<td style=\"width: 117px;\">NPH insulin</td>\n</tr>\n<tr>\n<td style=\"width: 149px;\">Red curve</td>\n<td style=\"width: 117px;\">Insulin glulisine \u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 149px;\">Green curve</td>\n<td style=\"width: 117px;\">Insulin glargine \u00a0</td>\n</tr>\n<tr>\n<td style=\"width: 149px;\">Dotted blue curve</td>\n<td style=\"width: 117px;\">Regular insulin</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>\n<p><strong>Panel A</strong> shows the administration of long-acting Insulin glargine (green curve) to provide basal insulin and a premeal short-acting insulin analog (red curve).</p>\n<p><strong>Panel B</strong> shows a twice-daily injection of NPH insulin providing basal insulin (yellow curve) and regular insulin (dotted curve) or insulin analog (red curve) providing mealtime insulin coverage. Note that only one type of short-acting insulin would be used.</p>\n<p>The insulin level attained following subcutaneous insulin (short-acting insulin analog) by an <strong>insulin pump</strong> programmed to deliver different basal rates would appear as below:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e55fb284731b48ddb2e4d81bc3032fdd.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f39a167ef81a43679461aa87c89b7727x1279x884.JPEG"
    ]
  },
  {
    "text": "Which of the circuits has the fresh gas inlet near the patient and corrugated tubing, but no reservoir bag?",
    "choices": [
      {
        "id": 1,
        "text": "Bain\u2019s circuit"
      },
      {
        "id": 2,
        "text": "Ayre\u2019s T piece"
      },
      {
        "id": 3,
        "text": "Water\u2019s to and fro circuit"
      },
      {
        "id": 4,
        "text": "Magill\u2019s circuit"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ayre&rsquo;s T piece,</strong> a type of Mapleson <strong>E</strong> system has the fresh <strong>gas inlet near</strong> the <strong>patient</strong> and <strong>corrugated</strong> tubing, but <strong>no</strong> reservoir <strong>bag.</strong></p>\n<p>Other Options:</p>\n<p>Option A: <strong>Bain&rsquo;s </strong>circuit or Mapleson <strong>D</strong> has the fresh<strong> gas inlet near </strong>the <strong>patient, </strong>a reservoir <strong>bag </strong>and <strong>corrugated </strong>tubing.</p>\n<p>Option C: <strong>Water&rsquo;s to and fro</strong> circuit or Mapleson <strong>C </strong>has the fresh <strong>gas inlet near</strong> the <strong>patient </strong>and a reservoir <strong>bag</strong> but <strong>no corrugated</strong> tubing.</p>\n<p>Option D: <strong>Magill&rsquo;s</strong> circuit or Mapleson <strong>A </strong>has the fresh <strong>gas inlet</strong> <strong>near</strong> the <strong>bag. </strong>It has a reservoir bag and corrugated tubing.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 51-year-old female patient, Mrs. Susheela presents to dermatology OPD with a rash as seen in the image below. On further inquiry, she reveals that she has unintentionally lost a lot of weight over the past few months. Medical history is significant for a recent diagnosis of type 2 diabetes mellitus for which she is being treated with T. Metformin 500mg. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Gastrinoma"
      },
      {
        "id": 2,
        "text": "Somatostatinoma"
      },
      {
        "id": 3,
        "text": "Glucagonoma"
      },
      {
        "id": 4,
        "text": "VIPoma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image given depicts <strong>n</strong><strong>ecrolytic migrating erythema.</strong>&nbsp;This along with the clinical presentation is strongly suggestive of a&nbsp;<strong>glucagonoma</strong>.<strong>&nbsp;</strong></p>\n<p><strong>Glucagonoma</strong>&nbsp;is a rare neuroendocrine tumor of the pancreas, a majority of which are malignant at the time of presentation. They are most commonly seen arising from the pancreatic tail.</p>\n<p>Clinically, the classic presentation of glucagonoma is with the &ldquo;<strong>4 D&rsquo;s</strong>&rdquo;-</p>\n<ul>\n<li><strong>Diabetes</strong></li>\n<li><strong>Dermatitis</strong>- A characteristic waxing and waning necrolytic migrating erythema is seen that usually appears before other symptoms.</li>\n<li><strong>Deep vein thrombosis&nbsp;</strong></li>\n<li><strong>Depression.</strong></li>\n</ul>\n<div class=\"page\" title=\"Page 655\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Diagnosis is established by estimating plasma glucagon levels. A level <strong>&gt;1000 pg/mL</strong> is considered<strong> diagnostic</strong> (normal plasma glucagon level is &lt;150 pg/mL). <strong>Hypoaminoacidemia</strong> is also a characteristic laboratory finding.&nbsp;</p>\n<div class=\"page\" title=\"Page 655\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Treatment</strong> may include long-acting <strong>somatostatin analogues</strong> like octreotide to alleviate some of the clinical symptoms such as dermatitis. Surgical resection may be attempted but is often unsuccessful due to extrapancreatic malignant spread at the time of diagnosis.&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/691b0d623dbf4c5689aa95a2e961225a.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "There is a small school in a village, which has students from class 1-10. The classrooms are overcrowded and the area around the school is not clean. To ensure there is no breakout of tuberculosis, which of the following methods should the school adopt as primary prevention?",
    "choices": [
      {
        "id": 1,
        "text": "Start ATT for those that are smear positive"
      },
      {
        "id": 2,
        "text": "Reduce overcrowding in the classrooms"
      },
      {
        "id": 3,
        "text": "Educate children about tuberculosis"
      },
      {
        "id": 4,
        "text": "Screen symptomatic children with Mantoux"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Reducing overcrowding</strong> in classrooms is a <strong>primary prevention</strong> method. Primary prevention is <strong>action</strong> taken<strong> prior to the onset</strong> of disease, which <strong>removes</strong>/reduces the <strong>possibility</strong> that a <strong>disease</strong> will ever occur. Ex: Improving <strong>standard of living, vaccination</strong>, etc.</p>\n<p>Other Options:</p>\n<p>Option A: Starting ATT for those that are smear-positive would be secondary prophylaxis&nbsp;</p>\n<p>Option C: <strong>Educating</strong> children is a <strong>primordial</strong> prevention method. It aims to <strong>prevent&nbsp; </strong>development of <strong>risk factors</strong>.</p>\n<p>Option D: <strong>Screening</strong> symptomatic children with Mantoux is a <strong>secondary </strong>prevention method.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 55-year-old female complains of lower backache. The radiographic image of her lumbosacral spine is given below. Which of the following tools can be used to compare the bone mineral density of this patient to the young normal reference level?",
    "choices": [
      {
        "id": 1,
        "text": "T-score"
      },
      {
        "id": 2,
        "text": "FRAX"
      },
      {
        "id": 3,
        "text": "Z-score"
      },
      {
        "id": 4,
        "text": "ABCD score"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given case suggests <strong>osteoporosis </strong>and<strong> T-score</strong> are used to compare the&nbsp;<strong>bone mineral density</strong>&nbsp;of this patient to the young normal reference level.</p>\n<p>The above image depicts the&nbsp;<strong>ballooning of disc spaces&nbsp;</strong>leading to the&nbsp;<strong>biconcave shape of the vertebral body&nbsp;</strong>known as&nbsp;<strong>&lsquo;Codfish</strong><strong>&nbsp;appearance&rsquo;,&nbsp;</strong>classically seen in&nbsp;<strong>osteoporosis.</strong>&nbsp;</p>\n<p>It is caused due to the reduction in the strength of the bone that leads to an increased risk of fractures. WHO defines osteoporosis as a T-score&nbsp;<strong>less than -2.5</strong>. It is the&nbsp;<strong>gold standard to assess bone mineral density</strong>.</p>\n<p><strong>Other radiological features of osteoporosis:</strong></p>\n<ul>\n<li><strong>Loss of vertical height&nbsp;</strong>of vertebra due to collapse</li>\n<li><strong>Ground glass appearance of bones&nbsp;</strong>especially in the bones like the pelvis</li>\n<li>Loss of cortical bone (<strong>picture frame vertebrae</strong>) and trabecular bone (<strong>ghost vertebrae</strong>)</li>\n<li>Loss of trabeculae in the proximal femur area.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a19eaf8ff439439cb594b7d0d8ecbc2a.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "An infant seems normal at birth but develops breathing difficulties shortly after birth with feeding problems, vomiting, and hypotonia. His urine was found to have a characteristic smell of tomcat urine. Considering the most likely diagnosis, treatment of this child with ______ will result in a dramatic clinical and biochemical response?",
    "choices": [
      {
        "id": 1,
        "text": "Tyrosin"
      },
      {
        "id": 2,
        "text": "Phenyalanine"
      },
      {
        "id": 3,
        "text": "Biotin"
      },
      {
        "id": 4,
        "text": "Pyridoxine"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Tomcat urine odor</strong> is seen in <strong>Multiple carboxylase deficiency</strong>.&nbsp;Affected infants should be treated with <strong>Biotin</strong>.</p>\n<p><strong>Multiple carboxylase deficiencies</strong> lead to <strong>defects</strong> in the <strong>utilization of Biotin</strong>. In the neonatal form of the disease, clinically, the affected infants seem normal at birth, but develop breathing difficulties shortly after birth with feeding problems, vomiting, and hypotonia. If untreated, generalized erythematous rash, exfoliation, alopecia, failure to thrive, seizures, and even coma may occur.&nbsp;</p>\n<p><strong>Treatment</strong> with <strong>Biotin</strong> (10 mg/day orally) usually results in an improvement in clinical manifestations and may normalize the biochemical abnormalities. Early diagnosis and treatment are critical to prevent&nbsp;irreversible neurologic damage. In some patients, however, complete resolution may not be achieved even with large doses (up to 80 mg/day) of biotin.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Match the following visual field defects with the likely site of the lesion -",
    "choices": [
      {
        "id": 1,
        "text": "1-A, 2-B, 3-E, 4-D, 5-C"
      },
      {
        "id": 2,
        "text": "1-C, 2-B, 3-E, 4-D, 5-A"
      },
      {
        "id": 3,
        "text": "1-C, 2-E, 3-B, 4-D, 5-A"
      },
      {
        "id": 4,
        "text": "1-D, 2-B, 3-E, 4-C, 5-A"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The correct match is\u00a01-C, 2-B, 3-E, 4-D, 5-A</p>\n<table style=\"height: 133px; width: 413.125px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 153px; text-align: center; height: 18px;\"><strong>Lesion site</strong></td>\n<td style=\"width: 204px; text-align: center; height: 18px;\"><strong>Fibers affected</strong></td>\n<td style=\"width: 80.125px; text-align: center; height: 18px;\"><strong>Visual defect</strong></td>\n</tr>\n<tr style=\"height: 63px;\">\n<td style=\"width: 153px; height: 63px;\">A - Lesion in left optic nerve</td>\n<td style=\"width: 204px; height: 63px;\">Left nasal and left temporal fibers affected</td>\n<td style=\"width: 80.125px; height: 63px;\">5. Left-sided complete anopia</td>\n</tr>\n<tr style=\"height: 90px;\">\n<td style=\"width: 153px; height: 90px;\">B - Lesion in left optic tract</td>\n<td style=\"width: 204px; height: 90px;\">Left temporal and right nasal fibers affected</td>\n<td style=\"width: 80.125px; height: 90px;\">2. Right-sided homonymous hemianopia</td>\n</tr>\n<tr style=\"height: 66px;\">\n<td style=\"width: 153px; height: 66px;\">C - Lesion in left Meyer's loop</td>\n<td style=\"width: 204px; height: 66px;\">Left inferior temporal and right inferior nasal fibers affected</td>\n<td style=\"width: 80.125px; height: 66px;\">\n<p>1. Right superior homonymous quadrantanopia (<strong>Pie in the sky</strong>)\u00a0</p>\n</td>\n</tr>\n<tr style=\"height: 88px;\">\n<td style=\"width: 153px; height: 88px;\">D - Lesion in left Baum's loop</td>\n<td style=\"width: 204px; height: 88px;\">Left superior temporal and right superior nasal fibers affected</td>\n<td style=\"width: 80.125px; height: 88px;\">4.\u00a0Right inferior homonymous quadrantanopia\u00a0(<strong>Pie in the floor</strong>)</td>\n</tr>\n<tr style=\"height: 97.3672px;\">\n<td style=\"width: 153px; height: 97.3672px;\">E - Lesion in left visual cortex sparing the macula</td>\n<td style=\"width: 204px; height: 97.3672px;\">Left temporal and right nasal fibers except the macular fibers</td>\n<td style=\"width: 80.125px; height: 97.3672px;\">3. Right homonymous hemianopia with macular sparing</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d63366a90c804adb9d9d0dac2a824ae8.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A young woman presents with the following lesion on the right inguinal lymph node region. Direct microscopy of a smear from the lesion shows a school of fish appearance. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Granuloma inguinale"
      },
      {
        "id": 2,
        "text": "Herpetic ulcer"
      },
      {
        "id": 3,
        "text": "Chancroid"
      },
      {
        "id": 4,
        "text": "Hard chancre"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario along with the image showing <strong>bubo</strong> formed from ruptured and necrosed\u00a0right inguinal lymph node suggest the most likely diagnosis to be<strong> chancroid</strong>.\u00a0</p>\n<p><strong>Soft chancre\u00a0</strong>or chancroid is<strong>\u00a0</strong>caused by the gram-negative bacterium, <em><strong>Haemophilus ducreyi</strong></em>.<strong>\u00a0</strong></p>\n<p>It begins as inflammatory papules that undergoes central necrosis and forms <strong>multiple painful nonindurated ulcers</strong> with undermined edges. It is often associated with <strong>inguinal lymphad\u00adenitis</strong>, which may suppurate and lead to bubo formation. They are usually unilateral, fluctuant and may rupture spontaneously to form inguinal ulcers and sinuses.</p>\n<p>Autoinoculation from the primary ulcer may lead to <strong>multiple</strong> or <strong>kissing ulcers</strong> on opposing skin surfaces, as well as extragenital lesions.</p>\n<p>Diagnosis:</p>\n<ul>\n<li>Direct microscopy of smears from chancroid\u00a0 - <strong>school of fish appearance</strong> of organisms</li>\n<li>Culture of <em>H. ducreyi</em> from the lesion or from an aspirate of suppurative lymph nodes</li>\n</ul>\n<p>The image below shows school of fish appearance of <em>H. ducreyi </em>on microscopy.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/6b9769753cfa4382b5ff984795af603a.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a7ba2390336f4669b43b747dedaea735x1280x1252.JPEG"
    ]
  },
  {
    "text": "A 55-year-old male patient presented with uncontrolled bleeding from the nose, that failed to settle with conservative methods. When examined, the bleeding point was difficult to localize. A transnasal endoscopic procedure was performed for artery ligation. An adjunctive procedure was performed in order to further control the epistaxis, with the incision shown in the image below. Which among the following arteries are exposed and ligated following this incision?",
    "choices": [
      {
        "id": 1,
        "text": "Greater palatine artery"
      },
      {
        "id": 2,
        "text": "Septal branch of facial artery"
      },
      {
        "id": 3,
        "text": "Sphenopalatine artery"
      },
      {
        "id": 4,
        "text": "Anterior ethmoidal artery"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The incision shown in the given image is the <strong>Lynch incision (external ethmoid incision)</strong>, which exposes the <strong>anterior and posterior ethmoidal arteries</strong>. The anterior ethmoidal artery is often ligated as an adjunctive procedure to <strong>Transnasal Endoscopic Sphenopalatine Artery Ligation (TESPAL)</strong>.</p>\n<p>Spontaneous epistaxis in a hypertensive patient, &gt;40 years of age which is difficult to localize is suggestive of posterior epistaxis.</p>\n<table style=\"width: 418px; height: 433px;\">\n<tbody>\n<tr>\n<td style=\"width: 68px;\">\u00a0</td>\n<td style=\"width: 154px;\">Anterior epistaxis</td>\n<td style=\"width: 174px;\">Posterior epistaxis</td>\n</tr>\n<tr>\n<td style=\"width: 68px;\">Site</td>\n<td style=\"width: 154px;\">Little's area or anterior part of the lateral wall</td>\n<td style=\"width: 174px;\">Posterosuperior part of the nasal cavity, or difficult to localize</td>\n</tr>\n<tr>\n<td style=\"width: 68px;\">Age</td>\n<td style=\"width: 154px;\">Children, young adults</td>\n<td style=\"width: 174px;\">&gt;40 years of age</td>\n</tr>\n<tr>\n<td style=\"width: 68px;\">Cause</td>\n<td style=\"width: 154px;\">Usually trauma</td>\n<td style=\"width: 174px;\">Spontaneous, due to hypertension or IHD</td>\n</tr>\n<tr>\n<td style=\"width: 68px;\">Bleeding</td>\n<td style=\"width: 154px;\">Mild, easily controlled with conservative measures (pressure, anterior nasal pack)</td>\n<td style=\"width: 174px;\">Severe requires hospitalization and posterior nasal pack</td>\n</tr>\n</tbody>\n</table>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/44d1c217b72e47709a944af7b9705bb2.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8f12c392817447eb95141c8d4931ebe5x1280x1994.JPEG"
    ]
  },
  {
    "text": "A 32-year-old G3P2L1 presents in labor at 30 weeks of gestation. She has a history of prior preterm labor.  Which of the following are predictors for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "1,3,4"
      },
      {
        "id": 2,
        "text": "1 and 4 only"
      },
      {
        "id": 3,
        "text": "2,4,5"
      },
      {
        "id": 4,
        "text": "2 and 5 only"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette suggests that the lady has gone into <strong>preterm labor</strong>. The predictors of this condition are <strong>2</strong> and <strong>5 only.&nbsp;</strong></p>\n<p>Preterm labor is defined as one where the labor starts <strong>before </strong>the<strong> 37th completed week&nbsp;</strong>(&lt;259 days), counting from the first day of the last menstrual period.</p>\n<p><strong><span data-preserver-spaces=\"true\">Predictors</span></strong><span data-preserver-spaces=\"true\">&nbsp;of preterm labor:</span></p>\n<ul>\n<li><span data-preserver-spaces=\"true\"><strong>Clinical</strong>&nbsp;predictors -&nbsp;</span>\n<ul>\n<li><span data-preserver-spaces=\"true\">History of prior preterm birth</span></li>\n<li><span data-preserver-spaces=\"true\">Multiple pregnancies</span></li>\n<li><span data-preserver-spaces=\"true\">Presence of <strong>genital tract infection</strong></span></li>\n<li><span data-preserver-spaces=\"true\">Symptoms of preterm labor</span></li>\n</ul>\n</li>\n<li><strong>Biophysical</strong>&nbsp;predictors -&nbsp;\n<ul>\n<li><span data-preserver-spaces=\"true\">Uterine contractions <strong>&ge;4/hour</strong></span></li>\n<li><strong>Bishop score &ge;4</strong></li>\n<li><span data-preserver-spaces=\"true\">Cervical length on transvaginal ultrasound <strong>&le;2.5 cm</strong></span></li>\n</ul>\n</li>\n<li><span data-preserver-spaces=\"true\"><strong>Biochemical</strong>&nbsp;predictors -&nbsp;</span>\n<ul>\n<li><span data-preserver-spaces=\"true\"><strong>Fetal fibronectin</strong>&nbsp;(fFN) in cervical/vaginal discharge&nbsp;<strong>&gt;50 ng/mL</strong></span></li>\n<li><span data-preserver-spaces=\"true\">Increased levels of IL-6, IL-8, TNF-alpha</span></li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 43-year-old woman with a history of tuberculosis presents with increased weakness, fatigue, and edema. She complains of some shortness of breath on walking fast and performing any strenous physical activity. On examination, her neck veins are distended. ECG shows low voltage QRS complexes with diffuse flattening of T waves. Which of the following waveforms will be associated with this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>This patient's history and findings are suggestive of <strong>tuberculous constrictive pericarditis</strong>. The jugular venous pressure waveform seen in constrictive pericarditis is shown in the image 1.</p>\n<p>Chronic constrictive pericarditis occurs as a result of resorption of chronic pericardial effusion and <strong>obliteration of the pericardial cavity</strong> by granulation tissue, which further forms a <strong>firm scar</strong> around the heart that may be calcified. In developing countries, the leading cause of chronic constrictive pericarditis is tuberculosis. Other causes include trauma, cardiac surgery, mediastinal irradiation, neoplastic disease, and relapsing infections.</p>\n<p>In constrictive pericarditis, there is a <strong>diastolic dysfunction</strong> causing <strong>impaired ventricular filling</strong> due to limitations imposed by the thick, rigid pericardium. This reduced end-diastolic volume <strong>decreases the stroke volume</strong> causing fatigue, weakness, and exertional dyspnoea. The impaired ventricular filling also causes an <strong>increase in JVP</strong> as a result of the back-up of blood in the atria and the venous system (edema).</p>\n<p>The waveforms seen in a normal JVP are:</p>\n<ul>\n<li>a wave: corresponds to atrial contraction</li>\n<li>c wave: tricuspid valve to bulge due to ventricular systole<strong>&nbsp;</strong>after the closure of valves&nbsp;</li>\n<li>x descent: corresponds to the atrial relaxation during atrial diastole</li>\n<li>v wave: corresponds to the venous filling of the right atrium</li>\n<li>y descent: passive emptying of the right atrium into the right ventricle</li>\n</ul>\n<p>In constrictive pericarditis, there is a <strong>rapid 'x' and 'y' descent</strong>. The rapid 'y' descent is more prominent and reflects rapid early ventricular diastolic filling.&nbsp;This occurs due to the constricting pericardium, increasing the atrial pressures.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fc15b5308ef144acbc867cb4cba45529.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2bd5fec6014a4a3fb96e89495ab3a5b4x1280x903.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e5d5ca2bee58474b8b154db286e1b23ex1280x758.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/86452d04de444f5697619dabc1c238e9x1280x706.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/307e5bd7077a45b385341bfbe13e66f6x1280x779.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/761084eb2f9e4add924e26a46aab0ca8x1280x946.JPEG"
    ]
  },
  {
    "text": "A 61-year-old man presents with dementia and gait difficulties along with episodes of urinary incontinence. Physical examination is notable for magnetic gait. There is no papilledema. An MRI brain demonstrates ventricular enlargement. After a serial lumbar puncture, his gait significantly improves. Which of the following is the best management for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Furosemide"
      },
      {
        "id": 2,
        "text": "Acetazolamide"
      },
      {
        "id": 3,
        "text": "Ventriculo-peritoneal shunting"
      },
      {
        "id": 4,
        "text": "Optic sheath decompression"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The triad of&nbsp;<strong>dementia, ataxia, </strong>and <strong>urinary incontinence,</strong>&nbsp;along with the other clinical features and&nbsp;<strong>MRI</strong>&nbsp;showing <strong>enlarged ventricles</strong>, is&nbsp;highly suggestive of <strong>normal-pressure hydrocephalus</strong>.&nbsp;<strong>Ventriculo-peritoneal shunting</strong> is preferred in this condition.</p>\n<p><strong>Normal-pressure hydrocephalus </strong>is a <strong>reversible </strong>cause of dementia. It is caused by obstruction to the normal CSF flow in the cerebral convexity and delayed absorption into the venous system.</p>\n<p>Clinical features of NPH triad:</p>\n<ul>\n<li>ataxia (magnetic gait is described as slow and unsteady turns that are slow, broad-based, and short-stepped)</li>\n<li>dementia</li>\n<li>urinary incontinence</li>\n</ul>\n<p>Papilloedema is not seen.</p>\n<p>Diagnosis:&nbsp;</p>\n<ul>\n<li>Neuroimaging reveals <strong>enlarged lateral ventricles</strong> (hydrocephalus) with little or <strong>no cortical atrophy</strong>, although the sylvian fissures can be mistaken for perisylvian atrophy due to the propped open (so-called &ldquo;<strong>boxcarring</strong>&rdquo;) appearance.</li>\n<li>CSF parameters are normal except for the high range of pressure.</li>\n<li>Another confirmatory test performed is the cerebrospinal fluid <strong>(</strong><strong>CSF) tap test</strong>&nbsp;which shows marked improvement of symptoms with spinal fluid removal.</li>\n</ul>\n<p>Treatment: Ventriculo-peritoneal shunting- It&nbsp;is done to drain excess&nbsp;cerebrospinal fluid (CSF). Complications of the shunting procedure include <strong>shunt obstruction</strong>,<strong>&nbsp;infection, i</strong><strong>ntracerebral or intraventricular hemorrhage,&nbsp;</strong>malposition&nbsp;or breakage of the shunt, etc.</p>\n<p>Other options:&nbsp;</p>\n<p>Idiopathic intracranial hypertension presents with transient vision loss, headache, and papilledema. Medical therapy includes <strong>acetazolamide&nbsp;</strong>and <strong>furosemide</strong>. Topiramate is also used due to carbonic anhydrase inhibitor activity. Surgical therapy includes <strong>optic nerve sheath decompression</strong> (or optic nerve sheath fenestration) and CSF shunting procedures.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The barium enema of a 37-year-old male is as shown below. Which of the following condition is least likely to be the underlying cause?",
    "choices": [
      {
        "id": 1,
        "text": "Colonic cancer"
      },
      {
        "id": 2,
        "text": "Crohn's disease"
      },
      {
        "id": 3,
        "text": "Pseudomembranous colitis"
      },
      {
        "id": 4,
        "text": "Chronic ulcerative colitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Apple core sign is least likely seen in pseudomembranous colitis among the given options.</p>\n<p>The&nbsp;sign shown in the <strong>barium enema study</strong> is <strong>apple core sign/ napkin ring sign</strong>&nbsp;- Describes a short&nbsp;segment&nbsp;irregular circumferential stricture of the large bowel that has <strong>abrupt &ldquo;shouldered&rdquo; margins</strong> resembling an <strong>apple core</strong>. The appearance is classically described on contrast enema studies and is almost always due to a stenosing annular&nbsp;<strong>colon carcinoma</strong>. It is not seen in pseudomembranous colitis.</p>\n<p>The appearance of the apple-core lesion of the colon also can be caused by other diseases&nbsp;:</p>\n<ul>\n<li><a href=\"https://radiopaedia.org/articles/colorectal-villous-polyps?lang=gb\" target=\"_blank\" rel=\"noopener\"></a>Villous adenoma</li>\n<li>Lymphoma with colonic involvement</li>\n<li>Crohn's disease</li>\n<li>Chronic ulcerative colitis</li>\n<li>Ischaemic colitis</li>\n<li>Chlamydia infection</li>\n<li>Colonic tuberculosis</li>\n<li>Helminthoma</li>\n<li>Colonic amoebiasis</li>\n<li>Colonic cytomegalovirus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/450ee259a5844624a142f4f6d00b810d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f7294bb24674da594b70ef1b75996fcx908x1236.PNG"
    ]
  },
  {
    "text": "A 25-year-old female presents to the casualty after having overdosed on anti-hypertensive medication. On examination, there are multiple cuts on her wrists and history reveals multiple attempts at suicide. On further inquiry, her father reveals she has marked fluctuations in her mood with a history of unstable relationships. What is the major defense mechanism in patients with this personality disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Somatization"
      },
      {
        "id": 2,
        "text": "Regression"
      },
      {
        "id": 3,
        "text": "Splitting"
      },
      {
        "id": 4,
        "text": "Reaction formation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given history of repetitive self-destructive acts, unstable relationships, and mood swings<strong>&nbsp;</strong>point towards a diagnosis of <strong>borderline personality disorder.&nbsp;</strong>The main defense mechanism is <span style=\"font-size: 10pt;\"><strong style=\"letter-spacing: 0px;\">splitting</strong><span style=\"letter-spacing: 0px;\">.</span></span></p>\n<p><strong>In splitting,</strong>&nbsp;external objects are divided into all good or all bad. Eg: The morning staff is perfect, the evening staff is terrible.</p>\n<p>A borderline personality disorder is classified under Cluster B. It is characterized by an unstable effect, <strong>mood swings</strong>, marked <strong>impulsivity</strong>, <strong>unstable relationships</strong>, <strong>recurrent suicidal behavior</strong>, chronic feelings of emptiness or boredom, identity disturbance, and inappropriate anger. If stressed, individuals may become psychotic.</p>\n<p>Other options :</p>\n<p>Option A:&nbsp;<strong>Somatization</strong>: Psychic derivatives are converted into bodily symptoms.</p>\n<p>Option B:&nbsp;<strong>Regression</strong>: Return to an earlier stage of development</p>\n<p>Option D:&nbsp;<strong>Reaction formation</strong>: An unacceptable impulse is transformed into its opposite; results in the formation of character traits.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A child was brought to your clinic with an erythematous rash on the cheek, which later spread downwards to involve his trunk and limbs. He has also had a low-grade fever, and mild upper respiratory tract infection for the past few days. The suspected organism contains:",
    "choices": [
      {
        "id": 1,
        "text": "Single stranded RNA"
      },
      {
        "id": 2,
        "text": "Single stranded DNA"
      },
      {
        "id": 3,
        "text": "Double stranded DNA"
      },
      {
        "id": 4,
        "text": "Double stranded RNA"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The given clinical scenario and image are strongly suggestive of <strong>erythema infectiosum</strong>. The image is showing the classical <strong>slapped cheek appearance</strong>. It is caused\u00a0by\u00a0<strong>Parvoviruses.\u00a0</strong></span><span data-preserver-spaces=\"true\"><strong>Parvovirus B19</strong> is a non-enveloped <strong>single-stranded DNA</strong> virus.\u00a0</span></p>\n<p><span data-preserver-spaces=\"true\">Clinically, parvovirus B-19 infection may have several presentations:</span></p>\n<p><span data-preserver-spaces=\"true\"><strong>Erythema infectiosum</strong>- Also known as the<strong> fifth disease.</strong> The incubation period after infection is typically around 1-2 weeks.\u00a0</span>The hallmark of erythema infectiosum is the\u00a0characteristic rash, which appears initially as\u00a0erythematous facial flushing, often described as a\u00a0\u201c<strong>slapped cheek</strong>\u201d appearance. Later, the rash spreads rapidly or concurrently to the trunk and proximal extremities as diffuse macular erythema. The child may be febrile.\u00a0</p>\n<p><strong>Transient aplastic crisis</strong>- It may be seen in patients with underlying\u00a0<strong>chronic hemolytic anaemia</strong> like sickle-cell disease, thalassemia, hereditary spherocytosis, and RBC enzyme deficiencies like pyruvate kinase deficiency. Patients with aplastic crisis appear ill with fever, malaise, and paleness with tachycardia and tachypnea due to profound anaemia. The rash may or may not be present.\u00a0</p>\n<p><strong>Pure red cell aplasia</strong>- Persistent Parvovirus B19 infection in immunocompromised patients can cause chronic suppression of bone marrow and chronic anaemia, leading to pure red cell aplasia.</p>\n<p>Maternal infection is associated with<strong> non-immune fetal hydrops</strong> and intrauterine fetal demise.</p>\n<p>The diagnosis of erythema infectiosum is made clinically and does not require investigations routinely. Detection of viral DNA in the blood by PCR or nucleic acid hybridisation may be done for immunocompromised cases or prenatal diagnosis of infection.</p>\n<p>It is self-limited and resolves on its own. IVIG may be given to immunocompromised children.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1178cb43830e4615b80a411d80703b50.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 4-year-old boy presents with developmental delay, short stature, a tendency to sunburn easily, and dry, scaly skin.  He has short and brittle hair and sparse eyebrows. Under polarized light microscopy of the hair strand, a pattern of alternating light and dark \u2018tiger\u2010tail\u2019 bands is seen.  What can be the  DNA repair defect in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Defective Non-homologous End Joining Repair (NHEJ)"
      },
      {
        "id": 2,
        "text": "Defective Homologous Repair (HR)"
      },
      {
        "id": 3,
        "text": "Defective DNA Base Excision Repair (BER)"
      },
      {
        "id": 4,
        "text": "Defective DNA Nucleotide Excision Repair (NER)"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario is suggestive of <strong>trichothiodystrophy</strong> (TTD) which is caused by <strong>defective DNA Nucleotide Excision Repair (NER</strong>). Features like developmental delay, short stature, photosensitivity, and ichthyosis with short, brittle, and sparse hair are suggestive of<strong>&nbsp;</strong>the diagnosis.&nbsp;</p>\n<p>Trichothiodystrophy is an&nbsp;<strong>autosomal recessive</strong> disorder of DNA repair.&nbsp;Most patients carry mutations in the ERCC2 (XPD) gene of the <strong>nucleotide excision repair</strong> mechanism.</p>\n<p>It is a multisystem disorder characterized by <strong>short</strong>,<strong> brittle</strong>,<strong> sulfur-deficient hair</strong> with a pattern of <strong>alternating light and dark &lsquo;tiger\u2010tail&rsquo; bands</strong> under polarized light microscopy. Other features include&nbsp;<strong>photosensitivity</strong>,<strong> ichthyosis</strong>, developmental delay, and short stature.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b07d7de2bddd4304aec5aa893cfe60b0.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old drowsy male was brought to the casualty. His pulse was 130/min, respiratory rate -30/min. His lab reports are given below.  He showed improvement on nasogastric aspiration and administration of sodium bicarbonate, calcium gluconate, and 4-methyl pyrazole. What substance did he most likely consume?",
    "choices": [
      {
        "id": 1,
        "text": "Formaldehyde"
      },
      {
        "id": 2,
        "text": "Ethylene glycol"
      },
      {
        "id": 3,
        "text": "Paraldehyde"
      },
      {
        "id": 4,
        "text": "Methyl alcohol"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given scenario point towards <strong>ethylene glycol poisoning</strong>.</p>\n<p><strong>Ethylene glycol&nbsp;</strong>is converted to<strong>&nbsp;glyoxyaldehyde</strong>&nbsp;by alcohol dehydrogenase.&nbsp;Glyoxyaldehyde causes <strong>kidney damage.</strong>&nbsp;</p>\n<p><strong>Methanol</strong> is converted to <strong>formaldehyde</strong>&nbsp;by alcohol dehydrogenase. Formaldehyde causes <strong>retinal damage</strong>&nbsp;like blurring of vision/loss of vision.</p>\n<p>The principles of <strong>treatment</strong> for both these conditions are the same. It predominantly involves using <strong>fomipezole</strong> or ethanol to inhibit the metabolic conversion of these relatively non-toxic alcohols to their toxic metabolites.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Ini-Cet  Mini - 9 (20 Q)';
        const quizFilename = 'ini-cet-mini-9-20-q-1b448e2e.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>