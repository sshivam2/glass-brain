<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28 Benign Conditions Of Liver - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">31</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is a false statement regarding the anatomy of the liver?",
    "choices": [
      {
        "id": 1,
        "text": "Cantlie's line divides the liver functionally into two hemi-livers"
      },
      {
        "id": 2,
        "text": "The liver has 2 major and 2 minor fissures."
      },
      {
        "id": 3,
        "text": "Three main hepatic veins divide the liver into four portal sectors"
      },
      {
        "id": 4,
        "text": "Each Couinaud's segment has its own vascular supply, biliary drainage and lymphatic drainage"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The liver has <strong>3 major </strong>and<strong> 3 minor fissures.</strong>&nbsp;</p>\n<p>The <strong>major portal fissures</strong> (are not visible on the liver surface and run through the parenchyma)</p>\n<ul style=\"list-style-type: circle;\">\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Middle/main</strong> <strong>portal fissure</strong> (Cantlie's line)</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">extends from the <strong>midpoint</strong> of the <strong>gallbladder fossa</strong> at the inferior margin of the liver back to the <strong>midpoint</strong> of the <strong>inferior vena cava</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Contains the <strong>middle hepatic vein</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Separates the liver into the right and left hemi-livers.</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Right</strong> <strong>portal fissure</strong></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Contains the <strong>right hepatic vein</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Divides the liver into the right anterior/medial sector (segments V and VIII) and right posterior/lateral sector (segments VI and VII).</li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Left</strong> <strong>portal fissure</strong></li>\n<ul style=\"list-style-type: circle;\">\n<li style=\"font-weight: 400;\" aria-level=\"2\">Contains the<strong> left hepatic vein</strong></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\">Separates the left anterior/medial (segments IV) and left posterior/lateral sectors (Segment II and III)</li>\n</ul>\n</ul>\n<p>&nbsp;The <strong>three minor fissures</strong> (are visible as physical clefts of the liver surface)&nbsp;</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Umbilical fissure</strong> or fissure for the ligamentum teres</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Venous fissure</strong> or fissure for the ligamentum venosum</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Fissure of gans</strong> or Rouvi&egrave;re&rsquo;s sulcus</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young patient presents with distension of the abdomen and yellowish discoloration of the eyes for the past 6 months.  After a detailed workup, he is diagnosed with early-stage hepatocellular carcinoma in the left lobe of the liver. The surgeon decides to perform a left hemi-hepatectomy. Which of the following segments has to be removed in the patient?",
    "choices": [
      {
        "id": 1,
        "text": "I, II, III and IV"
      },
      {
        "id": 2,
        "text": "II and III only"
      },
      {
        "id": 3,
        "text": "II, III, and IV"
      },
      {
        "id": 4,
        "text": "I, III, IV and V"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>In the <strong>left hemi-hepatectomy</strong> (also called left hepatectomy) the segments marked as <strong>II, III, and IV</strong> should be removed.</p>\n<p><strong>Couinaud classification</strong> is the commonly used classification of the liver. It divides the liver is divided into<strong> eight segments</strong>. Each segment has its own vascular supply, biliary drainage, and lymphatic drainage. <strong>Segment I</strong> corresponds to the <strong>caudate lobe</strong> of the liver and <strong>segment IV</strong> corresponds to the <strong>quadrate lobe</strong> of the liver.&nbsp;</p>\n<p>The&nbsp;Couinaud's Liver Segments<strong class=\"ng-binding\">&nbsp;</strong>are as follows:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f15a1c3f10fb46bf9278683b56b8f5ddx1280x3097.JPEG"
    ]
  },
  {
    "text": "What is the most common anomaly of the hepatic artery?",
    "choices": [
      {
        "id": 1,
        "text": "Independent origin of the right and left hepatic arteries from the cealic axis"
      },
      {
        "id": 2,
        "text": "Replaced right hepatic artery arising from the superior mesentric artery"
      },
      {
        "id": 3,
        "text": "Replaced left hepatic artery"
      },
      {
        "id": 4,
        "text": "Accessory right hepatic artery"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The<strong> most common anomaly</strong> of the hepatic artery is <strong>replaced right hepatic artery</strong>&nbsp;arising from the<strong> superior mesenteric artery</strong>.&nbsp;</p>\n<p>Normally, the&nbsp;common hepatic artery gives off the right and left hepatic arteries. A middle hepatic artery branches off from the proximal left hepatic artery.</p>\n<p>The replaced right hepatic artery directly<strong> supplies</strong> the <strong>right lobe </strong>of the liver.</p>\n<p>Surgical significance:<strong>&nbsp;</strong></p>\n<p>In individuals with replaced right hepatic artery,&nbsp;the diameter of the <strong>common hepatic artery</strong> is <strong>smaller.</strong>&nbsp;In liver <strong>transplant recipients</strong>, this can be a cause for the <strong>increased </strong>incidence of <strong>complications</strong> such as <strong>thrombosis</strong>.</p>\n<p>Whereas, replaced right hepatic artery is a <strong>beneficial variant for donors</strong> undergoing donation of the right lobe of the liver. The replaced right hepatic artery provides a <strong>longer </strong>and<strong> larger graft</strong> thus <strong>reducing</strong> chances of <strong>thrombosis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/28b0046b2ec843d39563aecec9daa0b3x1280x1514.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/11fee5fe56574ed7abd6c1b05ac87655x1279x1384.JPEG"
    ]
  },
  {
    "text": "The free hepatic venous pressure(FHVP) and wedged hepatic venous pressure(WHVP) of a patient, with suspected portal hypertension, are measured. How will the hepatic venous pressure gradient (HVPG) be determined from these values?",
    "choices": [
      {
        "id": 1,
        "text": "HVPG = WHVP \u2013 FHVP"
      },
      {
        "id": 2,
        "text": "HVPG = FHVP \u2013 WHVP"
      },
      {
        "id": 3,
        "text": "HVPG = FHVP + WHVP"
      },
      {
        "id": 4,
        "text": "HVPG = FHVP \u00f7 WHVP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hepatic Venous Pressure Gradient</strong> is measured by subtracting Free Hepatic Venous Pressure from Wedged Hepatic Venous Pressure.</p>\n<p><strong>HVPG = WHVP &ndash; FHVP</strong></p>\n<p>Hepatic venous pressure gradient (HVPG) is the<strong> pressure gradient </strong>between the <strong>portal vein</strong> and the<strong> inferior vena cava (IVC)</strong>. It is a measure of<strong> portal venous pressure</strong>. It can quantify the degree of portal hypertension due to sinusoidal resistance to blood flow.</p>\n<p>The <strong>most accurate </strong>method of determining <strong>portal hypertension</strong> is by <strong>measuring HVPG.&nbsp;</strong>The most commonly used procedure involves placing a balloon catheter in the hepatic vein after a jugular vein puncture. The <strong>free hepatic venous pressure </strong>(FHVP)<strong>&nbsp;</strong>is measured&nbsp;with the<strong> balloon deflated,</strong> and the <strong>wedged hepatic venous pressure </strong>(WHVP)<strong>&nbsp;</strong>with the<strong> balloon inflated </strong>to occlude the hepatic vein.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following values indicate a normal portal venous pressure?",
    "choices": [
      {
        "id": 1,
        "text": "1-3 mm of Hg"
      },
      {
        "id": 2,
        "text": "3 - 5 mmHg"
      },
      {
        "id": 3,
        "text": "5 \u2013 10 mmHg"
      },
      {
        "id": 4,
        "text": "10-12 mmHg"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>normal </strong>portal venous pressure is <strong>5 to 10 mmHg.&nbsp;</strong></p>\n<p><strong>Normal</strong> portal blood flow is <strong>1 to 1.5 L/minute</strong>.</p>\n<p><span style=\"font-family: verdana, geneva, sans-serif;\">Hepatic venous pressure gradient (HVPG) is the difference between the wedge and free hepatic venous pressure, which is 1 to 5 mmHg.</span></p>\n<p><span style=\"font-family: verdana, geneva, sans-serif;\">HVPG interpretation:</span></p>\n<ul>\n<li><strong>Normal HVPG</strong> is between<strong> 1 and 5 mmHg.</strong></li>\n<li><strong>Portal hypertension</strong> is present if the HVPG is <strong>&ge;6 mmHg.</strong></li>\n<li><strong>Portal hypertension </strong>typically becomes<strong> clinically significant</strong> when the HVPG is <strong>&ge;10 mmHg</strong>, at which point varices may develop.</li>\n<li><strong>HVPG &ge;12 mmHg,</strong> patients are at risk for<strong> variceal bleeding</strong> and the <strong>development of ascites.</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "All of the following are post-hepatic causes for portal hypertension, except_____",
    "choices": [
      {
        "id": 1,
        "text": "2 and 4"
      },
      {
        "id": 2,
        "text": "1,2 and 5"
      },
      {
        "id": 3,
        "text": "1 and 3"
      },
      {
        "id": 4,
        "text": "2,4 and 5"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Splenomegaly </strong>is a <strong>pre-hepatic cause </strong>of portal hypertension. Sarcoidosis and primary biliary cholangitis are presinusoidal <strong>intra</strong><strong>hepatic causes</strong> of portal hypertension.</p>\n<p><strong>Portal hypertension&nbsp;</strong>occurs when the<strong> pressure in the portal vein increases</strong> due to either increased resistance to blood flow secondary to fibrosis, active vasoconstriction, or hyperdynamic systemic circulation.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient who is a known case of chronic pancreatitis is diagnosed with splenic vein thrombosis. Which of the following is not true about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Endoscopy revealed gastric varices"
      },
      {
        "id": 2,
        "text": "USG abdomen showed normal liver and an enlarged spleen."
      },
      {
        "id": 3,
        "text": "Portal vein pressure is normal"
      },
      {
        "id": 4,
        "text": "TIPSS is done as part of  treatment"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above clinical scenario points to a case of <strong>splenic vein thrombosis\u00a0</strong>which can cause\u00a0<strong>left-sided portal hypertension. </strong>It is a\u00a0<strong>pre-hepatic</strong> cause of portal hypertension. It is managed by\u00a0<strong>splenectomy.\u00a0</strong></p>\n<p>Splenic vein thrombosis can be due to\u00a0<strong>pancreatic inflammation </strong>or<strong> neoplasms\u00a0</strong>(acute or chronic pancreatitis, pseudocysts, and carcinomas) that extend outside the pancreas and <strong>invades</strong> the <strong>splenic vein</strong>. This causes<strong> increased pressure</strong> in the splenic vein leading to the formation of collaterals and ultimately\u00a0<strong>gastric variceal hemorrhage\u00a0</strong>(not esophageal varices).</p>\n<p><strong>Normal liver function tests, </strong>normal portal venous pressures, and <strong>splenomegaly</strong> are the distinguishing features from other forms of portal hypertension.\u00a0The <strong>portal vein pressures </strong>remain<strong> normal</strong> as there is no obstruction of the hepatic venous vasculature.</p>\n<p><strong>Diagnosis</strong>\u00a0is done by\u00a0gastroscopy, liver function tests, ultrasound examination (with doppler), and contrast-enhanced CT scan of the abdomen.\u00a0Treatment includes <strong>splenectomy </strong>and management of the primary <strong>pancreatic pathology</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b44ccc5ff89549fcb633b0264830581ex1280x1449.JPEG"
    ]
  },
  {
    "text": "An elderly patient with chronic black tarry stools underwent an upper GI endoscopy. Gastric mucosa appeared as shown below. What is the likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Watermelon stomach"
      },
      {
        "id": 2,
        "text": "Portal hypertensive gastropathy"
      },
      {
        "id": 3,
        "text": "Menetrier\u2019s disease"
      },
      {
        "id": 4,
        "text": "Dieulafoy lesion"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D:&nbsp;<strong>Dieulafoy's lesion</strong> is a medical condition characterized by a <strong>large tortuous arteriole that erodes and bleeds</strong> and occurs most commonly in the <strong>stomach wall.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c225e7ea510445bbbe7d8d08d43a04c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/378902f95afd48589fcb29c274507abdx720x783.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ff57529481584d6ebb87b62a3df4a758x720x760.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3a86a746b09341888df90ed23c43f0e5x512x385.PNG"
    ]
  },
  {
    "text": "Which of the following statements is false regarding Budd-Chiari syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Caudate lobe hypertrophy is seen in approximately 50% of the patients"
      },
      {
        "id": 2,
        "text": "Doppler ultrasonography is the initial investigation of choice"
      },
      {
        "id": 3,
        "text": "It becomes clinically significant when one or more major hepatic veins are obstructed"
      },
      {
        "id": 4,
        "text": "Oral contraceptive use is a risk factor"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Budd\u2013Chiari syndrome (BCS)</strong> is an uncommon congestive hepatopathy characterized by the <strong>obstruction of hepatic venous outflow\u00a0</strong>and it becomes clinically significant <strong>when two or more major hepatic veins</strong> are obstructed.</p>\n<p><strong>Types:\u00a0</strong></p>\n<ul>\n<li class=\"p1\"><strong>Primary\u00a0 Budd\u2013Chiari syndrome</strong>: when the obstructive process involves an endoluminal venous thrombosis.</li>\n<li class=\"p1\"><strong>Secondary Budd\u2013Chiari syndrome</strong>:\u00a0 when the veins are compressed or invaded by a neighboring lesion originating outside the vein.</li>\n</ul>\n<p>Most common<strong> presentation:</strong> ascites and abdominal discomfort.</p>\n<p>Risk factors include-Primary myeloproliferative disorders, anticardiolipin antibodies, hyperhomocysteinemia, and <strong>oral contraceptive use.</strong></p>\n<p>Caudate lobe hypertrophy is seen in approximately <strong>50%</strong> of the cases and it is because the caudate lobe drains directly into the IVC.</p>\n<p class=\"p1\"><strong>Abdominal ultrasonography</strong>\u00a0with color Doppler is the initial <strong>investigation of choice</strong> and can demonstrate the absence of hepatic vein flow, spider web hepatic veins, and collateral hepatic veins.</p>\n<p class=\"p1\">The <strong>definitive</strong> <strong>radiographic</strong> study is <strong>hepatic venography</strong> to determine the presence and extent of hepatic vein thrombus as well as measure inferior vena cava (IVC) pressures.</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 43-year-old woman presented to the hospital with complaints of abdominal pain and distension for the past 3 months. Her past medical records show that she has a JAK2 mutation and investigations revealed serum protein to be 3 g/dL and ascitic fluid protein to be 1.5 g/dL. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anticoagulation is the mainstay of treatment"
      },
      {
        "id": 2,
        "text": "Colour flow doppler is the initial investigation of choice"
      },
      {
        "id": 3,
        "text": "Surgical intervention is done in all cases"
      },
      {
        "id": 4,
        "text": "Ascites is a bad prognostic factor"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario describes a case of<strong>&nbsp;late budd-chiari syndrome </strong>and surgical interventions are not done in all cases of budd chiari syndrome.</p>\n<p>SAAG = (serum albumin) &minus; (ascitic fluid albumin)</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= (3) - (1.5) = 1.5g/dL</p>\n<p>As<strong> SAAG is &gt;1.1g/dL</strong>( 1.5g/dL) and <strong>ascitic fluid protein is &lt; 2.5 g/dL,</strong> the most likely cause is late Budd-Chiari syndrome.Surgical interventions are done in those patients of Budd Chiari syndrome who are not responding to medical therapy.</p>\n<p>Colour flow doppler is the initial investigation of choice.</p>\n<p>Treatment:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Initial treatmen</strong>t consists of medically managing the underlying disease process and preventing the extension of the hepatic vein thrombosis through <strong>systemic anticoagulation</strong>.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The associated portal hypertension and ascites are managed in a manner similar to that in most cirrhotic patients.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Radiologic and surgical intervention</strong> should be reserved for patients whose condition is nonresponsive to medical therapy.<strong> Percutaneous angioplasty and transjugular intrahepatic portosystemic shunt (TIPS)</strong>, in combination with <strong>thrombolytic therapy</strong>, are the preferred strategies to restore the outflow of blood from the liver.</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Surgical shunting</strong>, particularly with the side-to-side portacaval shunt,&nbsp; turns the portal vein into a hepatic outflow tract.</li>\n</ul>\n<p>Factors contributing to&nbsp;a <strong>bad prognosis </strong>in Budd-Chiari syndrome:</p>\n<ul>\n<li class=\"half_rhythm\">\n<div>Involvement of all three hepatic veins and/or portal vein</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Presence of ascites</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Older age at the time of presentation</div>\n</li>\n<li class=\"half_rhythm\">\n<div>High Child-Pugh score</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Chronic disease at presentation</div>\n</li>\n</ul>\n<p><strong>Note: JAK2 mutation </strong>points to a possibility of <strong>polycythemia vera</strong> predisposing the patient to <strong>hypercoagulable states&nbsp;</strong>and the formation of thrombus anywhere in the body.&nbsp;From the serum and ascitic protein values, we can calculate the <strong>SAAG (serum protein-ascitic protein). </strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient comes with active variceal bleeding. Which of the following is not done?",
    "choices": [
      {
        "id": 1,
        "text": "Platelet transfusion"
      },
      {
        "id": 2,
        "text": "Arrange pRBC"
      },
      {
        "id": 3,
        "text": "IV Octreotide"
      },
      {
        "id": 4,
        "text": "Urgent Endoscopy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Platelet transfusion</strong> is <strong>not</strong> done in the case of <strong>active variceal bleeding</strong> unless <strong>coagulopathy</strong> is <strong>confirmed</strong> as the <strong>cause</strong>. Platelet transfusions are indicated only in patients with a platelet count of &lt;50,000/microL\u00a0 or in patients with evidence of microvascular bleeding.</p>\n<p><strong>Variceal</strong> <strong>hemorrhage</strong> is a medical emergency. Varices usually present with the <strong>acute onset</strong><strong>\u00a0large-volume haematemesis</strong>, the <strong>lower</strong> <strong>esophagus</strong> being the <strong>most common site</strong> for variceal bleeding.</p>\n<p>The <strong>sites</strong> for portosystemic anastomosis are:</p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Left</strong> <strong>gastric</strong> vein to <strong>distal</strong> <strong>oesophageal</strong> veins: oesophageal and gastric variceal bleeding</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Superior</strong> <strong>rectal</strong> veins to <strong>Middle</strong> and <strong>inferior</strong> rectal veins: hemorrhoids and rectal bleeding</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Left branch</strong> of the portal vein to <strong>Periumbilical</strong> veins: caput-medusae</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\">The <strong>right</strong> <strong>branch</strong> of the portal vein to <strong>retroperitoneal</strong> veins draining into azygos, hemiazygos, lumbar, intercostal, and phrenic veins</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><strong>Omental</strong> and <strong>colonic</strong> veins near hepatic and splenic \ufb02exures to <strong>Retroperitoneal</strong> veins near hepatic and splenic \ufb02exures</li>\n</ul>\n<p><strong>Medical</strong> <strong>management</strong> of variceal bleeding includes<strong> blood transfusion (option B)</strong>\u00a0and drug therapy with <strong>somatostatin</strong> <strong>analogs</strong> like <strong>octreotide (option C)</strong>. Short-term antibiotics like ceftriaxone are known to decrease bacterial infection and increase survival.</p>\n<p><strong>Surgical</strong> <strong>measures</strong> are preferred if <strong>medical</strong> management <strong>fails</strong>. They include <strong>balloon</strong> <strong>tamponade</strong>, <strong>endoscopic banding (option D)</strong>, transjugular intrahepatic portosystemic shunt <strong>(TIPS)</strong>, portosystemic shunts, splenectomy, and gastric revascularization</p>\n<p>Note: <strong>Sugiura</strong> <strong>procedure</strong> is the <strong>non-shunt</strong> <strong>surgical management</strong> of <strong>refractory</strong> oesophageal variceal bleeding. It is a procedure of de-vascularizing the distal esophagus and stomach.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2f488b42a32444f4874fb788c84a0e28x1280x1654.JPEG"
    ]
  },
  {
    "text": "A 56-year-old patient with intractable ascites underwent a procedure as shown below. Identify the procedure.",
    "choices": [
      {
        "id": 1,
        "text": "Warren Shunt"
      },
      {
        "id": 2,
        "text": "Portocaval shunt"
      },
      {
        "id": 3,
        "text": "Transjugular Intrahepatic Portosystemic shunt"
      },
      {
        "id": 4,
        "text": "Linton Shunt"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows the <strong>transjugular intrahepatic portosystemic shunt</strong>(TIPS) procedure with the viatorr device.</p>\n<p>The main indication of TIPS is for variceal bleeds not responding to medical or endoscopic treatment, and <strong>intractable ascites</strong>.</p>\n<p>The shunts are inserted under local anaesthetic, analgesia and sedation, using fluoroscopic guidance and ultrasonography. Via the internal jugular vein and superior venacava, a guidewire is inserted into a hepatic vein and through the&nbsp;hepatic parenchyma into a branch of the portal vein.</p>\n<p>The main early complication of this technique is the&nbsp;<strong>perforation of the liver capsule </strong>and the&nbsp;main contraindication to TIPSS is <strong>portal vein occlusion.</strong></p>\n<p><strong>Shunts</strong> for Portal Hypertension:</p>\n<ul>\n<li><strong>Non- Selective Shunt-</strong> bowel and splenic blood is shunted\n<ul>\n<li>Linton shunt (proximal lienorenal shunt with splenectomy)</li>\n<li>ECK fistula (portocaval shunt)</li>\n<li>Mitra shunt (splenorenal shunt)</li>\n</ul>\n</li>\n<li><strong>Selective Shunt</strong>- only splenic blood is shunted\n<ul>\n<li>Warren shunt (distal lienorenal shunt)</li>\n<li>Inokuchi shunt&nbsp;</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/359f406bedde4a5981bb94a8698e1b6c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c15c8d63ef6c4bccaadb8b81ad981bb2x1280x2560.JPEG"
    ]
  },
  {
    "text": "A patient with liver cirrhosis is scheduled to undergo a laparotomy for a perforated appendix. According to the Child-Turcotte-Pugh score, which of the following parameters will you not use for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Ascites"
      },
      {
        "id": 2,
        "text": "INR"
      },
      {
        "id": 3,
        "text": "Encephalopathy"
      },
      {
        "id": 4,
        "text": "Creatinine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Creatinine </strong>is <strong>not included </strong>in the<strong> Child&ndash;Turcotte&ndash;Pugh </strong>score or Child-Pugh scoring system.&nbsp;</p>\n<p>It is used to assess the&nbsp;<strong>surgical mortality of cirrhotic patients</strong> undergoing intra-abdominal operations.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a  component of MELD  score?",
    "choices": [
      {
        "id": 1,
        "text": "Creatinine"
      },
      {
        "id": 2,
        "text": "Serum Bilirubin"
      },
      {
        "id": 3,
        "text": "INR"
      },
      {
        "id": 4,
        "text": "Urea"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In MELD (model for end-stage liver disease) score,<strong>\u00a0urea</strong>\u00a0is <strong>not</strong> one of the <strong>components.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old male patient who was diagnosed with gangrenous appendix underwent an appendicectomy. On the second postoperative day, he developed fever, chills, jaundice, and right upper quadrant pain. Blood cultures revealed bacteremia and ultrasound abdomen revealed multiple hepatic abscesses. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Peliosis hepatis"
      },
      {
        "id": 2,
        "text": "Pylephlebitis"
      },
      {
        "id": 3,
        "text": "Hepatic necrotic nodule"
      },
      {
        "id": 4,
        "text": "Melioidosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the setting of existing appendicitis, the above clinical scenario points to a diagnosis of <strong>pylephlebitis </strong>(portal pyemia).</p>\n<p>Pylephlebitis is <strong>thrombophlebitis&nbsp;</strong>of the <strong>portal venous system.</strong>&nbsp;It<strong>&nbsp;</strong>is a rare but very serious complication of <strong>intra-abdominal infections</strong>, such as gangrenous appendicitis, diverticulitis, etc. It spreads to the portal circulation via the mesenteric vein.</p>\n<p>Clinical features are high fever, rigors, and jaundice and intrahepatic abscesses (often multiple) due to septicemia in the portal venous system.&nbsp;Treatment is with <strong>systemic antibiotics</strong> and <strong>percutaneous drainage</strong> of hepatic abscesses.</p>\n<p>Option A: Peliosis hepatis is&nbsp;an uncommon vascular condition characterized by hemorrhagic dilatation of the hepatic sinusoids<strong>.</strong></p>\n<p>Option C: Hepatic necrotic nodules are usually small, solitary lesions, mainly located under the liver capsule of the right lobe. It is characterized by a necrotic central core surrounded by a dense hyalinized fibrotic capsule.</p>\n<p>Option D: <strong>Melioidosis</strong> is an infectious disease caused by <em><strong>Burkholderia</strong>&nbsp;<strong>pseudomallei</strong></em> characterised by fever and <strong>multiple abscess formation</strong> in the lungs, liver, prostate, and spleen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old male patient presented to the hospital with right upper quadrant pain and jaundice for the past 5 days. CT abdomen revealed the following finding and cultures of aspirate showed extensive bacterial growth. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anchovy sauce pus is seen on aspiration of abscess"
      },
      {
        "id": 2,
        "text": "Fever with chills is the most common presenting complaint"
      },
      {
        "id": 3,
        "text": "Eschericia coli and Klebsiella species are the most common organisms implicated"
      },
      {
        "id": 4,
        "text": "Ascending infection from the biliary tract is the most common route of spread"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given CT image shows cluster sign and the above clinical scenario is suggestive of&nbsp;<strong>pyogenic liver abscess</strong>. <strong>Anchovy sauce pus</strong> on aspiration is seen in<strong> amoebic liver abscess.</strong></p>\n<p>Pyogenic liver abscess is a polymicrobial infection seen more commonly in the <strong>elderly</strong> and<strong> immunocompromised</strong>. Ascending infection from the biliary tree (ascending suppurative cholangitis) is the <strong>most common</strong> route of spread.</p>\n<p><strong>The portal vein </strong>is the second most common source of infection leading to<strong> pylephlebitis </strong>(thrombophlebitis&nbsp;of the&nbsp;portal venous system causing portal pyemia) secondary to diverticulitis, appendicitis, pancreatitis, etc.</p>\n<p><strong>Organism:</strong></p>\n<ul>\n<li>Most common in <strong>western countries</strong>: <em>Escherichia coli</em></li>\n<li>Most common in <strong>Asian countries: </strong><em>Klebsiella pneumoniae</em></li>\n<li>Most common in children suffering from the chronic granulomatous disease<strong>: <em>Staphylococcus</em></strong></li>\n<li>Most common in gas-forming abscess<strong>: <em>Klebsiella</em></strong></li>\n</ul>\n<p>Order of affected lobe: <strong>Right lobe </strong>(75%) &gt; left lobe (20%) &gt; caudate lobe (5%). Right lobe predilection might be due to preferential laminar blood flow.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3e0fa35904c1459e8cabf44c97a51369.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding investigations in a pyogenic liver abscess is true?",
    "choices": [
      {
        "id": 1,
        "text": "X-Ray findings are diagnostic."
      },
      {
        "id": 2,
        "text": "USG shows hypoechoic lesion with poorly defined borders"
      },
      {
        "id": 3,
        "text": "Elevated ALP is the most common abnormal LFT."
      },
      {
        "id": 4,
        "text": "PT and INR are normal"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Elevated serum alkaline phosphatase (ALP)</strong> level is the most common abnormal liver function test (LFT) in pyogenic liver abscess.</p>\n<p>&nbsp;<strong>Laboratory features in pyogenic liver abscess:</strong></p>\n<ul>\n<li>Non-specific findings such as leukocytosis, anemia</li>\n<li><strong>Elevated ALP</strong> (most common), elevated bilirubin levels, increased prothrombin time (PT) and INR (chronic infection).</li>\n<li>Positive blood culture in 50% cases</li>\n</ul>\n<p><strong>Ultrasonography </strong>(USG) and <strong>computed tomography </strong>(CT) are<strong> investigations of choice </strong>. In ultrasound, pyogenic liver abscess appears as round or oval hypoechoic lesions with <strong>well defined borders </strong>and variable number of internal echoes. On CT, <strong>cluster sign</strong> is a feature of pyogenic hepatic abscesses.</p>\n<p>Cluster sign in CT:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1f8a2d2b794e45f3b7e2f7be21b77de8x743x599.PNG"
    ]
  },
  {
    "text": "A healthy 55-year-old man presented with a 1-week history of fevers, chills, right upper quadrant tenderness, and hepatomegaly. CT was suggestive of a pyogenic liver abscess. Which of the following statements regarding management is true?",
    "choices": [
      {
        "id": 1,
        "text": "Empiric IV antibiotic therapy is first line"
      },
      {
        "id": 2,
        "text": "Percutaneous drainage is not routinely done"
      },
      {
        "id": 3,
        "text": "Open drainage is done with T-tube placement"
      },
      {
        "id": 4,
        "text": "Resection of the affected lobe is the treatment of choice"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Empiric IV antibiotic therapy</strong> is the <strong>first-line</strong> treatment for pyogenic liver abscess.</p>\n<p>Percutaneous drainage using a pigtail catheter is done routinely. It helps in the&nbsp;<strong>slow decompression </strong>of a cyst with viscous contents. It also has a lesser chance of dislodgement.&nbsp;Drainage tube&nbsp;catheter is placed under US/CT guidance into the liver abscess.</p>\n<p>Surgical drainage using a&nbsp;<strong>laparoscopic </strong>or<strong> open approach</strong> is tried only&nbsp;when <strong>antibiotic therapy</strong> and <strong>percutaneous drainage fails.&nbsp;</strong>Open drainage is becoming less common&nbsp;at present.&nbsp;<strong>Liver resection</strong> is only occasionally required&nbsp;in <strong>severe hepatic destruction</strong>.</p>\n<p>Pigtail catheter:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d695aede686b43909ff20d84e77254acx620x321.JPEG"
    ]
  },
  {
    "text": "A 35-year-old daily wage laborer presented with fever and abdominal pain for the past 1 week. Laboratory investigations showed anti-amoebic antibodies and CT abdomen showed the following. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Associated with alcohol consumption"
      },
      {
        "id": 2,
        "text": "Anchovy sauce pus is seen on aspiration"
      },
      {
        "id": 3,
        "text": "More common in females"
      },
      {
        "id": 4,
        "text": "Not usually associated with diarrhoea"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient most likely has an <strong>amoebic liver abscess.\u00a0</strong>It is more common in <strong>males</strong> than females (10:1).</p>\n<p>Risk factors include:</p>\n<ul>\n<li><strong>Males</strong>, 20-40 years of age</li>\n<li><strong>Heavy alcohol</strong> consumption - liver becomes more susceptible</li>\n<li>Travel to an\u00a0<strong>endemic</strong> area</li>\n<li><strong>Poverty</strong> and cramped living conditions</li>\n<li><strong>Impaired host immunity</strong></li>\n<li>Colonic infection</li>\n</ul>\n<p>The most common sites for amoebic liver abscesses are <strong>liver</strong> and <strong>paracaecal areas</strong>. The aspirate shows a characteristic <strong>anchovy sauce</strong> pus.</p>\n<p>Even though this disease process is secondary to a colonic infection, the presence of <strong>diarrhoea </strong>is<strong> unusual.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/68b51461465f4eb19f1d5dd320835214.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements regarding amoebic liver abscess is false?",
    "choices": [
      {
        "id": 1,
        "text": "Culture of the aspirate is positive."
      },
      {
        "id": 2,
        "text": "The diagnosis is based on the detection of antiamebic antibodies."
      },
      {
        "id": 3,
        "text": "Management mainly consists of conservative treatment with metronidazole."
      },
      {
        "id": 4,
        "text": "Technetium 99m scan is negative."
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The culture of the amoebic abscess is usually <strong>sterile </strong>or <strong>negative.</strong></p>\n<p>The most useful laboratory evaluation is the measurement of cir\u00adculating <strong>anti-amoebic antibodies</strong>, by enzyme immunoassay. The <strong>antibody </strong>can be present because of<strong> prior infection</strong>, and hence, detection of <em>Entamoeba histolytica</em> <strong>lectin antigen</strong> in the serum and liver abscess pus is <strong>more useful</strong> for <strong>acute infections</strong> than chronic infection.</p>\n<p>Nuclear medicine studies, such as <strong>gallium scanning </strong>or <strong>technetium (<sup>99m</sup>Tc)\u00a0 </strong>liver scans, can be helpful in differentiating pyogenic from amebic abscesses because amebic abscesses typically do not contain leukocytes and therefore <strong>do not light up</strong> on these scans.</p>\n<p>The mainstay of<strong> treatment </strong>for amebic abscesses is <strong>metronidazole</strong> (750 mg orally, three times daily for 10 days), which is <strong>curative.\u00a0</strong><strong>Luminal agents</strong> such as iodoquinol, paromomycin, and diloxanide furoate can be administered into the cysts.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following are not indications for percutaneous aspiration in a patient with a suspected amoebic liver abscess?",
    "choices": [
      {
        "id": 1,
        "text": "Uncertain diagnosis"
      },
      {
        "id": 2,
        "text": "Left lobe abscess"
      },
      {
        "id": 3,
        "text": "Failure to respond to medical therapy"
      },
      {
        "id": 4,
        "text": "Abscess measuring 3 cm"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Percutaneous aspiration</strong> should be<strong> performed</strong> in amoebic liver <strong>abscess more than 5 cm.&nbsp;</strong></p>\n<p>Indications for percutaneous aspiration in amoebic liver abscess are:</p>\n<ul>\n<li><strong>Large abscesses (&gt;5 cm)</strong></li>\n<li>Lack of response to medical therapy (in 5 days)</li>\n<li>Suspicion of superinfection</li>\n<li><strong>Abscesses of the left lobe</strong> of the liver at risk for rupture into the pericardium</li>\n<li>Uncertain diagnosis</li>\n</ul>\n<p>Laboratory<strong> investigations</strong> may reveal <strong>similar</strong> complete <strong>blood cell count</strong> and l<strong>iver function test abnormalities</strong> in patients with amoebic liver abscesses and pyogenic liver abscesses. An <strong>elevated serum alkaline phosphatase (ALP) level</strong> is seen in both and is <strong>not specific.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the given image, which of the following structures are matched correctly?",
    "choices": [
      {
        "id": 1,
        "text": "4,5"
      },
      {
        "id": 2,
        "text": "3,4,5"
      },
      {
        "id": 3,
        "text": "1 and 5"
      },
      {
        "id": 4,
        "text": "2 and 4"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Hydatid disease</strong> or echinococcosis is a <strong>zoonotic infection</strong> caused by the <em>Echinococcus</em> species of <strong>flatworms</strong>. Its life cycle consists of sheep and dogs as hosts. Humans are accidental hosts.</p>\n<p>A <strong>hydatid cyst</strong> usually develops<strong> three weeks</strong> after the infection. The cyst is surrounded by a fibrous capsule called <strong>pericyst</strong> that is derived from the host tissue.</p>\n<p>The cyst wall is composed of two layers, <strong>ectocyst</strong> (outer gelatinous membrane), and <strong>endocyst</strong> (inner germinal membrane). Ectocyst is a laminated membrane, which is acellular. It helps in the passage of nutrients. The endocyst helps in producing the laminated membrane and scoleces.</p>\n<p>The <strong>brood capsules</strong> are cellular masses in the hydatid fluid which consists of <strong>scoleces</strong>. In a <strong>definitive host</strong>, these scoleces develop into adult tapeworm while in the <strong>intermediate hosts </strong>these develop into new hydatid cysts. The brood capsules are attached to the endocyst by a pedicle or stalk.&nbsp;</p>\n<p>The brood capsules may mature and detach from the mother cyst and become the <strong>daughter cysts, </strong>which are an exact replica of the mother cysts. The freed brood capsules and scoleces present in the hydatid fluid are called<strong> hydatid sand</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/305b49bf852d4595afd5b4f2c2f567ab.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7865ac14b88340fd8d484ad0821d399cx1280x1548.JPEG"
    ]
  },
  {
    "text": "A patient was incidentally found to have a fluid filled cyst in his liver when he underwent a USG abdomen to check for renal calculi. It was later diagnosed as echinococcosis. Which of the following is false regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dogs are definitive hosts"
      },
      {
        "id": 2,
        "text": "Rupture can lead to severe anaphylactic reaction"
      },
      {
        "id": 3,
        "text": "It is usually asymptomatic"
      },
      {
        "id": 4,
        "text": "Echinococcus multilocularis is the most common causative agent"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Multiple hydatid cysts:&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a3b7065775fc4de29306b03d7bee037ax617x435.GIF",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/56cace72746948998019f12db0c817e8x512x314.PNG"
    ]
  },
  {
    "text": "A young villager presents to the clinic with abdominal pain for the past 1 month. He mentions that he keeps sheep inside the house. On examination, you feel a firm mass in the right hypochondrium and a hepatic hydatid cyst is suspected. Which of the following investigations have the highest sensitivity in confirming the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "USG"
      },
      {
        "id": 2,
        "text": "Casoni\u2019s test"
      },
      {
        "id": 3,
        "text": "CT scan"
      },
      {
        "id": 4,
        "text": "ELISA"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Note:&nbsp;</strong>First/Initial imaging test is USG, best imaging test is CT scan</p>\n<p>CT scan showing multiple hydatid cysts with detached wavy membranes:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f9502982bbef420b9bb6008cd3b6bd17x767x600.JPEG"
    ]
  },
  {
    "text": "A patient is suspected to have a hydatid cyst of the liver. If imaging studies are performed, all of the following signs will denote detached or collapsed cyst except____",
    "choices": [
      {
        "id": 1,
        "text": "Serpent sign"
      },
      {
        "id": 2,
        "text": "Ball of wool sign"
      },
      {
        "id": 3,
        "text": "Water lily sign"
      },
      {
        "id": 4,
        "text": "Double line sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>water-lily sign</strong>&nbsp;is seen in hydatid infections when there is <strong>detachment of the endocyst membrane</strong> which results in <strong>floating membranes within the pericyst</strong> that mimic the appearance of a water lily, on <strong>USG.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59a578902e184691b5cc653d982e9f69x767x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/57aca12fd6bb49ee979afe66750bf842x232x282.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/66b5132aaa314a67b19fb4145f1bb0e0x1280x817.PNG"
    ]
  },
  {
    "text": "A young sheep farmer presents to the OPD with pain in the right upper part of the abdomen. On examination, there is tenderness and enlargement of the liver. Abdominal ultrasound shows the following finding. As per the WHO classification of cystic echinococcosis, which class does this belong to?",
    "choices": [
      {
        "id": 1,
        "text": "CE3B"
      },
      {
        "id": 2,
        "text": "CE2"
      },
      {
        "id": 3,
        "text": "CE3A"
      },
      {
        "id": 4,
        "text": "CE4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<table style=\"height: 574px; width: 407.743px;\">\n<tbody>\n<tr style=\"height: 24px;\">\n<td style=\"width: 43px; height: 24px;\"><strong>Class</strong></td>\n<td style=\"width: 351.743px; height: 24px;\"><strong>Management</strong></td>\n</tr>\n<tr style=\"height: 94px;\">\n<td style=\"width: 43px; height: 94px;\">CE1&nbsp;</td>\n<td style=\"width: 351.743px; height: 94px;\">\n<p>&lt;5 cm albendazole 400 mg PO BD</p>\n<p>&gt;5 cm&nbsp;albendazole 400 mg PO BD+PAIR</p>\n</td>\n</tr>\n<tr style=\"height: 94px;\">\n<td style=\"width: 43px; height: 94px;\">CE3a</td>\n<td style=\"width: 351.743px; height: 94px;\">\n<p>&lt;5 cm albendazole 400 mg PO BD</p>\n<p>&gt;5 cm&nbsp;albendazole 400 mg PO BD+PAIR</p>\n</td>\n</tr>\n<tr style=\"height: 170px;\">\n<td style=\"width: 43px; height: 170px;\">CE2,<br />CE3b</td>\n<td style=\"width: 351.743px; height: 170px;\">\n<p>PAIR contraindicated</p>\n<p>Large bore percutaneous treatment</p>\n<p>Surgery+albendazole 400 mg PO BID.</p>\n</td>\n</tr>\n<tr style=\"height: 114px;\">\n<td style=\"width: 43px;\">CE4,<br />CE5</td>\n<td style=\"width: 351.743px;\">\n<p>PAIR contraindicated</p>\n<p>Observation (ultrasonography preferred every 6 months)</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>CE: cystic echinococcosis</p>\n<p>PAIR:&nbsp;puncture, aspiration, injection, and reaspiration</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cf6292e94ff641fabd0e95ff4ee56a8f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old man presents with right upper quadrant pain for the last 6 weeks. On examination, a firm mass is palpable in the right hypochondrium region. CECT abdomen shows a 6 cm cystic structure in the right lobe of the liver along with water lily sign. Which of the following is the ideal management for him?",
    "choices": [
      {
        "id": 1,
        "text": "Laparoscopic cystectomy+ scolicidal agent instillation"
      },
      {
        "id": 2,
        "text": "Large bore percutaneous drainage"
      },
      {
        "id": 3,
        "text": "Albendazole therapy + PAIR"
      },
      {
        "id": 4,
        "text": "Careful observation with imaging every 6 months"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<table style=\"height: 574px; width: 407.743px;\">\n<tbody>\n<tr style=\"height: 24px;\">\n<td style=\"width: 43px; height: 24px;\"><strong>Class</strong></td>\n<td style=\"width: 351.743px; height: 24px;\"><strong>Management</strong></td>\n</tr>\n<tr style=\"height: 94px;\">\n<td style=\"width: 43px; height: 94px;\">CE1&nbsp;</td>\n<td style=\"width: 351.743px; height: 94px;\">\n<p>&lt;5 cm albendazole 400 mg PO BD</p>\n<p>&gt;5 cm&nbsp;albendazole 400 mg PO BD+PAIR</p>\n</td>\n</tr>\n<tr style=\"height: 94px;\">\n<td style=\"width: 43px; height: 94px;\">CE3a</td>\n<td style=\"width: 351.743px; height: 94px;\">\n<p>&lt;5 cm albendazole 400 mg PO BD</p>\n<p>&gt;5 cm&nbsp;albendazole 400 mg PO BD+PAIR</p>\n</td>\n</tr>\n<tr style=\"height: 170px;\">\n<td style=\"width: 43px; height: 170px;\">CE2,<br />CE3b</td>\n<td style=\"width: 351.743px; height: 170px;\">\n<p>PAIR contraindicated</p>\n<p>Large bore percutaneous treatment</p>\n<p>Surgery+albendazole 400 mg PO BID.</p>\n</td>\n</tr>\n<tr style=\"height: 114px;\">\n<td style=\"width: 43px;\">CE4,<br />CE5</td>\n<td style=\"width: 351.743px;\">\n<p>PAIR contraindicated</p>\n<p>Observation (ultrasonography preferred every 6 months)</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p>CE: cystic echinococcosis; PAIR:&nbsp;puncture, aspiration, injection, and reaspiration</p>\n<p>When <strong>PAIR</strong> is <strong>contraindicated</strong> <strong>( CE2, CE3B)</strong>, surgical resection involving laparoscopic or open complete <strong>cystectomy</strong> with instillation of a<strong> scolicidal</strong> agent is preferred and is usually curative. If complete cystectomy is not possible, then anatomic liver resection can be undertaken.</p>\n<p><strong>Careful observation</strong> and ultrasound evaluation every 6 months are recommended<strong> CE4 and CE5 categories</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is a contraindication for performing PAIR technique in hydatid cyst disease?",
    "choices": [
      {
        "id": 1,
        "text": "Transitional cyst with detached membranes"
      },
      {
        "id": 2,
        "text": "Pregnant woman with CE1 hydatid cyst"
      },
      {
        "id": 3,
        "text": "Hydatid cyst with honeycomb appearance"
      },
      {
        "id": 4,
        "text": "Cyst > 5 cm in different liver segments"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>A <strong>hydatid cyst </strong>with<strong> honeycomb appearance </strong>(CE2)&nbsp;is a <strong>contraindication </strong>for PAIR (Puncture-Aspiration-Injection-Reaspiration).&nbsp;</p>\n<p>PAIR is unlikely to be successful in CE2 due to the presence of <strong>multiple internal septa.</strong></p>\n<p>The PAIR technique is performed using either<strong> ultrasound</strong> or <strong>computed tomography (CT) guidance.&nbsp;</strong></p>\n<p>It&nbsp;involves aspiration of the cyst contents via a special cannula, followed by injection of a scolicidal agent for at least 15 minutes, and then reaspiration of the cystic contents. This is repeated until the return is clear.&nbsp;An<strong> i</strong>nitial course of<strong> albendazole</strong> is administered before the procedure.<span class=\"Apple-converted-space\">&nbsp;</span></p>\n<div class=\"page\" title=\"Page 1312\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>When PAIR is contraindicated, surgical resection involving <strong>laparoscopic</strong> or <strong>open complete cystectomy</strong> with instillation of a scolicidal agent is preferred and is usually curative. If complete cystectomy is not possible, then anatomic liver resection can be undertaken.</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c4eae4cf423c4adf9b834c19e88b6aebx1280x4019.PNG"
    ]
  },
  {
    "text": "A dog trainer presented to the hospital with a history of pain in the upper part of the abdomen. The surgeon decides to perform a percutaneous aspiration, injection, and reaspiration (PAIR) of the cyst after a 6 cm single hydatid cyst was detected. All of the following can be used as scolicidal agents in this procedure except?",
    "choices": [
      {
        "id": 1,
        "text": "Alcohol"
      },
      {
        "id": 2,
        "text": "Formalin"
      },
      {
        "id": 3,
        "text": "Sodium hypochlorite"
      },
      {
        "id": 4,
        "text": "Povidone iodine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Formalin is <strong>not used as a scolicidal agent</strong> since it causes<strong><strong>&nbsp;</strong></strong>sclerosing cholangitis.&nbsp;</p>\n<p><strong>Scolicidal agents </strong>(used to avoid dissemination of parasite during surgery):</p>\n<ul>\n<li>Hypertonic saline&nbsp;</li>\n<li>Cetrimide&nbsp;</li>\n<li>Alcohol</li>\n<li>Sodium hypochlorite</li>\n<li>Povidone-iodine</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Capitonnage is used in the treatment of which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Pyogenic liver abscess"
      },
      {
        "id": 2,
        "text": "Hepatic tuberculosis"
      },
      {
        "id": 3,
        "text": "Hydatid cyst"
      },
      {
        "id": 4,
        "text": "Polycystic disease of liver"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Capitonnage</strong> is used in the treatment of hydatid cyst disease. It is the <strong>spiral suturing of the cavity </strong>upward from the base of the cavity to the edge of the cyst wall.</p>\n<p>Pyogenic liver abscess is treated with <strong>antibiotics</strong> and <strong>percutaneous drainage.</strong></p>\n<p>Hepatic tuberculosis is treated with <strong>quadruple therapy</strong> (isoniazid, rifampin, pyrazinamide, and ethambutol)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea541e43eeb2436ab3b8e0cc629e6a54x1280x1584.JPEG"
    ]
  },
  {
    "text": "Which of the following do not cause peliosis hepatis?",
    "choices": [
      {
        "id": 1,
        "text": "Analgesics"
      },
      {
        "id": 2,
        "text": "Bartonella infection"
      },
      {
        "id": 3,
        "text": "Anabolic steroids"
      },
      {
        "id": 4,
        "text": "Tamoxifen"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Often an incidental finding, many patients present without symptoms. Less frequently, patients may present with signs more consistent with hepatobiliary pathology such as&nbsp;right upper quadrant<strong> pain, jaundice,</strong> and signs of portal hypertension.</p>\n<p><strong>Laboratory studies</strong>, such as LFT may or may not demonstrate changes. CT or MRI angiography often demonstrates contrast accumulating within the parenchyma itself or the sinusoids.<strong>&nbsp;</strong>A<strong> biopsy</strong>&nbsp;is the <strong>best modality&nbsp;to confirm </strong>the diagnosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/026c2a7e3be24d84b1e94722c41cc1a2x512x440.PNG"
    ]
  }
];
        let quizName = '28 Benign Conditions Of Liver';
        const quizFilename = '28-benign-conditions-of-liver-cc734246.html';
        let hierarchy = ["Marrow", "qBank", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>