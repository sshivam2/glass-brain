<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>002 Acid-Base Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Medicine
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">25</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the most effective extracellular buffer system at physiological pH?",
    "choices": [
      {
        "id": 1,
        "text": "Bicarbonate buffer"
      },
      {
        "id": 2,
        "text": "Phosphate buffer"
      },
      {
        "id": 3,
        "text": "Protein buffer"
      },
      {
        "id": 4,
        "text": "Ammonia buffer"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most effective extracellular buffer system at physiological pH is the <strong>bicarbonate buffer</strong> system.</p>\n<p>A molecule with a pKa close to the physiological pH (<strong>7.4</strong>) is considered an effective buffer.&nbsp;Although the pKa of HCO<sub>3</sub><sup>-</sup> is relatively low (<strong>6.1</strong>), it makes up 92% of the plasma buffering.</p>\n<p>This is often attributed to the enormous quantity of HCO<sub>3</sub><sup>-</sup> present in the body and the ability of this system to accept protons and form carbonic acid (H<sub>2</sub>CO<sub>3</sub>). This further in the presence of carbonic anhydrase is converted to readily excretable H\u2082O and CO<sub>2</sub>. It is therefore considered the most efficient extracellular buffering system in the body.&nbsp;</p>\n<p>HCO<sub>3</sub><sup>-&nbsp;</sup>+&nbsp;H<sup>+</sup>&harr;&nbsp;H<sub>2</sub>CO<sub>3&nbsp;</sub>&harr;&nbsp;H\u2082O +&nbsp;CO<sub>2</sub></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not done before drawing blood for arterial blood gas analysis?",
    "choices": [
      {
        "id": 1,
        "text": "Allen's test"
      },
      {
        "id": 2,
        "text": "Rinse syringe with heparin"
      },
      {
        "id": 3,
        "text": "Flexion of wrist"
      },
      {
        "id": 4,
        "text": "Placing needle at 45 degree angle"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The syringe used to draw blood for ABG analysis is <strong>rinsed with heparin</strong> prior to the procedure.&nbsp;Prior to collecting blood, 0.1 ml heparin is drawn into the syringe and then flushed out. The residue that lubricates the inner wall of the syringe&nbsp;is sufficient to prevent the blood from clotting.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ea86fa0647a9456bac259846ddc9dd57x1280x1474.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/59fa46e281d74732bbefef2cf5b70c5dx1280x3192.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a cause of metabolic alkalosis?",
    "choices": [
      {
        "id": 1,
        "text": "Mineralocorticoid deficiency"
      },
      {
        "id": 2,
        "text": "Hypokalemia"
      },
      {
        "id": 3,
        "text": "Thiazide diuretic therapy"
      },
      {
        "id": 4,
        "text": "Recurrent vomiting"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Mineralocorticoid deficiency does not cause metabolic alkalosis. Its excess causes metabolic alkalosis.</p>\n<p><strong>Causes of metabolic alkalosis: </strong></p>\n<p>Loss of hydrogen:</p>\n<ul>\n<li>Gastrointestinal loss <br />\n<ul>\n<li>Removal of gastric secretions -&nbsp;<strong>vomiting</strong> or nasogastric suction</li>\n<li>Chloride-losing diarrhea</li>\n<li>Gastrocolic fistula</li>\n<li>Villous adenoma</li>\n<li>Antacid therapy, particularly if combined with cation exchange resin</li>\n</ul>\n</li>\n<li>Renal loss <br />\n<ul>\n<li>Loop or<strong> thiazide</strong> diuretics</li>\n<li>Mineralocorticoid excess (primary aldosteronism, Cushing's, steroids, licorice)</li>\n<li>Posthypercapnic states</li>\n<li>Hypercalcemia, including milk-alkali syndrome</li>\n</ul>\n</li>\n<li>H<sup>+</sup> movement into cells\n<ul>\n<li><strong>Hypokalemia</strong></li>\n</ul>\n</li>\n</ul>\n<p>Exogenous Alkali:</p>\n<ul>\n<li>Administration of NaHCO3, sodium citrate/gluconate/acetate/antacids</li>\n<li>Massive blood transfusion</li>\n<li>Antacids- Milk alkali syndrome</li>\n</ul>\n<p>Contraction alkalosis (loss of ECF volume):</p>\n<ul>\n<li>Loop or thiazide-type diuretics</li>\n<li>Sweat losses in cystic fibrosis</li>\n<li>Gastric losses in achlorhydria</li>\n</ul>\n<p>Miscellaneous:</p>\n<ul>\n<li>Bartter's syndrome</li>\n<li>Gitelman's syndrome</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which metabolic abnormality are patients with bulimia nervosa least likely to develop?",
    "choices": [
      {
        "id": 1,
        "text": "Hyponatremia"
      },
      {
        "id": 2,
        "text": "Hypochloremia"
      },
      {
        "id": 3,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 4,
        "text": "Metabolic acidosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The metabolic abnormality patients with bulimia nervosa are<strong> least likely </strong>to develop is<strong> metabolic acidosis. Chronic vomiting, </strong>as seen in bulimia nervosa leads to <strong>m</strong><strong>etabolic alkalosis, </strong>not acidosis.</p>\n<p>Conditions associated with chronic vomiting lead to<strong>&nbsp;hypochloremia, hyponatremia, hypokalemia, </strong>and<strong> metabolic alkalosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is false about metabolic alkalosis?",
    "choices": [
      {
        "id": 1,
        "text": "It is associated with hyperkalemia"
      },
      {
        "id": 2,
        "text": "It is associated with decreased ionic calcium concentration"
      },
      {
        "id": 3,
        "text": "Can be caused due to Conn's syndrome"
      },
      {
        "id": 4,
        "text": "Can be caused due to a renin secreting tumor"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Metabolic alkalosis</strong> is associated with <strong>potassium depletion</strong>, not hyperkalemia.</p>\n<p>While hypercalcemia can be a cause of metabolic alkalosis, alkalosis itself can cause a <strong>decrease in ionized calcium</strong>. The patients can present with tetany and show signs of hypocalcemia, i.e., Trousseau sign and Chvostek's sign.</p>\n<p><strong>Conn's syndrome</strong> is primary hyperaldosteronism that leads to sodium reabsorption in exchange for hydrogen in the collecting ducts. This causes hypernatremia, hypokalemia, and hydrogen loss in urine and may lead to metabolic alkalosis.</p>\n<p><strong>Renin-secreting tumors</strong> also lead to an increase in aldosterone levels leading to alkalosis.</p>\n<p><strong>Causes of metabolic alkalosis: </strong></p>\n<p>Loss of hydrogen:</p>\n<ul>\n<li>Gastrointestinal loss <br />\n<ul>\n<li>Removal of gastric secretions- vomiting or nasogastric suction</li>\n<li>Chloride-losing diarrhea</li>\n<li>Gastrocolic fistula</li>\n<li>Villous adenoma</li>\n<li>Antacid therapy, particularly if combined with cation exchange resin</li>\n</ul>\n</li>\n<li>Renal loss <br />\n<ul>\n<li>Loop or thiazide diuretics</li>\n<li>Mineralocorticoid excess (primary aldosteronism, Cushing's, steroids, licorice)</li>\n<li>Posthypercapnic states</li>\n<li>Hypercalcemia, including the milk-alkali syndrome</li>\n<li>&nbsp;</li>\n</ul>\n</li>\n<li>H<sup>+</sup> movement into cells\n<ul>\n<li>Hypokalemia</li>\n</ul>\n</li>\n</ul>\n<p>Exogenous Alkali:</p>\n<ul>\n<li>Administration of NaHCO3, sodium citrate/gluconate/acetate/antacids</li>\n<li>Massive blood transfusion</li>\n<li>Antacids- Milk alkali syndrome</li>\n</ul>\n<p>Contraction alkalosis&nbsp;(loss of ECF volume):</p>\n<ul>\n<li>Loop or thiazide-type diuretics</li>\n<li>Sweat losses in cystic fibrosis</li>\n<li>Gastric losses in achlorhydria</li>\n</ul>\n<p>Miscellaneous:</p>\n<ul>\n<li>Bartter's syndrome</li>\n<li>Gitelman's syndrome</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Metabolic alkalosis is suspected in a patient presenting with multiple episodes of vomiting. Which of the following laboratory results would be seen in his arterial blood gas analysis?",
    "choices": [
      {
        "id": 1,
        "text": "Option 1"
      },
      {
        "id": 2,
        "text": "Option 3"
      },
      {
        "id": 3,
        "text": "Option 2"
      },
      {
        "id": 4,
        "text": "Option 4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Among the given options,<strong> high pH</strong> (7.55),<strong> high HCO<sub>3</sub><sup>-</sup></strong>&nbsp;(30 mEq/L), and <strong>high pCO<sub>2&nbsp;</sub></strong>(48 mmHg) is suggestive of <strong>metabolic alkalosis</strong> with respiratory acidosis, as a result of compensatory hypoventilation.</p>\n<p>Multiple episodes of vomiting result in loss of acids from the body and thus increases the pH.</p>\n<table style=\"height: 387px; width: 442px;\">\n<tbody>\n<tr style=\"height: 20.0312px;\">\n<td style=\"width: 53.6364px; height: 20.0312px;\">&nbsp;</td>\n<td style=\"width: 70.8381px; height: 20.0312px;\"><strong>pH</strong></td>\n<td style=\"width: 79.0199px; height: 20.0312px;\">\n<p><strong>pCO2</strong></p>\n<p><strong>(mmHg)</strong></p>\n</td>\n<td style=\"width: 78.4375px; height: 20.0312px;\">\n<p><strong>HCO3&macr;</strong></p>\n<p><strong>(mEq/L)</strong></p>\n</td>\n<td style=\"width: 127.273px; height: 20.0312px;\">\n<p><strong>Interpretation</strong></p>\n</td>\n</tr>\n<tr style=\"height: 29px;\">\n<td style=\"width: 53.6364px; height: 29px;\">1</td>\n<td style=\"width: 70.8381px; height: 29px;\">\n<p>7.48</p>\n<p>(high)</p>\n</td>\n<td style=\"width: 79.0199px; height: 29px;\">\n<p>32</p>\n<p>(low)</p>\n</td>\n<td style=\"width: 78.4375px; height: 29px;\">\n<p>21</p>\n<p>(low)</p>\n</td>\n<td style=\"width: 127.273px; height: 29px;\">Respiratory alkalosis with compensatory metabolic acidosis</td>\n</tr>\n<tr style=\"height: 29px;\">\n<td style=\"width: 53.6364px; height: 29px;\">2</td>\n<td style=\"width: 70.8381px; height: 29px;\">\n<p>7.32</p>\n<p>(low)</p>\n</td>\n<td style=\"width: 79.0199px; height: 29px;\">\n<p>30</p>\n<p>(low)</p>\n</td>\n<td style=\"width: 78.4375px; height: 29px;\">\n<p>22</p>\n<p>(low)</p>\n</td>\n<td style=\"width: 127.273px; height: 29px;\">Metabolic acidosis with compensatory respiratory alkalosis</td>\n</tr>\n<tr style=\"height: 29px;\">\n<td style=\"width: 53.6364px; height: 29px;\">3</td>\n<td style=\"width: 70.8381px; height: 29px;\">\n<p>7.28</p>\n<p>(low)</p>\n</td>\n<td style=\"width: 79.0199px; height: 29px;\">\n<p>50</p>\n<p>(high)</p>\n</td>\n<td style=\"width: 78.4375px; height: 29px;\">\n<p>32</p>\n<p>(high)</p>\n</td>\n<td style=\"width: 127.273px; height: 29px;\">Respiratory acidosis with compensatory metabolic alkalosis</td>\n</tr>\n<tr style=\"height: 29px;\">\n<td style=\"width: 53.6364px; height: 29px;\">4</td>\n<td style=\"width: 70.8381px; height: 29px;\">\n<p>7.55</p>\n<p>(high)</p>\n</td>\n<td style=\"width: 79.0199px; height: 29px;\">\n<p>48</p>\n<p>(high)</p>\n</td>\n<td style=\"width: 78.4375px; height: 29px;\">\n<p>30</p>\n<p>(high)</p>\n</td>\n<td style=\"width: 127.273px; height: 29px;\">Metabolic alkalosis with compensatory respiratory acidosis</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The arterial blood gas analysis of a patient reveals a pH of 7.55, pCO2- 54 mmHg, and HCO3- 40 mEq/L. What is the underlying disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Mixed acid-base disorder"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis with compensatory respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Respiratory acidosis with compensatory metabolic alkalosis"
      },
      {
        "id": 4,
        "text": "Respiratory alkalosis with compensatory metabolic acidosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The underlying disorder in this patient is&nbsp;<strong>metabolic alkalosis with compensatory respiratory acidosis.</strong></p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: A <strong>pH</strong> of <strong>7.55</strong>&nbsp;indicates <strong>alkalosis</strong>.</p>\n<p>Step 2: Plasma <strong>HCO<sub>3</sub><sup>-</sup></strong> is <strong>40</strong> mEq/L, which in the presence of a high pH indicates <strong>metabolic</strong> alkalosis.</p>\n<p>Step 3: pCO2 is 54 mmHg indicating <strong>respiratory acidosis</strong>. The increase in pCO2&nbsp;along with the increase in pH suggests that this is a compensatory response.</p>\n<p>Step 4: Assessing the compensatory response:</p>\n<p>On average, the<strong> pCO<sub>2</sub> rises 0.75 mmHg </strong>for every<strong> 1.0 mEq/L increment </strong>in the plasma<strong>&nbsp;HCO<sub>3</sub><sup>-</sup></strong></p>\n<p>In the above scenario,&nbsp;the plasma HCO<sub>3</sub>- concentration is increased to <strong>40 mEq/L</strong> (The average normal value is considered as <strong>24 mEq/L</strong>)<br /> <br />Thus, the HCO<sub>3</sub><sup>-</sup> elevation is 40 &ndash; 24 = <strong>16 mEq/L</strong><br /><br />Therefore, pCO<sub>2</sub> elevation should be 0.75 &times; 16 =\u202f <strong>12 mmHg</strong></p>\n<p>Now, considering that the average value of normal pCO<sub>2</sub> is 40 mmHg, the estimated pCO<sub>2</sub> measured should be 40 + 12= <strong>52 mmHg</strong>. <br /> <br />As pCO<sub>2</sub> is higher than the expected estimate, it is a case of metabolic alkalosis with compensatory respiratory acidosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The arterial blood gas analysis of a 50-year-old diabetic patient revealed the following values: pH- 7.2 and HCO3- 15 mEq/L. Which of the following statements is false regarding renal compensation in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Hydrogen ion secretion is increased"
      },
      {
        "id": 2,
        "text": "Bicarbonate reabsorption is decreased"
      },
      {
        "id": 3,
        "text": "Urinary acidity is increased"
      },
      {
        "id": 4,
        "text": "Urinary ammonia is increased"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The patient has low pH and decreased levels of bicarbonate which is indicative of <strong>metabolic acidosis</strong>. <strong>Bicarbonate</strong> reabsorption is<strong> increased</strong> in renal handling of metabolic acidosis.</p>\n<p>In response to metabolic acidosis, acidification of urine occurs by the following compensatory mechanisms:</p>\n<ul>\n<li>The <strong>proximal tubule</strong> <strong>reabsorbs</strong> all the filtered<strong> HCO<sub>3</sub><sup>-</sup>\u202f</strong>(as any loss of HCO<sub>3</sub><sup>-</sup>\u202fis equal to the addition of an equimolar amount of H<sup>+</sup>).</li>\n<li>The <strong>collecting duct excretes</strong> the daily <strong>H<sup>+</sup>\u202f</strong>load (loss of H<sup>+</sup>\u202fis equal to the addition of an equimolar amount of HCO<sub>3</sub><sup>-</sup>) primarily in the form of urinary <strong>ammonia</strong>.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Calculate the anion gap from the following values:\nNa+ = 137 mmol/L\nK+ = 4 mmol/L\nCl- = 100 mmol/L\nHCO3- = 15 mmol/L",
    "choices": [
      {
        "id": 1,
        "text": "22 mmol/L"
      },
      {
        "id": 2,
        "text": "16 mmol/L"
      },
      {
        "id": 3,
        "text": "10 mmol/L"
      },
      {
        "id": 4,
        "text": "12 mmol/L"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The anion gap is the <strong>difference between measured cations and measured anions</strong> and is estimated as:</p>\n<p><strong>Anion gap = [Na+] \u2013 ([Cl-] + [HCO3-])</strong></p>\n<p>Substituting the given values, AG is 22 mmol/L. <strong>Normal AG</strong> is <strong>6 to 12 mmol/L</strong> with an average of 10 mmol/L.</p>\n<p>The concentrations of anions and cations in plasma must be equal to maintain electrical neutrality. Therefore, there is no real \u201canion gap\u201d in the plasma.</p>\n<p>However, only certain cations and anions are routinely measured in the clinical laboratory. The <strong>cation normally measured </strong>is<strong> Na+</strong>, and the <strong>anions</strong> are usually <strong>Cl\u2212</strong> and <strong>HCO3\u2212</strong>. The value of plasma potassium is omitted from the calculation of the anion gap.</p>\n<p>Usually, the <strong>unmeasured anions exceed the unmeasured cations</strong>.</p>\n<p>The anion gap will increase if unmeasured anions rise or if unmeasured cations fall.</p>\n<p>The <strong>unmeasured anions</strong> include <strong>albumin</strong>,<strong> phosphate</strong>,<strong> sulfate</strong>, and other organic anions. The <strong>unmeasured cations</strong> include <strong>calcium</strong>,<strong> magnesium</strong>, and<strong> potassium</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In which of the following patients would you expect to find an increased anion gap?",
    "choices": [
      {
        "id": 1,
        "text": "Renal tubular acidosis"
      },
      {
        "id": 2,
        "text": "Addison's disease"
      },
      {
        "id": 3,
        "text": "Diarrhoea"
      },
      {
        "id": 4,
        "text": "Diabetic ketoacidosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The anion gap is <strong>increased</strong>\u00a0in ketoacidosis. The ketone bodies act as unmeasured anions and increase the anion gap.</p>\n<p>The anion gap is calculated as:</p>\n<p>AG = (Na<sup>+</sup>) \u2013 [(Cl<sup>-</sup>) + (HCO<sub>3</sub><sup>-</sup>)]</p>\n<p>The normal anion gap is 6 - 12 mEq/L (optimally &lt;10 mEq/L).</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "High anion gap acidosis with low bicarbonate levels is seen in all the following conditions except:",
    "choices": [
      {
        "id": 1,
        "text": "Renal tubular acidosis"
      },
      {
        "id": 2,
        "text": "Diabetic ketoacidosis"
      },
      {
        "id": 3,
        "text": "Lactic acidosis"
      },
      {
        "id": 4,
        "text": "Salicylate poisoning"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Renal tubular acidosis</strong> causes <strong>normal anion gap</strong> metabolic acidosis, not high anion gap acidosis.&nbsp;</p>\n<p>Normally, in the serum, the total number of cations is equal to the total number of anions. But, a few of the <strong>anionic proteins (e.g., albumin), phosphates, sulfates, and organic anions</strong> are not measured and this is called an <strong>anion gap</strong>. It is the difference between measured cations and measured anions and is estimated as:</p>\n<p><strong>Plasma anion gap = [Na+] &minus;([Cl-]+[HCO3-])</strong></p>\n<p>The normal anion gap ranges between <strong>6-12 mEq/L.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old man presented with nausea, dizziness, and hyperventilation. His arterial blood gas analysis and serum electrolyte levels revealed metabolic acidosis with a normal anion gap. Which of the following is the possible reason for this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Lactic acidosis"
      },
      {
        "id": 2,
        "text": "Chronic renal failure"
      },
      {
        "id": 3,
        "text": "Renal tubular acidosis"
      },
      {
        "id": 4,
        "text": "Methanol toxicity"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Metabolic acidosis</strong> with a <strong>normal anion gap</strong> is a feature of <strong>renal tubular acidosis</strong>.</p>\n<p>Renal tubular acidosis is a form of <strong>hyperchloraemic</strong> <strong>metabolic acidosis</strong> which occurs when the renal damage primarily affects tubular function without much effect on glomerular function. The bicarbonate loss leading to acidosis is mirrored&nbsp;by an increase in chloride concentration. Hence the unmeasured anions are unaffected and thus, the anion gap remains within normal limits.</p>\n<p>The result is a decrease in H<sup>+</sup> excretion which is greater than that can be explained by any change in the glomerular filtration rate (GFR). However, if the GFR is significantly depressed eg.,&nbsp;<strong>renal failure</strong>, the retention of fixed acids leads to a <strong>high anion gap metabolic acidosis</strong>.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not associated with type-A lactic acidosis?",
    "choices": [
      {
        "id": 1,
        "text": "Acute pyelonephritis with hypotension"
      },
      {
        "id": 2,
        "text": "Acute MI with free wall rupture"
      },
      {
        "id": 3,
        "text": "Cyanide toxicity"
      },
      {
        "id": 4,
        "text": "Metformin toxicity"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Metformin toxicity</strong> is associated with <strong>type B</strong> lactic acidosis.</p>\n<p>Lactic acidosis is defined as an increase in plasma lactate levels. The various types of lactic acidosis are:</p>\n<table style=\"width: 389px; height: 232px;\">\n<tbody>\n<tr>\n<td style=\"width: 186.5px;\"><strong>Type A&nbsp;</strong></td>\n<td style=\"width: 186.5px;\"><strong>Type B</strong></td>\n</tr>\n<tr>\n<td style=\"width: 186.5px;\">Occurs secondary to circulatory insufficiency or tissue hypoxia.</td>\n<td style=\"width: 186.5px;\">Occurs in the absence of systemic hypoperfusion.</td>\n</tr>\n<tr>\n<td style=\"width: 186.5px;\">\n<p>Associated with:</p>\n<ul>\n<li>Shock</li>\n<li>Cardiac failure</li>\n<li>Severe anemia</li>\n<li>Carbon monoxide toxicity</li>\n<li>Cyanide toxicity</li>\n</ul>\n</td>\n<td style=\"width: 186.5px;\">\n<p>Associated with:</p>\n<ul>\n<li>Malignancies</li>\n<li>Renal failure</li>\n<li>Hepatic failure</li>\n<li>Drugs like metformin, ethanol, ethylene glycol, and methanol</li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>D-lactic acidosis</strong> is an unusual form of metabolic acidosis. It occurs due to the formation of D-lactate by <strong>gut bacteria</strong>. It occurs in patients with:</p>\n<ul>\n<li>Short bowel syndrome</li>\n<li>Post-jejunoileal bypass</li>\n<li>Intestinal obstruction.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient with chronic kidney disease came with complaints of vomiting and diarrhea. His blood gas reports show pH = 7.40, HCO3- = 23 mEq/L, Na+ = 145 mEq/L, Cl- = 100 mEq/L. What is your probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "No acid base abnormality"
      },
      {
        "id": 2,
        "text": "Respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 4,
        "text": "High anion gap metabolic acidosis with metabolic alkalosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The probable diagnosis is a&nbsp;high anion gap metabolic acidosis<strong> (HAGMA) </strong>with<strong> metabolic alkalosis</strong>.</p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: The pH being&nbsp;<strong>7.4</strong>&nbsp;is within normal limits.</p>\n<p>Step 2: Plasma HCO<sub>3</sub><sup>-</sup> is <strong>23 mEq/L</strong> and again is within normal limits.</p>\n<p>At this juncture, we have ruled out options B and C as this particular clinical scenario is not suggestive of a simple acid-base disorder.</p>\n<p>Step 3: Calculating the Anion gap:</p>\n<p>\u202f\u202fAnion gap = [Na+] &ndash; ([Cl-] + [HCO3-])</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 145-(100+23)</p>\n<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= <strong>22 mEq/L</strong></p>\n<p>The presence of a high anion gap indicates that there's indeed an acid-base disorder, thus ruling out option A.</p>\n<p>A <strong>high anion gap </strong>indicates<strong> metabolic acidosis</strong>. However, HCO3- levels within normal limits suggest that there is also <strong>coexisting</strong> <strong>metabolic alkalosis</strong> in this patient.</p>\n<p>This can be confirmed by calculating the<strong>&nbsp;delta gap</strong>.</p>\n<p>Delta gap =&nbsp;<strong>&Delta;AG -&nbsp;&Delta;HCO<sub>3</sub><sup>-</sup></strong></p>\n<p>In this scenario: Delta gap = (22-10) - (24-23) = <strong>11</strong> <strong>mEq/L</strong></p>\n<p>Delta gap is &gt; +6 suggesting the presence of metabolic alkalosis along with HAGMA.</p>\n<p>If the delta gap is significantly <strong>positive (&gt;+6)</strong>,<strong> metabolic alkalosis</strong> is present because the rise in the anion gap is more than the fall in bicarbonate. If the delta gap is significantly <strong>negative (&lt;6)</strong> then <strong>hyperchloremic acidosis</strong> is usually present because a rise in the anion gap is less than a fall in bicarbonate.</p>\n<p>Alternatively, this can be confirmed by calculating the <strong>delta ratio</strong>.</p>\n<p>Delta ratio = the<strong> increase in Anion Gap / the decrease in HCO3-</strong></p>\n<p>It is used in the presence of a high anion gap metabolic acidosis (HAGMA), to check it is a &lsquo;pure&rsquo; HAGMA or if there is coexistant normal anion gap metabolic acidosis (NAGMA) or metabolic alkalosis.</p>\n<p>Delta ratio values:</p>\n<ul>\n<li>1-2 indicates HAGMA</li>\n<li>&lt; 1 indicates NAGMA + HAGMA</li>\n<li>&gt; 2 indicates HAGMA + Metabolic alkalosis</li>\n</ul>\n<p>In this scenario,</p>\n<p>Delta ratio = 12/1 = <strong>12</strong></p>\n<p>Thus, the acid-base disorder for the above scenario is <strong>HAGMA with metabolic alkalosis.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 5-year-old boy presents with generalized edema. Urine analysis showed protein 3+ and fat bodies. Which of the following would you expect to see in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Decrease in unmeasured anions"
      },
      {
        "id": 2,
        "text": "Decrease in measured anions"
      },
      {
        "id": 3,
        "text": "Normal anion gap"
      },
      {
        "id": 4,
        "text": "High anion gap"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario is suggestive of<strong> nephrotic syndrome</strong>. This&nbsp;leads to a <strong>decrease in serum albumin</strong> which is an <strong>unmeasured anion</strong>.</p>\n<p>Albumin at physiological pH is the major contributor to the unmeasured anions of the body. Unmeasured anions consume bicarbonate in the body and reduce its levels. This leads to an increase in the anion gap. Therefore, when these <strong>unmeasured anions</strong> are<strong> reduced</strong> the <strong>anion gap</strong> also <strong>reduces</strong> due to decreased consumption of the bicarbonate.</p>\n<p>Nephrotic syndrome causes hypoalbuminemia and thus patients have a <strong>reduced anion gap</strong>.&nbsp;A fall in serum albumin by 1 g/dL from the normal value (4.5 g/dL) decreases the anion gap by 2.5 mEq/L.</p>\n<p>Decreased anion gap (&lt;6 mEq/L) is seen in:</p>\n<ul>\n<li>Increase in unmeasured cations</li>\n<li>An addition of abnormal cations to the blood, such as:\n<ul>\n<li>Lithium (lithium intoxication)</li>\n<li>Cationic immunoglobulins (plasma cell dyscrasias)</li>\n</ul>\n</li>\n<li>Reduction in the plasma anion albumin concentration (nephrotic syndrome, liver disease, or malabsorption)</li>\n<li>Bromide intoxication</li>\n<li>Hyperviscosity and severe hyperlipidemia, which can lead to an underestimation of sodium and chloride concentrations.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 54-year-old male patient with renal failure has missed a round of dialysis. He complains of lethargy, anorexia, and vomiting. What is the probable acid-base disorder that we can expect in him?",
    "choices": [
      {
        "id": 1,
        "text": "High anion gap metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis with compensatory respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Normal anion gap metabolic acidosis"
      },
      {
        "id": 4,
        "text": "Mixed acid-base disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In <strong>renal failure</strong>, there is a loss of kidney function due to the\u202fdamage affecting glomeruli and tubules. This leads to a&nbsp;<strong>high anion&nbsp;gap\u202f metabolic acidosis</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "ABG analysis of a patient is shown below.  What is the probable underlying acid-base disorder in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis with compensatory respiratory alkalosis"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis with compensatory respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Respiratory acidosis with compensatory metabolic alkalosis"
      },
      {
        "id": 4,
        "text": "Mixed acid\u2013base disorder"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The underlying acid-base disorder in this patient is <strong>metabolic acidosis</strong> with <strong>compensatory respiratory alkalosis</strong>.</p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: A pH of<strong> 7.1</strong>&nbsp;signifies <strong>acidosis</strong>.</p>\n<p>Step 2: Plasma HCO<sub>3</sub><sup>-</sup>&nbsp;is <strong>6 mEq/L</strong>, along with a low pH it signifies <strong>metabolic acidosis</strong>.&nbsp;</p>\n<p>Step 3: pCO<sub>2</sub> is <strong>16 mmHg&nbsp;</strong>indicating&nbsp;<strong>respiratory alkalosis</strong>. The decrease in pCO<sub>2</sub>&nbsp;along with the decrease in pH suggests that this is a compensatory response.</p>\n<p>Step 4: The expected compensatory decrease in pCO<sub>2</sub> can be calculated using <strong>Winter's&nbsp;formula </strong>(Expected PCO<sub>2</sub>= {[1.5 x HCO<sub>3</sub><sup>-</sup>] +8}&nbsp;&plusmn; 2).<br /> <br />Expected PCO<sub>2</sub> = {[1.5 x 6] +8}&nbsp;&plusmn; 2 = <strong>15 to 19 mmHg</strong></p>\n<p>A pCO<sub>2 </sub>level of 16 mmHg falls within the range given above. Hence, metabolic acidosis is&nbsp;associated with compensatory respiratory alkalosis.</p>\n<p>(pCO<sub>2</sub> values above or below 15 - 19 mmHg would indicate mixed acid-base disorders)<br /> <br /><strong>Alternatively:</strong></p>\n<p>The other method to calculate the expected compensation is a&nbsp;<strong>1.2 mmHg decrease</strong> in <strong>p<span class=\"smallcaps\" data-mmanualobjecttype=\"smallcaps\">CO</span><sub>2</sub></strong>&nbsp;for every <strong>1 mmol/L decrease</strong> in <strong>bicarbonate</strong>.</p>\n<p>The decrease in bicarbonate is 24 - 6 = 18 mEq/L</p>\n<p>Decrease in pCO<sub>2</sub> is 18 x 1.2 = 22</p>\n<p>Expected pCO<sub>2</sub> = 40 - 22 = 18 mmHg (roughly = 16 mmHg since the standard values are approximations)</p>\n<p>This method also indicates&nbsp;primary metabolic acidosis with compensatory respiratory alkalosis. However, Winter's formula is more accurate.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old man presents to the emergency department with dyspnea, and altered sensorium.  These symptoms were preceded by an asthma attack. What is the probable reason for the patient's presenting symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 3,
        "text": "Respiratory acidosis"
      },
      {
        "id": 4,
        "text": "Respiratory alkalosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The probable reason for the patient's presenting symptoms is <strong>respiratory acidosis</strong>.</p>\n<p>Asthma attack leads to the narrowing of respiratory passages. This leads to reduced O<sub>2</sub> inhalation and reduced CO<sub>2</sub> exhalation contributing to the rise of pCO<sub>2</sub>&nbsp;in the blood, thereby causing&nbsp;respiratory acidosis.</p>\n<p>Causes of respiratory acidosis:</p>\n<ul>\n<li>&nbsp;Central:&nbsp;\n<ul>\n<li>Drugs (anesthetics, morphine, sedatives)</li>\n<li>Stroke</li>\n<li>Infection</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>&nbsp;Airway:\n<ul>\n<li>Obstruction</li>\n<li>Asthma</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Lung parenchyma:\n<ul>\n<li>Emphysema</li>\n<li>Pneumoconiosis</li>\n<li>Bronchitis</li>\n<li>Adult respiratory distress syndrome</li>\n<li>Barotrauma</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Neuromuscular:\n<ul>\n<li>Poliomyelitis</li>\n<li>Kyphoscoliosis</li>\n<li>Myasthenia</li>\n<li>Muscular dystrophies</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>Miscellaneous:\n<ul>\n<li>Obesity</li>\n<li>Hypoventilation</li>\n<li>Permissive hypercapnia.</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old man with a history of chronic obstructive pulmonary disease presents with increased shortness of breath. His ABG analysis is as shown. What is the most probable underlying acid-base disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 3,
        "text": "Respiratory acidosis"
      },
      {
        "id": 4,
        "text": "Respiratory alkalosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The underlying acid-base disorder is <strong>respiratory acidosis</strong>.</p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: A pH of <strong>7.24</strong> signifies&nbsp;<strong>acidosis</strong>.</p>\n<p>Step 2: A plasma HCO<sub>3</sub><sup>-</sup> is <strong>27 mEq/L</strong> is within normal limits. This is very likely to be due to compensation as it does not reflect the direction of the pH change.</p>\n<p>Step 3: A pCO<sub>2</sub> of <strong>60 mmHg</strong>&nbsp;along with an acidotic pH signifies <strong>respiratory acidosis</strong>.&nbsp;</p>\n<p>Step 4: The expected compensatory increase in HCO<sub>3</sub><sup>-&nbsp;</sup>can be calculated using the following formula:</p>\n<p>Increase in HCO<sub>3</sub><sup>-&nbsp;</sup>= 0.4 X &Delta; PaCO<sub>2</sub> (as COPD is a chronic condition and the presentation of the patient is not acute)</p>\n<p>Thus, the increase in&nbsp;HCO<sub>3</sub><sup>- </sup>= 0.4 x (60-40) = 8 mEq/L</p>\n<p>Therefore expected HCO<sub>3</sub><sup>-</sup> is 24 + 8 = <strong>32 mEq/L</strong>.</p>\n<p>The actual HCO<sub>3</sub><sup>-</sup> measured is 27 mEq/L (which is less than the expected value) indicating that&nbsp;there could be a component of metabolic acidosis also.</p>\n<p>But, the predominant disorder is <strong>respiratory acidosis</strong>&nbsp;and thus it is the best answer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young asthmatic boy was rushed to ED with confusion and gasping for breath. His ABG analysis is as shown. What is the acid-base disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Respiratory alkalosis, compensated"
      },
      {
        "id": 2,
        "text": "Respiratory acidosis, partially compensated"
      },
      {
        "id": 3,
        "text": "Respiratory acidosis, fully compensated"
      },
      {
        "id": 4,
        "text": "Metabolic alkalosis, uncompensated"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of <strong>acute severe asthma</strong>. The acid-base disorder is <strong>respiratory acidosis</strong>, partially compensated.</p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: pH is decreased. This signifies&nbsp;<strong>acidosis. </strong>In acidosis, either pCO<sub>2</sub> is increased or&nbsp;plasma HCO<sub>3</sub><sup>-</sup> is decreased.&nbsp;&nbsp;</p>\n<p>Step 2: In this case, pCO<sub>2</sub> is increased by 30 mmHg. This signifies <strong>respiratory acidosis</strong>.&nbsp;</p>\n<p>Step 3: Plasma HCO<sub>3</sub><sup>-</sup> is increased by 26-24 = 2 mEq/L. This signifies <strong>compensation</strong> is taking place.</p>\n<p>In acute conditions, for every 10mmHg rise in pCO<sub>2</sub> expected rise in plasma HCO<sub>3</sub><sup>-</sup> is 1mEq/L. In this case, pCO<sub>2</sub> has risen by 30 mmHg, so the <strong>expected rise</strong> in&nbsp;HCO<sub>3</sub><sup>-</sup> is <strong>3 mEq/L.</strong></p>\n<p>However, plasma HCO<sub>3</sub>- has risen only by <strong>2 mEq/L</strong>, which implies compensation is only partial.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The arterial blood gas findings of a patient are pH = 7.12, pCO2 = 50, HCO3 = 28. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Respiratory acidosis with metabolic compensation"
      },
      {
        "id": 2,
        "text": "Metabolic acidosis with respiratory compensation"
      },
      {
        "id": 3,
        "text": "Respiratory alkalosis with metabolic compensation"
      },
      {
        "id": 4,
        "text": "Metabolic alkalosis with respiratory compensation"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The above findings give the diagnosis of<strong>&nbsp;respiratory acidosis </strong>with<strong> metabolic compensation</strong>.</p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: pH is reduced (7.12), hence <strong>acidosis</strong>.</p>\n<p>Step 2: Since pCO2 is raised (50 mmHg),&nbsp;it is <strong>respiratory</strong> acidosis.</p>\n<p>Step 3: HCO<sub>3</sub>&nbsp;is raised&nbsp;(28 mEq/L) suggesting there is <strong>metabolic compensation</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 40-year-old woman was rushed to the ER with chest pain, palpitations, and sweating. On examination, her respiratory rate was 32/min, and carpopedal spasm was noted while measuring BP. Her ECG was normal. Which of the following acid-base disorders is she likely to have?",
    "choices": [
      {
        "id": 1,
        "text": "Metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Metabolic alkalosis"
      },
      {
        "id": 3,
        "text": "Respiratory acidosis"
      },
      {
        "id": 4,
        "text": "Respiratory alkalosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario is suggestive of a <strong>panic attack</strong>. The patient is likely to have&nbsp;<strong>respiratory alkalosis</strong>.&nbsp;</p>\n<p>Panic attacks are characterized by <strong>hyperventilation</strong> which leads to a <strong>washout of CO2</strong> (reduced PaCO<sub>2</sub>). This further increases the ratio of bicarbonate concentration to PaCO<sub data-reader-unique-id=\"6\">2</sub> and, thereby, increases the pH level causing <strong>alkalosis</strong>.&nbsp;</p>\n<p>Alkalosis promotes the binding of calcium to albumin and <strong>reduces</strong> the fraction of <strong>ionized calcium</strong> in the blood. This leads to <strong>hypocalcemia</strong>&nbsp;<span class=\"s1\">without reducing the total calcium levels. Thus, alkalosis can precipitate <strong>tetany</strong> and <strong>laryngospasm</strong>, especially in calcium-deficient patients.&nbsp;</span></p>\n<p>Induction of carpopedal spasm when the BP cuff is inflated 20 mm Hg over the systolic BP for three minutes or more is&nbsp;called&nbsp;<strong>Trousseau sign</strong>. It is a clinical&nbsp;manifestation of <strong>hypocalcemia.&nbsp;</strong></p>\n<p>Causes of respiratory alkalosis:</p>\n<ul>\n<li>Central nervous system stimulation:\n<ul>\n<li>Pain</li>\n<li>Anxiety, psychosis</li>\n<li>Fever</li>\n<li>Cerebrovascular accident</li>\n<li>meningitis, encephalitis</li>\n<li>Tumor</li>\n<li>Trauma</li>\n</ul>\n</li>\n<li>Hypoxemia or tissue hypoxia:\n<ul>\n<li>High altitude</li>\n<li>Pneumonia, pulmonary edema</li>\n<li>Aspiration</li>\n<li>Severe anemia</li>\n</ul>\n</li>\n<li>Drugs or hormones:\n<ul>\n<li>Pregnancy</li>\n<li>Salicylates</li>\n<li>Cardiac failure</li>\n</ul>\n</li>\n<li>Stimulation of chest receptors:\n<ul>\n<li>Hemothorax</li>\n<li>Flail chest</li>\n<li>Cardiac failure</li>\n<li>Pulmonary embolism</li>\n</ul>\n</li>\n<li>Miscellaneous:\n<ul>\n<li>Septicemia</li>\n<li>Hepatic failure</li>\n<li>Mechanical hyperventilation</li>\n<li>Heat exposure</li>\n<li>Recovery from metabolic acidosis</li>\n</ul>\n</li>\n</ul>\n<p>Note: While metabolic alkalosis can also cause hypocalcemia, the above scenario of hyperventilation is more suggestive of respiratory alkalosis. Furthermore, hypocalcemic symptoms are more common with respiratory alkalosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In the given acid-base nomogram diagram, areas marked A and D indicate which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic respiratory acidosis, acute metabolic alkalosis"
      },
      {
        "id": 2,
        "text": "Acute Metabolic alkalosis, acute respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Acute respiratory acidosis, acute respiratory alkalosis"
      },
      {
        "id": 4,
        "text": "Acute respiratory acidosis, acute metabolic alkalosis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>y-axis</strong> of the acid-base nomogram represents the <strong>arterial bicarbonate (HCO3-) levels,</strong> and the <strong>x-axis</strong> represents the<strong> arterial pH</strong> values. The <strong>shaded</strong> areas are the <strong>range</strong> of values of the <strong>normal respiratory and metabolic compensations</strong> for primary acid-base disturbances.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1642dd51e16b485aa9ff24c7a6d6ca59.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e5b3a554c29d42aab8be74cc471cb156x1280x1555.JPEG"
    ]
  },
  {
    "text": "The arterial blood gas analysis findings of a patient are as follows:  pH= 7.30, HCO3= 10 mEq/L,  paCO2= 30 mmHg, which is suggestive of a partially compensated metabolic acidosis. What is the mechanism for the secondary disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Hypoventilation causing decreased CO2 washout"
      },
      {
        "id": 2,
        "text": "Hyperventilation causing increased CO2 washout"
      },
      {
        "id": 3,
        "text": "Increased tubular reabsorption of  HCO3-"
      },
      {
        "id": 4,
        "text": "Increased excretion of H+"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The mechanism for the secondary disorder is <strong>hypoventilation</strong> causing <strong>decreased CO2 washout</strong>.&nbsp;</p>\n<p>The given arterial blood gas findings are suggestive of a <strong>partially compensated metabolic acidosis</strong>. The compensation is <strong>partial </strong>because the <strong>fall in paCO2</strong> much <strong>lower</strong> than what is expected for the given HCO3 levels. The <strong>fall in paCO2</strong> is <strong>inadequate </strong>due to<strong> hypoventilation</strong> causing decreased CO2 washout. In this case, the <strong>secondary disorder</strong> is <strong>respiratory acidosis</strong>.&nbsp;</p>\n<p><strong>Hyperventilation</strong> causing<strong> increased CO2 washout</strong> (Option B) would allow for <strong>better compensation</strong>, with lower paCO2 levels than observed.&nbsp;</p>\n<p>The expected paCO2 can be calculated using <strong>Winter's formula:</strong></p>\n<p>For metabolic acidosis, the expected paCO2 = [1 .5 X HCO3-] + 8 &plusmn; 2.</p>\n<p>Substituting the values, expected PaCO2 = (1.5 x 10) +8 &plusmn; 2<br />= 15+8 &plusmn;2<br />= <strong>21 to 25 mmHg</strong></p>\n<p>However, the <strong>actual PaCO2 is 30 mmHg,</strong> which is <strong>higher</strong> than the expected paCO2 <strong>indicating a secondary respiratory acidosis.</strong> A possible explanation for this could only be <strong>hypoventilation causing decreased CO2 washout.&nbsp;</strong></p>\n<p>Thus, the given ABG findings are suggestive of a mixed acid-base disorder characterized by metabolic acidosis with additional respiratory acidosis.&nbsp;</p>\n<p><strong>For example, </strong>in a patient with diabetic ketoacidosis and pneumonia, the lungs would fail to compensate, and the patient could develop hypoventilation leading to secondary respiratory acidosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The arterial blood gas analysis of an unconscious man showed pH- 6.9, HCO3- 13 mEq/L, paCO2- 68 mmHg. The acid-base status of this patient is best described as:",
    "choices": [
      {
        "id": 1,
        "text": "Uncompensated metabolic acidosis"
      },
      {
        "id": 2,
        "text": "Uncompensated respiratory acidosis"
      },
      {
        "id": 3,
        "text": "Simultaneous respiratory and metabolic acidosis"
      },
      {
        "id": 4,
        "text": "Respiratory acidosis with partial renal compensation"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the ABG analysis provided, the patient has a <strong>mixed</strong> acid-base disorder with <strong>simultaneous respiratory </strong>and <strong>metabolic acidosis</strong>.</p>\n<p>Interpretation of the ABG:</p>\n<p>Step 1: A pH of 6.9 signifies <strong>acidosis</strong>.</p>\n<p>Step 2: Plasma HCO<sub>3</sub><sup>-</sup> is 13 mEq/L, along with a low pH it signifies <strong>metabolic acidosis</strong>.</p>\n<p>Step 3: pCO<sub>2</sub> is 68 mmHg indicating co-existing&nbsp;<strong>respiratory acidosis</strong>. The direction of pCO2 change is the same as that of pH change suggesting that this is a mixed acid-base disorder.</p>\n<p>Step 4: The expected compensatory change in pCO<sub>2</sub> in the metabolic acidosis calculated using Winter's formula would be:</p>\n<p>pCO<sub>2</sub> = [1.5xHCO<sub>3</sub><sup>-</sup>] + 8&nbsp;&plusmn; 2 = 26 - 30 mmHg</p>\n<p>The <strong>actual pCO<sub>2</sub></strong> measure is very<strong> high</strong> (68 mmHg) compared to the estimated range of 26 - 30 mmHg indicating the presence of <strong>simultaneous</strong> metabolic and respiratory acidosis.</p>\n<p>Note- If this was a case of&nbsp;uncompensated acidosis, either the bicarbonate or the pCO<sub>2</sub> values would have been within the normal limits.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '002 Acid-Base Disorders';
        let hierarchy = ["Marrow", "qBank", "Medicine"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>