<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neet Mini - 16 (20 Q) - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2020-21
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "On a busy day in the casualty at a government hospital, 4 patients are admitted who require the administration of Rabies Immunoglobulin (RIG), but the quantity of  RIG is adequate only for 2 patients. Which of the two patients among the four will you administer the RIG according to priority?",
    "choices": [
      {
        "id": 1,
        "text": "1,3"
      },
      {
        "id": 2,
        "text": "1,2"
      },
      {
        "id": 3,
        "text": "2,4"
      },
      {
        "id": 4,
        "text": "3,4"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>According to the WHO's allocation of rabies immunoglobulin (RIG) according to priority, <strong>patients 2 and 4</strong> will be administered rabies immunoglobulin.</p>\n<p>If a limited amount of RIG is available, RIG allocation should be prioritized for exposed patients based on the following criteria:</p>\n<ol>\n<li>Multiple bites</li>\n<li>Deep wounds</li>\n<li>Bites to highly innervated parts of the body (such as head, neck, and hands)</li>\n<li>Severe immunodeficiency</li>\n<li>The biting animal is a confirmed or probable rabies case</li>\n<li>Bites, scratches, or exposures of mucous membranes caused by a bat</li>\n</ol>\n<p>In the given clinical vignette :</p>\n<p>An 85-year-old male with multiple dog bites over his legs and torso &gt;&nbsp;A 35-year-old male with a dog bite to his neck &gt; An HIV patient with a category II dog bite on his leg &gt; A 6-year-old with a bite exposing the mucous membrane by a dog confirmed to have rabies</p>\n<p><strong>RIG</strong> provides a <strong>passive immunization</strong> and is administered only once, as soon as possible after the initiation of post-exposure prophylaxis (PEP) and <strong>not beyond 7 days</strong> after the first dose of vaccine&nbsp;with as much of the dose as possible infiltrated around the wound site.</p>\n<p>Rabies immunoglobulin&nbsp;is provided in <strong>2 types</strong> and their doses should be:</p>\n<ul>\n<li>Human rabies immunoglobulin&nbsp;<strong>(hRIG):</strong>&nbsp;20 IU/kg body weight.</li>\n<li>Equine rabies immunoglobulin&nbsp;<strong>(eRIG):</strong>&nbsp;40 IU/kg body weight.</li>\n<li>Infiltrate as much as possible into the wound; the remainder of the calculated dose of RIG does not need to be injected IM at a distance from the wound but can be fractionated in smaller, individual syringes to be used for other patients, aseptic retention given.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 7-year-old boy was brought for psychiatric evaluation for intellectual disability. On examination, his IQ was 49. His facial features are as shown below. DNA testing is done to confirm the diagnosis. What is the trinucleotide repeat mutation associated with this syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "CGG"
      },
      {
        "id": 2,
        "text": "CAG"
      },
      {
        "id": 3,
        "text": "CTG"
      },
      {
        "id": 4,
        "text": "GAA"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical vignette showing moderate mental retardation, long face, and large ears is suggestive of <strong>Fragile X syndrome</strong> associated with <strong>CGG</strong> trinucleotide repeat mutation on X chromosome.</p>\n<p>The normal FMR1 gene contains CGG repeats. When the number of trinucleotide repeats is excessive, abnormal methylation of the region results in transcriptional suppression of FMR1 and the absence of familial mental retardation protein (FMRP).</p>\n<p class=\"p1\">Clinical features: X linked disease which predominantly affects males.</p>\n<ul>\n<li class=\"p1\">Moderate to severe mental retardation</li>\n<li class=\"p1\">Long face with a\u00a0large mandible</li>\n<li class=\"p1\">Large everted ears</li>\n<li class=\"p1\">Large testicles (macroorchidism)</li>\n</ul>\n<table style=\"height: 697px; width: 401px;\">\n<tbody>\n<tr style=\"height: 18px;\">\n<td style=\"width: 141px; height: 18px;\"><strong>Disease</strong></td>\n<td style=\"width: 83px; height: 18px;\"><strong>Repeats</strong></td>\n<td style=\"width: 155px; height: 18px;\">Clinical features</td>\n</tr>\n<tr style=\"height: 91px;\">\n<td style=\"width: 141px; height: 91px;\"><strong>Fragile X- syndrome</strong></td>\n<td style=\"width: 83px; height: 91px;\">\u00a0 <strong>CGG</strong></td>\n<td style=\"width: 155px; height: 91px;\">Mental retardation, large ears,\u00a0and jaws, macroorchidism in males</td>\n</tr>\n<tr style=\"height: 107.2px;\">\n<td style=\"width: 141px; height: 107.2px;\">\n<p>Myotonic Dystrophy</p>\n<p>(<strong>chromosome 19)</strong></p>\n</td>\n<td style=\"width: 83px; height: 107.2px;\">\u00a0 CTG</td>\n<td style=\"width: 155px; height: 107.2px;\">Muscle loss, cardiac arrhythmia,<br /><strong>cataracts</strong>, frontal balding</td>\n</tr>\n<tr style=\"height: 36px;\">\n<td style=\"width: 141px; height: 36px;\"><strong>Huntington\u2019s disease</strong></td>\n<td style=\"width: 83px; height: 36px;\">\u00a0 <strong>CAG</strong></td>\n<td style=\"width: 155px; height: 36px;\">Affective disorder</td>\n</tr>\n<tr style=\"height: 72px;\">\n<td style=\"width: 141px; height: 72px;\">Spinocerebellar ataxia type 1</td>\n<td style=\"width: 83px; height: 72px;\">\u00a0 CAG</td>\n<td style=\"width: 155px; height: 72px;\">Progressive ataxia, dysarthria,<br />dysmetria.</td>\n</tr>\n<tr style=\"height: 91px;\">\n<td style=\"width: 141px; height: 91px;\"><strong>Friedreich's ataxia</strong></td>\n<td style=\"width: 83px; height: 91px;\">\u00a0 <strong>GAA</strong></td>\n<td style=\"width: 155px; height: 91px;\">Progressive ataxia,<br />dysarthria, hypertrophic<br />cardiomyopathy.</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e9cdf00486314985a6888c83b8bffe06.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old woman presented with active contractions at 25 weeks of gestation. Her obstetric history is uneventful. She is started on tocolytic therapy. A few hours later, she complains of headache, difficulty in breathing, and palpitations. Her vitals and chest x-ray are given below. Which tocolytic agent was most likely administered?",
    "choices": [
      {
        "id": 1,
        "text": "Nifedipine"
      },
      {
        "id": 2,
        "text": "Atosiban"
      },
      {
        "id": 3,
        "text": "Indomethacin"
      },
      {
        "id": 4,
        "text": "Ritodrine"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical vignette is suggestive of <strong>preterm labor</strong>. The symptoms of&nbsp;<strong>tachycardia</strong>, <strong>pulmonary edema</strong> (batwing appearance on chest x-ray), <strong>hypotension</strong>, and <strong>hypokalemia</strong> (palpitations) in the mother after administration of a tocolytic are most likely to have been caused by <strong>ritodrine</strong>.</p>\n<p><strong>Preterm labor</strong> and delivery (labor starts before the 37th completed week, counting from the first day of the last menstrual period) can be delayed by drugs in order to improve the perinatal outcome. A short-term delay of 48 hours allows the use of corticosteroids that can reduce perinatal mortality and serious morbidity significantly.</p>\n<p>Complications of common tocolytics are as follows:</p>\n<table style=\"width: 368.391px;\">\n<tbody>\n<tr style=\"height: 17px;\">\n<td style=\"width: 52px; height: 17px;\"><strong>Tocolytic</strong></td>\n<td style=\"width: 170px; height: 17px;\"><strong>Side effects</strong></td>\n</tr>\n<tr style=\"height: 81px;\">\n<td style=\"width: 52px; height: 81px;\"><strong>Ritodrine</strong>/<br />Salbutamol/ Terbutaline/ Isoxsuprine</td>\n<td style=\"width: 170px; height: 81px;\">Maternal- Headache, palpitation,&nbsp;tachycardia,&nbsp; hypotension, cardiac failure,&nbsp; pulmonary edema, ARDS, hyperglycemia, hyperinsulinemia, <br />lactic acidemia, hypokalemia, and even death<br /><br />Fetal- Tachycardia, heart failure, fetal death.</td>\n</tr>\n<tr style=\"height: 44px;\">\n<td style=\"width: 52px; height: 44px;\"><strong>Indomethacin</strong></td>\n<td style=\"width: 170px; height: 44px;\">Maternal- Heartburn, asthma, GI&nbsp;bleeding, thrombocytopenia, renal injury, platelet dysfunction<br /><br />Fetal-&nbsp;Premature closure of ductus arteriosus in utero, oligohydramnios, IUGR, neonatal pulmonary hypertension</td>\n</tr>\n<tr style=\"height: 47px;\">\n<td style=\"width: 52px; height: 47px;\">Glyceryl trinitrate <br />patch</td>\n<td style=\"width: 170px; height: 47px;\">Headache, hypotension</td>\n</tr>\n<tr style=\"height: 68px;\">\n<td style=\"width: 52px; height: 68px;\">Magnesium <br />sulfate</td>\n<td style=\"width: 170px; height: 68px;\">\n<p>Maternal- Flushing, perspiration, headache, and muscle weakness, rarely pulmonary edema.<br /><br />Fetal-&nbsp;Lethargy, cardiac arrest, hypotonia, and&nbsp;rarely respiratory depression</p>\n</td>\n</tr>\n<tr style=\"height: 77px;\">\n<td style=\"width: 52px; height: 77px;\"><strong>Atosiban&nbsp;<br /></strong>(oxytocin antagonist)</td>\n<td style=\"width: 170px; height: 77px;\">Nausea, vomiting, chest pain</td>\n</tr>\n<tr style=\"height: 104px;\">\n<td style=\"width: 52px; height: 104px;\"><strong>Nifedipine&nbsp;<br /></strong>(Calcium channel blocker)</td>\n<td style=\"width: 170px; height: 104px;\">Hypotension, headache, flushing, and nausea</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/fa92d9034337453eb2933ed828f84fb1.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 66-year-old sopranist in a choir group comes to the OPD with complaints of dysarthria gradually over the last year. Indirect laryngoscopy is done which reveals vocal cords that are bowing laterally. Which type of phonosurgery is performed for this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Lateralisation of vocal cords"
      },
      {
        "id": 2,
        "text": "Medialisation of vocal cords"
      },
      {
        "id": 3,
        "text": "Shortening of vocal cords"
      },
      {
        "id": 4,
        "text": "Lengthening of vocal cords"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical vignette is suggestive of a <strong>normal aging process</strong> where the vocal cords are <strong>lax and bowing</strong> for which phonosurgery is performed to<strong>\u00a0lengthen (tighten)</strong>\u00a0the vocal cords.</p>\n<p>Lengthening of vocal cords is also performed to <strong>elevate the pitch</strong> where it converts the male character of voice to female. This is employed in male to female gender transformation.</p>\n<p>If someone\u00a0who has undergone gender transformation from female to male would like to\u00a0lower the voice pitch, a phono surgery involving <strong>shortening/relaxation</strong> of the vocal cord is advised. This produces a mutational falsetto.</p>\n<p>Medialization of the vocal cord is employed in a completely paralyzed vocal cord where teflon paste or gel foam is used to easily augment and medialize the paralyzed vocal cord to help approximate the opposite healthy vocal cord.</p>\n<p>Lateralization displacement of the vocal cord is used to improve the airway.</p>\n<table style=\"width: 574.891px;\">\n<tbody>\n<tr>\n<td style=\"width: 107px;\">\n<p><strong>Type</strong></p>\n</td>\n<td style=\"width: 227px;\">\n<p><strong> Thyroplasty</strong></p>\n</td>\n<td style=\"width: 217.891px;\">\n<p><strong>Uses</strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 107px;\">\n<p>I</p>\n</td>\n<td style=\"width: 227px;\">\n<p><strong> M</strong>edialization</p>\n</td>\n<td style=\"width: 217.891px;\">\n<p>In complete unilateral palsy (recurrent laryngeal nerve and superior laryngeal nerve) - Vocal cord is medialized towards the midline for the opposite cord to meet. Thyroplasty is done by creating a window in the thyroid cartilage and placing silicon or other prostheses to medialize the cord. It can also be used in Abductor dysphonia.</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 107px;\">\n<p>II</p>\n</td>\n<td style=\"width: 227px;\">\n<p><strong> L</strong>ateralization</p>\n</td>\n<td style=\"width: 217.891px;\">\n<p>In bilateral recurrent laryngeal nerve palsy.\u00a0It creates a lateral expansion of the larynx<br />and is similar to vocal cord lateralization. Quality of<br />voice may not be good</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 107px;\">\n<p>III</p>\n</td>\n<td style=\"width: 227px;\">\n<p><strong> S</strong>hortening (relax the vocal cord)</p>\n</td>\n<td style=\"width: 217.891px;\">\n<p>To reduce pitch</p>\n</td>\n</tr>\n<tr>\n<td style=\"width: 107px;\">\n<p>IV</p>\n</td>\n<td style=\"width: 227px;\">\n<p><strong> L</strong>engthening (tighten the vocal cord)</p>\n</td>\n<td style=\"width: 217.891px;\">\n<p>To increase pitch</p>\n</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Note to remember: MLSL</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An employee of an automobile company undergoes a work-place injury where he sustains an injury to his right eye. He is rushed to the hospital and conservative management is provided. On follow up visits, it is noticed that the iris is stained, first greenish and subsequently reddish-brown. Which of the following is the foreign body implicated in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Zinc"
      },
      {
        "id": 2,
        "text": "Iron"
      },
      {
        "id": 3,
        "text": "Copper"
      },
      {
        "id": 4,
        "text": "Lead"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical vignette is suggestive of a penetrating wound with the retention of a foreign body exhibiting heterochromia iridis (staining of the iris which changes color) which is caused by <strong>iron deposition</strong>.</p>\n<p><strong>Siderosis bulbi</strong> refers to the ocular degenerative changes produced by an<strong> iron foreign body</strong>. This condition is due to the electrolytic dissociation of the metal by intrinsic resting current in the eye which disseminates the metal, combining it with cellular proteins and causes atrophy.</p>\n<p>The earliest change is the deposition of iron in the anterior capsule of the lens where oval patches are arranged in a ring corresponding with the edge of the dilated pupil. This eventually leads to the formation of cataract.</p>\n<p>In siderosis bulbi, the iris is first stained <strong>greenish</strong> and later turns <strong>reddish brown,</strong> causing <strong>heterochromia iridis</strong>. Depositon of iron in the sphincter of the iris leads to mydriasis.</p>\n<p>Eventually, there is retinal degeneration which resembles pigmentary retinal dystrophy. Secondary glaucoma of the chronic type is a late complication and if the foreign body is not removed, it results in blindness as a result of optic dystrophy.</p>\n<p>Depostis are revealed by Prussian blue reactions showing an intense blue coloration immediately around the foreign body.</p>\n<p><strong>Chalcosis</strong> refers to the specific changes produced by the <strong>alloy of copper</strong> in the eye. Clinical features include the following:</p>\n<ul>\n<li><strong>Kayser\u2013Fleischer ring-</strong>\u00a0a golden brown\u00a0ring that occurs due to the deposition of copper in the Descemet\u2019s membrane of the cornea.</li>\n<li><strong>Sunflower cataract-</strong>\u00a0produced by the deposition of copper under the anterior capsule of the lens. It is brilliant golden green in color and arranged like the petals of a sunflower.</li>\n</ul>\n<p>Lead becomes coated with carbonates and excites little reaction while zinc may excite suppuration.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 48-year-old man was scheduled for a right frontal craniotomy and excision of a brain tumor. Anesthesia was induced, muscular relaxation was facilitated, he was intubated, and the lungs were ventilated. A capnograph was obtained, as shown in the image below. Which of the following is a likely cause of the finding seen?",
    "choices": [
      {
        "id": 1,
        "text": "Pulmonary embolism"
      },
      {
        "id": 2,
        "text": "Attempts at spontaneous breathing"
      },
      {
        "id": 3,
        "text": "Chronic obstructive pulmonary disease (COPD)"
      },
      {
        "id": 4,
        "text": "Malignant hyperthermia"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The&nbsp;<strong>curare notch or cleft</strong>&nbsp;in phase III or the plateau phase of the capnograph indicates that the&nbsp;<strong>patient is trying to breathe spontaneously&nbsp;</strong>during controlled mechanical ventilation. The patient's inspiratory effort causes fresh gas to be sucked into the capnometer, resulting in a lower CO<sub>2</sub> concentration and a notch.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2d185b063950421bba43c751ff234f92.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1eb84a4eb956416c8802647bfce2fbf6x1279x904.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/c541caf26c1844e1977ebbb8938842bcx1280x1075.JPEG"
    ]
  },
  {
    "text": "A 40-year-old man comes to the clinic with white corrugated plaques in his tongue as shown in the image. He has been having this for the past 2 weeks and has no pain or bleeding from the lesion. He had been tested positive for HIV 8 years back and is adherent to the treatment. The lesion couldn't be scraped off of the tongue during the trial to retrieve tissue for further assessment. The rest of the examination of his oral cavity is normal. Which of the following viruses is most likely to be the cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cytomegalovirus"
      },
      {
        "id": 2,
        "text": "Human papilloma virus"
      },
      {
        "id": 3,
        "text": "Herpes simplex 1 virus"
      },
      {
        "id": 4,
        "text": "Epstein Barr virus"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario describes oral hairy leukoplakia. It occurs due to <strong>reactivation of Epstein Barr Virus (EBV) infection</strong> and usually occurs in association with <strong>immunodeficiency</strong> due to <strong>HIV infection</strong>.</p>\n<ul>\n<li>Clinical Feature (OHL): HIV-infected patient presenting with white corrugated plaque over the lateral border of the tongue, which cannot be rubbed off.&nbsp;</li>\n<li>Predisposing factors: <strong>Immunodeficiency,</strong> hematological malignancies, steroid abuse, can also be seen in immunocompetent individuals.&nbsp;</li>\n<li>Investigations: Investigations show high levels of EBV DNA in the blood with circulating antibodies against VCA and early antigen (EA)\u2010restricted proteins.</li>\n<li>Pathology:&nbsp;Epstein&ndash;Barr virus replicates in maturing epithelial cells but is not present in basal and parabasal keratinocytes.</li>\n<li>Other <strong>conditions</strong> associated with EBV infection are\n<ul>\n<li>Glandular fever (infectious mononucleosis): fever, pharyngitis, and posterior cervical lymphadenopathy</li>\n<li>Hodgkin lymphoma</li>\n<li>Non-Hodgkin lymphoma</li>\n<li>Burkitt's Lymphoma</li>\n<li>Nasopharyngeal carcinoma</li>\n<li>EBV\u2010associated lymphoproliferative disease</li>\n</ul>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b88425d202994e63b8caa175b3aa5c32.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3638defe56f14870888eb384aaa09078x1280x1131.9605077574047.JPEG"
    ]
  },
  {
    "text": "A patient was brought in with a history of consumption of acid. His last meal was a few hours ago. After resuscitation, the team performs all necessary treatments but the patient, unfortunately, succumbs to death. If you were to perform the autopsy and resect the stomach, which of the following images would indicate the most likely area of injury to the gastric mucosa?",
    "choices": [
      {
        "id": 1,
        "text": "Image 1"
      },
      {
        "id": 2,
        "text": "Image 2"
      },
      {
        "id": 3,
        "text": "Image 3"
      },
      {
        "id": 4,
        "text": "Image 4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The most likely area of injury to the gastric mucosa is denoted by <strong>image B.</strong></p>\n<p>The <strong>pathway</strong> that fluids (acid, alkali, water) take <strong>in a</strong> <strong>food-filled stomach</strong> is known as&nbsp;<strong>Magenstrasse.&nbsp;</strong>It is present <strong>along the lesser curvature</strong> of the stomach, and this is where the greatest damage to gastric mucosa takes place in corrosive injury.&nbsp;</p>\n<p>In an&nbsp;<strong>empty stomach,&nbsp;</strong>the maximum injury occurs to the lower half to two-thirds of the body, with sparing of the fundus.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8d7a897adf6e4bd6832ae6d05bca5283.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8fc7e868830547b5b4e908da12f43831x1279x1355.JPEG"
    ]
  },
  {
    "text": "A 60 kg adult male has a hematocrit reading of 40% and a plasma volume of 3L. What is his total blood volume in liters?",
    "choices": [
      {
        "id": 1,
        "text": "8"
      },
      {
        "id": 2,
        "text": "5"
      },
      {
        "id": 3,
        "text": "7"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>His total blood volume is<strong> 5\u00a0liters.</strong></p>\n<p><strong>Calculation:</strong></p>\n<p>Total Blood Volume = Plasma volume/ 1 - Hematocrit</p>\n<p>= 3 litres/ (1-0.4)</p>\n<p>= 3/0.6</p>\n<p>= <strong>5\u00a0liters</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 15-year-old boy presents with visual disturbances and fatigue. He finds it difficult to see in the dark for the past few months. There is a tingling sensation in his upper limbs. On examination, there is weakness, sensory loss and dry scaly patches over both lower limbs as shown in the picture, which responds to emollients. The enzyme deficiency likely to be seen in this patient is:",
    "choices": [
      {
        "id": 1,
        "text": "Phytanoyl CoA \u03b1-hydroxylase"
      },
      {
        "id": 2,
        "text": "Acyl CoA synthetase"
      },
      {
        "id": 3,
        "text": "Phytanic acid synthetase"
      },
      {
        "id": 4,
        "text": "Aldehyde dehydrogenase"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The enzyme deficiency likely to be seen in this patient is <strong>phytanoyl CoA\u00a0\u03b1-hydroxylase</strong>.</p>\n<p>The clinical features of this patient represent<strong>\u00a0Refsum\u2019s disease</strong>\u00a0and the enzyme deficient is phytanoyl CoA \u03b1-hydroxylase, also known as phytanic acid alpha oxidase.</p>\n<p>The given image shows\u00a0<strong>ichthyosis\u00a0</strong>of the shin and the patient complaints of poor vision with extremely affected dark/night vision which is suggestive of <strong>retinitis pigmentosa.</strong></p>\n<p><span data-preserver-spaces=\"true\">It occurs due to a defect in the enzyme phytanoyl-CoA hydroxylase (PAHX). It typically occurs in individuals between\u00a0</span><strong><span data-preserver-spaces=\"true\">10-15 years.\u00a0</span></strong>Refsum disease is a rare, autosomal recessive disorder caused by a deficiency of peroxisomal Phytanoyl CoA \u03b1-hydroxylase, an enzyme involved in the alpha oxidation of phytanic acid (branched-chain fatty acid). This results in the <strong>accumulation </strong>of<strong> phytanic acid</strong> in the plasma and <strong>tissues</strong>.</p>\n<p>The manifestation of classic adult Refsum disease includes</p>\n<ul>\n<li>Ichthyosis</li>\n<li>Retinitis pigmentosa</li>\n<li>Peripheral neuropathy</li>\n<li>Ataxia</li>\n<li>Occasionally cardiac arrhythmias</li>\n<li><span data-preserver-spaces=\"true\">cardiac conduction defects</span></li>\n<li><span data-preserver-spaces=\"true\">elevated cerebrospinal fluid protein levels without an increase in cells.</span></li>\n</ul>\n<p><span data-preserver-spaces=\"true\">It can be diagnosed by\u00a0<strong>elevated levels</strong>\u00a0of\u00a0<strong>phytanic acid</strong>\u00a0and decreased activity of PAHX in the fibroblasts.\u00a0very-long-chain fatty acids (<strong>VLCFA) levels</strong>\u00a0are\u00a0<strong>norma</strong>l in this condition.</span></p>\n<p>Treatment: Restriction of dietary phytanic acid (found in dairy products, fish oils, and green leafy vegetables).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e643bb00b7cc46598aa01c91edd4a239.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/267cac4ca85d4be7b83c03319cb2db54x720x480.JPEG"
    ]
  },
  {
    "text": "A 33-year-old female patient comes to your clinic with pain in her right wrist for the past 2 weeks. She says that the pain interferes with her daily routine and it has been stressful to nurse her newborn child because of the pain, especially when she tries to lift the baby. She has no significant past medical history and has not been taking any medications apart from her daily vitamin supplements. On examination, she winces in pain when the doctor palpates the base of her right thumb while her wrist is bent towards the ulnar side. Vitals and system examination are normal. Which of the following is the diagnosis of this patient's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Carpometacarpal arthritis"
      },
      {
        "id": 2,
        "text": "De Quervain disease"
      },
      {
        "id": 3,
        "text": "Scaphoid non union"
      },
      {
        "id": 4,
        "text": "Intersection syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The presenting feature of this patient's condition is De Quervain's disease which is a stenosing tenosynovitis of the extensor tendons of the first dorsal compartment, namely\u00a0<strong>extensor pollicis brevis (EPB) and</strong>\u00a0<strong>abductor pollicis longus (APL)</strong>.</p>\n<p>It is prominent among females, especially pregnant women. Most commonly thumb is involved.</p>\n<p>It is an inflammatory disorder that occurs within the\u00a0<strong>first dorsal extensor compartment.\u00a0</strong>It\u00a0is caused by reactive thickening of the sheath around the extensor pollicis brevis and abductor pollicis longus tendons.</p>\n<p>It is commonly seen in women aged 40-50 years. There may be an unaccustomed activity such as pruning roses or wringing out clothes.</p>\n<p><strong>Finkelstein's test:</strong> On grasping the patient\u2019s thumb and quickly abducting the hand ulnar ward, the pain over the radial styloid tip is excruciating. It\u2019s the most pathognomonic objective sign.\u00a0</p>\n<p>It is positive in the following conditions:</p>\n<ul>\n<li>De Quervain's tenosynovitis</li>\n<li>Arthritis in the intercarpal\u00a0and radiocarpal joints</li>\n<li>Superficial radial nerve entrapment\u00a0</li>\n<li>Intersection syndrome- A tenosynovitis occurring due to friction between the obliquely placed extensor and abductor pollicis tendons, and the\u00a0longitudinally placed extensor tendons.</li>\n</ul>\n<p>Other clinical features of De Quervain's disease include visible swelling over the radial styloid, palpable thickening of the tendon sheath, tenderness at the tip of the radial styloid and pain on resisted thumb extension (<strong>hitch-hiker\u2019s sign</strong>).</p>\n<p>The image shows Finkelstein's test.\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/eac754c0aea04635b6683306343f676ax1280x1493.JPEG"
    ]
  },
  {
    "text": "Mr Suresh visits a hospital with complaints of feeling lightheaded and chest pain. He smokes around 9 cigarettes per day for the past many years and recently he also had admissions to the hospital because he felt breathless. ECG was performed and is shown below. Which of the following drugs is preferred in the management of this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Amiodarone"
      },
      {
        "id": 2,
        "text": "Propranolol"
      },
      {
        "id": 3,
        "text": "Digoxin"
      },
      {
        "id": 4,
        "text": "Verapamil"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The ECG depicts <strong>multifocal atrial tachycardia</strong> and calcium channel blockers like<strong>&nbsp;</strong>verapamil or diltiazem are used in the management.</p>\n<p><strong>Multifocal Atrial Tachycardia (MAT)</strong></p>\n<p>In this condition, irregular rhythms arise from multiple ectopic sites in the atria. The exact cause is not known, however, it is commonly usually seen in patients with chronic <strong>pulmonary disease</strong> and acute illness.</p>\n<p>ECG of multifocal atrial tachycardia</p>\n<ul>\n<li>Since the rhythms arise from different foci in the atria, it has at least <strong>3 different morphologies </strong>of <strong>P waves.</strong> The heart rate is between 100-150 beats per minute.</li>\n<li>Unlike atrial fibrillation, there are clear isoelectric intervals between P waves.</li>\n</ul>\n<p>Therapy for MAT is directed at treating the underlying disease and correcting any metabolic abnormalities.&nbsp;&nbsp;The calcium channel blockers <strong>verapamil or diltiazem&nbsp;</strong>are useful in slowing the atrial and ventricular rates. Cardioversion is ineffective.</p>\n<p>Other options</p>\n<p>Option A- Long term therapy with <strong>amiodarone</strong> is also avoided in these patients as it can cause <strong>pulmonary fibrosis.</strong></p>\n<p>Option B- <strong>Beta-blocker</strong>s may cause <strong>bronchospasm</strong>, and therefore are not suitable for patients with underlying pulmonary diseases.&nbsp;</p>\n<p>Option C- <strong>Digoxin</strong> is not found to be effective in the management of MAT</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/dbae8c4fd3554ec6a862e28704195ec9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A method of development of drug resistance is shown below. This method is not the primary\u00a0mode of\u00a0resistance to which of the following drugs? \n(Extracellular environment - above the membrane, Intracellular environment - Below the membrane)",
    "choices": [
      {
        "id": 1,
        "text": "Halofantrine"
      },
      {
        "id": 2,
        "text": "Ciprofloxacin"
      },
      {
        "id": 3,
        "text": "Chloroquine"
      },
      {
        "id": 4,
        "text": "Mefloquine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong><span data-preserver-spaces=\"true\">Efflux pumping of the drug is shown in the GIF above. It is the primary mode of resistance for Chloroquine, mefloquine, halofantrine, lumefantrine, quinine, etc\u00a0</span></strong><span data-preserver-spaces=\"true\">. It is mediated by an ABC transporter encoded by P. falciparum multidrug resistance gene 1 (Pfmdr1).\u00a0</span></p>\n<p><strong><span data-preserver-spaces=\"true\">Ciprofloxacin</span></strong><span data-preserver-spaces=\"true\">\u00a0resistance is developed mainly by\u00a0</span><strong><span data-preserver-spaces=\"true\">reduced affinity to the altered target.</span></strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e1ac2c4a22f449b7a877d93878196f65.GIF"
    ],
    "explanation_images": []
  },
  {
    "text": "A child was brought to the emergency department with a big lesion on his forearm. As a surgery resident you decide to excise the lesion in the emergency operation theatre. Which of the following investigations will test the entire coagulation pathway?",
    "choices": [
      {
        "id": 1,
        "text": "Activated partial thromboplastin time"
      },
      {
        "id": 2,
        "text": "Prothrombin time"
      },
      {
        "id": 3,
        "text": "Thromboelastography"
      },
      {
        "id": 4,
        "text": "Bleeding time"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Thromboelastography</strong> (TEG)&nbsp;tests the <strong>entire coagulation pathway</strong>. It measures coagulation cascade, platelet function, and fibrinolysis.</p>\n<p>It&nbsp;is a<strong>&nbsp;</strong>test that <strong>quantitatively</strong> measures the ability of whole blood to form a clot. The advantages are:</p>\n<ul>\n<li class=\"half_rhythm\">\n<div>Global assessment of blood coagulability, including coagulation cascade, platelet function, and fibrinolysis</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Rapid real-time bedside test with a simple methodology (point-of-care testing)</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Diagnosis of coagulopathic bleeding</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Guide transfusion therapy and decrease the use of blood products</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Detect dynamic changes in blood coagulation during resuscitation</div>\n</li>\n<li class=\"half_rhythm\">\n<div>Predict the clinical efficacy of therapeutic agents affecting blood coagulability</div>\n</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young male patient presented with a high fever, muscle aches, and easy fatigability. He gives a history of diarrhea and abdominal pain about 20 days ago. His blood investigations revealed eosinophilia. His muscle biopsy findings are given in the image below. What is the most likely organism responsible for his condition?",
    "choices": [
      {
        "id": 1,
        "text": "Taenia solium"
      },
      {
        "id": 2,
        "text": "Taenia saginata"
      },
      {
        "id": 3,
        "text": "Trichinella spiralis"
      },
      {
        "id": 4,
        "text": "Echinococcus"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above clinical scenario and the muscle biopsy findings showing <strong>encysted spiral larvae</strong> are characteristic of&nbsp;<strong><em>Trichinella spiralis</em></strong>.</p>\n<p><strong>Trichinella spiralis&nbsp;</strong>is&nbsp;known as the <strong>pork worm</strong> since the infection is acquired by consuming raw or undercooked pork. The initial infection presents as diarrhea and abdominal pain. In the later phase of the infection, the larvae move from the intestines into the circulation and migrate into muscles where they are encysted. This causes symptoms like fever, myalgia, etc.</p>\n<p>The larvae more commonly <strong>infect active muscles</strong> like the diaphragm, tongue, intercostals, extraocular muscles, etc. These larvae are calcified in about 5-6 months. <strong>Eosinophilia</strong> caused by parasitic infection also comes down after 6 months.</p>\n<p>It can be treated using <strong>albendazole</strong> along with <strong>steroids</strong> to control inflammation.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0a52808dd59145c6a44fbef5c6c67b44.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "You notice the following test is being performed by your senior on a 30-year-old patient having an Alvarado score of 7. The patient complained of pain in the right lower quadrant of the abdomen on performing the test. What is the name given to this clinical sign?",
    "choices": [
      {
        "id": 1,
        "text": "Psoas sign"
      },
      {
        "id": 2,
        "text": "Rovsing sign"
      },
      {
        "id": 3,
        "text": "Dunphy\u2019s sign"
      },
      {
        "id": 4,
        "text": "Aaron sign"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The name given to this clinical sign is the&nbsp;<strong>Psoas sign.<br /></strong></p>\n<p>The <strong>Alvarado score</strong> is a clinical scoring system used in the <strong>diagnosis</strong> of <strong>appendicitis.&nbsp;</strong>A <strong>score</strong> of <strong>7</strong>, as seen in this patient, <strong>suggests probable appendicitis</strong>.&nbsp;</p>\n<p>Various clinical signs have been described which are used in the diagnosis of appendicitis.<strong>&nbsp;Abdominal pain</strong> with&nbsp;<strong>hyperextension</strong> of the right&nbsp;<strong>hip</strong> is known as the&nbsp;<strong>Psoas sign</strong>. This is because of psoas muscle spasm, due to the inflamed appendix being in contact with this muscle. The patient often lies in a posture with the right hip flexed for pain relief.</p>\n<p>Other options-</p>\n<p>Option (B): <strong>Rovsing sign:</strong> Presence of pain in the right lower quadrant of the abdomen during palpation of the left lower quadrant of the abdomen.</p>\n<p>Option (C):<strong> Dunphy&rsquo;s sign:</strong>&nbsp;Abdominal pain on coughing.</p>\n<p>Option (D): <strong>Aaron's sign</strong>- Firm pressure over McBurney's point in acute appendicitis causing pain in the epigastrium, left hypochondrium, umbilical and precordial regions.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a0b05397a9a64dd29d064e6090998d92.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man presented with a slowly progressive swelling and pain in the middle of his right leg. On X-ray, multiple sharply demarcated radiolucent lesions are seen in the tibial diaphysis. Microscopic examination of a biopsied specimen reveals epithelial cells in a fibrous stroma. What is the most probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Adamantinoma"
      },
      {
        "id": 2,
        "text": "Osteosarcoma"
      },
      {
        "id": 3,
        "text": "Osteoclastoma"
      },
      {
        "id": 4,
        "text": "Osteoid osteoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Among the given tumors, <strong>adamantinoma</strong> is the most probable diagnosis based on the above-given clinical scenario.</p>\n<p><strong>Adamantinoma</strong> is a <strong>rare tumor of the diaphysis&nbsp;</strong>and presents commonly with pain. It usually presents in the<strong> 2nd or 3rd decade</strong>&nbsp;and arises from the&nbsp;<strong>epithelial</strong> <strong>cells</strong>. The most <strong>common site </strong>for adamantinoma is the <strong>tibia </strong>but it <strong>may</strong> <strong>also</strong> involve the <strong>ipsilateral fibula</strong>.</p>\n<p><strong>Radiological examination</strong> shows <strong>multiple sharply demarcated radiolucent lesions</strong> in the<strong> tibial diaphysis </strong>and<strong> a honeycomb/soap bubble</strong> appearance. <strong>Histology&nbsp;</strong>shows epithelial basaloid cell islands in a&nbsp;<strong>fibrous stroma.</strong></p>\n<p><strong>Complete excision of the tumor</strong> is the treatment of choice.</p>\n<p>The following image shows an X-ray and gross specimen of an adamantinoma.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fc3916480c09483cb80314942794aae9x800x421.JPEG"
    ]
  },
  {
    "text": "A 32-year-old male patient presented with headaches, seizures, and focal neurologic deficits. MRI findings are shown in the image below. Considering the sign seen in the image, what is the probable diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Extradural hematoma"
      },
      {
        "id": 2,
        "text": "Subdural hematoma"
      },
      {
        "id": 3,
        "text": "Craniopharyngioma"
      },
      {
        "id": 4,
        "text": "Meningioma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario of headache, seizures, focal neurological deficits, and the MRI showing a <strong>dural tail sign\u00a0</strong>are suggestive of <strong>meningioma</strong>.</p>\n<p>The<strong> dural tail sign</strong> refers to a <strong>linear, contrast-enhancing tail-like extension</strong> from the tumour, along the dura matter. It is <strong>most commonly seen</strong> in <strong>meningioma\u00a0</strong>(present in about 60% of the cases). However, it may also be seen in the following\u00a0<strong>non-meningiomatous lesions</strong> such as <strong>schwannoma</strong>, <strong>sarcoidosis</strong>, <strong>primary CNS lymphoma</strong>, <strong>metastasis</strong>, and <strong>chloroma</strong>.</p>\n<p>The image given below shows axial (A) and sagittal (B) contrast-enhanced MRI images of the brain. The arrows point towards the thickening and enhancements of the dura, tapering away from the mass and resembling a tail (dural tail sign)<strong>.</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a7be8df22126483bb1a4e103e0fe3088.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/dfe5fb5a13b645db8791b55838de63cbx763x428.JPEG"
    ]
  },
  {
    "text": "A 17-year-old student comes to the clinic with a history of four episodes of arthritis involving large joints and was recently admitted for new-onset atrial fibrillation. A holosystolic murmur with early diastolic rumbling is heard at the apex. An early diastolic murmur is also heard at the right second intercostal space near the sternal edge. Which of the following is recommended for long-term prophylaxis of the likely underlying condition?",
    "choices": [
      {
        "id": 1,
        "text": "Glucocorticoids"
      },
      {
        "id": 2,
        "text": "Monthly penicillin G injections"
      },
      {
        "id": 3,
        "text": "Daily doxycycline"
      },
      {
        "id": 4,
        "text": "Daily aspirin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><span data-preserver-spaces=\"true\">The patient has clinical features and a history suggestive of recurrent episodes of&nbsp;</span><strong><span data-preserver-spaces=\"true\">acute rheumatic fever (ARF)</span></strong><span data-preserver-spaces=\"true\">.&nbsp;<strong>Monthly penicillin G injections&nbsp;</strong>are recommended for long-term prophylaxis.</span></p>\n<p><span data-preserver-spaces=\"true\">The findings of&nbsp;</span><strong><span data-preserver-spaces=\"true\">mitral</span></strong><span data-preserver-spaces=\"true\">&nbsp;</span><strong><span data-preserver-spaces=\"true\">regurgitation</span></strong><span data-preserver-spaces=\"true\">&nbsp;and&nbsp;</span><strong><span data-preserver-spaces=\"true\">aortic</span></strong><span data-preserver-spaces=\"true\">&nbsp;</span><strong><span data-preserver-spaces=\"true\">regurgitation</span></strong><span data-preserver-spaces=\"true\">&nbsp;indicate the diagnosis of ARF. The presence of atrial fibrillation indicates severe rheumatic heart disease.&nbsp;</span><strong><span data-preserver-spaces=\"true\">Prophylaxis</span></strong><span data-preserver-spaces=\"true\">&nbsp;with either oral phenoxymethylpenicillin (250 mg twice daily) or preferably, benzathine benzylpenicillin (1.2 million U IM monthly) is considered the best method to prevent further episodes of ARF, and therefore prevent further valvular damage.</span></p>\n<p>ARF is an autoimmune disease that develops in response to&nbsp;<strong>group A streptococcal</strong>&nbsp;infection. It is commonly seen in children between the age of&nbsp;<strong>5-14&nbsp;</strong>years. An upper respiratory tract infection with some&nbsp;<strong>M serotypes</strong>&nbsp;of the organism is the trigger. The concept of&nbsp;<strong>molecular mimicry</strong>&nbsp;is used to explain the pathogenesis of the condition.&nbsp;</p>\n<p>Since one attack of ARF increases the risk for further episodes and development of RHD,&nbsp;<strong>secondary prophylaxis</strong>&nbsp;is recommended by the American heart association (AHA) as follows:</p>\n<ul>\n<li>Rheumatic fever&nbsp;<strong>without carditis</strong>: For<strong>&nbsp;5 years</strong>&nbsp;after the last attack or&nbsp;<strong>till 21</strong>&nbsp;years of age (whichever is longer).&nbsp;</li>\n<li>Rheumatic fever&nbsp;<strong>with carditis</strong>&nbsp;but&nbsp;<strong>no</strong>&nbsp;residual<strong>&nbsp;valvular disease</strong>: For&nbsp;<strong>10 years</strong>&nbsp;after the last attack or&nbsp;<strong>till 21</strong>&nbsp;years of age (whichever is longer).</li>\n<li>Rheumatic fever with&nbsp;<strong>persistent valvular disease</strong>, evident clinically or on echocardiography: For&nbsp;<strong>10 years</strong>&nbsp;after the last attack or&nbsp;<strong>till</strong>&nbsp;the age of&nbsp;<strong>40</strong>&nbsp;(whichever is longer). Sometimes&nbsp;<strong>lifelong</strong>&nbsp;prophylaxis can be given.</li>\n</ul>\n<p>Symptoms usually present after a latent period of about three weeks. Indolent carditis and chorea are the exceptions that can present even six months later.&nbsp;<strong>Migratory asymmetric polyarthritis</strong>&nbsp;which affects large joints and&nbsp;<strong>high-grade fever</strong>&nbsp;are common features. Cutaneous manifestations include&nbsp;<strong>erythema marginatum</strong>&nbsp;and&nbsp;<strong>subcutaneous nodules</strong>.<strong>&nbsp;Sydenham's chorea</strong>&nbsp;is commonly found in&nbsp;<strong>females</strong>&nbsp;and frequently affects the head and upper limbs.</p>\n<div class=\"page\" title=\"Page 2810\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Other options:</p>\n<p>Option A: <strong>Glucocorticoids</strong> are recommended at a dose of 1&ndash;2 mg/kg per day (maximum, 80 mg), usually for a few days or up to a maximum of 3 weeks.</p>\n<p>Option C:&nbsp;<strong>Doxycycline</strong> is not a first-line agent for group A Streptococcus, the pathogen that causes ARF.</p>\n</div>\n</div>\n</div>\n<p>Option D:<strong><span data-preserver-spaces=\"true\"> Daily aspirin</span></strong><span data-preserver-spaces=\"true\">&nbsp;is the treatment of choice for the migratory arthritis of large joints and fever which are common manifestations of ARF.&nbsp;</span></p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Under the Mental Health Act, a patient has the right to choose his caretaker and future course of action in treatment. What is this provision called?",
    "choices": [
      {
        "id": 1,
        "text": "Treatment directive"
      },
      {
        "id": 2,
        "text": "Mental will"
      },
      {
        "id": 3,
        "text": "Future directive"
      },
      {
        "id": 4,
        "text": "Advance directive"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>An <strong>advance directive</strong>, also known as <strong>living will</strong>, personal directive, medical directive is a <strong>legal document</strong> in which a person specifies<strong> what actions should be taken for their health</strong> in case they're <strong>unable to make decisions</strong> for themselves because of <strong>illness or incapacity.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = 'Neet Mini - 16 (20 Q)';
        const quizFilename = 'neet-mini-16-20-q-4939c5fd.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2020-21"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>