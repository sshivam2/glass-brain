<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>37 Vaginal Infections - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Obstetrics & Gynecology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">23</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is not a risk factor for bacterial vaginosis?",
    "choices": [
      {
        "id": 1,
        "text": "Cigarette smoking"
      },
      {
        "id": 2,
        "text": "Intrauterine device usage"
      },
      {
        "id": 3,
        "text": "Vaginal douching"
      },
      {
        "id": 4,
        "text": "Caucasian race"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Caucasian race is not a&nbsp;risk factor for bacterial vaginosis.&nbsp;</p>\n<p>The<strong> risk factors</strong> for bacterial vaginosis are:</p>\n<ol>\n<li>Oral sex</li>\n<li><strong>Vaginal douching</strong></li>\n<li>African race</li>\n<li><strong>Cigarette smoking</strong></li>\n<li>Sex during menses</li>\n<li><strong>Intrauterine device</strong></li>\n<li>Early age of sexual intercourse</li>\n<li>New or multiple sexual partners</li>\n<li>Sexual activity with other women</li>\n</ol>\n<p>Note: Bacterial vaginosis is not an infection. It most commonly affects young women. Although it is not a sexually transmitted disease, the chances of developing bacterial vaginosis&nbsp;seem to increase with the number of&nbsp;sexual&nbsp;partners that a woman has had.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman was suspected to have bacterial vaginosis. Which of the following statements is false about this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Gardnerella vaginalis is a causative agent"
      },
      {
        "id": 2,
        "text": "Amsel\u2019s criteria is used for diagnosis"
      },
      {
        "id": 3,
        "text": "Vaginal itching is present"
      },
      {
        "id": 4,
        "text": "Oral metronidazole is given for treatment"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Vaginal itching is not seen in bacterial vaginosis. It is a symptom of Trichomonas vaginitis.</p>\n<p>About <strong>half</strong> of the women having <strong>bacterial vaginosis</strong> are <strong>asymptomatic</strong>. Symptomatic women mostly present with&nbsp;a profuse<strong>, fishy</strong>&nbsp;vaginal discharge. It does not cause pruritus, dysuria, and dyspareunia.</p>\n<p>Option A: Bacterial vaginosis occurs due to the&nbsp;<strong>absence </strong>of<em>&nbsp;</em><strong>lactobacilli. </strong>This&nbsp;causes&nbsp;an increase in the <strong>growth</strong> of other <strong>anaerobic bacteria</strong>&nbsp;namely&nbsp;<em>Gardnerella vaginalis</em>,<em> Mobiluncus, </em>and<em> Myco&shy;plasma</em> <em>hominis</em>.</p>\n<p>Option B: <strong>Amsel's criteria</strong> is used for <strong>diagnosing</strong> bacterial vaginosis.&nbsp;<strong>3 out of 4</strong>&nbsp;criteria are needed to make a <strong>positive diagnosis.</strong></p>\n<p>Option D: Oral<strong> metronidazole</strong> 500 mg twice daily for 7 days or oral<strong> clindamycin</strong> 300 mg twice daily for 7 days is given for the treatment of bacterial vaginosis. Treatment remains the same in pregnancy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 30-year old woman presents to your OPD with complaints of foul-smelling vaginal discharge for the past 2 weeks. On examination, the discharge is adherent to the vaginal mucosa and has a fishy odour. What is the most likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Trichomonas"
      },
      {
        "id": 2,
        "text": "Candida"
      },
      {
        "id": 3,
        "text": "Gardnerella"
      },
      {
        "id": 4,
        "text": "Chlamydia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of<strong>&nbsp;bacterial vaginosis </strong>(BV)&nbsp;caused by&nbsp;<strong><em>Gardnerella</em>.</strong><em>&nbsp;</em></p>\n<p>Patients with BV have&nbsp;<strong>profuse</strong> and&nbsp;<strong>yellowish&nbsp;</strong>vaginal discharge<strong>&nbsp;</strong>with a&nbsp;<strong>fishy odour.</strong>&nbsp;It&nbsp;is adherent to the vaginal mucosa. Dysuria, dyspareunia, and vaginal itching are absent. On microscopy,&nbsp;<strong>clue cells</strong> are visible.</p>\n<p>Option A: In&nbsp;<strong>trichomonas</strong> vaginitis, the vaginal discharge is <strong>frothy</strong>,&nbsp;<strong>greenish-yellow</strong>&nbsp;and has an <strong>offensive smell</strong>. Dysuria, dyspareunia, and vaginal itching are generally present.&nbsp;</p>\n<p>Option B: In<strong> candidal </strong>vaginitis, the discharge is<strong> thick</strong> and <strong>curdy white.</strong></p>\n<p>Option D: In <strong>chlamydial</strong> infection, the vaginal <strong>discharge</strong> is generally <strong>scanty.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with bacterial vaginosis, which of the following microscopic features would not be seen?",
    "choices": [
      {
        "id": 1,
        "text": "Abundance of gram variable coccobacilli"
      },
      {
        "id": 2,
        "text": "Reduced number of lactobacilli"
      },
      {
        "id": 3,
        "text": "Abundance of polymorphs"
      },
      {
        "id": 4,
        "text": "Presence of clue cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>An abundance of polymorphs is not a microscopic finding of&nbsp;<strong>bacterial vaginosis</strong> because it is <strong>not</strong> an <strong>inflammatory condition.&nbsp;</strong>It occurs due to an <strong>alteration</strong> in the normal vaginal <strong>flora.</strong></p>\n<p>A swab of the discharge is taken from the vaginal wall and a smear is prepared. The microscopic evaluation is done using a gram stained smear. In bacterial vaginosis, this would reveal a clean background with an abundance of gram variable coccobacilli adhering to the epithelial cells. These are called <strong>clue cells</strong>. A few inflammatory cells,<strong>&nbsp;</strong>other pathogenic organ&shy;isms, and a&nbsp;<strong>reduced</strong> number of<strong>&nbsp;<em>Lactobacilli </em></strong>would also be seen<em>.</em><em>&nbsp;</em></p>\n<p>Shown below is the Gram-stained smear of vaginal discharge&nbsp;of a patient diagnosed with bacterial vaginosis. It reveals&nbsp;<strong>vaginal epithelial cells</strong> that have a <strong>fuzzy border</strong> due to the <strong>adherence</strong> of <strong>bacteria</strong>. These are called <strong>clue cells</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9c5cf560732845958902e7e50b3aa82fx549x720.JPEG"
    ]
  },
  {
    "text": "Given below is the image of a smear prepared from the vaginal discharge of a patient. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Chlamydial vaginitis"
      },
      {
        "id": 2,
        "text": "Gonococcal vaginitis"
      },
      {
        "id": 3,
        "text": "Bacterial vaginosis"
      },
      {
        "id": 4,
        "text": "Trichomonas vaginitis"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The presence of <strong>clue cells</strong>&nbsp;on microscopy is suggestive of&nbsp;<strong>bacterial vaginosis. </strong></p>\n<p>A swab of the vaginal discharge is taken from the vaginal wall and a smear is prepared. The microscopic evaluation of the smear is done on a gram stained smear. It would reveal a clean background with an abundance of gram variable <strong>coccobacilli</strong> <strong>adhering to the</strong> <strong>epithelial cells</strong>. These are called <strong>clue cells</strong>. A few inflammatory cells,<strong>&nbsp;</strong>other pathogenic organ&shy;isms, and a&nbsp;<strong>reduced</strong> number of<strong>&nbsp;<em>Lactobacilli </em></strong>would also be seen<em>.</em><em>&nbsp;</em></p>\n<p>Shown below is the Gram-stained smear of vaginal discharge&nbsp;of a patient diagnosed with bacterial vaginosis. It reveals&nbsp;<strong>vaginal epithelial cells</strong> that have a <strong>fuzzy border</strong> due to the <strong>adherence</strong> of <strong>bacteria</strong>. These are called <strong>clue cells</strong>.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2a19a3f8c2cc4bf4a57f54c38ac8537c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2db304537f594c489c587de70c7d4903x549x720.JPEG"
    ]
  },
  {
    "text": "A woman comes to the clinic with complaints of foul-smelling vaginal discharge. On examination, the discharge was profuse and had a fishy odour. Which of the following is the best criteria to confirm the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Boer-Meisel's criteria"
      },
      {
        "id": 2,
        "text": "Light's criteria"
      },
      {
        "id": 3,
        "text": "Amsel's criteria"
      },
      {
        "id": 4,
        "text": "Nugent's criteria"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given clinical scenario is suggestive of<strong> bacterial vaginosis</strong> which is&nbsp;confirmed by using<strong>&nbsp;Amsel&rsquo;s criteria.&nbsp;</strong></p>\n<p><strong>3 out of 4</strong> of the following criteria are needed, to make a <strong>positive diagnosis</strong> of bacterial vaginosis:</p>\n<ol>\n<li>A homogeneous, thin, <strong>greyish-white discharge</strong> that smoothly coats the vaginal walls.</li>\n<li>A vaginal <strong>pH &gt; 4.5.</strong></li>\n<li>A positive <strong>whiff test</strong> -&nbsp;an amine like fishy odour is produced when a drop of 10% KOH is added to the sample of vaginal discharge.</li>\n<li>The presence of <strong>&gt;20% clue cells</strong> on saline wet mount. These are vaginal epithelial cells studded with adherent coccobacilli at the edge of the cell.</li>\n</ol>\n<p>Option A: <strong>Boer-Miesel's </strong>criteria is used for the <strong>prognostic evaluation</strong> of <strong>pelvic inflammatory disease</strong>.</p>\n<p>Option B: <strong>Light's </strong>criteria is used for determining the nature of the pleural fluid i.e., <strong>transudate or exudate</strong>, in the diagnosis of pleural effusion.</p>\n<p>Option D:<strong> Nugent's </strong>criteria can also be used for diagnosing <strong>bacterial vaginosis.&nbsp;</strong>However, it is not the best confirmatory method.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In a patient with suspected bacterial vaginosis, Nugent's criteria is used to quantify the following bacteria except....",
    "choices": [
      {
        "id": 1,
        "text": "Mycoplasma"
      },
      {
        "id": 2,
        "text": "Gardnerella"
      },
      {
        "id": 3,
        "text": "Lactobacillus"
      },
      {
        "id": 4,
        "text": "Mobiluncus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Nugent's criteria</strong>&nbsp;is used to evaluate three types of bacteria in a case of suspected bacterial vaginosis:&nbsp;<strong><em>Mobiluncus, Lactobacillus, and&nbsp;Gardnerella/Bacteroides.&nbsp;</em></strong>Bacteria are graded through gram stain of vaginal samples.&nbsp;</p>\n<p>They are each graded on a scale of <strong>1+ to 4+</strong> where:</p>\n<ul>\n<li>1+ is &lt; 1 cell per field</li>\n<li>2+ is 1-5 cells per field</li>\n<li>3+ is 6-30 cells per field</li>\n<li>4+ is &gt;30 cells per field</li>\n</ul>\n<p><em>Lactobacillus</em>&nbsp;and&nbsp;<em>Bacteroides/Gardnerella</em>&nbsp;are given scores between 0-4, but&nbsp;<em>Mobiluncus</em>&nbsp;is graded only from 0-2. The total scores are then calculated and interpreted as follows:</p>\n<ul>\n<li>0-3 - Normal</li>\n<li>4-6 - Intermediate bacterial count</li>\n<li><strong>7-10 - Bacterial vaginosis</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A gynaecology resident noted a frothy, greenish, offensive-smelling vaginal discharge in a young lady. Whiff test was positive. Which organism is most likely implicated?",
    "choices": [
      {
        "id": 1,
        "text": "Trichomonas"
      },
      {
        "id": 2,
        "text": "Candidia"
      },
      {
        "id": 3,
        "text": "Gardnerella"
      },
      {
        "id": 4,
        "text": "Chlamydia"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong><em>Trichomonas vaginalis</em></strong> is the likely organism implicated&nbsp;in this patient, causing trichomonas vaginitis.</p>\n<p>The whiff test can be positive in both <em>Trichomonas</em> and <em>Gardnerella</em> infections. However, <strong>greenish frothy discharge</strong> is seen in trichomonas vaginitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient came to the gynaecology OPD with complaints of foul-smelling frothy vaginal discharge and intense itching. On examination, the cervix was spotted and had the appearance of a strawberry. Identify the causative organism.",
    "choices": [
      {
        "id": 1,
        "text": "Trichomonas vaginalis"
      },
      {
        "id": 2,
        "text": "Gardnerella vaginalis"
      },
      {
        "id": 3,
        "text": "Neisseria gonorrhoea"
      },
      {
        "id": 4,
        "text": "Candida albicans"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In the given clinical scenario,&nbsp;<strong><em>Trichomonas vaginalis </em></strong>is the likely causative agent.</p>\n<p>Vaginal itching and foul-smelling frothy vaginal discharge are seen in trichomonas<strong>&nbsp;</strong>vaginitis.</p>\n<p>The given image shows <strong>colpitis macularis</strong> or <strong>strawberry cervix</strong>, which is a characteristic finding of <strong>trichomoniasis</strong><em><strong>. </strong></em>This is due to microscopic, punctate haemorrhages of the cervix.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d04e4e069cc2400695a2a719f54c5dcfx450x598.JPEG"
    ]
  },
  {
    "text": "Which of the following organisms can be detected on a hanging drop preparation?",
    "choices": [
      {
        "id": 1,
        "text": "Gardnerella vaginalis"
      },
      {
        "id": 2,
        "text": "Trichomonas vaginalis"
      },
      {
        "id": 3,
        "text": "Candida albicans"
      },
      {
        "id": 4,
        "text": "Mobiluncus"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><em><strong>Trichomonas vaginalis</strong>&nbsp;</em>can be detected on a<strong>&nbsp;hanging drop </strong>preparation.&nbsp;<em>Trichomonas vaginalis</em> is a protozoan with four anterior flagellae, and a fifth posterior flagellum responsible for motility.</p>\n<p>The image given below shows trophozoites of&nbsp;<em>Trichomonas vaginalis&nbsp;</em>with flagella.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/771b170b09be4ef38dc9baf59578dfcax225x225.JPEG"
    ]
  },
  {
    "text": "A 25-year-old woman came with complaints of greenish vaginal discharge. On saline microscopy, motile flagellated organisms were seen. What is the best treatment option for her?",
    "choices": [
      {
        "id": 1,
        "text": "Doxycycline"
      },
      {
        "id": 2,
        "text": "Amoxicillin"
      },
      {
        "id": 3,
        "text": "Fluconazole"
      },
      {
        "id": 4,
        "text": "Metronidazole"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>trichomonas vaginitis</strong>&nbsp;and the best treatment option for her is<strong>&nbsp;oral metronidazole </strong>2 g stat.</p>\n<p>The<strong> treatment </strong>regimen for<strong> trichomonas&nbsp;vaginitis is:</strong></p>\n<ul>\n<li>An oral dose of metronidazole 500 mg twice daily for 7 days or</li>\n<li>A single oral dose of metronidazole 2 g&nbsp;&nbsp;</li>\n</ul>\n<p>The <strong>male partner</strong> should be<strong> treated</strong>&nbsp;with a single dose of <strong>oral metronidazole</strong> in case of <strong>recurrent infection</strong>. Treatment in pregnancy remains the same.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A pregnant woman in her 7th week of gestation was diagnosed with trichomoniasis. Which of the following can be used to treat her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Topical clotrimazole"
      },
      {
        "id": 2,
        "text": "Oral metronidazole"
      },
      {
        "id": 3,
        "text": "Oral cotrimoxazole"
      },
      {
        "id": 4,
        "text": "Intravenous azithromycin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Trichomonas vaginitis</strong>\u00a0is treated with oral\u00a0<strong>metronidazole </strong>in pregnant women.</p>\n<p>According to the current guidelines, metronidazole is now considered<strong> safe</strong> for treating trichomonas\u00a0vaginitis in<strong> pregnancy </strong>as it\u00a0has no teratogenic effect.</p>\n<p>The<strong> treatment </strong>regimen for<strong> trichomonas\u00a0vaginitis</strong>\u00a0in pregnant women include:</p>\n<ol>\n<li>An oral dose of metronidazole 500 mg twice daily for 7 days or a\u00a0single oral dose of metronidazole 2 g\u00a0\u00a0</li>\n<li>Usage of trichofuran suppositories</li>\n<li>Vinegar douche to lower the vaginal pH</li>\n<li>Betadine gel</li>\n</ol>\n<p>The <strong>male partner</strong> should be<strong> treated</strong>\u00a0with a single dose of <strong>oral metronidazole</strong> in case of <strong>recurrent infection</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 60-year-old diabetic woman presents to your OPD with complaints of curdy white vaginal discharge and intense itching. What is the likely causative agent for her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Trichomonas vaginalis"
      },
      {
        "id": 2,
        "text": "Mobiluncus"
      },
      {
        "id": 3,
        "text": "Chlamydia trachomatis"
      },
      {
        "id": 4,
        "text": "Candida albicans"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>moniliasis</strong> and<strong><em> Candida albicans</em></strong> is the likely causative agent.</p>\n<p>The <strong>risk factors</strong> for moniliasis are:</p>\n<ul>\n<li>Diabetes mellitus</li>\n<li>Obesity</li>\n<li>Multiple sexual partners</li>\n<li>Immunosuppression</li>\n<li>HIV</li>\n<li>Pregnancy</li>\n<li>Steroid therapy</li>\n<li>Following long-term broad-spectrum antibiotic therapy</li>\n<li>Oral contraceptive pills</li>\n<li>Poor personal hygiene.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "In an obese lady with complaints of vaginal discharge, a vaginal pH of 4.2 was detected. Which organism is implicated in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Trichomonas"
      },
      {
        "id": 2,
        "text": "Candida"
      },
      {
        "id": 3,
        "text": "Gardnerella"
      },
      {
        "id": 4,
        "text": "Mycoplasma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The likely causative agent in the given clinical scenario is <em><strong>Candida</strong></em> which is&nbsp;known to flourish in an <strong>acidic environment</strong>. The <strong>pH</strong> of the vaginal discharge in&nbsp;candidal&nbsp;vaginitis is in the range of <strong>4-4.5.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a risk factor for developing a candidal infection?",
    "choices": [
      {
        "id": 1,
        "text": "Oral contraceptive pills"
      },
      {
        "id": 2,
        "text": "Obesity"
      },
      {
        "id": 3,
        "text": "Pregnancy"
      },
      {
        "id": 4,
        "text": "Hypertension"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Hypertension does not increase the risk of developing a candidal infection.</p>\n<p>The<strong>&nbsp;risk factors</strong> for developing&nbsp;<strong>candidal vaginitis </strong>(moniliasis)&nbsp;are:&nbsp;</p>\n<ul>\n<li>Diabe&shy;tes mellitus</li>\n<li>Obesity</li>\n<li>Multiple sexual partners</li>\n<li>Immunosuppression</li>\n<li>HIV</li>\n<li>Pregnancy</li>\n<li>Steroid therapy</li>\n<li>Following long-term broad-spectrum antibiotic therapy</li>\n<li>Oral contraceptive pills</li>\n<li>Poor personal hygiene.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year old woman presents to you with complaints of vaginal discharge and itching. On examination, you note a curdy white discharge and an inflamed vagina. What is the best treatment for her?",
    "choices": [
      {
        "id": 1,
        "text": "Metronidazole"
      },
      {
        "id": 2,
        "text": "Fluconazole"
      },
      {
        "id": 3,
        "text": "Doxycycline"
      },
      {
        "id": 4,
        "text": "Clindamycin"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of<strong>&nbsp;candidal vaginitis.&nbsp;</strong>A <strong>single dose </strong>of<strong> fluconazole 150 mg</strong>&nbsp;is the best treatment for treating candidal vaginitis.&nbsp;Intravaginal antifungal (imidazole/miconazole/clotrimazole) vaginal pessaries or creams can also be used for 3&ndash;6 days.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3258bbd878ab4e9a9f96dabf8bb580efx1280x745.JPEG"
    ]
  },
  {
    "text": "Which of the following is not a primary site for gonococcal infection?",
    "choices": [
      {
        "id": 1,
        "text": "Urethra"
      },
      {
        "id": 2,
        "text": "Bartholin\u2019s glands"
      },
      {
        "id": 3,
        "text": "Ectocervix"
      },
      {
        "id": 4,
        "text": "Skene\u2019s gland"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Ectocervix</strong> and <strong>vagina</strong> are lined by <strong>squamous epithelium</strong> which is<strong> resistant</strong> to gonococcal infection.</p>\n<p>The <strong>principal sites</strong> of invasion for<strong> gonococcal infection&nbsp;</strong>are the&nbsp;<strong>columnar </strong>and&nbsp;<strong>transitional epithelium</strong>. Hence, gonococcus usually affects the following structures:</p>\n<ul>\n<li>Endocervix</li>\n<li>Urethra</li>\n<li>Skene&rsquo;s glands</li>\n<li>Bartholin's glands.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following presentations is unlikely to be seen in a patient with gonorrhoea?",
    "choices": [
      {
        "id": 1,
        "text": "Intermenstrual bleeding"
      },
      {
        "id": 2,
        "text": "Vaginal discharge"
      },
      {
        "id": 3,
        "text": "Proctitis"
      },
      {
        "id": 4,
        "text": "Haematuria"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Haematuria is unlikely to be seen in a patient with gonorrhoea.</p>\n<p><strong>Gynaecological </strong>presentation&nbsp;of <strong>gonorrhoea</strong>&nbsp;is:</p>\n<ul>\n<li>Excessive vaginal discharge associated with pruritus and inflammation</li>\n<li>Acute unilateral pain and swelling over labia due to the involvement of Bartholin&rsquo;s gland</li>\n<li>Intermenstrual bleeding</li>\n</ul>\n<p><strong>Non-gynaecological</strong> presentation&nbsp;of <strong>gonorrhoea</strong>&nbsp;is:</p>\n<ul>\n<li>Pharyngeal infection</li>\n<li>Dysuria&nbsp;</li>\n<li>Rectal discomfort due to associated proctitis.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of non-gonococcal urethritis?",
    "choices": [
      {
        "id": 1,
        "text": "Chlamydia trachomatis"
      },
      {
        "id": 2,
        "text": "Treponema pallidum"
      },
      {
        "id": 3,
        "text": "Candida albicans"
      },
      {
        "id": 4,
        "text": "Staphylococcus aureus"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common cause of non-gonococcal urethritis&nbsp;is <strong><em>Chlamydia trachomatis.</em></strong></p>\n<p>The<strong> causes </strong>of <strong>non-gonococcal urethritis </strong>are:</p>\n<ol>\n<li><em>Chlamydia trachomatis </em>(most common)</li>\n<li><em>Ureaplasma urealyticum</em></li>\n<li>Adenovirus<em>&nbsp;</em></li>\n<li><em>Haemophillus vaginalis</em></li>\n<li><em>Mycoplasma&nbsp;genitalium</em></li>\n<li><em>Tricomonas vaginalis</em> (rare)</li>\n<li>Herpes simplex virus (rare)</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old sex worker was suspected to have chlamydial cervicitis. What is the most sensitive method for confirming the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Direct fluorescent antibody test"
      },
      {
        "id": 2,
        "text": "Enzyme immunoassay"
      },
      {
        "id": 3,
        "text": "Polymerase chain reaction"
      },
      {
        "id": 4,
        "text": "Culture on irradiated McCoy cells"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The <strong>most sensitive</strong> method for confirming the diagnosis of <strong>chlamydial cervicitis</strong> is the&nbsp;<strong>polymerase chain</strong> <strong>reaction</strong> (PCR). It&nbsp;is fast, highly sensi&shy;tive and specific (96%).&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old woman had complaints of lower abdominal pain and vaginal discharge. On microscopy, the following finding was present. What is the selective culture media used to isolate the causative organism?",
    "choices": [
      {
        "id": 1,
        "text": "Culture on Thayer martin media"
      },
      {
        "id": 2,
        "text": "Culture on McCoy cells"
      },
      {
        "id": 3,
        "text": "Culture on bilayer human blood agar"
      },
      {
        "id": 4,
        "text": "Culture on Vero cell lines"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><em><strong>Chlamydia trachomatis</strong> </em>is the most likely causative organism. This is suggested by the presence of characteristic <strong>iodine-stained inclusion bodies</strong> in the<strong> McCoy cell culture</strong>&nbsp;of the patient's endocervical sample.</p>\n<p>Chlamydia is a gram-negative coccobacillus.<strong>&nbsp;</strong>The gram stain of the&nbsp;cervical smear would show <strong>abundant leucocytes</strong> but no organisms.&nbsp;</p>\n<p>The <strong>nucleic acid amplification test</strong>&nbsp;(NAAT) is currently done for the diagnosis of<strong> lymphogranuloma venereum.&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/78e9bdcbc67a41848b295243135a119f.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A patient with complaints of vaginal discharge was evaluated. On an endocervical biopsy, chlamydia was detected. How will you treat this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Azithromycin"
      },
      {
        "id": 2,
        "text": "Azithromycin plus contact tracing"
      },
      {
        "id": 3,
        "text": "Doxycycline and metronidazole"
      },
      {
        "id": 4,
        "text": "Metronidazole"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>A <strong>single dose</strong> of <strong>1 g </strong>of <strong>azithromycin</strong>&nbsp;is given and<strong> contact tracing</strong>&nbsp;is done to treat a patient diagnosed with a <strong>chlamydial infection.</strong></p>\n<p>Treatment of&nbsp;chlamydial infection:</p>\n<ul>\n<li>Azithromycin 1 g single dose (or)</li>\n<li>Doxycycline 100 mg orally BID &times; 7 days (or)</li>\n<li>Ofloxacin 200 mg orally BID &times; 7 days (or)</li>\n<li>Erythromycin 500 mg orally BID &times; 7 days</li>\n</ul>\n<p>Contact tracing should always be done.&nbsp;The sexual partner should also be treated with the same regimen.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old lady complains of thick curdy white vaginal discharge with itching and burning. What is the route of administration of the first non-azole drug approved to treat this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Oral"
      },
      {
        "id": 2,
        "text": "Intradermal"
      },
      {
        "id": 3,
        "text": "Intravenous"
      },
      {
        "id": 4,
        "text": "Topical"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The clinical history of thick curdy white vaginal discharge with itching and burning are suggestive of <strong>vulvovaginal candidiasis.</strong> The first and the only non-azole antifungal approved for the treatment of vulvovaginal candidiasis is <strong>Ibrexafungerp.</strong> The route of administration of this drug is <strong>oral.</strong></p>\n<p><strong>Ibrexafungerp</strong> is a triterpenoid antifungal agent that acts by <strong>inhibiting glucan synthase</strong>. Glucan synthase is an enzyme involved in the formation of 1,3-beta-D-glucan which is an essential component of the fungal cell wall.</p>\n<p>The recommended dosage is 600 mg orally as 2 divided doses 12 hrs apart. Contraindications include pregnancy and hypersensitivity to ibrexafungerp. The most frequent adverse reactions are diarrhea, nausea, abdominal pain, dizziness, and vomiting.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '37 Vaginal Infections';
        let hierarchy = ["Marrow", "qBank", "Obstetrics & Gynecology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>