<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16 Disorders Of The Eyelid - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Ophthalmology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">22</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is defined as loss of eyelashes?",
    "choices": [
      {
        "id": 1,
        "text": "Tylosis"
      },
      {
        "id": 2,
        "text": "Madarosis"
      },
      {
        "id": 3,
        "text": "Trichiasis"
      },
      {
        "id": 4,
        "text": "Distichiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D:\u00a0Distichiasis\u00a0is the presence of a\u00a0double row of eyelashes.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3c939b4b4e34b1aadee507efae30595x462x350.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e887d4ac788547b7b82bce71961c1f93x1280x1251.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4e98883c42c44cdd92dabb3ce9d76c28x462x386.PNG"
    ]
  },
  {
    "text": "What is the term used to describe an extra row of eyelashes behind the grey line?",
    "choices": [
      {
        "id": 1,
        "text": "Trichiasis"
      },
      {
        "id": 2,
        "text": "Distichiasis"
      },
      {
        "id": 3,
        "text": "Tylosis"
      },
      {
        "id": 4,
        "text": "Madarosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The extra row of eyelashes behind the grey line is called\u00a0<strong>distichiasis. </strong></p>\n<p>Distichiasis can occur due to congenital or acquired causes. These lashes may\u00a0irritate the cornea. Management is by lid splitting with\u00a0cryotherapy to the base of the hair follicles.</p>\n<p>Other options:</p>\n<p>Option A: Trichiasis is\u00a0inward misdirection of cilia, with the normal position of the lid margin.</p>\n<p>Option C: Tylosis is the\u00a0thickening of the tarsal plate.</p>\n<p>Option D: Madarosis is the\u00a0loss of eyelashes or eyebrows.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A term neonate is referred to the district hospital for an ophthalmic exam. Partial fusion of her right upper and lower eyelids by a central narrow band of tissue is noted as shown below. The left eye examination is normal. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Symblepharon"
      },
      {
        "id": 2,
        "text": "Ankyloblepharon"
      },
      {
        "id": 3,
        "text": "Blepharophimosis"
      },
      {
        "id": 4,
        "text": "Lagophthalmos"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D:\u00a0Lagophthalmos is characterized by the inability to close the eyelids voluntarily. It may be due to a malfunction of the facial nerve. The image below shows nocturnal lagophthalmos (inability to close eyelids during sleep).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/e0fd1676772f47ce91683a023ca3a409.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/fd987f90cc184588ab1f655f350b11f9x328x256.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b0b4712237ec462c8362bfbbe45cc1a4x599x276.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a7e22d5036a146fba5d5f479ba3fa5b0x450x600.PNG"
    ]
  },
  {
    "text": "A male patient complains of a foreign body sensation, irritation, and lacrimation in the right eye. During the evaluation, you notice the following findings with normal lid margins. What is this condition known as?",
    "choices": [
      {
        "id": 1,
        "text": "Distichiasis"
      },
      {
        "id": 2,
        "text": "Trichiasis"
      },
      {
        "id": 3,
        "text": "Pseudotrichiasis"
      },
      {
        "id": 4,
        "text": "Pseudodistichiasis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario and the above image is suggestive of <strong>trichiasis.</strong></p>\n<p><strong>Trichiasis </strong>refers to the inward misdirection of cilia, which usually rub against the eyeball with the normal position of the lid margin. These patients present with foreign body sensations and photophobia. They experience troublesome irritation, pain, and lacrimation.\u00a0 On examination, one or more misdirected cilia touching the cornea are seen. The conjunctiva may be congested.</p>\n<p>Treatment includes:</p>\n<ul>\n<li><strong>Epilation:</strong> Mechanical removal with forceps</li>\n<li class=\"p1\"><span class=\"s1\"><strong>Electrolysis:</strong> M</span>ethod of destroying the\u00a0lash follicle by electric current.</li>\n<li class=\"p1\">Cryoepilation</li>\n<li class=\"p1\">Surgical correction.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f15782bf0f01417e89a8cb2706798d67.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a558477072a46b385b381ee1e0c6b97x1280x1251.JPEG"
    ]
  },
  {
    "text": "What defines telecanthus?",
    "choices": [
      {
        "id": 1,
        "text": "Widened inter-pupillary distance"
      },
      {
        "id": 2,
        "text": "Widely separated medial orbital wall"
      },
      {
        "id": 3,
        "text": "Widened inter-orbital distance"
      },
      {
        "id": 4,
        "text": "Widened root of the nose with normal inter-pupillary distance"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Telecanthus </strong>means an increased distance between medial\u00a0canthi (widened root of the nose) with <strong>normal inter-pupillary distance</strong>.</p>\n<p>In <strong>hypertelorism</strong>,\u00a0there is a wide bony separation of the orbits.</p>\n<p>In <strong>epicanthus</strong>, there are <strong>bilateral vertical folds</strong> of <strong>skin</strong> that extend from the upper or lower lids <strong>towards</strong> the <strong>medial canthi</strong>. They may give rise to\u00a0<strong>pseudoesotropia</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/230199f1eecf47828803f55612451027x774x298.PNG"
    ]
  },
  {
    "text": "Weiss operation is done in which of the following condition?",
    "choices": [
      {
        "id": 1,
        "text": "Entropion"
      },
      {
        "id": 2,
        "text": "Ectropion"
      },
      {
        "id": 3,
        "text": "Trichiasis"
      },
      {
        "id": 4,
        "text": "Ptosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Weiss operation </strong>is done in <strong>senile entropion.\u00a0</strong>In this operation, the transverse lid split, and everything sutures are placed.</p>\n<p><strong>Entropion</strong> refers to the\u00a0<strong>inward rolling</strong> and <strong>rotation</strong> of the <strong>lid margin</strong> towards the globe. It is more common in the lower lid.</p>\n<p>Causes include:</p>\n<ul>\n<li>Horizontal lid laxity</li>\n<li>Vertical lid instability</li>\n<li>Over-riding of the pretarsal by the preseptal orbicularis during lid closure</li>\n<li>Orbital septum laxity</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7b9cd63307f2459ba5df1b479b8940cex642x312.PNG"
    ]
  },
  {
    "text": "For which of the following is medial conjunctivoplasty the surgical modality of treatment?",
    "choices": [
      {
        "id": 1,
        "text": "Entropion"
      },
      {
        "id": 2,
        "text": "Ectropion"
      },
      {
        "id": 3,
        "text": "Blepharophimosis"
      },
      {
        "id": 4,
        "text": "Ptosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Medial conjunctivoplasty</strong> is done in <strong>involutional ectropion</strong>.</p>\n<p><strong>Ectropion </strong>is the\u00a0<strong>eversion</strong> of the lid margin and eyelashes away from the globe.</p>\n<p>Types:</p>\n<ul>\n<li>Involutional/senile - affects the lower lid of <strong>elderly</strong> patients.</li>\n<li>Cicatricial <strong>-</strong>\u00a0caused by the\u00a0<strong>scarring</strong> or contracture of the skin and underlying tissues</li>\n<li>Paralytic <strong>-</strong>\u00a0caused by <strong>ipsilateral facial nerve palsy</strong>\u00a0</li>\n<li>Mechanical <strong>-</strong>\u00a0caused by <strong>tumors</strong> on or near the lid margin that mechanically evert the lid</li>\n<li>Congenital</li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9af1b9ec979247f488fb90b2aeaef9e6x1280x1539.0691114245417.JPEG"
    ]
  },
  {
    "text": "Which among the following is not a feature of blepharophimosis syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Narrow palpebral fissure"
      },
      {
        "id": 2,
        "text": "Ptosis"
      },
      {
        "id": 3,
        "text": "Telecanthus"
      },
      {
        "id": 4,
        "text": "Entropion"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Entropion</strong> is not a feature of blepharophimosis syndrome.</p>\n<p>Blepharophimosis, ptosis, and epicanthus inversus syndrome (BPES)\u00a0consists of the following:</p>\n<ul>\n<li>Narrow palpebral fissure</li>\n<li>Ptosis</li>\n<li>Congenital <strong>ectropion</strong> of the lower lid</li>\n<li>Telecanthus</li>\n<li><strong>Epicanthus inversus:</strong>\u00a0an extra fold of skin arising from the\u00a0lower lid</li>\n</ul>\n<p>The image below shows\u00a0blepharophimosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/86d2695d4db64c3c9c4a95de6ecf5a68x451x166.JPEG"
    ]
  },
  {
    "text": "The physician noticed the following finding in a patient that came to the OPD for an eye exam. Which of the following pair of muscles are likely to be affected in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Muller's muscle and superior rectus"
      },
      {
        "id": 2,
        "text": "Levator palpebrae superioris and superior oblique"
      },
      {
        "id": 3,
        "text": "Superior oblique and superior rectus"
      },
      {
        "id": 4,
        "text": "Levator palpebrae superioris and Muller's muscle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient has mild right eye <strong>ptosis.</strong> Injury or weakness of <strong>levator palpebrae</strong>\u00a0<strong>superioris</strong> and <strong>Muller's</strong> muscle leads to ptosis.</p>\n<p><strong>Levator palpebrae superioris</strong> is the important <strong>upper eyelid retractor</strong>.\u00a0Frontalis and <strong>Muller\u2019s muscle</strong> assist in the elevation of the upper eyelid.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cb9d168bcab1487993b5ca0dfa6a7363.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions is a cause of pseudoptosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lambert\u2013Eaton syndrome"
      },
      {
        "id": 2,
        "text": "Big chalazion"
      },
      {
        "id": 3,
        "text": "Blepharophimosis syndrome"
      },
      {
        "id": 4,
        "text": "Brow ptosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Brow ptosis</strong> is a type of <strong>pseudoptosis,\u00a0</strong>not ptosis.</p>\n<p><strong>Ptosis</strong>\u00a0is abnormal drooping of the upper eyelid to a level that covers <strong>more</strong> <strong>than 2mm</strong> of the superior cornea.\u00a0</p>\n<p>Types of ptosis:</p>\n<ul>\n<li><strong>Mechanical</strong> ptosis <strong>- </strong>Can be due to<strong> </strong>lid <strong>tumors, </strong>multiple/big <strong>chalazions,</strong> and conjunctival <strong>scarring</strong></li>\n<li><strong>Aponeurotic</strong> ptosis <strong>- </strong>Due to <strong>dehiscence</strong> of the aponeurosis and in <strong>postoperative </strong>patients</li>\n<li><strong>Involutional </strong>ptosis seen in<strong> </strong>old age</li>\n<li><strong>Neurogenic </strong>ptosis due to a<strong> </strong>3<sup>rd</sup> nerve palsy, Horner syndrome and synkinetic ptosis/<strong>Marcus\u2013Gunn jaw-winking</strong> ptosis</li>\n<li><strong>Myogenic ptosis </strong>\n<ul>\n<li><strong>Congenital:</strong>\u00a0<strong>most common myogenic ptosis</strong>\n<ul>\n<li>Simple</li>\n<li><strong>Blepharophimosis</strong> syndrome</li>\n<li>Congenital synkinetic ptosis</li>\n</ul>\n</li>\n<li><strong>Acquired </strong>\n<ul>\n<li>Myasthenia gravis</li>\n<li>Lambert\u2013Eaton syndrome</li>\n<li>Ocular myopathy</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>Causes of <strong>pseudoptosis\u00a0</strong>(apparent ptosis):</p>\n<ul>\n<li>Lack of support\u00a0of the lids by the globe e.g.\u00a0artificial eye, microphthalmos, phthisis bulbi, or enophthalmos.</li>\n<li>Contralateral lid retraction</li>\n<li>Ipsilateral hypotropia</li>\n<li><strong>Brow ptosis</strong>\u00a0occurs due to\u00a0<strong>excessive skin</strong>\u00a0on the brow, or seventh nerve palsy, which is diagnosed by manually elevating the<br />eyebrow\u00a0</li>\n<li>Dermatochalasis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 45-year-old patient comes with complaints of progressive weakness as the day progresses. He is found to have antibodies against nicotinic acetylcholine receptors. Which is the most common ocular finding in this disease?",
    "choices": [
      {
        "id": 1,
        "text": "Diplopia"
      },
      {
        "id": 2,
        "text": "Lagophthalmos"
      },
      {
        "id": 3,
        "text": "Exophthalmos"
      },
      {
        "id": 4,
        "text": "Ptosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>myasthenia gravis</strong> and <strong>ptosis</strong> is the most common ocular feature of\u00a0the disease.</p>\n<div class=\"page\" title=\"Page 3550\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Myasthenia gravis (MG) is an <strong>autoimmune</strong> disorder of the neuromuscular junction most commonly caused by <strong>anti-</strong><strong>acetylcholine receptor antibodies</strong>. The\u00a0disorder is characterized by <strong>weakness</strong> and <strong>fatigability</strong> of skeletal muscles where the weakness <strong>increases</strong> during <strong>repeated use\u00a0</strong>and may <strong>improve</strong> following <strong>rest.</strong></p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Ptosis</strong> and <strong>diplopia</strong> are common <strong>initial complaints</strong>\u00a0due to <strong>early involvement</strong> of the <strong>lids</strong> and <strong>extraocular muscles</strong> (EOMs). Of them,\u00a0<strong>Ptosis</strong> is a <strong>more common</strong> manifestation than diplopia. <strong>Ptosis</strong> in myasthenia gravis is insidious, <strong>bilateral,</strong> and frequently <strong>asymmetrical.</strong></p>\n<p>Investigations of myasthenia gravis include:</p>\n<ol>\n<li><strong>Ice pack test </strong>-This tests for a transient improvement of the ptotic eyelid on placing an ice pack for 2 minutes, as\u00a0 the cold inhibits the breakdown of acetylcholine by acetylcholinesterase.</li>\n<li><strong>Tensilon</strong> (<strong>Edrophonium</strong>) test - This tests for a transient improvement in the weakness on administration of a short-acting anticholinesterase such as edrophonium.</li>\n<li><strong>Antibody testing </strong>- for\u00a0Acetylcholine receptor (AChR) antibodies,\u00a0MuSK protein antibodies helps support a diagnosis of myasthenia gravis.</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following conditions will not have a finding of bilateral ptosis?",
    "choices": [
      {
        "id": 1,
        "text": "Myasthenia gravis"
      },
      {
        "id": 2,
        "text": "Marfan's syndrome"
      },
      {
        "id": 3,
        "text": "Myotonic dystrophy"
      },
      {
        "id": 4,
        "text": "Kearns-Sayre syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Bilateral ptosis</strong> is not seen in\u00a0<strong>Marfan's</strong> syndrome.</p>\n<p>Causes of unilateral ptosis:</p>\n<ol>\n<li>Horner's syndrome</li>\n<li>Oculomotor nerve palsy</li>\n</ol>\n<p>Causes of bilateral ptosis:</p>\n<ol>\n<li>Congenital</li>\n<li>Senile/involutional/aponeurotic</li>\n<li>Blepharophimosis syndrome</li>\n<li>Myasthenia gravis</li>\n<li>Chronic progressive external ophthalmoplegia (CPEO)<strong> - </strong>seen in Kearns-Sayre syndrome</li>\n<li>Myotonic dystrophy</li>\n<li>Ocular myopathies</li>\n</ol>\n<p>The image below shows\u00a0a case of botulinum toxicity with bilateral ptosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/accca8052eb640b892f3e7d2b5fdada4x248x380.PNG"
    ]
  },
  {
    "text": "During OPD hours, a patient came with the finding shown below. On examination, the upper 4 mm of the cornea is covered by the upper eyelid. What is the grade of ptosis in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Mild"
      },
      {
        "id": 2,
        "text": "Moderate"
      },
      {
        "id": 3,
        "text": "Severe"
      },
      {
        "id": 4,
        "text": "Profound"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In this question, 4 mm of the cornea is covered by the upper eyelid. Subtracting 2 mm from this implies that there is 2 mm of ptosis, which is classified as mild grade.\u00a0</p>\n<p>In <strong>bilateral</strong> cases, the <strong>grade</strong> of <strong>ptosis</strong> can be determined by measuring the amount of cornea covered by the upper lid and then subtracting 2 mm. Depending upon this value, the ptosis is graded as follows:</p>\n<ul>\n<li>Mild: 2 mm</li>\n<li>Moderate: 3 mm</li>\n<li>Severe: 4 mm</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/1c4b698588554633aa6828bb1fee54b9.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A child with a high risk of amblyopia is planned for surgical correction of unilateral simple congenital ptosis. He has poor levator function. What is the treatment of choice in this case?",
    "choices": [
      {
        "id": 1,
        "text": "Levator resection"
      },
      {
        "id": 2,
        "text": "Frontalis sling"
      },
      {
        "id": 3,
        "text": "Fasanella-Servat operation"
      },
      {
        "id": 4,
        "text": "Mullerectomy"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Frontalis sling</strong>&nbsp;procedure is the treatment of choice for&nbsp;<strong>congenital ptosis</strong> with poor levator function.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents to you with anhidrosis and enophthalmos. Examination reveals miosis along with mild ptosis. You decide to correct the ptosis by performing a Fasanella-Servat operation, by resecting which of the following muscles?",
    "choices": [
      {
        "id": 1,
        "text": "Levator palpebrae superioris muscle"
      },
      {
        "id": 2,
        "text": "Frontalis muscle"
      },
      {
        "id": 3,
        "text": "Superior rectus muscle"
      },
      {
        "id": 4,
        "text": "Muller's muscle"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Horner's syndrome</strong> and the associated mild ptosis in this condition can be corrected by <strong>resecting Muller's muscle</strong>.</p>\n<p><strong>Ptosis</strong>\u00a0in Horner's syndrome is due to the paralysis of Muller's muscle.</p>\n<p><strong>Fasanella-Servat</strong>\u00a0operation\u00a0is indicated in cases having mild ptosis<strong>(&lt; 2 mm)\u00a0</strong>and good levator function. In this surgery, the upper\u00a0tarsal border along with its attached Muller\u2019s muscle and conjunctiva are resected.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A couple brought their 11-month-old child for an eye exam when they noticed that his left upper eyelid was in a lower position than his right one. The mother also noticed that his left upper eyelid goes \"up and down\u201d when she breastfeeds him. His delivery was unremarkable. When the baby opens his mouth or sucks his thumb, the left eyelid ptosis disappears. What is the pathology behind this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Superior division of the third cranial nerve is misdirected"
      },
      {
        "id": 2,
        "text": "Sympathetic nerves to Muller's muscles are misdirected"
      },
      {
        "id": 3,
        "text": "Ophthalmic division of the fifth cranial nerve is misdirected"
      },
      {
        "id": 4,
        "text": "Mandibular division of the fifth cranial nerve is misdirected"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical scenario is suggestive of <strong>Marcus\u2013Gunn jaw-winking phenomenon</strong>. In this condition, the\u00a0<strong>mandibular division</strong> of the <strong>fifth</strong> cranial nerve is <strong>misdirected</strong> to the levator muscle.</p>\n<p>Some cases of <strong>congenital ptosis</strong> are associated with the Marcus\u2013Gunn jaw-winking phenomenon. The vast majority are <strong>unilateral</strong>.<strong>\u00a0</strong>Signs include <strong>retraction</strong> of the <strong>ptotic lid</strong> in conjunction with <strong>stimulation</strong> of the <strong>ipsilateral pterygoid muscles</strong> by chewing, <strong>sucking</strong>, <strong>opening</strong> the mouth, or contralateral jaw movement. Less common stimuli to winking include <strong>jaw protrusion</strong>, <strong>smiling</strong>, swallowing, and clenching of teeth.\u00a0Jaw-winking does <strong>not improve</strong> with <strong>age</strong> although patients may learn to mask it.</p>\n<p>The following image shows a\u00a0woman with\u00a0Marcus\u2013Gunn jaw-winking phenomenon. See how her right eyelid ptosis retracts with the opening of the mouth.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a5ba0d91ff064f5994d63748b3f159d4x414x462.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/1e89e10db2654591bd4aed0b507b657fx414x438.PNG"
    ]
  },
  {
    "text": "Which of the following is the causative agent for blepharitis acarica?",
    "choices": [
      {
        "id": 1,
        "text": "Moraxella"
      },
      {
        "id": 2,
        "text": "Staphylococcus"
      },
      {
        "id": 3,
        "text": "Propionibacterium"
      },
      {
        "id": 4,
        "text": "Demodex folliculorum"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Blepharitis acarica is caused by <em><strong>Demodex folliculorum</strong></em>.</p>\n<p>Blepharitis\u00a0is a <strong>chronic inflammation</strong> of the <strong>margins</strong> of the lids.</p>\n<p>The two types are</p>\n<ul>\n<li><strong>Anterior</strong>\n<ul>\n<li>Seborrheic and ulcerative types</li>\n<li>Caused by<strong> staphylococci,\u00a0</strong>mainly</li>\n</ul>\n</li>\n<li><strong>Posterior </strong>\u2013 <strong>Mebomianitis</strong></li>\n</ul>\n<p>Occasionally caused by</p>\n<ul>\n<li><em>Demodex folliculorum </em>\u2013 <strong>Blepharitis acarica</strong></li>\n<li>Crab louse \u2013 <strong>Phthiriasis palpebrarum</strong></li>\n</ul>\n<p>The following image shows swollen and inflamed eyelid suggestive of blepharitis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://cdn1.dailyrounds.org/uploads/62dbd670f7b94148a8135e678c9f81cdx220x165.JPEG"
    ]
  },
  {
    "text": "What is the most common malignant tumor of the eyelid?",
    "choices": [
      {
        "id": 1,
        "text": "Sebaceous gland carcinoma"
      },
      {
        "id": 2,
        "text": "Basal cell carcinoma"
      },
      {
        "id": 3,
        "text": "Squamous cell carcinoma"
      },
      {
        "id": 4,
        "text": "Malignant melanoma"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<table style=\"height: 671px; width: 461px;\">\n<tbody>\n<tr style=\"height: 36px;\">\n<td style=\"width: 85.5px; height: 36px;\">Type</td>\n<td style=\"width: 71.75px; height: 36px;\">Common location</td>\n<td style=\"width: 159.172px; height: 36px;\">Clinical features</td>\n<td style=\"width: 97.4375px; height: 36px;\">Spread</td>\n</tr>\n<tr style=\"height: 166px;\">\n<td style=\"width: 85.5px; height: 166px;\">Basal cell carcinoma</td>\n<td style=\"width: 71.75px; height: 166px;\"><strong>Lower lid/</strong>Medial canthus</td>\n<td style=\"width: 159.172px; height: 166px;\">\n<ul>\n<li><strong>Nodule</strong></li>\n<li>Central ulceration with <strong>pearly</strong> surface, <strong style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\">telangiectasia</strong></li>\n</ul>\n</td>\n<td style=\"width: 97.4375px; height: 166px;\">local</td>\n</tr>\n<tr style=\"height: 54px;\">\n<td style=\"width: 85.5px; height: 54px;\">Squamous cell carcinoma</td>\n<td style=\"width: 71.75px; height: 54px;\"><strong>Lower lid</strong>, from previous actinic keratosis</td>\n<td style=\"width: 159.172px; height: 54px;\">\n<ul>\n<li><strong>Ulcer</strong> with thickened margins, <strong>keratosis </strong></li>\n<li><strong>p</strong><strong>apillomatous</strong></li>\n</ul>\n</td>\n<td style=\"width: 97.4375px; height: 54px;\">\n<p>Local, lymph nodes</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 85.5px; height: 18px;\">Sebaceous cell carcinoma</td>\n<td style=\"width: 71.75px; height: 18px;\"><strong>Upper</strong> lid</td>\n<td style=\"width: 159.172px; height: 18px;\">\n<ul>\n<li>Nodule-like <strong>chalazion</strong></li>\n<li><strong>Multifocal</strong></li>\n<li><strong>Females </strong>&gt;males</li>\n<li><strong>Recurrences</strong> common</li>\n</ul>\n</td>\n<td style=\"width: 97.4375px; height: 18px;\">\n<p>Local intraepithelial lymph nodes</p>\n</td>\n</tr>\n<tr style=\"height: 18px;\">\n<td style=\"width: 85.5px; height: 18px;\">Malignant melanoma</td>\n<td style=\"width: 71.75px; height: 18px;\"><strong>Previous nevi</strong></td>\n<td style=\"width: 159.172px; height: 18px;\">\n<ul>\n<li>&gt;<strong>6 mm</strong> pigmented,\u00a0</li>\n<li><strong>Vascularization</strong></li>\n<li>inflammation</li>\n</ul>\n</td>\n<td style=\"width: 97.4375px; height: 18px;\">\n<p>Local, vascular lymph nodes</p>\n</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following systemic drugs is used specifically in the management of periocular basal cell carcinoma?",
    "choices": [
      {
        "id": 1,
        "text": "Imiquimod"
      },
      {
        "id": 2,
        "text": "Vismodegib"
      },
      {
        "id": 3,
        "text": "Siponimod"
      },
      {
        "id": 4,
        "text": "Interferon"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Vismodegib</strong> is the systemic drug used for the management of periocular basal cell carcinoma (BCC).</p>\n<p>Vismodegib\u00a0is an eye-sparing adjuvant\u00a0therapy of periocular and orbital BCC for patients:</p>\n<ul>\n<li>Who cannot tolerate surgery or radiotherapy, or</li>\n<li>With relapsed locally advanced disease after surgery or</li>\n<li>With metastatic disease.</li>\n</ul>\n<p>Vismodegib is a Hedgehog pathway inhibitor, given 150 mg orally twice a day.</p>\n<p>Treatment options for BCC consist of surgery, radiotherapy,\u00a0and chemotherapy. Surgical excision using Mohs micrographic surgery or <strong>wide surgical excision</strong> with <strong>frozen section margin control</strong> is the first-line treatment of periocular BCC.\u00a0</p>\n<p>Other options:</p>\n<p>Option A: Imiquimod 5% topical cream can also be used in patients with BCC. But, it is not a systemic drug.</p>\n<p>Option C: Siponimod is the drug approved for secondary progressive multiple sclerosis.</p>\n<p>Option D: Interferons are generally not used in periocular BCC.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 6-month-old girl was brought by her worried parents due to a swelling on the eyelid as shown below. They were told by a local village doctor that the swelling will disappear on its own but recently it has been increasing rapidly. What would be the most likely management of this baby's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Reassurance and observation"
      },
      {
        "id": 2,
        "text": "Treatment with intralesional steroids at 2 years of age"
      },
      {
        "id": 3,
        "text": "Immediate treatment with radiotherapy"
      },
      {
        "id": 4,
        "text": "Immediate treatment with oral propranolol"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The history and image are suggestive of <strong>capillary hemangioma</strong> involving the left upper lid and periocular region causing severe mechanical <strong>ptosis.</strong>\u00a0Immediate management with <strong>oral propranolol</strong> is the treatment of choice in this case.</p>\n<p>The ptosis is so severe that it obstructs the pupillary area (visual axis) with the risk of <strong>sensory deprivation amblyopia.</strong>\u00a0 This warrants immediate treatment to reduce the bulk of the tumor.</p>\n<p>Capillary hemangioma regresses spontaneously very often. It may be managed by oral propranolol, oral prednisolone, or intralesional steroid.</p>\n<p>Indications for treatment of patients with capillary hemangioma with pharmacologic therapy are:</p>\n<ul>\n<li>Visual symptoms (amblyopia, astigmatism, occlusion, strabismus)</li>\n<li>Cosmesis</li>\n<li>Optic nerve compression</li>\n<li>Exposure keratopathy</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f93a0758a3a74d93a9ab6da0e252cccd.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the clinical condition.",
    "choices": [
      {
        "id": 1,
        "text": "Marfan\u2019s syndrome"
      },
      {
        "id": 2,
        "text": "Neurofibromatosis"
      },
      {
        "id": 3,
        "text": "Tuberous sclerosis"
      },
      {
        "id": 4,
        "text": "Mikulicz's syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The image shows <strong>plexiform neurofibroma</strong> of the upper lid causing an S-shaped deformity of the upper lid and mechanical ptosis. This is seen particularly in neurofibromatosis type 1.</p>\n<p>NF1 is caused by the autosomal dominant <strong>loss-of-function</strong> mutations in the <strong>NF1</strong> gene on <strong>chromosome 17.</strong> It is a tumor suppressor gene that encodes <strong>neurofibromin,</strong> a negative RAS regulator. The disease is clinically diagnosed when any <strong>two</strong> of the following <strong>seven features</strong> are present:</p>\n<ul>\n<li>Six or more <strong>caf\u00e9-au-lait</strong> macules (CALMs) - They are the hallmark of neurofibromatosis and are present in almost 100% of patients. They are present at birth but increase in size, number, and pigmentation, especially during the first few years of life, and are scattered over the entire body.\u00a0</li>\n<li>Axillary or inguinal <strong>freckling</strong></li>\n<li>Two or more iris <strong>Lisch</strong> nodules - They are iris hamartomas that are best identified by a slit-lamp examination. They are present in the majority of patients with NF1.</li>\n<li>Two or more <strong>neurofibromas</strong> or 1 plexiform neurofibroma</li>\n<li>A distinctive osseous lesion such as <strong>sphenoid dysplasia</strong> or <strong>cortical thinning</strong> of <strong>long bones</strong> such as the tibia</li>\n<li>Optic <strong>gliomas</strong> (most frequently observed CNS tumor in NF1)</li>\n<li>A <strong>first-degree relative</strong> with NF-1</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/525a5aadf4ab4ef784557a7932cedd73.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following sign is used to describe the fullness of eyelids seen in Grave's ophthalmopathy?",
    "choices": [
      {
        "id": 1,
        "text": "Mobius\u2019 sign"
      },
      {
        "id": 2,
        "text": "von Graefe's sign"
      },
      {
        "id": 3,
        "text": "Stellwag\u2019s sign"
      },
      {
        "id": 4,
        "text": "Enroth\u2019s sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>fullness of the eyelids</strong> is described as the <strong>Enroth's sign</strong> in Graves ophthalmopathy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '16 Disorders Of The Eyelid';
        let hierarchy = ["Marrow", "qBank", "Ophthalmology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>