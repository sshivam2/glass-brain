<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>78 Myeloid Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        PrepLadder / qBank / Pathology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">7</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "<p>A 45-year-old female presents with complaints of occasional headaches and blurred vision. Laboratory tests reveal isolated thrombocytosis without significant leukocytosis or erythrocytosis. Bone marrow biopsy shows increased megakaryocytes. Which of the following types of myeloproliferative neoplasm (MPN) is most likely to be diagnosed based on these findings?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Polycythemia Vera (PV)"
      },
      {
        "id": 2,
        "text": "Essential Thrombocytosis (ET)"
      },
      {
        "id": 3,
        "text": "Chronic Myeloid Leukemia (CML)"
      },
      {
        "id": 4,
        "text": "Primary Myelofibrosis (PMF)"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct answer: B)Essential <span class=\"customMeta\" data-dictid=\"2a6fe222d7169277720012fabb1227\">Thrombocytosis</span> (ET)</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Essential <span class=\"customMeta\" data-dictid=\"2a6fe222d7169277720012fabb1227\">thrombocytosis</span> is a type of <span class=\"customMeta\" data-dictid=\"8dd789d7d1169277719303d4744837\">myeloproliferative</span> <span class=\"customMeta\" data-dictid=\"1622f69a94169277719372b76236ca\">neoplasm</span> which is characterized by isolated <span class=\"customMeta\" data-dictid=\"2a6fe222d7169277720012fabb1227\">thrombocytosis</span> without any without significant <span class=\"customMeta\" data-dictid=\"515cde208f1692777191112bb2ff9e\">leukocytosis</span> or <span class=\"customMeta\" data-dictid=\"558553268016927771875ed1ba9b1c\">erythrocytosis</span> , along with increased megakaryocytes in <span class=\"customMeta\" data-dictid=\"5b9831f3aa169277718395d7361df6\">bone marrow</span> biopsy</p>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li>It is <span class=\"customMeta\" data-dictid=\"d1a9a79f701692777182066af09044\">asymptomatic</span> in more than half of the cases and is usually diagnosed incidentally</li>\n\t<li>Less than 50% patients have symptoms related to <span class=\"customMeta\" data-dictid=\"3e745919391692777200fae21b7251\">thrombosis</span> or hemorrhage</li>\n\t<li>Symptoms include\n\t<ul>\n\t\t<li>Bleeding tendency</li>\n\t\t<li>Microvascular occlusion</li>\n\t\t<li>Thrombosis of major arteries (leading to <span class=\"customMeta\" data-dictid=\"fc7dccf9aa16927771857d884281bd\">CVA</span> and <span class=\"customMeta\" data-dictid=\"a6cf2c3dc51692777200ef7fb22f69\">transient</span> ischemic attacks), and <span class=\"customMeta\" data-dictid=\"bd99ec780c16927772018a45db80c2\">vasomotor</span> symptoms such as headache, visual disturbances, and syncope.</li>\n\t\t<li>Mild <span class=\"customMeta\" data-dictid=\"b3eb52fe3b1692777199de8465eea8\">splenomegaly</span> and rarely <span class=\"customMeta\" data-dictid=\"08b6b28bdd1692777188bad018e4e9\">hepatomegaly</span> and lymphadenopathy</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li>Diagnosis Criteria for Early/Prefibrotic ET\n\t<ul>\n\t\t<li>Sustained <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> count \u2265 450 x 10^9/L</li>\n\t\t<li>Megakaryocyte proliferation</li>\n\t\t<li>Absence of criteria for other <span class=\"customMeta\" data-dictid=\"da88d7f2211692777193037caba514\">myeloid</span> neoplasms</li>\n\t\t<li>Absence of JAK2, CALR, or MPL mutation</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p><br />\n\u00a0</p>\n\n<p>\u00a0</p>\n\n<p><strong>Polycythemia Vera (PV) (Option A): </strong></p>\n\n<ul>\n\t<li>It is characterized by increased <span class=\"customMeta\" data-dictid=\"248111ded81692777197946454db52\">red blood cell</span> mass, leading to erythrocytosis.</li>\n\t<li>Associated with JAK2 mutation</li>\n\t<li>Symptoms : headaches, dizziness, and <span class=\"customMeta\" data-dictid=\"c238cff71916927771965fb88e6cc4\">pruritus</span> due to hyperviscosity.</li>\n\t<li>Laboratory findings typically include elevated <span class=\"customMeta\" data-dictid=\"ad2073fe6716927771885f3c1ec652\">hemoglobin</span> and <span class=\"customMeta\" data-dictid=\"2e114d4cdc169277718882a0a01076\">hematocrit</span> levels, leukocytosis, and thrombocytosis.</li>\n\t<li>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> <span class=\"customMeta\" data-dictid=\"754ab07a2e1692777183ed178c883d\">biopsy</span> shows <span class=\"customMeta\" data-dictid=\"38226ff6e41692777189b7d1c80f9d\">hypercellularity</span> with increased erythropoiesis</li>\n</ul>\n\n<p><strong>Chronic <span class=\"customMeta\" data-dictid=\"da88d7f2211692777193037caba514\">Myeloid</span> <span class=\"customMeta\" data-dictid=\"4521dbf4b91692777191a73002bf98\">Leukemia</span> (Option C):</strong></p>\n\n<ul>\n\t<li>CML is characterized by the Philadelphia <span class=\"customMeta\" data-dictid=\"7157c1f59916927771846116d74646\">chromosome</span> (BCR-ABL <span class=\"customMeta\" data-dictid=\"a7dfeb385e1692777203302bcf142d\">fusion</span> gene).</li>\n\t<li>Patients present with leukocytosis, predominantly neutrophils, and may have splenomegaly.</li>\n\t<li>Laboratory findings- elevated <span class=\"customMeta\" data-dictid=\"57176262ed169277720233ee0ceb2a\">white blood cell</span> count, left-shifted granulocytes, and basophilia.</li>\n\t<li>Treatment often involves tyrosine <span class=\"customMeta\" data-dictid=\"9863da498e1692777190e1c6515b48\">kinase</span> inhibitors <span class=\"customMeta\" data-dictid=\"e4865847fa169277720044d7b530b0\">targeting</span> the BCR-ABL <span class=\"customMeta\" data-dictid=\"a7dfeb385e1692777203302bcf142d\">fusion</span> protein.</li>\n</ul>\n\n<p><strong>Primary <span class=\"customMeta\" data-dictid=\"2cfa710b79169277719350e2606fe5\">Myelofibrosis</span> (PMF) (Option D):</strong></p>\n\n<ul>\n\t<li>It<strong> </strong>is characterized by <span class=\"customMeta\" data-dictid=\"5b9831f3aa169277718395d7361df6\">bone marrow</span> fibrosis, leading to cytopenias and splenomegaly.</li>\n\t<li>Symptoms- fatigue, weight loss, and <span class=\"customMeta\" data-dictid=\"1665a40f1016927771801899eaed5d\">abdominal</span> discomfort due to splenomegaly.</li>\n\t<li>Laboratory findings: anemia, leukoerythroblastosis, and teardrop-shaped red blood cells (dacrocytes) on <span class=\"customMeta\" data-dictid=\"255674f3271692777195c172d86daf\">peripheral</span> smears.</li>\n\t<li>JAK2 <span class=\"customMeta\" data-dictid=\"7a67bdf6f81692777193cfd480f228\">mutation</span> is commonly found in PMF</li>\n\t<li>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> <span class=\"customMeta\" data-dictid=\"754ab07a2e1692777183ed178c883d\">biopsy</span> shows <span class=\"customMeta\" data-dictid=\"21e2d5a70616927772021fcdec0ca9\">fibrosis</span> with increased megakaryocytes.</li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Paulo Henrique Orlandi Mourao \" data-hash=\"\" data-license=\"CC BY SA 3.0\" data-source=\"https://en.wikipedia.org/wiki/Dacrocyte#/media/File:Teardrop_Cells_smear_2009-09-22.JPG\" data-tags=\"\" height=\"378\" src=\"https://image.prepladder.com/content/Ppz6AuJ3ouvB65qFd1Tb1737044185.png\" width=\"500\" /></p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/Ppz6AuJ3ouvB65qFd1Tb1737044185.png"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/cdTFTl8IHDUNqZq2O3cV1754134275.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/QGVOEtYdE4C9WjqDwRKy1754147384.mp3"
  },
  {
    "text": "<p>A 50-year-old male presents with complaints of headaches, dizziness, and pruritus. Physical examination reveals a plethora and splenomegaly. Laboratory tests show elevated hemoglobin and hematocrit levels. Which of the following criteria are consistent with the Polycythemia Vera (PV) diagnosis?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Sustained platelet count \u2265 450 x 10^9/L"
      },
      {
        "id": 2,
        "text": "Increased red blood cell mass"
      },
      {
        "id": 3,
        "text": "Presence of JAK2 mutation"
      },
      {
        "id": 4,
        "text": "Presence of CALR or MPL mutation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct answer: B) Increased <span class=\"customMeta\" data-dictid=\"248111ded81692777197946454db52\">red blood cell</span> mass</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p><strong>Diagnostic Criteria of <span class=\"customMeta\" data-dictid=\"7fd466a9c016927771962d5b061b0f\">Polycythemia</span> Vera: </strong></p>\n\n<ul>\n\t<li><strong>Major criteria: </strong>\n\n\t<ul>\n\t\t<li>Hb: > 16.5 g/dL in <span class=\"customMeta\" data-dictid=\"e48bb8abfa1692777192e3fa06774f\">men</span> and 16 g/dL in women.</li>\n\t\t<li>Hct: > 49% in <span class=\"customMeta\" data-dictid=\"e48bb8abfa1692777192e3fa06774f\">men</span> and > 48% in women.</li>\n\t\t<li>BM Trilineage <span class=\"customMeta\" data-dictid=\"8dd789d7d1169277719303d4744837\">myeloproliferative</span> with <span class=\"customMeta\" data-dictid=\"d391ed597c1692777195574de6cc11\">pleomorphic</span> megakaryocytes.</li>\n\t\t<li>Presence of JAK2 mutation.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li><strong>Minor Criteria: </strong>\n\n\t<ul>\n\t\t<li>Subnormal <span class=\"customMeta\" data-dictid=\"1ffaec13de169277719828374cfda0\">serum</span> <span class=\"customMeta\" data-dictid=\"ec50ec51401692777187009530441d\">erythropoietin</span> level.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Clinical features: </strong></p>\n\n<ul>\n\t<li>Increased Hb causes <span class=\"customMeta\" data-dictid=\"ea73ce564216927771989ea1aa2c3d\">stasis</span> and neurological abnormalities.</li>\n\t<li>Increased <span class=\"customMeta\" data-dictid=\"15d4ce5bf21692777200543fdf4d2f\">TLC</span> causes <span class=\"customMeta\" data-dictid=\"8f179d376f16927771905338bc9387\">itching</span> after a hot <span class=\"customMeta\" data-dictid=\"12e7ea03211692777202cea53e3a8e\">water bath</span> and flushing.</li>\n\t<li>A high <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> count causes <span class=\"customMeta\" data-dictid=\"41e858bf2816927771836d46c619b9\">bleeding</span> tendencies.</li>\n\t<li>Hepatosplenomegaly.</li>\n</ul>\n\n<p><br />\n\u00a0</p>\n\n<p>\u00a0</p>\n\n<p><strong>Sustained <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> count \u2265 450 x 10^9/L (Option A):</strong></p>\n\n<ul>\n\t<li>This <span class=\"customMeta\" data-dictid=\"9167b944ea169277718582367e0915\">criterion</span> is not indicative of <span class=\"customMeta\" data-dictid=\"7fd466a9c016927771962d5b061b0f\">polycythemia</span> vera (PV). Instead, it is a characteristic of Essential <span class=\"customMeta\" data-dictid=\"2a6fe222d7169277720012fabb1227\">Thrombocytosis</span> (ET), which is characterized by isolated <span class=\"customMeta\" data-dictid=\"2a6fe222d7169277720012fabb1227\">thrombocytosis</span> without significant <span class=\"customMeta\" data-dictid=\"558553268016927771875ed1ba9b1c\">erythrocytosis</span> or leukocytosis.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Presence of JAK2 <span class=\"customMeta\" data-dictid=\"7a67bdf6f81692777193cfd480f228\">mutation</span> (Option C):</strong></p>\n\n<ul>\n\t<li>While the presence of JAK2 <span class=\"customMeta\" data-dictid=\"7a67bdf6f81692777193cfd480f228\">mutation</span> is a major <span class=\"customMeta\" data-dictid=\"552e9ef8811692777186997018b858\">diagnostic</span> <span class=\"customMeta\" data-dictid=\"9167b944ea169277718582367e0915\">criterion</span> for PV, it is not the only criterion.</li>\n\t<li>The presence of JAK2 mutations may also be observed in other <span class=\"customMeta\" data-dictid=\"8dd789d7d1169277719303d4744837\">myeloproliferative</span> neoplasms like <span class=\"customMeta\" data-dictid=\"f78a3b2c951692777187744eba1ce5\">Essential Thrombocythemia</span> (ET) or Primary <span class=\"customMeta\" data-dictid=\"2cfa710b79169277719350e2606fe5\">Myelofibrosis</span> (PMF).</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>Presence of CALR or MPL <span class=\"customMeta\" data-dictid=\"7a67bdf6f81692777193cfd480f228\">mutation</span> (Option D):</strong></p>\n\n<ul>\n\t<li>CALR and MPL mutations are typically associated with other <span class=\"customMeta\" data-dictid=\"8dd789d7d1169277719303d4744837\">myeloproliferative</span> neoplasms, such as <span class=\"customMeta\" data-dictid=\"f78a3b2c951692777187744eba1ce5\">Essential Thrombocythemia</span> (ET) or Primary <span class=\"customMeta\" data-dictid=\"2cfa710b79169277719350e2606fe5\">Myelofibrosis</span> (PMF), and are not specific to <span class=\"customMeta\" data-dictid=\"7fd466a9c016927771962d5b061b0f\">Polycythemia</span> Vera (PV).</li>\n</ul>\n\n<p>\u00a0</p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": null,
    "explanation_audio_hin": null
  },
  {
    "text": "<p>A 55-year-old female presents to the clinic with complaints of frequent headaches, dizziness, and occasional burning pain in her hands and feet. Examination reveals splenomegaly. Her complete blood count shows a platelet count of 12,00,000/\u00b5L. The peripheral blood smear shows marked thrombocytosis with giant platelets. Which of the following is not true regarding this condition?</p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Ed Uthman \" data-hash=\"\" data-license=\"CC BY 2.0\" data-source=\"https://commons.wikimedia.org/wiki/File:Essential_Thrombocythemia,_Peripheral_Blood_(10189570483).jpg\" data-tags=\"\" height=\"337\" src=\"https://image.prepladder.com/content/iWa5TcTiHgYFv97FiPOS1737044548.png\" width=\"500\" /></p>",
    "choices": [
      {
        "id": 1,
        "text": "Characterized by the presence of megakaryocytic hyperplasia."
      },
      {
        "id": 2,
        "text": "Associated with JAK2, CALR, or MPL mutations."
      },
      {
        "id": 3,
        "text": "Bone marrow biopsy typically shows increased reticulin fibrosis."
      },
      {
        "id": 4,
        "text": "Increased risk of thrombotic and hemorrhagic events."
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Correct answer: C) <span class=\"customMeta\" data-dictid=\"5b9831f3aa169277718395d7361df6\">Bone marrow</span> <span class=\"customMeta\" data-dictid=\"754ab07a2e1692777183ed178c883d\">biopsy</span> typically shows increased <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> fibrosis.</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li>The clinical presentation is consistent with Essential Thrombocytosis, which typically does not show a significant increase in <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> fibers in the <span class=\"customMeta\" data-dictid=\"5b9831f3aa169277718395d7361df6\">bone marrow</span> at diagnosis.</li>\n\t<li>Increased <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> <span class=\"customMeta\" data-dictid=\"21e2d5a70616927772021fcdec0ca9\">fibrosis</span> is more characteristic of primary myelofibrosis.</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p><strong>WHO <span class=\"customMeta\" data-dictid=\"552e9ef8811692777186997018b858\">diagnostic</span> criteria of Essential thrombocytosis</strong></p>\n\n<ul>\n\t<li><strong>Major criteria</strong>\n\n\t<ul>\n\t\t<li>Platelet count greater than or equal to 450,000/microliter.</li>\n\t\t<li>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> biopsy\n\t\t<ul>\n\t\t\t<li>Shows proliferation, mainly of the megakaryocytic lineage, with an increase in enlarged <span class=\"customMeta\" data-dictid=\"0472620c171692777192c655af9c57\">mature</span> megakaryocytes. (Option A)</li>\n\t\t\t<li>No significant increase or left shift in <span class=\"customMeta\" data-dictid=\"000d23188716927771936c5f2fe74e\">neutrophil</span> <span class=\"customMeta\" data-dictid=\"73147b8daf169277718845a00b556e\">granulopoiesis</span> or <span class=\"customMeta\" data-dictid=\"317dbdacdb16927771878c7860f69b\">erythropoiesis</span> is present,</li>\n\t\t\t<li>Very rarely a minor increase in <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> fibers. (Option C)</li>\n\t\t</ul>\n\t\t</li>\n\t\t<li>The presentation does not meet WHO criteria for BCR-ABL1 +ve CML, PCV, myelofibrosis, MDS, or other <span class=\"customMeta\" data-dictid=\"da88d7f2211692777193037caba514\">myeloid</span> neoplasms.</li>\n\t\t<li>Presence of JAK2, CALR, or MPL mutation. (Option B)</li>\n\t</ul>\n\t</li>\n</ul>\n\n<ul>\n\t<li><strong>Minor criteria: </strong>Presence of a clonal marker or absence of evidence of <span class=\"customMeta\" data-dictid=\"092583d1b41692777197a506409267\">reactive</span> thrombocytosis.</li>\n</ul>\n\n<p><strong>Clinical features </strong></p>\n\n<ul>\n\t<li>Thrombotic or hemorrhagic symptoms such as\n\t<ul>\n\t\t<li>Bleeding tendency</li>\n\t\t<li>Microvascular occlusion</li>\n\t\t<li>Thrombosis of major arteries (leading to <span class=\"customMeta\" data-dictid=\"fc7dccf9aa16927771857d884281bd\">CVA</span> and <span class=\"customMeta\" data-dictid=\"a6cf2c3dc51692777200ef7fb22f69\">transient</span> ischemic attacks), and <span class=\"customMeta\" data-dictid=\"bd99ec780c16927772018a45db80c2\">vasomotor</span> symptoms such as headache, visual disturbances, and syncope.</li>\n\t\t<li>Mild <span class=\"customMeta\" data-dictid=\"b3eb52fe3b1692777199de8465eea8\">splenomegaly</span> and rarely <span class=\"customMeta\" data-dictid=\"08b6b28bdd1692777188bad018e4e9\">hepatomegaly</span> and lymphadenopathy</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>",
    "question_images": [
      "https://image.prepladder.com/content/iWa5TcTiHgYFv97FiPOS1737044548.png"
    ],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/qlUxBGoKLgw7MVwhavXK1754134527.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/yVgO4GxMLfgpGcYYV70k1754147512.mp3"
  },
  {
    "text": "<p>A 65-year-old man presents with progressive fatigue and significant weight loss for the past six months. Examination reveals a markedly enlarged spleen. Peripheral blood smear shows teardrop-shaped red cells. Bone marrow biopsy confirms the diagnosis of primary myelofibrosis. Which of the following statements regarding the diagnosis is true?</p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Paulo Henrique Orlandi Mourao \" data-hash=\"\" data-license=\"CC BY SA 3.0\" data-source=\"https://en.wikipedia.org/wiki/Dacrocyte#/media/File:Teardrop_Cells_smear_2009-09-22.JPG\" data-tags=\"\" height=\"378\" src=\"https://image.prepladder.com/content/SZ1PyeILdjrZuNu8rrzM1737044709.png\" width=\"500\" /></p>\n\n<p>1) It is characterized by extensive marrow fibrosis.</p>\n\n<p>2) Diagnostic criteria include the presence of JAK2, CALR, or MPL mutations.</p>\n\n<p>3) Pathogenesis involves the inappropriate release of fibrogenic factors like PDGF and TGF-\u03b2.</p>\n\n<p style=\"text-align:center\">\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "All statements are true"
      },
      {
        "id": 2,
        "text": "1,2"
      },
      {
        "id": 3,
        "text": "Only 3"
      },
      {
        "id": 4,
        "text": "2,3"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Correct answer: A) All statements are true</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li>Primary <span class=\"customMeta\" data-dictid=\"2cfa710b79169277719350e2606fe5\">myelofibrosis</span> (PMF) is a chronic <span class=\"customMeta\" data-dictid=\"8dd789d7d1169277719303d4744837\">myeloproliferative</span> <span class=\"customMeta\" data-dictid=\"1622f69a94169277719372b76236ca\">neoplasm</span> characterized by the development of extensive <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> fibrosis, which impairs normal hematopoiesis. (Statement 1)</li>\n\t<li>This <span class=\"customMeta\" data-dictid=\"21e2d5a70616927772021fcdec0ca9\">fibrosis</span> is driven by the inappropriate release of <span class=\"customMeta\" data-dictid=\"c9378b6b71169277720290f943a32e\">fibrogenic</span> factors, such as platelet-derived growth factor and TGF-\u03b2, from <span class=\"customMeta\" data-dictid=\"c82360aadd16927771936d67fa30a4\">neoplastic</span> megakaryocytes. (Statement 3)</li>\n\t<li>Clinically, PMF presents with progressive anemia, splenomegaly, and symptoms like fatigue and weight loss.</li>\n</ul>\n\n<p><br />\n\u00a0</p>\n\n<p><strong>WHO <span class=\"customMeta\" data-dictid=\"552e9ef8811692777186997018b858\">diagnostic</span> criteria:</strong></p>\n\n<p><strong>Major criteria</strong></p>\n\n<ul>\n\t<li>Megakaryocyte <span class=\"customMeta\" data-dictid=\"8eedb6cec61692777196a6a3b93d3f\">proliferation</span> and atypia, usually with <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> or <span class=\"customMeta\" data-dictid=\"d215f4a56c16927771842f34a24156\">collagen</span> fibrosis.</li>\n\t<li>Not meeting WHO criteria for BCR-ABL1\u2009+\u2009CML, PV, ET, MDS, or other <span class=\"customMeta\" data-dictid=\"da88d7f2211692777193037caba514\">myeloid</span> neoplasm</li>\n\t<li>Presence of JAK2, CALR, or MPL <span class=\"customMeta\" data-dictid=\"7a67bdf6f81692777193cfd480f228\">mutation</span> or in the absence of these mutations, presence of other clonal markers or absence of minor <span class=\"customMeta\" data-dictid=\"092583d1b41692777197a506409267\">reactive</span> BM <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> fibrosis. (Statement 2)</li>\n</ul>\n\n<p><strong>Minor criteria:</strong></p>\n\n<ul>\n\t<li>Leukocytosis\u2009\u2265\u200911\u2009\u00d7\u200910<sup>9</sup>/L.</li>\n\t<li>Increased <span class=\"customMeta\" data-dictid=\"1ffaec13de169277719828374cfda0\">Serum</span> <span class=\"customMeta\" data-dictid=\"5a751dc161169277719123aae1b764\">Lactate</span> <span class=\"customMeta\" data-dictid=\"0d1ed86c771692777185d6b762efd5\">Dehydrogenase</span> (LDH).</li>\n\t<li>Anemia not attributed to another condition.</li>\n\t<li>Palpable Splenomegaly.</li>\n</ul>",
    "question_images": [
      "https://image.prepladder.com/content/SZ1PyeILdjrZuNu8rrzM1737044709.png"
    ],
    "explanation_video": null,
    "explanation_images": [],
    "explanation_audio_eng": "https://image.prepladder.com/content/a6NcQOm1e6Y8ZvgZ9FJt1754134589.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/X5NqzwETLnvidABta2I71754147567.mp3"
  },
  {
    "text": "<p>A 60-year-old man presents with complaints of increasing fatigue, early satiety, and unintentional weight loss over the past few months. On examination, there is palpable splenomegaly. Laboratory reports reveal pancytopenia with dacrocytes on the peripheral smear. Which of the following is not associated with Myelofibrosis?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Dry tap"
      },
      {
        "id": 2,
        "text": "Leukoerythroblastic blood picture"
      },
      {
        "id": 3,
        "text": "Dacrocytes"
      },
      {
        "id": 4,
        "text": "Myeloblasts"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Correct answer: D) Myeloblasts</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Myeloblasts are seen in <span class=\"customMeta\" data-dictid=\"9ab5f0308116927771814e1fcc72d6\">AML</span> and are not associated with myelofibrosis.</p>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li>Myelofibrosis is the development of obliterative <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> fibrosis.</li>\n\t<li>Replacement of the <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> by <span class=\"customMeta\" data-dictid=\"5d6dfa73b316927772028f3cd60f7f\">fibrous</span> tissue reduces <span class=\"customMeta\" data-dictid=\"5b9831f3aa169277718395d7361df6\">bone marrow</span> hematopoiesis, leading to cytopenias and extensive <span class=\"customMeta\" data-dictid=\"0ba1f7edfa1692777187ae6f51e603\">extramedullary</span> hematopoiesis.</li>\n</ul>\n\n<ul>\n\t<li>Investigations include\n\t<ul>\n\t\t<li>CBC- <span class=\"customMeta\" data-dictid=\"7644c201051692777194859abcd534\">pancytopenia</span> due to obliterative <span class=\"customMeta\" data-dictid=\"5b9831f3aa169277718395d7361df6\">bone marrow</span> fibrosis</li>\n\t\t<li>Peripheral <span class=\"customMeta\" data-dictid=\"6777533153169277719804fcbbf2d1\">smear</span> reveals\n\t\t<ul>\n\t\t\t<li>a <span class=\"customMeta\" data-dictid=\"021f168f061692777191adee3319b4\">leukoerythroblastic</span> blood picture where the <span class=\"customMeta\" data-dictid=\"eaec97de1d1692777186b2ce902b4d\">distortion</span> of the <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> leads to the <span class=\"customMeta\" data-dictid=\"84f13673191692777196762b18e036\">premature</span> release of <span class=\"customMeta\" data-dictid=\"c219021c491692777189d289f1fc03\">immature</span> <span class=\"customMeta\" data-dictid=\"892718f3e916927771871389d2e1a3\">erythroid</span> and granulocyte\u00a0<strong>(Option B)</strong></li>\n\t\t\t<li>Teardrop-shaped red cells (dacrocytes) that are damaged during the birthing process in the fibrotic <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> <strong>(Option C)</strong></li>\n\t\t</ul>\n\t\t</li>\n\t\t<li>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> aspirate\n\t\t<ul>\n\t\t\t<li>may reveal\u00a0a dry tap. <strong>(Option A)</strong></li>\n\t\t\t<li>May reveal\u00a0thickening and <span class=\"customMeta\" data-dictid=\"eaec97de1d1692777186b2ce902b4d\">distortion</span> of bony <span class=\"customMeta\" data-dictid=\"ecfec60ca61692777200dd3d86cd90\">trabeculae</span> and deposition of <span class=\"customMeta\" data-dictid=\"059559ce5d16927771975852f6a8ed\">reticulin</span> and <span class=\"customMeta\" data-dictid=\"d215f4a56c16927771842f34a24156\">collagen</span> fibers.</li>\n\t\t</ul>\n\t\t</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Zineb Alfath,Asmaa Ferdjallah,Emily Greengard,Sabeen K. Askari,Karim T. Sadak,Colleen K. Correll\" data-hash=\"\" data-license=\"CC BY\" data-source=\"https://www.researchgate.net/figure/Mild-leukoerythroblastic-reaction-seen-on-peripheral-blood-smear-with-slightly_fig1_339576584\" data-tags=\"\" height=\"195\" src=\"https://image.prepladder.com/content/xBvluRZLhewtffrJFdom1737044986.png\" width=\"500\" /></p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/xBvluRZLhewtffrJFdom1737044986.png"
    ],
    "explanation_audio_eng": "https://image.prepladder.com/content/z2hAWoeMprJd9Uryvj3n1754134667.mp3",
    "explanation_audio_hin": "https://image.prepladder.com/content/7xaJ3iYHIoRasbq9U6yh1754147231.mp3"
  },
  {
    "text": "<p>A 75-year-old man presents with increasing fatigue, weakness, and easy bruising over the past few months. Labs show pancytopenia. Peripheral blood smear reveals dysplastic differentiation in the erythroid, granulocytic, monocytic, and megakaryocytic lineages. Which condition does this suggest?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Hyperlobated megakaryocyte"
      },
      {
        "id": 2,
        "text": "Leukoerythroblastic picture"
      },
      {
        "id": 3,
        "text": "Increased proliferation of RBCs"
      },
      {
        "id": 4,
        "text": "Pawn ball megakaryocyte"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Correct answer: D) Pawn ball megakaryocyte</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Pawn ball megakaryocytes is associated with <strong>Myelodysplastic syndrome.</strong></p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Baitule Amey Madhav\" data-hash=\"\" data-license=\"NA\" data-source=\"https://www.semanticscholar.org/paper/A-Morphological-Study-of-Acute-Myeloid-Leukemia-and-Madhav/b03c6fbf45e61721148c97f920a4d681e960a0e5/figure/33\" data-tags=\"\" height=\"448\" src=\"https://image.prepladder.com/content/yloymRtdzQrf5YtpMjFP1737045793.png\" width=\"500\" /></p>\n\n<p>Myelodysplastic Syndrome (MDS) is a group of clonal stem cell disorders characterized by <span class=\"customMeta\" data-dictid=\"76948f718016927771924774ade7e9\">maturation</span> defects and ineffective <span class=\"customMeta\" data-dictid=\"bb774c3cec1692777188327b4bc737\">hematopoiesis</span> with a risk transformation to AML</p>\n\n<ul>\n\t<li>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> replaced by clonal <span class=\"customMeta\" data-dictid=\"18c5edd5f51692777196d8c4761d07\">progeny</span> of a <span class=\"customMeta\" data-dictid=\"c82360aadd16927771936d67fa30a4\">neoplastic</span> multipotent stem cell\n\t<ul>\n\t\t<li>Leading to ineffective and disordered differentiation</li>\n\t\t<li>Can cause cytopenias and potential malignancy</li>\n\t</ul>\n\t</li>\n\t<li>Genetic Causes\n\t<ul>\n\t\t<li>Adults: <span class=\"customMeta\" data-dictid=\"cf1e8ec6121692777185eba2630061\">Deletion</span> of 5q chromosome</li>\n\t\t<li>Children: <span class=\"customMeta\" data-dictid=\"93e077ee021692777192666a61cfbc\">Monosomy</span> 7</li>\n\t</ul>\n\t</li>\n\t<li>Types\n\t<ul>\n\t\t<li>Primary (idiopathic)</li>\n\t\t<li>Secondary (due to <span class=\"customMeta\" data-dictid=\"f8226a100216927771886576afdb6a\">genotoxic</span> drugs or radiation therapy)</li>\n\t</ul>\n\t</li>\n\t<li>Peripheral <span class=\"customMeta\" data-dictid=\"6777533153169277719804fcbbf2d1\">Smear</span> Findings:\n\t<ul>\n\t\t<li>Dysplastic <span class=\"customMeta\" data-dictid=\"55a682d72e16927771865bb4855ba3\">differentiation</span> of erythroid, granulocytic, monocytic, and megakaryocytic lineages</li>\n\t\t<li>Ring sideroblasts</li>\n\t\t<li>Erythroblasts with iron-laden <span class=\"customMeta\" data-dictid=\"18c9e7b9721692777192bd042528cc\">mitochondria</span> (visible as <span class=\"customMeta\" data-dictid=\"2da8fc47cf169277719576cea1851f\">perinuclear</span> granules in <span class=\"customMeta\" data-dictid=\"6ee66a5d5d16927771966f1ea457eb\">Prussian blue</span> stain)</li>\n\t\t<li>Neutrophils with\n\t\t<ul>\n\t\t\t<li>decreased secondary granules</li>\n\t\t\t<li>D\u00f6hle bodies</li>\n\t\t\t<li>PseudoPelger\u2013H\u00fcet cells (neutrophils with two nuclear lobes)</li>\n\t\t</ul>\n\t\t</li>\n\t\t<li>Megakaryocytes with\n\t\t<ul>\n\t\t\t<li>Single nuclear lobes</li>\n\t\t\t<li>Multiple separate <span class=\"customMeta\" data-dictid=\"e6b47028191692777193eb698e43b6\">nuclei</span> (Pawnball megakaryocytes)</li>\n\t\t</ul>\n\t\t</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p style=\"text-align: center;\"><strong>Ringed sideroblasts:</strong></p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"S Bhimji MD\" data-hash=\"\" data-license=\"CC BY NC ND 4.0\" data-source=\"https://www.ncbi.nlm.nih.gov/books/NBK537073/figure/article-17540.image.f2/\" data-tags=\"\" height=\"412\" src=\"https://image.prepladder.com/content/x4ZnpX8GOjx8VqBcOJvr1737045173.png\" width=\"500\" /></p>\n\n<p style=\"text-align: center;\"><strong>D\u00f6hle bodies:</strong></p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Ibrahim Abukhiran,Judy Jasser,Sergei I Syrbu\" data-hash=\"\" data-license=\"CC BY NC 4.0\" data-source=\"https://www.researchgate.net/figure/Neutrophils-showing-toxic-granulation-Doehle-bodies-and-cytoplasmic-vacuolations_fig2_338618310\" data-tags=\"\" height=\"378\" src=\"https://image.prepladder.com/content/PH4FQgLbTUFNUu5HSS301737045324.png\" width=\"500\" /></p>\n\n<p style=\"text-align: center;\"><strong>PseudoPelger\u2013H\u00fcet cells:</strong></p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"The Armed Forces Institute of Pathology (AFIP) \" data-hash=\"\" data-license=\"Public domain\" data-source=\"https://en.wikipedia.org/wiki/Pelger%E2%80%93Hu%C3%ABt_anomaly\" data-tags=\"\" height=\"705\" src=\"https://image.prepladder.com/content/W7xY41ydtAarR4Zv5xq01737045423.png\" width=\"500\" /></p>\n\n<p>\u00a0</p>\n\n<p>\u00a0</p>\n\n<p><strong>\u00a0Hyperlobated megakaryocytes (Option A):</strong></p>\n\n<ul>\n\t<li>These are seen in Essential thrombocytosis, where <span class=\"customMeta\" data-dictid=\"255674f3271692777195c172d86daf\">peripheral</span> smears reveal abnormally large platelets and marked thrombocytosis.</li>\n\t<li>It is characterized by erythromelalgia, a <span class=\"customMeta\" data-dictid=\"c85d87e6db16927772007aa05fe028\">throbbing</span> and burning of hands and <span class=\"customMeta\" data-dictid=\"32656dc8ba1692777202fc49f9ed13\">feet</span> caused by the <span class=\"customMeta\" data-dictid=\"896c5469811692777194e64e7ccef7\">occlusion</span> of small arterioles by <span class=\"customMeta\" data-dictid=\"e7032bae7f1692777195d693722e54\">platelet</span> aggregates.</li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Ada Maria Florena,Claudio Tripodo,Emilio Iannitto,Rossana Porcasi,Sabrina Ingrao,Viviana Marcela Franco\" data-hash=\"\" data-license=\"@2004, Ferrata Storti Foundation\" data-source=\"https://www.researchgate.net/figure/A-Loose-cluster-of-hyperlobulated-over-aged-megakaryocytes-with-staghorn-nuclei-typical_fig3_8372263\" data-tags=\"\" height=\"485\" src=\"https://image.prepladder.com/content/NwGX8AxC7DdphEchTbMw1737045524.png\" width=\"500\" /></p>\n\n<p><strong>Leukoerythroblastic picture (Option B):</strong></p>\n\n<p>This is seen in Myelofibrosis, which causes obliterative <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> fibrosis, decreasing <span class=\"customMeta\" data-dictid=\"bb774c3cec1692777188327b4bc737\">hematopoiesis</span> and causing cytopenias, with extensive <span class=\"customMeta\" data-dictid=\"0ba1f7edfa1692777187ae6f51e603\">extramedullary</span> hematopoiesis.</p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Zineb Alfath,Asmaa Ferdjallah,Emily Greengard,Sabeen K. Askari,Karim T. Sadak,Colleen K. Correll\" data-hash=\"\" data-license=\"CC BY\" data-source=\"https://www.researchgate.net/figure/Mild-leukoerythroblastic-reaction-seen-on-peripheral-blood-smear-with-slightly_fig1_339576584\" data-tags=\"\" height=\"195\" src=\"https://image.prepladder.com/content/w4Rx4rglzlOCurMe2nvE1737045608.png\" width=\"500\" /></p>\n\n<p><strong>Increased <span class=\"customMeta\" data-dictid=\"8eedb6cec61692777196a6a3b93d3f\">proliferation</span> of RBCs (Option C):</strong></p>\n\n<ul>\n\t<li>It is seen in <span class=\"customMeta\" data-dictid=\"7fd466a9c016927771962d5b061b0f\">Polycythemia</span> Vera due to JAK2 mutation.</li>\n\t<li>Patients present with symptoms such as headaches, dizziness, and <span class=\"customMeta\" data-dictid=\"c238cff71916927771965fb88e6cc4\">pruritus</span> due to hyperviscosity.</li>\n\t<li>Bone <span class=\"customMeta\" data-dictid=\"c8a8c935a41692777191610f6aacb4\">marrow</span> <span class=\"customMeta\" data-dictid=\"754ab07a2e1692777183ed178c883d\">biopsy</span> shows <span class=\"customMeta\" data-dictid=\"38226ff6e41692777189b7d1c80f9d\">hypercellularity</span> with increased erythropoiesis.</li>\n</ul>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/yloymRtdzQrf5YtpMjFP1737045793.png"
    ],
    "explanation_audio_eng": null,
    "explanation_audio_hin": null
  },
  {
    "text": "<p>A 5-year-old child presents with a skin rash, recurrent ear infections, bone pain, and polyuria. Imaging revealed lytic bone lesions and a biopsy of one of the lesions showed CD1a and S-100 positive Langerhans cells. Which of the following types of Langerhans cell histiocytosis (LCH) is characterized by multifocal uni system involvement?</p>\n\n<p>\u00a0</p>",
    "choices": [
      {
        "id": 1,
        "text": "Eosinophilic granuloma"
      },
      {
        "id": 2,
        "text": "Hand-Sch\u00fcller-Christian disease"
      },
      {
        "id": 3,
        "text": "Letterer-Siwe disease"
      },
      {
        "id": 4,
        "text": "Both A and C"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Correct answer: B) Hand-Sch\u00fcller-Christian disease</strong></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Langerhans Cell <span class=\"customMeta\" data-dictid=\"3524f152fe1692777189ae6f82c4d0\">Histiocytosis</span> (LCH) is a rare <span class=\"customMeta\" data-dictid=\"9d21dd5d3116927771907405b181bc\">inflammatory</span> and <span class=\"customMeta\" data-dictid=\"c82360aadd16927771936d67fa30a4\">neoplastic</span> condition that involves <span class=\"customMeta\" data-dictid=\"da88d7f2211692777193037caba514\">myeloid</span> <span class=\"customMeta\" data-dictid=\"77f797c5e8169277718535480fa7fd\">dendritic</span> cells</p>\n\n<ul>\n\t<li>Genetic Mutation: BRAF V600E <span class=\"customMeta\" data-dictid=\"7a67bdf6f81692777193cfd480f228\">mutation</span> found in the majority of cases\n\t<ul>\n\t\t<li>BRAF gene encodes B-Raf, part of the <span class=\"customMeta\" data-dictid=\"b47bc310681692777191d57afcc413\">MAPK</span> pathway</li>\n\t\t<li>Mutation establishes the <span class=\"customMeta\" data-dictid=\"c82360aadd16927771936d67fa30a4\">neoplastic</span> nature of LCH</li>\n\t</ul>\n\t</li>\n\t<li>Categories:\n\t<ul>\n\t\t<li>Unisystem:\n\t\t<ul>\n\t\t\t<li>Unifocal</li>\n\t\t\t<li>Multifocal</li>\n\t\t</ul>\n\t\t</li>\n\t\t<li>Multisystem</li>\n\t</ul>\n\t</li>\n\t<li>Types of langerhan histiocytosis:</li>\n</ul>\n\n<table cellspacing=\"0\" style=\"border-collapse:collapse; width:643px\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align: center;\"><strong>Eosinophilic granuloma</strong></p>\n\n\t\t\t<p style=\"text-align: center;\"><strong>(Option A)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align: center;\"><strong>Hand-Schuller-Christian disease</strong><strong> (Option B)</strong></p>\n\t\t\t</td>\n\t\t\t<td style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<p style=\"text-align: center;\"><strong>Letterer-Siwe disease</strong></p>\n\n\t\t\t<p style=\"text-align: center;\"><strong>(Option C)</strong></p>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td rowspan=\"3\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Unifocal involvement.</li>\n\t\t\t\t<li>Primarily involves <span class=\"customMeta\" data-dictid=\"d54da38aaa1692777191560f60c0f9\">lytic</span> bone lesions.</li>\n\t\t\t\t<li>Seen in young children.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t\t<td rowspan=\"3\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>Multifocal involvement.</li>\n\t\t\t\t<li>It is characterized by a <span class=\"customMeta\" data-dictid=\"1a0a43d74e16927772004473a05ae3\">triad</span> of symptoms such as:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Bony lesions in a calvarial defect.</li>\n\t\t\t\t\t<li>Diabetes insipidus and</li>\n\t\t\t\t\t<li>Exophthalmos.</li>\n\t\t\t\t</ul>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t\t<td rowspan=\"3\" style=\"border-bottom:1px solid #000000; border-left:1px solid #000000; border-right:1px solid #000000; border-top:1px solid #000000; vertical-align:top\">\n\t\t\t<ul>\n\t\t\t\t<li>It is a more severe, <span class=\"customMeta\" data-dictid=\"f4006059f916927771865569d4da7d\">disseminated</span> <span class=\"customMeta\" data-dictid=\"a1b06f401f1692777203a53393ba98\">form</span> of LCH with multisystem involvement.</li>\n\t\t\t\t<li>It is characterized by <span class=\"customMeta\" data-dictid=\"d54da38aaa1692777191560f60c0f9\">lytic</span> bony lesions and <span class=\"customMeta\" data-dictid=\"5d5241c3cf1692777198a1ba71f8d4\">seborrheic</span> dermatitis.</li>\n\t\t\t</ul>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t\t<tr>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>\u00a0</p>\n\n<ul>\n\t<li>LCH Diagnosis:\n\t<ul>\n\t\t<li>Light Microscopy\n\t\t<ul>\n\t\t\t<li>Eosinophils appear as orange-looking cells</li>\n\t\t\t<li>Nuclei have a coffee bean appearance</li>\n\t\t</ul>\n\t\t</li>\n\t\t<li>Immunohistochemistry (IHC):\n\t\t<ul>\n\t\t\t<li>Positive markers: CD1a, CD207 (langerin), S100, HLA-DR</li>\n\t\t</ul>\n\t\t</li>\n\t\t<li>Electron Microscopy:(Gold standard for diagnosis)\n\t\t<ul>\n\t\t\t<li>Reveals tennis racket appearance of Birbeck granules</li>\n\t\t</ul>\n\t\t</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Nephron \" data-hash=\"\" data-license=\"CC BY SA 3.0\" data-source=\"https://en.wikipedia.org/wiki/Langerhans_cell_histiocytosis#/media/File:Langerhans_cell_histiocytosis_-_very_high_mag.jpg\" data-tags=\"\" height=\"439\" src=\"https://image.prepladder.com/content/lD9E7NUwBIffdONnUEpO1737046235.png\" width=\"500\" /></p>\n\n<p style=\"text-align:center\"><img alt=\"\" data-author=\"Yale Rosen \" data-hash=\"\" data-license=\"CC BY SA 2.0\" data-source=\"https://en.wikipedia.org/wiki/Birbeck_granules#/media/File:Langerhans_cell_histiocytosis_-_Birbeck_granules.jpg\" data-tags=\"\" height=\"447\" src=\"https://image.prepladder.com/content/SFVdA2DcNgOdDUv1JWnZ1737046300.png\" width=\"500\" /></p>",
    "question_images": [],
    "explanation_video": null,
    "explanation_images": [
      "https://image.prepladder.com/content/lD9E7NUwBIffdONnUEpO1737046235.png"
    ],
    "explanation_audio_eng": null,
    "explanation_audio_hin": null
  }
];
        let quizName = '78 Myeloid Disorders';
        const quizFilename = '78-myeloid-disorders-1bc8b636.html';
        let hierarchy = ["PrepLadder", "qBank", "Pathology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>