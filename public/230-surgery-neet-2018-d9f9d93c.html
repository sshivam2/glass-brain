<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>230 Surgery Neet 2018 - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / PYQs / Surgery
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">26</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following are indications for surgical intervention in abdominal aortic aneurysms?",
    "choices": [
      {
        "id": 1,
        "text": "Size more than 5.5 cm in males"
      },
      {
        "id": 2,
        "text": "Size more than 5 cm in females"
      },
      {
        "id": 3,
        "text": "Expansion of  >0.5 cm within 6 months"
      },
      {
        "id": 4,
        "text": "All the above"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>All the given are indications for surgical intervention in abdominal aortic aneurysm (AAA). The indications include:</p>\n<ul>\n<li>Size <strong>&gt;5.5 cm</strong> in males (option A)</li>\n<li>Size <strong>&gt;</strong><strong>4.5-</strong><strong>5 cm</strong> in females (option B)</li>\n<li>Expansion of <strong>&gt;0.5 cm</strong> within <strong>6 months</strong> or <strong>&gt;1</strong> <strong>cm</strong> in <strong>one year&nbsp;</strong>(option C)</li>\n<li>Painful, tender aneurysm&nbsp;</li>\n<li>Thrombosed aneurysm, aneurysm with distal emboli&nbsp;</li>\n</ul>\n<p>The rupture <strong>risk is high</strong> for aneurysms <strong>&gt;5.5 cm</strong> and begins to rise exponentially with an increase in size.&nbsp;<strong>Women </strong>are at <strong>higher risk</strong> for rupture than men, with a <strong>lower threshold </strong>of 4.5 to 5.0 cm (depending on the reference used).</p>\n<p>Screening is done for:</p>\n<ul>\n<li>Cardiovascular patients in men and women (60-85 years)</li>\n<li>Men and women &gt;50 years with positive family history&nbsp;</li>\n<li>Annual screening in asymptomatic patients with 4-4.5 cm size, size &gt;4.5 cm once in every 6 months.</li>\n</ul>\n<p>Management of AAA can be done by open repair or endovascular aneurysm repair (EVAR). About 75% of infrarenal aneurysms are suitable for <strong>endovascular aneurysm repair (EVAR)</strong>, depending on the morphology of the aneurysm assessed by a CT scan.</p>\n<p>Aneurysms that fall below the mentioned indications may safely be followed with CT or ultrasound at 6-month intervals since long-term outcomes to routine follow-up are equivalent to earlier surgical repair of the aneurysm. Smoking cessation is very important and reduces the mortality rate.</p>\n<div class=\"page\" title=\"Page 983\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<div class=\"page\" title=\"Page 984\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>The technique of EVAR:&nbsp;</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f20e39e71fa442a1812e73cf453b43d1x400x401.JPEG"
    ]
  },
  {
    "text": "The following image shows the retrograde ureteropyelogram of a patient with loin pain. What is the most probable clinical diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Hydronephrosis"
      },
      {
        "id": 2,
        "text": "Duplex kidney"
      },
      {
        "id": 3,
        "text": "Renal carcinoma"
      },
      {
        "id": 4,
        "text": "Renal stone"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given image&nbsp;showing&nbsp;<strong>dilated clubbed calyces&nbsp;</strong>with stricture of the left ureteropelvic junction points to a diagnosis of <strong>hydronephrosis</strong>.</p>\n<p>Hydronephrosis refers to the<strong> dilatation</strong> of the pelvicalyceal system caused by a partial or complete blockage of urinary flow.&nbsp;</p>\n<p>Investigations:</p>\n<ul>\n<li><strong>Ultrasound</strong>&nbsp;is the <strong>least invasive</strong> technique for diagnosing hydronephrosis.</li>\n<li><strong>Retrograde pyelography</strong> is rarely indicated but will confirm the<strong> site of obstruction</strong>&nbsp;before corrective surgery.</li>\n<li><strong>Intravenous urogram</strong> (IVU) is helpful only if the obstructed kidney is functional. In IVU, the extrarenal pelvis is dilated and the minor calyces lose their normal cupping. In <strong>early</strong> stages, there is <strong>blunting</strong> of calyces followed by its <strong>clubbing</strong> in the <strong>late</strong> stages.</li>\n<li><strong>A renal isotope scan</strong> (DTPA or MAG-3) is the best modality to confirm the <strong>obstructive dilatation</strong> of the collecting system.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/9c3f3324735a40f0baae242409fe0809.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following types of renal stones are produced by laxative abuse?",
    "choices": [
      {
        "id": 1,
        "text": "Uric acid"
      },
      {
        "id": 2,
        "text": "Ammonium urate"
      },
      {
        "id": 3,
        "text": "Struvite"
      },
      {
        "id": 4,
        "text": "Calcium oxalate"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Ammonium urate stones</strong> are most likely to be seen in patients with <strong>laxative abuse</strong>.</p>\n<p>Loss of potassium and sodium in laxative abuse causes<strong> intracellular acidosis</strong>, which <strong>increases</strong> the production of <strong>ammonia</strong> in urine. <strong>Dehydration</strong> and sodium loss further exacerbate <strong>hypokalemia</strong> and reduces the urinary volume, resulting in <strong>hyperuricemia</strong>. Highly concentrated uric acid and ammonia promote the formation of ammonium urate stones.</p>\n<p>These are also associated with<strong> inflammatory bowel disease, chronic diarrhea, ileostomy, recurrent urinary tract infection </strong>and<strong> recurrent uric acid stone formation.</strong></p>\n<p>The below image shows an ammonium urate stone.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8ed99c92cdd042edb74e38ea268bb782x787x658.JPEG"
    ]
  },
  {
    "text": "A patient is confused, opens his eyes on painful stimuli,  flexes one limb on painful stimuli, and can localize the stimulus with the other limb. His Glasgow Coma Score is ________",
    "choices": [
      {
        "id": 1,
        "text": "8"
      },
      {
        "id": 2,
        "text": "9"
      },
      {
        "id": 3,
        "text": "10"
      },
      {
        "id": 4,
        "text": "11"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The GCS in this patient is <strong>11</strong>.</p>\n<ul>\n<li>The score for verbal response: 4, because he is confused.</li>\n<li>The score for eye-opening: 2, because his eyes are opening to only painful stimuli.</li>\n<li>The score for <strong>best motor response</strong>: 5, because he can localize pain.&nbsp;</li>\n</ul>\n<p>Therefore, the GCS score is (4+2+5) = 11.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A patient presents with a painless swelling of the neck. The histology of the tissue is as given in the image below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Medullary carcinoma"
      },
      {
        "id": 2,
        "text": "Non Hodgkin's lymphoma"
      },
      {
        "id": 3,
        "text": "Grave's disease"
      },
      {
        "id": 4,
        "text": "Hashimoto's thyroiditis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Option C: <strong>Grave's disease</strong> is an autoimmune disorder characterized by hyperthyroidism due to circulating autoantibodies. The thyroid-stimulating immunoglobulins bind to the TSH receptors, causing overgrowth of the thyroid gland and increased thyroid hormone synthesis. Histologically, there is acinar cell hypertrophy and hyperplasia with the absence of normal colloid in the tall columnar epithelium (normally the epithelium is flat with colloid). Lymphoid infiltrates, consisting predominantly of T cells, along with scattered B cells and mature plasma cells, are present throughout the interstitium. Germinal centers are common.</p>\n<p>The given slide below shows Grave's disease:</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/daba3807ac4e4b8cb74ffdb00bd2b6f7.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/845a648c25b3440797f586e684e8981ex1280x1164.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db8cadf2a71a452b83f9cbcbc81c5e55x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b67d3c782b3c442db097a93025af036fx1280x853.JPEG"
    ]
  },
  {
    "text": "A 45-year-old male patient who presented with a scrotal swelling underwent an orchidectomy. The image below shows the histopathology findings. What is your diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Seminoma"
      },
      {
        "id": 2,
        "text": "Yolk-sac tumor"
      },
      {
        "id": 3,
        "text": "Embryonal cell carcinoma"
      },
      {
        "id": 4,
        "text": "Teratoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>Option D: <strong>Teratomas</strong> also have a <strong>variegated</strong> appearance but have <strong>cysts</strong> reflecting the<strong> multiplicity of tissue types</strong>. Histologically, collections of differentiated cells or organoid structures originating in all 3 germ layers can be seen. Elements may be mature (resembling various adult tissues) or immature (sharing histologic features with fetal or embryonic tissue).<strong>&nbsp;</strong></p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/0c2f1481a3ea435f8c6c3c12c15f9140.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bc031255ed9c49f68b4ff4182a27962bx1024x1280.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/873d6e87b0a645639e54144cdfa8f710x1280x852.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/4121c1d5878f4e34bc9aa516386a46e1x1031x1280.JPEG"
    ]
  },
  {
    "text": "A surgeon sees a necrotic bowel when operating on a child for an inguinal hernia. What is true about the resection and anastomosis of the bowel?",
    "choices": [
      {
        "id": 1,
        "text": "The surgeon must use chromic catgut"
      },
      {
        "id": 2,
        "text": "The surgeon must not include the submucosa in the sutures"
      },
      {
        "id": 3,
        "text": "The surgeon must use the single-layer, extramucosal suture technique"
      },
      {
        "id": 4,
        "text": "The surgeon must use the single-layer seromuscular suture technique"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The standard technique used currently for resection anastomosis of the bowel is a <strong>one-layer extra mucosal suture technique</strong>&nbsp;since it causes the <strong>least tissue necrosis and luminal narrowing</strong>. Interrupted and continuous single-layer suture techniques are adequate and safe.</p>\n<p>The extra mucosal suture must also include the<strong> submucosa</strong>&nbsp;because this layer has a high collagen content and it is the <strong>most stable suture layer</strong> in all sections of the gastrointestinal tract.</p>\n<p><strong>Catgut</strong> has now been <strong>replaced </strong>with <strong>absorbable synthetic polymers</strong>. Stapling devices can be used when speed is required.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A lady comes with a reddish firm nodule on her chest which hasn't grown in size. Its histolopathological image is shown below. What is the diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Lipoma"
      },
      {
        "id": 2,
        "text": "Fibroadenoma"
      },
      {
        "id": 3,
        "text": "Nevus"
      },
      {
        "id": 4,
        "text": "Hemangioma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given image shows a capillary hemangioma in a child</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/13ea92687e644129a4ec64ac98485196.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/d3aab88831524cd38561bbba28fc2c25x720x516.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9766fd393eb94dcf917c1158352ba439x720x313.JPEG"
    ]
  },
  {
    "text": "Which is the most common organism causing acute bacterial prostatitis?",
    "choices": [
      {
        "id": 1,
        "text": "Enterococcus"
      },
      {
        "id": 2,
        "text": "Proteus"
      },
      {
        "id": 3,
        "text": "Streptococcus Agalacticia"
      },
      {
        "id": 4,
        "text": "E.coli"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The most common organism causing acute bacterial prostatitis (ABP) is <strong><em>Escherichia coli</em>.</strong></p>\n<p>It is commonly caused by an ascending urethral infection or reflux of infected urine into prostatic ducts. <strong>Sexually transmissible infections</strong> and other&nbsp;urinary pathogens,&nbsp;such as <span style=\"color: #000000;\"><em><strong>Staphylococcus aureus </strong>and<strong> Streptococcus faecalis</strong></em>&nbsp;</span>may also be responsible.</p>\n<p>The patient presents with fever, perineal pain, chills and rigor, and dysuria. Per rectal examination will reveal a <strong>tender, boggy prostate</strong>. Care should be taken to avoid aggressive palpation or prostatic massage as it can lead to <strong>bacterial dissemination</strong> and <strong>sepsis</strong>.</p>\n<p>Urine examination and culture should be done. Urine examination reveals <strong>threads</strong> in urine.</p>\n<p>Management:&nbsp;&nbsp;</p>\n<p>Patients with systemic signs of infection should be admitted for IV antibiotics, hydration, and monitoring of laboratory parameters.</p>\n<p>Patients who have no signs of systemic infection, who can tolerate oral intake, and who have no urinary retention can be treated with oral antibiotics. Antibiotics are given for <strong>2-6 weeks</strong> to ensure the eradication of the infection as antibiotics don't penetrate the prostate capsule easily.&nbsp;</p>\n<p>For outpatient therapy: <strong>Ciprofloxacin</strong> 500 mg oral every 12 hours or <strong>levofloxacin</strong> 500 mg OD or <strong>trimethoprim</strong>-<strong>sulfamethoxazole</strong> double-strength tablet oral every 12 hours can be used.</p>\n<p>For hospitalized patients: Intravenous <strong>ciprofloxacin</strong> or <strong>levofloxacin</strong> with or without an <strong>aminoglycoside</strong> (gentamicin or tobramycin) or intravenous <strong>beta-lactam</strong> with or without an aminoglycoside. Gram-positive infections are treated with cephalosporins (<strong>cephalexin</strong>, <strong>cefazolin</strong>) or <strong>dicloxacillin</strong> and <strong>vancomycin</strong>.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old man came with complaints of dark-colored stools to the OPD. After undergoing endoscopy, the patient was diagnosed with an upper GI bleed. Which of the following structures is used as a demarcation point to differentiate it from a lower GI bleed?",
    "choices": [
      {
        "id": 1,
        "text": "Ampulla of Vater"
      },
      {
        "id": 2,
        "text": "Ligament of Treitz"
      },
      {
        "id": 3,
        "text": "Superior duodenal flexure"
      },
      {
        "id": 4,
        "text": "Ileocaecal junction"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>ligament of Treitz</strong> is used as the demarcation point to differentiate between upper gastrointestinal bleeding and lower gastrointestinal bleeding. It is a part of the duodenojejunal junction.&nbsp;</p>\n<p>Upper GI bleeding refers to bleeding proximal to the ligament of Treitz, and lower GI bleeding refers to bleeding distal to the ligament of Treitz.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6df2624f514343f7b0598cef54335689x1280x1267.JPEG"
    ]
  },
  {
    "text": "Which is the best graft for a femoropopliteal bypass?",
    "choices": [
      {
        "id": 1,
        "text": "Dacron"
      },
      {
        "id": 2,
        "text": "Great saphenous vein"
      },
      {
        "id": 3,
        "text": "Polytetrafluoroethylene"
      },
      {
        "id": 4,
        "text": "Short saphenous vein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The <strong>great saphenous vein&nbsp;</strong>(GSV) is <strong>the best</strong> as it <strong>lasts longer</strong> than polytetrafluoroethylene (PTFE), dacron, and human umbilical vein as a graft in a femoropopliteal bypass.</p>\n<p>The GSV is the conduit of choice for arterial bypass grafts<strong> below the inguinal ligament</strong>.</p>\n<p>For bypass<strong> above the inguinal ligament,</strong>&nbsp;while both GSV and PTFE grafts have <strong>similar patency</strong> rates in the<strong> first 2 years</strong>, the <strong>GSV is superior</strong> thereafter and hence preferred over PTFE or any other grafts.</p>\n<p>The ipsilateral GSV is the <strong>conduit of choice</strong> for<strong> femoropopliteal bypass.</strong> When it is not available, contralateral GSV should be used. Other veins are preferred when both ipsilateral and contralateral GSV is not available and they include a small saphenous vein, cephalic vein, and basilic vein.&nbsp;</p>\n<p>Non-autogenous grafts are used for patients who<strong> lack a suitable venous conduit</strong>. The most commonly used prosthetic conduit is <strong>PTFE</strong>. Recent studies have shown that heparin-bonded PTFE is superior to compared to PTFE without heparin.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "What is the most common cause of chronic pancreatitis?",
    "choices": [
      {
        "id": 1,
        "text": "Gallstones"
      },
      {
        "id": 2,
        "text": "Alcohol"
      },
      {
        "id": 3,
        "text": "Autoimmune"
      },
      {
        "id": 4,
        "text": "Drugs"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Alcohol consumption</strong> is the most common cause of <strong>chronic pancreatitis</strong>, accounting for <strong>60&ndash;70% </strong>of the cases.&nbsp;<strong>Smoking </strong>increases the risk of alcohol-induced chronic pancreatitis.</p>\n<p><strong>Cystic fibrosis</strong> is the most common cause of chronic pancreatitis in the <strong>pediatric </strong>age group.</p>\n<div class=\"page\" title=\"Page 1251\">Other causes of chronic pancreatitis include:</div>\n<ul>\n<li>Pancreatic divisum</li>\n<li>Annular pancreas</li>\n<li>Hyperlipidemia</li>\n<li>Hypercalcemia</li>\n<li>Hyperparathyroidism</li>\n<li>Chronic duct obstruction</li>\n<li>Autoimmune pancreatitis</li>\n<li>Cystic fibrosis</li>\n<li>Tropical pancreatitis</li>\n<li>Hereditary pancreatitis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A probe is inserted into the duct from which the nipple discharge is emerging. A tennis racquet incision is made and the flap is dissected to reach the duct. The duct is then excised.  This  procedure is known as?",
    "choices": [
      {
        "id": 1,
        "text": "Macrodochectomy"
      },
      {
        "id": 2,
        "text": "Microdochectomy"
      },
      {
        "id": 3,
        "text": "Cone excision"
      },
      {
        "id": 4,
        "text": "Wide excision of the lactiferous duct."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Microdochectomy</strong>&nbsp;is the excision of the <strong>entire lactiferous duct </strong>(single duct disease). It is done for <strong>duct papilloma</strong>.</p>\n<p>Microdochectomy:</p>\n<ul>\n<li>In a duct papilloma where no palpable mass is present, the duct is expressed to observe the discharge.</li>\n<li>A <strong>fine probe or stiff nylon suture </strong>is gently inserted into the duct, and the probe is secured to the nipple skin using silk sutures to prevent displacement during the procedure.</li>\n<li>A <strong>tennis racquet shaped incision </strong>is made to elevate the skin flaps, and the duct with the probe is excised along with the skin flap for 5 cm until the papilloma is identified (The papilloma will always be located within 5 cm from the duct orifice).</li>\n<li>The wound is closed without a drain, and a compression bandage is applied.</li>\n</ul>\n<p>It is ideal to <strong>rule out DCIS</strong> by <strong>frozen section biopsy</strong>.</p>\n<p><strong>Cone excision</strong> and <strong>wide excision </strong>are done under major duct excision (<strong>Adair-Haldfield operation</strong>). It is done for duct ectasias with multiple duct involvement and multiple papillomas.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is true about chromic catgut?",
    "choices": [
      {
        "id": 1,
        "text": "It is made from cat gut"
      },
      {
        "id": 2,
        "text": "It is made from rabbit gut"
      },
      {
        "id": 3,
        "text": "It is absorbed by enzymatic degradation and macrophage phagocytosis"
      },
      {
        "id": 4,
        "text": "It is tanned with nickel salts to improve handling and to resist degradation in tissue"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Chromic catgut</strong> is absorbed through <strong>macrophage </strong><strong>phagocytosis</strong> and <strong>enzymatic</strong> <strong>degradation</strong> within <strong>90 days.</strong></p>\n<p>It is made from<strong> collagen</strong> derived from healthy sheep or cattle. It is then tanned with <strong>chromium salts</strong> to improve handling and resist degradation in tissue.</p>\n<p>The <strong>tensile strength</strong> lasts for<strong> 21-28 days</strong>. It has a moderate tissue reaction as compared to plain catgut, which has a high tissue reactivity.</p>\n<p>It is used to <strong>ligate superficial vessels,</strong> <strong>suture subcutaneous tissues</strong>, and is used for <strong>stomas</strong> and other tissues that heal rapidly. It is not used in tissues that heal slowly and require prolonged support.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Identify the instrument given in the image below:",
    "choices": [
      {
        "id": 1,
        "text": "Deaver's retractor"
      },
      {
        "id": 2,
        "text": "Morris retractor"
      },
      {
        "id": 3,
        "text": "Czerney's retractor"
      },
      {
        "id": 4,
        "text": "Double hook retractor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Option D: <strong>Double-hook retractor</strong> consists of two hooks with a handle. It is used in excision of swellings like lipoma, neurofibroma and cyst. It is also used to hold the skin flaps when raising them.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/37a891ac9a3c4bc8899c0d5e1d81d8f4.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2720c4ab8ed5488fb6d7ba2c4802bb79x1279x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/964a218af3e34d0596e6ecee4817eea9x1279x1022.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3357503798604ab7befeaef118b05759x1279x745.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/62b901e6491242d9a0d47d41df2f688dx1279x859.JPEG"
    ]
  },
  {
    "text": "Extra mammary Paget's disease is commonly seen in the:",
    "choices": [
      {
        "id": 1,
        "text": "Vulva"
      },
      {
        "id": 2,
        "text": "Vagina"
      },
      {
        "id": 3,
        "text": "Uterus"
      },
      {
        "id": 4,
        "text": "Cervix"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Extramammary Paget's disease</strong> arises most frequently on the <strong>vulva.&nbsp;</strong>Other sites include the perineum, scrotum, perianal skin, and penis.</p>\n<p>Extramammary Paget's disease (EMPD) can be <strong>primary</strong> or <strong>secondary</strong>.</p>\n<ul>\n<li>Primary EMPD is more common and occurs in the <strong>absence of an underlying malignancy</strong>, thought to arise from intraepidermal parts of <strong>apocrine glands</strong> or from pluripotent cells from the epidermis.</li>\n<li>Secondary EMPD arises from an<strong> underlying adnexal carcinoma</strong> or <strong>internal malignancy</strong> due to the epidermotropic spread of malignant cells from the underlying tumor.</li>\n</ul>\n<p>Visceral malignancies associated with EMPD are carcinomas of the <strong>colon</strong>, <strong>rectum</strong>, <strong>bladder</strong>, <strong>urethra</strong>, <strong>cervix,</strong> and <strong>prostate</strong>. The patient presents with well-defined, moist, erythematous scaly plaques and <strong>severe pruritis</strong>. Lichenification and excoriations may also be seen.</p>\n<p>Diagnosis is confirmed by punch, wedge, or excisional skin biopsy. A systemic workup should also be done to identify any underlying malignancy and they include colonoscopy, cystoscopy, colposcopy, and pelvic examination with pap smear in females.&nbsp;</p>\n<p>Treatment:&nbsp;</p>\n<ul>\n<li>Mohs microscopic surgery with <strong>5 cm margin clearance</strong>&nbsp;</li>\n<li>Radiotherapy&nbsp;</li>\n<li>Topical 5-fluorouracil and imiquimod&nbsp;</li>\n<li>Chemotherapy&nbsp;</li>\n<li>Photodynamic therapy&nbsp;</li>\n</ul>\n<p>The given image below shows extramammary Paget's disease of the vulva.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/53c32ca9ac704da397d50ad9d8fc8ae8x632x702.JPEG"
    ]
  },
  {
    "text": "The best method to obtain tissue for the diagnosis of pancreatic carcinoma is:",
    "choices": [
      {
        "id": 1,
        "text": "Transgastric FNAC guided by endoscopic ultrasound"
      },
      {
        "id": 2,
        "text": "MRI-guided biopsy"
      },
      {
        "id": 3,
        "text": "Laparoscopic-guided biopsy"
      },
      {
        "id": 4,
        "text": "Percutaneous transperitoneal biopsy"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p><strong>Transgastric or transduodenal FNAC</strong> or <strong>trucut biopsy</strong> performed under<strong> endoscopic ultrasound (EUS)</strong> guidance is the best method to obtain tissue for the diagnosis of <strong>pancreatic carcinoma</strong>. This is because it <strong>avoids the spillage</strong> of tumor cells into the peritoneal cavity.&nbsp;</p>\n<p>Endoscopic ultrasonography with a fine needle aspiration <strong>(EUS-FNA)</strong> is done if CT has failed to demonstrate a tumor. When a tissue diagnosis is required prior to surgery to distinguish between inflammation and neoplasia, EUS-FNA is helpful.</p>\n<div class=\"page\" title=\"Page 1256\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Diagnostic laparoscopy</strong> prior to resection can spare an unnecessary laparotomy by identifying small peritoneal and liver metastases.</p>\n</div>\n</div>\n</div>\n</div>\n<p><strong>Percutaneous transperitoneal biopsy</strong> of potentially resectable pancreatic tumors is&nbsp;<strong>avoided.</strong></p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An abdominal mass in a patient with congenital hypertrophic pyloric stenosis is best seen _________.",
    "choices": [
      {
        "id": 1,
        "text": "During feeding"
      },
      {
        "id": 2,
        "text": "Soon after birth"
      },
      {
        "id": 3,
        "text": "During palpation over the left hypochondrium"
      },
      {
        "id": 4,
        "text": "During palpation over the epigastrium"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>In a child with <strong>congenital hypertrophic pyloric stenosis </strong>(CHPS),<strong> </strong>the<strong>&nbsp;</strong>abdominal mass<strong> </strong>is best seen <strong>during test feed in the right upper quadrant</strong>.&nbsp;</p>\n<p><strong>Hypertrophic pyloric stenosis</strong>&nbsp;most presents with<strong>&nbsp;non-bilious projectile vomiting.</strong>&nbsp;It is common<strong>&nbsp;</strong>between<strong>&nbsp;</strong>2 and 8 weeks of age. Hypertrophy of the&nbsp;<strong>circular muscle</strong>&nbsp;of the pylorus results in constriction and obstruction of the gastric outlet. Male infants are at a higher risk.</p>\n<p>Clinically, when the infant is given a test feed, an <strong>olive-shaped mass</strong> is palpable in the right upper quadrant and <strong>visible peristalsis</strong>&nbsp;is usually observed moving from&nbsp;<strong>left to right&nbsp;</strong>across the abdomen.</p>\n<div class=\"ng-scope\">\n<div class=\"ng-scope\">\n<p>Infants with hypertrophic pyloric stenosis develop a characteristic metabolic abnormality-&nbsp;<strong>hypochloraemic hypokalaemic</strong>&nbsp;<strong>metabolic</strong>&nbsp;<strong>alkalosis</strong>. Persistent vomiting results in loss of hydrochloric acid leading to the development of&nbsp;<strong>metabolic</strong>&nbsp;<strong>alkalosis</strong>&nbsp;(due to loss of H<sup>+</sup>) and&nbsp;<strong>hypochloremia</strong>&nbsp;(due to loss of Cl<sup>-</sup>).</p>\n</div>\n</div>\n<p>All infants with congenital hypertrophic pyloric stenosis are evaluated with an <strong>ultrasound (investigation of choice)</strong>. It <strong>confirms the diagnosis</strong>&nbsp;in the majority of cases.</p>\n<p>Management: Rehydration and metabolic correction prior to definitive surgery - Ramstedt's pyloromyotomy.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "While performing a fasciotomy for compartment syndrome, the following layers are incised:",
    "choices": [
      {
        "id": 1,
        "text": "Skin and Subcutaneous tissue"
      },
      {
        "id": 2,
        "text": "Skin, Subcutaneous tissue, Superficial fascia"
      },
      {
        "id": 3,
        "text": "Skin, Subcutaneous tissue, Superficial fascia and Deep fascia"
      },
      {
        "id": 4,
        "text": "Skin, Subcutaneous tissue, Superficial fascia, Deep fascia and a few muscular fibres"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The incision for a fasciotomy involves the <strong>skin, subcutaneous tissue, superficial fascia,</strong> and<strong> deep fascia.</strong></p>\n<p>Fasciotomy involves incising the <strong>deep muscle fascia&nbsp;</strong>and is best carried out via longitudinal incisions of skin, subcutaneous fat, and superficial and deep fascia. The&nbsp;<strong>muscle will be seen bulging out&nbsp;</strong>through the fasciotomy opening.</p>\n<p>The lower limb can be decompressed via&nbsp;<strong>two incisions</strong>, each being lateral to the subcutaneous border of the tibia. This gives access to the two posterior compartments and the leg's peroneal and anterior compartments.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/bfba91ccc33140e4a8452ca04386c448x720x1280.JPEG"
    ]
  },
  {
    "text": "Which of the following statements is true about Crohn's disease?",
    "choices": [
      {
        "id": 1,
        "text": "For effective treatment of a Crohn's mass, only antibiotics are prescribed."
      },
      {
        "id": 2,
        "text": "Symptomatic relapse after surgery is not related to the presence of disease during resection."
      },
      {
        "id": 3,
        "text": "The proximal ileum is most commonly involved in Crohn's disease."
      },
      {
        "id": 4,
        "text": "On endoscopic examination, continuous lesions are visualised, which are diagnostic of Crohn's disease."
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>Symptomatic <strong>relapse</strong> of Crohn's disease after surgery is <strong>not related</strong> to the <strong>presence of the disease</strong> during resection.&nbsp;</p>\n<p>The course of the disease after surgery is unpredictable since surgery does not cure Crohn's disease. Instead, the <strong>probability of relapse</strong> increases with the <strong>time since resection.&nbsp;</strong></p>\n<p>Other options:</p>\n<p>Option A: <strong>Antibiotics alone cannot treat</strong> a Crohn's mass effectively. Abscesses can be treated with metronidazole and ciprofloxacin and should also undergo <strong>drainage</strong> (and resection if needed).</p>\n<p>Option C:<strong>&nbsp;</strong>The <strong>terminal ileum</strong> is most commonly involved in Crohn's disease.</p>\n<p>Option D: On endoscopic examination, <strong>discontinuous</strong> <strong>\"skip\" </strong>lesions are visualized. These are irregular areas of inflamed mucosa that are ulcerated with mucopurulent exudate separated by intervening, normal-appearing intestinal mucosa.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is the earliest sign in Crohn's disease?",
    "choices": [
      {
        "id": 1,
        "text": "Cobblestone appearance"
      },
      {
        "id": 2,
        "text": "Deep fissured ulcers"
      },
      {
        "id": 3,
        "text": "Rose-thorn appearance"
      },
      {
        "id": 4,
        "text": "Aphthous ulcers"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Aphthous ulcers</strong>, surrounded by a rim of erythematous mucosa, are the <strong>earliest</strong> lesions seen in a patient with Crohn's disease during<strong> endoscopy.</strong></p>\n<p>Crohn's colitis usually spares the rectum and is <strong>most severe </strong>in the <strong>ileocaecal region</strong>.</p>\n<ul>\n<li>In early Crohn's disease, small, <strong>punched-out aphthous ulcers</strong> are often seen (the result of submucosal lymphoid follicle expansion).</li>\n<li>In moderate disease, the aphthous ulcers coalesce into larger ulcers, which may take on the appearance of a star (stellate ulcers).</li>\n<li>As disease severity increases, submucosal edema and injury can result in <strong>cobblestoning</strong> of the mucosa (option A) and eventually the formation of <strong>serpiginous ulcers</strong>, which are typical findings in Crohn's disease.&nbsp;</li>\n</ul>\n<p>Thorn-like extraluminal projections in <strong>barium studies</strong> are known as <strong>rose-thorn appearance</strong>, and are a typical sign of Crohn's disease. They represent <strong>deep penetrating linear ulcers</strong> or fissurings typically seen within stenosed terminal ileum with a thickened wall. (Options C and D)</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "The Van Nuys grading system for ductal carcinoma in situ does not include:",
    "choices": [
      {
        "id": 1,
        "text": "Age of the patient"
      },
      {
        "id": 2,
        "text": "Size of the tumor"
      },
      {
        "id": 3,
        "text": "Hormone receptor staining"
      },
      {
        "id": 4,
        "text": "Presence of microcalcification"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Staining for estrogen and progesterone receptors is not part of the Van Nuys system used for grading DCIS.&nbsp;</p>\n<p>The components of the <strong>Van Nuys prognostic index</strong> (VNPI) are as follows:</p>\n<ul>\n<li>Size of the tumor</li>\n<li>Extent of resection margin&nbsp;</li>\n<li>Histological variant of DCIS - based on nuclear grade, presence of necrosis, presence of microcalcification</li>\n<li>Age&nbsp;of the patient</li>\n</ul>\n<p>Patients with a<strong> high score</strong> in this grading system benefit from <strong>radiotherapy after excision, </strong>whereas those with <strong>low-grade</strong>&nbsp;and&nbsp;<strong>completely excised</strong> tumors, need <strong>no further treatment</strong>.</p>\n<p>A score ranging from<strong> 1 </strong>(lesions with the <strong>best prognosis</strong>) to <strong>3 </strong>(lesions with the <strong>worst prognosis</strong>) is given for each of the four prognostic predictors. Total scores range from 4 (least likely to recur) to 12 (most likely to recur).</p>\n<table style=\"height: 26px;\" width=\"655\">\n<tbody>\n<tr>\n<td style=\"width: 645px; text-align: center;\"><strong>Silverstein Van Nuys prognostic index for DCIS</strong></td>\n</tr>\n</tbody>\n</table>\n<table style=\"height: 72px;\" width=\"654\">\n<tbody>\n<tr>\n<td style=\"width: 156.5px;\"><strong>Parameters</strong></td>\n<td style=\"width: 156.5px;\"><strong>Score 1</strong></td>\n<td style=\"width: 156.5px;\"><strong>Score 2</strong></td>\n<td style=\"width: 156.5px;\"><strong>Score 3</strong></td>\n</tr>\n<tr>\n<td style=\"width: 156.5px;\"><strong>Size(mm)</strong></td>\n<td style=\"width: 156.5px;\">&le;15</td>\n<td style=\"width: 156.5px;\">16-40</td>\n<td style=\"width: 156.5px;\">&ge;41</td>\n</tr>\n<tr>\n<td style=\"width: 156.5px;\"><strong>Margin(mm)</strong></td>\n<td style=\"width: 156.5px;\">&ge;10</td>\n<td style=\"width: 156.5px;\">1-9</td>\n<td style=\"width: 156.5px;\">&lt;1</td>\n</tr>\n<tr>\n<td style=\"width: 156.5px;\"><strong>Class</strong></td>\n<td style=\"width: 156.5px;\">Grade 1 or 2 without necrosis</td>\n<td style=\"width: 156.5px;\">Grade 1 or 2 with necrosis</td>\n<td style=\"width: 156.5px;\">Grade 3 with or without necrosis</td>\n</tr>\n<tr>\n<td style=\"width: 156.5px;\"><strong>Age(years)</strong></td>\n<td style=\"width: 156.5px;\">&gt;60</td>\n<td style=\"width: 156.5px;\">40-60</td>\n<td style=\"width: 156.5px;\">&lt;40</td>\n</tr>\n</tbody>\n</table>\n<table style=\"height: 39px;\" width=\"654\">\n<tbody>\n<tr>\n<td style=\"width: 644px;\">\n<ul>\n<li>Scores 4-7 with &gt;3mm margin: <strong>Excision alone</strong>&nbsp;</li>\n<li>Score 7 with &lt; 3 mm margin, score 8 with &gt; 3mm margin, score 9 with &gt;5mm margin:&nbsp;<strong>Excision with RT</strong></li>\n<li>Score 9 with &lt; 5mm margin &amp; score 10,11,12: <strong>Mastectomy</strong></li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<p>Note: The type of <strong>microcalcification</strong> seen on imaging, helps in determining the <strong>nuclear grade</strong> of DCIS.<strong>&nbsp;</strong>While<strong>&nbsp;</strong>the<strong> linear</strong> <strong>branching</strong> type of microcalcification is associated with <strong>high </strong>nuclear grade, <strong>fine granular</strong> type is associated with <strong>low </strong>nuclear grade.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following statements are true with regards to a keloid scar?",
    "choices": [
      {
        "id": 1,
        "text": "The extent does not cross the wound margins"
      },
      {
        "id": 2,
        "text": "Wide excision of the keloid scar prevents recurrence"
      },
      {
        "id": 3,
        "text": "Histopathology of a keloid scar shows reduced collagen and increased vascularity"
      },
      {
        "id": 4,
        "text": "A keloid scar forms due to increase in the level of growth factors"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Differences between Keloids and Hypertrophic scars:</p>\n<table style=\"border-collapse: collapse; width: 59.4374%; height: 380.773px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\"><strong>Keloid&nbsp;</strong></td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\"><strong>Hypertrophic scar&nbsp;</strong></td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">Incidence&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\">Rare&nbsp;</td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\">Frequent&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Ethnic groups&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">African, American, Asian, Hispanic&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">No predilection&nbsp;</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">Prior injury&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\">Yes&nbsp;</td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\">Yes&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Site predilection</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">Neck, chest, earlobes, shoulders, upper back&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">Anywhere&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Genetics&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\"><strong>Autosomal dominant</strong> with incomplete penetration&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">No&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Timing&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">Symptom-free interval; may appear years after injury&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">4-6 weeks post-injury&nbsp;</td>\n</tr>\n<tr style=\"height: 67.1953px;\">\n<td style=\"width: 20.3378%; height: 67.1953px; text-align: center;\">Symptoms&nbsp;</td>\n<td style=\"width: 40.2127%; height: 67.1953px; text-align: center;\">Pain, pruritus, hyperesthesia, growth beyond wound margins</td>\n<td style=\"width: 39.4495%; height: 67.1953px; text-align: center;\">Raised, some pruritus, respects wound confines&nbsp;</td>\n</tr>\n<tr style=\"height: 44.7969px;\">\n<td style=\"width: 20.3378%; height: 44.7969px; text-align: center;\">Regression and contracture&nbsp;</td>\n<td style=\"width: 40.2127%; height: 44.7969px; text-align: center;\">No, and rare&nbsp;</td>\n<td style=\"width: 39.4495%; height: 44.7969px; text-align: center;\">Frequent&nbsp;</td>\n</tr>\n<tr style=\"height: 22.3984px;\">\n<td style=\"width: 20.3378%; height: 22.3984px; text-align: center;\">Histology&nbsp;</td>\n<td style=\"width: 40.2127%; height: 22.3984px; text-align: center;\">Hypocellular, thick, wavy collagen fibres in <strong>random orientation&nbsp;</strong></td>\n<td style=\"width: 39.4495%; height: 22.3984px; text-align: center;\"><strong>Parallel orientation</strong> of collagen fibres&nbsp;</td>\n</tr>\n</tbody>\n</table>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/61e40243f86143daacfc9c2ba914eaaax800x534.JPEG"
    ]
  },
  {
    "text": "Heller\u2019s operation is done for _____.",
    "choices": [
      {
        "id": 1,
        "text": "Achalasia cardia"
      },
      {
        "id": 2,
        "text": "Carcinoma esophagus"
      },
      {
        "id": 3,
        "text": "Esophageal stricture"
      },
      {
        "id": 4,
        "text": "Hypertrophic pyloric stenosis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The most common surgical procedure for<strong> achalasia cardia</strong> is laproscopic <strong>Heller myotomy</strong> in conjugation with partial fundoplication.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not true about Barrett's esophagus?",
    "choices": [
      {
        "id": 1,
        "text": "It is the intestinal metaplasia of esophagus"
      },
      {
        "id": 2,
        "text": "Mucus secreting foveolar cells are characteristic"
      },
      {
        "id": 3,
        "text": "Alician blue is used in the staining of biopsy specimen"
      },
      {
        "id": 4,
        "text": "It is a reversible cell adaptation"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Alician blue</strong> is used in the<strong> staining </strong>of the<strong> biopsy</strong> specimen, as it stains the goblet cells (option C). <strong>Mucicarmine </strong>is the<strong> specific stain.</strong></p>\n<p><strong>Seattle protocol</strong> is used for the management of Barrett's esophagus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/814aaf9503854aeab6979161c346c4dfx1279x1048.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e940eb827c404b2e896e090eb1faebfdx1279x1702.JPEG"
    ]
  },
  {
    "text": "Modified shock index is calculated using?",
    "choices": [
      {
        "id": 1,
        "text": "HR/SBP"
      },
      {
        "id": 2,
        "text": "HR/DBP"
      },
      {
        "id": 3,
        "text": "HR/MAP"
      },
      {
        "id": 4,
        "text": "PR/SBP"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<ul>\n<li><strong>Modified </strong>shock index <strong>= HR/MAP&nbsp;</strong></li>\n<li>Original <strong>shock index = HR/SBP&nbsp;</strong></li>\n</ul>\n<p>The shock index is a&nbsp;<strong>hemodynamic stability indicator</strong>. In patients with shock, it is a better&nbsp;<strong>predictor of mortality</strong> than blood pressure or heart rate alone. A <strong>shock index &gt;0.9</strong> is indicative of <strong>higher mortality.</strong></p>\n<p>The <strong>modified</strong> shock index is a <strong>more sensitive</strong> indicator of tissue perfusion than the <strong>original</strong> shock index. In critically ill patients, the DBP decreases earlier than SBP, hence, the modified shock index using MAP is better suited to assess the severity of shock.</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  }
];
        let quizName = '230 Surgery Neet 2018';
        let hierarchy = ["Marrow", "PYQs", "Surgery"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>