<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21 Connective Tissue Disorders - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
  
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}


    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / qBank / Dermatology
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">21</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "Which of the following is the most common site involved in discoid lupus erythematosus?",
    "choices": [
      {
        "id": 1,
        "text": "Fingers"
      },
      {
        "id": 2,
        "text": "Scalp and face"
      },
      {
        "id": 3,
        "text": "Trunk"
      },
      {
        "id": 4,
        "text": "Side of neck"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Discoid lupus erythematosus</strong> is a benign inflammatory disorder of the skin, <strong>most frequently</strong> involving the<strong> face</strong> and<strong> scalp.&nbsp;</strong></p>\n<p>It is characterized by well\u2010defined red, scaly patches of variable size, which heal with atrophy, scarring, and pigmentary changes.&nbsp;The <strong>circumscribed</strong> or<strong> discoid</strong> form is the most frequent type of disease and occurs particularly on the <strong>cheeks</strong>, bridge of the <strong>nose</strong>, <strong>ears, side of the neck, and scalp</strong>.</p>\n<p>The image below shows a localized discoid lupus erythematosus of the scalp with follicular plugging.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/5f0cd07feddb43fb97445b845af3ab79x1280x2022.0028208744711.JPEG"
    ]
  },
  {
    "text": "A dermoscopy examination in a patient who presented with alopecia revealed the following finding. Identify the condition.",
    "choices": [
      {
        "id": 1,
        "text": "Alopecia aerata"
      },
      {
        "id": 2,
        "text": "Discoid lupus erythematosus"
      },
      {
        "id": 3,
        "text": "Dermatomyositis"
      },
      {
        "id": 4,
        "text": "Lupus vulgaris"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In cutaneous lupus erythematosus or discoid lupus erythematosus, the skin lesions present as well-defined&nbsp;<strong>erythematous patches</strong> with <strong>adherent</strong> <strong>scaling </strong>and<strong> peripheral hyperpigmentation. </strong>When the scale is removed its undersurface shows horny plugs that have occupied dilated pilosebaceous canals. This is called the &lsquo;tin\u2010tack&rsquo; sign.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/be6e7f2a855942c09feaaa52f0360572.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e98cd53c61274ff398ad75d78b0f64c1x1200x1709.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6cb6a2af60c04b4099e82f7e55aabde7x401x269.PNG"
    ]
  },
  {
    "text": "A 40-year-old man presented to the dermatologist with alopecia and the following disfiguring lesions. His history was suggestive of Raynaud's phenomenon. On examination, wide follicular pits were noted in the concha. ANA titres were normal. Identify the false statement regarding his condition.",
    "choices": [
      {
        "id": 1,
        "text": "Topical steroids is the first line treatment for localised lesions"
      },
      {
        "id": 2,
        "text": "Histology shows lymphocytic interface dermatitis with basal layer degeneration"
      },
      {
        "id": 3,
        "text": "Antimalarials can be used for treatment"
      },
      {
        "id": 4,
        "text": "Non-scarring alopecia is typically seen in this condition"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The clinical scenario along with the image showing discoid lesions on the face with central scarring and active erythematous margins with adherent scales are suggestive of <strong>discoid lupus erythematosus.</strong> <strong>Scarring</strong> type of<strong> alopecia</strong> is seen in discoid lupus erythematosus (DLE).</p>\n<p>Histology of DLE shows <strong>lymphocytic interface dermatitis</strong> with<strong> basal layer degeneration</strong>, follicular plugging, dermal mucinosis, and epidermal atrophy.</p>\n<p>The<strong> first-line treatment</strong> for localized lesions is <strong>topical corticosteroids.&nbsp;</strong></p>\n<p>Hydroxychloroquine and chloroquine are <strong>oral antimalarial drugs</strong> that can be used along with oral steroids and have a good response rate.&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/50731ebf2d6747388344719356b3a626.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/69016698dfe940b0abfafba9682165f5x1280x1009.JPEG"
    ]
  },
  {
    "text": "Which of the following is the most common cutaneous presentation of subacute cutaneous lupus erythematosus?",
    "choices": [
      {
        "id": 1,
        "text": "Scarring papulosquamous eruption"
      },
      {
        "id": 2,
        "text": "Non-scarring papulosquamous eruption"
      },
      {
        "id": 3,
        "text": "Annular polycyclic lesions"
      },
      {
        "id": 4,
        "text": "Discoid plaque with adherent scale"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Subacute cutaneous lupus erythematosus</strong>&nbsp;presents most commonly as a <strong>non\u2010scarring papulosquamous eruption.</strong>&nbsp;It can also present as annular polycyclic lesions.</p>\n<p>Sites of lesions:</p>\n<ul>\n<li>Above the waist</li>\n<li>Around the neck</li>\n<li>On the trunk</li>\n<li>Outer aspects of the arms</li>\n</ul>\n<p>The image below shows <strong>psoriasiform lesions</strong> of subacute cutaneous lupus erythematosus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/992b257b123d4dd6865ddd5367ad1278x512x363.PNG"
    ]
  },
  {
    "text": "Which of the following is the most common cutaneous manifestation of systemic lupus erythematosus?",
    "choices": [
      {
        "id": 1,
        "text": "Chronic urticaria"
      },
      {
        "id": 2,
        "text": "Malar rash"
      },
      {
        "id": 3,
        "text": "Raynaud's Phenomenon"
      },
      {
        "id": 4,
        "text": "Photosensitivity"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most common cutaneous</strong> manifestation of <strong>systemic lupus erythematosus</strong> is <strong>photosensitivity</strong>.</p>\n<p>In decreasing order, the cutaneous manifestations in SLE are:</p>\n<ol>\n<li>Photosensitivity</li>\n<li>Raynaud's phenomenon\u00a0</li>\n<li>Malar rash</li>\n<li>Chronic urticaria &gt;36 hrs</li>\n<li>Non-scarring alopecia\u00a0</li>\n<li>Mouth ulceration</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A young woman presented to the OPD with the following rash. She also complained of myalgia, arthralgia, and hair loss. Her history was significant for sun-induced skin problems. Lupus band test was found to be positive only in the involved skin. Which of the following antibodies is closely associated with this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-Ro (SS-A)"
      },
      {
        "id": 2,
        "text": "Anti-Ribosomal P"
      },
      {
        "id": 3,
        "text": "Anti-La (SS-B)"
      },
      {
        "id": 4,
        "text": "Anti-RNP"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows a psoriasiform papulosquamous lesion on the sun-exposed area(back). Along with the history and the positive lupus band test only in the involved skin, a diagnosis of <strong>subacute cutaneous lupus erythematosus&nbsp;</strong>can be made.&nbsp;Antibodies to the <strong>Ro/SS\u2010A</strong> antigen are almost universally present in this subgroup.&nbsp;</p>\n<p>Subacute cutaneous lupus erythematosus is a specific &lsquo;subset&rsquo; of lupus in which patients exhibit mainly<strong> cutaneous disease</strong> and usually have a <strong>good prognosis</strong>.</p>\n<p>The<strong> lupus band test</strong> (LBT) is a <strong>direct immunofluorescence</strong>&nbsp;technique for demonstrating a <strong>band</strong> of localized <strong>immunoglobulins</strong> at the <strong>dermal-epidermal junction</strong> in the skin of patients with lupus erythematosus (LE).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b33a46901852420bba18e970fda355e8.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 20-year-old woman presented to the hospital with complaints of jamais vu and new-onset seizures. CT brain was normal. Her laboratory values are given below. Which of the following is not a dermatological manifestation of this disorder?",
    "choices": [
      {
        "id": 1,
        "text": "Discoid lesions"
      },
      {
        "id": 2,
        "text": "Painless ulcers on hard palate"
      },
      {
        "id": 3,
        "text": "Photosensitivity"
      },
      {
        "id": 4,
        "text": "Salmon rash"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The given clinical details are suggestive of <strong>systemic lupus erythematosus</strong> (SLE).<strong>&nbsp;Salmon rash</strong>&nbsp;is seen in <strong>adult-onset</strong> of <strong>Still's disease.</strong> It is a rare systemic inflammatory disease&nbsp;characterized by the classic triad of:</p>\n<ol>\n<li>Persistent high spiking fever</li>\n<li>Joint pain</li>\n<li>Salmon rash</li>\n</ol>\n<p><strong>SLE&nbsp;</strong>is more common in <strong>females </strong>(7:1 to 15:1).<strong>&nbsp;</strong>It is associated with classical erythematous rash, typically sparing the nasolabial folds called<strong>&nbsp;malar/butterfly rash.&nbsp;<br /></strong></p>\n<p><strong>Discoid rashes</strong> resembling discoid lupus erythematosus may also be seen. Clinical <strong>photosensitivity</strong> in the form of polymorphous light reaction and pruritus is associated with more severe systemic disease.</p>\n<p>The image given below shows a malar rash.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a9fd4549688a483d8e3c6f4542a8a9e6x512x395.PNG"
    ]
  },
  {
    "text": "A 19-year-old woman presented to the hospital with complaints of progressive shortness of breath, chest pain, and lower extremity edema over the past month. Her initial laboratory values are given below. A renal biopsy showed the following. Which of the following antibodies is considered to be most specific for this disorder?",
    "choices": [
      {
        "id": 1,
        "text": "SS-A(Ro)"
      },
      {
        "id": 2,
        "text": "Anti-Sm"
      },
      {
        "id": 3,
        "text": "Anti ds-DNA"
      },
      {
        "id": 4,
        "text": "Antihistone"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical details and histopathology are suggestive of <strong>systemic lupus erythematosus</strong> (SLE).<strong> Anti\u2010Smith</strong> (anti\u2010Sm)<strong> antibodies</strong> are present in only approximately 30% of patients with SLE, but are considered highly&nbsp;<strong>specific</strong> for the disease and are included in the ACR criteria.</p>\n<p>Most <strong>sensitive</strong>&nbsp;antibody:&nbsp;<strong>ANA</strong></p>\n<p>In the image below, the glomerulus is hypercellular (endocapillary proliferation). Glomerular capillary loops appear circumferentially thickened, forming a&nbsp;\"wire loop\" lesion, which is&nbsp;classically seen in class IV or diffuse proliferative lupus nephritis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/04e984b28c0c46ba9ad231e2118bdec8.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b7389cdbd5b64d4c905c256d19e1dfc1x1280x911.JPEG"
    ]
  },
  {
    "text": "A 16-year-old boy who presented with joint pains and the following rash was diagnosed with SLE after a thorough work-up. Which of the following statements is incorrect regarding his diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-ds DNA correlates with disease activity"
      },
      {
        "id": 2,
        "text": "Anti-Sm correlates with disease activity"
      },
      {
        "id": 3,
        "text": "Anti-Ro antibody is associated with photosensitivity"
      },
      {
        "id": 4,
        "text": "Rim pattern of ANA positivity is specific for SLE"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong>Anti\u2010Smith</strong> (anti\u2010Sm)<strong> antibodies</strong> are present in approximately 30% of patients with SLE, but are considered highly&nbsp;<strong>specific</strong> for the disease and are included in the ACR criteria,&nbsp;however, they are <strong>not of use</strong> in <strong>monitoring</strong> overall lupus <strong>disease activity.&nbsp;</strong>Anti-ds DNA levels often correlate with disease activity.</p>\n<p>The image shows the characteristic malar rash.</p>\n<p><strong>Anti\u2010Ro</strong> antibody occurs in approximately 30&ndash;40% of patients, who have an increased tendency to <strong>photosensitivity, secondary Sj&ouml;gren</strong> syndrome, interstitial pneumonitis, shrinking lung syndrome, or deforming arthropathy, as well as being a marker for <strong>neonatal lupus.</strong></p>\n<p><strong>Rim pattern</strong> of <strong>ANA</strong> positivity is <strong>specific</strong> for SLE.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/49ecfbc6aea640ebae853119b8899f97.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "An infant born to an asymptomatic mother was found to have typical cutaneous and serological findings of neonatal lupus syndrome. Anti-Ro and anti-La antibodies were detected in both the mother and the child. Which of the following statements is true regarding the child's condition?",
    "choices": [
      {
        "id": 1,
        "text": "Approximately 90% of the infants manifest cutaneous lesions"
      },
      {
        "id": 2,
        "text": "Rash resolves over few months with scarring"
      },
      {
        "id": 3,
        "text": "UV exposure has no effect on the rash"
      },
      {
        "id": 4,
        "text": "The most common finding is raccoon sign"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The <strong>most common</strong> fin<strong>ding</strong> in neonatal lupus erythematosus (<strong>NLE</strong>) is an<strong> erythematous, slightly scaly eruption</strong> on the <strong>face</strong> and<strong> periorbital skin</strong> (<strong>raccoon sign</strong>/owl eye/eye mask).</p>\n<p>NLE is a well\u2010recognized subtype of lupus erythematosus, thought to be caused by the <strong>transplacental </strong>passage of maternal <strong>antibodies.</strong></p>\n<p>The most frequent clinical manifestations are cutaneous lesions and<strong> congenital heart block</strong> (CHB).&nbsp;Approximately <strong>50%</strong> of infants manifest skin lesions, which may be <strong>present at birth</strong> or occur in the <strong>first few weeks of life</strong>. The eruption can be <strong>exacerbated</strong> by<strong> UV exposure.</strong></p>\n<p>The rash improves over the first few months of life and has usually resolved <strong>without scarring</strong> by 12 months of age. Skin disease is often mild and often<strong> requires no treatment</strong>.&nbsp;</p>\n<p>The image given below shows typical raccoon eyelid lesions&nbsp;in neonatal lupus erythematosus.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/f738f4ca980a4852b2a1e1238609f2f3x1280x1138.2792665726374.JPEG"
    ]
  },
  {
    "text": "A 33-year-old patient presented with myalgia, dif\ufb01culty in climbing stairs, getting up from squatting position, and combing his hair for 3 months. An edematous purplish-red periorbital rash was seen. Investigations revealed elevated creatinine kinase levels. Muscle biopsy revealed perifascicular and perivascular lymphocytic infiltrates with muscle fiber degeneration. Which of the following is not true regarding this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Dysphagia points to a worse prognosis"
      },
      {
        "id": 2,
        "text": "Muscle tenderness is common"
      },
      {
        "id": 3,
        "text": "20 to 40% of patients have an underlying malignancy"
      },
      {
        "id": 4,
        "text": "Dilated capillary loops in nail fold can be seen"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The above clinical scenario is suggestive of <strong>dermatomyositis. </strong>Muscle tenderness is not common in this disorder.</p>\n<p>It<strong>&nbsp;</strong>is an autoimmune disorder affecting, predominantly, the <strong>skin</strong> and <strong>skeletal muscle </strong>and&nbsp;usually presents<strong> initially</strong> with a <strong>facial rash </strong>especially around eyelids which can be pruritic and sore.&nbsp;<strong>Myositis</strong> symptoms are usually <strong>weakness</strong> and <strong>fatigue</strong> especially while climbing stairs, raising arms, and standing from sitting due to proximal muscle weakness.</p>\n<p>The presence of&nbsp;<strong>dysphagia</strong>&nbsp;points to a <strong>poorer</strong> <strong>prognosis</strong>.</p>\n<p>The <strong>clinical signs</strong> seen in dermatomyositis are as follows:</p>\n<ul>\n<li>Heliotrope rash around eyelids with a lilac hue.</li>\n<li><strong>Gottron papules -&nbsp;</strong>flat-topped lichenoid eruption on the proximal and distal interphalangeal joint</li>\n<li><strong>Shawl sign or V sign</strong>&nbsp;- fixed erythematous macular erythema)</li>\n<li><strong>Nail fold changes</strong> with<strong> periungal erythema </strong>with visible dilated capillary loops in the proximal nail fold</li>\n<li><strong>Proximal myopathy</strong></li>\n<li>Poikiloderma atrophicans vasculare</li>\n<li>Calcinosis cutis</li>\n</ul>\n<p>Approximately 20 to 40% of patients have an underlying malignancy (eg, lung, ovarian, breast) and hence screening should be done at the time of diagnosis.</p>\n<p>The image below shows ragged cuticle and periungueal erythema in a patient with dermatomyositis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/42d5abac25a84f59a8480e1f6d87ef7ax1280x1182.5105782792666.JPEG"
    ]
  },
  {
    "text": "In which of the following disorders is the following sign seen?",
    "choices": [
      {
        "id": 1,
        "text": "Discoid lupus erythematosus"
      },
      {
        "id": 2,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 3,
        "text": "Dermatomyositis"
      },
      {
        "id": 4,
        "text": "Localised scleroderma"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows a <strong>maculopapular rash</strong> on the <strong>lateral thigh</strong> which is also known as the<strong> holster sign</strong>, seen in <strong>dermatomyositis</strong>.</p>\n<p>The buttocks are often involved and confluent macular violaceous&nbsp;erythema over the hips and lateral thighs has been termed the &lsquo;holster sign&rsquo; corresponding to the site of hanging a holster.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/97a26715c0014f97964b584e0f4ea47c.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/077f896ca371464e96edd079f47ad70dx1280x1664.5416078984485.JPEG"
    ]
  },
  {
    "text": "Which of the following autoantibodies shows a strong association with the given clinical condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-Mi-2"
      },
      {
        "id": 2,
        "text": "Anti P155/P140"
      },
      {
        "id": 3,
        "text": "Anti Jo-1"
      },
      {
        "id": 4,
        "text": "Anti Scl-70"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The image shows&nbsp;<strong>pathognomonic </strong>involvement of eyelids in dermatomyositis in which the<strong> upper eyelids</strong> are<strong> preferentially affected </strong>with&nbsp;<strong>erythema</strong> that is lilac in color called<strong>&nbsp;heliotrope rash. </strong>This is associated with<strong> anti-Mi-2 antibodies.</strong></p>\n<p><strong>Gottron&rsquo;s papule</strong>, <strong>h</strong><strong>eliotrope rash</strong>, and <strong>s</strong><strong>hawl sign</strong>&nbsp;are associated with <strong>anti-Mi2 antibodies</strong>.</p>\n<p>Mechanic hand, Myositis, and ILD (Interstitial Lung Disease) are associated with anti\u2010histidyl tRNA synthetase (<strong>anti-Jo-1</strong>) antibodies.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/a7199b6d601146efb424d852abb0c474.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify Gottron\u2019s sign.",
    "choices": [
      {
        "id": 1,
        "text": "1"
      },
      {
        "id": 2,
        "text": "2"
      },
      {
        "id": 3,
        "text": "3"
      },
      {
        "id": 4,
        "text": "4"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>Gottron's sign</strong>\u00a0refers to <strong>erythematous or violaceous</strong>,\u00a0<strong>macules</strong> or <strong>patches</strong>\u00a0in the same symmetric distribution pattern but <strong>sparing </strong>the <strong>interphalangeal spaces</strong> and sometimes involving<strong>\u00a0elbows</strong> and<strong> knees</strong>.</p>\n<p>This should not be confused with Gottron's papules.</p>\n<p><strong>Gottron\u2019s papules </strong>are <strong>v</strong><strong>iolaceous </strong>(of violet color), <strong>l</strong><strong>ichenoid </strong>(red-purple), inflammatory, flat-topped <strong>papules</strong> on proximal interphalangeal joints,\u00a0distal interphalangeal joints, and metacarpophalangeal\u00a0joints.\u00a0</p>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/65a06a78b64742279d54537e340122fa.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/369e034945a34e1ca6620d67520ffcd0x1280x1697.JPEG"
    ]
  },
  {
    "text": "In which of the following conditions is this finding characteristically seen?",
    "choices": [
      {
        "id": 1,
        "text": "Discoid lupus erythematosus"
      },
      {
        "id": 2,
        "text": "Cutaneous scleroderma"
      },
      {
        "id": 3,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 4,
        "text": "Dermatomyositis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The image shows a&nbsp;<strong>confluent macular violaceous erythema </strong>called the <strong>V sign</strong>&nbsp;seen in patients of<strong>&nbsp;dermatomyositis.</strong></p>\n<p>It<strong>&nbsp;</strong>is an autoimmune disorder affecting, predominantly, the&nbsp;<strong>skin</strong>&nbsp;and&nbsp;<strong>skeletal muscle&nbsp;</strong>and&nbsp;usually presents<strong>&nbsp;initially</strong>&nbsp;with a&nbsp;<strong>facial rash,&nbsp;</strong>especially around eyelids, which can be pruritic and sore.&nbsp;<strong>Myositis</strong>&nbsp;symptoms are usually&nbsp;<strong>weakness</strong>&nbsp;and&nbsp;<strong>fatigue</strong>&nbsp;especially while climbing stairs, raising arms, and standing from sitting due to proximal muscle weakness.</p>\n<p>The presence of&nbsp;<strong>dysphagia</strong>&nbsp;points to a&nbsp;<strong>poorer</strong>&nbsp;<strong>prognosis</strong>.</p>\n<p>The&nbsp;<strong>clinical signs</strong>&nbsp;seen in dermatomyositis are as follows:</p>\n<ul>\n<li>Heliotrope rash around eyelids with a lilac hue.</li>\n<li><strong>Gottron papules -&nbsp;</strong>flat-topped lichenoid eruption on the proximal and distal interphalangeal joint</li>\n<li><strong>Shawl sign or V sign</strong>&nbsp;- fixed erythematous macular erythema</li>\n<li><strong>Nail fold changes</strong>&nbsp;with<strong>&nbsp;periungual&nbsp;erythema&nbsp;</strong>with visible dilated capillary loops in the proximal nail fold</li>\n<li><strong>Proximal myopathy</strong></li>\n<li>Poikiloderma atrophicans vasculare</li>\n<li>Calcinosis cutis</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/40c43dd8c3f04527907abf2dadb68bcb.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 35-year-old female patient came with complaints of her hands turning very pale on exposure to cold for one month. She also gives a history of hand pain and swelling for the past 3 months. She informed that her skin felt firm and tight. Her past medical history is positive for GERD and arthritis. Image A shows a particular feature of this patient. On investigation, she was found to have the following immunofluorescence pattern (image B). Identify the wrong statement regarding her condition.",
    "choices": [
      {
        "id": 1,
        "text": "Interstitial lung disease is common in patients with Scl-70 antibodies"
      },
      {
        "id": 2,
        "text": "Telangiectasias and calcinosis are early manifestations"
      },
      {
        "id": 3,
        "text": "Earliest cutaneous manifestations are non\u2010pitting oedema and puffiness"
      },
      {
        "id": 4,
        "text": "Pruritus correlates with severity of cutaneous sclerosis"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario featuring Raynaud's phenomenon, arthritis, GERD, and calcinosis cutis is suggestive of <strong>systemic sclerosis</strong>. <strong>Mat-like telangiectases</strong> on the face and upper trunk and limbs, and <strong>cutaneous calcinosis</strong>, most often on the fingers over joints and at pressure points, develop in the<strong> later stages,&nbsp;</strong>particularly in the <strong>limited systemic</strong> form of systemic sclerosis, or <strong>CREST syndrome.</strong></p>\n<p>Image A is a classical fish mouth appearance (<strong>microstomia</strong>). Image B shows the&nbsp;<strong>nucleolar pattern</strong>&nbsp;of IF(some spots of fluorescence within the nucleus and it represents antibodies to RNA). This is seen in&nbsp;systemic sclerosis.</p>\n<p>The majority of cases are <strong>adult-onset&nbsp;</strong>with&nbsp;<strong>Raynaud's phenomenon</strong> as the<strong> first symptom</strong>.&nbsp;</p>\n<p>The earliest cutaneous manifestations are <strong>non\u2010pitting edema</strong> and<strong> puffiness</strong>, which tend to be seen first in the fingers, hands, and face.&nbsp;The skin becomes taut, indurated, thickened, and then fixed to deeper structures on the fingers resulting in <strong>sclerodactyly</strong>.</p>\n<p><strong>Pruritus</strong> is described in 40% of patients and may be intense during the early or active stages of the disease. It <strong>correlates</strong> with the extent of <strong>skin sclerosis</strong> and<strong> gastrointestinal symptoms</strong>.</p>\n<p><strong>Anti-scl-70</strong> positivity in this disease is useful in predicting those at higher risk for interstitial lung disease.&nbsp;<strong>Anti centromere</strong>&nbsp;antibody is most specific for&nbsp;<strong>CREST</strong>&nbsp;syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/2319d86d3dfb46d187355f07467c85e0.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Which of the following is not a feature of the condition shown below?",
    "choices": [
      {
        "id": 1,
        "text": "Muscle weakness"
      },
      {
        "id": 2,
        "text": "Gastroesophageal reflux disease"
      },
      {
        "id": 3,
        "text": "Loss of sweat glands in distal extremities"
      },
      {
        "id": 4,
        "text": "Female preponderance of 9:1"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>In systemic sclerosis, progressive loss of fingerprints is seen in patients. These altered fingerprint ridges are seen due to&nbsp;changes in skin elasticity,&nbsp; hardness, and thickness&nbsp;and eventually make a patient with scleroderma a &ldquo;fingerprintless person&rdquo;.</p>\n<p>Autoantibody patterns seen in systemic sclerosis:</p>\n<ul>\n<li>Reactivity to autoantibodies such as anticentromere (ACA)&nbsp;is commonly seen in limited skin sclerosis.</li>\n<li>Reactivity to autoantibodies such as antitopoisomerase 1 antibody (<strong>anti\u2010Scl\u201070 or ATA</strong>), and anti\u2010RNA polymerase III antibody (<strong>ARA or RNAP</strong>) is commonly seen in <strong>SSc</strong>.</li>\n</ul>\n<p>&nbsp;</p>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/8f83d459c8b44070b59f6a729b0d1b92.PNG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/25a7fc636f6242d7b9556e59c971b1c6x720x1059.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/72bb07d925094354a4083b45c79558c0x576x384.PNG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e58eaaa5f65d4cd19631189bab0fdea9x576x371.PNG"
    ]
  },
  {
    "text": "The image shows an investigative modality of nail folds. This along with ANA testing helps in the early diagnosis of:",
    "choices": [
      {
        "id": 1,
        "text": "Dermatomyositis"
      },
      {
        "id": 2,
        "text": "Systemic sclerosis"
      },
      {
        "id": 3,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 4,
        "text": "Mixed connective tissue disorder"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given image shows&nbsp;<strong>nail-fold capillaroscopy</strong> findings. The image shows giant capillaries, hemorrhages, and reducing capillary density suggesting an active pattern in&nbsp;<strong>systemic sclerosis</strong>.</p>\n<p>The most important tests for systemic sclerosis are <strong>ANA reactivity</strong> and<strong> nail fold capillaroscopy. </strong>Investigations to exclude or confirm other autoimmune rheumatic diseases including arthritis or other forms of connective tissue disease are also done.&nbsp;</p>\n<p>Nail-fold capillaroscopy is a <strong>non-invasive</strong>, easy, and safe diagnostic technique designed to evaluate the <strong>general architecture of capillary rows</strong> and <strong>fine details</strong> of small vessels of the microcirculation in the nail fold.</p>\n<p>The most important indications for performing capillaroscopy include differential diagnosis of <strong>primary</strong> and<strong> secondary Raynaud's phenomenon</strong>, as well as the&nbsp;assessment of scleroderma spectrum disorders.</p>\n<p>In systemic sclerosis, capillary abnormalities appear and evolve in a clearly defined sequence called the <strong>scleroderma pattern</strong>, which<strong> correlates with internal organ involvement</strong>.</p>\n<p>Nail fold capillaroscopy is also listed as a systemic sclerosis <strong>classification criterion</strong> recognized by the European League Against Rheumatism (<strong>EULAR</strong>).</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/aa382cf36199451299426c91a5057aff.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A woman presented to the medicine OPD with complaints of dysphagia and her fingers turning white and then blue when exposed to cold. On examination, she has telangiectasias on the face and the given findings on her hands. Which of the following statements is correct regarding her condition?",
    "choices": [
      {
        "id": 1,
        "text": "Anti-centromere antibodies are most commonly found"
      },
      {
        "id": 2,
        "text": "Involvement of skin areas proximal to the knees or elbows"
      },
      {
        "id": 3,
        "text": "Rapid onset and progression of disease"
      },
      {
        "id": 4,
        "text": "Short history and less severe form of Raynaud's phenomenon"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p style=\"text-align: justify;\">The history along with the image showing <strong>calcinosis cutis</strong> and <strong>sclerodactyly</strong> are suggestive of <strong>CREST</strong> syndrome.</p>\n<p style=\"text-align: justify;\">In&nbsp;<strong>limited</strong>&nbsp;<strong>cutaneous systemic sclerosis</strong> or CREST syndrome,&nbsp;<strong>anti-centromere antibodies</strong> are the most commonly found antibodies.</p>\n<p>All other options are true for <strong>diffuse</strong>&nbsp;cutaneous systemic sclerosis, not CREST syndrome.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/27f5a3ed75ea4b3cb8fbd161589ef046.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "Identify the false statement regarding morphea.",
    "choices": [
      {
        "id": 1,
        "text": "Plaque morphea is the most common form"
      },
      {
        "id": 2,
        "text": "Absence of sclerodactyly and nail fold capillary changes"
      },
      {
        "id": 3,
        "text": "Antitopoisomerase and anticentromere are usually positive"
      },
      {
        "id": 4,
        "text": "Encoup de Sabre is linear morphea presenting as scarring alopecia"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Autoantibodies such as <strong>ANA, anti-histone, and anti\u2010ssDNA</strong> may be present in <strong>morphea</strong>, but the systemic sclerosis specific autoantibodies such as anti-topoisomerase, anti-centromere and anti\u2010RNA polymerase are rarely found.</p>\n<p>Morphoea, a term used in preference to &lsquo;<strong>localized scleroderma</strong>&rsquo;, encompasses a group of related conditions characterized by varying degrees of <strong>sclerosis, fibrosis, and atrophy</strong> in the skin and subcutaneous tissues.</p>\n<p>It is distinguished from systemic sclerosis by the <strong>absence</strong> of sclerodactyly and nail-fold capillary changes.</p>\n<p>Overall, <strong>plaque morphea</strong>&nbsp;is the <strong>commonest subtype.</strong></p>\n<p>Morphoea en coup de sabre:<strong> Blaschkoid linear induration</strong> affecting the face and scalp, may involve underlying muscle, bone, eye, and the brain.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0ae9dfcfe69e41edac080c63fdef2026x1280x962.2566995768689.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a27b758543224fcb84e47e24b665a82cx1280x1129.2524682651622.JPEG"
    ]
  },
  {
    "text": "A man presented with salt and pepper skin changes on his chest and back and with shortness of breath. A CT revealed fibrotic changes in the lower lobe of both the lungs. What is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Rheumatoid arthritis"
      },
      {
        "id": 2,
        "text": "Systemic lupus erythematosus"
      },
      {
        "id": 3,
        "text": "Dermatomyositis"
      },
      {
        "id": 4,
        "text": "Systemic sclerosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>Salt-and-pepper appearance is characterized by the presence of <strong>patchy hypopigmentation</strong> and<strong> hyperpigmentation</strong> of the skin manifesting as <strong>depigmentation</strong> with<strong> perifollicular pigmentary retention. </strong>This along with lung fibrosis is seen in <strong>systemic sclerosis.</strong></p>\n<p>This appearance may also be seen&nbsp;in areas of repigmentation in lesions of vitiligo.</p>\n<p>The image below shows salt and pepper appearance of skin over the abdomen seen in systemic sclerosis.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/8691e2a4bd894688894107baf1891e92x357x535.PNG"
    ]
  }
];
        let quizName = '21 Connective Tissue Disorders';
        let hierarchy = ["Marrow", "qBank", "Dermatology"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        const urlParams = new URLSearchParams(window.location.search);
        currentQuestionIndex = Math.min(parseInt(urlParams.get('startAt')) || 0, questionsData.length - 1);

        function goBack() {
            if (isQuizCompleted || confirm('Are you sure you want to leave the quiz? Your progress will be lost.')) {
                window.history.back();
            }
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                setTimeout(processAnswer, 300);
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            setTimeout(showSolution, 1500);
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (!window.location.pathname.endsWith('custom_quiz.html')) {
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>