<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Mini Test 7 - Pathology - Brain And Scalpel</title>
    <link rel="preload" href="assets/background.jpg" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js for M3U8 support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        
/* Liquid Glass Morphism Universal Theme - Enhanced & Mobile-First */
:root {
  --glass-bg: rgba(0, 0, 0, 0.6);
  --glass-bg-light: rgba(255, 255, 255, 0.1);
  --glass-bg-medium: rgba(255, 255, 255, 0.15);
  --glass-bg-heavy: rgba(255, 255, 255, 0.2);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-border-light: rgba(255, 255, 255, 0.1);
  --text-primary: rgba(255, 255, 255, 0.95);
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  --accent-blue: #60a5fa;
  --accent-purple: #a855f7;
  --accent-green: #34d399;
  --accent-orange: #fb923c;
  --accent-red: #f87171;
  --accent-yellow: #fbbf24;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
  background-color: #000;
}

/* iOS Background Fix */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  z-index: -2;
  background: url("assets/background.jpg") center center / cover no-repeat;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: -1;
}

/* Glass morphism components */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-light {
  background: var(--glass-bg-light);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border-light);
  border-radius: 12px;
}

.glass-medium {
  background: var(--glass-bg-medium);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
}

.glass-heavy {
  background: var(--glass-bg-heavy);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
}

.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-card:hover {
  transform: translateY(-8px);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.glass-button {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(168, 85, 247, 0.8));
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: white;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
  cursor: pointer;
  border: none;
}

.glass-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(96, 165, 250, 0.4);
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(168, 85, 247, 0.9));
}

.glass-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.glass-input {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.glass-input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

.glass-input::placeholder {
  color: var(--text-tertiary);
}

/* Performance analysis styles */
.performance-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.score-circle {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto;
}

.score-circle svg {
  transform: rotate(-90deg);
}

.score-circle .circle-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.1);
  stroke-width: 8;
}

.score-circle .circle-progress {
  fill: none;
  stroke-width: 8;
  stroke-linecap: round;
  transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
}

.score-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Review question styles */
.review-question {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

.review-question.correct {
  border-left: 4px solid #22c55e;
}

.review-question.incorrect {
  border-left: 4px solid #ef4444;
}

.review-question.not-attempted {
  border-left: 4px solid #6b7280;
}

/* Gradient backgrounds for accents */
.gradient-blue {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
}

.gradient-purple {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
}

.gradient-green {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
}

.gradient-orange {
  background: linear-gradient(135deg, var(--accent-orange), #f97316);
}

.gradient-red {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
}

.gradient-yellow {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
}

/* Navigation button styles */
.nav-btn-not-attempted {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.nav-btn-current {
  background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.nav-btn-correct {
  background: linear-gradient(135deg, var(--accent-green), #10b981);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-incorrect {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-bookmarked {
  background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-marked-review {
  background: linear-gradient(135deg, var(--accent-purple), #8b5cf6);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.nav-btn-answered {
  background: linear-gradient(135deg, #6b7280, #4b5563);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

/* Option button styles - REVISED FOR INLINE FEEDBACK */
.option-button {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
  text-align: left;
  padding: 1rem;
  border-radius: 12px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 1rem;
}

.option-button:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(96, 165, 250, 0.5);
  transform: translateX(8px);
}

.option-button.selected {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.3));
  border-color: var(--accent-blue);
  transform: translateX(8px);
}

#optionsContainer.answered .option-button:hover {
    transform: translateX(0); /* Disable hover effect after answering */
}

#optionsContainer.answered .option-button {
    cursor: not-allowed;
    pointer-events: none;
}

#optionsContainer.answered .option-button:not(.correct):not(.incorrect) {
    opacity: 0.5;
}

.option-button.correct {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    color: white;
    transform: translateX(0);
}

.option-button.incorrect {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: white;
    transform: translateX(0);
}

.option-letter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: var(--text-primary);
  flex-shrink: 0;
}

.option-button.selected .option-letter {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: white;
}

.option-button.correct .option-letter, .option-button.incorrect .option-letter {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.option-text {
  flex: 1;
  font-size: 1rem;
  line-height: 1.5;
}

/* Stats bar responsive grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 1rem;
  align-items: center;
  justify-items: center;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
  }
 
  .stats-grid > div:nth-child(4),
  .stats-grid > div:nth-child(5) {
    grid-column: span 1;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
 
  .stats-grid > div:last-child {
    grid-column: span 2;
    justify-self: center;
  }
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
  50% { box-shadow: 0 0 40px rgba(96, 165, 250, 0.6); }
}

@keyframes checkmark {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

@keyframes cross {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(0.8) rotate(90deg); }
  100% { transform: scale(1) rotate(180deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-checkmark {
  animation: checkmark 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-cross {
  animation: cross 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- MOBILE RESPONSIVE STYLES --- */
.quiz-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

#mobile-nav-toggle {
    display: none; /* Hidden on desktop */
}

@media (min-width: 1024px) {
    .quiz-container {
        flex-direction: row;
        gap: 2rem;
    }
}

@media (max-width: 1023px) {
    .quiz-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 10px 0px 30px rgba(0,0,0,0.5);
    }
    .quiz-sidebar.open {
        transform: translateX(0);
    }
    #mobile-nav-toggle {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 50;
    }
    .quiz-main-content {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .glass-card, .glass {
        border-radius: 16px;
    }
    h1 { font-size: 2.5rem; }
    #questionText { font-size: 1.125rem; }
    .controls-container {
        flex-direction: column;
        gap: 1rem;
    }
    .controls-container button {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <!-- Mode Selection Modal -->
    <div id="modeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Choose Study Mode</h2>
            
            <div class="space-y-4">
                <button onclick="selectMode('study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Study Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Interactive learning with immediate feedback</p>
                        </div>
                        <div class="gradient-blue w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('test')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Test Mode</h3>
                            <p class="text-sm text-white text-opacity-70">Practice test with performance analysis at end</p>
                        </div>
                        <div class="gradient-purple w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_study')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Study</h3>
                            <p class="text-sm text-white text-opacity-70">Study with time pressure and immediate feedback</p>
                        </div>
                        <div class="gradient-green w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectMode('timed_exam')" class="w-full text-left p-4 glass-light hover:bg-white hover:bg-opacity-10 transition-all duration-300 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Timed Exam</h3>
                            <p class="text-sm text-white text-opacity-70">Real exam simulation with strict timing</p>
                        </div>
                        <div class="gradient-red w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance Analysis Modal -->
    <div id="performanceModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-heavy p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">Performance Analysis</h2>
                <button onclick="closePerformanceModal()" class="glass-light p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Score Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="performance-card p-6 text-center">
                    <div class="score-circle mb-4">
                        <svg width="150" height="150" class="mx-auto">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle id="scoreCircle" class="circle-progress" cx="75" cy="75" r="65" stroke="#22c55e" stroke-dasharray="0 408"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="text-3xl font-bold text-white" id="accuracyScore">0%</div>
                            <div class="text-sm text-white text-opacity-70">Accuracy</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Results Summary</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Questions:</span>
                            <span class="text-white font-semibold" id="totalQuestionsResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-green-400">Correct:</span>
                            <span class="text-green-400 font-semibold" id="correctResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-red-400">Incorrect:</span>
                            <span class="text-red-400 font-semibold" id="incorrectResult">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Not Attempted:</span>
                            <span class="text-gray-400 font-semibold" id="notAttemptedResult">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Time Analysis</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Total Time:</span>
                            <span class="text-white font-semibold" id="totalTimeResult">0:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white text-opacity-70">Avg per Question:</span>
                            <span class="text-white font-semibold" id="avgTimeResult">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="reviewQuestions()" class="glass-button px-8 py-3 text-lg">
                    Review All Questions
                </button>
                <button onclick="retakeQuiz()" class="glass-light px-8 py-3 text-lg text-white hover:bg-white hover:bg-opacity-20">
                    Retake Quiz
                </button>
            </div>
            
            <!-- Question Review Section -->
            <div id="questionReviewSection" class="hidden">
                <h3 class="text-2xl font-bold text-white mb-6">Question Review</h3>
                <div id="reviewQuestionsContainer">
                    <!-- Review questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40 mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="glass-light px-4 py-2 text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Back
                    </button>
                    <div id="quizHierarchy" class="text-sm text-white text-opacity-60">
                        Marrow / NEET PG Mini Test Series / 2024-25
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="glass-light px-3 py-1 text-sm text-white">
                        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
                    </div>
                    
                    <!-- Timer -->
                    <div id="timerContainer" class="hidden gradient-red px-3 py-1 text-sm text-white font-bold animate-pulse-glow">
                        <span id="timeDisplay">2:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full h-1 bg-black bg-opacity-30 mb-6">
        <div id="progressBar" class="h-1 gradient-blue transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <!-- Stats Bar - Show only in study modes -->
    <div id="statsBar" class="glass-light mb-8">
        <div class="container mx-auto px-6 py-4">
            <div class="stats-grid">
                <div class="text-center">
                    <div class="text-lg font-bold text-green-400" id="correctCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Correct</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-red-400" id="incorrectCount">0</div>
                    <div class="text-xs text-white text-opacity-60">Incorrect</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-blue-400" id="totalAttempted">0</div>
                    <div class="text-xs text-white text-opacity-60">Attempted</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-purple-400" id="accuracy">0%</div>
                    <div class="text-xs text-white text-opacity-60">Accuracy</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-orange-400" id="timeSpent">0:00</div>
                    <div class="text-xs text-white text-opacity-60">Time</div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-container container mx-auto px-6">
        <!-- Question Navigation Sidebar -->
        <div id="quizSidebar" class="quiz-sidebar glass p-6 h-fit lg:sticky top-24">
            <h3 class="text-lg font-bold text-white mb-4">Question Navigator</h3>
            <div id="questionNav" class="grid grid-cols-5 gap-2 mb-6">
                <!-- Question numbers will be populated here -->
            </div>
            
            <div class="space-y-3 text-xs">
                <h4 class="text-sm font-medium text-white text-opacity-80 mb-3">Legend</h4>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-not-attempted rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Not Attempted</span>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-current rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Current</span>
                </div>
                <div id="studyModeLegend" class="space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-correct rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Correct</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-incorrect rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Incorrect</span>
                    </div>
                </div>
                <div id="testModeLegend" class="hidden space-y-2">
                    <div class="flex items-center">
                        <div class="w-6 h-6 nav-btn-answered rounded mr-2"></div>
                        <span class="text-white text-opacity-60">Answered</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-6 h-6 nav-btn-bookmarked rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Bookmarked</span>
                </div>
                <div id="testModeReviewLegend" class="hidden items-center">
                    <div class="w-6 h-6 nav-btn-marked-review rounded mr-2"></div>
                    <span class="text-white text-opacity-60">Marked for Review</span>
                </div>
            </div>
            
            <!-- Submit Quiz Button for test modes -->
            <div id="submitSection" class="hidden mt-6">
                <button onclick="submitQuiz()" class="glass-button w-full py-3 text-lg font-bold">
                    Submit Quiz
                </button>
            </div>
        </div>

        <!-- Main Quiz Interface -->
        <div class="quiz-main-content flex-1 max-w-4xl">
            <div class="glass-card p-4 md:p-8 lg:p-12 mb-8 relative">
                <!-- Question Text -->
                <div id="questionText" class="text-xl lg:text-2xl leading-relaxed text-white mb-8">
                    Loading question...
                </div>

                <!-- Question Media -->
                <div id="questionMedia" class="mb-8"></div>

                <!-- Options -->
                <div id="optionsContainer" class="space-y-3 mb-8">
                    <!-- Options will be inserted here -->
                </div>

                <!-- Solution Display (only for study modes) -->
                <div id="solutionContainer" class="hidden glass-light p-6 border-l-4 border-green-400">
                    <h3 class="text-lg font-bold text-green-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Explanation
                    </h3>
                    <div id="solutionText" class="text-white text-opacity-90 leading-relaxed mb-4"></div>
                    <div id="solutionAudio" class="space-y-2 mt-4"></div>
                    <div id="solutionImages" class="space-y-4 mt-4"></div>
                    <div id="solutionVideo" class="hidden mt-4">
                        <video id="explanationVideoPlayer" class="w-full rounded-lg" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-container flex justify-between items-center mb-8">
                <button onclick="previousQuestion()" id="prevBtn" class="glass-button px-6 py-3 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Previous
                </button>
                
                <div class="flex justify-center flex-grow">
                    <button onclick="toggleBookmark()" id="bookmarkBtn" class="glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" id="bookmarkIcon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path>
                        </svg>
                        <span id="bookmarkText">Bookmark</span>
                    </button>
                    
                    <button onclick="toggleMarkForReview()" id="markReviewBtn" class="hidden glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4z" clip-rule="evenodd" />
                           <path d="M12.586 6.586a2 2 0 10-2.828 2.828l-3 3a2 2 0 102.828-2.828l3-3z" />
                        </svg>
                        <span id="markReviewText">Mark for Review</span>
                    </button>
                </div>
                
                <button onclick="nextQuestion()" class="glass-button px-6 py-3 flex items-center justify-center">
                    Next
                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

     <!-- Mobile Nav Toggle -->
    <button id="mobile-nav-toggle" onclick="toggleSidebar()" class="glass-button w-14 h-14 rounded-full items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>


    <script>
        let questionsData = [
  {
    "text": "The autopsy of a 60-year-old man who died of a respiratory illness revealed the following findings on the pleura. What was the most likely occupation of this man?",
    "choices": [
      {
        "id": 1,
        "text": "Insulation industry"
      },
      {
        "id": 2,
        "text": "Coal mining"
      },
      {
        "id": 3,
        "text": "Sandblasting"
      },
      {
        "id": 4,
        "text": "Sugar cane factory"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given&nbsp;clinical scenario and the image showing pleural plaques are suggestive of <strong>asbestosis</strong>. Asbestosis develops due to&nbsp;<strong>prolonged inhalation of asbestos, </strong>which is common in the<strong> insulation industry.&nbsp;</strong></p>\n<p>Pleural plaques are the most common manifestation of asbestos exposure. They are well-circumscribed plaques of dense collagen, often containing calcium. They develop most frequently on the<strong>&nbsp;parietal pleura</strong> and over the<strong> domes </strong>of the<strong> diaphragm</strong>.&nbsp;They do not contain asbestos bodies, and only rarely occur in persons without prior asbestos exposure.</p>\n<div class=\"page\" title=\"Page 697\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Asbestos occurs in two distinct forms - <strong>s</strong><strong>erpentine chrysotile</strong>&nbsp;(more common) and&nbsp;<strong>amphibole</strong>&nbsp;(more pathogenic). Exposure may result in the following conditions:</p>\n</div>\n</div>\n</div>\n</div>\n<ul>\n<li>Localized fibrous&nbsp;plaques&nbsp;or, rarely, diffuse pleural fibrosis</li>\n<li><strong>Pleural effusions</strong></li>\n<li>Parenchymal&nbsp;<strong>interstitial fibrosis</strong>&nbsp;(asbestosis)</li>\n<li><strong>Lung carcinoma</strong></li>\n<li><strong>Mesotheliomas</strong></li>\n<li>Extrapulmonary neoplasms including laryngeal, ovarian, and colon carcinomas</li>\n</ul>\n<p>The image below shows fibrous pleural plaques seen on the diaphragmatic pleural surface in asbestosis.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/97acf1d1ac0641f0ae97bcfae7043b9c.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/cb3c2adac5f146e8a31fd87d3b9e240dx800x537.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e575a4b05e654058961f725d9da6fa51x1280x859.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/db43e6d9b088403b8e7dc0b754c8722cx1279x856.JPEG"
    ]
  },
  {
    "text": "A 20-year-old woman presents with complaints of yellowish discoloration of the skin for 1 week and severe fatigue. On examination, you notice her to have tachycardia, pallor, icterus, and splenomegaly. Her investigation reports are shown below. What is the underlying mechanism for this presentation?",
    "choices": [
      {
        "id": 1,
        "text": "Type I hypersensitivity reaction"
      },
      {
        "id": 2,
        "text": "Type II hypersensitivity reaction"
      },
      {
        "id": 3,
        "text": "Type III hypersensitivity reaction"
      },
      {
        "id": 4,
        "text": "Type IV hypersensitivity reaction"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical presentation indicates hemolysis and a<strong> positive Coomb's test</strong> suggests <strong>autoimmune hemolytic anemia.</strong> The underlying mechanism of this condition is <strong>type II hypersensitivity reaction.</strong></p>\n<p>Since in autoimmune hemolytic anemia, antibodies recognize red cells and cause their premature destruction via<strong> opsonization</strong>, it is a type II hypersensitivity reaction.</p>\n<p>Elevated LDH indicates hemolysis and a positive Coomb's test is indicative of autoimmune hemolytic anemia. The presentation is usually dramatic with abrupt onset anemia, jaundice, and splenomegaly.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An elderly man presented with language deficits, loss of mathematical skills and motor skills. His family reports that his symptoms began many years ago with forgetfulness and memory disturbances. He is now apathetic, withdrawn, agitated, and is prone to wandering. Which of the following is not seen in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Cortical atrophy"
      },
      {
        "id": 2,
        "text": "Spongiform cerebral cortex"
      },
      {
        "id": 3,
        "text": "Neurofibrillary tangles"
      },
      {
        "id": 4,
        "text": "A\u03b2 amyloid deposition"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical scenario of an elderly male with <strong>forgetfulness</strong>, <strong>memory</strong> disturbances, <strong>language</strong> deficits, loss of&nbsp;<strong>mathematical</strong> skills and <strong>motor</strong> skills, apathy, withdrawal, agitation, and <strong>wandering</strong> is likely to have <strong>Alzheimer's disease</strong>. Spongiform transformation of the cerebral cortex is seen in Creutzfeldt-Jakob disease.&nbsp;</p>\n<p>Alzheimer's disease is the <strong>most common</strong> cause of <strong>dementia</strong> in the <strong>elderly</strong>. Its incidence increases with age. It has an <strong>insidious</strong> onset with deficits developing over the course of 5-10 years. Initially, the patient presents with <strong>forgetfulness</strong> but then progresses to language deficits, loss of&nbsp;mathematical skills, and motor skills. In the end stages, the patient becomes mute, incontinent, unable to walk. They usually develop <strong>pneumonia</strong>.&nbsp;</p>\n<p>The pathogenesis of Alzheimer's disease involves the accumulation of&nbsp;<strong>A&beta; amyloid </strong>and<strong> tau</strong> in the brain. The hallmarks of this condition are <strong>amyloid plaques</strong> comprised of aggregated&nbsp;A&beta; amyloid and <strong>neurofibrillary tangles</strong>. Neurofibrillary <strong>tangles</strong> are the <strong>cytoplasmic</strong> accumulation of <strong>tau</strong> filaments. Neuritic plaques are focal collections of axonal or dendritic processes around a central <strong>amyloid core</strong>. In pyramidal neurons, they appear as <strong>flame-shaped</strong>. These lesions lead to <strong>neuronal</strong> death.&nbsp;</p>\n<p>On gross examination, the brain shows <strong>cortical atrophy</strong> which can be seen with gyral narrowing and sulcal widening in the frontal, temporal, and parietal lobes. This will lead to compensatory enlargement of the ventricles.&nbsp;</p>\n<p>The following image shows the neurofibrillary tangles seen in Alzheimer's disease.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e2431742a8824843ab5f60507f46da33x1280x945.JPEG"
    ]
  },
  {
    "text": "A 58-year-old woman, previously diagnosed with breast cancer, is now found to have endometrial cancer. Genetic testing revealed a mutation in the PTEN gene. What other condition is she at increased risk of developing?",
    "choices": [
      {
        "id": 1,
        "text": "Hepatocellular carcinoma"
      },
      {
        "id": 2,
        "text": "Ovarian carcinoma"
      },
      {
        "id": 3,
        "text": "Colorectal carcinoma"
      },
      {
        "id": 4,
        "text": "Thyroid carcinoma"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>A patient with a <strong>PTEN germline mutation</strong> with history of <strong>breast carcinoma</strong>, now diagnosed with <strong>endometrial carcinoma</strong> is at high risk of developing <strong>thyroid carcinoma\u00a0</strong>concerning <strong>cowden syndrome.</strong></p>\n<p><strong>Cowden syndrome</strong>\u00a0is an <strong>autosomal dominant</strong>\u00a0disorder associated with<strong> pTEN germline mutations</strong> and marked by:</p>\n<ul>\n<li><strong>Hamartomatous growths</strong>\u00a0of the skin and mucus membranes- buccal, intestinal, and colonic</li>\n<li><strong>Increased incidence </strong>of<strong> epithelial cancers</strong> particularly of the <strong>breast</strong>, <strong>endometrium</strong>, and <strong>thyroid\u00a0</strong></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 32-year-old woman presents with lower abdominal pain, which is worse during menstruation. Laparoscopic examination of the pelvis demonstrates multiple small brown spots on the surface of pelvic structures and extensive fibrous adhesions between tubes, ovaries, and other structures. A biopsy is done and microscopy is as shown below. Which of the following is the most likely diagnosis?",
    "choices": [
      {
        "id": 1,
        "text": "Adenomyosis"
      },
      {
        "id": 2,
        "text": "Chronic endometritis"
      },
      {
        "id": 3,
        "text": "Endometriosis"
      },
      {
        "id": 4,
        "text": "Metastatic endometrial cancer"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>Microscopy shows <strong>glands resembling endometrial glands surrounded by endometrial stroma</strong> in the ovary. The most likely diagnosis is <strong>endometriosis.</strong>&nbsp;</p>\n<p>Endometriosis is defined by the <strong>presence of ectopic endometrial tissue </strong>at a site <strong>outside of the uterus. </strong>Includes both endometrial glands and stroma, but may consist only of stroma in some cases<strong>.&nbsp;</strong></p>\n<p>It occurs in the following sites, in descending order of frequency</p>\n<ul>\n<li>Ovaries</li>\n<li>Uterine ligaments</li>\n<li>Rectovaginal septum</li>\n<li>Cul de sac</li>\n<li>Pelvic peritoneum</li>\n<li>Large and small bowel and appendix</li>\n<li>Mucosa of the cervix, vagina, and fallopian tubes</li>\n<li>Laparotomy scars.</li>\n</ul>\n<p>It is principally a disease of women in active reproductive life, most often in the third and fourth decades. It causes infertility, dysmenorrhea (painful menstruation), pelvic pain, and other problems.&nbsp;<strong>Endometriotic lesions bleed </strong>periodically in response to both extrinsic cyclic (ovarian) and intrinsic hormonal stimulation.</p>\n<p>The diagnosis is readily made when both endometrial glands and stroma are present with or without the presence of hemosiderin. In rare cases, only the stroma is identified.</p>\n<p><strong>Atypical endometriosis, </strong>the likely precursor to endometriosis-related ovarian carcinoma, has two morphologic appearances. One consists of cytologic atypia of the epithelium lining the endometriotic cyst without major architectural changes. The second is marked by glandular crowding due to excessive epithelial proliferation, often associated with cytologic atypia, producing an appearance that resembles complex atypical endometrial hyperplasia.</p>\n<p>Other options</p>\n<p>Option A- Adenomyosis is characterized by foci of the endometrium deep in the myometrium.</p>\n<p>Option B- Chronic endometritis is a chronic inflammation of the endometrium.</p>\n<p>Option C- Metastatic endometrial carcinoma would be characterized by abnormal glands and cytologic atypia.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/655afe45457542b09b39a9e7bd0679a4.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 25-year-old man developed nausea and jaundice over the past week. Laboratory investigations revealed an active hepatitis B infection. Which of the following liver pathology findings is depicted in the slide below?",
    "choices": [
      {
        "id": 1,
        "text": "Granuloma formation"
      },
      {
        "id": 2,
        "text": "Abscess formation"
      },
      {
        "id": 3,
        "text": "Coagulative necrosis"
      },
      {
        "id": 4,
        "text": "Apoptosis"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The above histopathological image shows <strong>Councilman's bodies&nbsp;</strong>and they represent <strong>apoptosis</strong>.</p>\n<p>Councilman's bodies are <strong>acidophilic</strong> bodies, which represent hepatocytes undergoing apoptosis. They&nbsp;are mainly seen in <strong>acute viral hepatitis</strong>.</p>\n<p><strong>Apoptosis</strong> is a pathway of cell death that is induced by a closely regulated suicide program in which the cells destined to die activate intrinsic enzymes that degrade the cells' nuclear and cytoplasmic proteins.&nbsp;</p>\n<p><strong>Mechanism of apoptosis:&nbsp;</strong>There are two distinct pathways that can lead to caspase activation and cause apoptosis of the cell.</p>\n<ul>\n<li>The mitochondrial or intrinsic pathway</li>\n<li>The death receptor or extrinsic pathway</li>\n</ul>\n<p><strong>The mitochondrial (intrinsic) pathway of apoptosis:</strong></p>\n<ul>\n<li>There are several proteins in the mitochondria that can induce apoptosis. These include&nbsp;<strong>cytochrome c</strong>&nbsp;and some proteins that neutralize the endogenous inhibitors of apoptosis.</li>\n<li>The permeability of the mitochondria is controlled by a family of proteins called the BCL-2 family, which act as sensors.</li>\n<li>These sensors are activated when the cells are deprived of growth factors and other survival signals, are exposed to agents that damage the DNA, or accumulate a large number of misfolded proteins.</li>\n<li>These activated sensors,&nbsp;in turn, activate the&nbsp;<strong>proapoptotic molecules</strong>&nbsp;like&nbsp;<strong>BAX</strong>&nbsp;and&nbsp;<strong>BAK</strong>, which form channels in the mitochondrial membrane, through which cytochrome c and other mitochondrial proteins escape into the cytosol and cause activation of&nbsp;<strong>caspase-9</strong>, which, in turn, leads to the activation of the caspase cascade and, eventually, apoptosis of the cell.</li>\n<li>On the other hand, if all the growth factors and other survival signals are present, then they produce more&nbsp;<strong>antiapoptotic</strong>&nbsp;<strong>members</strong>&nbsp;of the BH1-4 family like the&nbsp;<strong>BCL2, MCL 1</strong>,&nbsp;and&nbsp;<strong>BCL</strong>-<strong>XL</strong>. These proteins limit the escape of proapoptotic mitochondrial proteins.</li>\n</ul>\n<p><strong>The death-receptor (extrinsic) pathway of apoptosis:</strong></p>\n<ul>\n<li>Death receptors are surface molecules that are members of the<strong>&nbsp;tumor necrosis factor (TNF) receptor family,</strong>&nbsp;like <strong>TNF 1</strong>&nbsp;and&nbsp;<strong>Fas (CD 95).</strong></li>\n<li>These receptors are expressed on the surface of many cells and can trigger apoptosis. In the cytoplasmic region, these receptors have a &ldquo;death domain.&rdquo;</li>\n<li><strong>Fas ligand (FasL)</strong>&nbsp;is a membrane protein expressed mainly on activated T-lymphocytes. Fas-FasL interactions are required for thymic medullary negative selection. Defective interactions also cause the autoimmune lymphoproliferative syndrome.&nbsp;</li>\n<li>When these T-cells recognize Fas-expressing targets, Fas molecules are cross-linked by FasL and bind adaptor proteins via the death domain.</li>\n<li>These,&nbsp;in turn, recruit and activate&nbsp;<strong>caspase-8 and -10</strong>.</li>\n<li>In many cell types, caspase-8 and -10 may cleave and activate a pro-apoptotic member of the Bcl-2 family called&nbsp;<strong>Bid</strong>, thus feeding into the mitochondrial pathway.</li>\n<li>The combined activation of both pathways delivers a lethal blow to the cell.</li>\n<li>Cellular proteins, notably, a caspase antagonist called&nbsp;<strong>FLIP</strong>, block the activation of caspases downstream of the death receptors. Interestingly, some viruses produce homologues of FLIP, and it is suggested that this is a mechanism that viruses use to keep infected cells alive.</li>\n<li>The death receptor pathway is involved in the&nbsp;elimination of self-reactive lymphocytes and in the killing of target cells by some cytotoxic T-lymphocytes.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f78b37c3b38f4a478226c6278b94a572.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old lady presents with fever, oral ulcers, photosensitivity, and a rash on her face, as seen below. Anti-dsDNA and anti-Smith antibodies are positive. Which of the following is deficient in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "C1 inhibitor"
      },
      {
        "id": 2,
        "text": "C1, C2, C4"
      },
      {
        "id": 3,
        "text": "C5 to C8"
      },
      {
        "id": 4,
        "text": "C3b and its regulatory protein"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The diagnosis based on the given clinical scenario and image is <strong>systemic lupus erythematosus </strong>(SLE).&nbsp;<strong>C1, C2,</strong>&nbsp;and<strong>&nbsp;C4&nbsp;</strong>complements are&nbsp;deficient in SLE patients.</p>\n<p>The rash seen in the image is a <strong>malar rash</strong> (classically seen in SLE); it is characterized by a well-demarcated erythematous butterfly rash over the malar eminences, with <strong>sparing of the nasolabial folds</strong>.&nbsp;Anti-dsDNA and anti-Smith antibodies are specific for SLE.</p>\n<p>Clinical syndromes associated with genetic deficiencies of various complement components:</p>\n<ul>\n<li><strong>C1 inhibitor deficiency</strong> - <strong>Hereditary angioedema</strong></li>\n<li><strong>C1, C2, C4 deficiency</strong> - <strong>SLE</strong> and other collagen vascular disorders</li>\n<li>C5-C8 deficiency - Toxoplasmosis, bacteremia with gram-negative diplococci&nbsp;</li>\n<li>C3 and its regulatory protein or C3b inactivator&nbsp;deficiency&nbsp;-&nbsp;Severe recurrent pyogenic infections</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/f34a191781aa400d9231df99faf71b2a.PNG"
    ],
    "explanation_images": []
  },
  {
    "text": "You perform an autopsy of a 25-year-old male who suffered a sudden cardiac death and notice the chambers of the heart to be enlarged. You suspect the cause of death to be dilated cardiomyopathy. What can be a likely cause of this condition?",
    "choices": [
      {
        "id": 1,
        "text": "i, iii, iv and v"
      },
      {
        "id": 2,
        "text": "i and v"
      },
      {
        "id": 3,
        "text": "i, ii , iv and v"
      },
      {
        "id": 4,
        "text": "i, ii , iii and iv"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p><strong>Titin mutation</strong>, <strong>dystrophin mutation</strong>, <strong>hemochromatosis</strong> and <strong>alcohol intoxication</strong> can all lead to the development of <strong>dilated cardiomyopathy</strong> and thus are a likely cause of this condition- option (c) is the correct answer.</p>\n<p>Mutation of myosin binding protein C is the most common cause of hypertrophic cardiomyopathy not dilated cardiomyopathy thus is not a likely cause of this condition.\u00a0</p>\n<p><strong>Causes of Dilated cardiomyopathy</strong></p>\n<ol>\n<li style=\"list-style-type: none;\">\n<ol>\n<li>Familial (50%)- mutation of genes encoding proteins of cytoskeleton, sarcolemma and nuclear envelope<br />\n<ol>\n<li>TTN gene mutation encoding titin protein</li>\n<li>Dystrophin gene mutation - associated with skeletal myopathies ( Duchenne muscular dystrophy etc)</li>\n</ol>\n</li>\n<li>Alcohol intake<br />\n<ol>\n<li>Ethanol toxicity</li>\n<li>Chronic intake -&gt; thiamine deficiency -&gt; beriberi heart disease ( dilated cardiomyopathy)</li>\n</ol>\n</li>\n<li>Iron overload<br />\n<ol>\n<li>Hemochromatosis</li>\n<li>Multiple blood transfusions</li>\n</ol>\n</li>\n<li>Viral myocarditis</li>\n<li>Peripartum cardiomyopathy</li>\n<li>Cobalt toxicity</li>\n</ol>\n</li>\n</ol>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "An 82-year-old male patient dies of severe congestive heart failure. An autopsy was done, which revealed the following appearance of the aortic valve. Blood investigations done before death revealed normal levels of serum sodium, potassium, calcium, and chloride. Which of the following pathological processes is likely to have resulted in the appearance of the aortic valve as shown in the image?",
    "choices": [
      {
        "id": 1,
        "text": "Amyloidosis"
      },
      {
        "id": 2,
        "text": "Monckeberg medial sclerosis"
      },
      {
        "id": 3,
        "text": "Dystrophic calcification"
      },
      {
        "id": 4,
        "text": "Metastatic calcification"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The image shows extensive <strong>calcification </strong>of the <strong>aortic valve</strong> resulting in stenosis. Calcification of the valve, in an elderly patient, with <strong>normal serum calcium levels,</strong>&nbsp;occurs due to <strong>dystrophic</strong> <strong>calcification</strong>.</p>\n<p>When the deposition of calcium occurs in dead or dying tissues, it is called&nbsp;<strong>dystrophic calcification</strong>. This occurs in the absence of derangements in calcium metabolism, i.e. the calcium levels are <strong>normal</strong>. Dystrophic calcification is seen in areas of necrosis of any type including coagulative, caseous, or liquefactive, and in foci of enzymatic fat necrosis.</p>\n<p>Some examples include <strong>atheromas</strong> of advanced atherosclerosis and areas of caseous necrosis in <strong>tuberculosis.</strong> It also commonly develops in <strong>aging</strong> or <strong>damaged heart valves.</strong></p>\n<p>Other options:</p>\n<p>Option A - <strong>Cardiac amyloidosis</strong> may occur secondary to systemic amyloidosis or as a result of aging (senile amyloidosis). It is associated with the deposition of hyaline, eosinophilic amyloid, in the conduction tissue, interstitium, and coronary vessels. These deposits may be seen on <strong>Congo red</strong> staining.</p>\n<p>Option B -&nbsp;<strong>Monckeberg medial sclerosis&nbsp;</strong>is a vascular pathology of aging characterized by&nbsp;<strong>calcifications</strong>&nbsp;accumulating in the medial layers of muscular arteries. Since there is no vascular compromise (no luminal narrowing), it is usually an accidental finding.</p>\n<p>Option D -<strong> Metastatic calcification</strong> occurs in normal tissues, in the presence of <strong>hypercalcemia.&nbsp;</strong>It is usually a consequence of excessive parathyroid hormone.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/d7cab5e29dd0483e976ab090a144bb03.JPEG"
    ],
    "explanation_images": []
  },
  {
    "text": "A 30-year-old male patient presents with a chronic history of heartburn. An upper GI endoscopy was done, and a biopsy from a suspicious lesion showed the following picture. Identify the condition and the special stain used to confirm the diagnosis.",
    "choices": [
      {
        "id": 1,
        "text": "H. pylori infection, silver stain"
      },
      {
        "id": 2,
        "text": "Adenocarcinoma esophagus, mucin stain"
      },
      {
        "id": 3,
        "text": "Barrett's esophagus, mucin stain"
      },
      {
        "id": 4,
        "text": "Squamous cell carcinoma, keratin stain"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The patient's symptoms and histology findings are suggestive of <strong>Barrett's esophagus</strong>, and <strong>mucin stain (Alcian blue) </strong>is used&nbsp;to identify <strong>goblet cells,</strong>&nbsp;which are indicative of the intestinal metaplasia occurring in the condition.</p>\n<div class=\"page\" title=\"Page 764\">\n<div class=\"section\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p>Barrett's esophagus is a type of metaplasia at the gastro-esophagal junction due to chronic gastroesophageal reflux disease (GERD). The <strong>squamous</strong> esophageal mucosa is converted to a<strong> columnal/intestinal</strong> type that is better suited to handle acid reflux. It is associated with an increased risk of esophageal adenocarcinoma.</p>\n<p>Grossly it appears as tongues of red, velvety mucosa extending upward from the gastroesophageal junction. This metaplastic mucosa alternates with residual smooth, pale squamous (esophageal) mucosa. <strong>Goblet cells</strong> are diagnostic of Barrett's esophagus and have distinct mucous vacuoles that stain pale blue and impart the shape of a wine goblet to the remaining cytoplasm.</p>\n<p><strong>Alcian blue staining</strong> of&nbsp;<strong>mucin </strong>in&nbsp;Barrett's mucosa is shown in the image given below:</p>\n</div>\n</div>\n</div>\n</div>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/990e7500202a4091b0aabd34e20defce.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/50b32812adb24f638f4cac6ad333de58x719x512.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/af9bbb920d3d4141ba3fadbe0e9598d6x720x480.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/b81da320fb45475d856ba92c85fd08e7x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6ec5656608464f739ec949ff551ae7acx1280x1131.JPEG"
    ]
  },
  {
    "text": "A 45-year-old man presents with oliguria, haematuria, and pedal edema over the past 3 days. He complains that his symptoms worsened rapidly. On examination, he has a BP of 190/140 mmHg. Blood workup shows elevated serum creatinine and blood urea. Histological studies show crescents in the glomeruli as seen in the image below. Which of the following type of nephritis does the clinical scenario suggest?",
    "choices": [
      {
        "id": 1,
        "text": "Rapidly progressive glomerulonephritis"
      },
      {
        "id": 2,
        "text": "Minimal change disease"
      },
      {
        "id": 3,
        "text": "Focal segmental glomerulosclerosis"
      },
      {
        "id": 4,
        "text": "Membranoproliferative glomerulonephritis"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The rapidly worsening symptoms and the histologic picture are suggestive of <strong>rapidly progressive glomerulonephritis</strong>&nbsp;(RPGN) also known as <strong>crescentic glomerulonephritis</strong>.&nbsp;</p>\n<p>It is a syndrome associated with severe glomerular injury with necrosis and the formation of crescents. The&nbsp;disease progresses rapidly and leads to renal failure in weeks to months when not treated. In&nbsp;the majority of the cases, RPGN is&nbsp;immune-mediated.&nbsp;In pauci-immune type of RPGN, circulating&nbsp;<strong>anti-neutrophil cytoplasmic antibodies</strong> (ANCAs) are detected in most cases.&nbsp;Serum analyses for anti-GBM antibodies, antinuclear antibodies, and ANCAs are helpful in the diagnosis of specific subtypes.</p>\n<p>Other options:</p>\n<p>Option B:<strong>&nbsp;Minimal change disease</strong> - presence of difuse <strong>effacement </strong>of<strong> podocytes</strong> (epithelial cell foot process) which is characteristic. It is one of the common causes of <strong>nephrotic syndrome</strong>. However, this glomerular abnormality can only be detected using electron microscopy and appear normal by light microscopy.&nbsp;</p>\n<p>Option C:&nbsp;<strong>Focal segmental glomerulosclerosis</strong> - presence of <strong>focal </strong>and<strong> segmental scarring</strong> of the <strong>glomeruli</strong> most prominently seen at the corticomedullary junction.</p>\n<p>Option D:&nbsp;<strong>Membranoproliferative glomerulonephritis</strong> - presence of thickenend glomerular basement membrane with <strong>mesangioproliferation</strong> and are of three types where type 1 is associated with hepatitis C infection while type 2 and 3 are idiopathic or complement mediated.</p>",
    "explanation_video": "",
    "question_images": [
      "https://upload.wikimedia.org/wikipedia/commons/6/69/Crescentic_glomerulonephritis_-_very_high_mag.jpg"
    ],
    "explanation_images": []
  },
  {
    "text": "The genetic testing of a 2-year-old boy presenting with an abdominal mass and other congenital anomalies revealed deletion of WT1 and PAX6 genes. Which of the following features is seen in this syndrome?",
    "choices": [
      {
        "id": 1,
        "text": "Warthin tumor"
      },
      {
        "id": 2,
        "text": "Retinal detachment"
      },
      {
        "id": 3,
        "text": "Gastrointestinal abnormalities"
      },
      {
        "id": 4,
        "text": "Intellectual disability"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p><strong>WT1 </strong>and<strong> PAX6 gene deletion</strong> results in <strong>WAGR syndrome</strong>. This syndrome leads to<strong> intellectual disability. </strong></p>\n<p>The components of<strong> WAGR syndrome </strong>are\u00a0</p>\n<ul>\n<li>Wilms tumor</li>\n<li>Aniridia</li>\n<li>Genitourinary abnormalities</li>\n<li>Intellectual disability</li>\n</ul>\n<p><strong>PAX6 deletion</strong> alone increases the risk of developing <strong>aniridia</strong>, and <strong>WT1 deletion</strong> increases the risk of developing <strong>Wilms tumor</strong>. However, both of these genes are located on chromosome 11p13. Thus, deletion of 11p13 leads to the deletion of both genes, leading to the development of WAGR syndrome.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 10-year-old boy presents with dark urine, fatigue and jaundice following the use of antimalarials. The peripheral blood smear shows cells as in the image below. All of the following findings can be seen in the patient except",
    "choices": [
      {
        "id": 1,
        "text": "Normocytic normochromic anemia"
      },
      {
        "id": 2,
        "text": "Elevated LDH"
      },
      {
        "id": 3,
        "text": "Absent haptoglobin"
      },
      {
        "id": 4,
        "text": "Positive direct Coomb\u2019s test"
      }
    ],
    "correct_choice_id": 4,
    "solution": "<p>The patient\u2019s peripheral blood smear shows <strong>bite cells </strong>characteristic of <strong>G6PD deficiency</strong>, likely precipitated after the use of <strong>antimalarials </strong>in this case.<strong> </strong>A<strong> positive direct Coomb\u2019s </strong>test is unlikely in G6PD deficiency;\u00a0it is seen in <strong>autoimmune hemolytic anemia</strong>.</p>\n<p>G6PD deficiency is an X-linked recessive disorder, in which the patient is usually asymptomatic unless challenged by oxidative agents such as fava beans, infections, and certain drugs leading to episodes of<strong> </strong>hemolytic anemia.\u00a0</p>\n<p>Intravascular hemolysis in G6PD deficiency leads to <strong>normocytic normochromic anemia </strong>(causes fatigue)<strong>,</strong> hemoglobinemia, hemoglobinuria (causes dark-colored urine),<strong> elevated LDH, absent</strong>/<strong>low haptoglobin </strong>(options b, c, d).</p>\n<p>A blood smear may show<strong> Blister or bite cells </strong>and<strong>\u00a0Heinz inclusion bodies</strong> (denatured hemoglobin within RBC):</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/785620d469ff4072a976291503d9518d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/6542e1b161804bd68b962f9accf74317x1279x914.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/ce8201ff8a0b460da85f0690ff4cc5d6x1279x914.JPEG"
    ]
  },
  {
    "text": "A 62-year-old woman presents with a rapidly enlarging midline neck swelling, along with hoarseness of voice and dyspnea. The histopathological study of the biopsy is given below. What is the most likely cause?",
    "choices": [
      {
        "id": 1,
        "text": "Anaplastic thyroid carcinoma"
      },
      {
        "id": 2,
        "text": "Follicular thyroid carcinoma"
      },
      {
        "id": 3,
        "text": "Medullary thyroid carcinoma"
      },
      {
        "id": 4,
        "text": "Papillary thyroid carcinoma"
      }
    ],
    "correct_choice_id": 1,
    "solution": "<p>The given clinical scenario and the histopathology slide showing <strong>sheets</strong> of<strong> undifferentiated, anaplastic cells</strong> with<strong> marked cytologic atypia,</strong> are likely suggestive of <strong>anaplastic thyroid carcinoma.</strong></p>\n<p>Anaplastic thyroid carcinoma is a rare and one of the <strong>most aggressive</strong> malignancies in humans. It is usually diagnosed in the <strong>elderly</strong> and there is a <strong>female</strong> preponderance. The clinical features include <strong>rapidly enlarging neck mass</strong>, <strong>dysphagia, hoarseness,</strong> cough, and hemoptysis. Patients have distant <strong>metastasis</strong> at the time of presentation and the most common sites include lungs, bone, and brain.</p>\n<p><strong>Management</strong>&nbsp;of anaplastic thyroid carcinoma (ATC) is as follows:</p>\n<ul>\n<li><strong>Total thyroidectomy</strong>&nbsp;with&nbsp;<strong>central node dissection</strong>&nbsp;is the recommended surgery.</li>\n<li><strong>En bloc resection</strong>- if an&nbsp;<strong>extrathyroidal extension</strong>&nbsp;is present.</li>\n<li>Postoperative external beam irradiation or&nbsp;<strong>adjunctive chemotherapy</strong>&nbsp;(adriamycin + paclitaxel/cisplatin) is given to prolong survival.</li>\n</ul>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/811b6d4f62e946e1bf6b03dea8a607f1.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/193489792df741fdb424aeae92c35ce1x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/7fcbabd939d34a1393e632024e677a43x1280x853.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/e80fc7a0625c47cf9cfb18e2907249eex720x542.JPEG"
    ]
  },
  {
    "text": "A 28-year-old female patient presents to the OPD with complaints of pain in the right knee for the past few months. On examination, there is tenderness in the affected part with a reduced range of motion. A radiographic study revealed a solitary lytic lesion at the distal end of the femur and the microscopic appearance of the lesion is shown below. Which of the following is not an x-ray finding in this condition?",
    "choices": [
      {
        "id": 1,
        "text": "Soap bubble appearance"
      },
      {
        "id": 2,
        "text": "It is usually radiopaque"
      },
      {
        "id": 3,
        "text": "Expansion of the overlying cortex"
      },
      {
        "id": 4,
        "text": "No calcification within the tumor"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The clinical history and microscopic appearance are suggestive of <strong>osteoclastoma or giant cell tumor</strong>&nbsp;and they are <strong>purely radiolucent</strong>.</p>\n<p>Microscopically they are composed of <strong>mononuclear cells with macrophages. </strong>They are more common between the age of 20-40 and typically affect the metaphyses of long bones with a preponderance for the <strong>distal femur</strong>, proximal tibia, distal radius and proximal humerus.</p>\n<p>Important X-ray features of a GCT:</p>\n<ul>\n<li>A solitary, possibly lobulated, lytic lesion in the epiphysis</li>\n<li>Eccentric location, most often subchondral</li>\n<li>Expansion of the overlying cortex</li>\n<li>Soap bubble appearance - The tumor is homogeneously lytic with trabeculae of the remnants of bone traversing it, giving it a loculated appearance called soap bubble appearance</li>\n<li>No calcification within the tumor</li>\n<li>No or minimal reactive sclerosis around the tumor.</li>\n</ul>\n<p>&nbsp;</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/cc058b9b197b4bc79cdf304a61abf51d.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/901df9b043104a59a046d880f3f1440dx720x912.JPEG"
    ]
  },
  {
    "text": "A 50-year-old man had multiple nodular skin lesions for the past 5 years. Previous investigations showed CD 4 T helper cells in these lesions. He has been using topical steroids for its management. He now presents with rapid onset diffuse erythema of the skin. Which of the following will be seen in this patient?",
    "choices": [
      {
        "id": 1,
        "text": "Staphylococcal skin infection"
      },
      {
        "id": 2,
        "text": "Increased CD 8 T cells in the skin"
      },
      {
        "id": 3,
        "text": "Abnormal T cells with cerebriform nucleus in blood"
      },
      {
        "id": 4,
        "text": "Increased mast cells around dermal blood vessels"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The given scenario describes the development of <strong>Sezary syndrome in a patient with mycosis fungoides</strong>. This syndrome shows the presence of <strong>abnormal T cells with cerebriform nucleii (Sezary cells)</strong> in the <strong>blood</strong>.</p>\n<p>Mycosis fungoides is <strong>cutaneous T cell lymphoma</strong> (CD4+ Helper T cells) which usually stays confined to the skin. It can disseminate into blood which is known as Sezary syndrome. It presents as diffuse erythema of the skin (<strong>erythroderma</strong>).</p>\n<p>Mycoses fungoides presents as\u00a0scaly red-brown patches, raised scaling plaques, and fungating nodules. It passes through 3 phases:</p>\n<ul>\n<li><strong>Inflammatory pre-mycotic</strong> <strong>phase</strong>- eczema like lesions</li>\n<li><strong>Plaque phase</strong>- raised plaques are seen</li>\n<li><strong>Tumor phase</strong>- multiple tumor nodules indicating systemic spread</li>\n</ul>\n<p>The given image shows mycosis fungoides:</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0e1d56c4bcc54276b58a639e470beb1dx800x600.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/0a7fb8b957884484aae491468a39c9bax800x1082.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/544e1c348f774596b9eef59494f54620x800x600.JPEG"
    ]
  },
  {
    "text": "A 65-year-old male presents with complaints of easy fatigability, weight loss, and an evening rise in temperature. Investigations reveal pancytopenia. The bone marrow aspirate of a patient is shown in the image given below. Cytogenetic studies revealed the presence of t(15:17). This subtype of disease is associated with which of the following conditions?",
    "choices": [
      {
        "id": 1,
        "text": "Chloroma"
      },
      {
        "id": 2,
        "text": "DIC"
      },
      {
        "id": 3,
        "text": "Leukemia cutis"
      },
      {
        "id": 4,
        "text": "Down's syndrome"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>In the given clinical scenario, the presence of <strong>Auer rods</strong> on bone marrow aspirates and <strong>t(15:17)</strong> on cytogenic studies points towards the diagnosis of <strong>AML-M3. DIC</strong> is most <strong>commonly associated</strong> with AML-M3.</p>\n<p><strong>Peripheral smear (WBC):</strong></p>\n<p><strong>1) Acute myeloid leukemia</strong></p>\n<p>Acute myeloid leukemia is a tumor of hematopoietic progenitors caused by acquired oncogenic mutations. This leads to the accumulation of immature myeloid blasts in the marrow resulting in marrow failure and complications related to anemia, thrombocytopenia, and neutropenia.</p>\n<ul>\n<li>Bone marrow/peripheral smear shows a large, uniform population of cells <strong>(myeloblasts)</strong> with prominent nucleoli (<strong>yellow arrow</strong>).\u00a0It shows the presence of primary cytoplasmic granules</li>\n<li><strong>Auer rods: Needle-shaped</strong> azurophilic intracytoplasmic <strong>inclusion bodies(black arrow</strong>) particularly seen in <strong>acute promyelocytic leukemia</strong> (AML M3) with <strong>t(15;17).</strong></li>\n</ul>\n<p>\u00a0</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/b0434874a75a4f368cec836760ac1c98.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2d5a413779f1468dac68342811b4bb48x352x512.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/9788bbf7ca0b4bf092835c95fb655bdex720x820.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/3ea50c0952f847bb8c23e2a4ef34546ax355x512.JPEG",
      "https://dhmbxeygs57ff.cloudfront.net/uploads/a07b0a55e0f04edfaefe10bde3ca73c7x1280x960.JPEG"
    ]
  },
  {
    "text": "A young female patient was brought to the emergency room with severe gastrointestinal bleeding. The attenders inform the duty doctor that the patient was on warfarin medications. Her blood group is unknown. The duty doctor can transfuse fresh frozen plasma (FFP) from which of the following blood groups?",
    "choices": [
      {
        "id": 1,
        "text": "O"
      },
      {
        "id": 2,
        "text": "AB"
      },
      {
        "id": 3,
        "text": "A"
      },
      {
        "id": 4,
        "text": "B"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p><strong><span data-preserver-spaces=\"true\">AB fresh frozen plasma&nbsp;</span></strong>(FFP)<span data-preserver-spaces=\"true\">&nbsp;is given when uncross-matched plasma is needed as in the above case, wherein the blood group of the patient is not known.</span></p>\n<p><span data-preserver-spaces=\"true\">It is to be noted that in cases of <strong>active bleeding </strong>in a patient on warfarin therapy, prothrombin complex concentrate (PCC) is recommended over FFP. In case PCC is not available, FFP is used as in the above case.</span></p>\n<p>FFP is plasma prepared from whole blood, either from the primary centrifugation of whole blood into red cells and plasma or from the secondary centrifugation of platelet-rich plasma. The plasma is rapidly frozen to &ndash;25&deg;C or colder within 8 hours of collection and contains normal plasma levels of stable clotting factors, albumin, immunoglobulin, and Factor VIII at a level of at least 70% of normal fresh plasma<strong>.</strong></p>\n<p>Each unit of issued FFP contains a quantity of&nbsp;<strong>200-300 mL</strong>.</p>\n<p>FFP is capable of transmitting any agent present in cells or plasma, which was undetected by routine screening including HIV, hepatitis B and C, syphilis, and malaria.</p>\n<p><strong>Definite indications</strong>&nbsp;of FFP transfusion:</p>\n<ul>\n<li>Replacement of a <strong>single coagulation factor deficiency</strong>, where a specific or combined factor concentrate is unavailable or contraindicated.</li>\n<li>Immediate <strong>reversal of warfarin</strong> effect where <strong>prothrombin complex</strong> concentrate is <strong>unavailable.</strong></li>\n<li>Thrombotic thrombocytopenic purpura.</li>\n<li>Inherited coagulation inhibitor deficiencies where the specific concentrate is unavailable.</li>\n<li>C1 esterase inhibitor deficiency where the specific concentrate is unavailable</li>\n</ul>\n<p><span data-preserver-spaces=\"true\">In an emergency, if crossmatched blood is unavailable:</span></p>\n<ul>\n<li><strong><span data-preserver-spaces=\"true\">Type O negative pRBCs</span></strong><span data-preserver-spaces=\"true\">&nbsp;are indicated for patients with exsanguinating hemorrhage because it lacks the A and B and Rh antigens, and thus, it cannot be hemolyzed by anti-A, anti-B, or anti-D antibodies in the recipient&rsquo;s blood.</span></li>\n<li><strong><span data-preserver-spaces=\"true\">AB plasma</span></strong><span data-preserver-spaces=\"true\">&nbsp;is given when uncross-matched plasma is needed because it <strong>does not contain antibodies against any antigens on RBCs</strong>.</span></li>\n</ul>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 14-year-old boy has frequent episodes of facial edema around his lips. It usually occurs after an emotional stressor. He also has a family history of similar conditions. Which of the following is the main mediator of these symptoms?",
    "choices": [
      {
        "id": 1,
        "text": "Leukotrienes"
      },
      {
        "id": 2,
        "text": "Bradykinin"
      },
      {
        "id": 3,
        "text": "Prostaglandins"
      },
      {
        "id": 4,
        "text": "Histamine"
      }
    ],
    "correct_choice_id": 2,
    "solution": "<p>The given clinical scenario is suggestive of\u00a0<strong>hereditary angioedema. </strong>The main inflammatory mediator responsible for these symptoms is <strong>bradykinin</strong>.</p>\n<p>Bradykinin is an inflammatory mediator formed by the cleavage of kininogen, in the presence of the enzyme kallikrein. Bradykinin has the following<strong> effects:</strong></p>\n<ul>\n<li>Increases the vascular permeability</li>\n<li>Causes contraction of smooth muscle</li>\n<li>Dilates the blood vessel\u00a0</li>\n<li>Mediates pain</li>\n</ul>\n<p>Hereditary angioedema is an autosomal dominant condition characterized by a\u00a0<strong>deficiency</strong> of <strong>C1 esterase inhibitors.</strong>\u00a0C1 esterase inhibitors usually target proteases like C1r and C1s, factor XII and the kallikrein system. Therefore, its deficiency leads to unregulated activation of kallikrein, leading to <strong>increased bradykinin.</strong></p>\n<p><strong>Features</strong> of the condition include swelling of the skin and mucosal surfaces, nausea, vomiting, and diarrhea. They may be aggravated after minor trauma or emotional stressor. The condition can be<strong> treated</strong> by giving C1 inhibitor concentrates from human plasma.\u00a0</p>\n<p>Option D: histamine is implicated as a mediator of angioedema in anaphylaxis. However, the main mediator in Heriditory Angioedema is bradykinnin and therefore the correct answer.</p>",
    "explanation_video": "",
    "question_images": [],
    "explanation_images": []
  },
  {
    "text": "A 53-year-old female patient is diagnosed with breast cancer. The findings of immunohistochemistry staining are shown in the image given below. Identify the subtype of breast cancer based on these findings.",
    "choices": [
      {
        "id": 1,
        "text": "Triple negative"
      },
      {
        "id": 2,
        "text": "Luminal type A"
      },
      {
        "id": 3,
        "text": "Luminal type B"
      },
      {
        "id": 4,
        "text": "Basal type"
      }
    ],
    "correct_choice_id": 3,
    "solution": "<p>The above image shows immunohistochemistry staining positive for ER, PR, and HER2 receptors, which is <strong>triple</strong> <strong>positive</strong> or <strong>luminal type B&nbsp;</strong>of breast cancer.</p>\n<p><strong>Immunohistochemistry staining:</strong></p>\n<p>Positive staining is indicated by the presence of brown-colored tissue.</p>\n<ul>\n<li>The <strong>estrogen receptor (ER)</strong>&nbsp;and<strong>&nbsp;progesterone receptor (PR)</strong>&nbsp;are both nuclear receptors; hence, the nucleus is stained brown if positive.</li>\n<li>The<strong>&nbsp;human epidermal growth factor receptor type 2 (HER2)</strong>&nbsp;is a membrane receptor; hence the cell membrane is stained brown if positive.</li>\n</ul>\n<p>The image below shows positive and negative staining for ER, PR, and HER2.</p>",
    "explanation_video": "",
    "question_images": [
      "https://cdn1.dailyrounds.org/uploads/3c096a70f9324b5bb4a61f64eb3b59be.JPEG"
    ],
    "explanation_images": [
      "https://dhmbxeygs57ff.cloudfront.net/uploads/2644a3a7e0ce4bf38e37ad36d717dd33x243x199.JPEG"
    ]
  }
];
        let quizName = 'Integrated Mini Test 7 - Pathology';
        const quizFilename = 'integrated-mini-test-7-pathology-0a9804d5.html';
        let hierarchy = ["Marrow", "NEET PG Mini Test Series", "2024-25"];
        
        // Handle Custom Quiz Loading
        if (window.location.pathname.endsWith('custom_quiz.html')) {
            const customData = JSON.parse(localStorage.getItem('customQuizData'));
            if (customData) {
                questionsData = customData.questions;
                quizName = customData.name;
                hierarchy = customData.hierarchy;
                document.title = quizName + ' - Brain And Scalpel';
                document.getElementById('totalQuestions').textContent = questionsData.length;
                document.getElementById('quizHierarchy').textContent = hierarchy.join(' > ');
            }
        }

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let currentMode = 'study';
        let timer = null;
        let timeRemaining = 0;
        let questionStartTime = Date.now();
        let quizStartTime = Date.now();
        let isQuizCompleted = false;
        
        let questionStates = new Array(questionsData.length).fill(null).map(() => ({
            status: 'not_attempted',
            bookmarked: false,
            markedForReview: false,
            selectedAnswer: null,
            timeSpent: 0
        }));
        
        let stats = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            totalAttempted: 0,
            totalTime: 0,
            notAttempted: questionsData.length
        };

        // --- NEW: History Management ---
        function saveProgress() {
            if (isQuizCompleted) return; // Don't save after completion
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            userHistory[quizFilename] = {
                questionStates,
                stats,
                currentQuestionIndex,
                currentMode,
                status: 'incomplete',
                lastSeen: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }

        function loadProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const savedState = userHistory[quizFilename];
            if (savedState) {
                questionStates = savedState.questionStates;
                stats = savedState.stats;
                currentQuestionIndex = savedState.currentQuestionIndex;
                currentMode = savedState.currentMode;
                console.log('Progress loaded.');
                return true;
            }
            return false;
        }

        function clearProgress() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            if(userHistory[quizFilename]) {
                delete userHistory[quizFilename];
                localStorage.setItem('userHistory', JSON.stringify(userHistory));
                console.log('Previous progress cleared.');
            }
        }

        function markQuizAsCompleted() {
            const userHistory = JSON.parse(localStorage.getItem('userHistory')) || {};
            const totalQuestions = questionsData.length;
            const correct = stats.correctAnswers || 0;
            
            userHistory[quizFilename] = {
                score: correct,
                total: totalQuestions,
                status: 'completed',
                completedOn: new Date().toISOString()
            };
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }
        // --- End of History Management ---

        const urlParams = new URLSearchParams(window.location.search);
        const startAt = parseInt(urlParams.get('startAt'));
        const resume = urlParams.get('resume') === 'true';

        function goBack() {
            if (!isQuizCompleted) saveProgress(); // Save progress before leaving
            window.location.href = document.referrer || 'index.html';
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('modeModal').style.display = 'none';
            initializeQuiz();
        }

        function initializeQuiz() {
            quizStartTime = Date.now();
            
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const markReviewBtn = document.getElementById('markReviewBtn');
            const testModeReviewLegend = document.getElementById('testModeReviewLegend');
            const isTestMode = currentMode === 'test' || currentMode === 'timed_exam';
            
            document.getElementById('statsBar').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('studyModeLegend').style.display = isTestMode ? 'none' : 'block';
            document.getElementById('testModeLegend').style.display = isTestMode ? 'block' : 'none';
            document.getElementById('submitSection').style.display = isTestMode ? 'block' : 'none';
            bookmarkBtn.style.display = isTestMode ? 'none' : 'flex';
            markReviewBtn.style.display = isTestMode ? 'flex' : 'none';
            testModeReviewLegend.style.display = isTestMode ? 'flex' : 'none';
            
            if (currentMode === 'timed_study' || currentMode === 'timed_exam') {
                document.getElementById('timerContainer').classList.remove('hidden');
            }
            
            if (!isNaN(startAt) && startAt >= 0 && startAt < questionsData.length) {
                currentQuestionIndex = startAt;
            }

            loadBookmarkedQuestions();
            generateQuestionNav();
            updateStats();
            displayQuestion();
        }

        function generateQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 text-sm font-medium rounded transition-all duration-200';
                btn.onclick = () => jumpToQuestion(i);
                btn.id = `navBtn_${i}`;
                nav.appendChild(btn);
            }
            
            updateQuestionNav();
        }

        function updateQuestionNav() {
            for (let i = 0; i < questionsData.length; i++) {
                const btn = document.getElementById(`navBtn_${i}`);
                const state = questionStates[i];
                let className = '';
                
                if (i === currentQuestionIndex) {
                    className = 'nav-btn-current';
                } else if (state.bookmarked) {
                    className = 'nav-btn-bookmarked';
                } else if (state.markedForReview) {
                    className = 'nav-btn-marked-review';
                } else if (currentMode === 'study' || currentMode === 'timed_study') {
                    if (state.status === 'correct') className = 'nav-btn-correct';
                    else if (state.status === 'incorrect') className = 'nav-btn-incorrect';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                } else {
                    if (state.selectedAnswer !== null) className = 'nav-btn-answered';
                    else className = 'nav-btn-not-attempted hover:bg-white hover:bg-opacity-20';
                }
                btn.className = `w-8 h-8 text-sm font-medium rounded ${className}`;
            }
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < questionsData.length) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex = index;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function updateStats() {
            if (currentMode === 'study' || currentMode === 'timed_study') {
                document.getElementById('correctCount').textContent = stats.correctAnswers;
                document.getElementById('incorrectCount').textContent = stats.incorrectAnswers;
                document.getElementById('totalAttempted').textContent = stats.totalAttempted;
                
                const accuracy = stats.totalAttempted > 0 
                    ? Math.round((stats.correctAnswers / stats.totalAttempted) * 100)
                    : 0;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                stats.totalTime = questionStates.reduce((acc, state) => acc + state.timeSpent, 0);
                const timeSpent = Math.floor(stats.totalTime / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                document.getElementById('timeSpent').textContent = 
                    minutes + ':' + seconds.toString().padStart(2, '0');
            }
        }

        function setupVideo(videoElement, url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
        }

        function displayQuestion() {
            if (!questionsData || questionsData.length === 0) {
                document.getElementById('questionText').innerHTML = 'No questions available for this quiz.';
                return;
            };
            
            const question = questionsData[currentQuestionIndex];
            questionStartTime = Date.now();
            
            selectedOption = questionStates[currentQuestionIndex].selectedAnswer;
            
            const progress = ((currentQuestionIndex + 1) / questionsData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            updateQuestionNav();
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            document.getElementById('solutionContainer').classList.add('hidden');
            
            document.getElementById('questionText').innerHTML = question.text || 'No question text available';
            
            let mediaHtml = '';
            if (question.question_audio) mediaHtml += `<div class="glass-light p-4 mb-4"><audio src="${question.question_audio}" controls class="w-full"></audio></div>`;
            if (question.question_video) mediaHtml += `<div class="glass-light p-4 mb-4"><video src="${question.question_video}" controls class="w-full rounded-lg"></video></div>`;
            if (question.question_images) {
                question.question_images.forEach(imgSrc => {
                    if (imgSrc) mediaHtml += `<div class="glass-light p-4 mb-4"><img src="${imgSrc}" alt="Question Image" class="w-full rounded-lg"></div>`;
                });
            }
            document.getElementById('questionMedia').innerHTML = mediaHtml;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('answered');
            
            if (question.choices && Array.isArray(question.choices)) {
                question.choices.forEach((choice, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const isSelected = selectedOption === index;
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.innerHTML = `
                        <button type="button" class="option-button ${isSelected ? 'selected' : ''}" data-option-index="${index}">
                            <div class="option-letter">${optionLetter}</div>
                            <div class="option-text">${choice.text || 'Option ' + (index + 1)}</div>
                        </button>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
                
                optionsContainer.addEventListener('click', function(e) {
                    const optionButton = e.target.closest('.option-button');
                    if (optionButton) {
                        const optionIndex = parseInt(optionButton.getAttribute('data-option-index'));
                        selectOption(optionIndex);
                    }
                });
            }
            
            updateBookmarkButton();
            updateMarkReviewButton();

            if ((currentMode === 'timed_study' || currentMode === 'timed_exam') && !isQuizCompleted) {
                startTimer();
            }
        }

        function selectOption(index) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer.classList.contains('answered')) return;

            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                questionStartTime = Date.now();
            }
            
            selectedOption = index;
            questionStates[currentQuestionIndex].selectedAnswer = index;
            
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            
            if (currentMode === 'study' || currentMode === 'timed_study') {
                processAnswer();
            } else {
                if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                    questionStates[currentQuestionIndex].status = 'answered';
                    stats.totalAttempted++;
                    stats.notAttempted--;
                }
                updateQuestionNav();
            }
            saveProgress(); // NEW: Save on answer selection
        }

        function processAnswer() {
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            
            if(selectedOption === null) return;

            const selectedChoice = question.choices[selectedOption];
            const isCorrect = selectedChoice.id === correctChoiceId;
            
            if (questionStates[currentQuestionIndex].status === 'not_attempted') {
                stats.totalAttempted++;
                stats.notAttempted--;
                if(isCorrect) stats.correctAnswers++; else stats.incorrectAnswers++;
            }
            questionStates[currentQuestionIndex].status = isCorrect ? 'correct' : 'incorrect';
            
            updateStats();
            showInlineFeedback(isCorrect);
            updateQuestionNav();
        }

        function showInlineFeedback(isCorrect) {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;

            const optionsContainer = document.getElementById('optionsContainer');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            const question = questionsData[currentQuestionIndex];
            const correctChoiceId = question.correct_choice_id;
            let correctOptionIndex = question.choices.findIndex(c => c.id === correctChoiceId);

            optionsContainer.classList.add('answered');

            optionButtons.forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === correctOptionIndex) btn.classList.add('correct');
                else if (index === selectedOption && !isCorrect) btn.classList.add('incorrect');
            });

            showSolution();
        }


        function showSolution() {
            if (currentMode !== 'study' && currentMode !== 'timed_study') return;
            
            const question = questionsData[currentQuestionIndex];
            document.getElementById('solutionText').innerHTML = question.solution || 'No solution provided';
            
            const videoContainer = document.getElementById('solutionVideo');
            const videoPlayer = document.getElementById('explanationVideoPlayer');
            const explanationVideo = question.explanation_video;
            
            if (explanationVideo) {
                videoContainer.classList.remove('hidden');
                if (explanationVideo.includes('.m3u8')) setupVideo(videoPlayer, explanationVideo);
                else videoPlayer.src = explanationVideo;
            } else {
                videoContainer.classList.add('hidden');
            }

            const audioContainer = document.getElementById('solutionAudio');
            audioContainer.innerHTML = '';
            if (question.explanation_audio_eng) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English Explanation:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
            }
            if (question.explanation_audio_hin) {
                audioContainer.innerHTML += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish Explanation:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;
            }
            
            const imagesContainer = document.getElementById('solutionImages');
            imagesContainer.innerHTML = '';
            if (question.explanation_images) {
                 question.explanation_images.forEach(imgSrc => {
                    if(imgSrc) imagesContainer.innerHTML += `<div class="mt-4"><img src="${imgSrc}" alt="Explanation Image" class="w-full rounded-lg"></div>`;
                });
            }

            document.getElementById('solutionContainer').classList.remove('hidden');
        }

        function submitQuiz() {
            if (timer) clearInterval(timer);
            if (!confirm('Are you sure you want to submit the quiz?')) return;
            
            isQuizCompleted = true;
            let correct = 0, incorrect = 0;
            const totalTime = Date.now() - quizStartTime;
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                if (state.selectedAnswer !== null) {
                    if (question.choices[state.selectedAnswer].id === question.correct_choice_id) {
                        correct++;
                        state.status = 'correct';
                    } else {
                        incorrect++;
                        state.status = 'incorrect';
                    }
                }
            });
            
            // Save performance data
            const performanceData = JSON.parse(localStorage.getItem('quizPerformanceData')) || [];
            performanceData.push({
                quizName: quizName,
                hierarchy: hierarchy,
                timestamp: Date.now(),
                totalTime: totalTime,
                stats: {
                    correct: correct,
                    incorrect: incorrect,
                    notAttempted: questionsData.length - (correct + incorrect)
                }
            });
            localStorage.setItem('quizPerformanceData', JSON.stringify(performanceData));

            stats.correctAnswers = correct; // Update global stats
            stats.incorrectAnswers = incorrect;
            markQuizAsCompleted(); // NEW: Mark quiz as complete in history
            showPerformanceAnalysis(correct, incorrect, questionsData.length - (correct + incorrect), totalTime);
        }

        function showPerformanceAnalysis(correct, incorrect, notAttempted, totalTime) {
            const modal = document.getElementById('performanceModal');
            const accuracy = (correct + incorrect) > 0 ? Math.round((correct / (correct + incorrect)) * 100) : 0;
            
            const circumference = 2 * Math.PI * 65;
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            scoreCircle.style.strokeDashoffset = circumference - (accuracy / 100) * circumference;
            
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsResult').textContent = questionsData.length;
            document.getElementById('correctResult').textContent = correct;
            document.getElementById('incorrectResult').textContent = incorrect;
            document.getElementById('notAttemptedResult').textContent = notAttempted;
            
            const totalMinutes = Math.floor(totalTime / 60000);
            const totalSeconds = Math.floor((totalTime % 60000) / 1000);
            document.getElementById('totalTimeResult').textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
            
            const avgTime = totalTime / questionsData.length;
            const avgMinutes = Math.floor(avgTime / 60000);
            const avgSeconds = Math.floor((avgTime % 60000) / 1000);
            document.getElementById('avgTimeResult').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            modal.classList.remove('hidden');
        }

        function closePerformanceModal() { document.getElementById('performanceModal').classList.add('hidden'); }

        function reviewQuestions() {
            document.getElementById('questionReviewSection').classList.remove('hidden');
            const container = document.getElementById('reviewQuestionsContainer');
            container.innerHTML = '';
            
            questionsData.forEach((question, index) => {
                const state = questionStates[index];
                const correctChoiceId = question.correct_choice_id;
                
                let statusClass = 'not-attempted', statusText = 'Not Attempted';
                if (state.selectedAnswer !== null) {
                    const selectedChoice = question.choices[state.selectedAnswer];
                    if (selectedChoice.id === correctChoiceId) { statusClass = 'correct'; statusText = 'Correct'; }
                     else { statusClass = 'incorrect'; statusText = 'Incorrect'; }
                }
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `review-question ${statusClass}`;
                
                let optionsHtml = (question.choices || []).map((choice, choiceIndex) => {
                    const isSelected = state.selectedAnswer === choiceIndex;
                    const isCorrect = choice.id === correctChoiceId;
                    let borderClass = 'border-gray-600';
                    if(isCorrect) borderClass = 'border-green-500';
                    else if(isSelected) borderClass = 'border-red-500';
                    
                    return `<div class="p-3 rounded-lg border ${borderClass}"><span class="font-bold mr-3">${String.fromCharCode(65 + choiceIndex)}</span><span>${choice.text}</span></div>`;
                }).join('');

                const videoHtml = question.explanation_video ? `<div class="mt-4"><video id="review-video-${index}" data-src="${question.explanation_video}" class="w-full rounded-lg" controls></video></div>` : '';
                
                let audioHtml = '';
                if(question.explanation_audio_eng) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">English:</p><audio src="${question.explanation_audio_eng}" controls class="w-full"></audio></div>`;
                if(question.explanation_audio_hin) audioHtml += `<div class="mt-2"><p class="text-sm text-white text-opacity-70 mb-1">Hinglish:</p><audio src="${question.explanation_audio_hin}" controls class="w-full"></audio></div>`;

                let imagesHtml = (question.explanation_images || []).map(src => src ? `<div class="mt-4"><img src="${src}" alt="Explanation Image" class="w-full rounded-lg"></div>` : '').join('');

                reviewDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-bold text-white">Question ${index + 1}</h4>
                            <span class="text-sm px-3 py-1 rounded-full bg-${statusClass === 'correct' ? 'green' : statusClass === 'incorrect' ? 'red' : 'gray'}-600 text-white">${statusText}</span>
                        </div>
                        <div class="text-white mb-4">${question.text}</div>
                    </div>
                    <div class="space-y-2 mb-4">${optionsHtml}</div>
                    <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700">
                        <h5 class="text-green-400 font-bold mb-2">Explanation:</h5>
                        <div class="text-white text-opacity-90">${question.solution || 'No solution available.'}</div>
                        ${videoHtml}
                        ${audioHtml}
                        ${imagesHtml}
                    </div>`;
                container.appendChild(reviewDiv);
            });
            initializeReviewVideos();
        }

        function initializeReviewVideos() {
            document.querySelectorAll('video[data-src]').forEach(videoEl => {
                const src = videoEl.dataset.src;
                if (src && src.includes('.m3u8')) {
                    setupVideo(videoEl, src);
                } else if (src) {
                    videoEl.src = src;
                }
            });
        }

        function retakeQuiz() {
            if (confirm('Are you sure you want to retake the quiz? This will reset all your answers.')) {
                if (window.location.pathname.endsWith('custom_quiz.html')) {
                    localStorage.removeItem('customQuizData');
                }
                clearProgress(); // NEW: Clear history on retake
                location.reload();
            }
        }

        function loadBookmarkedQuestions() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            bookmarks.forEach(bookmark => {
                if (bookmark.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-'))) {
                    if (bookmark.questionIndex < questionsData.length) {
                        questionStates[bookmark.questionIndex].bookmarked = true;
                    }
                }
            });
        }

        function toggleBookmark() {
            const isBookmarked = !questionStates[currentQuestionIndex].bookmarked;
            questionStates[currentQuestionIndex].bookmarked = isBookmarked;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions')) || [];
            
            if (isBookmarked) {
                const bookmarkData = {
                    quizName: quizName,
                    quizFile: window.location.pathname.split('/').pop(),
                    questionIndex: currentQuestionIndex,
                    question: questionsData[currentQuestionIndex],
                    hierarchy: hierarchy,
                    timestamp: Date.now()
                };
                bookmarks.push(bookmarkData);
            } else {
                bookmarks = bookmarks.filter(b => 
                    !(b.quizFile.includes(quizName.toLowerCase().replace(/ /g, '-')) && b.questionIndex === currentQuestionIndex)
                );
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
            updateBookmarkButton();
            updateQuestionNav();
        }

        function updateBookmarkButton() {
            const btn = document.getElementById('bookmarkBtn');
            const text = document.getElementById('bookmarkText');
            const isBookmarked = questionStates[currentQuestionIndex].bookmarked;
            
            btn.className = isBookmarked ? 'gradient-yellow px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-yellow-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isBookmarked ? 'Bookmarked' : 'Bookmark';
        }
        
        function toggleMarkForReview() {
            questionStates[currentQuestionIndex].markedForReview = !questionStates[currentQuestionIndex].markedForReview;
            updateMarkReviewButton();
            updateQuestionNav();
        }

        function updateMarkReviewButton() {
            const btn = document.getElementById('markReviewBtn');
            const text = document.getElementById('markReviewText');
            const isMarked = questionStates[currentQuestionIndex].markedForReview;
            
            btn.className = isMarked ? 'gradient-purple px-6 py-3 text-white transition-all duration-300 flex items-center' : 'glass-light px-6 py-3 text-white hover:bg-purple-500 hover:bg-opacity-20 transition-all duration-300 flex items-center';
            text.textContent = isMarked ? 'Marked' : 'Mark for Review';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                if (questionStartTime) {
                    questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
                }
                
                currentQuestionIndex--;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            }
        }

        function nextQuestion() {
            if (questionStartTime) {
                questionStates[currentQuestionIndex].timeSpent += Date.now() - questionStartTime;
            }
            
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveProgress(); // NEW: Save on navigation
            } else {
                if (currentMode === 'test' || currentMode === 'timed_exam') {
                    if (confirm('You have reached the end of the quiz. Would you like to submit your answers now?')) {
                        submitQuiz();
                    }
                } else {
                    if (confirm('You have completed all questions. Would you like to review from the beginning?')) {
                        currentQuestionIndex = 0;
                        displayQuestion();
                        saveProgress();
                    }
                }
            }
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timeRemaining = 120; // 2 minutes per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    if (currentMode === 'timed_exam') {
                        submitQuiz();
                    } else {
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeDisplay').textContent = 
                minutes + ':' + seconds.toString().padStart(2, '0');
        }

        function toggleSidebar() {
            document.getElementById('quizSidebar').classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', () => {
             if (resume) {
                if (loadProgress()) {
                    document.getElementById('modeModal').style.display = 'none';
                    initializeQuiz(); // Resume directly into the saved mode and state
                } else {
                    // If resume fails (e.g., cleared history), start fresh
                    clearProgress();
                    document.getElementById('modeModal').style.display = 'flex';
                }
             } else if (!window.location.pathname.endsWith('custom_quiz.html')) {
                clearProgress(); // Clear old progress if not resuming
                document.getElementById('modeModal').style.display = 'flex';
             } else {
                initializeQuiz();
             }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('modeModal').style.display !== 'none') return;
            if (document.getElementById('performanceModal').classList.contains('hidden') === false) return;
            
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option-button');
                if (optionIndex < options.length) selectOption(optionIndex);
            } else if (e.key === 'ArrowLeft') {
                previousQuestion();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextQuestion();
            } else if (e.key.toLowerCase() === 'b' && (currentMode === 'study' || currentMode === 'timed_study')) {
                toggleBookmark();
            } else if (e.key.toLowerCase() === 'm' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                toggleMarkForReview();
            } else if (e.key.toLowerCase() === 's' && (currentMode === 'test' || currentMode === 'timed_exam')) {
                submitQuiz();
            }
        });
    </script>
</body>
</html>